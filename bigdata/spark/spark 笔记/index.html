
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="教主">
      
      
        <link rel="canonical" href="https://demo.icefery.xyz/bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/">
      
      
        <link rel="prev" href="../Spark%20on%20Kubernetes/">
      
      
        <link rel="next" href="../../sqoop/">
      
      
      <link rel="icon" href="https://avatars.githubusercontent.com/u/61737634">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Spark 笔记 - 十二翼堕落天使</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../__static__/css/mkdocs.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spark" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="十二翼堕落天使" class="md-header__button md-logo" aria-label="十二翼堕落天使" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/61737634" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            十二翼堕落天使
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spark 笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label=""  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/icefery/demo.icefery.xyz" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    icefery/demo.icefery.xyz
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../algorithm/" class="md-tabs__link">
          
  
    
  
  Algorithm

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../architecture/" class="md-tabs__link">
          
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../backend/" class="md-tabs__link">
          
  
    
  
  Backend

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Bigdata

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../build-tool/" class="md-tabs__link">
          
  
    
  
  Build tool

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../cloud-native/" class="md-tabs__link">
          
  
    
  
  Cloud native

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../container-app/clash/" class="md-tabs__link">
          
  
    
  
  Container app

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../data-structure/" class="md-tabs__link">
          
  
    
  
  Data structure

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../database/" class="md-tabs__link">
          
  
    
  
  Database

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../frontend/" class="md-tabs__link">
          
  
    
  
  Frontend

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../hardware/" class="md-tabs__link">
          
  
    
  
  Hardware

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../lang/" class="md-tabs__link">
          
  
    
  
  Lang

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../load-balance/" class="md-tabs__link">
          
  
    
  
  Load balance

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../middleware/" class="md-tabs__link">
          
  
    
  
  Middleware

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../monitoring/" class="md-tabs__link">
          
  
    
  
  Monitoring

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../network/" class="md-tabs__link">
          
  
    
  
  Network

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../os/" class="md-tabs__link">
          
  
    
  
  Os

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../software/" class="md-tabs__link">
          
  
    
  
  Software

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../version-control/" class="md-tabs__link">
          
  
    
  
  Version control

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="十二翼堕落天使" class="md-nav__button md-logo" aria-label="十二翼堕落天使" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/61737634" alt="logo">

    </a>
    十二翼堕落天使
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/icefery/demo.icefery.xyz" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    icefery/demo.icefery.xyz
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../algorithm/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Algorithm
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithm/%E3%80%90%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E3%80%91%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    【动态规划】背包问题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../architecture/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../architecture/distributed-lock/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Distributed lock
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Distributed lock
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../architecture/distributed-transaction/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Distributed transaction
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Distributed transaction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Backend
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/dubbo/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Dubbo
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Dubbo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/express/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Express
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Express
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/express/express-with-https/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Express 启用 HTTPS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/grpc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Grpc
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Grpc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/jooq/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Jooq
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Jooq
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/mybatis/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mybatis
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Mybatis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/netty/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Netty
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Netty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-boot/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring boot
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Spring boot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/spring-boot/spring-boot%20%E8%B7%A8%E5%9F%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spring boot 跨域
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-cloud/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring cloud
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            Spring cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-jdbc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring jdbc
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            Spring jdbc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-security/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring security
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            Spring security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-session/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring session
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_13">
            <span class="md-nav__icon md-icon"></span>
            Spring session
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/spring-webflux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spring webflux
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            Spring webflux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../backend/struts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Struts
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            Struts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Bigdata
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Bigdata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../airflow/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Airflow
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Airflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cdh/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cdh
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Cdh
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Clickhouse
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Clickhouse
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ClickHouse 笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../datax/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Datax
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Datax
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../doris/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Doris
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Doris
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../flink/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Flink
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_7" id="__nav_5_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Flink
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../flink/Flink%20on%20Kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flink on Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../flink/flink-cdc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flink CDC
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../flume/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Flume
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_8" id="__nav_5_8_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Flume
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../flume/Flume%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flume 笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../greenplum/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Greenplum
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            Greenplum
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hadoop/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_10" id="__nav_5_10_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hadoop 3.3.1 安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hadoop/hdfs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hdfs
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_3">
            <span class="md-nav__icon md-icon"></span>
            Hdfs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hadoop/map-reduce/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Map reduce
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_4">
            <span class="md-nav__icon md-icon"></span>
            Map reduce
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hadoop/yarn/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Yarn
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_5">
            <span class="md-nav__icon md-icon"></span>
            Yarn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hbase/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hbase
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_11" id="__nav_5_11_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            Hbase
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hbase 2.3.6 安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hdp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hdp
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            Hdp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hive/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hive
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_13" id="__nav_5_13_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            Hive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive on Spark 搭建
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/Hive%20%E6%A0%B9%E6%8D%AE%E5%85%83%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive 根据元数据查询表结构信息
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/Hive%20%E7%BB%9F%E8%AE%A1%E5%90%84%E5%88%86%E5%8C%BA%E6%95%B0%E6%8D%AE%E9%87%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive 统计各分区数据量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive 行列转换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hive 2.3.9 安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../phoenix/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Phoenix
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_14">
            <span class="md-nav__icon md-icon"></span>
            Phoenix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_15" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Spark
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_15" id="__nav_5_15_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_15">
            <span class="md-nav__icon md-icon"></span>
            Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Spark%20on%20Kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark on Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Spark 笔记
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Spark 笔记
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark" class="md-nav__link">
    <span class="md-ellipsis">
      一、Spark 运行架构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、Spark 运行架构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 运行架构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 核心组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 核心组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-driver" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 Driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-executor" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 Executor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-master-worker" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.3 Master &amp; Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-applicationmaster" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.4 ApplicationMaster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 核心概念
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.3 核心概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-executor" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.1 Executor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.2 并行度（Parallelism）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-dag" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.3 有向无环图（DAG）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 提交流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 提交流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-yarn-client" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 Yarn Client 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-yarn-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 Yarn Cluster 模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_1" class="md-nav__link">
    <span class="md-ellipsis">
      二、Spark 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、Spark 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 RDD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 RDD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.1 什么是 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.2 执行原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3 基础编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1.3 基础编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2131-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.1 RDD 创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2132-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.2 RDD 并行度与分区
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2133-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.3 RDD 转换算子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2134" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.4 案例实操
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2135-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.5 RDD 行动算子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2136-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.6 RDD 序列化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2137-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.7 RDD 依赖关系
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5148-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.4.8 RDD 持久化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2139-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.9 RDD 分区器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21310-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.10 RDD 文件读取与保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 累加器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 累加器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 实现原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 基础编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.2 基础编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2.1 系统累加器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2.2 自定义累加器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 广播变量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 广播变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 实现原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 基础编程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      三、案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-top10" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 需求一：Top10 热门品类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-top10-top10" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 需求二：Top10 热门品类中每个品类的 Top10 活跃会话统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 需求三：页面单跳转化率统计
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 需求三：页面单跳转化率统计">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.1 需求说明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.2 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql" class="md-nav__link">
    <span class="md-ellipsis">
      四、Spark SQL 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、Spark SQL 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-spark-sql" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Spark SQL 是什么
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 DataFrame 是什么
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 DataSet 是什么
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql_1" class="md-nav__link">
    <span class="md-ellipsis">
      五、Spark SQL 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、Spark SQL 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 新的起点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 DataFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 DataFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.1 创建 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-rdd-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.2 RDD 转换为 DataFrame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-dataframe-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.3 DataFrame 转换为 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 DataSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 DataSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.1 创建 DataSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-rdd-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.2 RDD 转换为 DataSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-dataset-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.3 DataSet 转换为 RDD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-dataframe-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 DataFrame 和 DataSet 转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-rdddataframedataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 RDD、DataFrame、DataSet 三者的关系
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.5 RDD、DataFrame、DataSet 三者的关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#551" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.1 三者的共性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#552" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2 三者的区别
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.5.2 三者的区别">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5521-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.1 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5522-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.2 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5523-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.3 DataSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56" class="md-nav__link">
    <span class="md-ellipsis">
      5.6 用户自定义函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.6 用户自定义函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#561-udf" class="md-nav__link">
    <span class="md-ellipsis">
      5.6.1 UDF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#562-udaf" class="md-nav__link">
    <span class="md-ellipsis">
      5.6.2 UDAF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57" class="md-nav__link">
    <span class="md-ellipsis">
      5.7 数据的加载和保存
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.7 数据的加载和保存">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#571" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.1 通用的加载和保存方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#572-parquet" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.2 Parquet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#573-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3 Hive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.7.3 Hive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5731-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.1 外部 Hive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5732-spark-beeline" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.2 运行 Spark beeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5733-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.3 代码操作 Hive
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql_2" class="md-nav__link">
    <span class="md-ellipsis">
      六、Spark SQL 项目实战
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、Spark SQL 项目实战">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 数据准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-top3" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 需求（各区域热门商品 Top3）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 需求（各区域热门商品 Top3）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.1 需求简介
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.2 需求分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      七、Spark Streaming 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="七、Spark Streaming 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-spark-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 Spark Streaming 是什么
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming_1" class="md-nav__link">
    <span class="md-ellipsis">
      八、Spark Streaming 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="八、Spark Streaming 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 依赖
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-dsteam" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 DSteam 创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.2 DSteam 创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#821-socket" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.1 Socket 数据源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#822-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.2 RDD 队列
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#823-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.3 Kafka 数据源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#824" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.4 自定义数据源
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-dstream" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 DStream 转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3 DStream 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1 无状态转换操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3.1 无状态转换操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8311-transform" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1.1 Transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8312-join" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1.2 join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#832" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.2 有状态转换操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3.2 有状态转换操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8321-updatestatebykey" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.2.1 updateStateByKey
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833-window-operations" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.3 Window Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-dstream" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 DStream 输出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 优雅关闭
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming_2" class="md-nav__link">
    <span class="md-ellipsis">
      九、Spark Streaming 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="九、Spark Streaming 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 环境准备
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 环境准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 数据生成工具类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 数据库操作工具类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 需求一（广告黑名单）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 需求一（广告黑名单）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 思路分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 MySQL 建表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93" class="md-nav__link">
    <span class="md-ellipsis">
      9.3 需求二（广告点击量实时统计）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3 需求二（广告点击量实时统计）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931_2" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 思路分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-mysql_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 MySQL 建表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94" class="md-nav__link">
    <span class="md-ellipsis">
      9.4 最近一分钟广告点击量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.4 最近一分钟广告点击量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#941" class="md-nav__link">
    <span class="md-ellipsis">
      9.4.1 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../sqoop/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Sqoop
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_16">
            <span class="md-nav__icon md-icon"></span>
            Sqoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_17" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../zookeeper/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Zookeeper
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_17" id="__nav_5_17_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_17">
            <span class="md-nav__icon md-icon"></span>
            Zookeeper
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../zookeeper/zookeeper-3.6.3%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zookeeper 3.6.3 安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../build-tool/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Build tool
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Build tool
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../build-tool/gradle/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Gradle
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Gradle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../build-tool/maven/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Maven
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Maven
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cloud native
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Cloud native
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab CI 集成 Nexus 和 Harbor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通过 CoreDNS + ETCD + ExternalDNS 打通内网 Ingress 域名访问
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/containerd/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Containerd
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Containerd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/docker/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Docker
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/docker/build-minio-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构建 MinIO 镜像
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/helm/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Helm
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            Helm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/istio/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Istio
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            Istio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/k3s/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    K3s
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            K3s
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/k3s/nfs-dynamic-pvc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NFS 动态 PVC 的 StorageClass 和 StatefulSet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    离线安装 K3S
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/knative/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Knative
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            Knative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/kubekey/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kubekey
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            Kubekey
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../cloud-native/kubernetes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_11" id="__nav_7_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_11">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/kubernetes/K8S%20%E4%BF%AE%E6%94%B9%20NodePort%20%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8S 修改 NodePort 端口范围
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes 笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install kubernetes on ubuntu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Container app
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Container app
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/clash/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Clash
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Clash
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/coredns/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coredns
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Coredns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/dolphinscheduler/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Dolphinscheduler
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Dolphinscheduler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/doris/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Doris
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Doris
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/elasticsearch/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Elasticsearch
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            Elasticsearch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/etcd/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Etcd
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_6">
            <span class="md-nav__icon md-icon"></span>
            Etcd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/external-dns/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    External dns
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7">
            <span class="md-nav__icon md-icon"></span>
            External dns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/gitlab/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Gitlab
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8">
            <span class="md-nav__icon md-icon"></span>
            Gitlab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/grafana/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Grafana
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_9">
            <span class="md-nav__icon md-icon"></span>
            Grafana
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/greenplum/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Greenplum
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_10">
            <span class="md-nav__icon md-icon"></span>
            Greenplum
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/harbor/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Harbor
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_11">
            <span class="md-nav__icon md-icon"></span>
            Harbor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/influxdb/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Influxdb
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_12">
            <span class="md-nav__icon md-icon"></span>
            Influxdb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/jenkins/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Jenkins
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_13">
            <span class="md-nav__icon md-icon"></span>
            Jenkins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/kafka/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kafka
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_14">
            <span class="md-nav__icon md-icon"></span>
            Kafka
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/longhorn/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Longhorn
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_15">
            <span class="md-nav__icon md-icon"></span>
            Longhorn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/metallb/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Metallb
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_16">
            <span class="md-nav__icon md-icon"></span>
            Metallb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_17" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/mongodb/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mongodb
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_17">
            <span class="md-nav__icon md-icon"></span>
            Mongodb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_18" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/mysql/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mysql
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_18">
            <span class="md-nav__icon md-icon"></span>
            Mysql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_19" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/nexus/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Nexus
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_19">
            <span class="md-nav__icon md-icon"></span>
            Nexus
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_20" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/nginx-ingress-controller/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Nginx ingress controller
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_20">
            <span class="md-nav__icon md-icon"></span>
            Nginx ingress controller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_21" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/openebs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Openebs
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_21">
            <span class="md-nav__icon md-icon"></span>
            Openebs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_22" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/opengauss/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Opengauss
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_22">
            <span class="md-nav__icon md-icon"></span>
            Opengauss
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_23" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/oracle/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Oracle
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_23">
            <span class="md-nav__icon md-icon"></span>
            Oracle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_24" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/postgresql/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Postgresql
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_24">
            <span class="md-nav__icon md-icon"></span>
            Postgresql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_25" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/prometheus/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_25">
            <span class="md-nav__icon md-icon"></span>
            Prometheus
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_26" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/redis/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Redis
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_26">
            <span class="md-nav__icon md-icon"></span>
            Redis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_27" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/shardingsphere-proxy/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Shardingsphere proxy
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_27_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_27">
            <span class="md-nav__icon md-icon"></span>
            Shardingsphere proxy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_28" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../container-app/traefik/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Traefik
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_28_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_28">
            <span class="md-nav__icon md-icon"></span>
            Traefik
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../data-structure/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data structure
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Data structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Database
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/db2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Db2
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            Db2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/etcd/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Etcd
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            Etcd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/mysql/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mysql
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            Mysql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/mysql%20group%20replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mysql group replication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/query-cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/transaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transaction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常用命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4_10" >
        
          
          <label class="md-nav__link" for="__nav_10_4_10" id="__nav_10_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
      guide  
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4_10">
            <span class="md-nav__icon md-icon"></span>
              guide  
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/__guide__/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/mysql/__guide__/2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/neo4j/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Neo4j
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_5">
            <span class="md-nav__icon md-icon"></span>
            Neo4j
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/oceanbase/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Oceanbase
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_6">
            <span class="md-nav__icon md-icon"></span>
            Oceanbase
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OceanBase 笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/opengauss/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Opengauss
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            Opengauss
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/oracle/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Oracle
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_8">
            <span class="md-nav__icon md-icon"></span>
            Oracle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/postgresql/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Postgresql
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_9" id="__nav_10_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_9">
            <span class="md-nav__icon md-icon"></span>
            Postgresql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/postgresql/CHAR%20%E5%92%8C%20VARCHAR%20%E5%92%8C%20TEXT%20%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CHAR 和 VARCHAR 和 TEXT 类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PawSQL 重写规则
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/redis/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Redis
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10_10" id="__nav_10_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_10">
            <span class="md-nav__icon md-icon"></span>
            Redis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis 哨兵模式模式与集群模式搭建
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../database/sqlserver/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Sqlserver
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_11">
            <span class="md-nav__icon md-icon"></span>
            Sqlserver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../frontend/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Frontend
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    浏览器渲染原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../frontend/qt/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Qt
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            Qt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/qt/Qt%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Qt 笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../frontend/uniapp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Uniapp
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_4">
            <span class="md-nav__icon md-icon"></span>
            Uniapp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../frontend/vue/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Vue
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_5">
            <span class="md-nav__icon md-icon"></span>
            Vue
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../hardware/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hardware
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../hardware/ibmc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ibmc
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_2">
            <span class="md-nav__icon md-icon"></span>
            Ibmc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Lang
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Lang
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/cpp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cpp
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13_2" id="__nav_13_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_2">
            <span class="md-nav__icon md-icon"></span>
            Cpp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/cpp/C%20%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E5%BF%85%E5%A4%87%E7%9A%84%2018%20%E4%B8%AA%E7%BB%8F%E5%85%B8%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C 语言入门必备的 18 个经典程序
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/go/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Go
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_3">
            <span class="md-nav__icon md-icon"></span>
            Go
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/java/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Java
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13_4" id="__nav_13_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_4">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/EasyExcel%20%E5%AF%BC%E5%87%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EasyExcel 导出
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/%E5%8A%A8%E6%80%81%E5%8E%BB%E9%87%8D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态去重
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/%E5%8E%9F%E7%94%9F%20POI%20Excel%20%E5%A4%9A%20Sheet%20%E9%A1%B5%E5%AF%BC%E5%87%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    原生 POI Excel 多 Sheet 页导出
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_4_5" >
        
          
          <label class="md-nav__link" for="__nav_13_4_5" id="__nav_13_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
      guide  
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_4_5">
            <span class="md-nav__icon md-icon"></span>
              guide  
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/__guide__/Java%20IO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 多线程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/__guide__/Java%20%E9%9B%86%E5%90%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 集合
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java/__guide__/jvm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jvm
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_4_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/java/jna/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Jna
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_4_6">
            <span class="md-nav__icon md-icon"></span>
            Jna
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/java/servlet/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Servlet
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_4_7">
            <span class="md-nav__icon md-icon"></span>
            Servlet
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/javascript/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Javascript
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13_5" id="__nav_13_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_5">
            <span class="md-nav__icon md-icon"></span>
            Javascript
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/TypeScript%20%2B%20pkg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TypeScript + pkg
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/fnm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fnm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    N
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/npm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Npm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/%E8%A1%A8%E6%A0%BC%E5%88%97%E5%90%8D%E8%BD%AC%E5%BA%8F%E5%8F%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    表格列名转序号
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE%E5%85%9C%E5%BA%95%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    表格数据兜底处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/javascript/%E9%80%92%E5%BD%92%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    递归处理文件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/latex/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Latex
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_6">
            <span class="md-nav__icon md-icon"></span>
            Latex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/python/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Python
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13_7" id="__nav_13_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_7">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python/pip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python/ubuntu22.04%20%E5%AE%89%E8%A3%85%20python2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu22.04 安装 python2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python/%E8%A3%85%E9%A5%B0%E5%99%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    装饰器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/regexp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Regexp
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_8">
            <span class="md-nav__icon md-icon"></span>
            Regexp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/rust/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Rust
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_9">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/scala/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Scala
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_10">
            <span class="md-nav__icon md-icon"></span>
            Scala
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../lang/typescript/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Typescript
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_11">
            <span class="md-nav__icon md-icon"></span>
            Typescript
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_12" >
        
          
          <label class="md-nav__link" for="__nav_13_12" id="__nav_13_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Yaml
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_12">
            <span class="md-nav__icon md-icon"></span>
            Yaml
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/yaml/REAEME/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yaml
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../load-balance/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Load balance
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_14" id="__nav_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Load balance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../load-balance/nginx/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_14_2" id="__nav_14_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_14_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14_2">
            <span class="md-nav__icon md-icon"></span>
            Nginx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../load-balance/nginx/%E6%9C%80%E7%AE%80%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最简配置
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_15" id="__nav_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Middleware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/canal/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Canal
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_2">
            <span class="md-nav__icon md-icon"></span>
            Canal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/kafka/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Kafka
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_15_3" id="__nav_15_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_3">
            <span class="md-nav__icon md-icon"></span>
            Kafka
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka 笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../middleware/kafka/kafka-3%20kraft%20%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kafka 3 kraft 模式安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/mycat2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mycat2
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_4">
            <span class="md-nav__icon md-icon"></span>
            Mycat2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/rabbitmq/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Rabbitmq
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_15_5" id="__nav_15_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_5">
            <span class="md-nav__icon md-icon"></span>
            Rabbitmq
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RabbitMQ 笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../middleware/shardingsphere/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Shardingsphere
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_6">
            <span class="md-nav__icon md-icon"></span>
            Shardingsphere
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../monitoring/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_16" id="__nav_16_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../monitoring/Telegraf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telegraf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../network/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Network
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Network
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Os
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18" id="__nav_18_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Os
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/android/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Android
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18_2" id="__nav_18_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_2">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/android/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    环境配置
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/ftp/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ftp
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_3">
            <span class="md-nav__icon md-icon"></span>
            Ftp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18_4" id="__nav_18_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/Bash%20%E8%8E%B7%E5%8F%96%20GitHub%20%E6%9C%80%E6%96%B0%20Release%20%E7%89%88%E6%9C%AC%E5%8F%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bash 获取 GitHub 最新 Release 版本号
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/ClamAV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ClamAV
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/Linux%20%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E5%91%BD%E4%BB%A4%20ps%20aux%20%E5%92%8C%20ps%20-ef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux 查看进程命令 ps aux 和 ps  ef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/SSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/ZSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/clean-dangling-symbolic-links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    清理无效软链接
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/curl%20%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%A0%E9%80%92%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%82%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Curl 执行脚本时传递环境变量和参数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/nohup%20%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B%E5%90%8E%E4%BF%9D%E5%AD%98%E8%BF%9B%E7%A8%8B%E5%8F%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nohup 启动进程后保存进程号
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常用命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    磁盘扩容
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/archlinux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Archlinux
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_14">
            <span class="md-nav__icon md-icon"></span>
            Archlinux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/centos/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Centos
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18_4_15" id="__nav_18_4_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_15">
            <span class="md-nav__icon md-icon"></span>
            Centos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/centos/install%20centos-7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install centos 7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/centos/install-centos-stream-9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install centos stream 9
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/debian/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Debian
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_16">
            <span class="md-nav__icon md-icon"></span>
            Debian
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_17" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/manjaro/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Manjaro
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18_4_17" id="__nav_18_4_17_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_17">
            <span class="md-nav__icon md-icon"></span>
            Manjaro
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/linux/manjaro/manjaro-kde%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manjaro kde 安装
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_18" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/shell/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Shell
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_18">
            <span class="md-nav__icon md-icon"></span>
            Shell
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_4_19" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/linux/ubuntu/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ubuntu
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_18_4_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_4_19">
            <span class="md-nav__icon md-icon"></span>
            Ubuntu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/mac/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Mac
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_18_5" id="__nav_18_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_5">
            <span class="md-nav__icon md-icon"></span>
            Mac
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/mac/homebrew/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homebrew
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/mac/uninstall-python-on-mac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    在 Mac 上卸载 Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内置命令行图片处理工具 sips
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    命令行工具
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_6" >
        
          
          <label class="md-nav__link" for="__nav_18_6" id="__nav_18_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ntp
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_6">
            <span class="md-nav__icon md-icon"></span>
            Ntp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/ntp/%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    时间服务器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../os/win/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Win
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18_7">
            <span class="md-nav__icon md-icon"></span>
            Win
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Software
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_19" id="__nav_19_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/dbeaver/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Dbeaver
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_2">
            <span class="md-nav__icon md-icon"></span>
            Dbeaver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/dock-view/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Dock view
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_3">
            <span class="md-nav__icon md-icon"></span>
            Dock view
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/excel/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Excel
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_4">
            <span class="md-nav__icon md-icon"></span>
            Excel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/parallels-desktop/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Parallels desktop
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_5">
            <span class="md-nav__icon md-icon"></span>
            Parallels desktop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/virtualbox/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Virtualbox
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_6">
            <span class="md-nav__icon md-icon"></span>
            Virtualbox
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/vmware/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Vmware
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_7">
            <span class="md-nav__icon md-icon"></span>
            Vmware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../software/wsl/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Wsl
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_19_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19_8">
            <span class="md-nav__icon md-icon"></span>
            Wsl
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../version-control/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Version control
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_20" id="__nav_20_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_20">
            <span class="md-nav__icon md-icon"></span>
            Version control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../version-control/git/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Git
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_20_2" id="__nav_20_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_20_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_20_2">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../version-control/git/Git%20%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git 笔记
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 下 Git 换行符配置
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark" class="md-nav__link">
    <span class="md-ellipsis">
      一、Spark 运行架构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、Spark 运行架构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 运行架构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 核心组件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 核心组件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-driver" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 Driver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-executor" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 Executor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-master-worker" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.3 Master &amp; Worker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-applicationmaster" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.4 ApplicationMaster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 核心概念
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.3 核心概念">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-executor" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.1 Executor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.2 并行度（Parallelism）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-dag" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.3 有向无环图（DAG）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 提交流程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 提交流程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-yarn-client" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 Yarn Client 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-yarn-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 Yarn Cluster 模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_1" class="md-nav__link">
    <span class="md-ellipsis">
      二、Spark 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、Spark 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 RDD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 RDD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.1 什么是 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.2 执行原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3 基础编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1.3 基础编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2131-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.1 RDD 创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2132-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.2 RDD 并行度与分区
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2133-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.3 RDD 转换算子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2134" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.4 案例实操
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2135-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.5 RDD 行动算子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2136-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.6 RDD 序列化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2137-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.7 RDD 依赖关系
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5148-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.1.4.8 RDD 持久化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2139-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.9 RDD 分区器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21310-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.3.10 RDD 文件读取与保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 累加器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 累加器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1 实现原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 基础编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2.2 基础编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2221" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2.1 系统累加器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2222" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2.2 自定义累加器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 广播变量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 广播变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 实现原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 基础编程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      三、案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-top10" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 需求一：Top10 热门品类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-top10-top10" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 需求二：Top10 热门品类中每个品类的 Top10 活跃会话统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 需求三：页面单跳转化率统计
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 需求三：页面单跳转化率统计">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.1 需求说明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" class="md-nav__link">
    <span class="md-ellipsis">
      3.3.2 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql" class="md-nav__link">
    <span class="md-ellipsis">
      四、Spark SQL 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、Spark SQL 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-spark-sql" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Spark SQL 是什么
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 DataFrame 是什么
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 DataSet 是什么
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql_1" class="md-nav__link">
    <span class="md-ellipsis">
      五、Spark SQL 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、Spark SQL 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 新的起点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 DataFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 DataFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.1 创建 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-rdd-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.2 RDD 转换为 DataFrame
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-dataframe-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.2.3 DataFrame 转换为 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 DataSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 DataSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.1 创建 DataSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-rdd-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.2 RDD 转换为 DataSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-dataset-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.3.3 DataSet 转换为 RDD
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-dataframe-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 DataFrame 和 DataSet 转换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-rdddataframedataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 RDD、DataFrame、DataSet 三者的关系
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.5 RDD、DataFrame、DataSet 三者的关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#551" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.1 三者的共性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#552" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2 三者的区别
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.5.2 三者的区别">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5521-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.1 RDD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5522-dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.2 DataFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5523-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      5.5.2.3 DataSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56" class="md-nav__link">
    <span class="md-ellipsis">
      5.6 用户自定义函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.6 用户自定义函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#561-udf" class="md-nav__link">
    <span class="md-ellipsis">
      5.6.1 UDF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#562-udaf" class="md-nav__link">
    <span class="md-ellipsis">
      5.6.2 UDAF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57" class="md-nav__link">
    <span class="md-ellipsis">
      5.7 数据的加载和保存
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.7 数据的加载和保存">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#571" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.1 通用的加载和保存方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#572-parquet" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.2 Parquet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#573-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3 Hive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.7.3 Hive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5731-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.1 外部 Hive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5732-spark-beeline" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.2 运行 Spark beeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5733-hive" class="md-nav__link">
    <span class="md-ellipsis">
      5.7.3.3 代码操作 Hive
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-sql_2" class="md-nav__link">
    <span class="md-ellipsis">
      六、Spark SQL 项目实战
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、Spark SQL 项目实战">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 数据准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-top3" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 需求（各区域热门商品 Top3）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 需求（各区域热门商品 Top3）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.1 需求简介
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.2 需求分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      七、Spark Streaming 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="七、Spark Streaming 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-spark-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 Spark Streaming 是什么
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming_1" class="md-nav__link">
    <span class="md-ellipsis">
      八、Spark Streaming 核心编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="八、Spark Streaming 核心编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 依赖
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-dsteam" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 DSteam 创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.2 DSteam 创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#821-socket" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.1 Socket 数据源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#822-rdd" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.2 RDD 队列
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#823-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.3 Kafka 数据源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#824" class="md-nav__link">
    <span class="md-ellipsis">
      8.2.4 自定义数据源
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-dstream" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 DStream 转换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3 DStream 转换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1 无状态转换操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3.1 无状态转换操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8311-transform" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1.1 Transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8312-join" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.1.2 join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#832" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.2 有状态转换操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3.2 有状态转换操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8321-updatestatebykey" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.2.1 updateStateByKey
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833-window-operations" class="md-nav__link">
    <span class="md-ellipsis">
      8.3.3 Window Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-dstream" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 DStream 输出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 优雅关闭
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark-streaming_2" class="md-nav__link">
    <span class="md-ellipsis">
      九、Spark Streaming 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="九、Spark Streaming 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 环境准备
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 环境准备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 数据生成工具类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 数据库操作工具类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 需求一（广告黑名单）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 需求一（广告黑名单）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 思路分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 MySQL 建表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93" class="md-nav__link">
    <span class="md-ellipsis">
      9.3 需求二（广告点击量实时统计）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3 需求二（广告点击量实时统计）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931_2" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 思路分析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932-mysql_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 MySQL 建表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933_1" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94" class="md-nav__link">
    <span class="md-ellipsis">
      9.4 最近一分钟广告点击量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.4 最近一分钟广告点击量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#941" class="md-nav__link">
    <span class="md-ellipsis">
      9.4.1 功能实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Spark 笔记</h1>

<h2 id="spark">一、Spark 运行架构<a class="headerlink" href="#spark" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 运行架构<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<p>Spark 框架的核心是一个计算引擎，整体来说，它采用了标准的 master-slave 的结构。</p>
<p>如下图所示，它展示了一个 Spark 执行时的基本结构。图形中的 Driver 表示 master，负责整个集群中的作业任务调度，图形中的 Executor 则是 slave，负责实际执行任务。</p>
<p><img alt="" src="https://spark.apache.org/docs/latest/img/cluster-overview.png" /></p>
<p><br/></p>
<h3 id="12">1.2 核心组件<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<p>右上图可以看出，对于 Spark 框架有两个核心组件：</p>
<h4 id="121-driver">1.2.1 Driver<a class="headerlink" href="#121-driver" title="Permanent link">&para;</a></h4>
<p>Spark 驱动器节点，用于执行 Spark 任务中的 main 方法，负责实际代码的执行工作。Driver 在 Spark 作业执行时主要负责：</p>
<ul>
<li>将用户程序转化为作业（job）</li>
<li>在 Executor 之间调度任务（task）</li>
<li>跟踪 Executor 的执行情况</li>
<li>通过 UI 展示查询运行情况</li>
</ul>
<p>实际上，我们无法准确地描述 Driver 的定义，因为在整个的编程过程中没有看到任何有关的 Driver 的字眼。所以简单理解，所谓的 Driver 就是驱动整个应用运行起来的程序，也称之为 Driver 类。</p>
<h4 id="122-executor">1.2.2 Executor<a class="headerlink" href="#122-executor" title="Permanent link">&para;</a></h4>
<p>Spark Executor 是集群中工作节点（Worker）中的一个 JVM 进程，负责在 Spark 作业中运行具体任务（Task），任务彼此之间相互独立。Spark 应用启动时，Executor 节点被同时启动，并且始终伴随着整个 Spark 应用的生命周期而存在。如果有 Executor 节点发生了故障或崩溃，Spark 应用也可以继续执行，会将出错节点上的任务调度到其它 Executor 节点上继续运行。</p>
<p>Executor 有两个核心功能：</p>
<ul>
<li>负责运行组成 Spark 应用的任务，并将结果返回给启动器进程</li>
<li>它们通过自身的块管理器（Block Manager）为用户程序中要求缓存的 RDD 提供内存式存储。RDD 是直接缓存在 Executor 进程内的，因此任务可以在运行时充分利用缓存数据加速运算。</li>
</ul>
<h4 id="123-master-worker">1.2.3 Master &amp; Worker<a class="headerlink" href="#123-master-worker" title="Permanent link">&para;</a></h4>
<p>Spark 集群的独立部署环境中，不需要依赖其它的资源调度框架，自身就实现了资源调度的功能，所以环境中还有其它两个核心组件：Master 和 Worker，这里的 Master 是一个进程，主要负责资源的调度和分配，并进行集群的监控等职责，类似于 Yarn 环境中的 RM，而 Worker 呢，也是进程，一个 Worker 运行在集群中的一台服务器上，由 Master 分配资源对数据进行并行的处理和计算，类似于 Yarn 环境中的 NM。</p>
<h4 id="124-applicationmaster">1.2.4 ApplicationMaster<a class="headerlink" href="#124-applicationmaster" title="Permanent link">&para;</a></h4>
<p>Hadoop 用户向 Yarn 集群提交应用程序时，提交程序中应该包含 ApplicationMaster，用于向资源调度器申请执行任务的资源容器 Container，运行用户自己的程序任务 Job，监控整个任务的执行，跟踪整个任务的状态，处理任务失败等异常情况。</p>
<p>说的简单点就是， ResourceManager（资源）和 Driver（计算）之间的解耦合靠的就是 ApplicationMaster。</p>
<p><br/></p>
<h3 id="13">1.3 核心概念<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<h4 id="131-executor">1.3.1 Executor<a class="headerlink" href="#131-executor" title="Permanent link">&para;</a></h4>
<p>Spark Executor 是集群中运行在工作节点（Worker）中的一个 JVM 进程，是整个集群中的专门用于计算的节点。在提交应用中，可以提供参数指定计算节点的个数，以及对应的资源。这里的资源一般指的是工作节点 Executor 的内存和使用的虚拟 CPU 核数量。</p>
<p>应用程序相关启动参数如下：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--num-executors</code></td>
<td>配置 Executor 的数量</td>
</tr>
<tr>
<td><code>--executor-memory</code></td>
<td>配置每个 Executor 的内存大小</td>
</tr>
<tr>
<td><code>--executor-cores</code></td>
<td>配置每个 Executor 的虚拟 CPU 核数量</td>
</tr>
</tbody>
</table>
<h4 id="132-parallelism">1.3.2 并行度（Parallelism）<a class="headerlink" href="#132-parallelism" title="Permanent link">&para;</a></h4>
<p>在分布式计算框架中一般都是多个任务同时执行，由于任务分布在不同的计算节点进行计算，所以能够真正地实现多任务并行执行，记住，这里是并行，而不是并发。这里我们将整个集群并行执行任务的数量称之为并行度。那么一个作业到底并行度是多少呢？这个取决于框架的默认配置。应用程序也可以在运行过程中动态修改。</p>
<h4 id="133-dag">1.3.3 有向无环图（DAG）<a class="headerlink" href="#133-dag" title="Permanent link">&para;</a></h4>
<p>大数据计算引擎框架我们根据使用方式的不同一般会分为四类，其中有一类就是 Hadoop 所承载的 MapReduce，它将计算分为两个阶段，分为 Map 阶段和 Reduce 阶段。对于上层应用来说，就不得不想方设法去拆分算法，甚至于不得不在上层时下你多个 Job 的串联，以完成一个完整的算法，例如迭代计算。由于这样的弊端，催生了支持 DAG 框架的产生。因此，支持 DAG 的框架被划分为第二代计算引擎，如 Tez 以及更上层的 Oozie。这里我们不去细究各种 DAG 实现之间的区别，不过对于当时的 Tez 和 Oozie 来说，大多还是批处理的任务。接下来就是以 Spark 为代表的第三代的计算引擎。第三点计算引擎的特点主要是 Job 内部的 DAG 支持（不跨越 Job），以及实时计算。</p>
<p>这里所谓的有向无环图，并不是真正意义上的图形，而是由 Spark 程序直接映射成的数据流的高级抽象面模型。简单理解就是将整个程序计算的执行过程用图形表示出来哦，这样更直观，更便于理解，可以用于表示程序的拓扑结构。</p>
<p>DAG（Directed Acyclic Graph）有向无环图是由点和县组成的拓扑图形，该图形具有方向，不会闭环。</p>
<p><br/></p>
<h3 id="14">1.4 提交流程<a class="headerlink" href="#14" title="Permanent link">&para;</a></h3>
<p>所谓的提交流程，其实就是我们开发人员根据需求写的应用程序通过 Spark 客户端提交 Spark 运行环境执行计算的流程。在不同的部署环境中，这个提交过程基本相同人，但是又有细微的区别，我们这里不进行详细的比较，但是因为国内工作中，将 Spark 应用部署到 Yarn 环境中会更多一些，所以后续的提交流程都是基于 Yarn 环境的。</p>
<p>Spark 应用程序提交到 Yarn 环境中执行的时候，一般会有两种部署执行的方式：Client 和 Cluster。两种模式主要区别在于：Driver 程序的运行节点位置。</p>
<h4 id="141-yarn-client">1.4.1 Yarn Client 模式<a class="headerlink" href="#141-yarn-client" title="Permanent link">&para;</a></h4>
<p>Client 模式将用于监控和调度的 Driver 模块在客户端执行，而不是在 Yarn 中，所以一般用于测试。</p>
<ul>
<li>Driver 在任务提交的本地机器上运行</li>
<li>Driver 启动后会和 ResourceManager 通讯申请启动 ApplicationMaster</li>
<li>ResourceManager 分配 Container，在合适的 NodeManager 上启动 ApplicationMaster，负责向 ResourceManager 申请 Executor 内存</li>
<li>ResourceManager 接到 ApplicationMaster 的资源申请后会分配 Container，然后 ApplicationMaster 在资源分配指定的 NodeManager 上启动 Executor 进程</li>
<li>Executor 进程启动后会向 Driver 反向注册，Executor 全部注册完成后 Driver 开始执行 main 函数</li>
<li>之后执行到 Action 算子时，触发一个 Job，并根据宽依赖开始划分 stage，每个 stage 生成对应的 TaskSet，之后将 Task 分发到各个 Executor 上执行。</li>
</ul>
<h4 id="142-yarn-cluster">1.4.2 Yarn Cluster 模式<a class="headerlink" href="#142-yarn-cluster" title="Permanent link">&para;</a></h4>
<p>Cluster 模式将用于监控和调度的 Driver 模块启动在 Yarn 集群资源中执行。一般应用于实际生产环境。</p>
<ul>
<li>在 Yarn Cluster 模式下，任务提交后会和 ResourceManager 通讯申请启动 ApplicationMaster</li>
<li>随后 ResourceManager 分配 Container，在合适的 NodeManager 上启动 ApplicationMaster，此时的 ApplicationMaster 就是 Driver</li>
<li>Driver 启动后向 ResourceManager 申请 Executor 内存，ResourceManager 接到 ApplicationMaster 的资源申请后会分配 Container，然后在合适的 NodeManager 上启动 Executor 进程</li>
<li>Executor 进程启动后会向 Driver 反向注册，Executor 全部注册后 Driver 开始执行 main 函数</li>
<li>之后执行到 Action 算子时，触发一个 Job，并根据宽依赖开发划分 stage，每个 stage 生成对应的 TaskSet，之后将 Task 分发到各个 Executor 上执行。</li>
</ul>
<p><br/><br/></p>
<h2 id="spark_1">二、Spark 核心编程<a class="headerlink" href="#spark_1" title="Permanent link">&para;</a></h2>
<p>Spark 计算框架为了能够进行高并发和高吞吐的数据处理，封装了三大数据结构，用于处理不同的应用场景。三大数据结构分别是：</p>
<ul>
<li>RDD：弹性分布式数据集</li>
<li>累加器：分布式共享只写变量</li>
<li>广播变量：分布式共享只读变量</li>
</ul>
<p><br/></p>
<h3 id="21-rdd">2.1 RDD<a class="headerlink" href="#21-rdd" title="Permanent link">&para;</a></h3>
<h4 id="211-rdd">2.1.1 什么是 RDD<a class="headerlink" href="#211-rdd" title="Permanent link">&para;</a></h4>
<p>RDD（Resilient Distributed Dataset）叫做弹性分布式数据集，是 Spark 中最基本的数据处理模型。代码中是一个抽象类，它代表一个弹性、不可变、可分区、里面的元素可并行计算的计算。</p>
<ul>
<li>弹性<ul>
<li>存储的弹性：内存与磁盘的自动切换</li>
<li>容错的弹性：数据丢失可以自动恢复</li>
<li>计算的弹性：计算出错重试机制</li>
<li>分片的弹性：可根据需要重新分片</li>
</ul>
</li>
<li>分布式：数据存储在大数据集群不同节点上</li>
<li>数据集：RDD 封装了计算逻辑，并不保存数据</li>
<li>数据抽象：RDD 是一个抽象类，需要子类具体实现</li>
<li>不可变：RDD 封装了计算逻辑，是不可以改变的，想要改变，只能产生新的 RDD，在新的 RDD 里面封装计算逻辑</li>
<li>可分区：并行计算</li>
</ul>
<h4 id="212">2.1.2 执行原理<a class="headerlink" href="#212" title="Permanent link">&para;</a></h4>
<p>从计算的角度来讲，数据处理过程中需要计算资源（内存 &amp; CPU）和计算模型（逻辑）。执行时，需要将计算资源和计算模型进行协调和整合。</p>
<p>Spark 框架在执行时，先申请内存，然后将应用程度的数据处理逻辑分解成一个一个的计算任务。然后将任务发到已经分配资源的计算节点上，按照指定的计算模型进行数据计算，最后得到计算结果。</p>
<h4 id="213">2.1.3 基础编程<a class="headerlink" href="#213" title="Permanent link">&para;</a></h4>
<h5 id="2131-rdd">2.1.3.1 RDD 创建<a class="headerlink" href="#2131-rdd" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>从集合（内存）创建 RDD</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="n">rdd1</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="n">rdd2</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>从文件（外部存储）创建 RDD</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;pom.xml&quot;</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">rdd</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>从其它 RDD 创建</p>
<p>主要是通过一个 RDD 运算完后，再产生新的 RDD。</p>
</li>
<li>
<p>直接创建 RDD</p>
<p>使用 <code>new</code> 的方式直接构造 RDD，一般由 Spark 框架自身使用。</p>
</li>
</ol>
<h5 id="2132-rdd">2.1.3.2 RDD 并行度与分区<a class="headerlink" href="#2132-rdd" title="Permanent link">&para;</a></h5>
<p>默认情况下，Spark 可以将一个作业切分多个任务后，发送给 Executor 节点并行计算，而能够并行计算的任务数量我们称之为并行度。这个数量可以在构建 RDD 时指定。记住，这里的并行执行的任务数量，并不是指的切分任务的数量，不要混淆了。</p>
<h5 id="2133-rdd">2.1.3.3 RDD 转换算子<a class="headerlink" href="#2133-rdd" title="Permanent link">&para;</a></h5>
<p>RDD 根据数据处理方式的不同将算子整体上分为 Value 类型、双 Value 类型和 Key-Value 类型。</p>
<ul>
<li>
<p>Value 类型</p>
<ol>
<li>
<p><code>map</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">U</span><span class="p">]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>mapPartitions</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">mapPartitions</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">U</span><span class="p">],</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="n">preservesPartitioning</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">U</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将待处理的数据以分区为单位发送到计算节点进行处理，这里的处理是指可以进行任意的处理，哪怕是过滤数据。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">mapPartitions</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</span></code></pre></div>
</li>
<li>
<p>小功能</p>
<ul>
<li>获取每个数据分区的最大值</li>
</ul>
</li>
<li>
<p><code>map</code> 和 <code>mapPartitions</code> 的区别</p>
<ul>
<li>
<p>数据处理角度</p>
<p><code>map</code> 算子时分区内一个数据一个数据的执行，类似于串行操作。而 <code>mapPartitions</code> 算子时以分区为单位进行批处理操作。</p>
</li>
<li>
<p>功能角度</p>
<p><code>map</code> 算子主要目的将数据源中的数据进行转换和改变。但是不会减少或增多数据。<code>mapPartitions</code> 算子需要传递一个迭代器，返回一个迭代器，没有要求元素的个数保持不变，所以可以增加或减少数据。</p>
</li>
<li>
<p>性能角度</p>
<p><code>map</code> 算子因为类似于串行操作，所以性能较低，而 <code>mapPartitions</code> 算子类似于批处理，所以性能较高。但是 <code>mapPartitions</code> 算子会长时间占用内存，那么这样会导致内存可能不够用，出现内存溢出的错误。所以在内存有限的情况下，不推荐使用，应使用 <code>map</code> 算子。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>mapPartitionsWithIndex</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">mapPartitionsWithIndex</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">T</span><span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Iterator</span><span class="p">[</span><span class="nc">U</span><span class="p">],</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">preservesPartitioning</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">U</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将待处理的数据以分区为单位发送到计算节点进行处理，这里的处理是指可以进行任意的处理，哪怕是过滤数据，在处理时同时可以获取当前分区索引。</p>
</li>
<li>
<p>小功能</p>
<ul>
<li>获取第二个数据分区的数据</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>flatMap</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">flatMap</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">TraversableOnce</span><span class="p">[</span><span class="nc">U</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">U</span><span class="p">]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>glom</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">glom</span><span class="p">():</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">T</span><span class="p">]]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将同一个分区的数据直接转换为相同类型的内存数组进行处理，分区不变。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">Int</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">glom</span><span class="p">()</span>
</span></code></pre></div>
</li>
<li>
<p>小功能</p>
<ul>
<li>计算所有分区最大值求和（分区之内取最大值，分区之间最大值求和）</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>groupBy</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">groupBy</span><span class="p">[</span><span class="nc">K</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">K</span><span class="p">)(</span><span class="k">implicit</span><span class="w"> </span><span class="n">kt</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">[</span><span class="nc">K</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">T</span><span class="p">])]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将数据根据指定的规则进行分组，分区默认不变，但是数据会被打乱重新组合，我们将这样的操作称之为 shuffle。极限情况下，数据可能会被分在同一个分区中。一个组的数据在一个分区中，但是并不是说一个分区中只有一个组。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>小功能</p>
<ul>
<li>将 <code>List("hello", "Hive", "HBase", "Hadoop")</code> 根据首字母进行分组</li>
<li>从服务器日志数据 <code>apache.log</code> 中获取每个时间段访问量</li>
<li>WordCount</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>filter</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将数据根据指定的规则进行筛选过滤，符合规则的数据保留，不符合规则的数据丢弃。当数据进行筛选过滤后，分区不变，但是分区内的数据可能不均衡，生产环境下，可能会出现数据倾斜。</p>
</li>
</ul>
</li>
<li>
<p><code>sample</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">withReplacement</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="n">fraction</span><span class="p">:</span><span class="w"> </span><span class="nc">Double</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="n">seed</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Utils</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">nextLong</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>根据指定的规则从数据集中抽取数据。</p>
</li>
</ul>
</li>
<li>
<p><code>distinct</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">distinct</span><span class="p">():</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">distinct</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)(</span><span class="k">implicit</span><span class="w"> </span><span class="n">ord</span><span class="p">:</span><span class="w"> </span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>coalesce</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">coalesce</span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="n">shuffle</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="n">partitionCoalescer</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">PartitionCoalescer</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Option</span><span class="p">.</span><span class="n">empty</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">)(</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">implicit</span><span class="w"> </span><span class="n">ord</span><span class="p">:</span><span class="w"> </span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>根据数据量缩减分区，用于大数据集过滤后，提高小数据集的执行效率。当 Spark 程序中存在过多的小任务的时候，可以通过 <code>coalesce</code> 方法，收缩合并分区，减少分区的个数，减小任务调度成本。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>repartition</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">repartition</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)(</span><span class="k">implicit</span><span class="w"> </span><span class="n">ord</span><span class="p">:</span><span class="w"> </span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>改操作内部其实执行的是 <code>coalesce</code> 操作，参数 <code>shuffle</code> 的默认值为 <code>true</code>。无论是将分区数多的 RDD 转换为分区数少的 RDD，还是将分区数少的 RDD 转换为分区数多的 RDD，<code>repartition</code> 操作都可以完成，因为无论如何都会经 Shuffle 过程。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>sortBy</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">sortBy</span><span class="p">[</span><span class="nc">K</span><span class="p">](</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">K</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">ascending</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">this</span><span class="p">.</span><span class="n">partitions</span><span class="p">.</span><span class="n">length</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="p">)(</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="k">implicit</span><span class="w"> </span><span class="n">ord</span><span class="p">:</span><span class="w"> </span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">K</span><span class="p">],</span><span class="w"> </span><span class="n">ctag</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">[</span><span class="nc">K</span><span class="p">]</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>该操作用于排序数据。在排序之前，可以将数据通过 f 函数进行处理，之后按照 f 函数处理的结构进行排序，默认为升序排列。排列后新产生的 RDD 分区数与原 RDD 的分区数一直，中间存在 Shuffle 过程。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD</span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>双 Value 类型</p>
<ol>
<li>
<p><code>intersection</code></p>
<ul>
<li>函数签名
    <div class="language-scala highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><code>union</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">union</span><span class="p">(</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>subtract</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>zip</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">zip</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">U</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="nc">U</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将两个 RDD 中的元素，以简直对的形式进行合并。其中，键值对中的 Key 为第一个 RDD 中的元素，Value 为第二个 RDD 中的相同位置的元素。</p>
<blockquote>
<p>分区和分区数据量需要一致。</p>
</blockquote>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Key-Value 类型</p>
<ol>
<li>
<p><code>partitionBy</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">partitionBy</span><span class="p">(</span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将数据按照指定 Partition 重新进行分区。Spark 默认的分区器是 HashPartitioner。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd1</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aaa&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bbb&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ccc&quot;</span><span class="p">)),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd2</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd1</span><span class="p">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">HashPartitioner</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>reduceByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">reduceByKey</span><span class="p">(</span><span class="n">func</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">V</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)]</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">reduceByKey</span><span class="p">(</span><span class="n">func</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>可以将数据按照相同的 Key 第 Value 进行聚合。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD1</span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD1</span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>小功能</p>
<ul>
<li>WordCount</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>groupByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">groupByKey</span><span class="p">():</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">V</span><span class="p">])]</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">groupByKey</span><span class="p">(</span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">V</span><span class="p">])]</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">groupByKey</span><span class="p">(</span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">V</span><span class="p">])]</span>
</span></code></pre></div>
</li>
<li>
<p><code>reduceByKey</code> 和 <code>groupByKey</code> 的区别</p>
<ul>
<li>
<p>从 Shuffle 的角度</p>
<p><code>reduceByKey</code> 和 <code>groupByKey</code> 都存在 Shuffle 的操作，但是 <code>reduceByKey</code> 可以在 Shuffle 前对分区内相同的数据进行预聚合功能，这样会减少罗盘的数量量，而 <code>groupByKey</code> 只是进行分组，不存在数据量减少的问题，<code>reduceByKey</code> 性能较高。</p>
</li>
<li>
<p>从功能的角度</p>
<p><code>reduceByKey</code> 其实包含分组和聚合的功能，<code>groupByKey</code> 只能分组，不能聚合，所以在分组聚合的场景下，推荐使用 <code>reduceByKey</code>，如果仅仅是分组而不需要聚合。那么还是只能使用 <code>groupByKey</code>。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>aggregateByKey</code></p>
</li>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">aggregateByKey</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="n">zeroValue</span><span class="p">:</span><span class="w"> </span><span class="nc">U</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">)(</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="n">seqOp</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="n">combOp</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w"> </span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">U</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>将数据根据不同的规则进行分区内计算和分区间计算。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">dataRDD1</span><span class="p">.</span><span class="n">aggregateByKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span></code></pre></div>
<blockquote>
<p>取出每个分区相同 Key 的最大值然后分区间相加。</p>
</blockquote>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)),</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="mi">2</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">)</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">resultRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span><span class="p">.</span><span class="n">aggregateByKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">math</span><span class="p">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">    </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">)</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="n">resultRDD</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p><code>foldByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foldByKey</span><span class="p">(</span><span class="n">zeroValue</span><span class="p">:</span><span class="w"> </span><span class="nc">V</span><span class="p">)(</span><span class="n">func</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">V</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>当分区内计算规则和分区间计算规则相同时，<code>aggregateByKey</code> 就可以简化为 <code>foldByKey</code>。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD1</span><span class="p">.</span><span class="n">foldByKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>combineByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">combineByKey</span><span class="p">[</span><span class="nc">C</span><span class="p">](</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="n">createCombiner</span><span class="p">:</span><span class="w"> </span><span class="nc">V</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">C</span><span class="p">,</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="n">mergeValue</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">C</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">C</span><span class="p">,</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="n">mergeCombiners</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">C</span><span class="p">,</span><span class="w"> </span><span class="nc">C</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">C</span><span class="p">,</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">C</span><span class="p">)]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>最通用的对 Key-Value 型 RDD 进行聚集操作的聚集函数（Aggregation Function），类似于 <code>aggregate()</code>，<code>combineByKey</code> 允许用户返回值的类型与输入不一致。</p>
<blockquote>
<p>求数据每个 Key 的平均值。</p>
</blockquote>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">88</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">91</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">93</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">98</span><span class="p">)),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">output</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">combineByKey</span><span class="p">(</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="p">(</span><span class="n">acc</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="p">.</span><span class="n">_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="p">.</span><span class="n">_2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="p">(</span><span class="n">acc1</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">),</span><span class="w"> </span><span class="n">acc2</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">acc1</span><span class="p">.</span><span class="n">_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">acc2</span><span class="p">.</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">acc1</span><span class="p">.</span><span class="n">_2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">acc2</span><span class="p">.</span><span class="n">_2</span><span class="p">)</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p><code>reduceByKey</code>、<code>foldByKey</code>、<code>aggregateByKey</code>、<code>combineByKey</code> 的区别</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>reduceByKey</code></td>
<td>相同 Key 的第一个数据不进行任何计算，分区内和分区间计算规则相同</td>
</tr>
<tr>
<td><code>foldByKey</code></td>
<td>相同 Key 的第一个数据和初始值进行分区内计算，分区内和分区间计算规则相同</td>
</tr>
<tr>
<td><code>aggregateByKey</code></td>
<td>相同 Key 的第一个数据和初始值进行分区内计算，分区内和分区间计算规则可以不相同</td>
</tr>
<tr>
<td><code>combineByKey</code></td>
<td>当计算时，发现数据结构不满足要求时，可以让第一个数据转换结构。分区内和分区间计算规则不相同</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p><code>sortByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">sortByKey</span><span class="p">(</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="n">ascending</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="n">numPartitions</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">partitions</span><span class="p">.</span><span class="n">length</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">)]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>join</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">[</span><span class="nc">W</span><span class="p">](</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">W</span><span class="p">)],</span><span class="w"> </span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">W</span><span class="p">))]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd1</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">)))</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd2</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)))</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">rdd1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">rdd2</span><span class="p">).</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>leftOuterJoin</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">leftOuterJoin</span><span class="p">[</span><span class="nc">W</span><span class="p">](</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">W</span><span class="p">)],</span><span class="w"> </span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">W</span><span class="p">]))]</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>cogroup</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">cogroup</span><span class="p">[</span><span class="nc">W</span><span class="p">](</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">W</span><span class="p">)],</span><span class="w"> </span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataRDD2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)))</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">resultRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">Int</span><span class="p">],</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[</span><span class="nc">Int</span><span class="p">]))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataRDD1</span><span class="p">.</span><span class="n">cogroup</span><span class="p">(</span><span class="n">dataRDD2</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h5 id="2134">2.1.3.4 案例实操<a class="headerlink" href="#2134" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>数据准备
    <code>agent.log</code>：时间戳、省份、城市、用户、广告，中间字段使用空格分隔。</p>
</li>
<li>
<p>需求描述</p>
<p>统计出每一个省份每个广告被点击数量排行的 Top3。</p>
</li>
<li>
<p>功能实现</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">    </span><span class="c1">// 1. 原始数据</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">    </span><span class="c1">// &quot;时间戳 省份 城市 用户 广告&quot;</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd1</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;input/agent.log&quot;</span><span class="p">)</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">    </span><span class="c1">// 2. 原始数据进行结构的转换</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="w">    </span><span class="c1">// &quot;时间戳 省份 城市 用户 广告&quot; =&gt; ((省份, 广告), 1)</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd2</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[((</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">),</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd1</span><span class="p">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="w">      </span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">        </span><span class="p">((</span><span class="n">fields</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">fields</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">    </span><span class="c1">// 3. 将转换结构后的数据进行分组聚合</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="w">    </span><span class="c1">// ((省份, 广告), 1) =&gt; ((省份, 广告), sum)</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd3</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[((</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">),</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd2</span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="w">    </span><span class="c1">// 4. 将聚合的结果进行结构的转换</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="w">    </span><span class="c1">// ((省份, 广告), sum) =&gt; (省份, (广告, sum))</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd4</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd3</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="n">advertisement</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">province</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">advertisement</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">))</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="w">    </span><span class="c1">// 5. 将转换结构后的数据根据省份进行分组</span>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">    </span><span class="c1">// (省份, (广告, sum)) =&gt; (省份, Iterable[(广告, sum)])</span>
</span><span id="__span-42-31"><a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd5</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Iterable</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd4</span><span class="p">.</span><span class="n">groupByKey</span><span class="p">()</span>
</span><span id="__span-42-32"><a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>
</span><span id="__span-42-33"><a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="w">    </span><span class="c1">// 6. 将分组后的数据组内排序取前 3 名</span>
</span><span id="__span-42-34"><a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a><span class="w">    </span><span class="c1">// (省份, Iterable[(广告, sum)]) =&gt; (省份, List[(广告, sum)])</span>
</span><span id="__span-42-35"><a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd6</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">List</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd5</span><span class="p">.</span><span class="n">mapValues</span><span class="p">(</span>
</span><span id="__span-42-36"><a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="w">      </span><span class="n">values</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">values</span>
</span><span id="__span-42-37"><a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a><span class="w">        </span><span class="p">.</span><span class="n">toList</span>
</span><span id="__span-42-38"><a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="w">        </span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">_2</span><span class="p">)(</span><span class="nc">Ordering</span><span class="p">.</span><span class="nc">Int</span><span class="p">.</span><span class="n">reverse</span><span class="p">)</span>
</span><span id="__span-42-39"><a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="w">        </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-42-40"><a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-42-41"><a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>
</span><span id="__span-42-42"><a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a><span class="w">    </span><span class="c1">// 7. 采集数据打印在控制台上</span>
</span><span id="__span-42-43"><a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a><span class="w">    </span><span class="n">rdd6</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-42-44"><a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-45"><a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h5 id="2135-rdd">2.1.3.5 RDD 行动算子<a class="headerlink" href="#2135-rdd" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p><code>reduce</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">T</span><span class="p">):</span><span class="w"> </span><span class="nc">T</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>collect</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect</span><span class="p">():</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>在驱动程序中，以数组 Array 的形式返回数据集的所有元素。</p>
</li>
</ul>
</li>
<li>
<p><code>count</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">():</span><span class="w"> </span><span class="nc">Long</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>返回 RDD 中元素的个数。</p>
</li>
</ul>
</li>
<li>
<p><code>first</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">first</span><span class="p">():</span><span class="w"> </span><span class="nc">T</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>返回 RDD 中的第一个元素。</p>
</li>
</ul>
</li>
<li>
<p><code>take</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">take</span><span class="p">(</span><span class="n">num</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>返回一个由 RDD 的前 n 个元素组成的数组。</p>
</li>
</ul>
</li>
<li>
<p><code>takeOrdered</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">takeOrdered</span><span class="p">(</span><span class="n">num</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)(</span><span class="k">implicit</span><span class="w"> </span><span class="n">ord</span><span class="p">:</span><span class="w"> </span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">T</span><span class="p">]):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>返回该 RDD 排序后的前 n 个元素组成的数组。</p>
</li>
</ul>
</li>
<li>
<p><code>aggregate</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">[</span><span class="nc">U</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span><span class="n">zeroValue</span><span class="p">:</span><span class="w"> </span><span class="nc">U</span><span class="p">)(</span><span class="n">seqOp</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="n">combOp</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">U</span><span class="p">,</span><span class="w"> </span><span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span><span class="p">):</span><span class="w"> </span><span class="nc">U</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>分区的数据通过初始值和分区内的数据进行聚合，然后再和初始值进行分区间的数据聚合。</p>
</li>
</ul>
</li>
<li>
<p><code>fold</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fold</span><span class="p">(</span><span class="n">zeroValue</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)(</span><span class="n">op</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">T</span><span class="p">):</span><span class="w"> </span><span class="nc">T</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>折叠操作，<code>aggregate</code> 的简化版操作。</p>
</li>
</ul>
</li>
<li>
<p><code>countByKey</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">countByKey</span><span class="p">():</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>统计每种 Key 的个数。</p>
</li>
</ul>
</li>
<li>
<p><code>save</code> 相关算子</p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">saveAsTextFile</span><span class="p">(</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">saveAsObjectFile</span><span class="p">(</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">saveAsSequenceFile</span><span class="p">(</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="n">codec</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Class</span><span class="p">[</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="nc">CompressionCodec</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">None</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">))</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="c1">// 保存成 Text 文件</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">rdd</span><span class="p">.</span><span class="n">saveAsTextFile</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">)</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="c1">// 序列化成对象保存到文件</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">rdd</span><span class="p">.</span><span class="n">saveAsObjectFile</span><span class="p">(</span><span class="s">&quot;output1&quot;</span><span class="p">)</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="c1">// 保存成 Sequencefile 文件</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="n">rdd</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="n">saveAsSequenceFile</span><span class="p">(</span><span class="s">&quot;output2&quot;</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><code>foreach</code></p>
<ul>
<li>
<p>函数签名</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foreach</span><span class="p">[</span><span class="nc">U</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">U</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span>
</span></code></pre></div>
</li>
<li>
<p>函数说明</p>
<p>分布式遍历 RDD 中的每一个元素，调用指定函数。</p>
</li>
</ul>
</li>
</ol>
<h5 id="2136-rdd">2.1.3.6 RDD 序列化<a class="headerlink" href="#2136-rdd" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>闭包检查</p>
<p>从计算的角度，算子以外的代码都是在 Driver 端执行，算子里面的代码都是在 Executor 端执行。那么在 Scala 函数式编程中，就会导致算子内经常会用到算子外的数据，这样就形成了闭包的效果，如果使用的算子外的数据无法序列化，就意味着无法传值给 Executor 端执行，就会发生错误，所以需要在执行任务计算前，检测闭包内的对象是否可以进行序列化，这个操作我们称之为闭包检查。</p>
</li>
<li>
<p>序列化方法和属性</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Searcher</span><span class="p">(</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">getMatchRDD</span><span class="p">(</span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="p">}</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="k">object</span><span class="w"> </span><span class="nc">App3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello spark&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello flink&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kafka&quot;</span><span class="p">))</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">searcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Searcher</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searcher</span><span class="p">.</span><span class="n">getMatchRDD</span><span class="p">(</span><span class="n">rdd</span><span class="p">)</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>Kryo 序列化框架</p>
<blockquote>
<p><a href="https://github.com/EsotericSoftware/kryo">https://github.com/EsotericSoftware/kryo</a></p>
</blockquote>
<p>Java 的序列化能够序列化任何的类，但是比较重（字节多），序列化后对象的提交也比较大。Spark 出于性能的考虑，Spark 2.0 开始支持另外一种 Kryo 序列化机制。Kryo 速度是 Serializable 的 10 倍。当 RDD 在 Shuffle 数据的时候，简单数据类型、数组、字符串类型已经在 Spark 内部使用 Kryo 来序列化。</p>
<p>注意：即使使用 Kryo 序列化，也要继承 Serializable 接口。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Searcher</span><span class="p">(</span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Serializable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">getMatchRDD</span><span class="p">(</span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="p">}</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">()</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">      </span><span class="p">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">)</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">      </span><span class="p">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">      </span><span class="c1">// 替换默认的序列化机制</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">      </span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.serializer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.spark.serializer.KryoSerializer&quot;</span><span class="p">)</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">      </span><span class="c1">// 注册需要使用 Kryo 序列化的自定义类</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="w">      </span><span class="p">.</span><span class="n">registerKryoClasses</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="k">classOf</span><span class="p">[</span><span class="nc">Searcher</span><span class="p">]))</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello spark&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello flink&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kafka&quot;</span><span class="p">))</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">searcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Searcher</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searcher</span><span class="p">.</span><span class="n">getMatchRDD</span><span class="p">(</span><span class="n">rdd</span><span class="p">)</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ol>
<h5 id="2137-rdd">2.1.3.7 RDD 依赖关系<a class="headerlink" href="#2137-rdd" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>RDD 血缘关系</p>
<p>RDD 只支持粗粒度转换，即在大量记录上执行的单个操作。将创建 RDD 的一系列 Lineage（血统）记录下来，以便恢复丢失的分区。RDD 的 Lineage 会记录 RDD 的元数据信息和转换行为，当该 RDD 的部分分区数据丢失时，它可以根据这些信息来重新运算和恢复丢失的数据分区。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">fileRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;input/1.txt&quot;</span><span class="p">)</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">println</span><span class="p">(</span><span class="n">fileRDD</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">)</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">wordRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileRDD</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">println</span><span class="p">(</span><span class="n">wordRDD</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">)</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="kd">val</span><span class="w"> </span><span class="n">mapRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wordRDD</span><span class="p">.</span><span class="n">map</span><span class="p">((</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="n">println</span><span class="p">(</span><span class="n">mapRDD</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">)</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="kd">val</span><span class="w"> </span><span class="n">resultRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapRDD</span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_</span><span class="p">)</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="n">println</span><span class="p">(</span><span class="n">resultRDD</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">)</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="n">resultRDD</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span></code></pre></div>
</li>
<li>
<p>RDD 依赖关系</p>
<p>这里所谓的依赖关系，其实就是两个相邻 RDD 之间的关系。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">fileRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;input/1.txt&quot;</span><span class="p">)</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">println</span><span class="p">(</span><span class="n">fileRDD</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">wordRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileRDD</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="n">println</span><span class="p">(</span><span class="n">wordRDD</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="kd">val</span><span class="w"> </span><span class="n">mapRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wordRDD</span><span class="p">.</span><span class="n">map</span><span class="p">((</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="n">println</span><span class="p">(</span><span class="n">mapRDD</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="n">println</span><span class="p">(</span><span class="s">&quot;----------------------&quot;</span><span class="p">)</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="kd">val</span><span class="w"> </span><span class="n">resultRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapRDD</span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_</span><span class="p">)</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="n">println</span><span class="p">(</span><span class="n">resultRDD</span><span class="p">.</span><span class="n">dependencies</span><span class="p">)</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="n">resultRDD</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span></code></pre></div>
</li>
<li>
<p>RDD 窄依赖</p>
<p>窄依赖表示每一个父（上游） RDD 的 Partition 最多被子（下游） RDD 的一个 Partition 使用，窄依赖我们形象的比喻为独生子女。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">OneToOneDependency</span><span class="p">[</span><span class="nc">T</span><span class="p">](</span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">T</span><span class="p">])</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">NarrowDependency</span><span class="p">[</span><span class="nc">T</span><span class="p">](</span><span class="n">rdd</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>RDD 宽依赖</p>
<p>宽依赖表示同一个父（上游）RDD 的 Partition 被多个子（下游）RDD 的 Partition 依赖，会引起 Shuffle。总结：宽依赖我们形象的比喻为多生。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ShuffleDependency</span><span class="p">[</span><span class="nc">K</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">,</span><span class="w"> </span><span class="nc">C</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">](</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span><span class="nd">@transient</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">_rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="n">_</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="nc">Product2</span><span class="p">[</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">]],</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">partitioner</span><span class="p">:</span><span class="w"> </span><span class="nc">Partitioner</span><span class="p">,</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">serializer</span><span class="p">:</span><span class="w"> </span><span class="nc">Serializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkEnv</span><span class="p">.</span><span class="n">get</span><span class="p">.</span><span class="n">serializer</span><span class="p">,</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">keyOrdering</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Ordering</span><span class="p">[</span><span class="nc">K</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">None</span><span class="p">,</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">aggregator</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Aggregator</span><span class="p">[</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">,</span><span class="w"> </span><span class="nc">C</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">None</span><span class="p">,</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">mapSideCombine</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">shuffleWriterProcessor</span><span class="p">:</span><span class="w"> </span><span class="nc">ShuffleWriteProcessor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ShuffleWriteProcessor</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Dependency</span><span class="p">[</span><span class="nc">Product2</span><span class="p">[</span><span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="nc">V</span><span class="p">]]</span>
</span></code></pre></div>
</li>
<li>
<p>RDD 任务划分</p>
<ul>
<li>Application：初始化一个 SparkContext 即生成一个 Application；</li>
<li>Job：一个 Action 算子就会生成一个 Job；</li>
<li>Stage：Stage 等于宽依赖（ShuffleDependency）的个数加 1；</li>
<li>Task：一个 Stage 阶段中，最后一个 RDD 的分区个数就是 Task 的个数；</li>
</ul>
<p>注意：Application -&gt; Job -&gt; Stage -&gt; Task 每一层都是一对多的关系。</p>
</li>
</ol>
<h5 id="5148-rdd">5.1.4.8 RDD 持久化<a class="headerlink" href="#5148-rdd" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p>RDD Cache 缓存</p>
<p>RDD 通过 <code>cache()</code>或者 <code>persist()</code>方法将前面的计算结果缓存，默认情况下会把数据缓存在 JVM 的堆内存中。但是并不是这两个方法被调用时立即缓存，而是触发后面的 Action 算子时，该 RDD 才会被缓存在计算节点的内存中，并供后面复用。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">rdd</span><span class="p">.</span><span class="n">cache</span><span class="p">()</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">rdd</span><span class="p">.</span><span class="n">persist</span><span class="p">(</span><span class="nc">StorageLevel</span><span class="p">.</span><span class="nc">MEMORY_AND_DISK_2</span><span class="p">)</span>
</span></code></pre></div>
<p>缓存有可能丢失，或者存储于内存的数据由于内存不足而被删除，RDD 的缓存容错机制保证了即使缓存丢失也能保证计算的正确执行。通过基于 RDD 的系列转换，丢失的数据会被重算，由于 RDD 的各个 Partition 是相对独立的，因此只需要计算丢失的部分即可，并不需要重算全部 Partition。</p>
<p>Spark 会自动对一些 Shuffle 操作的中间数据做持久化操作（比如 <code>reduceByKey</code>），这样做的目的是为了当一个节点 Shuffle 失败了避免重新计算整个输入。但是，在实际使用的时候，如果想重用数据，仍然建议调用 <code>cache()</code> 或 <code>persist()</code> 。</p>
</li>
<li>
<p>RDD Checkpoint 检查点</p>
<p>所谓的检查点其实就是通过将 RDD 中间结果写入磁盘，由于血缘依赖过长会造成容错成本过高，这样就不如在中间阶段做检查点容错，如果检查点之后有节点出现问题，可以从检查点重做血缘，减少了开销。对 RDD 进行 Checkpoint 操作并不会马上被执行，必须执行 Action 操作才能触发。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1">// 设置检查点路径</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">sc</span><span class="p">.</span><span class="n">setCheckpointDir</span><span class="p">(</span><span class="s">&quot;checkpoint&quot;</span><span class="p">)</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">lineRdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;input/1.txt&quot;</span><span class="p">)</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="c1">// 业务逻辑</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">wordRdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineRdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="kd">val</span><span class="w"> </span><span class="n">wordToOneRdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wordRdd</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="nc">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()))</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="c1">// 缓存</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="n">wordToOneRdd</span><span class="p">.</span><span class="n">cache</span><span class="p">()</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="c1">// 检查点</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="n">wordToOneRdd</span><span class="p">.</span><span class="n">checkpoint</span><span class="p">()</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="c1">// 触发执行逻辑</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="n">wordToOneRdd</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>缓存和检查点区别</p>
<ul>
<li>Cache 只是将数据保存起来，不切断血缘依赖；Checkpoint 切断血缘依赖。</li>
<li>Cache 缓存的数据通常存储在磁盘、内存等地方，可靠性低；Checkpoint 的数据通常存储在 HDFS 等容错、高可用的文件系统，可靠性高。</li>
<li>建议对 Checkpoint 的 RDD 使用 Cache，这样 Checkpoint 的 Job 只需从 Cache 中读取数据即可，否则需要再从头计算一次 RDD。</li>
</ul>
</li>
</ol>
<h5 id="2139-rdd">2.1.3.9 RDD 分区器<a class="headerlink" href="#2139-rdd" title="Permanent link">&para;</a></h5>
<p>Spark 目前支持 Hash 分区和 Range 分区，和用户自定义分区。Hash 分区为当前的默认分区。分区器直接决定了 RDD 中分区的个数、RDD 中每条数据经过 Shuffle 后进入哪个分区，进而决定了 Reduce 的个数。</p>
<p>只有 Key-Value 类型的 RDD 才有分区器，非 Key-Value 类型的 RDD 分区的值是 None。</p>
<ul>
<li>Hash 分区：对于给定的 Key，计算其 Hash Code 并处以分区个数取余。</li>
<li>Range 分区：将一定范围内的数据映射到一个分区中，尽量保证每个分区数据均匀，而且分区间有序。</li>
</ul>
<h5 id="21310-rdd">2.1.3.10 RDD 文件读取与保存<a class="headerlink" href="#21310-rdd" title="Permanent link">&para;</a></h5>
<p>Spark 的数据读取及保存可以从两个维度来作为区分：文件格式以及文件系统。文件格式分为 Text 文件、CSV 文件、Sequence 文件以及 Object 文件；文件系统分为本地文件系统、HDFS、HBase 以及数据库。</p>
<p><br/></p>
<h3 id="22">2.2 累加器<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<h4 id="221">2.2.1 实现原理<a class="headerlink" href="#221" title="Permanent link">&para;</a></h4>
<p>累加器用来把 Executor 端变量信息聚合到 Driver 端。在 Driver 程序中定义的变量，在 Executor 端的每个 Task 都会得到这个变量的一份新的副本，每个 Task 更新这些副本的值后，传回 Driver 端进行 Merge。</p>
<h4 id="222">2.2.2 基础编程<a class="headerlink" href="#222" title="Permanent link">&para;</a></h4>
<h5 id="2221">2.2.2.1 系统累加器<a class="headerlink" href="#2221" title="Permanent link">&para;</a></h5>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">longAccumulator</span><span class="p">(</span><span class="s">&quot;sum&quot;</span><span class="p">)</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="n">rdd</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">sum</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="n">println</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span>
</span></code></pre></div>
<h5 id="2222">2.2.2.2 自定义累加器<a class="headerlink" href="#2222" title="Permanent link">&para;</a></h5>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">WordCountAccumulator</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">AccumulatorV2</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">map</span><span class="p">:</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]()</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">isZero</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">isEmpty</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">():</span><span class="w"> </span><span class="nc">AccumulatorV2</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">WordCountAccumulator</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">():</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">word</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">0L</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">1L</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">AccumulatorV2</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">map1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">map2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">value</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="w">    </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map1</span><span class="p">.</span><span class="n">foldLeft</span><span class="p">(</span><span class="n">map2</span><span class="p">)(</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="w">      </span><span class="p">(</span><span class="n">innerMap</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="w">        </span><span class="n">innerMap</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">_1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">innerMap</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="il">0L</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">_2</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="w">        </span><span class="n">innerMap</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">:</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span>
</span><span id="__span-64-24"><a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="23">2.3 广播变量<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<h4 id="231">2.3.1 实现原理<a class="headerlink" href="#231" title="Permanent link">&para;</a></h4>
<p>广播变量用来高效分发较大的对象。向所有工作节点发送一个较大的只读值，以供一个或多个 Spark 操作。比如，如果你的应用需要向所有节点发送一个较大的只读查询表，广播变量用起来都很顺手。在多个并行操作中使用同一个变量，但是 Spark 会为每个任务分别发送。</p>
<h4 id="232">2.3.2 基础编程<a class="headerlink" href="#232" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">list1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">list2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">))</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">broadcast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="kd">val</span><span class="w"> </span><span class="n">resultRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span><span class="p">.</span><span class="n">map</span><span class="p">({</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">    </span><span class="n">broadcast</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">foreach</span><span class="p">({</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">k1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="w">          </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v2</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w">    </span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">))</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="p">})</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="n">resultRDD</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
<p><br/><br/></p>
<h2 id="_1">三、案例实操<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>样例类</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UserVisitAction</span><span class="p">(</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">  </span><span class="n">date</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">                 </span><span class="c1">// 用户点击行为的日期</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">  </span><span class="n">user_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">              </span><span class="c1">// 用户的 ID</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">  </span><span class="n">session_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">           </span><span class="c1">// 会话的 ID</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">  </span><span class="n">page_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">              </span><span class="c1">// 页面的 ID</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">  </span><span class="n">action_time</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">          </span><span class="c1">// 动作的时间点</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">  </span><span class="n">search_keyword</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">       </span><span class="c1">// 用户搜索的关键词</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">  </span><span class="n">click_category_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">    </span><span class="c1">// 商品品类的 ID</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w">  </span><span class="n">click_product_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">     </span><span class="c1">// 商品的 ID</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">  </span><span class="n">order_category_ids</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">   </span><span class="c1">// 一次订单中所有品类的 ID 集合</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">  </span><span class="n">order_product_ids</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">    </span><span class="c1">// 一次订单中所有品类的 ID 集合</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">  </span><span class="n">pay_category_ids</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">     </span><span class="c1">// 一次支付中所有品类的 ID 集合</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">  </span><span class="n">pay_product_ids</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w">      </span><span class="c1">// 一次支付中所有商品的 ID 集合</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w">  </span><span class="n">city_id</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">               </span><span class="c1">// 城市的 ID</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="p">)</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="k">case</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="nc">UserVisitAction</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">UserVisitAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="w">    </span><span class="nc">UserVisitAction</span><span class="p">(</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a><span class="w">      </span><span class="n">fields</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-66-36"><a id="__codelineno-66-36" name="__codelineno-66-36" href="#__codelineno-66-36"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>数据规则</p>
<p>数据取自电商网站的用户行为数据，主要包含用户的 4 种行为：搜索、点击、下单、支付。数据规则如下：</p>
<ul>
<li>数据文件中的每行数据采用下划线分隔数据；</li>
<li>每一行数据表示用户的一次行为，这个行为只能是 4 种行为的一种；</li>
<li>如果搜索关键字为 null，表示数据不是搜索数据；</li>
<li>如果点击的品类 ID 和产品 ID 为 -1，表示数据不是点击数据；</li>
<li>针对于下单行为，一次可以下单多个商品，所有品类 ID 和产品 ID 可以是多个，id 之间采用逗号分隔，如果本次不是下单行为，则数据采用 null 表示；</li>
<li>支付行为和下单行为类似；</li>
</ul>
</li>
</ul>
<p><br/></p>
<h3 id="31-top10">3.1 需求一：Top10 热门品类<a class="headerlink" href="#31-top10" title="Permanent link">&para;</a></h3>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement1</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement1&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="n">sc</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">actionRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;public/spark-core/user_visit_action.txt&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="nc">UserVisitAction</span><span class="p">.</span><span class="n">parse</span><span class="p">)</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">top10Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTop10Category</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">)</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">    </span><span class="n">top10Category</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">getTop10Category</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">UserVisitAction</span><span class="p">]):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">    </span><span class="n">actionRDD</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">      </span><span class="c1">// 数据结构转换</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">      </span><span class="c1">// &gt; click: (category_id,(1,0,0))</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="w">      </span><span class="c1">// &gt; order: (category_id,(0,1,0))</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="w">      </span><span class="c1">// &gt; pay:   (category_id,(0,0,1))</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">click_category_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;-1&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a><span class="w">          </span><span class="c1">// 点击的场合</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a><span class="w">          </span><span class="nc">Array</span><span class="p">((</span><span class="n">action</span><span class="p">.</span><span class="n">click_category_id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">order_category_ids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;null&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a><span class="w">          </span><span class="c1">// 下单的场合</span>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a><span class="w">          </span><span class="n">action</span><span class="p">.</span><span class="n">order_category_ids</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">pay_category_ids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;null&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a><span class="w">          </span><span class="c1">// 支付的场合</span>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a><span class="w">          </span><span class="n">action</span><span class="p">.</span><span class="n">pay_category_ids</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-31"><a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a><span class="w">          </span><span class="nc">Nil</span>
</span><span id="__span-67-32"><a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-67-33"><a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-67-34"><a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a><span class="w">      </span><span class="c1">// 将相同品类 ID 的数据进行分组聚合</span>
</span><span id="__span-67-35"><a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a><span class="w">      </span><span class="c1">// &gt; (category_id,(click_count,order_count,pay_count))</span>
</span><span id="__span-67-36"><a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">_2</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">_3</span><span class="p">))</span>
</span><span id="__span-67-37"><a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a><span class="w">      </span><span class="c1">// 将统计结果根据数量进行降序处理取前 10 名</span>
</span><span id="__span-67-38"><a id="__codelineno-67-38" name="__codelineno-67-38" href="#__codelineno-67-38"></a><span class="w">      </span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">_2</span><span class="p">,</span><span class="w"> </span><span class="n">ascending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-67-39"><a id="__codelineno-67-39" name="__codelineno-67-39" href="#__codelineno-67-39"></a><span class="w">      </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-67-40"><a id="__codelineno-67-40" name="__codelineno-67-40" href="#__codelineno-67-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-41"><a id="__codelineno-67-41" name="__codelineno-67-41" href="#__codelineno-67-41"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="32-top10-top10">3.2 需求二：Top10 热门品类中每个品类的 Top10 活跃会话统计<a class="headerlink" href="#32-top10-top10" title="Permanent link">&para;</a></h3>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement2</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement2&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">    </span><span class="n">sc</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">actionRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;public/spark-core/user_visit_action.txt&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="nc">UserVisitAction</span><span class="p">.</span><span class="n">parse</span><span class="p">)</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">top10Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTop10Category</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">)</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">top10CategoryTop10Session</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTop10CategoryTop10Session</span><span class="p">(</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">      </span><span class="n">actionRDD</span><span class="p">,</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">      </span><span class="n">top10Category</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">_1</span><span class="p">)</span>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">    </span><span class="n">top10CategoryTop10Session</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">getTop10Category</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">UserVisitAction</span><span class="p">]):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">))]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">???</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">getTop10CategoryTop10Session</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">UserVisitAction</span><span class="p">],</span><span class="w"> </span><span class="n">top10Category</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">List</span><span class="p">[(</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">    </span><span class="n">actionRDD</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">      </span><span class="c1">// 过滤原始数据保留点击和前 10 品类</span>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">      </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="n">click_category_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;-1&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">top10Category</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">click_category_id</span><span class="p">))</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="w">      </span><span class="c1">// 根据品类 ID 和会话 ID 进行点击量的统计</span>
</span><span id="__span-68-26"><a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">((</span><span class="n">action</span><span class="p">.</span><span class="n">click_category_id</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="n">session_id</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-68-27"><a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-68-28"><a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">      </span><span class="c1">// 数据结构转换</span>
</span><span id="__span-68-29"><a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="w">      </span><span class="c1">// &gt; ((category_id,session_id),sum) =&gt; (category_id,(session_id,sum))</span>
</span><span id="__span-68-30"><a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">cid</span><span class="p">,</span><span class="w"> </span><span class="n">sid</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">cid</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">sid</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">))</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-68-31"><a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a><span class="w">      </span><span class="c1">// 根据相同的品类进行分组</span>
</span><span id="__span-68-32"><a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a><span class="w">      </span><span class="p">.</span><span class="n">groupByKey</span><span class="p">()</span>
</span><span id="__span-68-33"><a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a><span class="w">      </span><span class="c1">// 将分组后的数据进行点击量的排序取前 10 名</span>
</span><span id="__span-68-34"><a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a><span class="w">      </span><span class="p">.</span><span class="n">mapValues</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-68-35"><a id="__codelineno-68-35" name="__codelineno-68-35" href="#__codelineno-68-35"></a><span class="w">        </span><span class="n">values</span>
</span><span id="__span-68-36"><a id="__codelineno-68-36" name="__codelineno-68-36" href="#__codelineno-68-36"></a><span class="w">          </span><span class="p">.</span><span class="n">toList</span>
</span><span id="__span-68-37"><a id="__codelineno-68-37" name="__codelineno-68-37" href="#__codelineno-68-37"></a><span class="w">          </span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">_2</span><span class="p">)(</span><span class="nc">Ordering</span><span class="p">.</span><span class="nc">Int</span><span class="p">.</span><span class="n">reverse</span><span class="p">)</span>
</span><span id="__span-68-38"><a id="__codelineno-68-38" name="__codelineno-68-38" href="#__codelineno-68-38"></a><span class="w">          </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-68-39"><a id="__codelineno-68-39" name="__codelineno-68-39" href="#__codelineno-68-39"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-68-40"><a id="__codelineno-68-40" name="__codelineno-68-40" href="#__codelineno-68-40"></a><span class="w">      </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-68-41"><a id="__codelineno-68-41" name="__codelineno-68-41" href="#__codelineno-68-41"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-42"><a id="__codelineno-68-42" name="__codelineno-68-42" href="#__codelineno-68-42"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="33">3.3 需求三：页面单跳转化率统计<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<h4 id="331">3.3.1 需求说明<a class="headerlink" href="#331" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>什么是页面单跳转化率</p>
<p>比如一个用户在一次会话过程中访问的页面路径 3,5,7,9,10,21，那么页面 3 跳到页面 5 叫一次单挑， 7 到 9 也叫单跳，那么单跳转化率就是要统计页面点击的概率。</p>
<p>比如计算 3-5 的单跳转率，先获取符合条件的会话对于页面 3 的访问次数（PV）为 A，然后获取符合条件的会话中访问了页面 3 又紧接着访问了页面 5 的次数为 B，那么 B/A 就是 3-5 的页面单跳转化率。</p>
</li>
<li>
<p>统计页面单跳转化率的意义</p>
<ul>
<li>产品经理和运营总监，可以根据这个指标，去尝试分析，整个网站，产品，各个页面的表现怎么样，是不是需要去优化产品的布局，吸引用户最终可以进入最后的支付页面。</li>
<li>数据分析师，可以根据此数据做更深一步的计算和分析。</li>
<li>企业管理员，可以看到整个公司的网站，各个页面之间跳转的表现如何，可以适当调整公司的经营战略。</li>
</ul>
</li>
</ul>
<h4 id="332">3.3.2 功能实现<a class="headerlink" href="#332" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement3&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">    </span><span class="n">sc</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">actionRDD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;public/spark-core/user_visit_action.txt&quot;</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="nc">UserVisitAction</span><span class="p">.</span><span class="n">parse</span><span class="p">)</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">pageflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPageflow</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">)</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="w">    </span><span class="n">pageflow</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">page1</span><span class="p">,</span><span class="w"> </span><span class="n">page2</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="s">s&quot;从页面 </span><span class="si">${</span><span class="n">page1</span><span class="si">}</span><span class="s"> 跳转到页面 </span><span class="si">${</span><span class="n">page2</span><span class="si">}</span><span class="s"> 的单跳转化率为 </span><span class="si">${</span><span class="n">sum</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)})</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">getPageflow</span><span class="p">(</span><span class="n">actionRDD</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">UserVisitAction</span><span class="p">]):</span><span class="w"> </span><span class="nc">Array</span><span class="p">[((</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">),</span><span class="w"> </span><span class="nc">Double</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="w">    </span><span class="c1">// 计算分母</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionRDD</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">page_id</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a><span class="w">      </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a><span class="w">      </span><span class="p">.</span><span class="n">toMap</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a><span class="w">    </span><span class="c1">// 计算分子</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionRDD</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="w">      </span><span class="c1">// 根据会话分组</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="w">      </span><span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a><span class="w">      </span><span class="c1">// 分组后根据访问时间进行排序</span>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a><span class="w">      </span><span class="p">.</span><span class="n">mapValues</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span>
</span><span id="__span-69-29"><a id="__codelineno-69-29" name="__codelineno-69-29" href="#__codelineno-69-29"></a><span class="w">          </span><span class="p">.</span><span class="n">toList</span>
</span><span id="__span-69-30"><a id="__codelineno-69-30" name="__codelineno-69-30" href="#__codelineno-69-30"></a><span class="w">          </span><span class="p">.</span><span class="n">sortBy</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="n">action_time</span><span class="p">)</span>
</span><span id="__span-69-31"><a id="__codelineno-69-31" name="__codelineno-69-31" href="#__codelineno-69-31"></a><span class="w">          </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="n">page_id</span><span class="p">)</span>
</span><span id="__span-69-32"><a id="__codelineno-69-32" name="__codelineno-69-32" href="#__codelineno-69-32"></a><span class="w">        </span><span class="n">ids</span>
</span><span id="__span-69-33"><a id="__codelineno-69-33" name="__codelineno-69-33" href="#__codelineno-69-33"></a><span class="w">          </span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
</span><span id="__span-69-34"><a id="__codelineno-69-34" name="__codelineno-69-34" href="#__codelineno-69-34"></a><span class="w">          </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-69-35"><a id="__codelineno-69-35" name="__codelineno-69-35" href="#__codelineno-69-35"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-69-36"><a id="__codelineno-69-36" name="__codelineno-69-36" href="#__codelineno-69-36"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">_2</span><span class="p">)</span>
</span><span id="__span-69-37"><a id="__codelineno-69-37" name="__codelineno-69-37" href="#__codelineno-69-37"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-69-38"><a id="__codelineno-69-38" name="__codelineno-69-38" href="#__codelineno-69-38"></a>
</span><span id="__span-69-39"><a id="__codelineno-69-39" name="__codelineno-69-39" href="#__codelineno-69-39"></a><span class="w">    </span><span class="c1">// 计算单跳转率</span>
</span><span id="__span-69-40"><a id="__codelineno-69-40" name="__codelineno-69-40" href="#__codelineno-69-40"></a><span class="w">    </span><span class="n">up</span>
</span><span id="__span-69-41"><a id="__codelineno-69-41" name="__codelineno-69-41" href="#__codelineno-69-41"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-42"><a id="__codelineno-69-42" name="__codelineno-69-42" href="#__codelineno-69-42"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">page1</span><span class="p">,</span><span class="w"> </span><span class="n">page2</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-43"><a id="__codelineno-69-43" name="__codelineno-69-43" href="#__codelineno-69-43"></a><span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">down</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">page1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-69-44"><a id="__codelineno-69-44" name="__codelineno-69-44" href="#__codelineno-69-44"></a><span class="w">          </span><span class="p">((</span><span class="n">page1</span><span class="p">,</span><span class="w"> </span><span class="n">page2</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">.</span><span class="n">toDouble</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
</span><span id="__span-69-45"><a id="__codelineno-69-45" name="__codelineno-69-45" href="#__codelineno-69-45"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-69-46"><a id="__codelineno-69-46" name="__codelineno-69-46" href="#__codelineno-69-46"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-69-47"><a id="__codelineno-69-47" name="__codelineno-69-47" href="#__codelineno-69-47"></a><span class="w">      </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-69-48"><a id="__codelineno-69-48" name="__codelineno-69-48" href="#__codelineno-69-48"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-49"><a id="__codelineno-69-49" name="__codelineno-69-49" href="#__codelineno-69-49"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/><br/></p>
<h2 id="spark-sql">四、Spark SQL 概述<a class="headerlink" href="#spark-sql" title="Permanent link">&para;</a></h2>
<h3 id="41-spark-sql">4.1 Spark SQL 是什么<a class="headerlink" href="#41-spark-sql" title="Permanent link">&para;</a></h3>
<p>Spark SQL 是 Spark 用于结构化数据处理的 Spark 模块。</p>
<p><br/></p>
<h3 id="42-dataframe">4.2 DataFrame 是什么<a class="headerlink" href="#42-dataframe" title="Permanent link">&para;</a></h3>
<p>在 Spark 中，DataFrame 是一种以 RDD 为基础的分布式数据集，类似于传统数据库中的二维表格。DataFrame 与 RDD 的主要区别在于，前者带有 Schema 元信息，即 DataFrame 所表示的二维表格集中的每一列都带有名称和类型。这使得 Spark SQL 得以洞察更多的结构信息，从而对藏于 DataFrame 背后的数据源以及作用于 DataFrame 之上的变换进行了针对性的优化，最终达到大幅提升运行时效率的目标。反观 RDD，由于无从得知所存数据元素的具体内部结构， Spark Core 只能在 Stage 层面进行简单、通用的流水线优化。</p>
<p>同时，与 Hive 类似，DataFrame 也支持嵌套数据类型（<code>struct</code>、<code>array</code>、<code>map</code>）。从 API 易用性的角度上看，DataFrame API 提供了一套高层的关系操作，比函数式的 RDD API 要更加友好，门槛更低。</p>
<p><br/></p>
<h3 id="43-dataset">4.3 DataSet 是什么<a class="headerlink" href="#43-dataset" title="Permanent link">&para;</a></h3>
<p>DataSet 是分布式数据集合。DataSet 是 Spark 1.6 中添加的一个新抽象，是 DataFrame 的一个扩展。它提供了 RDD 的优势（强类型，使用强大的 Lambda 函数的能力）以及 Spark SQL 优化执行引擎的优点。DataSet 也可以使用功能性的转换（操作 <code>map</code>、<code>flatMap</code>、<code>filter</code> 等等）。</p>
<ul>
<li>DataSet 是 DataFrame API 的一个扩展，是 Spark SQL 最新的数据抽象；</li>
<li>用户友好的 API 风格，既具有类型安全检查也具有 DataFrame 的查询优化特性；</li>
<li>用样例类来对 DataSet 中定义数据的结构信息，样例类中每个属性的名称可直接映射到 DataSet 中的字段名称；</li>
<li>DataSet 是强类型的，比如可以有 <code>DataSet[Car]</code>、<code>DataSet[Person]</code>；</li>
<li>DataFrame 是 DataSet 的特例，<code>DataFrame = DataSet[Row]</code>，所以可以通过 <code>as</code> 方法将 DataFrame 转换为 DataSet。Row 是一个强类型，跟 Car、Person 这些的类型一样，所有的表结构信息都用 Row 来表示。获取数据时需要指定顺序；</li>
</ul>
<p><br/><br/></p>
<h2 id="spark-sql_1">五、Spark SQL 核心编程<a class="headerlink" href="#spark-sql_1" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 新的起点<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<p>Spark Core 中，如果想要执行应用程序，需啊哟首先构建上下文环境对象 SparkContext，Spark SQL 其实可以理解为堆 Spark Core 的一种封装，不仅仅在模型上进行了封装，上下文环境对象也进行了封装。</p>
<p>在老的版本中，Spark SQL 提供两种 SQL 查询起始点，一个是 SQLContext，用于 Spark 自己提供的 SQL 查询；一个叫 HiveContext，用于连接 Hive 的查询。</p>
<p>SparkSession 是 Spark 最新的 SQL 查询起始点，实质上是 SQLContext 和 HiveContext 的组合，所以在 SQLContext 和 HiveContext 上可用的 API 在 SparkSession 上同样是可以使用的。SparkSession 内部封装了 SparkContext，所以计算实际上是由 SparkContext 完成的。当我们使用 <code>spark-shell</code> 的时候，Spark 框架会自动创建一个名称叫做 <code>spark</code> 的 SparkSession 对象，就像我们以前可以自动获取到一个 <code>sc</code> 来表示 SparkContext 对象一样。</p>
<p><br/></p>
<h3 id="52-dataframe">5.2 DataFrame<a class="headerlink" href="#52-dataframe" title="Permanent link">&para;</a></h3>
<p>Spark SQL 的 DataFrame API 允许我们使用 DataFrame 而不用必须去注册临时表或者生成 SQL 表达式。DataFrame API 既有 Transformation 操作也有 Action 操作。</p>
<h4 id="521-dataframe">5.2.1 创建 DataFrame<a class="headerlink" href="#521-dataframe" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;icefery&quot;, &quot;age&quot;:24}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>input/user.json
</span></code></pre></div>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">appName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">master</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="s">&quot;input/user.json&quot;</span><span class="p">)</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="n">df</span><span class="p">.</span><span class="n">printSchema</span><span class="p">()</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="n">df</span><span class="p">.</span><span class="n">createOrReplaceGlobalTempView</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;SELECT * FROM global_temp.user&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<blockquote>
<p>普通表临时表示 Session 范围内的，如果想应用范围内有效，可以使用全局临时表。使用全局临时表时需要全路径访问，如 <code>global_temp.user</code>。</p>
</blockquote>
<h4 id="522-rdd-dataframe">5.2.2 RDD 转换为 DataFrame<a class="headerlink" href="#522-rdd-dataframe" title="Permanent link">&para;</a></h4>
<p>在 IDEA 中开发程序时，如果需要 RDD 与 DF 或者 DS 之间互相操作，那么需要引入 <code>import spark.implicits._</code>。这里的 <code>spark</code> 不是 Scala 中的包名，而是创建的 SparkSession 对象的变量名称，所以必须先创建 SparkSession 对象再导入。这里的 <code>spark</code> 对象不能使用 <code>var</code> 声明，因为 Scala 只支持 <code>val</code> 修饰的对象的引入。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1">// case calss 不能定义在 main 方法中与 import spark.implicits._ 一起使用</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">appName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">master</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">spark</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">  </span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">((</span><span class="s">&quot;icefery&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">  </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">_2</span><span class="p">))</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="w">  </span><span class="p">.</span><span class="n">toDF</span><span class="p">()</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="523-dataframe-rdd">5.2.3 DataFrame 转换为 RDD<a class="headerlink" href="#523-dataframe-rdd" title="Permanent link">&para;</a></h3>
<p>DataFrame 其实就是对 RDD 的封装，所以可以直接获取内部的 RDD。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Row</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">rdd</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="n">rdd</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="53-dataset">5.3 DataSet<a class="headerlink" href="#53-dataset" title="Permanent link">&para;</a></h3>
<p>DataSet 是具有强类型的数据集合，需要提供对应的类型信息。</p>
<h4 id="531-dataset">5.3.1 创建 DataSet<a class="headerlink" href="#531-dataset" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">ds</span><span class="p">:</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;icefery&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)).</span><span class="n">toDS</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="532-rdd-dataset">5.3.2 RDD 转换为 DataSet<a class="headerlink" href="#532-rdd-dataset" title="Permanent link">&para;</a></h4>
<p>Spark SQL 能够自动将包含有 Case 类的 RDD 转换成 DataSet，Case 类定义了 Table 的结构。Case 类属性通过变成了表的类名。Case 类可以包含诸如 Seq 或者 Array 等复杂的结构。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;icefery&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">ds</span><span class="p">:</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span><span class="p">.</span><span class="n">toDS</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="533-dataset-rdd">5.3.3 DataSet 转换为 RDD<a class="headerlink" href="#533-dataset-rdd" title="Permanent link">&para;</a></h4>
<p>DataSet 其实也是对 RDD 的封装，所以可以直接获取内部的 RDD。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">rdd</span><span class="p">:</span><span class="w"> </span><span class="nc">RDD</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">rdd</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="n">rdd</span><span class="p">.</span><span class="n">collect</span><span class="p">().</span><span class="n">foreach</span><span class="p">(</span><span class="n">println</span><span class="p">)</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="54-dataframe-dataset">5.4 DataFrame 和 DataSet 转换<a class="headerlink" href="#54-dataframe-dataset" title="Permanent link">&para;</a></h3>
<p>DataFrame 其实是 DataSet 的特例，所以它们之间是可以互相转换的。</p>
<ul>
<li>
<p>DataFrame 转换为 DataSet</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="nc">List</span><span class="p">(</span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;icefery&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">),</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">))).</span><span class="n">toDF</span><span class="p">()</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">ds</span><span class="p">:</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">as</span><span class="p">[</span><span class="nc">User</span><span class="p">]</span>
</span></code></pre></div>
</li>
<li>
<p>DataSet 转换为 DataFrame</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="p">:</span><span class="w"> </span><span class="nc">DataFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">toDF</span><span class="p">()</span>
</span></code></pre></div>
</li>
</ul>
<p><br/></p>
<h3 id="55-rdddataframedataset">5.5 RDD、DataFrame、DataSet 三者的关系<a class="headerlink" href="#55-rdddataframedataset" title="Permanent link">&para;</a></h3>
<p>在 Spark SQL 中 Spark 为我们提供了两个新的抽象，分别是 DataFrame 和 DataSet。他们和 RDD 有什么区别呢？首先从版本的产生上来看：</p>
<ul>
<li>Spark 1.0 =&gt; RDD</li>
<li>Spark 1.3 =&gt; DataFrame</li>
<li>Spark 1.6 =&gt; DataSet</li>
</ul>
<p>如果同样的数据都给到这三个数据结构，他们分别计算之后，都会给出相同的结果。不同的是他们的执行效率和执行方式。在后期的 Spark 版本中，DataSet 有可能会逐步取代 RDD 和 DataFrame 成为唯一的 API 接口。</p>
<h4 id="551">5.5.1 三者的共性<a class="headerlink" href="#551" title="Permanent link">&para;</a></h4>
<ul>
<li>RDD、DataFrame、DataSet 全都是 Spark 平台下的分布式弹性数据集，为处理超大型数据提供便利；</li>
<li>三者都有惰性机制，在进行创建、转换、如 <code>map</code> 方法时，不会立即执行，只有在遇到 Action 如 <code>foreach</code> 时，三者才会开始遍历；</li>
<li>三者有许多共同的函数，如 <code>filter</code>、<code>sort</code> 等；</li>
<li>在对 DataFrame 和 DataSet 进行操作时，许多操作都需要引入 <code>import spark.implicits._</code> （在创建好 SparkSession 对象后尽量直接进行导入）；</li>
<li>三者都会根据 Spark 的内存情况自动进行缓存运算，这样即使数据量很大，也不会担心会内存溢出；</li>
<li>三者都有 Partition 的概念；</li>
<li>DataFrame 和 DataSet 均可使用模式匹配获取某个字段的值和类型；</li>
</ul>
<h4 id="552">5.5.2 三者的区别<a class="headerlink" href="#552" title="Permanent link">&para;</a></h4>
<h5 id="5521-rdd">5.5.2.1 RDD<a class="headerlink" href="#5521-rdd" title="Permanent link">&para;</a></h5>
<ul>
<li>RDD 一般不和 Spark MLlib 同时使用</li>
<li>RDD 不支持 Spark SQL 操作</li>
</ul>
<h5 id="5522-dataframe">5.5.2.2 DataFrame<a class="headerlink" href="#5522-dataframe" title="Permanent link">&para;</a></h5>
<ul>
<li>与 RDD 和 DataSet 不同，DataFrame 每一行的类型固定为 Row，每一列的值没法直接访问，只有通过解析才能获取各个字段；</li>
<li>DataFrame 与 DataSet 一般不与 Spark MLlib 同时使用；</li>
<li>DataFrame 与 DataSet 均支持 Spark SQL 的操作，比如 <code>select</code>、<code>groupBy</code>之类，还能注册临时表/视图，进行 SQL 语句操作；</li>
<li>DataFrame 与 DataSet 支持一些特别方便的保存方式，比如保存成 CSV，可以带上表头，这样每一行的子弹名一目了然；</li>
</ul>
<h5 id="5523-dataset">5.5.2.3 DataSet<a class="headerlink" href="#5523-dataset" title="Permanent link">&para;</a></h5>
<ul>
<li>DataSet 和 DataFrame 拥有完全相同的成员函数，区别只是每一行的数据类型不同，DataFrame 其实就是 DataSet 的一个特例 <code>type DataFrame = DataSet[Row]</code>；</li>
<li>DataFrame 也可以叫 DataSet[Row]，每一行的类型时 Row，不解析，每一行究竟有哪些字段，各个字段又是什么类型都不从得知，而 DataSet 中每一行是什么类型时不一定的，在自定义了 <code>case class</code> 之后可以很自由的获得每一行的信息；</li>
</ul>
<p><br/></p>
<h3 id="56">5.6 用户自定义函数<a class="headerlink" href="#56" title="Permanent link">&para;</a></h3>
<h4 id="561-udf">5.6.1 UDF<a class="headerlink" href="#561-udf" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">config</span><span class="p">(</span><span class="n">conf</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">    </span><span class="c1">// 创建 DataFrame</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="s">&quot;input/user.json&quot;</span><span class="p">)</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">    </span><span class="c1">// 创建临时表</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">    </span><span class="n">df</span><span class="p">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="w">    </span><span class="c1">// 注册函数</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">udf</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="s">&quot;add_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Name: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="w">    </span><span class="c1">// 应用 UDF</span>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;SELECT add_name(name), age FROM user&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="562-udaf">5.6.2 UDAF<a class="headerlink" href="#562-udaf" title="Permanent link">&para;</a></h4>
<p>强类型的 DataSet 和弱类型的 DataFrame 都提供了相关的聚合函数，如 <code>count()</code>、<code>countDistinct()</code>、<code>avg()</code>、<code>max()</code>、<code>min()</code>。除此之外，用户可以设定自己的自定义聚合函数。通过继承 <code>UserDefinedAggregateFunction</code> 来实现用户自定义弱类型聚合函数。从 Spark 3.0 版本后，<code>UserDefinedAggregateFunction</code> 已经不推荐使用了。可以统一采用强类型聚合函数 <code>Aggregator</code>。</p>
<ul>
<li>
<p>准备数据</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>tee<span class="w"> </span>input/employee.json<span class="w"> </span>&lt;&lt;-<span class="w"> </span><span class="s2">&quot;EOF&quot;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Michael&quot;</span>,<span class="w"> </span><span class="s2">&quot;salary&quot;</span>:<span class="w"> </span><span class="m">3000</span><span class="o">}</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Andy&quot;</span>,<span class="w">    </span><span class="s2">&quot;salary&quot;</span>:<span class="w"> </span><span class="m">4500</span><span class="o">}</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Justin&quot;</span>,<span class="w">  </span><span class="s2">&quot;salary&quot;</span>:<span class="w"> </span><span class="m">3500</span><span class="o">}</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Berta&quot;</span>,<span class="w">   </span><span class="s2">&quot;salary&quot;</span>:<span class="w"> </span><span class="m">4000</span><span class="o">}</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>EOF
</span></code></pre></div>
</li>
<li>
<p>定义函数</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Average</span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">sum</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">)</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="k">object</span><span class="w"> </span><span class="nc">MyAverage</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Aggregator</span><span class="p">[</span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="nc">Average</span><span class="p">,</span><span class="w"> </span><span class="nc">Double</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">zero</span><span class="p">:</span><span class="w"> </span><span class="nc">Average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Average</span><span class="p">(</span><span class="il">0L</span><span class="p">,</span><span class="w"> </span><span class="il">0L</span><span class="p">)</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">Average</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">):</span><span class="w"> </span><span class="nc">Average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="w">    </span><span class="n">b</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="n">b1</span><span class="p">:</span><span class="w"> </span><span class="nc">Average</span><span class="p">,</span><span class="w"> </span><span class="n">b2</span><span class="p">:</span><span class="w"> </span><span class="nc">Average</span><span class="p">):</span><span class="w"> </span><span class="nc">Average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a><span class="w">    </span><span class="n">b1</span><span class="p">.</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">sum</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="w">    </span><span class="n">b1</span><span class="p">.</span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b2</span><span class="p">.</span><span class="n">count</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="w">    </span><span class="n">b1</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="n">reduction</span><span class="p">:</span><span class="w"> </span><span class="nc">Average</span><span class="p">):</span><span class="w"> </span><span class="nc">Double</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reduction</span><span class="p">.</span><span class="n">sum</span><span class="p">.</span><span class="n">toDouble</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">reduction</span><span class="p">.</span><span class="n">count</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">bufferEncoder</span><span class="p">:</span><span class="w"> </span><span class="nc">Encoder</span><span class="p">[</span><span class="nc">Average</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Encoders</span><span class="p">.</span><span class="n">product</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">outputEncoder</span><span class="p">:</span><span class="w"> </span><span class="nc">Encoder</span><span class="p">[</span><span class="nc">Double</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Encoders</span><span class="p">.</span><span class="n">scalaDouble</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>使用函数</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">UDAFApp</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">config</span><span class="p">(</span><span class="n">conf</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">    </span><span class="k">import</span><span class="w"> </span><span class="nn">spark</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">    </span><span class="c1">// 创建 DataFrame</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="s">&quot;input/employee.json&quot;</span><span class="p">)</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">    </span><span class="c1">// 创建临时表</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">    </span><span class="n">df</span><span class="p">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">&quot;employee&quot;</span><span class="p">)</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">    </span><span class="c1">// 注册函数</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">udf</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="s">&quot;my_average&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">functions</span><span class="p">.</span><span class="n">udaf</span><span class="p">(</span><span class="nc">MyAverage</span><span class="p">))</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">    </span><span class="c1">// 应用 UDAF</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;select my_average(salary) AS average_salary from employee&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<p><br/></p>
<h3 id="57">5.7 数据的加载和保存<a class="headerlink" href="#57" title="Permanent link">&para;</a></h3>
<h4 id="571">5.7.1 通用的加载和保存方式<a class="headerlink" href="#571" title="Permanent link">&para;</a></h4>
<p>Spark SQL 提供了通用的保存数据和数据加载的方式。这里的通用指的是使用相同的 API，根据不同的参数读取和保存不同格式的数据， Spark SQL 默认读取和保存的文件格式为 Parquet。</p>
<h4 id="572-parquet">5.7.2 Parquet<a class="headerlink" href="#572-parquet" title="Permanent link">&para;</a></h4>
<p>Spark SQL 的默认数据源为 Parquet 格式。Parquet 是一种能够有效存储嵌套数据的列式存储格式。</p>
<p>数据源为 Parquet 的文件时，Spark SQL 可以方便的执行所有的操作，不需要使用 <code>format</code>。修改配置项 <code>spark.sql.sources.default</code>，可修改默认数据源格式。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="s">&quot;input/employee.json&quot;</span><span class="p">)</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="n">df1</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="nc">SaveMode</span><span class="p">.</span><span class="nc">Overwrite</span><span class="p">).</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;input/employee&quot;</span><span class="p">)</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="kd">val</span><span class="w"> </span><span class="n">df2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">parquet</span><span class="p">(</span><span class="s">&quot;input/employee&quot;</span><span class="p">)</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="n">df2</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="573-hive">5.7.3 Hive<a class="headerlink" href="#573-hive" title="Permanent link">&para;</a></h4>
<p>Apache Hive 是 Hadoop 上的 SQL 引擎，Spark SQL 编译时可以包含 Hive 支持，也可以不包含。包含 Hive 支持的 Spark SQL 可以支持 Hive 表访问、UDF 以及 Hive 查询语言等。需要强调一点的是，如果要在 Spark SQL 中包含 Hive 的库，并不需要事先安装 Hive。如果你下载的是二进制版本的 Spark，它应该已经在编译时添加了 Hive 支持。</p>
<p>如要把 Spark SQL 连接到一个部署好的 Hive 上，你必须把 <code>hive-site.xml</code> 复制到 Spark 的配置文件目录中。需要注意的是，如果你没有部署好 Hive，Spark SQL 会在当前的工作目录中创建出自己的 Hive 元数据库叫做 <code>metastore_db</code>。</p>
<h5 id="5731-hive">5.7.3.1 外部 Hive<a class="headerlink" href="#5731-hive" title="Permanent link">&para;</a></h5>
<p>如果要连接外部已经部署好的 Hive，需要通过以下几个步骤：</p>
<ol>
<li>Spark 要接管 Hive 需要把 <code>hive-site.xml</code> 拷贝到 <code>conf/</code> 目录下；</li>
<li>把 MySQL 驱动拷贝到 <code>jars/</code> 目录下；</li>
<li>如果访问不到 HDFS，则需要把 <code>core-site.xml</code> 和 <code>hdfs-site.xml</code> 拷贝到 <code>conf/</code> 目录下；</li>
<li>重启 <code>spark-shell</code>；</li>
</ol>
<h5 id="5732-spark-beeline">5.7.3.2 运行 Spark beeline<a class="headerlink" href="#5732-spark-beeline" title="Permanent link">&para;</a></h5>
<p>Spark Thrift Server 是 Spark 社区基于 HiveServer2 实现的一个 Thrift 服务，旨在无缝兼容 HiveServer2。因为 Spark Thrift Server 的接口和协议都和 HiveServer2 完全一致，因此我们部署好 Spark Thrift Server 后，可以直接使用 Hive 的 <code>beeline</code> 访问 Spark Thrift Server 执行相关语句。Spark Thrift Server 的目的也只是取代 HiveServer2，因此它依旧可以和 Hive Metastore 进行交互，获取到 Hive 的元数据。</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>sbin/start-thriftserver.sh
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>bin/beeline<span class="w"> </span>-u<span class="w"> </span>jdbc:hive2://vm101:10000<span class="w"> </span>-n<span class="w"> </span>root
</span></code></pre></div>
<h5 id="5733-hive">5.7.3.3 代码操作 Hive<a class="headerlink" href="#5733-hive" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>导入依赖</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spark-hive_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>${spark.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>将 <code>hive-site.xml</code> 拷贝到项目的 <code>resources/</code> 目录中</p>
</li>
<li>
<p><code>show tables</code></p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App5</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">      </span><span class="p">.</span><span class="n">builder</span><span class="p">()</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">      </span><span class="p">.</span><span class="n">appName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">)</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">      </span><span class="p">.</span><span class="n">master</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">      </span><span class="p">.</span><span class="n">enableHiveSupport</span><span class="p">()</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">      </span><span class="c1">// 在开发工具中创建数据库默认是在本地仓库</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">      </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.sql.warehourse.dir&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hdfs://vm101:9000/user/hive/warehourse&quot;</span><span class="p">)</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">      </span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">    </span><span class="k">import</span><span class="w"> </span><span class="nn">spark</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;show tables&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<p><br/><br/></p>
<h2 id="spark-sql_2">六、Spark SQL 项目实战<a class="headerlink" href="#spark-sql_2" title="Permanent link">&para;</a></h2>
<p><br/></p>
<h3 id="61">6.1 数据准备<a class="headerlink" href="#61" title="Permanent link">&para;</a></h3>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">createTable</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">      </span><span class="s">&quot;&quot;&quot;</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="s">        |create table if not exists `user_visit_action`(</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="s">        |  `date`               string,</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="s">        |  `user_id`            bigint,</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="s">        |  `session_id`         string,</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="s">        |  `page_id`            bigint,</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="s">        |  `action_time`        string,</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="s">        |  `search_keyword`     string,</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="s">        |  `click_category_id`  bigint,</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="s">        |  `click_product_id`   bigint,</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="s">        |  `order_category_ids` string,</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="s">        |  `order_product_ids`  string,</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="s">        |  `pay_category_ids`   string,</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="s">        |  `pay_product_ids`    string,</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="s">        |  `city_id`            bigint</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="s">        |)</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="s">        |row format delimited fields terminated by &#39;\t&#39;</span>
</span><span id="__span-88-20"><a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a><span class="s">        |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-88-21"><a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="w">    </span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-88-22"><a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span>
</span><span id="__span-88-23"><a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a><span class="w">      </span><span class="s">&quot;&quot;&quot;</span>
</span><span id="__span-88-24"><a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a><span class="s">        |create table if not exists `product_info`(</span>
</span><span id="__span-88-25"><a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a><span class="s">        |  `product_id`   bigint,</span>
</span><span id="__span-88-26"><a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a><span class="s">        |  `product_name` string,</span>
</span><span id="__span-88-27"><a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a><span class="s">        |  `extend_info`  string</span>
</span><span id="__span-88-28"><a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a><span class="s">        |)</span>
</span><span id="__span-88-29"><a id="__codelineno-88-29" name="__codelineno-88-29" href="#__codelineno-88-29"></a><span class="s">        |row format delimited fields terminated by &#39;\t&#39;</span>
</span><span id="__span-88-30"><a id="__codelineno-88-30" name="__codelineno-88-30" href="#__codelineno-88-30"></a><span class="s">        |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-88-31"><a id="__codelineno-88-31" name="__codelineno-88-31" href="#__codelineno-88-31"></a><span class="w">    </span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-88-32"><a id="__codelineno-88-32" name="__codelineno-88-32" href="#__codelineno-88-32"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span>
</span><span id="__span-88-33"><a id="__codelineno-88-33" name="__codelineno-88-33" href="#__codelineno-88-33"></a><span class="w">      </span><span class="s">&quot;&quot;&quot;</span>
</span><span id="__span-88-34"><a id="__codelineno-88-34" name="__codelineno-88-34" href="#__codelineno-88-34"></a><span class="s">        |create table if not exists `city_info`(</span>
</span><span id="__span-88-35"><a id="__codelineno-88-35" name="__codelineno-88-35" href="#__codelineno-88-35"></a><span class="s">        |  `city_id`   bigint,</span>
</span><span id="__span-88-36"><a id="__codelineno-88-36" name="__codelineno-88-36" href="#__codelineno-88-36"></a><span class="s">        |  `city_name` string,</span>
</span><span id="__span-88-37"><a id="__codelineno-88-37" name="__codelineno-88-37" href="#__codelineno-88-37"></a><span class="s">        |  `area`      string</span>
</span><span id="__span-88-38"><a id="__codelineno-88-38" name="__codelineno-88-38" href="#__codelineno-88-38"></a><span class="s">        |)</span>
</span><span id="__span-88-39"><a id="__codelineno-88-39" name="__codelineno-88-39" href="#__codelineno-88-39"></a><span class="s">        |row format delimited fields terminated by &#39;\t&#39;</span>
</span><span id="__span-88-40"><a id="__codelineno-88-40" name="__codelineno-88-40" href="#__codelineno-88-40"></a><span class="s">        |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-88-41"><a id="__codelineno-88-41" name="__codelineno-88-41" href="#__codelineno-88-41"></a><span class="w">    </span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-88-42"><a id="__codelineno-88-42" name="__codelineno-88-42" href="#__codelineno-88-42"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">loadData</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;load data local inpath &#39;input/user_visit_action.txt&#39; overwrite into table user_visit_action;&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;load data local inpath &#39;input/product_info.txt&#39; overwrite into table product_info;&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">&quot;load data local inpath &#39;input/city_info.txt&#39; overwrite into table city_info;&quot;</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="62-top3">6.2 需求（各区域热门商品 Top3）<a class="headerlink" href="#62-top3" title="Permanent link">&para;</a></h3>
<h4 id="621">6.2.1 需求简介<a class="headerlink" href="#621" title="Permanent link">&para;</a></h4>
<p>这里的热门商品是从点击量的维度来看的，计算各个区域前三大热门商品，并备注上每个商品在主要城市中的分布比例，超过两个城市用其他显示。</p>
<p>例如：</p>
<table>
<thead>
<tr>
<th>地区</th>
<th>商品名称</th>
<th>点击次数</th>
<th>城市备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>华北</td>
<td>商品 A</td>
<td>100000</td>
<td>北京 21.2%，天津 13.2%，其他 65.6%</td>
</tr>
<tr>
<td>华北</td>
<td>商品 P</td>
<td>80200</td>
<td>北京 63.0%，太原 10%，其他 27.0%</td>
</tr>
<tr>
<td>华北</td>
<td>商品 M</td>
<td>40000</td>
<td>北京 63.0%，太原 10%，其他 27.0%</td>
</tr>
<tr>
<td>华北</td>
<td>商品 J</td>
<td>92000</td>
<td>大连 28%，辽宁 17.0%，其他 55.0%</td>
</tr>
</tbody>
</table>
<h4 id="622">6.2.2 需求分析<a class="headerlink" href="#622" title="Permanent link">&para;</a></h4>
<ul>
<li>查询出来所有的点击记录，与 <code>city_info</code> 表连接，得到每个城市所在的地区，与 <code>product_info</code> 表连接得到产品名称；</li>
<li>按照地区和商品 ID 进行分组，统计出每个商品在每个地区的总点击次数；</li>
<li>每个地区内按照点击次数降序排列；</li>
<li>只取前三名；</li>
<li>城市备注需要自定义 UDAF 函数；</li>
</ul>
<h4 id="633">6.3.3 功能实现<a class="headerlink" href="#633" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>自定义 UDAF</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">cityMap</span><span class="p">:</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">])</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">  </span><span class="k">object</span><span class="w"> </span><span class="nc">CityRemark</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Aggregator</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">zero</span><span class="p">:</span><span class="w"> </span><span class="nc">CityRemark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">(</span><span class="il">0L</span><span class="p">,</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Long</span><span class="p">]())</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">reduce</span><span class="p">(</span><span class="n">buffer</span><span class="p">:</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">CityRemark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">      </span><span class="n">buffer</span><span class="p">.</span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">      </span><span class="n">buffer</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="il">0L</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">      </span><span class="n">buffer</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="n">buffer1</span><span class="p">:</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">,</span><span class="w"> </span><span class="n">buffer2</span><span class="p">:</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">):</span><span class="w"> </span><span class="nc">CityRemark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">      </span><span class="n">buffer1</span><span class="p">.</span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">buffer2</span><span class="p">.</span><span class="n">total</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">      </span><span class="n">buffer2</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">buffer1</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">buffer1</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="il">0L</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a><span class="w">      </span><span class="n">buffer1</span>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="n">reduction</span><span class="p">:</span><span class="w"> </span><span class="nc">CityRemark</span><span class="p">):</span><span class="w"> </span><span class="nc">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">remarkList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">String</span><span class="p">]()</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a><span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">0L</span>
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a>
</span><span id="__span-90-24"><a id="__codelineno-90-24" name="__codelineno-90-24" href="#__codelineno-90-24"></a><span class="w">      </span><span class="n">reduction</span>
</span><span id="__span-90-25"><a id="__codelineno-90-25" name="__codelineno-90-25" href="#__codelineno-90-25"></a><span class="w">        </span><span class="p">.</span><span class="n">cityMap</span>
</span><span id="__span-90-26"><a id="__codelineno-90-26" name="__codelineno-90-26" href="#__codelineno-90-26"></a><span class="w">        </span><span class="p">.</span><span class="n">toList</span>
</span><span id="__span-90-27"><a id="__codelineno-90-27" name="__codelineno-90-27" href="#__codelineno-90-27"></a><span class="w">        </span><span class="p">.</span><span class="n">sortWith</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">_2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">_2</span><span class="p">)</span>
</span><span id="__span-90-28"><a id="__codelineno-90-28" name="__codelineno-90-28" href="#__codelineno-90-28"></a><span class="w">        </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-90-29"><a id="__codelineno-90-29" name="__codelineno-90-29" href="#__codelineno-90-29"></a><span class="w">        </span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-30"><a id="__codelineno-90-30" name="__codelineno-90-30" href="#__codelineno-90-30"></a><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">cnt</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-31"><a id="__codelineno-90-31" name="__codelineno-90-31" href="#__codelineno-90-31"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="n">percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">reduction</span><span class="p">.</span><span class="n">total</span>
</span><span id="__span-90-32"><a id="__codelineno-90-32" name="__codelineno-90-32" href="#__codelineno-90-32"></a><span class="w">            </span><span class="n">remarkList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">${</span><span class="n">city</span><span class="si">}</span><span class="s"> </span><span class="si">${</span><span class="n">percentage</span><span class="si">}</span><span class="s">%&quot;</span><span class="p">)</span>
</span><span id="__span-90-33"><a id="__codelineno-90-33" name="__codelineno-90-33" href="#__codelineno-90-33"></a><span class="w">            </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">percentage</span>
</span><span id="__span-90-34"><a id="__codelineno-90-34" name="__codelineno-90-34" href="#__codelineno-90-34"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-90-35"><a id="__codelineno-90-35" name="__codelineno-90-35" href="#__codelineno-90-35"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-90-36"><a id="__codelineno-90-36" name="__codelineno-90-36" href="#__codelineno-90-36"></a>
</span><span id="__span-90-37"><a id="__codelineno-90-37" name="__codelineno-90-37" href="#__codelineno-90-37"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reduction</span><span class="p">.</span><span class="n">cityMap</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-38"><a id="__codelineno-90-38" name="__codelineno-90-38" href="#__codelineno-90-38"></a><span class="w">        </span><span class="n">remarkList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">s&quot;其他 </span><span class="si">${</span><span class="mi">100</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="si">}</span><span class="s">%&quot;</span><span class="p">)</span>
</span><span id="__span-90-39"><a id="__codelineno-90-39" name="__codelineno-90-39" href="#__codelineno-90-39"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-90-40"><a id="__codelineno-90-40" name="__codelineno-90-40" href="#__codelineno-90-40"></a>
</span><span id="__span-90-41"><a id="__codelineno-90-41" name="__codelineno-90-41" href="#__codelineno-90-41"></a><span class="w">      </span><span class="n">remarkList</span><span class="p">.</span><span class="n">mkString</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span>
</span><span id="__span-90-42"><a id="__codelineno-90-42" name="__codelineno-90-42" href="#__codelineno-90-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-90-43"><a id="__codelineno-90-43" name="__codelineno-90-43" href="#__codelineno-90-43"></a>
</span><span id="__span-90-44"><a id="__codelineno-90-44" name="__codelineno-90-44" href="#__codelineno-90-44"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">bufferEncoder</span><span class="p">:</span><span class="w"> </span><span class="nc">Encoder</span><span class="p">[</span><span class="nc">CityRemark</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Encoders</span><span class="p">.</span><span class="n">product</span>
</span><span id="__span-90-45"><a id="__codelineno-90-45" name="__codelineno-90-45" href="#__codelineno-90-45"></a>
</span><span id="__span-90-46"><a id="__codelineno-90-46" name="__codelineno-90-46" href="#__codelineno-90-46"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">outputEncoder</span><span class="p">:</span><span class="w"> </span><span class="nc">Encoder</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Encoders</span><span class="p">.</span><span class="nc">STRING</span>
</span><span id="__span-90-47"><a id="__codelineno-90-47" name="__codelineno-90-47" href="#__codelineno-90-47"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>查询</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="k">from</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="n">over</span><span class="p">(</span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">click_count</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">rank</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">    </span><span class="k">select</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">      </span><span class="n">area</span><span class="p">,</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">      </span><span class="n">product_name</span><span class="p">,</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">      </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">click_count</span><span class="p">,</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">      </span><span class="n">city_remark</span><span class="p">(</span><span class="n">city_name</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">city_remark</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">      </span><span class="k">select</span><span class="w"> </span><span class="n">pi</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">city_name</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">      </span><span class="k">from</span><span class="w"> </span><span class="n">user_visit_action</span><span class="w"> </span><span class="n">uva</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">      </span><span class="k">join</span><span class="w"> </span><span class="n">product_info</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">pi</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uva</span><span class="p">.</span><span class="n">click_product_id</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="w">      </span><span class="k">join</span><span class="w"> </span><span class="n">city_info</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">city_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uva</span><span class="p">.</span><span class="n">city_id</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="w">      </span><span class="k">where</span><span class="w"> </span><span class="n">uva</span><span class="p">.</span><span class="n">click_product_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">t1</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">area</span>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="n">t2</span>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="p">)</span><span class="w"> </span><span class="n">t3</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="k">where</span><span class="w"> </span><span class="n">rank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span>
</span></code></pre></div>
</li>
<li>
<p>入口</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">appName</span><span class="p">(</span><span class="s">&quot;Requirement1&quot;</span><span class="p">).</span><span class="n">master</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">).</span><span class="n">enableHiveSupport</span><span class="p">().</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">    </span><span class="k">import</span><span class="w"> </span><span class="nn">spark</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">    </span><span class="c1">// 注册函数</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w">    </span><span class="n">spark</span><span class="p">.</span><span class="n">udf</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="s">&quot;city_remark&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">functions</span><span class="p">.</span><span class="n">udaf</span><span class="p">(</span><span class="nc">CityRemark</span><span class="p">))</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">    </span><span class="c1">// 建表</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">    </span><span class="c1">// createTable(spark)</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">    </span><span class="c1">// 导入数据</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">    </span><span class="c1">// loadData(spark)</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">    </span><span class="c1">// 查询 Top3</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">    </span><span class="n">showTop3</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<p><br/><br/></p>
<h2 id="spark-streaming">七、Spark Streaming 概述<a class="headerlink" href="#spark-streaming" title="Permanent link">&para;</a></h2>
<h3 id="71-spark-streaming">7.1 Spark Streaming 是什么<a class="headerlink" href="#71-spark-streaming" title="Permanent link">&para;</a></h3>
<p>和 Spark 基于 RDD 的概念很相似，Spark Streaming 使用离散化流（Deiscretized Stream）作为抽象表示，叫做 DStream。DStream 是随时间推移而收到的数据的序列。在内部，每个时间区间收到的数据都作为 RDD 存在，而 DStream 是由这些 RDD 所组成的序列（因此得名"离散化"）。所以简单来讲，DStream 就是对 RDD 在实时数据处理场景的一种封装。</p>
<p><br/><br/></p>
<h2 id="spark-streaming_1">八、Spark Streaming 核心编程<a class="headerlink" href="#spark-streaming_1" title="Permanent link">&para;</a></h2>
<h3 id="81">8.1 依赖<a class="headerlink" href="#81" title="Permanent link">&para;</a></h3>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spark-streaming_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>${spark.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="82-dsteam">8.2 DSteam 创建<a class="headerlink" href="#82-dsteam" title="Permanent link">&para;</a></h3>
<h4 id="821-socket">8.2.1 Socket 数据源<a class="headerlink" href="#821-socket" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>NetCat</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>nc<span class="w"> </span>-lk<span class="w"> </span><span class="m">9999</span>
</span></code></pre></div>
</li>
<li>
<p>WordCount</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">5L</span><span class="p">))</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">      </span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h4 id="822-rdd">8.2.2 RDD 队列<a class="headerlink" href="#822-rdd" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">4L</span><span class="p">))</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">    </span><span class="c1">// 创建 RDD 队列</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">rddQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">mutable</span><span class="p">.</span><span class="nc">Queue</span><span class="p">[</span><span class="nc">RDD</span><span class="p">[</span><span class="nc">Int</span><span class="p">]]()</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">      </span><span class="p">.</span><span class="n">queueStream</span><span class="p">(</span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rddQueue</span><span class="p">,</span><span class="w"> </span><span class="n">oneAtATime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a>
</span><span id="__span-96-15"><a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-96-16"><a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a>
</span><span id="__span-96-17"><a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a><span class="w">    </span><span class="c1">// 循环创建 RDD 并放入队列中</span>
</span><span id="__span-96-18"><a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-19"><a id="__codelineno-96-19" name="__codelineno-96-19" href="#__codelineno-96-19"></a><span class="w">      </span><span class="n">rddQueue</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ssc</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">makeRDD</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-96-20"><a id="__codelineno-96-20" name="__codelineno-96-20" href="#__codelineno-96-20"></a><span class="w">      </span><span class="nc">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
</span><span id="__span-96-21"><a id="__codelineno-96-21" name="__codelineno-96-21" href="#__codelineno-96-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-96-22"><a id="__codelineno-96-22" name="__codelineno-96-22" href="#__codelineno-96-22"></a>
</span><span id="__span-96-23"><a id="__codelineno-96-23" name="__codelineno-96-23" href="#__codelineno-96-23"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-96-24"><a id="__codelineno-96-24" name="__codelineno-96-24" href="#__codelineno-96-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-96-25"><a id="__codelineno-96-25" name="__codelineno-96-25" href="#__codelineno-96-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="823-kafka">8.2.3 Kafka 数据源<a class="headerlink" href="#823-kafka" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>依赖</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spark-streaming-kafka-0-10_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>${spark.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>程序</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">5L</span><span class="p">))</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">kafkaParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Object</span><span class="p">](</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">BOOTSTRAP_SERVERS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;vm101:9092&quot;</span><span class="p">,</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">GROUP_ID_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;consumer_demo&quot;</span><span class="p">,</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">,</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="w">    </span><span class="nc">KafkaUtils</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="w">      </span><span class="p">.</span><span class="n">createDirectStream</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="w">        </span><span class="n">ssc</span><span class="p">,</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="w">        </span><span class="nc">LocationStrategies</span><span class="p">.</span><span class="nc">PreferConsistent</span><span class="p">,</span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="w">        </span><span class="nc">ConsumerStrategies</span><span class="p">.</span><span class="nc">Subscribe</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="nc">Set</span><span class="p">(</span><span class="s">&quot;topic_demo&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">kafkaParams</span><span class="p">)</span>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-98-21"><a id="__codelineno-98-21" name="__codelineno-98-21" href="#__codelineno-98-21"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-98-22"><a id="__codelineno-98-22" name="__codelineno-98-22" href="#__codelineno-98-22"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-98-23"><a id="__codelineno-98-23" name="__codelineno-98-23" href="#__codelineno-98-23"></a>
</span><span id="__span-98-24"><a id="__codelineno-98-24" name="__codelineno-98-24" href="#__codelineno-98-24"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-98-25"><a id="__codelineno-98-25" name="__codelineno-98-25" href="#__codelineno-98-25"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-98-26"><a id="__codelineno-98-26" name="__codelineno-98-26" href="#__codelineno-98-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-98-27"><a id="__codelineno-98-27" name="__codelineno-98-27" href="#__codelineno-98-27"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h4 id="824">8.2.4 自定义数据源<a class="headerlink" href="#824" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>自定义数据源</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomReceiver</span><span class="p">(</span><span class="n">host</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Receiver</span><span class="p">[</span><span class="nc">String</span><span class="p">](</span><span class="nc">StorageLevel</span><span class="p">.</span><span class="nc">MEMORY_ONLY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">onStart</span><span class="p">():</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w">      </span><span class="k">new</span><span class="w"> </span><span class="nc">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Socket</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">);</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">BufferedReader</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">InputStreamReader</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">,</span><span class="w"> </span><span class="nc">StandardCharsets</span><span class="p">.</span><span class="nc">UTF_8</span><span class="p">))</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">()</span>
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="bp">super</span><span class="p">.</span><span class="n">isStopped</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="w">          </span><span class="bp">super</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="w">          </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">()</span>
</span><span id="__span-99-11"><a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-99-12"><a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a>
</span><span id="__span-99-13"><a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a><span class="w">        </span><span class="n">reader</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-99-14"><a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="w">        </span><span class="n">socket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-99-15"><a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a>
</span><span id="__span-99-16"><a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a><span class="w">        </span><span class="bp">super</span><span class="p">.</span><span class="n">restart</span><span class="p">(</span><span class="s">&quot;restart&quot;</span><span class="p">)</span>
</span><span id="__span-99-17"><a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a><span class="w">      </span><span class="p">}).</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-99-18"><a id="__codelineno-99-18" name="__codelineno-99-18" href="#__codelineno-99-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-99-19"><a id="__codelineno-99-19" name="__codelineno-99-19" href="#__codelineno-99-19"></a>
</span><span id="__span-99-20"><a id="__codelineno-99-20" name="__codelineno-99-20" href="#__codelineno-99-20"></a><span class="w">    </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">onStop</span><span class="p">():</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-99-21"><a id="__codelineno-99-21" name="__codelineno-99-21" href="#__codelineno-99-21"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>程序</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">3L</span><span class="p">))</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">      </span><span class="p">.</span><span class="n">receiverStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">CustomReceiver</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">))</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-100-15"><a id="__codelineno-100-15" name="__codelineno-100-15" href="#__codelineno-100-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-100-16"><a id="__codelineno-100-16" name="__codelineno-100-16" href="#__codelineno-100-16"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<p><br/></p>
<h3 id="83-dstream">8.3 DStream 转换<a class="headerlink" href="#83-dstream" title="Permanent link">&para;</a></h3>
<p>DStream 上的操作与 RDD 的类似，分为 Transformations（转换）和 Output Operations（输出）两种，此外转换操作中海油一些比较特殊的原语，如 <code>updateStateByKey()</code>、<code>transform()</code> 以及各种 Window 相关的原语。</p>
<h4 id="831">8.3.1 无状态转换操作<a class="headerlink" href="#831" title="Permanent link">&para;</a></h4>
<p>无状态转换操作就是把简单的 RDD 转换操作应用到每个批次上，也就是转换 DStream 中的每一个 RDD。注意，针对键值对的 DStream 转换操作（比如 <code>reduceByKey()</code>） 要添加 <code>import StreamingContext._</code> 才能在 Scala 中使用。</p>
<p>需要记住的是，尽管这些函数看起来像作用在真个流上一样，但事实上每个 DStream 在内部是由许多 RDD（批次）组成，且无状态转换操作是分别应用到每个 RDD 上的。</p>
<h5 id="8311-transform">8.3.1.1 Transform<a class="headerlink" href="#8311-transform" title="Permanent link">&para;</a></h5>
<p>Transform 操作允许在 DStream 上执行任意的 RDD-to-RDD 函数。即使这些函数并没有在 DStream 的 API 中暴露出来，但通过该函数可以方便的扩展 Spark API。该函数每一批次调度一次。其实也就是对 DStream 中的 RDD 应用转换。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">3L</span><span class="p">))</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w">      </span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">      </span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rdd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="w">        </span><span class="n">rdd</span>
</span><span id="__span-101-10"><a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="w">          </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-101-11"><a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="w">          </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-101-12"><a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="w">          </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-101-13"><a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-101-14"><a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-101-15"><a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a>
</span><span id="__span-101-16"><a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-101-17"><a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-101-18"><a id="__codelineno-101-18" name="__codelineno-101-18" href="#__codelineno-101-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-101-19"><a id="__codelineno-101-19" name="__codelineno-101-19" href="#__codelineno-101-19"></a><span class="p">}</span>
</span></code></pre></div>
<h5 id="8312-join">8.3.1.2 join<a class="headerlink" href="#8312-join" title="Permanent link">&para;</a></h5>
<p>两个流之间的 join 需要两个流的批次大小一致，这样才能做到同时触发计算。计算过程就是对当前批次的两个流中各自的 RDD 进行 join，与两个 RDD 的 join 效果相同。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">3L</span><span class="p">))</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">lineDStream1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssc</span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">lineDStream2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssc</span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8888</span><span class="p">)</span>
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a>
</span><span id="__span-102-9"><a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineDStream1</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)).</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-102-10"><a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineDStream2</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)).</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-102-11"><a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a>
</span><span id="__span-102-12"><a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="w">    </span><span class="n">s1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">s2</span><span class="p">).</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-102-13"><a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a>
</span><span id="__span-102-14"><a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-102-15"><a id="__codelineno-102-15" name="__codelineno-102-15" href="#__codelineno-102-15"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-102-16"><a id="__codelineno-102-16" name="__codelineno-102-16" href="#__codelineno-102-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-102-17"><a id="__codelineno-102-17" name="__codelineno-102-17" href="#__codelineno-102-17"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="832">8.3.2 有状态转换操作<a class="headerlink" href="#832" title="Permanent link">&para;</a></h4>
<h5 id="8321-updatestatebykey">8.3.2.1 <code>updateStateByKey</code><a class="headerlink" href="#8321-updatestatebykey" title="Permanent link">&para;</a></h5>
<p><code>updateStateByKey</code> 原语用于记录历史记录，有时我们需要在 DStream 中跨批次维护状态（例如流计算中累加 WordCount）。针对这种情况，<code>updateStateByKey</code> 为我们提供了对一个状态变量的访问，用于键值对形式的 DStream。给定一个由（键，事件）对构成的 DStream，并传递一个指定如何根据新的事件更新每个键对应状态的函数，它可以构建出一个新的 DStream，其内部数据为（键，状态）对。</p>
<p><code>updateStateByKey</code> 需要对检查点目录进行配置，会使用检查点来保存状态。</p>
<p><code>updateStateByKey</code> 的结果会是一个新的 DStream，其内部的 RDD 序列时由每个时间区间对应的（键，状态）对组成的。</p>
<p><code>updateStateByKey</code> 操作使得我们可以在用新消息进行更新时保持任意的状态。为使用这个功能，需要做以下两步：</p>
<ol>
<li>定义状态：状态可以是一个任意的数据类型；</li>
<li>定义状态更新函数，用此函数阐明如何使用之前的状态和来自输入流的新键值对状态进行更新；</li>
</ol>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">3L</span><span class="p">))</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">    </span><span class="c1">// 设置检查点</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">checkpoint</span><span class="p">(</span><span class="s">&quot;checkpoint&quot;</span><span class="p">)</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">    </span><span class="c1">// 定义更新状态函数</span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">updateFunc</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">Int</span><span class="p">],</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Int</span><span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">      </span><span class="c1">// 参数 values 为当前批次单词频度</span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">      </span><span class="c1">// 参数 state  为以往批次单词频度</span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">currCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">sum</span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">prevCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="w">      </span><span class="nc">Some</span><span class="p">(</span><span class="n">currCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">prevCount</span><span class="p">)</span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-103-17"><a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a>
</span><span id="__span-103-18"><a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-103-19"><a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a><span class="w">      </span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-103-20"><a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-103-21"><a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-103-22"><a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">      </span><span class="p">.</span><span class="n">updateStateByKey</span><span class="p">[</span><span class="nc">Int</span><span class="p">](</span><span class="n">updateFunc</span><span class="p">)</span>
</span><span id="__span-103-23"><a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-103-24"><a id="__codelineno-103-24" name="__codelineno-103-24" href="#__codelineno-103-24"></a>
</span><span id="__span-103-25"><a id="__codelineno-103-25" name="__codelineno-103-25" href="#__codelineno-103-25"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-103-26"><a id="__codelineno-103-26" name="__codelineno-103-26" href="#__codelineno-103-26"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-103-27"><a id="__codelineno-103-27" name="__codelineno-103-27" href="#__codelineno-103-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-103-28"><a id="__codelineno-103-28" name="__codelineno-103-28" href="#__codelineno-103-28"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="833-window-operations">8.3.3 Window Operations<a class="headerlink" href="#833-window-operations" title="Permanent link">&para;</a></h4>
<p>Window Operations 可以设置窗口的大小和滑动窗口的间隔来动态的获取当前 Streaming 的状态。所有基于窗口的操作都需要两个参数，分别为窗口时长以及滑动步长。</p>
<ul>
<li>窗口时长：计算内容的时间范围；</li>
<li>滑动步长：隔多久触发一次计算；</li>
</ul>
<p>注意：这两者都必须为采集周期大小的整数倍。</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;App&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">3L</span><span class="p">))</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="w">      </span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKeyAndWindow</span><span class="p">(</span>
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">        </span><span class="n">reduceFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">        </span><span class="n">windowDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
</span><span id="__span-104-13"><a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="w">        </span><span class="n">slideDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-104-14"><a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-104-15"><a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-104-16"><a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a>
</span><span id="__span-104-17"><a id="__codelineno-104-17" name="__codelineno-104-17" href="#__codelineno-104-17"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-104-18"><a id="__codelineno-104-18" name="__codelineno-104-18" href="#__codelineno-104-18"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-104-19"><a id="__codelineno-104-19" name="__codelineno-104-19" href="#__codelineno-104-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-104-20"><a id="__codelineno-104-20" name="__codelineno-104-20" href="#__codelineno-104-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>关于 Window 的操作还有如下方法：</p>
<ul>
<li>
<p><code>window(windowLength, slideInterval)</code></p>
<p>基于对源 DStream 窗化的批次进行计算返回一个新的 DStream。</p>
</li>
<li>
<p><code>countByWindow(windowLength, slideInterval)</code></p>
<p>返回一个滑动窗口计算流中的元素个数。</p>
</li>
<li>
<p><code>reduceByWindow(func, windowLength, slideInterval)</code></p>
<p>通过自定义函数整合滑动区间流元素来创建一个新的单元素的流。</p>
</li>
<li>
<p><code>reduceByKeyAndWindow(func, windowLength, slideInterval)</code></p>
<p>当在一个键值对的 DStream 上调用此函数，会返回一个新键值对的 DStream，通过对滑动窗口中批次数据使用 Reduce 函数来整合每个 Key 的 value 值。</p>
</li>
<li>
<p><code>reduceByKeyAndWindow(func, invFunc, windowLength, slideInterval)</code></p>
<p>这个函数是上述函数的变化版本，每个窗口得到 Reduce 值都是通过前一个窗口的 Reduce 值来递增计算。</p>
<p>通过 Reduce 进入滑动窗口数据并“反向 Reduce” 离开窗口的旧数据来实现这个操作。一个例子就是随着窗口滑动对 Keys 的“加”、“减”计算。</p>
<p>通过前边介绍可以想到，这个函数只适用于“可逆的 Reduce 函数”。</p>
</li>
</ul>
<p><br/></p>
<h3 id="84-dstream">8.4 DStream 输出<a class="headerlink" href="#84-dstream" title="Permanent link">&para;</a></h3>
<p>输出操作指定了对流数据经转换操作得到的数据所要执行的操作。与 RDD 中的惰性求值类似，如果一个 DStream 及其派生出的 DStream 都没有被执行输出操作，那么这些 DStream 就都不会被求值。如果 StreamingContext 中没有设置输出操作，整个 Context 就都不会启动。</p>
<p>输出操作如下：</p>
<ul>
<li><code>print()</code></li>
<li><code>saveAsTextFiles(prefix, [suffix])</code></li>
<li><code>saveAsObjectFiles(prefix, [suffix])</code></li>
<li><code>saveAsHadoopFiles(prefix, [suffix])</code></li>
<li><code>foreachRDD(func)</code></li>
</ul>
<p>通用的输出操作 <code>foreachRDD()</code> 用来对 DStream 中的 RDD 进行任意计算。这和 <code>transform()</code> 有些类似，都可以让我们访问到任意 RDD。在<code>foreachRDD()</code> 中，可以重用我们在 Spark 中实现的所有 Action 操作。比如，最常见的用例之一就是把数据写到诸如 MySQL 的外部数据库中。</p>
<p><br/></p>
<h3 id="85">8.5 优雅关闭<a class="headerlink" href="#85" title="Permanent link">&para;</a></h3>
<p>流式任务需要 7*24 小时执行，但是有时候涉及到升级代码需要主动停止程序，而分布式程序没办法做到一个个进程去杀死，所以配置优雅的关闭就显得至关重要了。</p>
<p>使用外部文件系统来控制内部程序关闭。</p>
<ul>
<li>
<p><code>MonitorStop</code></p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MonitorStop</span><span class="p">(</span><span class="n">ssc</span><span class="p">:</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">)</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">Runnable</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="w">  </span><span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">():</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">FileSystem</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nc">URI</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;hdfs://vm101:9000&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Configuration</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;root&quot;</span><span class="p">)</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="w">        </span><span class="nc">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">InterruptedException</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Path</span><span class="p">(</span><span class="s">&quot;hdfs://vm101:9000/stop-spark&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ssc</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">StreamingContextState</span><span class="p">.</span><span class="nc">ACTIVE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-105-14"><a id="__codelineno-105-14" name="__codelineno-105-14" href="#__codelineno-105-14"></a><span class="w">          </span><span class="n">ssc</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">stopSparkContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">stopGracefully</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-105-15"><a id="__codelineno-105-15" name="__codelineno-105-15" href="#__codelineno-105-15"></a><span class="w">          </span><span class="nc">System</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-105-16"><a id="__codelineno-105-16" name="__codelineno-105-16" href="#__codelineno-105-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-105-17"><a id="__codelineno-105-17" name="__codelineno-105-17" href="#__codelineno-105-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-105-18"><a id="__codelineno-105-18" name="__codelineno-105-18" href="#__codelineno-105-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-105-19"><a id="__codelineno-105-19" name="__codelineno-105-19" href="#__codelineno-105-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-105-20"><a id="__codelineno-105-20" name="__codelineno-105-20" href="#__codelineno-105-20"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p><code>App</code></p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">.</span><span class="n">getActiveOrCreate</span><span class="p">(</span><span class="s">&quot;checkpoint&quot;</span><span class="p">,()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">createSSC</span><span class="p">())</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nc">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">MonitorStop</span><span class="p">(</span><span class="n">ssc</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a>
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-106-8"><a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-106-9"><a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-106-10"><a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>
</span><span id="__span-106-11"><a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">createSSC</span><span class="p">():</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-12"><a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">).</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;SparkTest&quot;</span><span class="p">)</span>
</span><span id="__span-106-13"><a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a><span class="w">    </span><span class="c1">// 设置优雅关闭</span>
</span><span id="__span-106-14"><a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a><span class="w">    </span><span class="n">conf</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;spark.streaming.stopGracefullyOnShutdown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</span><span id="__span-106-15"><a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a>
</span><span id="__span-106-16"><a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">5L</span><span class="p">))</span>
</span><span id="__span-106-17"><a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">checkpoint</span><span class="p">(</span><span class="s">&quot;./checkpoint&quot;</span><span class="p">)</span>
</span><span id="__span-106-18"><a id="__codelineno-106-18" name="__codelineno-106-18" href="#__codelineno-106-18"></a>
</span><span id="__span-106-19"><a id="__codelineno-106-19" name="__codelineno-106-19" href="#__codelineno-106-19"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">updateFunc</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Seq</span><span class="p">[</span><span class="nc">Int</span><span class="p">],</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Int</span><span class="p">])</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-106-20"><a id="__codelineno-106-20" name="__codelineno-106-20" href="#__codelineno-106-20"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">sum</span>
</span><span id="__span-106-21"><a id="__codelineno-106-21" name="__codelineno-106-21" href="#__codelineno-106-21"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">getOrElse</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-106-22"><a id="__codelineno-106-22" name="__codelineno-106-22" href="#__codelineno-106-22"></a><span class="w">      </span><span class="nc">Some</span><span class="p">(</span><span class="n">curr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">prev</span><span class="p">)</span>
</span><span id="__span-106-23"><a id="__codelineno-106-23" name="__codelineno-106-23" href="#__codelineno-106-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-106-24"><a id="__codelineno-106-24" name="__codelineno-106-24" href="#__codelineno-106-24"></a>
</span><span id="__span-106-25"><a id="__codelineno-106-25" name="__codelineno-106-25" href="#__codelineno-106-25"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-106-26"><a id="__codelineno-106-26" name="__codelineno-106-26" href="#__codelineno-106-26"></a><span class="w">      </span><span class="p">.</span><span class="n">socketTextStream</span><span class="p">(</span><span class="s">&quot;vm101&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">)</span>
</span><span id="__span-106-27"><a id="__codelineno-106-27" name="__codelineno-106-27" href="#__codelineno-106-27"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span id="__span-106-28"><a id="__codelineno-106-28" name="__codelineno-106-28" href="#__codelineno-106-28"></a><span class="w">      </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-106-29"><a id="__codelineno-106-29" name="__codelineno-106-29" href="#__codelineno-106-29"></a><span class="w">      </span><span class="p">.</span><span class="n">updateStateByKey</span><span class="p">(</span><span class="n">updateFunc</span><span class="p">)</span>
</span><span id="__span-106-30"><a id="__codelineno-106-30" name="__codelineno-106-30" href="#__codelineno-106-30"></a><span class="w">      </span><span class="p">.</span><span class="n">print</span><span class="p">()</span>
</span><span id="__span-106-31"><a id="__codelineno-106-31" name="__codelineno-106-31" href="#__codelineno-106-31"></a>
</span><span id="__span-106-32"><a id="__codelineno-106-32" name="__codelineno-106-32" href="#__codelineno-106-32"></a><span class="w">    </span><span class="n">ssc</span>
</span><span id="__span-106-33"><a id="__codelineno-106-33" name="__codelineno-106-33" href="#__codelineno-106-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-106-34"><a id="__codelineno-106-34" name="__codelineno-106-34" href="#__codelineno-106-34"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<p><br/><br/></p>
<h2 id="spark-streaming_2">九、Spark Streaming 案例实操<a class="headerlink" href="#spark-streaming_2" title="Permanent link">&para;</a></h2>
<h3 id="91">9.1 环境准备<a class="headerlink" href="#91" title="Permanent link">&para;</a></h3>
<h4 id="931">9.3.1 数据生成工具类<a class="headerlink" href="#931" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Mock</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Properties</span><span class="p">()</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">ProducerConfig</span><span class="p">.</span><span class="nc">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vm101:9092&quot;</span><span class="p">)</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">ProducerConfig</span><span class="p">.</span><span class="nc">KEY_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="p">)</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="nc">ProducerConfig</span><span class="p">.</span><span class="nc">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span><span class="p">)</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">producer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">KafkaProducer</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="n">properties</span><span class="p">)</span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">areaList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">](</span><span class="s">&quot;华东&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;华南&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;华西&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;华北&quot;</span><span class="p">)</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">cityList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">[</span><span class="nc">String</span><span class="p">](</span><span class="s">&quot;北京&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;上海&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;广州&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;深圳&quot;</span><span class="p">)</span>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Random</span><span class="p">()</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">      </span><span class="c1">// 一次性生成多条消息</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">messageList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">String</span><span class="p">]()</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaList</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="n">areaList</span><span class="p">.</span><span class="n">length</span><span class="p">))</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cityList</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="n">cityList</span><span class="p">.</span><span class="n">length</span><span class="p">))</span>
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-107-21"><a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a><span class="w">        </span><span class="n">messageList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">${</span><span class="n">ts</span><span class="si">}</span><span class="s"> </span><span class="si">${</span><span class="n">area</span><span class="si">}</span><span class="s"> </span><span class="si">${</span><span class="n">city</span><span class="si">}</span><span class="s"> </span><span class="si">${</span><span class="n">user</span><span class="si">}</span><span class="s"> </span><span class="si">${</span><span class="n">ad</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-107-22"><a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-107-23"><a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a><span class="w">      </span><span class="c1">// 一次性发送多条消息</span>
</span><span id="__span-107-24"><a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">futureList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageList</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-25"><a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ProducerRecord</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="s">&quot;topic_demo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-107-26"><a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">producer</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="__span-107-27"><a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a><span class="w">        </span><span class="nc">CompletableFuture</span><span class="p">.</span><span class="n">supplyAsync</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="__span-107-28"><a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-107-29"><a id="__codelineno-107-29" name="__codelineno-107-29" href="#__codelineno-107-29"></a><span class="w">      </span><span class="nc">CompletableFuture</span><span class="p">.</span><span class="n">allOf</span><span class="p">(</span><span class="n">futureList</span><span class="p">:</span><span class="w"> </span><span class="n">_*</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="il">1000L</span><span class="p">,</span><span class="w"> </span><span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span><span class="p">)</span>
</span><span id="__span-107-30"><a id="__codelineno-107-30" name="__codelineno-107-30" href="#__codelineno-107-30"></a><span class="w">      </span><span class="c1">// 打印消息数量</span>
</span><span id="__span-107-31"><a id="__codelineno-107-31" name="__codelineno-107-31" href="#__codelineno-107-31"></a><span class="w">      </span><span class="n">println</span><span class="p">(</span><span class="n">messageList</span><span class="p">.</span><span class="n">length</span><span class="p">)</span>
</span><span id="__span-107-32"><a id="__codelineno-107-32" name="__codelineno-107-32" href="#__codelineno-107-32"></a><span class="w">      </span><span class="nc">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="il">1000L</span><span class="p">)</span>
</span><span id="__span-107-33"><a id="__codelineno-107-33" name="__codelineno-107-33" href="#__codelineno-107-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-107-34"><a id="__codelineno-107-34" name="__codelineno-107-34" href="#__codelineno-107-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-107-35"><a id="__codelineno-107-35" name="__codelineno-107-35" href="#__codelineno-107-35"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="932">9.3.2 数据库操作工具类<a class="headerlink" href="#932" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">JDBCUtil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">datasource</span><span class="p">:</span><span class="w"> </span><span class="nc">DataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init</span><span class="p">()</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="w">  </span><span class="c1">// insert | update | delete</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">sql</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]()):</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="w">    </span><span class="c1">// 定义返回值</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="w">    </span><span class="c1">// 获取连接</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datasource</span><span class="p">.</span><span class="n">getConnection</span><span class="p">()</span>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="n">prepareStatement</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="__span-108-12"><a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a><span class="w">      </span><span class="c1">// 绑定参数</span>
</span><span id="__span-108-13"><a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="w">      </span><span class="n">bind</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-108-14"><a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a><span class="w">      </span><span class="c1">// 执行语句</span>
</span><span id="__span-108-15"><a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">executeUpdate</span><span class="p">()</span>
</span><span id="__span-108-16"><a id="__codelineno-108-16" name="__codelineno-108-16" href="#__codelineno-108-16"></a><span class="w">      </span><span class="c1">// 释放资源</span>
</span><span id="__span-108-17"><a id="__codelineno-108-17" name="__codelineno-108-17" href="#__codelineno-108-17"></a><span class="w">      </span><span class="n">ps</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-108-18"><a id="__codelineno-108-18" name="__codelineno-108-18" href="#__codelineno-108-18"></a><span class="w">      </span><span class="n">connection</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-108-19"><a id="__codelineno-108-19" name="__codelineno-108-19" href="#__codelineno-108-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-20"><a id="__codelineno-108-20" name="__codelineno-108-20" href="#__codelineno-108-20"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span id="__span-108-21"><a id="__codelineno-108-21" name="__codelineno-108-21" href="#__codelineno-108-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-22"><a id="__codelineno-108-22" name="__codelineno-108-22" href="#__codelineno-108-22"></a><span class="w">    </span><span class="n">result</span>
</span><span id="__span-108-23"><a id="__codelineno-108-23" name="__codelineno-108-23" href="#__codelineno-108-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-108-24"><a id="__codelineno-108-24" name="__codelineno-108-24" href="#__codelineno-108-24"></a>
</span><span id="__span-108-25"><a id="__codelineno-108-25" name="__codelineno-108-25" href="#__codelineno-108-25"></a><span class="w">  </span><span class="c1">// select</span>
</span><span id="__span-108-26"><a id="__codelineno-108-26" name="__codelineno-108-26" href="#__codelineno-108-26"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">queryForValList</span><span class="p">[</span><span class="nc">T</span><span class="p">](</span><span class="n">sql</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]()):</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-27"><a id="__codelineno-108-27" name="__codelineno-108-27" href="#__codelineno-108-27"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">T</span><span class="p">]()</span>
</span><span id="__span-108-28"><a id="__codelineno-108-28" name="__codelineno-108-28" href="#__codelineno-108-28"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datasource</span><span class="p">.</span><span class="n">getConnection</span><span class="p">()</span>
</span><span id="__span-108-29"><a id="__codelineno-108-29" name="__codelineno-108-29" href="#__codelineno-108-29"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-30"><a id="__codelineno-108-30" name="__codelineno-108-30" href="#__codelineno-108-30"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="n">prepareStatement</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="__span-108-31"><a id="__codelineno-108-31" name="__codelineno-108-31" href="#__codelineno-108-31"></a><span class="w">      </span><span class="n">bind</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-108-32"><a id="__codelineno-108-32" name="__codelineno-108-32" href="#__codelineno-108-32"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">executeQuery</span><span class="p">()</span>
</span><span id="__span-108-33"><a id="__codelineno-108-33" name="__codelineno-108-33" href="#__codelineno-108-33"></a><span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-34"><a id="__codelineno-108-34" name="__codelineno-108-34" href="#__codelineno-108-34"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span><span id="__span-108-35"><a id="__codelineno-108-35" name="__codelineno-108-35" href="#__codelineno-108-35"></a><span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-108-36"><a id="__codelineno-108-36" name="__codelineno-108-36" href="#__codelineno-108-36"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-108-37"><a id="__codelineno-108-37" name="__codelineno-108-37" href="#__codelineno-108-37"></a><span class="w">      </span><span class="n">ps</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-108-38"><a id="__codelineno-108-38" name="__codelineno-108-38" href="#__codelineno-108-38"></a><span class="w">      </span><span class="n">connection</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-108-39"><a id="__codelineno-108-39" name="__codelineno-108-39" href="#__codelineno-108-39"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-40"><a id="__codelineno-108-40" name="__codelineno-108-40" href="#__codelineno-108-40"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span id="__span-108-41"><a id="__codelineno-108-41" name="__codelineno-108-41" href="#__codelineno-108-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-42"><a id="__codelineno-108-42" name="__codelineno-108-42" href="#__codelineno-108-42"></a><span class="w">    </span><span class="n">result</span>
</span><span id="__span-108-43"><a id="__codelineno-108-43" name="__codelineno-108-43" href="#__codelineno-108-43"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-108-44"><a id="__codelineno-108-44" name="__codelineno-108-44" href="#__codelineno-108-44"></a>
</span><span id="__span-108-45"><a id="__codelineno-108-45" name="__codelineno-108-45" href="#__codelineno-108-45"></a><span class="w">  </span><span class="c1">// select</span>
</span><span id="__span-108-46"><a id="__codelineno-108-46" name="__codelineno-108-46" href="#__codelineno-108-46"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">queryForCaseList</span><span class="p">[</span><span class="nc">T</span><span class="p">](</span><span class="n">sql</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]())(</span><span class="k">implicit</span><span class="w"> </span><span class="n">ct</span><span class="p">:</span><span class="w"> </span><span class="nc">ClassTag</span><span class="p">[</span><span class="nc">T</span><span class="p">]):</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-47"><a id="__codelineno-108-47" name="__codelineno-108-47" href="#__codelineno-108-47"></a><span class="w">    </span><span class="c1">// 定义返回值</span>
</span><span id="__span-108-48"><a id="__codelineno-108-48" name="__codelineno-108-48" href="#__codelineno-108-48"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ListBuffer</span><span class="p">[</span><span class="nc">T</span><span class="p">]()</span>
</span><span id="__span-108-49"><a id="__codelineno-108-49" name="__codelineno-108-49" href="#__codelineno-108-49"></a><span class="w">    </span><span class="c1">// 反射获取类型信息</span>
</span><span id="__span-108-50"><a id="__codelineno-108-50" name="__codelineno-108-50" href="#__codelineno-108-50"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">.</span><span class="n">runtimeClass</span><span class="p">.</span><span class="n">getDeclaredFields</span>
</span><span id="__span-108-51"><a id="__codelineno-108-51" name="__codelineno-108-51" href="#__codelineno-108-51"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">.</span><span class="n">runtimeClass</span><span class="p">.</span><span class="n">getConstructors</span><span class="p">.</span><span class="n">head</span>
</span><span id="__span-108-52"><a id="__codelineno-108-52" name="__codelineno-108-52" href="#__codelineno-108-52"></a><span class="w">    </span><span class="c1">// 获取连接</span>
</span><span id="__span-108-53"><a id="__codelineno-108-53" name="__codelineno-108-53" href="#__codelineno-108-53"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">datasource</span><span class="p">.</span><span class="n">getConnection</span><span class="p">()</span>
</span><span id="__span-108-54"><a id="__codelineno-108-54" name="__codelineno-108-54" href="#__codelineno-108-54"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-55"><a id="__codelineno-108-55" name="__codelineno-108-55" href="#__codelineno-108-55"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="n">prepareStatement</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="__span-108-56"><a id="__codelineno-108-56" name="__codelineno-108-56" href="#__codelineno-108-56"></a><span class="w">      </span><span class="n">bind</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-108-57"><a id="__codelineno-108-57" name="__codelineno-108-57" href="#__codelineno-108-57"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">executeQuery</span><span class="p">()</span>
</span><span id="__span-108-58"><a id="__codelineno-108-58" name="__codelineno-108-58" href="#__codelineno-108-58"></a><span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-59"><a id="__codelineno-108-59" name="__codelineno-108-59" href="#__codelineno-108-59"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fields</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">field</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">getName</span><span class="p">))</span>
</span><span id="__span-108-60"><a id="__codelineno-108-60" name="__codelineno-108-60" href="#__codelineno-108-60"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constructor</span><span class="p">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">:</span><span class="w"> </span><span class="n">_*</span><span class="p">).</span><span class="k">asInstanceOf</span><span class="p">[</span><span class="nc">T</span><span class="p">]</span>
</span><span id="__span-108-61"><a id="__codelineno-108-61" name="__codelineno-108-61" href="#__codelineno-108-61"></a><span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
</span><span id="__span-108-62"><a id="__codelineno-108-62" name="__codelineno-108-62" href="#__codelineno-108-62"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-108-63"><a id="__codelineno-108-63" name="__codelineno-108-63" href="#__codelineno-108-63"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-64"><a id="__codelineno-108-64" name="__codelineno-108-64" href="#__codelineno-108-64"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="nc">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span id="__span-108-65"><a id="__codelineno-108-65" name="__codelineno-108-65" href="#__codelineno-108-65"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-66"><a id="__codelineno-108-66" name="__codelineno-108-66" href="#__codelineno-108-66"></a><span class="w">    </span><span class="n">result</span>
</span><span id="__span-108-67"><a id="__codelineno-108-67" name="__codelineno-108-67" href="#__codelineno-108-67"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-108-68"><a id="__codelineno-108-68" name="__codelineno-108-68" href="#__codelineno-108-68"></a>
</span><span id="__span-108-69"><a id="__codelineno-108-69" name="__codelineno-108-69" href="#__codelineno-108-69"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="n">ps</span><span class="p">:</span><span class="w"> </span><span class="nc">PreparedStatement</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">Any</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-70"><a id="__codelineno-108-70" name="__codelineno-108-70" href="#__codelineno-108-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-71"><a id="__codelineno-108-71" name="__codelineno-108-71" href="#__codelineno-108-71"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">indices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-72"><a id="__codelineno-108-72" name="__codelineno-108-72" href="#__codelineno-108-72"></a><span class="w">        </span><span class="n">ps</span><span class="p">.</span><span class="n">setObject</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="__span-108-73"><a id="__codelineno-108-73" name="__codelineno-108-73" href="#__codelineno-108-73"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-108-74"><a id="__codelineno-108-74" name="__codelineno-108-74" href="#__codelineno-108-74"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-75"><a id="__codelineno-108-75" name="__codelineno-108-75" href="#__codelineno-108-75"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-108-76"><a id="__codelineno-108-76" name="__codelineno-108-76" href="#__codelineno-108-76"></a>
</span><span id="__span-108-77"><a id="__codelineno-108-77" name="__codelineno-108-77" href="#__codelineno-108-77"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span><span class="w"> </span><span class="nc">DataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-78"><a id="__codelineno-108-78" name="__codelineno-108-78" href="#__codelineno-108-78"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">Properties</span><span class="p">()</span>
</span><span id="__span-108-79"><a id="__codelineno-108-79" name="__codelineno-108-79" href="#__codelineno-108-79"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="nc">DruidDataSourceFactory</span><span class="p">.</span><span class="nc">PROP_DRIVERCLASSNAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="p">)</span>
</span><span id="__span-108-80"><a id="__codelineno-108-80" name="__codelineno-108-80" href="#__codelineno-108-80"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="nc">DruidDataSourceFactory</span><span class="p">.</span><span class="nc">PROP_URL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jdbc:mysql://vm101:3306/demo&quot;</span><span class="p">)</span>
</span><span id="__span-108-81"><a id="__codelineno-108-81" name="__codelineno-108-81" href="#__codelineno-108-81"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="nc">DruidDataSourceFactory</span><span class="p">.</span><span class="nc">PROP_USERNAME</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;root&quot;</span><span class="p">)</span>
</span><span id="__span-108-82"><a id="__codelineno-108-82" name="__codelineno-108-82" href="#__codelineno-108-82"></a><span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="nc">DruidDataSourceFactory</span><span class="p">.</span><span class="nc">PROP_PASSWORD</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;root&quot;</span><span class="p">)</span>
</span><span id="__span-108-83"><a id="__codelineno-108-83" name="__codelineno-108-83" href="#__codelineno-108-83"></a><span class="w">    </span><span class="nc">DruidDataSourceFactory</span><span class="p">.</span><span class="n">createDataSource</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span><span id="__span-108-84"><a id="__codelineno-108-84" name="__codelineno-108-84" href="#__codelineno-108-84"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-108-85"><a id="__codelineno-108-85" name="__codelineno-108-85" href="#__codelineno-108-85"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="92">9.2 需求一（广告黑名单）<a class="headerlink" href="#92" title="Permanent link">&para;</a></h3>
<p>实现实时的动态黑名单机制，将每天对某个广告点击超过 100 次的用户拉黑。黑名单保存在 MySQL 中。</p>
<h4 id="931_1">9.3.1 思路分析<a class="headerlink" href="#931_1" title="Permanent link">&para;</a></h4>
<ol>
<li>读取 Kafka 数据之后，并对 MySQL 中存储的黑名单数据做校验；</li>
<li>校验通过则对用户点击广告次数累加一并存入 MySQL 中；</li>
<li>在存入 MySQL 之后对数据做校验，如果单日超过 100 次则将该用户拉入黑名单；</li>
</ol>
<h4 id="932-mysql">9.3.2 MySQL 建表<a class="headerlink" href="#932-mysql" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">blacklist</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">    </span><span class="k">user</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="p">)</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="p">);</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">user_ad_count</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">    </span><span class="nb">date</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">    </span><span class="k">user</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">    </span><span class="n">ad</span><span class="w">    </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">    </span><span class="k">count</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="nb">date</span><span class="p">,</span><span class="w"> </span><span class="k">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">)</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a><span class="p">);</span>
</span></code></pre></div>
<h4 id="933">9.3.3 功能实现<a class="headerlink" href="#933" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement1</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement1&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">kafkaParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Object</span><span class="p">](</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">BOOTSTRAP_SERVERS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;vm101:9092&quot;</span><span class="p">,</span>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">GROUP_ID_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;consumer_demo&quot;</span><span class="p">,</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">,</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">    </span><span class="nc">KafkaUtils</span>
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">      </span><span class="p">.</span><span class="n">createDirectStream</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="n">ssc</span><span class="p">,</span><span class="w"> </span><span class="nc">LocationStrategies</span><span class="p">.</span><span class="nc">PreferConsistent</span><span class="p">,</span><span class="w"> </span><span class="nc">ConsumerStrategies</span><span class="p">.</span><span class="nc">Subscribe</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="nc">Set</span><span class="p">(</span><span class="s">&quot;topic_demo&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">kafkaParams</span><span class="p">))</span>
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">      </span><span class="c1">// filter + map</span>
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">record</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-18"><a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">ADClick</span><span class="p">](</span><span class="nc">ADClick</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">))</span>
</span><span id="__span-110-19"><a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">ADClick</span><span class="p">]()</span>
</span><span id="__span-110-20"><a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-110-21"><a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a><span class="w">      </span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rdd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-22"><a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="w">        </span><span class="c1">// 过滤黑名单内数据</span>
</span><span id="__span-110-23"><a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">blacklistList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">JDBCUtil</span><span class="p">.</span><span class="n">queryForValList</span><span class="p">[</span><span class="nc">String</span><span class="p">](</span><span class="s">&quot;SELECT user FROM blacklist&quot;</span><span class="p">)</span>
</span><span id="__span-110-24"><a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a><span class="w">        </span><span class="n">rdd</span>
</span><span id="__span-110-25"><a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="w">          </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">blacklistList</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">user</span><span class="p">))</span>
</span><span id="__span-110-26"><a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a><span class="w">          </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-27"><a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-dd&quot;</span><span class="p">).</span><span class="n">format</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Date</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">ts</span><span class="p">.</span><span class="n">toLong</span><span class="p">))</span>
</span><span id="__span-110-28"><a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">user</span>
</span><span id="__span-110-29"><a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="n">ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="n">ad</span>
</span><span id="__span-110-30"><a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a><span class="w">            </span><span class="p">((</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-110-31"><a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="w">          </span><span class="p">})</span>
</span><span id="__span-110-32"><a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a><span class="w">          </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-110-33"><a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-110-34"><a id="__codelineno-110-34" name="__codelineno-110-34" href="#__codelineno-110-34"></a><span class="w">      </span><span class="p">.</span><span class="n">foreachRDD</span><span class="p">(</span><span class="n">rdd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-35"><a id="__codelineno-110-35" name="__codelineno-110-35" href="#__codelineno-110-35"></a><span class="w">        </span><span class="n">rdd</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-36"><a id="__codelineno-110-36" name="__codelineno-110-36" href="#__codelineno-110-36"></a><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">),</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-37"><a id="__codelineno-110-37" name="__codelineno-110-37" href="#__codelineno-110-37"></a><span class="w">            </span><span class="c1">// 统计次数</span>
</span><span id="__span-110-38"><a id="__codelineno-110-38" name="__codelineno-110-38" href="#__codelineno-110-38"></a><span class="w">            </span><span class="nc">JDBCUtil</span><span class="p">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-110-39"><a id="__codelineno-110-39" name="__codelineno-110-39" href="#__codelineno-110-39"></a><span class="w">              </span><span class="s">s&quot;&quot;&quot;</span>
</span><span id="__span-110-40"><a id="__codelineno-110-40" name="__codelineno-110-40" href="#__codelineno-110-40"></a><span class="s">                 |INSERT INTO user_ad_count (date, user, ad, count)</span>
</span><span id="__span-110-41"><a id="__codelineno-110-41" name="__codelineno-110-41" href="#__codelineno-110-41"></a><span class="s">                 |VALUES (&#39;</span><span class="si">${</span><span class="n">date</span><span class="si">}</span><span class="s">&#39;, &#39;</span><span class="si">${</span><span class="n">user</span><span class="si">}</span><span class="s">&#39;, &#39;</span><span class="si">${</span><span class="n">ad</span><span class="si">}</span><span class="s">&#39;, </span><span class="si">${</span><span class="n">count</span><span class="si">}</span><span class="s">)</span>
</span><span id="__span-110-42"><a id="__codelineno-110-42" name="__codelineno-110-42" href="#__codelineno-110-42"></a><span class="s">                 |ON DUPLICATE KEY UPDATE count = count + </span><span class="si">${</span><span class="n">count</span><span class="si">}</span>
</span><span id="__span-110-43"><a id="__codelineno-110-43" name="__codelineno-110-43" href="#__codelineno-110-43"></a><span class="s">                 |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-110-44"><a id="__codelineno-110-44" name="__codelineno-110-44" href="#__codelineno-110-44"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-110-45"><a id="__codelineno-110-45" name="__codelineno-110-45" href="#__codelineno-110-45"></a><span class="w">            </span><span class="c1">// 刷新黑名单</span>
</span><span id="__span-110-46"><a id="__codelineno-110-46" name="__codelineno-110-46" href="#__codelineno-110-46"></a><span class="w">            </span><span class="nc">JDBCUtil</span><span class="p">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-110-47"><a id="__codelineno-110-47" name="__codelineno-110-47" href="#__codelineno-110-47"></a><span class="w">              </span><span class="s">s&quot;&quot;&quot;</span>
</span><span id="__span-110-48"><a id="__codelineno-110-48" name="__codelineno-110-48" href="#__codelineno-110-48"></a><span class="s">                 |INSERT INTO blacklist (user)</span>
</span><span id="__span-110-49"><a id="__codelineno-110-49" name="__codelineno-110-49" href="#__codelineno-110-49"></a><span class="s">                 |SELECT user FROM user_ad_count t WHERE count &gt; 100</span>
</span><span id="__span-110-50"><a id="__codelineno-110-50" name="__codelineno-110-50" href="#__codelineno-110-50"></a><span class="s">                 |ON DUPLICATE KEY UPDATE user = t.user</span>
</span><span id="__span-110-51"><a id="__codelineno-110-51" name="__codelineno-110-51" href="#__codelineno-110-51"></a><span class="s">                 |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-110-52"><a id="__codelineno-110-52" name="__codelineno-110-52" href="#__codelineno-110-52"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-110-53"><a id="__codelineno-110-53" name="__codelineno-110-53" href="#__codelineno-110-53"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-110-54"><a id="__codelineno-110-54" name="__codelineno-110-54" href="#__codelineno-110-54"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-110-55"><a id="__codelineno-110-55" name="__codelineno-110-55" href="#__codelineno-110-55"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-110-56"><a id="__codelineno-110-56" name="__codelineno-110-56" href="#__codelineno-110-56"></a>
</span><span id="__span-110-57"><a id="__codelineno-110-57" name="__codelineno-110-57" href="#__codelineno-110-57"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-110-58"><a id="__codelineno-110-58" name="__codelineno-110-58" href="#__codelineno-110-58"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-110-59"><a id="__codelineno-110-59" name="__codelineno-110-59" href="#__codelineno-110-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-110-60"><a id="__codelineno-110-60" name="__codelineno-110-60" href="#__codelineno-110-60"></a>
</span><span id="__span-110-61"><a id="__codelineno-110-61" name="__codelineno-110-61" href="#__codelineno-110-61"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ADClick</span><span class="p">(</span><span class="n">ts</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">)</span>
</span><span id="__span-110-62"><a id="__codelineno-110-62" name="__codelineno-110-62" href="#__codelineno-110-62"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="93">9.3 需求二（广告点击量实时统计）<a class="headerlink" href="#93" title="Permanent link">&para;</a></h3>
<p>实时统计每天各地区各广告的点击总浏览，并将其存入 MySQL。</p>
<h4 id="931_2">9.3.1 思路分析<a class="headerlink" href="#931_2" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>单个批次内对数据进行按照天维度的聚合处理；</p>
</li>
<li>
<p>结合 MySQL 数据跟当前批次数据更新原有数据；</p>
</li>
</ol>
<h4 id="932-mysql_1">9.3.2 MySQL 建表<a class="headerlink" href="#932-mysql_1" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">user_city_ad_count</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="w">    </span><span class="k">user</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w">    </span><span class="nb">date</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="w">    </span><span class="n">city</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span><span class="n">ad</span><span class="w">    </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="w">    </span><span class="k">count</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span>
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">)</span>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="p">);</span>
</span></code></pre></div>
<h4 id="933_1">9.3.3 功能实现<a class="headerlink" href="#933_1" title="Permanent link">&para;</a></h4>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement2</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement2&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">kafkaParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Object</span><span class="p">](</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">BOOTSTRAP_SERVERS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;vm101:9092&quot;</span><span class="p">,</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">GROUP_ID_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;consumer_demo&quot;</span><span class="p">,</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">,</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a>
</span><span id="__span-112-14"><a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a><span class="w">    </span><span class="nc">KafkaUtils</span>
</span><span id="__span-112-15"><a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="w">      </span><span class="p">.</span><span class="n">createDirectStream</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="n">ssc</span><span class="p">,</span><span class="w"> </span><span class="nc">LocationStrategies</span><span class="p">.</span><span class="nc">PreferConsistent</span><span class="p">,</span><span class="w"> </span><span class="nc">ConsumerStrategies</span><span class="p">.</span><span class="nc">Subscribe</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="nc">Set</span><span class="p">(</span><span class="s">&quot;topic_demo&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">kafkaParams</span><span class="p">))</span>
</span><span id="__span-112-16"><a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a><span class="w">      </span><span class="c1">// filter + map</span>
</span><span id="__span-112-17"><a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-18"><a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-19"><a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-dd&quot;</span><span class="p">).</span><span class="n">format</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Date</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">toLong</span><span class="p">))</span>
</span><span id="__span-112-20"><a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a><span class="w">          </span><span class="nc">Array</span><span class="p">[((</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">),</span><span class="w"> </span><span class="nc">Int</span><span class="p">)](((</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-112-21"><a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-112-22"><a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Array</span><span class="p">[((</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">),</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]()</span>
</span><span id="__span-112-23"><a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-112-24"><a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKey</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-112-25"><a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="w">      </span><span class="p">.</span><span class="n">foreachRDD</span><span class="p">(</span><span class="n">rdd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-26"><a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a><span class="w">        </span><span class="n">rdd</span><span class="p">.</span><span class="n">foreachPartition</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-27"><a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="w">          </span><span class="n">values</span><span class="p">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-28"><a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">),</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-29"><a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="w">              </span><span class="nc">JDBCUtil</span><span class="p">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-112-30"><a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a><span class="w">                </span><span class="s">s&quot;&quot;&quot;</span>
</span><span id="__span-112-31"><a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="s">                   |INSERT INTO area_city_ad_count (date, area, city, ad, count)</span>
</span><span id="__span-112-32"><a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a><span class="s">                   |VALUES (&#39;</span><span class="si">${</span><span class="n">date</span><span class="si">}</span><span class="s">&#39;, &#39;</span><span class="si">${</span><span class="n">area</span><span class="si">}</span><span class="s">&#39;, &#39;</span><span class="si">${</span><span class="n">city</span><span class="si">}</span><span class="s">&#39;, &#39;</span><span class="si">${</span><span class="n">ad</span><span class="si">}</span><span class="s">&#39;, </span><span class="si">${</span><span class="n">count</span><span class="si">}</span><span class="s">)</span>
</span><span id="__span-112-33"><a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a><span class="s">                   |ON DUPLICATE KEY UPDATE count = </span><span class="si">${</span><span class="n">count</span><span class="si">}</span>
</span><span id="__span-112-34"><a id="__codelineno-112-34" name="__codelineno-112-34" href="#__codelineno-112-34"></a><span class="s">                   |&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span>
</span><span id="__span-112-35"><a id="__codelineno-112-35" name="__codelineno-112-35" href="#__codelineno-112-35"></a><span class="w">              </span><span class="p">)</span>
</span><span id="__span-112-36"><a id="__codelineno-112-36" name="__codelineno-112-36" href="#__codelineno-112-36"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-112-37"><a id="__codelineno-112-37" name="__codelineno-112-37" href="#__codelineno-112-37"></a><span class="w">          </span><span class="p">})</span>
</span><span id="__span-112-38"><a id="__codelineno-112-38" name="__codelineno-112-38" href="#__codelineno-112-38"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-112-39"><a id="__codelineno-112-39" name="__codelineno-112-39" href="#__codelineno-112-39"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-112-40"><a id="__codelineno-112-40" name="__codelineno-112-40" href="#__codelineno-112-40"></a>
</span><span id="__span-112-41"><a id="__codelineno-112-41" name="__codelineno-112-41" href="#__codelineno-112-41"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-112-42"><a id="__codelineno-112-42" name="__codelineno-112-42" href="#__codelineno-112-42"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-112-43"><a id="__codelineno-112-43" name="__codelineno-112-43" href="#__codelineno-112-43"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-112-44"><a id="__codelineno-112-44" name="__codelineno-112-44" href="#__codelineno-112-44"></a><span class="p">}</span>
</span></code></pre></div>
<p><br/></p>
<h3 id="94">9.4 最近一分钟广告点击量<a class="headerlink" href="#94" title="Permanent link">&para;</a></h3>
<h4 id="941">9.4.1 功能实现<a class="headerlink" href="#941" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>程序</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="k">object</span><span class="w"> </span><span class="nc">Requirement3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SparkConf</span><span class="p">().</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;Requirement3&quot;</span><span class="p">).</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local[*]&quot;</span><span class="p">)</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">ssc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">StreamingContext</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="il">1L</span><span class="p">))</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s">&quot;WARN&quot;</span><span class="p">)</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="n">kafkaParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">Object</span><span class="p">](</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">BOOTSTRAP_SERVERS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;vm101:9092&quot;</span><span class="p">,</span>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">GROUP_ID_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;consumer_demo&quot;</span><span class="p">,</span>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="p">,</span>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">      </span><span class="nc">ConsumerConfig</span><span class="p">.</span><span class="nc">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>
</span><span id="__span-113-12"><a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-113-13"><a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a>
</span><span id="__span-113-14"><a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">    </span><span class="nc">KafkaUtils</span>
</span><span id="__span-113-15"><a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">      </span><span class="p">.</span><span class="n">createDirectStream</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="n">ssc</span><span class="p">,</span><span class="w"> </span><span class="nc">LocationStrategies</span><span class="p">.</span><span class="nc">PreferConsistent</span><span class="p">,</span><span class="w"> </span><span class="nc">ConsumerStrategies</span><span class="p">.</span><span class="nc">Subscribe</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">](</span><span class="nc">Set</span><span class="p">(</span><span class="s">&quot;topic_demo&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">kafkaParams</span><span class="p">))</span>
</span><span id="__span-113-16"><a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">      </span><span class="c1">// filter + map</span>
</span><span id="__span-113-17"><a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">      </span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">record</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-18"><a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ad</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-19"><a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">          </span><span class="c1">// 分钟向下取整</span>
</span><span id="__span-113-20"><a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a><span class="w">          </span><span class="c1">// 12:01 =&gt; 12:00 | 01 / 10 * 10 =&gt; 00</span>
</span><span id="__span-113-21"><a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="w">          </span><span class="c1">// 12:11 =&gt; 12:10 | 10 / 10 * 10 =&gt; 10</span>
</span><span id="__span-113-22"><a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a><span class="w">          </span><span class="c1">// 12:19 =&gt; 12:10 | 19 / 10 * 10 =&gt; 10</span>
</span><span id="__span-113-23"><a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="w">          </span><span class="c1">// 12:25 =&gt; 12:20 | 25 / 10 * 10 =&gt; 20</span>
</span><span id="__span-113-24"><a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a><span class="w">          </span><span class="c1">// 12:59 =&gt; 12:50 | 59 / 10 * 10 =&gt; 50</span>
</span><span id="__span-113-25"><a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">          </span><span class="kd">val</span><span class="w"> </span><span class="n">newTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">toLong</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span>
</span><span id="__span-113-26"><a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a><span class="w">          </span><span class="nc">Array</span><span class="p">[(</span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]((</span><span class="n">newTS</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-113-27"><a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-113-28"><a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Array</span><span class="p">[(</span><span class="nc">Long</span><span class="p">,</span><span class="w"> </span><span class="nc">Int</span><span class="p">)]()</span>
</span><span id="__span-113-29"><a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-113-30"><a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a><span class="w">      </span><span class="c1">// 最近一分钟每 10 秒计算一次</span>
</span><span id="__span-113-31"><a id="__codelineno-113-31" name="__codelineno-113-31" href="#__codelineno-113-31"></a><span class="w">      </span><span class="p">.</span><span class="n">reduceByKeyAndWindow</span><span class="p">(</span>
</span><span id="__span-113-32"><a id="__codelineno-113-32" name="__codelineno-113-32" href="#__codelineno-113-32"></a><span class="w">        </span><span class="n">reduceFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">,</span>
</span><span id="__span-113-33"><a id="__codelineno-113-33" name="__codelineno-113-33" href="#__codelineno-113-33"></a><span class="w">        </span><span class="n">windowDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
</span><span id="__span-113-34"><a id="__codelineno-113-34" name="__codelineno-113-34" href="#__codelineno-113-34"></a><span class="w">        </span><span class="n">slideDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seconds</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-113-35"><a id="__codelineno-113-35" name="__codelineno-113-35" href="#__codelineno-113-35"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-113-36"><a id="__codelineno-113-36" name="__codelineno-113-36" href="#__codelineno-113-36"></a><span class="w">      </span><span class="p">.</span><span class="n">foreachRDD</span><span class="p">(</span><span class="n">rdd</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-37"><a id="__codelineno-113-37" name="__codelineno-113-37" href="#__codelineno-113-37"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">jsonMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">JsonMapper</span><span class="p">.</span><span class="n">builder</span><span class="p">().</span><span class="n">addModule</span><span class="p">(</span><span class="nc">DefaultScalaModule</span><span class="p">).</span><span class="n">build</span><span class="p">()</span>
</span><span id="__span-113-38"><a id="__codelineno-113-38" name="__codelineno-113-38" href="#__codelineno-113-38"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rdd</span>
</span><span id="__span-113-39"><a id="__codelineno-113-39" name="__codelineno-113-39" href="#__codelineno-113-39"></a><span class="w">          </span><span class="p">.</span><span class="n">sortByKey</span><span class="p">()</span>
</span><span id="__span-113-40"><a id="__codelineno-113-40" name="__codelineno-113-40" href="#__codelineno-113-40"></a><span class="w">          </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-41"><a id="__codelineno-113-41" name="__codelineno-113-41" href="#__codelineno-113-41"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-42"><a id="__codelineno-113-42" name="__codelineno-113-42" href="#__codelineno-113-42"></a><span class="w">              </span><span class="kd">val</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;HH:mm:ss&quot;</span><span class="p">).</span><span class="n">format</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">Date</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
</span><span id="__span-113-43"><a id="__codelineno-113-43" name="__codelineno-113-43" href="#__codelineno-113-43"></a><span class="w">              </span><span class="c1">// (time -&gt; count)</span>
</span><span id="__span-113-44"><a id="__codelineno-113-44" name="__codelineno-113-44" href="#__codelineno-113-44"></a><span class="w">              </span><span class="nc">Map</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-113-45"><a id="__codelineno-113-45" name="__codelineno-113-45" href="#__codelineno-113-45"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-113-46"><a id="__codelineno-113-46" name="__codelineno-113-46" href="#__codelineno-113-46"></a><span class="w">          </span><span class="p">})</span>
</span><span id="__span-113-47"><a id="__codelineno-113-47" name="__codelineno-113-47" href="#__codelineno-113-47"></a><span class="w">          </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-113-48"><a id="__codelineno-113-48" name="__codelineno-113-48" href="#__codelineno-113-48"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">.</span><span class="n">writeValueAsString</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span id="__span-113-49"><a id="__codelineno-113-49" name="__codelineno-113-49" href="#__codelineno-113-49"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">FileWriter</span><span class="p">(</span><span class="s">&quot;public/spark-streaming/requirement3/data.json&quot;</span><span class="p">)</span>
</span><span id="__span-113-50"><a id="__codelineno-113-50" name="__codelineno-113-50" href="#__codelineno-113-50"></a><span class="w">        </span><span class="n">fr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
</span><span id="__span-113-51"><a id="__codelineno-113-51" name="__codelineno-113-51" href="#__codelineno-113-51"></a><span class="w">        </span><span class="n">fr</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="__span-113-52"><a id="__codelineno-113-52" name="__codelineno-113-52" href="#__codelineno-113-52"></a><span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
</span><span id="__span-113-53"><a id="__codelineno-113-53" name="__codelineno-113-53" href="#__codelineno-113-53"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-113-54"><a id="__codelineno-113-54" name="__codelineno-113-54" href="#__codelineno-113-54"></a>
</span><span id="__span-113-55"><a id="__codelineno-113-55" name="__codelineno-113-55" href="#__codelineno-113-55"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-113-56"><a id="__codelineno-113-56" name="__codelineno-113-56" href="#__codelineno-113-56"></a><span class="w">    </span><span class="n">ssc</span><span class="p">.</span><span class="n">awaitTermination</span><span class="p">()</span>
</span><span id="__span-113-57"><a id="__codelineno-113-57" name="__codelineno-113-57" href="#__codelineno-113-57"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-113-58"><a id="__codelineno-113-58" name="__codelineno-113-58" href="#__codelineno-113-58"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>展示页面</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="cp">&lt;!doctype html&gt;</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.1/echarts.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a>  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 1000px; height: 300px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%)&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">      </span><span class="c1">// 获取 DOM</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mainDOM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">)</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">      </span><span class="c1">// 初始化 chart</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">echarts</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">mainDOM</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="p">)</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">      </span><span class="c1">// 默认 cahrt 参数</span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="w">        </span><span class="nx">xAxis</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="w">        </span><span class="nx">yAxis</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;value&#39;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">        </span><span class="nx">series</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">}]</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-114-19"><a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="w">      </span><span class="c1">// 定时更新 chart 参数</span>
</span><span id="__span-114-20"><a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="w">      </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-21"><a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">        </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/data.json&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-22"><a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a><span class="w">          </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-23"><a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="w">            </span><span class="nx">option</span><span class="p">.</span><span class="nx">xAxis</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span>
</span><span id="__span-114-24"><a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="w">            </span><span class="nx">option</span><span class="p">.</span><span class="nx">series</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">it</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
</span><span id="__span-114-25"><a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="w">            </span><span class="nx">chart</span><span class="p">.</span><span class="nx">setOption</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span>
</span><span id="__span-114-26"><a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a><span class="w">          </span><span class="p">})</span>
</span><span id="__span-114-27"><a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-114-28"><a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
</span><span id="__span-114-29"><a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-114-30"><a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a>  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-114-31"><a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>启动 Web 服务</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>python<span class="w"> </span>-m<span class="w"> </span>http.server
</span></code></pre></div>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
    
  </body>
</html>