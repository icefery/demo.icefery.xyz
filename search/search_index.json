{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u9996\u9875","text":""},{"location":"algorithm/","title":"\u7b97\u6cd5","text":""},{"location":"algorithm/%E3%80%90%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E3%80%91%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/","title":"\u3010\u52a8\u6001\u89c4\u5212\u3011\u80cc\u5305\u95ee\u9898","text":""},{"location":"algorithm/%E3%80%90%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E3%80%91%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/#_2","title":"\u9898\u76ee","text":"<p>\u73b0\u5728\u6709\u56db\u4e2a\u7269\u54c1\uff0c\u80cc\u5305\u603b\u5bb9\u91cf\u4e3a 8\uff0c\u80cc\u5305\u6700\u591a\u80fd\u88c5\u5165\u4ef7\u503c\u4e3a\u591a\u5c11\u7684\u7269\u54c1\uff1f</p> \u7269\u54c1\u7f16\u53f7 \u7269\u54c1\u4f53\u79ef \u7269\u54c1\u4ef7\u503c 1 2 3 2 3 4 3 4 5 4 5 6 \u7269\u54c1\u7f16\u53f7/\u80cc\u5305\u5bb9\u91cf 0 1 2 3 4 5 6 7 8 0 <code>f(0,0)=0</code> <code>f(0,1)=0</code> 0 0 0 0 0 0 0 <code>{id:4,size:5,value:6}</code> <code>f(4,0)=0</code> <code>{id:3,size:4,value:5}</code> 0 <code>{id:2,size:3,value:4}</code> 0 <code>{id:1,size:2,value:3}</code> 0 <code>f(1,2)</code> 3 <pre><code>f(k, w) = k.w &gt; w ? f(k-1,w) : max(f(k-1,w), f(k-1,w-k.w)+k.v )\n</code></pre> <pre><code>flowchart TD\nA{\"F(4,8)\"}\nA -- \"\u9009\u62e9 {id:4,size:5,value:6}\" --&gt; Y4{\"F(3,8-5=31)+6\"}\nA -- \"\u653e\u5f03 {id:4,size:5,value:6}\" --&gt; N4{\"F(3,8)\"}\n\nY4{\"F(3,8-5)+6\"} -- \"\u9009\u62e9\u7b2c 3 \u4ef6\" --&gt; Y4Y3[\"\u653e\u4e0d\u4e0b\"]\nY4{\"F(3,8-5)+6\"} -- \"\u653e\u5f03\u7b2c 3 \u4ef6\" --&gt; Y4N3{\"F(2,8-5)+6\"}\n\nY4N3{\"F(2,8-5)+6\"} -- \"\u9009\u62e9\u7b2c 2 \u4ef6\" --&gt; Y4N3Y2{\"F(1,8-5-3)+8+4\"}\nY4N3{\"F(2,8-5)+6\"} -- \"\u653e\u5f03\u7b2c 2 \u4ef6\" --&gt; Y4N3N2{\"F(1,8-5)+8\"}\n\nY4N3Y2{\"F(1,8-5-3)+8+4\"} -- \"\u9009\u62e9\u7b2c 1 \u4ef6\" --&gt; Y4N3Y2Y1[\"\u653e\u4e0d\u4e0b\"]\nY4N3Y2{\"F(1,8-5-3)+8+4\"} -- \"\u653e\u5f03\u7b2c 1 \u4ef6\" --&gt; Y4N3Y2N1[\"F(0,8-5-3)+8+4\"]\n\nY4N3N2 -- \"\u9009\u62e9\u7b2c 1 \u4ef6\" --&gt; Y4N3N2Y1{\"F(0, 3-2) + 8 + 3\"}\nY4N3N2 -- \"\u653e\u5f03\u7b2c 1 \u4ef6\" --&gt; Y4N3N2N1{\"F(0,3) + 8\"}\n\nN4 -- \"\u9009\u62e9\u7b2c 3 \u4ef6\" --&gt; N4Y3{\"F(2, 8-4) + 5\"}\nN4 -- \"\u653e\u5f03\u7b2c 3 \u4ef6\" --&gt; N4N3{\"F(2, 8)\"}\n\nN4Y3 -- \"\u9009\u62e9\u7b2c 2 \u4ef6\" --&gt; N4Y3Y2(\"F(1,8-4-3)+5+4)\")\nN4Y3 -- \"\u653e\u5f03\u7b2c 2 \u4ef6\" --&gt; N4Y3N2(\"F(1,8-4)\"+5)\n\nN4Y3Y2(\"F(1,8-4-3)+5+4)\") -- \"\u9009\u62e9\u7b2c 1 \u4ef6\" --&gt; N4Y3Y1(\"\u653e\u4e0d\u4e0b\")\nN4Y3Y2(\"F(1,8-4-3)+5+4)\") -- \"\u653e\u5f03\u7b2c 1 \u4ef6\" --&gt; N4Y3N1(\"F(0,8-4-3)+5+4\")\n\nN4Y3N2(\"F(1,8-4)\"+5) -- \"\u9009\u62e9\u7b2c 1 \u4ef6\" --&gt; N4Y3N2Y1(\"F(0,8-4-2)+5+3\")\nN4Y3N2(\"F(1,8-4)\"+5) -- \"\u653e\u5f03\u7b2c 1 \u4ef6\" --&gt; N4Y3N2N1(\"F(0,8-4)+5\")</code></pre> <pre><code>flowchart TD\nA[\"F(4,8)\"] --&gt; CHECK_4{\"{id:4,size:5,value:6}\"}\nCHECK_4 -- \"Y\" --&gt; Y4[\"F(3,8-5)+6 = F(3,3)+6\"]\nY4 --&gt; CHECK_3{\"{id:3,size:4,value:5}\"}\nCHECK_3 -- \"Y\" --&gt; Y4Y3[\"\u653e\u4e0d\u4e0b\"]\nCHECK_3 -- \"N\" --&gt; Y4N3[\"F(2,3)+6\"]\nY4N3 -- CHECK_2{\"{id:2,size:3,value:4}\"}</code></pre>"},{"location":"architecture/","title":"\u67b6\u6784","text":""},{"location":"architecture/#_2","title":"\u6536\u85cf","text":""},{"location":"architecture/#_3","title":"\u6211\u53ea\u662f\u4e0b\u4e86\u4e2a\u8ba2\u5355\uff0c\u9b3c\u77e5\u9053\u6211\u5728\u5fae\u670d\u52a1\u91cc\u7ecf\u5386\u4e86\u4ec0\u4e48","text":""},{"location":"architecture/#_4","title":"\u9886\u57df\u9a71\u52a8\u8bbe\u8ba1\u5728\u4e92\u8054\u7f51\u4e1a\u52a1\u5f00\u53d1\u4e2d\u7684\u5b9e\u8df5","text":""},{"location":"architecture/#_5","title":"\u524d\u540e\u7aef\u5206\u79bb\u6a21\u5f0f\u4e0b\u7684\u6743\u9650\u8bbe\u8ba1\u65b9\u6848","text":""},{"location":"architecture/#cap","title":"CAP \u7406\u8bba\u7684\u7406\u89e3","text":""},{"location":"architecture/#-","title":"\u8bfb-\u674e\u667a\u6167-\u5927\u578b\u7f51\u7ad9\u6280\u672f\u67b6\u6784\uff1a\u6838\u5fc3\u539f\u7406\u4e0e\u6848\u4f8b\u5206\u6790","text":""},{"location":"architecture/distributed-lock/","title":"\u5206\u5e03\u5f0f\u9501","text":""},{"location":"architecture/distributed-lock/__demo__/distributed-lock-demo/","title":"Index","text":""},{"location":"architecture/distributed-lock/__demo__/distributed-lock-demo/#_1","title":"\u53c2\u8003","text":""},{"location":"architecture/distributed-lock/__demo__/distributed-lock-demo/#redismysqlzookeeperetcd","title":"\u5206\u5e03\u5f0f\u9501\u7684\u4e09\u79cd\u5b9e\u73b0\u65b9\u5f0f Redis\u3001Mysql\u3001zookeeper/etcd\uff08\u5c1a\u7845\u8c37\u5206\u5e03\u5f0f\u9501\u914d\u5957\u8d44\u6599\uff09","text":""},{"location":"architecture/distributed-transaction/","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1","text":""},{"location":"architecture/distributed-transaction/#_2","title":"\u4e00\u3001\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1","text":""},{"location":"architecture/distributed-transaction/#11","title":"1.1 \u672c\u5730\u4e8b\u52a1","text":"<p>\u672c\u5730\u4e8b\u52a1\u662f\u6307\u4f20\u7edf\u7684\u5355\u673a\u6570\u636e\u5e93\u4e8b\u52a1\uff0c\u5fc5\u987b\u5177\u5907 ACID \u539f\u5219\uff1a</p> <ul> <li>\u539f\u5b50\u6027(Atomicity)     &gt; \u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u518d\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\u3002\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u6062\u590d\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\u3002</li> <li>\u4e00\u81f4\u6027(Consistency)     &gt; \u5728\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u548c\u4e8b\u52a1\u7ed3\u675f\u4ee5\u540e\uff0c\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\u6ca1\u6709\u88ab\u7834\u574f\u3002\u8fd9\u8868\u793a\u5199\u5165\u7684\u8d44\u6599\u5fc5\u987b\u5b8c\u5168\u7b26\u5408\u6240\u6709\u7684\u9884\u8bbe\u89c4\u5219\uff0c\u8fd9\u5305\u542b\u8d44\u6599\u7684\u7cbe\u786e\u5ea6\u3001\u4e32\u8054\u6027\u4ee5\u53ca\u540e\u7eed\u6570\u636e\u5e93\u53ef\u4ee5\u81ea\u53d1\u6027\u5730\u5b8c\u6210\u9884\u5b9a\u7684\u5de5\u4f5c\u3002</li> <li>\u9694\u79bb\u6027(Isolation)     &gt; \u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002\u4e8b\u52a1\u9694\u79bb\u5206\u4e3a\u4e0d\u540c\u7ea7\u522b\uff0c\u5305\u62ec\u8bfb\u672a\u63d0\u4ea4\u3001\u8bfb\u5df2\u63d0\u4ea4\u3001\u53ef\u91cd\u590d\u8bfb\u548c\u4e32\u884c\u5316\u3002</li> <li>\u6301\u4e45\u6027(Durability)     &gt; \u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002</li> </ul> <p>\u5176\u4e2d\u539f\u5b50\u6027\u548c\u6301\u4e45\u6027\u5c31\u8981\u9760 undo \u548c redo \u65e5\u5fd7\u6765\u5b9e\u73b0\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#12-undo-redo","title":"1.2 undo \u548c redo \u65e5\u5fd7","text":"<ul> <li>undo log \u8bb0\u5f55\u66f4\u65b0\u524d\u6570\u636e\uff0c\u7528\u4e8e\u4fdd\u8bc1\u4e8b\u52a1\u539f\u5b50\u6027\u3002</li> <li>redo log \u8bb0\u5f55\u66f4\u65b0\u540e\u6570\u636e\uff0c\u7528\u4e8e\u4fdd\u8bc1\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u3002</li> <li>redo log \u6709\u81ea\u5df1\u7684\u5185\u5b58 buffer\uff0c\u5148\u5199\u5165\u5230 buffer\uff0c\u4e8b\u52a1\u63d0\u4ea4\u65f6\u5199\u5165\u78c1\u76d8\u3002</li> <li>redo log \u6301\u4e45\u5316\u4e4b\u540e\uff0c\u610f\u5473\u7740\u4e8b\u52a1\u662f\u53ef\u4ee5\u63d0\u4ea4\u7684\u3002</li> </ul>"},{"location":"architecture/distributed-transaction/#13","title":"1.3 \u5206\u5e03\u5f0f\u4e8b\u52a1","text":"<p>\u5206\u5e03\u5f0f\u4e8b\u52a1\u5c31\u662f\u6307\u4e0d\u662f\u5728\u5355\u4e2a\u670d\u52a1\u6216\u5355\u4e2a\u6570\u636e\u5e93\u67b6\u6784\u4e0b\u4ea7\u751f\u7684\u4e8b\u52a1\u3002</p>"},{"location":"architecture/distributed-transaction/#131","title":"1.3.1 \u8de8\u6570\u636e\u6e90","text":"<p>\u968f\u7740\u4e1a\u52a1\u6570\u636e\u89c4\u6a21\u7684\u5feb\u901f\u53d1\u5c55\uff0c\u6570\u636e\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u5355\u5e93\u5355\u8868\u9010\u6e10\u6210\u4e3a\u74f6\u9888\u3002\u6240\u4ee5\u6211\u4eec\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u6c34\u5e73\u62c6\u5206\uff0c\u5c06\u539f\u5355\u5e93\u5355\u8868\u62c6\u5206\u6210\u6570\u636e\u5e93\u5206\u7247\uff0c\u4e8e\u662f\u5c31\u4ea7\u751f\u4e86\u8de8\u6570\u636e\u5e93\u4e8b\u52a1\u95ee\u9898\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#132","title":"1.3.2 \u8de8\u670d\u52a1","text":"<p>\u5728\u4e1a\u52a1\u53d1\u5c55\u521d\u671f\uff0c\u201c\u4e00\u5757\u5927\u997c\u201d\u7684\u5355\u4e1a\u52a1\u7cfb\u7edf\u67b6\u6784\uff0c\u80fd\u6ee1\u8db3\u57fa\u672c\u7684\u4e1a\u52a1\u9700\u6c42\u3002\u4f46\u662f\u968f\u7740\u4e1a\u52a1\u7684\u5feb\u901f\u53d1\u5c55\uff0c\u7cfb\u7edf\u7684\u8bbf\u95ee\u91cf\u548c\u4e1a\u52a1\u590d\u6742\u7a0b\u5ea6\u90fd\u5728\u5feb\u901f\u589e\u957f\uff0c\u5355\u7cfb\u7edf\u67b6\u6784\u9010\u6e10\u6210\u4e3a\u4e1a\u52a1\u53d1\u5c55\u74f6\u9888\uff0c\u89e3\u51b3\u4e1a\u52a1\u7cfb\u7edf\u7684\u9ad8\u8026\u5408\u3001\u53ef\u4f38\u7f29\u95ee\u9898\u7684\u9700\u6c42\u8d8a\u6765\u8d8a\u5f3a\u70c8\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6309\u7167\u9762\u5411\u670d\u52a1\u67b6\u6784\u7684\u8bbe\u8ba1\u539f\u5219\uff0c\u5c06\u5355\u4e1a\u52a1\u7cfb\u7edf\u62c6\u5206\u6210\u591a\u4e2a\u4e1a\u52a1\u7cfb\u7edf\uff0c\u964d\u4f4e\u4e86\u5404\u7cfb\u7edf\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\uff0c\u4f7f\u4e0d\u540c\u7684\u4e1a\u52a1\u7cfb\u7edf\u4e13\u6ce8\u4e8e\u81ea\u8eab\u4e1a\u52a1\uff0c\u66f4\u6709\u5229\u4e8e\u4e1a\u52a1\u7684\u53d1\u5c55\u548c\u7cfb\u7edf\u5bb9\u91cf\u7684\u4f38\u7f29\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#133","title":"1.3.3 \u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898","text":"<p>\u5728\u6570\u636e\u5e93\u6c34\u5e73\u62c6\u5206\u3001\u670d\u52a1\u5782\u76f4\u62c6\u5206\u4e4b\u540e\uff0c\u4e00\u4e2a\u4e1a\u52a1\u901a\u5e38\u8981\u8de8\u591a\u4e2a\u6570\u636e\u5e93\u3001\u670d\u52a1\u624d\u80fd\u5b8c\u6210\uff0c\u5728\u5206\u5e03\u5f0f\u7f51\u7edc\u73af\u5883\u4e0b\uff0c\u6211\u4eec\u65e0\u6cd5\u4fdd\u969c\u6240\u6709\u670d\u52a1\u3001\u6570\u636e\u5e93\u90fd\u767e\u5206\u767e\u53ef\u7528\uff0c\u4e00\u5b9a\u4f1a\u51fa\u73b0\u90e8\u5206\u670d\u52a1\u3001\u6570\u636e\u5e93\u6267\u884c\u6210\u529f\uff0c\u800c\u53e6\u4e00\u90e8\u5206\u6267\u884c\u5931\u8d25\u7684\u95ee\u9898\u3002</p> <p></p> <p></p>"},{"location":"architecture/distributed-transaction/#_3","title":"\u4e8c\u3001\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u601d\u8def","text":""},{"location":"architecture/distributed-transaction/#21-cap","title":"2.1 CAP \u5b9a\u7406","text":""},{"location":"architecture/distributed-transaction/#211-consistency-availability","title":"2.1.1 Consistency \u548c Availability \u7684\u77db\u76fe","text":"<p>\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u540c\u65f6\u6210\u7acb\uff1f</p> <p>\u7b54\u6848\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u53ef\u80fd\u901a\u4fe1\u5931\u8d25\uff08\u5373\u51fa\u73b0\u5206\u533a\u5bb9\u9519\uff09\u3002</p> <ul> <li>\u5982\u679c\u4fdd\u8bc1 G2 \u7684\u4e00\u81f4\u6027\uff0c\u90a3\u4e48 G1 \u5fc5\u987b\u5728\u5199\u64cd\u4f5c\u65f6\uff0c\u9501\u5b9a G2 \u7684\u8bfb\u64cd\u4f5c\u548c\u5199\u64cd\u4f5c\u3002\u53ea\u6709\u6570\u636e\u540c\u6b65\u540e\uff0c\u624d\u80fd\u91cd\u65b0\u5f00\u653e\u8bfb\u5199\u3002\u9501\u5b9a\u671f\u95f4\uff0cG2 \u4e0d\u80fd\u8bfb\u5199\uff0c\u6ca1\u6709\u53ef\u7528\u6027\u3002</li> <li>\u5982\u679c\u4fdd\u8bc1 G2 \u7684\u53ef\u7528\u6027\uff0c\u90a3\u4e48\u52bf\u5fc5\u4e0d\u80fd\u9501\u5b9a G2\uff0c\u6240\u4ee5\u4e00\u81f4\u6027\u4e0d\u6210\u7acb\u3002</li> </ul> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cG2 \u65e0\u6cd5\u540c\u65f6\u505a\u5230\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u3002\u7cfb\u7edf\u8bbe\u8ba1\u65f6\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\u3002\u5982\u679c\u8ffd\u6c42\u4e00\u81f4\u6027\uff0c\u90a3\u4e48\u65e0\u6cd5\u4fdd\u8bc1\u6240\u6709\u8282\u70b9\u7684\u53ef\u7528\u6027\uff1b\u5982\u679c\u8ffd\u6c42\u6240\u6709\u8282\u70b9\u7684\u53ef\u7528\u6027\uff0c\u90a3\u5c31\u6ca1\u6cd5\u505a\u5230\u4e00\u81f4\u6027\u3002</p>"},{"location":"architecture/distributed-transaction/#212-ca","title":"2.1.2 \u600e\u4e48\u6837\u624d\u80fd\u540c\u65f6\u6ee1\u8db3 CA","text":"<p>\u9664\u975e\u662f\u5355\u70b9\u67b6\u6784\u3002</p>"},{"location":"architecture/distributed-transaction/#213-cp","title":"2.1.3 \u4f55\u65f6\u6ee1\u8db3 CP","text":"<p>\u5bf9\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\u7684\u573a\u666f\u3002\u4f8b\u5982 ZooKeeper\uff0c\u5728\u670d\u52a1\u8282\u70b9\u6570\u636e\u540c\u6b65\u65f6\uff0c\u670d\u52a1\u5bf9\u5916\u4e0d\u53ef\u7528\u3002</p>"},{"location":"architecture/distributed-transaction/#214-ap","title":"2.1.4 \u4f55\u65f6\u6ee1\u8db3 AP","text":"<p>\u5bf9\u53ef\u7528\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u573a\u666f\u3002\u4f8b\u5982 Eureka\uff0c\u5fc5\u987b\u4fdd\u8bc1\u6ce8\u518c\u4e2d\u5fc3\u968f\u65f6\u53ef\u7528\uff0c\u4e0d\u7136\u62c9\u53d6\u4e0d\u5230\u670d\u52a1\u5c31\u53ef\u80fd\u51fa\u95ee\u9898\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#22-base","title":"2.2 BASE \u7406\u8bba","text":"<p>BASE \u662f\u4e09\u4e2a\u5355\u8bcd\u7684\u7f29\u5199\uff1a</p> <ul> <li>Basically Available(\u57fa\u672c\u53ef\u7528)</li> <li>Soft state(\u8f6f\u72b6\u6001)</li> <li>Eventually consistent(\u6700\u7ec8\u4e00\u81f4\u6027)</li> </ul> <p>\u800c\u6211\u4eec\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u5c31\u662f\u6839\u636e\u4e0a\u8ff0\u7406\u8bba\u6765\u5b9e\u73b0\u3002</p> <p>\u8fd8\u4ee5\u4e0b\u5355\u51cf\u5e93\u5b58\u548c\u6263\u6b3e\u4e3a\u4f8b\uff1a</p> <ul> <li> <p>CP \u65b9\u5f0f</p> <p>\u73b0\u5728\u5982\u679c\u8981\u6ee1\u8db3\u4e8b\u52a1\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u5c31\u5fc5\u987b\u5728\u8ba2\u5355\u670d\u52a1\u6570\u636e\u5e93\u9501\u5b9a\u7684\u540c\u65f6\uff0c\u5bf9\u5e93\u5b58\u670d\u52a1\u3001\u7528\u6237\u670d\u52a1\u6570\u636e\u8d44\u6e90\u540c\u65f6\u9501\u5b9a\u3002\u7b49\u5f85\u4e09\u4e2a\u670d\u52a1\u4e1a\u52a1\u5168\u90e8\u5904\u7406\u5b8c\u6210\uff0c\u624d\u53ef\u4ee5\u91ca\u653e\u8d44\u6e90\u3002\u6b64\u65f6\u5982\u679c\u6709\u5176\u4ed6\u8bf7\u6c42\u60f3\u8981\u64cd\u4f5c\u88ab\u9501\u5b9a\u7684\u8d44\u6e90\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u8fd9\u6837\u5c31\u662f\u6ee1\u8db3\u4e86 CP\u3002</p> <p>\u8fd9\u5c31\u662f\u5f3a\u4e00\u81f4\uff0c\u5f31\u53ef\u7528\u3002</p> </li> <li> <p>AP \u65b9\u5f0f</p> <p>\u4e09\u4e2a\u670d\u52a1\u7684\u5bf9\u5e94\u6570\u636e\u5e93\u4e2a\u5b50\u72ec\u7acb\u6267\u884c\u81ea\u5df1\u7684\u4e1a\u52a1\uff0c\u6267\u884c\u672c\u5730\u4e8b\u52a1\uff0c\u4e0d\u8981\u6c42\u4e92\u76f8\u9501\u5b9a\u8d44\u6e90\u3002\u4f46\u662f\u8fd9\u4e2a\u4e2d\u95f4\u72b6\u6001\u4e0b\uff0c\u6211\u4eec\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u53ef\u80fd\u9047\u5230\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u4e0d\u8fc7\u6211\u4eec\u9700\u8981\u505a\u4e00\u4e9b\u540e\u8865\u63aa\u65bd\uff0c\u4fdd\u8bc1\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u6570\u636e\u6ee1\u8db3\u4e00\u81f4\u6027\u3002</p> <p>\u8fd9\u5c31\u662f\u9ad8\u53ef\u7528\uff0c\u4f46\u5f31\u4e00\u81f4\uff08\u6700\u7ec8\u4e00\u81f4\uff09\u3002</p> </li> </ul> <p>\u7531\u4e0a\u9762\u7684\u4e24\u79cd\u601d\u60f3\uff0c\u5ef6\u4f38\u51fa\u4e86\u5f88\u591a\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>XA</li> <li>TCC</li> <li>\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4</li> <li>AT</li> <li>Saga</li> </ul> <p></p>"},{"location":"architecture/distributed-transaction/#23","title":"2.3 \u5206\u9636\u6bb5\u63d0\u4ea4","text":""},{"location":"architecture/distributed-transaction/#231-dtp-xa","title":"2.3.1 DTP \u548c XA","text":"<p>\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u89e3\u51b3\u624b\u6bb5\u4e4b\u4e00\uff0c\u5c31\u662f\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u3002</p> <p>1994 \u5e74\uff0cX/Open \u7ec4\u7ec7\u5b9a\u4e49\u4e86\u5206\u5e03\u5f0f\u4e8b\u52a1\u5904\u7406\u7684 DTP(Distributed Transaction Processing)\u6a21\u578b\u3002\u8be5\u6a21\u578b\u5305\u62ec\u8fd9\u6837\u51e0\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f(Application Program)</li> <li>\u4e8b\u52a1\u7ba1\u7406\u5668(Transaction Manager)</li> <li>\u8d44\u6e90\u7ba1\u7406\u5668(Resource Manager)</li> <li>\u901a\u4fe1\u8d44\u6e90\u7ba1\u7406\u5668(Communication Resource Manager)</li> <li>\u901a\u4fe1\u534f\u8bae(Communication Protocol)</li> </ul> <p>\u5728\u8be5\u6a21\u578b\u4e2d\uff0c\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1(\u5168\u5c40\u4e8b\u52a1)\u53ef\u4ee5\u88ab\u62c6\u5206\u6210\u8bb8\u591a\u4e2a\u672c\u5730\u4e8b\u52a1\uff0c\u8fd0\u884c\u5728\u4e0d\u540c\u7684 AP \u548c RM \u4e0a\u3002\u6bcf\u4e2a\u672c\u5730\u4e8b\u52a1\u7684 ACID \u5f88\u597d\u5b9e\u73b0\uff0c\u4f46\u662f\u5168\u5c40\u4e8b\u52a1\u5fc5\u987b\u4fdd\u8bc1\u5176\u4e2d\u5305\u542b\u7684\u6bcf\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u90fd\u80fd\u540c\u65f6\u6210\u529f\uff0c\u82e5\u6709\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u5931\u8d25\uff0c\u5219\u6240\u6709\u5176\u4ed6\u4e8b\u52a1\u90fd\u5fc5\u987b\u56de\u6eda\u3002\u4f46\u95ee\u9898\u662f\uff0c\u672c\u5730\u4e8b\u52a1\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u4e0d\u77e5\u9053\u5176\u4ed6\u4e8b\u52a1\u7684\u8fd0\u884c\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u5c31\u9700\u8981\u901a\u8fc7 CRM \u6765\u901a\u77e5\u5404\u4e2a\u672c\u5730\u4e8b\u52a1\uff0c\u540c\u6b65\u4e8b\u52a1\u6267\u884c\u7684\u72b6\u6001\u3002</p> <p>\u56e0\u6b64\uff0c\u5404\u4e2a\u672c\u5730\u4e8b\u52a1\u7684\u901a\u4fe1\u5fc5\u987b\u6709\u7edf\u4e00\u7684\u6807\u51c6\uff0c\u5426\u5219\u4e0d\u540c\u6570\u636e\u5e93\u95f4\u5c31\u65e0\u6cd5\u901a\u4fe1\u3002XA \u5c31\u662f X/Open DTP \u4e2d CRM \u4e0e TM \u95f4\u8054\u7cfb\u7684\u501f\u53e3\u89c4\u8303\uff0c\u5b9a\u4e49\u4e86\u7528\u4e8e\u901a\u77e5\u4e8b\u52a1\u5f00\u59cb\u3001\u63d0\u4ea4\u3001\u7ec8\u6b62\u3001\u56de\u6eda\u7b49\u63a5\u53e3\uff0c\u5404\u4e2a\u6570\u636e\u5e93\u5382\u5546\u90fd\u5fc5\u987b\u5b9e\u73b0\u8fd9\u4e9b\u63a5\u53e3\u3002</p>"},{"location":"architecture/distributed-transaction/#232","title":"2.3.2 \u4e8c\u9636\u6bb5\u63d0\u4ea4","text":"<p>\u4e8c\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u5c31\u662f\u6839\u636e\u8fd9\u4e00\u601d\u60f3\u884d\u751f\u51fa\u6765\u7684\uff0c\u5c06\u5168\u5c40\u4e8b\u52a1\u62c6\u5206\u6210\u4e24\u4e2a\u9636\u6bb5\u6765\u6267\u884c\uff1a</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\uff1a\u5404\u4e2a\u672c\u5730\u4e8b\u52a1\u5b8c\u6210\u672c\u5730\u4e8b\u52a1\u7684\u51c6\u5907\u5de5\u4f5c\u3002</li> <li>\u6267\u884c\u9636\u6bb5\uff1a\u5404\u4e2a\u672c\u5730\u4e8b\u52a1\u6839\u636e\u4e0a\u4e00\u9636\u6bb5\u6267\u884c\u7ed3\u679c\uff0c\u8fdb\u884c\u63d0\u4ea4\u6216\u56de\u6eda\u3002</li> </ul> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u9700\u8981\u4e00\u4e2a\u534f\u8c03\u8005\uff0c\u8fd8\u6709\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u3002</p>"},{"location":"architecture/distributed-transaction/#_4","title":"\u5355\u70b9\u6545\u969c\u95ee\u9898","text":"<p>2PC \u7684\u7f3a\u70b9\u5728\u4e8e\u4e0d\u80fd\u5904\u7406 fail-stop \u5f62\u5f0f\u7684\u8282\u70b9 failure\u3002\u6bd4\u5982\u4e0b\u56fe\u8fd9\u79cd\u60c5\u51b5\uff1a</p> <p></p> <p>\u5047\u8bbe coordinator \u548c voter3 \u90fd\u5728 commit \u8fd9\u4e2a\u9636\u6bb5 crash \u4e86\uff0c\u800c voter1 \u548c voter2 \u6ca1\u6709\u6536\u5230 commit \u6d88\u606f\u3002\u8fd9\u65f6\u5019 voter1 \u548c voter2 \u5c31\u9677\u5165\u4e86\u4e00\u4e2a\u56f0\u5883\u3002\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u80fd\u5224\u65ad\u73b0\u5728\u662f\u8fd9\u4e24\u4e2a\u573a\u666f\u4e2d\u7684\u54ea\u4e00\u79cd\uff1a</p> <ul> <li>\u4e0a\u8f6e\u5168\u7968\u901a\u8fc7\u7136\u540e voter3 \u7b2c\u4e00\u4e2a\u6536\u5230\u4e86 commit \u7684\u6d88\u606f\u5e76\u5728 commit \u64cd\u4f5c\u4e4b\u540e crash \u4e86\u3002</li> <li>\u4e0a\u8f6e voter3 \u53cd\u5bf9\u6240\u4ee5\u5e72\u8106\u6ca1\u6709\u901a\u8fc7\u3002</li> </ul>"},{"location":"architecture/distributed-transaction/#_5","title":"\u963b\u585e\u95ee\u9898","text":"<p>\u5728\u51c6\u5907\u9636\u6bb5\u3001\u63d0\u4ea4\u9636\u6bb5\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u53c2\u4e0e\u8005\u90fd\u4f1a\u9501\u5b9a\u672c\u5730\u8d44\u6e90\uff0c\u5e76\u7b49\u5f85\u5176\u4ed6\u4e8b\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff0c\u963b\u585e\u65f6\u95f4\u8f83\u957f\uff0c\u8d44\u6e90\u9501\u5b9a\u65f6\u95f4\u592a\u4e45\uff0c\u56e0\u6b64\u6267\u884c\u7684\u6548\u7387\u5c31\u6bd4\u8f83\u4f4e\u4e86\u3002</p>"},{"location":"architecture/distributed-transaction/#233","title":"2.3.3 \u4f7f\u7528\u573a\u666f","text":"<p>\u5bf9\u4e8b\u7269\u6709\u5f3a\u4e00\u81f4\u6027\u8981\u53bb\uff0c\u5bf9\u4e8b\u7269\u6267\u884c\u6548\u7387\u4e0d\u654f\u611f\uff0c\u5e76\u4e14\u4e0d\u5e0c\u671b\u6709\u592a\u591a\u4ee3\u7801\u4fb5\u5165\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#24-tcc","title":"2.4 TCC","text":"<p>TCC \u6a21\u5f0f\u53ef\u4ee5\u89e3\u51b3 2PC \u4e2d\u7684\u8d44\u6e90\u9501\u5b9a\u548c\u963b\u585e\u95ee\u9898\uff0c\u51cf\u5c11\u8d44\u6e90\u9501\u5b9a\u65f6\u95f4\u3002</p>"},{"location":"architecture/distributed-transaction/#241","title":"2.4.1 \u57fa\u672c\u539f\u7406","text":"<p>TCC \u672c\u8d28\u662f\u4e00\u79cd\u8865\u507f\u7684\u601d\u8def\u3002\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u5305\u62ec\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li>Try\uff1a\u8d44\u6e90\u7684\u68c0\u6d4b\u548c\u9884\u7559\u3002</li> <li>Confirm\uff1a\u6267\u884c\u7684\u4e1a\u52a1\u64cd\u4f5c\u63d0\u4ea4\uff1b\u8981\u6c42 Try \u6210\u529f Confirm \u4e00\u5b9a\u8981\u80fd\u6210\u529f\u3002</li> <li>Cancel\uff1a\u9884\u7559\u8d44\u6e90\u91ca\u653e\u3002</li> </ul> <p></p> <p>\u7c97\u770b\u4f3c\u4e4e\u548c\u4e24\u9636\u6bb5\u63d0\u4ea4\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u4f46\u5176\u5b9e\u5dee\u522b\u5f88\u5927\uff1a</p> <ul> <li>Try\u3001Confirm\u3001Cancel \u90fd\u662f\u72ec\u7acb\u7684\u4e8b\u52a1\uff0c\u4e0d\u53d7\u5176\u5b83\u53c2\u4e0e\u8005\u7684\u5f71\u54cd\uff0c\u4e0d\u4f1a\u963b\u585e\u7b49\u5f85\u3002</li> <li>Try\u3001Confirm\u3001Cancel \u7531\u7a0b\u5e8f\u5458\u5728\u4e1a\u52a1\u5c42\u7f16\u5199\uff0c\u9501\u7c92\u5ea6\u7531\u4ee3\u7801\u63a7\u5236\u3002</li> </ul>"},{"location":"architecture/distributed-transaction/#242","title":"2.4.2 \u4f18\u52bf\u548c\u7f3a\u70b9","text":""},{"location":"architecture/distributed-transaction/#_6","title":"\u4f18\u52bf","text":"<p>TCC \u6267\u884c\u7684\u6bcf\u4e00\u4e2a\u9636\u6bb5\u90fd\u4f1a\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\u5e76\u91ca\u653e\u6240\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u5f85\u5176\u5b83\u4e8b\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002\u800c\u5982\u679c\u5176\u5b83\u4e8b\u52a1\u6267\u884c\u5931\u8d25\uff0c\u6700\u540e\u4e0d\u662f\u56de\u6eda\uff0c\u800c\u662f\u6267\u884c\u8865\u507f\u64cd\u4f5c\u3002\u8fd9\u6837\u5c31\u907f\u514d\u4e86\u8d44\u6e90\u7684\u957f\u671f\u9501\u5b9a\u548c\u963b\u585e\u7b49\u5f85\uff0c\u6267\u884c\u6548\u7387\u6bd4\u8f83\u9ad8\uff0c\u5c5e\u4e8e\u6027\u80fd\u6bd4\u8f83\u597d\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u65b9\u5f0f\u3002</p>"},{"location":"architecture/distributed-transaction/#_7","title":"\u7f3a\u70b9","text":"<ul> <li>\u4ee3\u7801\u4fb5\u5165\uff1a\u9700\u8981\u4eba\u4e3a\u7f16\u5199\u4ee3\u7801\u5b9e\u73b0 Try\u3001Confirm\u3001Cancel\uff0c\u4ee3\u7801\u4fb5\u5165\u6bd4\u8f83\u591a\u3002</li> <li>\u5f00\u53d1\u6210\u672c\u9ad8\uff1a\u4e00\u4e2a\u4e1a\u52a1\u9700\u8981\u62c6\u5206\u6210\u4e09\u4e2a\u6b65\u9aa4\uff0c\u5206\u522b\u7f16\u5199\u4e1a\u52a1\u5b9e\u73b0\uff0c\u4e1a\u52a1\u7f16\u5199\u6bd4\u8f83\u590d\u6742\u3002</li> <li>\u5b89\u5168\u6027\u8003\u8651\uff1aCancel \u52a8\u4f5c\u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u8d44\u6e90\u5c31\u65e0\u6cd5\u91ca\u653e\uff0c\u9700\u8981\u5f15\u5165\u91cd\u8bd5\u673a\u5236\uff0c\u800c\u91cd\u8bd5\u673a\u5236\u53ef\u80fd\u5bfc\u81f4\u91cd\u590d\u6267\u884c\uff0c\u8fd8\u8981\u8003\u8651\u91cd\u8bd5\u65f6\u7684\u5e42\u7b49\u95ee\u9898\u3002</li> </ul>"},{"location":"architecture/distributed-transaction/#25","title":"2.5 \u53ef\u9760\u6d88\u606f\u670d\u52a1","text":"<p>\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u7684\u601d\u8def\uff0c\u5176\u5b9e\u662f\u6e90\u4e8e eBay\uff0c\u5176\u57fa\u672c\u7684\u8bbe\u8ba1\u601d\u60f3\u662f\u5c06\u8fdc\u7a0b\u5206\u5e03\u5f0f\u4e8b\u52a1\u62c6\u5206\u6210\u4e00\u7cfb\u5217\u7684\u672c\u5730\u4e8b\u52a1\u3002</p>"},{"location":"architecture/distributed-transaction/#251","title":"2.5.1 \u57fa\u672c\u539f\u7406","text":"<p>\u4e00\u822c\u5206\u4e3a\u4e8b\u52a1\u7684\u53d1\u8d77\u8005 A \u548c\u4e8b\u52a1\u7684\u5176\u5b83\u53c2\u4e0e\u8005 B\uff1a</p> <ul> <li>\u4e8b\u52a1\u53d1\u8d77\u8005 A \u6267\u884c\u672c\u5730\u4e8b\u52a1</li> <li>\u4e8b\u52a1\u53d1\u8d77\u8005 A \u901a\u8fc7 MQ \u5c06\u9700\u8981\u6267\u884c\u7684\u4e8b\u52a1\u6d88\u606f\u53d1\u9001\u7ed9\u4e8b\u52a1\u53c2\u4e0e\u8005 B</li> <li>\u4e8b\u52a1\u53c2\u4e0e\u8005 B \u63a5\u6536\u5230\u6d88\u606f\u540e\u6267\u884c\u672c\u5730\u4e8b\u52a1</li> </ul> <p></p> <p>\u51e0\u4e2a\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u4e8b\u52a1\u53d1\u8d77\u8005 A \u5fc5\u987b\u786e\u4fdd\u672c\u5730\u4e8b\u52a1\u6210\u529f\u540e\uff0c\u6d88\u606f\u4e00\u5b9a\u53d1\u9001\u6210\u529f</li> <li>MQ \u5fc5\u987b\u4fdd\u8bc1\u6d88\u606f\u6b63\u786e\u6295\u9012\u548c\u6301\u4e45\u5316\u4fdd\u5b58</li> <li>\u4e8b\u52a1\u53c2\u4e0e\u8005 B \u5fc5\u987b\u786e\u4fdd\u6d88\u606f\u6700\u7ec8\u4e00\u5b9a\u80fd\u6d88\u8d39\uff0c\u5982\u679c\u5931\u8d25\u9700\u8981\u591a\u6b21\u91cd\u8bd5</li> <li>\u4e8b\u52a1 B \u6267\u884c\u5931\u8d25\uff0c\u4f1a\u91cd\u8bd5\uff0c\u4f46\u4e0d\u4f1a\u5bfc\u81f4\u4e8b\u52a1 A \u56de\u6eda</li> </ul> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u5982\u679c\u4fdd\u8bc1\u6d88\u606f\u53d1\u9001\u4e00\u5b9a\u6210\u529f\uff1f\u5982\u679c\u4fdd\u8bc1\u6d88\u8d39\u8005\u4e00\u5b9a\u80fd\u6536\u5230\u6d88\u606f\uff1f</p>"},{"location":"architecture/distributed-transaction/#252-rocketmq","title":"2.5.2 RocketMQ \u4e8b\u52a1\u6d88\u606f","text":"<p>RocketMQ \u672c\u8eab\u81ea\u5e26\u4e86\u4e8b\u52a1\u6d88\u606f\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\uff0c\u539f\u7406\u5176\u5b9e\u5c31\u662f\u81ea\u5e26\u4e86\u672c\u5730\u6d88\u606f\u8868\u3002</p>"},{"location":"architecture/distributed-transaction/#253-rabbitmq","title":"2.5.3 RabbitMQ \u7684\u6d88\u606f\u786e\u8ba4","text":"<p>RabbitMQ \u786e\u4fdd\u6d88\u606f\u4e0d\u4e22\u5931\u7684\u601d\u8def\u6bd4\u8f83\u5947\u7279\uff0c\u5e76\u6ca1\u6709\u4f7f\u7528\u4f20\u7edf\u7684\u672c\u5730\u8868\uff0c\u800c\u662f\u5229\u7528\u4e86\u6d88\u606f\u7684\u786e\u8ba4\u673a\u5236\uff1a</p> <ul> <li>\u751f\u4ea7\u8005\u786e\u8ba4\u673a\u5236\uff1a\u786e\u4fdd\u6d88\u606f\u4ece\u751f\u4ea7\u8005\u5230\u8fbe MQ \u4e0d\u4f1a\u6709\u95ee\u9898<ul> <li>\u6d88\u606f\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u5230 RabbitMQ \u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u5f02\u6b65\u7684\u76d1\u542c\u5668\uff0c\u76d1\u542c\u6765\u81ea MQ \u7684 ACK</li> <li>MQ \u6536\u5230\u6d88\u606f\u540e\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u56de\u6267\u7ed9\u751f\u4ea7\u8005<ul> <li>\u6d88\u606f\u5230\u8fbe\u4ea4\u6362\u673a\u540e\u8def\u7531\u5931\u8d25\uff0c\u4f1a\u8fd4\u56de\u5931\u8d25 ACK</li> <li>\u6d88\u606f\u8def\u7531\u6210\u529f\uff0c\u6301\u4e45\u5316\u5931\u8d25\uff0c\u4f1a\u8fd4\u56de\u5931\u8d25 ACK</li> <li>\u6d88\u606f\u8def\u7531\u6210\u529f\uff0c\u6301\u4e45\u5316\u6210\u529f\uff0c\u4f1a\u8fd4\u56de\u6210\u529f ACK</li> </ul> </li> <li>\u751f\u4ea7\u8005\u63d0\u524d\u7f16\u5199\u597d\u4e0d\u540c\u56de\u6267\u7684\u5904\u7406\u65b9\u5f0f<ul> <li>\u5931\u8d25\u56de\u6267\uff1a\u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4\u540e\u91cd\u65b0\u53d1\u9001</li> <li>\u6210\u529f\u56de\u6267\uff1a\u8bb0\u5f55\u65e5\u5fd7\u7b49\u884c\u4e3a</li> </ul> </li> </ul> </li> <li>\u6d88\u8d39\u8005\u786e\u8ba4\u673a\u5236\uff1a\u786e\u4fdd\u6d88\u606f\u80fd\u591f\u88ab\u6d88\u8d39\u8005\u6b63\u786e\u6d88\u8d39<ul> <li>\u6d88\u8d39\u8005\u9700\u8981\u518d\u76d1\u542c\u961f\u5217\u7684\u65f6\u5019\u6307\u5b9a\u624b\u52a8 ACK \u6a21\u5f0f</li> <li>RabbitMQ \u628a\u6d88\u606f\u6295\u9012\u7ed9\u6d88\u8d39\u8005\u540e\uff0c\u4f1a\u7b49\u5f85\u6d88\u8d39\u8005 ACK\uff0c\u63a5\u6536\u5230 ACK \u540e\u624d\u5220\u9664\u6d88\u606f\uff0c\u5982\u679c\u6ca1\u6709\u63a5\u6536\u5230 ACK \u6d88\u606f\u4f1a\u4e00\u76f4\u4fdd\u7559\u5728\u670d\u52a1\u7aef\uff0c\u5982\u679c\u6d88\u8d39\u8005\u65ad\u5f00\u8fde\u63a5\u6216\u5f02\u5e38\u540e\uff0c\u6d88\u606f\u4f1a\u6295\u9012\u7ed9\u5176\u5b83\u6d88\u8d39\u8005\u3002</li> <li>\u6d88\u8d39\u8005\u5904\u7406\u5b8c\u6d88\u606f\uff0c\u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u624b\u52a8 ACK\u3002\u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\uff0c\u5219\u4e0d\u4f1a ACK\uff0c\u4e1a\u52a1\u5904\u7406\u5931\u8d25\uff0c\u7b49\u5f85\u4e0b\u4e00\u6761\u6d88\u606f\u3002</li> </ul> </li> </ul> <p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u4e24\u79cd\u786e\u8ba4\u673a\u5236\uff0c\u53ef\u4ee5\u786e\u4fdd\u4ece\u6d88\u606f\u751f\u4ea7\u8005\u5230\u6d88\u8d39\u8005\u7684\u6d88\u606f\u5b89\u5168\uff0c\u518d\u7ed3\u5408\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e24\u7aef\u7684\u672c\u5730\u4e8b\u52a1\uff0c\u5373\u53ef\u4fdd\u8bc1\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6700\u7ec8\u4e00\u81f4\u6027\u3002</p>"},{"location":"architecture/distributed-transaction/#254","title":"2.5.4 \u6d88\u606f\u4e8b\u52a1\u7684\u4f18\u7f3a\u70b9","text":""},{"location":"architecture/distributed-transaction/#_8","title":"\u4f18\u70b9","text":"<ul> <li>\u4e1a\u52a1\u76f8\u5bf9\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u7f16\u5199\u4e09\u4e2a\u9636\u6bb5\u4e1a\u52a1</li> <li>\u662f\u591a\u4e2a\u672c\u5730\u4e8b\u52a1\u7684\u7ed3\u5408\uff0c\u56e0\u6b64\u8d44\u6e90\u9501\u5b9a\u5468\u671f\u77ed\uff0c\u6027\u80fd\u597d</li> </ul>"},{"location":"architecture/distributed-transaction/#_9","title":"\u7f3a\u70b9","text":"<ul> <li>\u4ee3\u7801\u4fb5\u5165</li> <li>\u4f9d\u8d56\u4e8e MQ \u7684\u53ef\u9760\u6027</li> <li>\u6d88\u606f\u53d1\u8d77\u8005\u53ef\u4ee5\u56de\u6eda\uff0c\u4f46\u662f\u6d88\u606f\u53c2\u4e0e\u8005\u65e0\u6cd5\u5f15\u8d77\u4e8b\u52a1\u56de\u6eda</li> <li>\u4e8b\u52a1\u65f6\u6548\u6027\u5dee\uff0c\u53d6\u51b3\u4e8e MQ \u6d88\u606f\u53d1\u9001\u662f\u5426\u53ca\u65f6\uff0c\u8fd8\u6709\u6d88\u606f\u53c2\u4e0e\u8005\u7684\u6267\u884c\u60c5\u51b5</li> </ul>"},{"location":"architecture/distributed-transaction/#26-at","title":"2.6 AT \u6a21\u5f0f","text":"<p>AT \u6a21\u5f0f\u662f\u4e00\u79cd\u65e0\u4fb5\u5165\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u53d1\u96be\u3002\u53ef\u4ee5\u770b\u505a\u662f\u5bf9 TCC \u6216\u8005\u4e8c\u9636\u6bb5\u63d0\u4ea4\u6a21\u578b\u7684\u4e00\u79cd\u4f18\u5316\uff0c\u89e3\u51b3\u4e86 TCC \u6a21\u5f0f\u4e2d\u7684\u4ee3\u7801\u4fb5\u5165\u3001\u7f16\u7801\u590d\u6742\u7b49\u95ee\u9898\u3002</p> <p>\u5728 AT \u6a21\u5f0f\u4e0b\uff0c\u7528\u6237\u53ea\u9700\u5173\u6ce8\u81ea\u5df1\u7684\u201c\u4e1a\u52a1 SQL\u201d\uff0c\u7528\u6237\u7684\u201c\u4e1a\u52a1 SQL\u201d\u4f5c\u4e3a\u4e00\u9636\u6bb5\uff0cSeata \u6846\u67b6\u4f1a\u81ea\u52a8\u751f\u6210\u4e8b\u52a1\u7684\u4e8c\u9636\u6bb5\u63d0\u4ea4\u548c\u56de\u6eda\u64cd\u4f5c\u3002</p>"},{"location":"architecture/distributed-transaction/#261","title":"2.6.1 \u57fa\u672c\u539f\u7406","text":"<p>AT \u6a21\u5f0f\u5e95\u5c42\u505a\u7684\u4e8b\u60c5\u4e0e TCC \u53ef\u5b8c\u5168\u4e0d\u540c\uff0c\u800c\u4e14\u7b2c\u4e8c\u9636\u6bb5\u6839\u672c\u4e0d\u9700\u8981\u6211\u4eec\u7f16\u5199\uff0c\u5168\u90e8\u7531 Seata \u81ea\u5df1\u5b9e\u73b0\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5199\u7684\u4ee3\u7801\u4e0e\u672c\u5730\u4e8b\u52a1\u65f6\u7684\u4ee3\u7801\u4e00\u6837\uff0c\u65e0\u9700\u624b\u52a8\u5904\u7406\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002</p>"},{"location":"architecture/distributed-transaction/#_10","title":"\u4e00\u9636\u6bb5","text":"<p>\u5728\u4e00\u9636\u6bb5\uff0cSeata \u4f1a\u62e6\u622a\u201c\u4e1a\u52a1 SQL\u201d\uff0c\u9996\u5148\u89e3\u6790 SQL \u8bed\u4e49\uff0c\u627e\u5230\u201c\u4e1a\u52a1 SQL\u201d\u8981\u66f4\u65b0\u7684\u4e1a\u52a1\u6570\u636e\uff0c\u5728\u4e1a\u52a1\u6570\u636e\u88ab\u66f4\u65b0\u524d\uff0c\u5c06\u5176\u4fdd\u5b58\u6210 before image\uff0c\u7136\u540e\u6267\u884c\u201c\u4e1a\u52a1 SQL\u201d\u66f4\u65b0\u4e1a\u52a1\u6570\u636e\uff0c\u5728\u4e1a\u52a1\u6570\u636e\u66f4\u65b0\u4e4b\u540e\uff0c\u518d\u5c06\u5176\u4fdd\u5b58\u6210 after image\uff0c\u6700\u540e\u83b7\u53d6\u5168\u5c40\u884c\u9501\uff0c\u63d0\u4ea4\u4e8b\u52a1\u3002\u4ee5\u4e0a\u64cd\u4f5c\u5168\u90e8\u5728\u4e00\u4e2a\u6570\u636e\u5e93\u4e8b\u52a1\u5185\u5b8c\u6210\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e86\u4e00\u9636\u6bb5\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</p> <p></p>"},{"location":"architecture/distributed-transaction/#_11","title":"\u4e8c\u9636\u6bb5\u63d0\u4ea4","text":"<p>\u4e8c\u9636\u6bb5\u5982\u679c\u662f\u63d0\u4ea4\u7684\u8bdd\uff0c\u56e0\u4e3a\u201c\u4e1a\u52a1 SQL\u201d\u5728\u4e00\u9636\u6bb5\u5df2\u7ecf\u63d0\u4ea4\u81f3\u6570\u636e\u5e93\uff0c\u6240\u4ee5 Seata \u6846\u67b6\u53ea\u9700\u5c06\u4e00\u9636\u6bb5\u4fdd\u5b58\u7684\u5feb\u7167\u6570\u636e\u548c\u884c\u9501\u5220\u6389\uff0c\u5b8c\u6210\u6570\u636e\u6e05\u7406\u5373\u53ef\u3002</p>"},{"location":"architecture/distributed-transaction/#_12","title":"\u4e8c\u9636\u6bb5\u56de\u6eda","text":"<p>\u4e8c\u9636\u6bb5\u5982\u679c\u662f\u56de\u6eda\u7684\u8bdd\uff0cSeata \u5c31\u9700\u8981\u56de\u6eda\u4e00\u9636\u6bb5\u5df2\u7ecf\u6267\u884c\u7684\u201c\u4e1a\u52a1 SQL\u201d\uff0c\u8fd8\u539f\u4e1a\u52a1\u6570\u636e\u3002\u56de\u6eda\u65b9\u5f0f\u4fbf\u662f\u7528 before image \u8fd8\u539f\u4e1a\u52a1\u6570\u636e\uff1b\u4f46\u5728\u8fd8\u539f\u4e4b\u524d\u9996\u5148\u8981\u6821\u9a8c\u810f\u5199\uff0c\u5bf9\u6bd4\u6570\u636e\u5e93\u5f53\u524d\u4e1a\u52a1\u6570\u636e\u548c after image\uff0c\u5982\u679c\u4e24\u4efd\u6570\u636e\u5b8c\u5168\u4e00\u81f4\u5c31\u8bf4\u660e\u6ca1\u6709\u810f\u5199\uff0c\u53ef\u4ee5\u8fd8\u539f\u4e1a\u52a1\u6570\u636e\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\u5c31\u8bf4\u660e\u6709\u810f\u5199\uff0c\u51fa\u73b0\u810f\u5199\u5c31\u9700\u8981\u8f6c\u4eba\u5de5\u5904\u7406\u3002</p> <p></p> <p>\u4e0d\u8fc7\u56e0\u4e3a\u6709\u5168\u5c40\u9501\u673a\u5236\uff0c\u6240\u4ee5\u53ef\u4ee5\u964d\u4f4e\u51fa\u73b0\u810f\u5199\u7684\u6982\u7387\u3002</p> <p>AT \u6a21\u5f0f\u7684\u4e00\u9636\u6bb5\u3001\u4e8c\u9636\u6bb5\u63d0\u4ea4\u548c\u56de\u6eda\u5747\u7531 Seata \u6846\u67b6\u81ea\u52a8\u751f\u6210\uff0c\u7528\u6237\u53ea\u9700\u7f16\u5199\u201c\u4e1a\u52a1 SQL\u201d\uff0c\u4fbf\u80fd\u8f7b\u677e\u63a5\u5165\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0cAT \u6a21\u5f0f\u662f\u4e00\u79cd\u5bf9\u4e1a\u52a1\u65e0\u4efb\u4f55\u4fb5\u5165\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"architecture/distributed-transaction/#262","title":"2.6.2 \u8be6\u7ec6\u67b6\u6784\u4e0e\u6d41\u7a0b","text":"<p>Seata \u4e2d\u7684\u51e0\u4e2a\u57fa\u672c\u6982\u5ff5\uff1a</p> <ul> <li> <p>\u4e8b\u52a1\u534f\u8c03\u8005(Transaction Coordinator)</p> <p>\u7ef4\u62a4\u5168\u5c40\u548c\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u9a71\u52a8\u5168\u5c40\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</p> </li> <li> <p>\u4e8b\u52a1\u7ba1\u7406\u5668(Transaction Manager)</p> <p>\u5b9a\u4e49\u5168\u5c40\u4e8b\u52a1\u7684\u8303\u56f4\uff1a\u5f00\u59cb\u5168\u5c40\u4e8b\u52a1\u3001\u63d0\u4ea4\u6216\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u3002</p> </li> <li> <p>\u8d44\u6e90\u7ba1\u7406\u5668(Resource Manager)</p> <p>\u7ba1\u7406\u5206\u652f\u4e8b\u52a1\u5904\u7406\u7684\u8d44\u6e90\uff0c\u4e0e TC \u4ea4\u8c08\u4ee5\u6ce8\u518c\u5206\u652f\u4e8b\u52a1\u548c\u62a5\u544a\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u5e76\u9a71\u52a8\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</p> </li> </ul> <p></p>"},{"location":"architecture/distributed-transaction/#_13","title":"\u4e00\u9636\u6bb5","text":"<ul> <li>TM \u5f00\u542f\u5168\u5c40\u4e8b\u52a1\uff0c\u5e76\u5411 TC \u58f0\u660e\u5168\u5c40\u4e8b\u52a1\uff0c\u5305\u62ec\u5168\u5c40\u4e8b\u52a1 XID \u4fe1\u606f</li> <li>TM \u6240\u5728\u670d\u52a1\u8c03\u7528\u5176\u5b83\u5fae\u670d\u52a1</li> <li>\u5fae\u670d\u52a1\u4e3b\u8981\u7531 RM \u6765\u6267\u884c<ul> <li>\u67e5\u8be2 before image</li> <li>\u6267\u884c\u672c\u5730\u4e8b\u52a1</li> <li>\u67e5\u8be2 after image</li> <li>\u751f\u6210 undo log \u5e76\u5199\u5165\u6570\u636e\u5e93</li> <li>\u5411 TC \u6ce8\u518c\u5206\u652f\u4e8b\u52a1\uff0c\u544a\u77e5\u4e8b\u52a1\u6267\u884c\u7ed3\u679c</li> <li>\u83b7\u53d6\u5168\u5c40\u9501\uff08\u963b\u6b62\u5176\u5b83\u4e1a\u52a1\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff09</li> <li>\u91ca\u653e\u672c\u5730\u9501\uff08\u4e0d\u5f71\u54cd\u5176\u5b83\u4e1a\u52a1\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff09</li> </ul> </li> <li>\u5f85\u6240\u6709\u4e1a\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c\u4e8b\u52a1\u53d1\u8d77\u8005 TM \u4f1a\u5c1d\u8bd5\u5411 TC \u63d0\u4ea4\u5168\u5c40\u4e8b\u52a1</li> </ul>"},{"location":"architecture/distributed-transaction/#_14","title":"\u4e8c\u9636\u6bb5","text":"<ul> <li>TC \u7edf\u8ba1\u5206\u652f\u4e8b\u52a1\u6267\u884c\u60c5\u51b5\uff0c\u6839\u636e\u7ed3\u679c\u5224\u65ad\u4e0b\u4e00\u6b65\u884c\u4e3a<ul> <li>\u5206\u652f\u90fd\u6210\u529f\uff1a\u901a\u77e5\u5206\u652f\u4e8b\u52a1\uff0c\u63d0\u4ea4\u4e8b\u52a1</li> <li>\u6709\u5206\u652f\u6267\u884c\u5931\u8d25\uff1a\u901a\u77e5\u6267\u884c\u6210\u529f\u7684\u5206\u652f\u4e8b\u52a1\uff0c\u56de\u6eda\u4e8b\u52a1</li> </ul> </li> <li>\u5206\u652f\u4e8b\u52a1\u7684 RM<ul> <li>\u63d0\u4ea4\u4e8b\u52a1\uff1a\u76f4\u63a5\u6e05\u7a7a before image \u548c after image \u4fe1\u606f\uff0c\u91ca\u653e\u5168\u5c40\u9501</li> <li>\u56de\u6eda\u4e8b\u52a1\uff1a<ul> <li>\u6821\u9a8c after image\uff0c\u5224\u65ad\u662f\u5426\u6709\u810f\u5199</li> <li>\u5982\u679c\u6ca1\u6709\u810f\u5199\uff0c\u56de\u6eda\u6570\u636e\u5230 before image\uff0c\u6e05\u9664 before image \u548c after image</li> <li>\u5982\u679c\u6709\u810f\u5199\uff0c\u8bf7\u6c42\u4eba\u5de5\u4ecb\u5165</li> </ul> </li> </ul> </li> </ul>"},{"location":"architecture/distributed-transaction/#263","title":"2.6.3 \u4f18\u7f3a\u70b9","text":""},{"location":"architecture/distributed-transaction/#_15","title":"\u4f18\u70b9","text":"<ul> <li>\u4e0e 2PC \u76f8\u6bd4\uff1a\u6bcf\u4e2a\u5206\u652f\u4e8b\u52a1\u90fd\u662f\u72ec\u7acb\u63d0\u4ea4\uff0c\u4e0d\u4e92\u76f8\u7b49\u5f85\uff0c\u51cf\u5c11\u4e86\u8d44\u6e90\u9501\u5b9a\u548c\u963b\u585e\u65f6\u95f4</li> <li>\u4e0e TCC \u76f8\u6bd4\uff1a\u4e8c\u9636\u6bb5\u7684\u6267\u884c\u64cd\u4f5c\u5168\u90e8\u81ea\u52a8\u5316\u5b8c\u6210\uff0c\u65e0\u4ee3\u7801\u4fb5\u5165\uff0c\u5f00\u53d1\u6210\u672c\u4f4e</li> </ul>"},{"location":"architecture/distributed-transaction/#_16","title":"\u7f3a\u70b9","text":"<ul> <li>\u4e0e TCC \u76f8\u6bd4\uff0c\u9700\u8981\u52a8\u6001\u751f\u6210\u4e8c\u9636\u6bb5\u7684\u53cd\u5411\u8865\u507f\u64cd\u4f5c\uff0c\u6267\u884c\u6027\u80fd\u7565\u4f4e\u4e8e TCC</li> </ul>"},{"location":"architecture/distributed-transaction/#27-sega","title":"2.7 Sega \u6a21\u5f0f","text":""},{"location":"architecture/distributed-transaction/#271","title":"2.7.1 \u57fa\u672c\u6a21\u578b","text":"<p>\u5728 Saga \u6a21\u5f0f\u4e0b\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u5185\u6709\u591a\u4e2a\u53c2\u4e0e\u8005\uff0c\u6bcf\u4e00\u4e2a\u53c2\u4e0e\u8005\u90fd\u662f\u4e00\u4e2a\u51b2\u6b63\u8865\u507f\u670d\u52a1\uff0c\u9700\u8981\u7528\u6237\u6839\u636e\u4e1a\u52a1\u573a\u666f\u5b9e\u73b0\u5176\u6b63\u5411\u64cd\u4f5c\u548c\u9006\u5411\u56de\u6eda\u64cd\u4f5c\u3002</p> <p>\u5206\u5e03\u5f0f\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4f9d\u6b21\u6267\u884c\u5404\u53c2\u4e0e\u8005\u7684\u6b63\u5411\u64cd\u4f5c\uff0c\u5982\u679c\u6240\u6709\u6b63\u5411\u64cd\u4f5c\u5747\u6267\u884c\u6210\u529f\uff0c\u90a3\u4e48\u5206\u5e03\u5f0f\u4e8b\u52a1\u63d0\u4ea4\u3002\u5982\u679c\u4efb\u4f55\u4e00\u4e2a\u6b63\u5411\u64cd\u4f5c\u6267\u884c\u5931\u8d25\uff0c\u90a3\u4e48\u5206\u5e03\u5f0f\u4e8b\u52a1\u4f1a\u9000\u56de\u53bb\u6267\u884c\u524d\u9762\u5404\u53c2\u4e0e\u8005\u7684\u9006\u5411\u56de\u6eda\u64cd\u4f5c\uff0c\u56de\u6eda\u5df2\u63d0\u4ea4\u7684\u53c2\u4e0e\u8005\uff0c\u4f7f\u5206\u5e03\u5f0f\u4e8b\u52a1\u56de\u5230\u521d\u59cb\u72b6\u6001\u3002</p> <p></p> <p>Sega \u6a21\u5f0f\u4e0b\u5206\u5e03\u5f0f\u4e8b\u52a1\u901a\u5e38\u662f\u7531\u4e8b\u4ef6\u9a71\u52a8\u7684\uff0c\u5404\u4e2a\u53c2\u4e0e\u8005\u4e4b\u95f4\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0cSega \u6a21\u5f0f\u662f\u4e00\u79cd\u957f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"architecture/distributed-transaction/#272","title":"2.7.2 \u9002\u7528\u573a\u666f","text":"<ul> <li>\u4e1a\u52a1\u6d41\u7a0b\u957f\u3001\u4e1a\u52a1\u6d41\u7a0b\u591a</li> <li>\u53c2\u4e0e\u8005\u5305\u542b\u5176\u5b83\u516c\u53f8\u6216\u9057\u7559\u7cfb\u7edf\u670d\u52a1\uff0c\u65e0\u6cd5\u63d0\u4f9b TCC \u6a21\u5f0f\u8981\u6c42\u7684\u4e09\u4e2a\u63a5\u53e3</li> </ul>"},{"location":"architecture/distributed-transaction/#273","title":"2.7.3 \u4f18\u52bf\u548c\u7f3a\u70b9","text":""},{"location":"architecture/distributed-transaction/#_17","title":"\u4f18\u52bf","text":"<ul> <li>\u4e00\u9636\u6bb5\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\uff0c\u65e0\u9501\uff0c\u9ad8\u6027\u80fd</li> <li>\u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784\uff0c\u53c2\u4e0e\u8005\u53ef\u5f02\u6b65\u6267\u884c\uff0c\u9ad8\u541e\u5410</li> <li>\u8865\u507f\u670d\u52a1\u6613\u4e8e\u5b9e\u73b0</li> </ul>"},{"location":"architecture/distributed-transaction/#_18","title":"\u7f3a\u70b9","text":"<ul> <li>\u4e0d\u4fdd\u8bc1\u9694\u79bb\u6027</li> </ul>"},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/","title":"Index","text":""},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/#_1","title":"\u7248\u672c","text":"<code>jdk</code> <code>11</code> <code>spring-boot</code> <code>2.6.11</code> <code>spring-cloud</code> <code>2021.0.4</code> <code>spring-cloud-alibaba</code> <code>2021.0.4.0</code> <code>mybatis-plus</code> <code>3.5.2</code>"},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/#_2","title":"\u542f\u52a8","text":""},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/#_3","title":"\u521d\u59cb\u5316\u6570\u636e\u5e93","text":"<ul> <li><code>sql/sql.sql</code></li> <li><code>https://github.com/seata/seata/blob/develop/script/client/at/db/mysql.sql</code></li> </ul>"},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/#_4","title":"\u542f\u52a8\u670d\u52a1","text":""},{"location":"architecture/distributed-transaction/__demo__/seata-openfeign-demo/#_5","title":"\u6d4b\u8bd5","text":"<ul> <li> <p>\u63d0\u4ea4</p> <pre><code>curl http://127.0.0.1:8081/purchase/commit\n</code></pre> </li> <li> <p>\u56de\u6eda</p> <pre><code>curl http://127.0.0.1:8081/purchase/rollback\n</code></pre> </li> </ul>"},{"location":"backend/","title":"\u540e\u7aef","text":""},{"location":"backend/dubbo/","title":"Dubbo","text":""},{"location":"backend/dubbo/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/dubbo/#dubbo-netty","title":"Dubbo \u5982\u4f55\u5c06 Netty \u7684\u5f02\u6b65\u8bf7\u6c42\u8f6c\u4e3a\u540c\u6b65\u65b9\u6cd5\u8c03\u7528","text":"<ol> <li> <p>\u6bcf\u6b21\u8bf7\u6c42\u751f\u6210\u552f\u4e00\u7684 <code>requestId</code>\uff0c\u6b64\u65f6\u662f\u8c03\u7528\u7ebf\u7a0b\uff1b</p> </li> <li> <p>\u8c03\u7528\u7ebf\u7a0b\u751f\u6210 <code>CompletableFuture</code>\uff0c\u5411 Netty \u7684 Channel \u5199\u6570\u636e\u524d\uff0c\u5c06 <code>CompletableFuture</code> \u4fdd\u5b58\u5230 <code>FUTURES</code>\uff08\u8fd9\u662f\u4e00\u4e2a map\uff09\u4e2d\uff0ckey \u4e3a <code>requestId</code>\uff0c\u540c\u65f6\u5c06 <code>requestId</code> \u5199\u5165\u8bf7\u6c42\u4e2d\u3002\u7136\u540e\u4ece <code>CompletableFuture</code> \u540c\u6b65\u83b7\u53d6\u7ed3\u679c\uff1b</p> </li> <li> <p>Netty \u6536\u5230\u5199\u8bf7\u6c42\u540e\uff0c\u89e3\u6790\u5230 <code>requestId</code>\uff0c\u4ece <code>FUTURES</code> \u83b7\u53d6\u5230 <code>CompletableFuture</code>\uff0c\u7136\u540e\u8c03\u7528\u5b8c\u6210\u65b9\u6cd5\uff1b</p> </li> <li> <p>\u6b64\u65f6\u8c03\u7528\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u4ece <code>CompletableFuture</code> \u4e2d\u83b7\u53d6\u7ed3\u679c\uff0c\u5b8c\u6210\u540c\u6b65\u8c03\u7528\u8fc7\u7a0b\uff1b</p> </li> </ol>"},{"location":"backend/express/","title":"Express.js","text":""},{"location":"backend/express/express-with-https/","title":"Express \u542f\u7528 HTTPS","text":""},{"location":"backend/express/express-with-https/#_1","title":"\u7533\u8bf7\u8bc1\u4e66","text":"<ul> <li>Let's Encrypt \u7f51\u9875\u7248\u672c,\u83b7\u53d6 SSL \u7f51\u7ad9\u8bc1\u4e66</li> </ul>"},{"location":"backend/express/express-with-https/#_2","title":"\u4f7f\u7528\u8bc1\u4e66","text":"<pre><code>const http = require('http')\nconst https = require('https')\nconst fs = require('fs')\nconst path = require('path')\nconst express = require('express')\n\nconst app = express()\n\napp.get('/', (req, res) =&gt; {\n  res.json({\n    hello: 'world',\n    protocol: req.protocol,\n    host: req.get('host'),\n    path: req.path,\n    ip: req.ip\n  })\n})\n\nhttp.createServer(app).listen(8080, () =&gt; console.log(`listening on :8080`))\n\nconst options = {\n  key: fs.readFileSync(path.resolve(__dirname, '../certificate/private.pem'), 'utf-8'),\n  cert: fs.readFileSync(path.resolve(__dirname, '../certificate/certificate.crt'), 'utf-8')\n}\nhttps.createServer(options, app).listen(8443, () =&gt; console.log(`listening on :8443`))\n</code></pre>"},{"location":"backend/express/__demo__/multilevel-routing/","title":"Express \u591a\u7ea7\u8def\u7531","text":""},{"location":"backend/grpc/","title":"gRPC","text":""},{"location":"backend/grpc/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/grpc/#grpc-http2","title":"gRPC \u7cfb\u5217(\u4e09) \u5982\u4f55\u501f\u52a9 HTTP2 \u5b9e\u73b0\u4f20\u8f93","text":""},{"location":"backend/grpc/__demo__/grpc-demo/","title":"gRPC demo","text":""},{"location":"backend/grpc/__demo__/grpc-demo/#_1","title":"\u751f\u6210\u4ee3\u7801","text":""},{"location":"backend/grpc/__demo__/grpc-demo/#go","title":"Go","text":"<pre><code>go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28\ngo install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2\n</code></pre>"},{"location":"backend/grpc/__demo__/grpc-demo/#node","title":"Node","text":"<pre><code>npm install -D grpc_tools_node_protoc_ts grpc-tools\n</code></pre>"},{"location":"backend/grpc/__demo__/grpc-demo/#_2","title":"\u6d4b\u8bd5","text":""},{"location":"backend/grpc/__demo__/grpc-demo/#functionservice","title":"<code>FunctionService</code>","text":"<ul> <li> <p><code>fetch</code></p> <pre><code>{}\n</code></pre> </li> <li> <p><code>invoke</code></p> <pre><code>{\n  \"invocations\": [\n    { \"host\": \"localhost\", \"port\": 8081 },\n    { \"host\": \"127.0.0.1\", \"port\": 8081 }\n  ]\n}\n</code></pre> </li> </ul>"},{"location":"backend/jooq/","title":"JOOQ","text":""},{"location":"backend/mybatis/","title":"MyBatis","text":""},{"location":"backend/mybatis/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/mybatis/#mybatis-plus-jdk8-localdatetime","title":"[\u89e3\u51b3]mybatis-plus \u4f7f\u7528 jdk8 \u7684 LocalDateTime \u67e5\u8be2\u65f6\u62a5\u9519","text":""},{"location":"backend/netty/","title":"Netty","text":""},{"location":"backend/netty/__demo__/netty-rpc-demo/","title":"Index","text":""},{"location":"backend/netty/__demo__/netty-rpc-demo/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"backend/netty/__demo__/netty-rpc-demo/#_2","title":"\u670d\u52a1\u7aef","text":"<pre><code>public class MathService {\n    public Integer fibonacci(Integer n) {\n        if (n == 0) {\n            return 0;\n        } else if (n == 1) {\n            return 1;\n        } else {\n            return fibonacci(n - 1) + fibonacci(n - 2);\n        }\n    }\n}\n</code></pre> <pre><code>public class MathApp {\n    public static void main(String[] args) throws Exception {\n        String serviceName = \"math-service\";\n        Integer port = 8888;\n        ZooKeeperServiceDiscovery serviceDiscovery = new ZooKeeperServiceDiscovery(\"192.192.192.6:2181\");\n        Map&lt;String, ?&gt; apiMap = Map.of(\n            MathService.class.getName(), new MathService()\n        );\n        new RPCServer(serviceName, port, serviceDiscovery, apiMap).start();\n    }\n}\n</code></pre>"},{"location":"backend/netty/__demo__/netty-rpc-demo/#_3","title":"\u5ba2\u6237\u7aef","text":"<pre><code>public interface BusinessService {\n    @RPCReference(serviceName = \"math-service\", className = \"org.example.module.math.MathService\", methodName = \"fibonacci\")\n    Integer fibonacci(Integer n);\n}\n</code></pre> <pre><code>public class BusinessApp {\n    public static void main(String[] args) {\n        ServiceDiscovery serviceDiscovery = new ZooKeeperServiceDiscovery(\"192.192.192.6:2181\");\n        LoadBalancer&lt;String&gt; loadBalancer = new RandomLoadBalancer&lt;&gt;();\n        RPCClient client = new RPCClient(serviceDiscovery, loadBalancer);\n\n        BusinessService businessService = client.reference(BusinessService.class);\n\n        Integer result = businessService.fibonacci(10);\n        System.out.println(result);\n    }\n}\n</code></pre>"},{"location":"backend/spring/","title":"Spring","text":""},{"location":"backend/spring/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/spring/#spring-spring","title":"\u3010\u8bd1\u3011Spring \u5b98\u65b9\u6587\u6863\uff1aSpring \u8bed\u8a00\u652f\u6301","text":""},{"location":"backend/spring/#java-2020","title":"Java \u57fa\u7840\u77e5\u8bc6\u9762\u8bd5\u9898\uff082020 \u6700\u65b0\u7248\uff09","text":""},{"location":"backend/spring/#spring_1","title":"Spring \u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u7684\u601d\u8def\u7adf\u7136\u6765\u81ea\u4e8e\u4e00\u9053\u7b97\u6cd5\u9898","text":""},{"location":"backend/spring/#spring_2","title":"Spring \u5f02\u5e38\u629b\u51fa\u89e6\u53d1\u4e8b\u52a1\u56de\u6eda\u7b56\u7565","text":""},{"location":"backend/spring/#spring-bean","title":"Spring Bean \u7684\u751f\u547d\u5468\u671f\uff08\u975e\u5e38\u8be6\u7ec6\uff09","text":""},{"location":"backend/spring/#spring-ioc","title":"Spring IOC \u5bb9\u5668\u6e90\u7801\u5206\u6790","text":""},{"location":"backend/spring/#mvc","title":"mvc \u5404\u4e2a\u5c42\u7684\u547d\u540d\u7b14\u8bb0","text":""},{"location":"backend/spring/#java-spring-requestrejectedexcept-cocoachina_","title":"java \u2013 \u5982\u4f55\u5728 Spring \u4e2d\u62e6\u622a RequestRejectedExcept... - CocoaChina_\u4e00\u7ad9\u5f0f\u5f00\u53d1\u8005\u6210\u957f\u793e\u533a","text":""},{"location":"backend/spring/#spring-spring_1","title":"\u8bd1\u3011Spring \u5b98\u65b9\u6587\u6863\uff1aSpring \u8bed\u8a00\u652f\u6301","text":""},{"location":"backend/spring/__demo__/spring-spring-mvc-mybatis/ssm-demo/","title":"Index","text":""},{"location":"backend/spring/__demo__/spring-spring-mvc-mybatis/ssm-demo/#spring","title":"Spring \u4f9d\u8d56","text":"<pre><code>spring-webmvc\n|--spring-aop\n|--spring-beans\n|--spring-context\n   |--spring-aop\n   |--spring-beans\n   |--spring-core\n   |--spring-expression\n|--spring-core\n|--spring-expression\n|--spring-web\n\nspring-jdbc\n|--spring-beans\n|--spring-tx\n</code></pre>"},{"location":"backend/spring/__demo__/spring-spring-mvc-mybatis/ssm-demo/#jackson","title":"Jackson \u4f9d\u8d56","text":"<pre><code>jackson-datatype-jsr310\n|--jackson-annotations\n|--jackson-core\n|--jackson-databind\n   |--jackson-annotations\n   |--jackson-core\n</code></pre>"},{"location":"backend/spring/__demo__/spring-spring-mvc-mybatis/ssm-demo/#logback","title":"Logback \u4f9d\u8d56","text":"<pre><code>logback-classic\n|--logback-core\n|--slf4j-api\n</code></pre>"},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/","title":"Index","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#_1","title":"\u4e09\u3001\u5b9e\u9a8c\u8fc7\u7a0b","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#31","title":"3.1 \u4f9d\u8d56","text":"<ul> <li>Servlet API\uff08<code>javax.servlet-api</code>\uff09</li> <li>MySQL \u9a71\u52a8\uff08<code>mysql-connector-java</code>\uff09</li> <li>Druid \u6570\u636e\u6e90\uff08<code>druid</code>\uff09</li> <li>Spring \uff08<code>spring-beans</code>\u3001<code>spring-core</code>\u3001<code>spring-context</code>\u3001<code>spring-expression</code>\u3001<code>spring-web</code>\u3001<code>spring-orm</code>\uff09</li> <li>Hibernate\uff08<code>hibernate-core</code>\uff09</li> <li>Struts2\uff08<code>struts2-core</code>\u3001<code>struts2-convention-plugin</code>\u3001<code>struts2-spring-plugin</code>\uff09</li> </ul>"},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#31_1","title":"3.1 \u5b9e\u4f53\u2014\u2014\u8868\u5173\u7cfb\u914d\u7f6e","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#32-webxml","title":"3.2 <code>web.xml</code> \u914d\u7f6e","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#33-spring","title":"3.3 Spring \u914d\u7f6e","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#34-struts","title":"3.4 Struts \u914d\u7f6e","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#35-daoservice","title":"3.5 DAO\u3001Service","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#36-action","title":"3.6 Action","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#37","title":"3.7 \u9875\u9762","text":""},{"location":"backend/spring/__demo__/spring-struts-hibernate/web-ssh-test6/#_2","title":"\u4e94\u3001\u5b9e\u9a8c\u603b\u7ed3","text":"<ol> <li>Spring \u6574\u5408 Struts \u65f6\uff0c\u9664\u4e86\u4f9d\u8d56\u5176<code>spring-web</code>\u6a21\u5757\uff0c\u8fd8\u4f9d\u8d56\u4e8e Struts \u7684\u63d2\u4ef6 <code>struts2-spring-plugin</code></li> <li>\u76f4\u63a5\u5728 Action \u4e0a\u5b9a\u4e49\u516c\u5171\u7684\u903b\u8f91\u89c6\u56fe\u2014\u2014\u7269\u7406\u89c6\u56fe\u7684\u6620\u5c04\u80fd\u7b80\u5316 Action \u65b9\u6cd5</li> </ol>"},{"location":"backend/spring-boot/","title":"Spring Boot","text":""},{"location":"backend/spring-boot/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/spring-boot/#spring-webflux","title":"spring webflux \u7cfb\u5217\u4e4b\u4e0a\u4f20\u5355\u6587\u4ef6\u4e0e\u591a\u6587\u4ef6\u5230\u4e03\u725b\u4e91\u7bc7","text":""},{"location":"backend/spring-boot/#spring-boot-date-localdatetime","title":"\u5982\u4f55\u5728 Spring Boot \u5e94\u7528\u4e2d\u4f18\u96c5\u7684\u4f7f\u7528 Date \u548c LocalDateTime","text":""},{"location":"backend/spring-boot/#springboot","title":"SPRINGBOOT \u542f\u52a8\u6d41\u7a0b\u53ca\u5176\u539f\u7406","text":""},{"location":"backend/spring-boot/#buildpacks","title":"\u4f7f\u7528 Buildpacks \u6784\u5efa\u539f\u751f\u955c\u50cf","text":""},{"location":"backend/spring-boot/#java","title":"Java \u5bb9\u5668\u5316\u6307\u5317","text":""},{"location":"backend/spring-boot/#spring-boot-graalvm","title":"Spring Boot GraalVM","text":"<p>ubuntu \u4e2d\u7f16\u8bd1\u62a5\u9519 /usr/bin/ld: cannot find -lperl</p>"},{"location":"backend/spring-boot/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code># /usr/bin/ld: cannot find -lz: No such file or directory\napt install libz-dev -y\n# \u6784\u5efa\u53ef\u6267\u884c\u6587\u4ef6\nmvn clean native:compile -Pnative -Dmaven.test.skip=true\n# \u6784\u5efa\u955c\u50cf\nmvn spring-boot:build-image -Pnative -Dmaven.test.skip=true\n</code></pre>"},{"location":"backend/spring-boot/spring-boot%20%E8%B7%A8%E5%9F%9F/","title":"Spring boot \u8de8\u57df","text":""},{"location":"backend/spring-boot/spring-boot%20%E8%B7%A8%E5%9F%9F/#webmvcconfigurer","title":"\u4e00\u3001\u5b9e\u73b0 <code>WebMvcConfigurer</code>","text":"<ul> <li> <p>\u65b9\u5f0f\u4e00</p> <pre><code>import org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class CorsConfig implements WebMvcConfigurer {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry\n            .addMapping(\"/**\")\n            .allowedOriginPatterns(\"*\")\n            .allowedHeaders(\"*\")\n            .allowedMethods(\"*\")\n            .allowCredentials(true);\n    }\n}\n</code></pre> </li> <li> <p>\u65b9\u5f0f\u4e8c</p> <pre><code>import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class CorsConfig {\n    @Bean\n    public WebMvcConfigurer corsConfigurer() {\n        return new WebMvcConfigurer() {\n            @Override\n            public void addCorsMappings(CorsRegistry registry) {\n                registry\n                    .addMapping(\"/**\")\n                    .allowedOriginPatterns(\"*\")\n                    .allowedHeaders(\"*\")\n                    .allowedMethods(\"*\")\n                    .allowCredentials(true);\n            }\n        };\n    }\n}\n</code></pre> </li> </ul>"},{"location":"backend/spring-boot/spring-boot%20%E8%B7%A8%E5%9F%9F/#_1","title":"\u4e8c\u3001\u8fc7\u6ee4\u5668","text":"<pre><code>import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\n@Configuration\npublic class CorsConfig {\n    @Bean\n    public CorsFilter corsFilter() {\n        CorsConfiguration config = new CorsConfiguration();\n        config.addAllowedOriginPattern(CorsConfiguration.ALL);\n        config.addAllowedHeader(CorsConfiguration.ALL);\n        config.addAllowedMethod(CorsConfiguration.ALL);\n        config.setAllowCredentials(true);\n\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(\"/**\", config);\n\n        return new CorsFilter(source);\n    }\n}\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/","title":"Elasticsearch7.8.0 \u4ece\u5b89\u88c5\u5230\u9ad8\u4eae\u641c\u7d22 LOL \u82f1\u96c4\u540d","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#_1","title":"\u4e00\u3001\u524d\u8a00","text":"<p>\u73af\u5883\uff1a</p> <ul> <li>ES 7.8.0</li> <li>JDK11</li> <li>SpringBoot 2.3.0\uff08ES 7.6.2\uff09</li> </ul> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#_2","title":"\u4e8c\u3001\u5b89\u88c5","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#21-ik","title":"2.1 (\u4e2d\u6587)IK \u5206\u8bcd\u5668","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#211","title":"2.1.1 \u5206\u8bcd\u5668\u6548\u679c\uff1a","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#212-github","title":"2.1.2 GitHub \u5730\u5740\uff1a","text":"<p>https://github.com/medcl/elasticsearch-analysis-ik</p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#213","title":"2.1.3 \u4e0b\u8f7d\uff1a","text":"<p>\u4e3a\u4e86\u907f\u514d\u5728\u5bb9\u5668\u5185\u4e0b\u8f7d\u8fc7\u6162\uff0c\u6559\u4e3b\u9009\u62e9\u4e86\u63d0\u524d\u7528\u8fc5\u96f7\u4e0b\u8f7d\u4e0b\u6765\uff0c\u5e76\u4ee5\u5bb9\u5668\u5377\u6302\u8f7d\u7684\u65b9\u5f0f\u653e\u5230\u5bb9\u5668\u91cc\u53bb\u3002\u5927\u81f4\u7684\u76ee\u5f55\u5982\u4e0b\uff1a</p> <pre><code>elasticsearch/\n|--compose-elasticsearch.yml  # docker-compose.yml\n|--es0/                       # es0 \u8282\u70b9\n|--plugins/                   # \u63d2\u4ef6\u5377\n   |--ik/                     # \u5206\u8bcd\u5668\u63d2\u4ef6\n|--data/                      # \u6570\u636e\u5377\u597d\u4e1c\u897f\u5c31\u8981\u5206\u4eab\u51fa\u6765\uff1a\n</code></pre> <p>\u53e6\u5916\u5bb9\u5668\u5377\u6302\u8f7d\u7684\u65b9\u5f0f\u8fd8\u6709\u4e2a\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u7684\u6dfb\u52a0\u7528\u6237\u8bcd\u5178\uff1a</p> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#214","title":"2.1.4 \u597d\u4e1c\u897f\u5206\u4eab\u51fa\u6765\uff1a","text":"<p>GitHub \u4ee3\u4e0b\u5730\u5740 http://gitd.cc/</p> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#22-elasticsearch","title":"2.2 Elasticsearch","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#221","title":"2.2.1 \u521b\u5efa(\u5168\u5c40\u9ed8\u8ba4)\u7f51\u7edc\uff1a","text":"<pre><code>docker network create local-net\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#222-composeyml","title":"2.2.2 compose.yml\uff1a","text":"<pre><code>version: '3.8'\nservices:\n  es0:\n    image: elasticsearch:7.8.0\n    restart: always\n    ports:\n      - 9200:9200\n    volumes:\n      - ./es0/data/:/usr/share/elasticsearch/data/\n      - ./es0/plugins/:/usr/share/elasticsearch/plugins/\n    environment:\n      - node.name=es0\n      - cluster.name=es-cluster\n      - cluster.initial_master_nodes=es0\n      - bootstrap.memory_lock=true\n      - 'ES_JAVA_OPTS=-Xms512m -Xmx512m'\n      - xpack.security.enabled=true\n      - xpack.security.transport.ssl.enabled=true\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\nnetworks:\n  default:\n    external:\n      name: local-net\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#223","title":"2.2.3 \u8bbe\u7f6e\u5bc6\u7801\uff1a","text":"<p>\u5bb9\u5668\u7684\u5de5\u4f5c\u76ee\u5f55\u5df2\u7ecf\u5728<code>/usr/share/elasticsearch/</code>\u76ee\u5f55\u4e0b\uff0c\u8fdb\u5165\u5bb9\u5668\u540e\u76f4\u63a5\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\uff1a</p> <pre><code>bin/elasticsearch-setup-passwords interactive\n</code></pre> <p></p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>\u8bbe\u7f6e\u5bc6\u7801\u540e\u5982\u679c\u5220\u9664\u4e86\u65b0\u589e\u7684\u7d22\u5f15\uff0c\u4e0b\u6b21\u767b\u5f55\u65f6\u53ef\u80fd\u4f1a\u767b\u5f55\u4e0d\u4e0a\uff0c\u9700\u8981\u91cd\u65b0\u8fdb\u5165\u5bb9\u5668\u8bbe\u7f6e\u5bc6\u7801\u3002</li> <li><code>elastic</code>\u7528\u6237\u76f8\u5f53\u4e8e<code>root</code>\u7528\u6237</li> </ol> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#23-head","title":"2.3 Head \u63d2\u4ef6","text":"<p>Head \u63d2\u4ef6\u611f\u89c9\u8d77\u6765\u53ef\u6709\u53ef\u65e0(\u4e0d\u662f\u592a\u597d\u770b)\uff0c\u6709\u73b0\u6210\u7684 chrome \u63d2\u4ef6\u53ef\u7528\uff1aElasticSearch Head</p> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#24-kibana","title":"2.4 Kibana","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#241-composeyml","title":"2.4.1 compose.yml\uff1a","text":"<pre><code>version: '3.8'\nservices:\n  kibana:\n    image: kibana:7.8.0\n    privileged: true\n    ports:\n      - 5601:5601\n    volumes:\n      - ./kibana/conf/kibana.yml:/usr/share/kibana/config/kibana.yml\nnetworks:\n  default:\n    external:\n      name: local-net\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#242-kibanayml","title":"2.4.2 \u914d\u7f6e\u6587\u4ef6 kibana.yml\uff1a","text":"<pre><code>server.host: '0'\nelasticsearch.hosts: ['http://es0:9200']\nelasticsearch.username: 'elastic'\nelasticsearch.password: '123456'\ni18n.locale: 'zh-CN'\n</code></pre> <p>\u83b7\u53d6\u5b8c\u6574\u7684\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u4ece\u5b98\u7f51\u4e0b\u8f7d\u4e00\u4efd Windows \u7248\u7684\u8fdb\u884c\u53c2\u8003\u3002</p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#242","title":"2.4.2 \u8e29\u5751\u70b9\uff1a","text":"<ol> <li>\u53ef\u89c1\uff0c\u5728\u4e0a\u9762\u7684 Compose \u6587\u4ef6\u4e2d\u6559\u4e3b\u9009\u62e9\u4e86\u6302\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u539f\u56e0\u8fd8\u662f\u56e0\u4e3a\u5b89\u88c5\u5b98\u7f51\u6587\u6863\u5728<code>environment</code>\u4e2d\u914d\u7f6e\uff0c\u4f46\u662f\u7ed3\u679c\u4e0d\u751f\u6548\u3002</li> <li>\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u5c31\u662f kibana \u9ed8\u8ba4\u5141\u8bb8\u7684 HOST \u4e3a 127.0.0.1\uff0c\u53ea\u80fd\u5bb9\u5668\u5185\u8bbf\u95ee\uff0c\u9700\u8981\u8bbe\u4e3a <code>0.0.0.0</code> \u5bb9\u5668\u5916\u6620\u5c04\u7aef\u53e3\u624d\u80fd\u8fdb\u884c\u8bbf\u95ee\u3002</li> </ol>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#springboot","title":"\u4e09\u3001\u96c6\u6210 SpringBoot \u9ad8\u4eae\u67e5\u8be2","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#31","title":"3.1 \u8fde\u63a5\u914d\u7f6e","text":"<p><code>spring.data</code>\u8282\u70b9\u4e0b\u7684\u914d\u7f6e\u5927\u90e8\u5206\u5df2\u7ecf<code>@Deprecated</code>\u4e86\uff0c\u4f7f\u7528 RestHighLevelClient \u7684<code>elasticsearch</code>\u8282\u70b9\u76f4\u63a5\u5728<code>spring</code>\u8282\u70b9\u4e0b\uff1a</p> <pre><code>spring:\n  elasticsearch:\n    rest:\n      uris: http://127.0.0.1:9200\n      username: elastic\n      password: 123456\n</code></pre> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#32","title":"3.2 \u521b\u5efa\u89c4\u5219","text":"<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c31\u597d\u6bd4\u76f4\u63a5\u4f7f\u7528 REST API \u63d2\u5165\u6570\u636e\u5e76\u521b\u5efa\u7d22\u5f15\u4e00\u6837\u4e0d\u4f1a\u521b\u5efa\u89c4\u5219\u4e00\u6837\uff0c\u5c3d\u7ba1\u5728\u5b9e\u4f53\u5c5e\u6027\u7684<code>@Field</code>\u6ce8\u89e3\u4e0a\u6ce8\u660e\u4e86\u5b57\u7b26\u4e32\u5b57\u6bb5\u5177\u4f53\u7c7b\u578b\uff0c\u4e5f\u540c\u6837\u4e0d\u4f1a\u521b\u5efa\u7d22\u5f15\u89c4\u5219\u3002\u4f8b\u5982\u5982\u4e0b\u65b9\u5f0f\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\u89c4\u5219\uff1a</p> <pre><code>PUT /hero/_doc/1\n{\n  \"id\": 1,\n  \"name\": \"\u9ed1\u6697\u4e4b\u5973\",\n  \"alias\": \"Annie\",\n  \"title\": \"\u5b89\u59ae\"\n}\n</code></pre> <p>\u56e0\u6b64\u9700\u8981\u63d0\u524d\u521b\u5efa\u597d\u89c4\u5219(<code>keyword</code>\u4e0d\u4f1a\u88ab\u5206\u8bcd\u5668\u5206\u8bcd\uff0c\u9002\u5408<code>term</code>\u67e5\u8be2)\uff1a</p> <pre><code>PUT /hero\n{\n  \"mappings\": {\n    \"properties\": {\n      \"id\": {\n        \"type\": \"integer\"\n      },\n      \"name\": {\n        \"type\": \"text\",\n        \"analyzer\": \"ik_smart\"\n      },\n      \"alias\": {\n        \"type\": \"keyword\"\n      },\n      \"title\": {\n        \"type\": \"text\",\n        \"analyzer\": \"ik_smart\"\n      },\n      \"short_bio\": {\n        \"type\": \"text\",\n        \"analyzer\": \"ik_max_word\"\n      },\n      \"avatar_src\": {\n        \"type\": \"keyword\"\n      }\n    }\n  }\n}\n</code></pre> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#33-hero","title":"3.3 \u5efa\u7acb Hero \u5b9e\u4f53","text":"<pre><code>@Data\n@Accessors(chain = true)\n@AllArgsConstructor\n@NoArgsConstructor\n@Document(indexName = \"hero\")\npublic class Hero {\n    @Id\n    @Field(type = FieldType.Integer)\n    private Integer id;\n\n    @Field(type = FieldType.Text, analyzer = \"ik_smart\")\n    private String name;\n\n    @Field(type = FieldType.Keyword)\n    private String alias;\n\n    @Field(type = FieldType.Text, analyzer = \"ik_smart\")\n    private String title;\n\n    @Field(value = \"short_bio\", type = FieldType.Text, analyzer = \"ik_max_word\")\n    private String shortBio;\n\n    @Field(value = \"avatar_src\", type = FieldType.Keyword)\n    private String avatarSrc;\n}\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#34-lol","title":"3.4 \u5bfc\u5165 LOL \u82f1\u96c4\u6570\u636e","text":"<p>\u7b2c\u4e00\u4e2a\u82f1\u96c4\u7684\u63a5\u53e3\u4e3a \u9ed1\u6697\u4e4b\u5973 / Annie / \u5b89\u59ae \uff0c\u76ee\u524d\u4ece\u5b98\u7f51\u53ef\u89c1\u6700\u5927\u7684 ID \u4e3a 856\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u53ea\u6709 148 \u6761\u6709\u6548\u8bb0\u5f55\u3002\u5bf9\u4e8e\u4e0d\u5b58\u5728\u7684\u63a5\u53e3\u4f1a\u8fd4\u56de 404 \uff0cJsoup \u4f1a\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u56e0\u6b64\u9700\u8981\u8bbe\u7f6e<code>ignoreHttpErrors(true)</code>\u3002</p> <p>\u8bf7\u6c42\u5230\u7684 JSON \u9664\u4e86\u82f1\u96c4\u672c\u8eab\u7684\u4fe1\u606f\u5916\uff0c\u8fd8\u6709\u76ae\u80a4\u4fe1\u606f\u3001\u6280\u80fd\u4fe1\u606f\u7b49\uff0c\u5373\u4ee3\u7801\u4e2d\u7684<code>wrapper / rootNode</code>\uff0c\u800c\u6211\u4eec\u6682\u65f6\u53ea\u9700\u8981<code>hero</code>\u8282\u70b9\uff0c\u5c06\u5176\u8bfb\u53d6\u4e3a<code>JsonNode</code>\u6811\u72b6\u7ed3\u6784\u3002</p> <pre><code>@Slf4j\n@SpringBootTest\npublic class ImportDataTest {\n    @Autowired private ObjectMapper objectMapper;\n    @Autowired private ElasticsearchRestTemplate elasticsearchRestTemplate;\n    // @Autowired private MongoTemplate mongoTemplate;\n\n    // \u5bfc\u5165\u6570\u636e\n    @Test\n    void importDataTest() {\n        final int start = 1;\n        final int end = 856;\n        List&lt;Hero&gt; list = new ArrayList&lt;&gt;();\n        // List&lt;Object&gt; rootList = new ArrayList&lt;&gt;();\n        for (int i = start; i &lt;= end; i++) {\n            try {\n                Connection.Response response = Jsoup\n                        .connect(\"https://game.gtimg.cn/images/lol/act/img/js/hero/\" + i + \".js\")\n                        .timeout(30000)\n                        // \u5ffd\u7565\u8bf7\u6c42\u7c7b\u578b, \u8bf7\u6c42 JSON\n                        .ignoreContentType(true)\n                        // \u5ffd\u7565 404 \u7b49, \u4f7f\u7528 statusCode \u5224\u65ad\n                        .ignoreHttpErrors(true)\n                        .execute();\n                if (response.statusCode() == 200) {\n                    // wrapper = { hero: { name: '' } }\n                    String body = response.body();\n                    JsonNode rootNode = objectMapper.readTree(body);\n\n                    // \u5411 mongodb \u5b58\u4e00\u4efd\n                    // Object o = objectMapper.readValue(body, Object.class);\n                    // rootList.add(o);\n\n                    // hero = { name: '' }\n                    JsonNode heroNode = rootNode.get(\"hero\");\n                    Hero hero = objectMapper.readValue(heroNode.toPrettyString(), Hero.class);\n\n                    // hero = { id: i, name: '', avatarSrc: '' }\n                    String avatarSrc = \"https://game.gtimg.cn/images/lol/act/img/champion/\" + hero.getAlias() + \".png\";\n                    hero.setAvatarSrc(avatarSrc);\n                    hero.setId(i);\n\n                    log.info(hero.toString());\n                    list.add(hero);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n        // mongoTemplate.insert(rootList, \"hero_detail\");\n        elasticsearchRestTemplate.save(list);\n    }\n}\n</code></pre> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#35-rest-api","title":"3.5 \u9ad8\u4eae\u67e5\u8be2 REST API","text":"<pre><code>GET /hero/_search\n{\n  \"query\": {\n    \"multi_match\": {\n      \"query\": \"\u5f71\u6d41\u4e4b\u4e3b\",\n      \"fields\": [\"name\", \"title\", \"short_bio\"]\n    }\n  },\n  \"highlight\": {\n    \"pre_tags\": \"&lt;span style='color:red'&gt;\",\n    \"post_tags\": \"&lt;/span&gt;\",\n    \"fields\": {\n      \"name\": {},\n      \"title\": {},\n      \"short_bio\": {}\n    }\n  },\n  \"from\": 0,\n  \"size\": 10\n}\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#36-elasticsearchresttemplate","title":"3.6 \u9ad8\u4eae\u67e5\u8be2 ElasticsearchRestTemplate","text":"<p>\u9700\u8981\u6ce8\u610f\u7684\u662f PageRequest \u7684\u5f53\u524d\u9875\uff08<code>page</code>\uff09\u662f\u4ece 0 \u5f00\u59cb\u7684\u3002\u9ed8\u8ba4\u6309\u7167\u547d\u4e2d\u7387\uff08<code>_score</code>\uff09\u964d\u5e8f\u6392\u5e8f\u3002</p> <pre><code>@Slf4j\n@Service\npublic class HeroService {\n    @Autowired private ElasticsearchRestTemplate elasticsearchRestTemplate;\n\n    public Map&lt;String, Object&gt; hightlightSearch(String keyword) {\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n        Query query = new NativeSearchQueryBuilder()\n                .withQuery(\n                        new MultiMatchQueryBuilder(keyword, \"name\", \"title\", \"short_bio\")\n                )\n                .withHighlightBuilder(\n                        new HighlightBuilder()\n                                .preTags(\"&lt;span style='color:red'&gt;\")\n                                .postTags(\"&lt;/span&gt;\")\n                                .field(\"short_bio\")\n                                .field(\"title\")\n                                .field(\"name\")\n                )\n                .withSort(\n                        SortBuilders.scoreSort().order(SortOrder.DESC)\n                )\n                .withPageable(\n                        PageRequest.of(0, 10)\n                )\n                .build();\n        SearchHits&lt;Hero&gt; hits = elasticsearchRestTemplate.search(query, Hero.class);\n        // \u603b\u547d\u4e2d\u6570\n        int total = (int) hits.getTotalHits();\n        map.put(\"total\", total);\n\n        List&lt;SearchHit&lt;Hero&gt;&gt; hitList = hits.getSearchHits();\n\n        // \u672c\u9875\u547d\u4e2d\u6570\n        int size = hitList.size();\n        map.put(\"size\", size);\n\n        List&lt;Hero&gt; list = new ArrayList&lt;&gt;();\n\n        // \u4f7f\u7528\u9ad8\u4eae\u5b57\u6bb5\u66ff\u6362\u5b9e\u4f53\u5b57\u6bb5\n        for (SearchHit&lt;Hero&gt; hit : hitList) {\n            Hero hero = hit.getContent();\n            //\n            List&lt;String&gt; highlightShortBioList = hit.getHighlightField(\"shortBio\");\n            if (!highlightShortBioList.isEmpty()) {\n                String highlightShortBio = String.join(\"\", highlightShortBioList);\n                hero.setShortBio(highlightShortBio);\n            }\n            //\n            List&lt;String&gt; highlightTitleList = hit.getHighlightField(\"title\");\n            if (!highlightTitleList.isEmpty()) {\n                String highlightTitle = String.join(\"\", highlightTitleList);\n                hero.setTitle(highlightTitle);\n            }\n            //\n            List&lt;String&gt; highlightNameList = hit.getHighlightField(\"name\");\n            if (!highlightNameList.isEmpty()) {\n                String highlightName = String.join(\"\", highlightNameList);\n                hero.setName(highlightName);\n            }\n            list.add(hero);\n        }\n        // \u547d\u4e2d\u5355\u4f4d\u96c6\u5408\n        map.put(\"list\", list);\n\n        return map;\n    }\n}\n</code></pre> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#37-html","title":"3.7 HTML \u5c55\u793a","text":""},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#371","title":"3.7.1 \u9875\u9762\u8df3\u8f6c\uff1a","text":"<pre><code>@Controller\npublic class PageController {\n    @GetMapping({\"/\", \"/index\", \"index.html\"})\n    public String index() {\n        return \"index\";\n    }\n}\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#372","title":"3.7.2 \u9ad8\u4eae\u67e5\u8be2\u63a5\u53e3\uff1a","text":"<pre><code>@RestController\npublic class HeroController {\n    @Autowired private HeroService heroService;\n\n    @GetMapping(value = \"/highlight-search/{keyword}\", produces = MediaType.APPLICATION_JSON_VALUE)\n    public Map&lt;String, Object&gt; highlightSearch(@PathVariable(\"keyword\") String keyword) {\n        return heroService.hightlightSearch(keyword);\n    }\n}\n</code></pre>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#373-html","title":"3.7.3 HTML \u9875\u9762\uff1a","text":"<p>\u76f4\u63a5\u4f7f\u7528<code>v-html</code>\u6307\u4ee4\u663e\u793a\u5e26\u6709\u6837\u5f0f\u7684\u5b57\u6bb5</p> <pre><code>&lt;!doctype html&gt;\n&lt;html lang=\"en\"&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;title&gt;elasticsearch-demo&lt;/title&gt;\n    &lt;script src=\"https://cdn.jsdelivr.net/npm/vue\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://unpkg.com/axios/dist/axios.min.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n      .width-45 {\n        width: 45px;\n      }\n      .width-60 {\n        width: 60px;\n      }\n      .width-120 {\n        width: 120px;\n      }\n      .width-600 {\n        width: 600px;\n      }\n      .font-12 {\n        font-size: 12px;\n      }\n    &lt;/style&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div id=\"app\"&gt;\n      &lt;label&gt;&lt;input type=\"text\" v-model=\"input\" /&gt;&lt;/label&gt;\n      &lt;button @click=\"request\"&gt;\u641c\u7d22&lt;/button&gt;\n      &lt;table v-if=\"showList\"&gt;\n        &lt;tr v-for=\"(item, index) of list\"&gt;\n          &lt;td class=\"width-60\"&gt;&lt;img class=\"width-45\" :src=\"item.avatarSrc\" alt=\"\" /&gt;&lt;/td&gt;\n          &lt;td class=\"width-120\" v-html=\"item.name\"&gt;&lt;/td&gt;\n          &lt;td class=\"width-120\" v-html=\"item.alias\"&gt;&lt;/td&gt;\n          &lt;td class=\"width-120\" v-html=\"item.title\"&gt;&lt;/td&gt;\n          &lt;td class=\"width-600 font-12 text-indent-cn\" v-html=\"item.shortBio\"&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n      &lt;/table&gt;\n    &lt;/div&gt;\n\n    &lt;script&gt;\n      new Vue({\n        el: '#app',\n        data() {\n          return {\n            input: '',\n            showList: false,\n            list: []\n          }\n        },\n        methods: {\n          request() {\n            axios({\n              url: `/highlight-search/${this.input}`\n            }).then(response =&gt; {\n              const { total, size, list } = response.data\n              this.list = list\n              this.showList = true\n            })\n          }\n        }\n      })\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u6548\u679c\uff1a</p> <p></p>"},{"location":"backend/spring-boot/__demo__/spring-boot-elasticsearch-demo/#374-idea-thymeleaf","title":"3.7.4 IDEA Thymeleaf \u8e29\u5751\u70b9","text":"<p>SpringBoot \u8bbf\u95ee<code>/resources/static/</code>\u4e0b\u7684\u9759\u6001\u8d44\u6e90\u7684\u65b9\u5f0f\u4e3a\uff1a<code>http://127.0.0.1:8080/js/vue.min.js</code>\uff0c\u5728 thymleaf \u4e2d\u5f15\u7528\u7684\u65b9\u5f0f\u4e3a\uff1a</p> <pre><code>&lt;script th:src=\"@{/js/vue.min.js}\"&gt;&lt;/script&gt;\n</code></pre> <p>\u4f46\u5728 IDEA2020.2 \u7248\u672c\u4e2d\uff0c\u5c06\u6587\u4ef6\u590d\u5236\u8fdb<code>/resources/static/</code>\u76ee\u5f55\u540e\uff0c\u9700\u8981\u91cd\u542f IDEA \u624d\u80fd\u6b63\u5e38\u8bbf\u95ee\u5230\u3002</p>"},{"location":"backend/spring-boot/__demo__/spring-boot-webservice-demo/","title":"Spring Boot WebService","text":""},{"location":"backend/spring-cloud/","title":"Spring Cloud","text":""},{"location":"backend/spring-cloud/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/spring-cloud/#spring-cloud-eurekaclient-ip","title":"spring cloud EurekaClient \u591a\u7f51\u5361 ip \u914d\u7f6e \u548c \u6e90\u7801\u5206\u6790","text":""},{"location":"backend/spring-cloud/#spring-cloud-netflix-eureka-eureka-ip","title":"Spring Cloud Netflix Eureka: \u591a\u7f51\u5361\u73af\u5883\u4e0b Eureka \u670d\u52a1\u6ce8\u518c IP \u9009\u62e9\u95ee\u9898","text":""},{"location":"backend/spring-cloud/#springcloud-java-","title":"SpringCloud \u5fae\u670d\u52a1\u7535\u5546\u9879\u76ee-\u7535\u5546\u6846\u67b6\u642d\u5efa - \u8001\u70ae\u8bf4 Java-\u7a0b\u5e8f\u5458\u7f16\u7a0b\u8d44\u6599\u548c\u7f16\u7a0b\u7ecf\u9a8c\u5206\u4eab\u5e73\u53f0","text":""},{"location":"backend/spring-cloud/#spring-cloud-ribbon","title":"Spring Cloud Ribbon \u8d1f\u8f7d\u5747\u8861\u7b56\u7565","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/","title":"Index","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_1","title":"\u4e00\u3001\u8bf4\u660e","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_2","title":"\u7248\u672c","text":"<p>SpringBoot \u4e0e SpringCloud \u7248\u672c\u9002\u914d\u5173\u7cfb\uff1ahttps://start.spring.io/actuator/info</p>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_3","title":"\u7ec4\u4ef6","text":"\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0 netflix-eureka \u670d\u52a1\u8c03\u7528 RestTemplate\u3001spring-cloud-openfeign \u8d1f\u8f7d\u5747\u8861 netflix-ribbon \u670d\u52a1\u964d\u7ea7\u4e0e\u7194\u65ad netflix-hystrix \u7f51\u5173 netflix-zuul \u914d\u7f6e\u4e2d\u5fc3 spring-cloud-config \u6d88\u606f\u603b\u7ebf spring-cloud-bus\u3001rabbitmq"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_4","title":"\u4e8c\u3001\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#eureka","title":"\u6ce8\u518c\u4e2d\u5fc3 Eureka","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>server:\n  port: 8761\n\nspring:\n  application:\n    name: EUREKA-SERVER\n\neureka:\n  instance:\n    hostname: localhost\n  client:\n    # \u6ce8\u518c\u4e2d\u5fc3\u4e0d\u9700\u8981\u68c0\u7d22\u670d\u52a1\n    fetch-registry: false\n    # \u6ce8\u518c\u4e2d\u5fc3\u4e0d\u9700\u8981\u63d0\u4f9b\u670d\u52a1\n    register-with-eureka: false\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#eureka_1","title":"Eureka \u96c6\u7fa4\u914d\u7f6e","text":"<p>\u7531\u4e8e <code>eureka.instance.hostname</code> \u8981\u552f\u4e00\uff0c\u6240\u4ee5\u5355\u673a\u4f2a\u96c6\u7fa4\u6a21\u5f0f\u53ef\u4ee5\u5229\u7528 hosts \u89e3\u6790\u6b3a\u9a97 Eureka\u3002</p> <pre><code>127.0.0.1 eureka8761\n127.0.0.1 eureka8762\n127.0.0.1 eureka8763\n</code></pre> <p>\u8bbe\u7f6e\u7a0b\u5e8f\u53c2\u6570\u6216\u73af\u5883\u53d8\u91cf\u66f4\u6613\u4e8e\u5728\u5bb9\u5668\u4e2d\u90e8\u7f72\u3002\u7a0b\u5e8f\u53c2\u6570\u6bd4\u73af\u5883\u53d8\u91cf\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002</p> <pre><code># eureka8761\n--server.port=8761\n--eureka.instance.hostname=eureka8761\n--eureka.client.service-url.defaultZone=http://eureka8762:8762/eureka/,http://eureka8763:8763/eureka/\n\n# eureka8762\n--server.port=8762\n--eureka.instance.hostname=eureka8762\n--eureka.client.service-url.defaultZone=http://eureka8761:8761/eureka/,http://eureka8763:8763/eureka/\n\n#eureka8763\n--server.port=8763\n--eureka.instance.hostname=eureka8763\n--eureka.client.service-url.defaultZone=http://eureka8761:8761/eureka/,http://eureka8762:8762/eureka/\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_5","title":"\u5ba2\u6237\u7aef","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>@EnableDiscoveryClient\n@SpringBootApplication\npublic class WareApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(WareApplication.class, args);\n    }\n}\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_6","title":"\u4e09\u3001\u670d\u52a1\u8c03\u7528\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u964d\u7ea7\u7194\u65ad","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#resttemplate","title":"RestTemplate \u8c03\u7528","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code># =================== Ribbon ===================\nribbon.http.client.enabled=true\n# \u8bf7\u6c42\u5904\u7406\u65f6\u95f4\n# org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration.DEFAULT_READ_TIMEOUT=1000\nribbon.ReadTimeout=300\n# \u8d1f\u8f7d\u5747\u8861\u7b56\u7565\nMICROSERVICE-WARE.ribbon.NFLoadBalancerRuleClassName=com.netflix.loadbalancer.RandomRule\n\n# =================== Hystrix ===================\n# \u964d\u7ea7\u8d85\u65f6\u65f6\u95f4\n# com.netflix.hystrix.HystrixCommandProperties.default_executionTimeoutInMilliseconds=1000\nhystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=2000\n# \u65ad\u8def\u6700\u5c0f\u8bf7\u6c42\u6570\u91cf\n# com.netflix.hystrix.HystrixCommandProperties.default_circuitBreakerRequestVolumeThreshold=20\nhystrix.command.default.circuitBreaker.requestVolumeThreshold=5\n# \u65ad\u8def\u65f6\u95f4\u7a97\u53e3\n# com.netflix.hystrix.HystrixCommandProperties.default_circuitBreakerSleepWindowInMilliseconds=5000\nhystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=3000\n# \u65ad\u8def\u5931\u8d25\u7387\u9608\u503c\n# com.netflix.hystrix.HystrixCommandProperties.default_circuitBreakerErrorThresholdPercentage=50\nhystrix.command.default.circuitBreaker.errorThresholdPercentage=40\n</code></pre> <pre><code>@Configuration\npublic class BeanConfig {\n    @LoadBalanced\n    @Bean\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n}\n</code></pre> <pre><code>@EnableHystrix\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class OrderApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(OrderApplication.class, args);\n    }\n}\n</code></pre> <pre><code>@HystrixCommand(fallbackMethod = \"wareFallback\", commandProperties = {\n    @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"10\"),\n})\n@GetMapping(\"/call_ware/sleep/{milliseconds}\")\npublic R&lt;Object&gt; callWare(@PathVariable Long milliseconds) {\n    R ware = restTemplate.getForObject(\"http://MICROSERVICE-WARE/sleep/{milliseconds}\", R.class, milliseconds);\n\n    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n    map.put(\"applicationName\", applicationName);\n    map.put(\"port\", port);\n    map.put(\"ware\", ware);\n\n    return R.success(map);\n}\n</code></pre> <pre><code>private R&lt;Object&gt; wareFallback(Long milliseconds) {\n    R&lt;Object&gt; ware = R.failure(503, \"[MICROSERVICE-WARE] \u6682\u65f6\u4e0d\u53ef\u7528\");\n\n    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n    map.put(\"applicationName\", applicationName);\n    map.put(\"port\", port);\n    map.put(\"ware\", ware);\n\n    return R.success(map);\n}\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#openfeign","title":"openfeign \u8c03\u7528","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code># ribbon \u548c hystrix \u7684\u914d\u7f6e\u5bf9\u57fa\u4e8e\u5b83\u4eec\u7684 openfeign \u540c\u6837\u6709\u6548\nfeign.hystrix.enabled=true\n</code></pre> <pre><code>@Service\n@FeignClient(value = \"MICROSERVICE-PAYMENT\", fallback = PaymentFeign.Fallback.class)\npublic interface PaymentFeign {\n    @GetMapping(\"/sleep/{milliseconds}\")\n    R&lt;Object&gt; sleep(@PathVariable(\"milliseconds\") Long milliseconds);\n\n    @Service\n    class Fallback implements PaymentFeign {\n        @Override\n        public R&lt;Object&gt; sleep(Long milliseconds) {\n            return R.failure(504, \"[MICROSERVICE-PAYMENT]\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\");\n        }\n    }\n}\n</code></pre> <p>\u4f7f\u7528 openfeign \u5e76\u4e0d\u9700\u8981<code>spring-cloud-starter-netflix-hystrix</code> \u4f9d\u8d56\u548c <code>@EnableHystrix</code>\u6ce8\u89e3\u3002</p> <pre><code>@EnableFeignClients\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class OrderApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(OrderApplication.class, args);\n    }\n}\n</code></pre> <pre><code>@GetMapping(\"/call_payment/sleep/{milliseconds}\")\npublic R&lt;Object&gt; callPayment(@PathVariable Long milliseconds) {\n    R&lt;Object&gt; payment = paymentFeign.sleep(milliseconds);\n\n    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n    map.put(\"applicationName\", applicationName);\n    map.put(\"port\", port);\n    map.put(\"payment\", payment);\n\n    return R.success(map);\n}\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#hystrix","title":"hystrix \u76d1\u63a7\u7aef\u70b9","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>management.endpoints.web.exposure.include=hystrix.stream\n</code></pre> <p>\u8bbf\u95ee\uff1ahttp://localhost:9031/actuator/hystrix.stream</p>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#hystrix-dashboard","title":"hystrix-dashboard \u53ef\u89c6\u5316","text":"<p>\u5229\u7528 hystrix-dashboard \u53ef\u4ee5\u66f4\u76f4\u89c2\u7684\u770b\u51fa\u5931\u8d25\u6bd4\u7387\u3001\u65ad\u8def\u5668\u95ed\u5408\u60c5\u51b5\u7b49\u4fe1\u606f\u3002</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>hystrix:\n  dashboard:\n    proxy-stream-allow-list:\n      - localhost\n</code></pre> <pre><code>@EnableHystrixDashboard\n@SpringBootApplication\npublic class HystrixDashboardApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(HystrixDashboardApplication.class, args);\n    }\n}\n</code></pre> <p>\u8bbf\u95ee\uff1ahttp://localhost:8090/hystrix</p> <p>\u8f93\u5165\u76d1\u63a7\u7aef\u70b9\uff1ahttp://localhost:9031/actuator/hystrix.stream</p> <p></p>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_7","title":"\u56db\u3001\u7f51\u5173","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#netflix-zuul","title":"netflix-zuul","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>zuul:\n  prefix: /api\n  routes:\n    microservice-ware:\n      path: /ware/**\n      serviceId: MICROSERVICE-WARE\n    microservice-payment:\n      path: /payment/**\n      serviceId: MICROSERVICE-PAYMENT\n    microservie-order:\n      path: /order/**\n      serviceId: MICROSERVICE-ORDER\n</code></pre> <pre><code>@EnableZuulProxy\n@SpringBootApplication\npublic class ZuulApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(ZuulApplication.class, args);\n    }\n}\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_8","title":"\u4e94\u3001\u914d\u7f6e\u4e2d\u5fc3","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#spring-cloud-config","title":"spring-cloud-config \u670d\u52a1\u7aef","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u670d\u52a1\u7aef\u5730\u5740\u9ed8\u8ba4\u4e3a 8888\u3002</p> \u4ed3\u5e93\u5730\u5740 https://gitee.com/icefery/spring-cloud-demo.git Git \u5206\u652f netflix-dynamic \u914d\u7f6e\u6587\u4ef6\u76ee\u5f55 /config/ {application}-{profile} zuul-dev.yml <pre><code>server:\n  port: 8888\n\nspring:\n  application:\n    name: CONFIG-SERVER\n  cloud:\n    config:\n      # Git \u5206\u652f\n      label: netflix-dynamic\n      server:\n        git:\n          # \u4ed3\u5e93\u5730\u5740\n          uri: https://gitee.com/icefery/spring-cloud-demo\n          # \u641c\u7d22\u8def\u5f84\n          search-paths:\n            - /config/\n</code></pre> <pre><code>@EnableConfigServer\n@EnableDiscoveryClient\n@SpringBootApplication\npublic class ConfigServerApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(ConfigServerApplication.class, args);\n    }\n}\n</code></pre> <p>\u8bbf\u95ee\uff1ahttp://localhost:8888/netflix-dynamic/zuul-dev.yml</p>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#spring-cloud-config_1","title":"spring-cloud-config \u5ba2\u6237\u7aef","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-config-client&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <p><code>bootstrap.yml</code> \u4f1a\u5728 <code>application.yml</code> \u4e4b\u524d\u52a0\u8f7d\uff0c\u56e0\u6b64\u5c06\u914d\u7f6e\u4e2d\u5fc3\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\u653e\u5728<code>bootstrap.yml</code> \u4e2d\u4ee5\u63d0\u524d\u62c9\u53d6\u597d\u5fc5\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <pre><code>spring:\n  application:\n    name: ZUUL\n  cloud:\n    config:\n      # \u914d\u7f6e\u4e2d\u5fc3\u5730\u5740\n      uri:\n        - http://localhost:8888\n      # Git \u5206\u652f\n      label: netflix-dynamic\n      # {application}\n      name: zuul\n      # {profile}\n      profile: dev\n</code></pre>"},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#_9","title":"\u516d\u3001\u6d88\u606f\u603b\u7ebf","text":""},{"location":"backend/spring-cloud/__demo__/spring-cloud-demo/#spring-cloud-bus","title":"spring-cloud-bus \u5e7f\u64ad\u914d\u7f6e\u5237\u65b0","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>spring:\n  cloud:\n    bus:\n      trace:\n        enabled: true\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: guest\n    password: guest\n</code></pre> <p>\u5c06\u914d\u7f6e\u4e2d\u5fc3\u670d\u52a1\u7aef\u4e5f\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u5e76\u66b4\u9732\u5237\u65b0\u7aef\u70b9\u3002\u5f53\u62c9\u53d6\u914d\u7f6e\u540e\u4f1a\u901a\u8fc7\u6d88\u606f\u603b\u7ebf\u5e7f\u64ad\u9053\u5176\u5b83\u5ba2\u6237\u7aef\u3002</p> <pre><code>management:\n  endpoints:\n    web:\n      exposure:\n        include: bus-refresh\n</code></pre> <pre><code>@Configuration\npublic class ZuulConfig {\n    @RefreshScope\n    @ConfigurationProperties(\"zuul\")\n    public ZuulProperties zuulProperties() {\n        return new ZuulProperties();\n    }\n}\n</code></pre> <pre><code># \u62c9\u53d6\u914d\u7f6e\ncurl -X POST http://localhost:8888/actuator/bus-refresh\n</code></pre>"},{"location":"backend/spring-jdbc/","title":"Spring Data JDBC","text":""},{"location":"backend/spring-security/","title":"Spring Security","text":""},{"location":"backend/spring-security/#_1","title":"\u6536\u85cf","text":"<ul> <li> <p>https://gitee.com/blueses/spring-boot-security/tree/master</p> </li> <li> <p>Spring Security \u53c2\u8003\u624b\u518c</p> </li> <li> <p>Spring Security \u7684 AuthenticationException \u5b9e\u73b0\u603b\u7ed3</p> </li> <li> <p>Spring Cloud Gateway + Spring Oauth 2.0 \u6574\u5408\uff08\u670d\u52a1\u7aef\u4e0e\u8d44\u6e90\u7aef\u5206\u79bb\uff09</p> </li> <li> <p>Spring Cloud Oauth2 \u5b9e\u73b0\u5206\u5e03\u5f0f\u6743\u9650\u8ba4\u8bc1\uff08redis \u7248\uff09</p> </li> <li> <p># JWT\u3001JWE\u3001JWS \u3001JWK \u90fd\u662f\u4ec0\u4e48\u9b3c\uff1f\u8fd8\u50bb\u50bb\u5206\u4e0d\u6e05\uff1f</p> </li> </ul>"},{"location":"backend/spring-security/__demo__/dynamic-url-authorization/","title":"Index","text":""},{"location":"backend/spring-security/__demo__/dynamic-url-authorization/#spring-security-jwt-url","title":"Spring Security JWT \u8fdb\u884c\u52a8\u6001 URL \u6743\u9650\u9a8c\u8bc1","text":"<p>\u7528\u6237:</p> <ul> <li>\u7528\u6237<code>admin</code>\u5bc6\u7801<code>admin</code>, \u62e5\u6709\u89d2\u8272 <code>ROLE_1</code>\u3001<code>ROLE_3</code>\uff0c</li> <li>\u7528\u6237<code>user</code>\u5bc6\u7801<code>user</code></li> </ul> <p>\u89d2\u8272:</p> <ul> <li>\u89d2\u8272<code>ROLE_1</code>\u5bf9\u5e94\u6743\u9650\uff08\u8d44\u6e90\uff09<code>/hello1/**</code></li> <li>\u89d2\u8272<code>ROLE_2</code>\u5bf9\u5e94\u6743\u9650\uff08\u8d44\u6e90\uff09<code>/hello2</code></li> <li>\u89d2\u8272<code>ROLE_3</code>\u5bf9\u5e94\u6743\u9650\uff08\u8d44\u6e90\uff09<code>/hello3</code></li> </ul> <p>\u6d4b\u8bd5:</p> <ol> <li>\u533f\u540d\u6216 Token \u9519\u8bef: \u53ea\u80fd\u8bbf\u95ee <code>/hello4</code></li> <li>\u7528\u6237<code>user</code>: \u53ea\u80fd\u8bbf\u95ee <code>/hello4</code>\u3001<code>/hello3/sub</code>\u3001<code>/hello5</code></li> <li>\u7528\u6237<code>admin</code>: \u4e0d\u80fd\u8bbf\u95ee<code>/hello2</code></li> </ol>"},{"location":"backend/spring-security/__demo__/oauth-sso-demo/","title":"Index","text":"\u670d\u52a1 \u7aef\u53e3 \u4e0a\u4e0b\u6587 <code>oauth-sso-demo-auth</code> 1000 <code>/auth</code> <code>oauth-sso-demo-client1</code> 1100 <code>/client1</code> <code>oauth-sso-demo-client2</code> 1200 <code>/client2</code>"},{"location":"backend/spring-session/","title":"Spring Session","text":""},{"location":"backend/spring-session/#_1","title":"\u6536\u85cf","text":"<ul> <li>Spring Session \u6574\u5408 JWT Token</li> </ul>"},{"location":"backend/spring-webflux/","title":"Spring WebFlux","text":""},{"location":"backend/spring-webflux/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/spring-webflux/#spring-webflux_1","title":"spring webflux \u7cfb\u5217\u4e4b\u4e0a\u4f20\u5355\u6587\u4ef6\u4e0e\u591a\u6587\u4ef6\u5230\u4e03\u725b\u4e91\u7bc7","text":""},{"location":"backend/struts/","title":"Struts","text":""},{"location":"backend/struts/#_1","title":"\u6536\u85cf","text":""},{"location":"backend/struts/#struts-action","title":"Struts \u6ce8\u89e3\u7684\u5751\uff0c@Action \u6ce8\u89e3\u4e0d\u4f1a\u88ab\u6620\u5c04\uff08\u65e0\u6548\uff09","text":""},{"location":"bigdata/","title":"\u5927\u6570\u636e","text":""},{"location":"bigdata/#_2","title":"\u6536\u85cf","text":""},{"location":"bigdata/#azkabanoozie","title":"\u5927\u6570\u636e\u4efb\u52a1\u8c03\u5ea6\uff08Azkaban\uff0cOozie\uff09","text":""},{"location":"bigdata/#_3","title":"\u4e00\u6587\u4e86\u89e3\u4e91\u539f\u751f\u5927\u6570\u636e","text":""},{"location":"bigdata/#flinkspark-on-k8s","title":"\u5206\u5e03\u5f0f\u8ba1\u7b97\u5f15\u64ce Flink/Spark on k8s \u7684\u5b9e\u73b0\u5bf9\u6bd4\u4ee5\u53ca\u5b9e\u8df5","text":""},{"location":"bigdata/airflow/","title":"Airflow","text":""},{"location":"bigdata/airflow/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":""},{"location":"bigdata/airflow/#11-miniconda","title":"1.1 \u5b89\u88c5 Miniconda","text":"<p>Miniconda</p> <pre><code># \u4e0b\u8f7d sh \u811a\u672c\nwget https://repo.anaconda.com/miniconda/Miniconda3-py310_23.1.0-1-Linux-aarch64.sh\n# \u5b89\u88c5 minconda\nbash Miniconda3-py310_23.1.0-1-Linux-aarch64.sh\n# \u5237\u65b0\u73af\u5883\u53d8\u91cf\nsource ~/.bashrc\n# \u7981\u6b62\u81ea\u52a8\u6fc0\u6d3b base \u73af\u5883\nconda config --set auto_activate_base false\n</code></pre> <pre><code># \u521b\u5efa\u73af\u5883\nconda create -n &lt;NAME&gt;\n# \u67e5\u770b\u6240\u6709\u73af\u5883\nconda info --envs\n# \u5220\u9664\u73af\u5883\nconda remove -n &lt;NAME&gt; --all\n# \u6fc0\u6d3b\u73af\u5883\nconda activate &lt;NAME&gt;\n# \u9000\u51fa\u73af\u5883\nconda deactivate &lt;NAME&gt;\n</code></pre>"},{"location":"bigdata/airflow/#12-pip","title":"1.2 pip \u6362\u6e90","text":"<pre><code>mkdir -p ~/.pip\ntee ~/.pip/pip.conf &lt;&lt;- 'EOF'\n[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n[install]\ntrusted-host = https://pypi.tuna.tsinghua.edu.cn\nEOF\n</code></pre>"},{"location":"bigdata/airflow/#13-airflow","title":"1.3 \u5b89\u88c5 Airflow","text":"<pre><code>conda create --name airflow python=3.10\nconda activate airflow\n# \u5b89\u88c5 airflow\nexport AIRFLOW_HOME=/opt/env/airflow\npip install \"apache-airflow==2.4.3\"\n# \u67e5\u770b\u7248\u672c\nairflow version\n</code></pre>"},{"location":"bigdata/airflow/#14-airflow","title":"1.4 \u914d\u7f6e Airflow","text":"<ul> <li> <p>\u5b89\u88c5\u4f9d\u8d56</p> <pre><code>apt install libmysqlclient-dev -y\npip install mysqlclient\n</code></pre> </li> <li> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 <code>airflow.cfg</code></p> <pre><code>executor = LocalExecutor\nload_examples = False\nsql_alchemy_conn = mysql+mysqldb://root:root@192.192.192.6:3306/airflow\n</code></pre> </li> <li> <p>\u6570\u636e\u5e93\u521d\u59cb\u5316</p> <pre><code># \u521d\u59cb\u5316\nairflow db init\n# \u521b\u5efa\u8d26\u53f7\nairflow users create \\\n  --username admin \\\n  --password admin \\\n  --firstname admin \\\n  --lastname admin \\\n  --role Admin \\\n  --email icefery@163.com\n</code></pre> </li> </ul>"},{"location":"bigdata/airflow/#15-airflow","title":"1.5 Airflow \u542f\u505c\u811a\u672c","text":"<pre><code>case \"$1\" in\n'start')\n    conda activate airflow\n    airflow webserver -p 8080 -D\n    airflow scheduler -D\n    conda deactivate\n    ;;\n'stop')\n    ps -ef | grep -E 'airflow-webserver|airflow scheduler' | grep -v 'grep' | awk '{print $2}' | xargs kill\n    ;;\n*)\n    echo \"$0 &lt;start|stop&gt;\"\n    ;;\nesac\n</code></pre> <p>http://192.192.192.6:8080</p>"},{"location":"bigdata/airflow/#_2","title":"\u4e8c\u3001\u4efb\u52a1\u8c03\u5ea6","text":""},{"location":"bigdata/airflow/#21-bashoperator","title":"2.1 BashOperator","text":""},{"location":"bigdata/airflow/#_3","title":"\u521b\u5efa\u4efb\u52a1","text":"<ul> <li> <p>\u521b\u5efa\u9ed8\u8ba4 DAG \u76ee\u5f55</p> <pre><code>mkdir -p \"${AIRFLOW_HOME}/{dags}\"\n</code></pre> </li> <li> <p>\u65b0\u5efa\u4efb\u52a1 <code>dags/demo.py</code></p> <pre><code>from datetime import datetime, timedelta\nfrom airflow import DAG\nfrom airflow.operators.bash import BashOperator\n\ndag = DAG(\n  dag_id=\"demo\",\n  start_date=datetime(year=2023, month=3, day=1),\n  schedule=timedelta(minutes=1),\n)\nt1 = BashOperator(\n  dag=dag,\n  task_id=\"t1\",\n  bash_command=\"\"\"\n  echo 't1' &gt;&gt; ${AIRFLOW_HOME}/demo.txt\n  \"\"\",\n)\nt2 = BashOperator(\n  dag=dag,\n  task_id=\"t2\",\n  bash_command=\"\"\"\n  echo 't2' &gt;&gt; ${AIRFLOW_HOME}/demo.txt\n  \"\"\",\n)\nt3 = BashOperator(\n  dag=dag,\n  task_id=\"t3\",\n  bash_command=\"\"\"\n  echo 't3' &gt;&gt; ${AIRFLOW_HOME}/demo.txt\n  \"\"\",\n)\nt4 = BashOperator(\n  dag=dag,\n  task_id=\"t4\",\n  bash_command=\"\"\"\n  echo 't4' &gt;&gt; ${AIRFLOW_HOME}/demo.txt\n  \"\"\",\n)\n[t1, t2] &gt;&gt; t3 &gt;&gt; t4\n</code></pre> </li> </ul>"},{"location":"bigdata/cdh/","title":"CDH","text":""},{"location":"bigdata/cdh/#_1","title":"\u6536\u85cf","text":""},{"location":"bigdata/cdh/#cdh-01-centos7-cdh632","title":"\u3010CDH \u5b9e\u6218 01\u3011\u57fa\u4e8e CentOS7 \u7684 CDH6.3.2 \u5b8c\u5168\u5206\u5e03\u5f0f\u96c6\u7fa4\u642d\u5efa\u3010\u4e0a\u3011","text":""},{"location":"bigdata/cdh/#cdh-02-centos7-cdh632","title":"\u3010CDH \u5b9e\u6218 02\u3011\u57fa\u4e8e CentOS7 \u7684 CDH6.3.2 \u5b8c\u5168\u5206\u5e03\u5f0f\u96c6\u7fa4\u642d\u5efa\u3010\u4e0b\u3011","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/","title":"ClickHouse \u7b14\u8bb0","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#clickhouse_1","title":"\u4e00\u3001ClickHouse \u5165\u95e8","text":"<p>ClickHouse \u662f\u7531\u4fc4\u7f57\u65af\u7684 Yandex \u4e8e 2016 \u5e74\u5f00\u6e90\u7684\u5217\u5f0f\u6570\u636e\u5e93\uff0c\u4f7f\u7528 C++ \u8bed\u8a00\u7f16\u5199\uff0c\u4e3b\u8981\u7528\u4e8e\u5728\u7ebf\u5206\u6790\u5904\u7406\u67e5\u8be2\uff08OLAP\uff09\uff0c\u80fd\u591f\u4f7f\u7528 SQL \u67e5\u8be2\u5b9e\u65f6\u751f\u6210\u5206\u6790\u6570\u636e\u62a5\u544a\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#11-clickhouse","title":"1.1 ClickHouse \u7279\u70b9","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#111","title":"1.1.1 \u5217\u5f0f\u5b58\u50a8","text":"<p>\u5217\u5f0f\u5b58\u50a8\u7684\u597d\u5904\uff1a</p> <ul> <li>\u5bf9\u4e8e\u5217\u7684\u805a\u5408\u3001\u8ba1\u6570\u3001\u6c42\u548c\u7b49\u7edf\u8ba1\u64cd\u4f5c\u4f18\u4e8e\u884c\u5f0f\u5b58\u50a8\u3002</li> <li>\u7531\u4e8e\u67d0\u4e00\u5217\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u76f8\u540c\u7684\uff0c\u9488\u5bf9\u4e8e\u6570\u636e\u5b58\u50a8\u66f4\u5bb9\u6613\u8fdb\u884c\u6570\u636e\u538b\u7f29\uff0c\u6bcf\u4e00\u5217\u9009\u62e9\u66f4\u6709\u7684\u6570\u636e\u538b\u7f29\u7b97\u6cd5\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u6570\u636e\u7684\u538b\u7f29\u6bd4\u91cd\u3002</li> <li>\u7531\u4e8e\u6570\u636e\u538b\u7f29\u6bd4\u66f4\u597d\uff0c\u4e00\u65b9\u9762\u8282\u7701\u4e86\u78c1\u76d8\u7a7a\u95f4\uff0c\u53e6\u4e00\u65b9\u9762\u5bf9\u4e8e cache \u4e5f\u6709\u4e86\u66f4\u5927\u7684\u53d1\u6325\u7a7a\u95f4\u3002</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#112-dbms","title":"1.1.2 DBMS \u7684\u529f\u80fd","text":"<p>\u51e0\u4e4e\u8986\u76d6\u4e86\u6807\u51c6 SQL \u7684\u5927\u90e8\u5206\u8bed\u6cd5\uff0c\u5305\u62ec DDL \u548c DML\uff0c\u4ee5\u53ca\u914d\u5957\u7684\u5404\u79cd\u51fd\u6570\uff0c\u7528\u6237\u7ba1\u7406\u53ca\u6743\u9650\u7ba1\u7406\uff0c\u6570\u636e\u7684\u5907\u4efd\u4e0e\u6062\u590d\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#113","title":"1.1.3 \u591a\u6837\u5316\u5f15\u64ce","text":"<p>ClickHouse \u548c MySQL \u7c7b\u4f3c\uff0c\u628a\u8868\u7ea7\u522b\u7684\u5b58\u50a8\u5f15\u64ce\u63d2\u4ef6\u5316\uff0c\u6839\u636e\u8868\u7684\u4e0d\u540c\u9700\u6c42\u53ef\u4ee5\u8bbe\u5b9a\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u3002\u76ee\u524d\u5305\u62ec\u5408\u5e76\u6811\u3001\u65e5\u5fd7\u3001\u63a5\u53e3\u548c\u5176\u4ed6\u56db\u5927\u7c7b 20 \u591a\u79cd\u5f15\u64ce\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#114","title":"1.1.4 \u9ad8\u541e\u5410\u5199\u5165\u80fd\u529b","text":"<p>ClickHouse \u91c7\u7528\u7c7b LSM Tree \u7684\u7ed3\u6784\uff0c\u6570\u636e\u5199\u5165\u540e\u5b9a\u671f\u5728\u540e\u53f0 compaction\u3002\u901a\u8fc7\u7c7b LSM Tree \u7684\u7ed3\u6784\uff0cClickHouse \u5728\u6570\u636e\u5bfc\u5165\u65f6\u5168\u90e8\u662f\u987a\u5e8f append \u5199\uff0c\u5199\u5165\u540e\u6570\u636e\u6bb5\u4e0d\u53ef\u66f4\u6539\uff0c\u5728\u540e\u53f0 compaction \u65f6\u4e5f\u662f\u591a\u4e2a\u6bb5 merge sort \u540e\u987a\u5e8f\u5199\u56de\u78c1\u76d8\u3002\u987a\u5e8f\u5199\u7684\u7279\u6027\uff0c\u5145\u5206\u5229\u7528\u4e86\u78c1\u76d8\u7684\u541e\u5410\u80fd\u529b\uff0c\u5373\u4fbf\u5728 HDD \u4e0a\u4e5f\u6709\u7740\u4f18\u5f02\u7684\u5199\u5165\u6027\u80fd\u3002</p> <p>\u5b98\u65b9\u516c\u5f00 benchmark \u6d4b\u8bd5\u663e\u793a\u80fd\u591f\u8fbe\u5230 50MB-200MB/s \u7684\u5199\u5165\u541e\u5410\u80fd\u529b\uff0c\u6309\u7167\u6bcf\u884c 100Byte \u4f30\u7b97\uff0c\u5927\u7ea6\u76f8\u5f53\u4e8e 50W-200W \u6761/s \u7684\u5199\u5165\u901f\u5ea6\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#115","title":"1.1.5 \u6570\u636e\u5206\u533a\u4e0e\u7ebf\u7a0b\u7ea7\u5e76\u884c","text":"<p>ClickHouse \u5c06\u6570\u636e\u5212\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2a partition \u518d\u8fdb\u4e00\u6b65\u5212\u5206\u4e3a\u591a\u4e2a index granularity\uff08\u7d22\u5f15\u7c92\u5ea6\uff09\uff0c\u7136\u540e\u901a\u8fc7\u591a\u4e2a CPU \u6838\u5fc3\u5206\u522b\u5904\u7406\u5176\u4e2d\u7684\u4e00\u90e8\u5206\u6765\u5b9e\u73b0\u5e76\u884c\u6570\u636e\u5904\u7406\u3002\u5728\u8fd9\u79cd\u8bbe\u8ba1\u4e0b\uff0c\u5355\u6761 Query \u5c31\u80fd\u5229\u7528\u6574\u673a\u6240\u6709 CPU\u3002\u6781\u81f4\u7684\u5e76\u884c\u5904\u7406\u80fd\u529b\uff0c\u6781\u5927\u7684\u964d\u4f4e\u4e86\u67e5\u8be2\u5ef6\u65f6\u3002</p> <p>\u6240\u4ee5\uff0cClickHouse \u5373\u65f6\u5bf9\u4e8e\u5927\u91cf\u6570\u636e\u7684\u67e5\u8be2\u4e5f\u80fd\u591f\u5316\u6574\u4e3a\u96f6\u5e73\u884c\u5904\u7406\u3002\u4f46\u662f\u6709\u4e00\u4e2a\u5f0a\u7aef\u5c31\u662f\u5bf9\u4e8e\u5355\u6761\u67e5\u8be2\u4f7f\u7528\u591a CPU\uff0c\u5c31\u4e0d\u5229\u7528\u540c\u65f6\u5e76\u53d1\u591a\u6761\u67e5\u8be2\u3002\u6240\u4ee5\u5bf9\u4e8e\u9ad8 QPS \u7684\u67e5\u8be2\u4e1a\u52a1\uff0cClickHouse \u5e76\u4e0d\u662f\u5f3a\u9879\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#clickhouse_2","title":"\u4e8c\u3001ClickHouse \u7684\u5b89\u88c5","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#21","title":"2.1 \u5355\u673a\u5b89\u88c5","text":"<p>https://github.com/ClickHouse/ClickHouse/releases/tag/v23.3.3.52-lts</p> <ol> <li> <p>\u4e0b\u8f7d</p> <pre><code>VERSION=23.3.3.52\nARCH=arm64\nPACKAGES=(\n    clickhouse-common-static\n    clickhouse-common-static-dbg\n    clickhouse-server\n    clickhouse-client\n)\nfor package in \"${PACKAGES[@]}\"; do\n    wget \"https://github.com/ClickHouse/ClickHouse/releases/download/v${VERSION}-lts/${package}_${VERSION}_${ARCH}.deb\"\ndone\n</code></pre> </li> <li> <p>\u5b89\u88c5</p> <pre><code>apt install ./clickhouse-*.deb\n\nsystemctl status clickhouse-server\n</code></pre> </li> <li> <p>\u8fde\u63a5</p> <pre><code>clickhouse-client -m\n</code></pre> <pre><code>select version();\n\nshow databases;\n\nshow tables;\n</code></pre> </li> </ol> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_1","title":"\u4e09\u3001\u6570\u636e\u7c7b\u578b","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#31","title":"3.1 \u6574\u578b","text":"<ul> <li><code>Int8</code></li> <li><code>Int16</code></li> <li><code>Int32</code></li> <li><code>Int64</code></li> <li><code>UInt8</code></li> <li><code>UInt16</code></li> <li><code>UInt32</code></li> <li><code>UInt64</code></li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#32","title":"3.2 \u6d6e\u70b9\u578b","text":"<ul> <li><code>Float32</code></li> <li><code>Float54</code></li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#33-decimal","title":"3.3 Decimal","text":"<p>\u6709\u7b26\u53f7\u7684\u6d6e\u70b9\u6570\uff0c\u53ef\u5728\u52a0\u3001\u51cf\u548c\u4e58\u6cd5\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u4fdd\u6301\u7cbe\u5ea6\u3002\u5bf9\u4e8e\u9664\u6cd5\uff0c\u6700\u4f4e\u6709\u6548\u6570\u5b57\u4f1a\u88ab\u4e22\u5f03\u3002</p> <ul> <li><code>Decimal32(s)</code>\uff0c\u76f8\u5f53\u4e8e <code>Decimal(9-s,s)</code>\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1-9\u3002</li> <li><code>Decimal64(s)</code>\uff0c\u76f8\u5f53\u4e8e <code>Decimal(18-s,s)</code>\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1-18\u3002</li> <li><code>Decimal128(s)</code>\uff0c\u76f8\u5f53\u4e8e <code>Decimal(38-s,s)</code>\uff0c\u6709\u6548\u4f4d\u6570\u4e3a 1-38\u3002</li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#34","title":"3.4 \u5b57\u7b26\u4e32","text":"<ul> <li><code>String</code></li> <li><code>FixedString(N)</code></li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#35","title":"3.5 \u679a\u4e3e\u7c7b\u578b","text":"<ul> <li><code>Enum8</code></li> <li><code>Enum16</code></li> </ul> <p>Enum \u4fdd\u5b58 <code>string=&gt;integer</code>\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <ol> <li> <p>\u521b\u5efa\u4e00\u4e2a\u5e26\u6709\u679a\u4e3e <code>Enum8('hello'=1, 'word'=2)</code>\u7c7b\u578b\u5217\u7684\u8868\u3002</p> <pre><code>create table t_enum (\n    x Enum8('hello'=1, 'world'=2)\n)\nengine = TinyLog;\n</code></pre> </li> <li> <p>\u8fd9\u4e2a <code>x</code> \u5217\u53ea\u80fd\u5b58\u50a8\u7c7b\u578b\u5b9a\u4e49\u4e2d\u7684\u503c <code>hello</code> \u6216\u8005<code>world</code>\u3002</p> <pre><code>insert into t_enum values ('hello'), ('world'), ('hello');\n</code></pre> </li> <li> <p>\u5982\u679c\u5c1d\u8bd5\u4fdd\u5b58\u4efb\u4f55\u5176\u4ed6\u503c\uff0cClickHouse \u4f1a\u629b\u51fa\u5f02\u5e38\u3002</p> <pre><code>insert into t_enum values ('a');\n</code></pre> <pre><code> Exception on client:\n Code: 691. DB::Exception: Unknown element 'a' for enum: while executing 'FUNCTION if(isNull(_dummy_0) : 3, defaultValueOfTypeName('Enum8(\\'hello\\' = 1, \\'world\\' = 2)') :: 2, _CAST(_dummy_0, 'Enum8(\\'hello\\' = 1, \\'world\\' = 2)') :: 4) -&gt; if(isNull(_dummy_0), defaultValueOfTypeName('Enum8(\\'hello\\' = 1, \\'world\\' = 2)'), _CAST(_dummy_0, 'Enum8(\\'hello\\' = 1, \\'world\\' = 2)')) Enum8('hello' = 1, 'world' = 2) : 1': While executing ValuesBlockInputFormat: data for INSERT was parsed from query. (UNKNOWN_ELEMENT_OF_ENUM)\n</code></pre> </li> <li> <p>\u5982\u679c\u9700\u8981\u770b\u5230\u5bf9\u5e94\u884c\u7684\u6570\u503c\uff0c\u5219\u5fc5\u987b\u5c06 Enum \u503c\u8f6c\u6362\u4e3a\u6574\u6570\u7c7b\u578b\u3002</p> <pre><code>select cast(x, 'Int8') from t_enum;\n</code></pre> <p>\u5bf9\u4e00\u4e9b\u72b6\u6001\u3001\u7c7b\u578b\u7684\u5b57\u6bb5\u7b97\u662f\u4e00\u79cd\u7a7a\u95f4\u4f18\u5316\uff0c\u4e5f\u7b97\u662f\u4e00\u79cd\u6570\u636e\u7ea6\u675f\u3002\u4f46\u662f\u5b9e\u9645\u4f7f\u7528\u4e2d\u5f80\u5f80\u56e0\u4e3a\u4e00\u4e9b\u6570\u636e\u5185\u5bb9\u7684\u53d8\u5316\u589e\u52a0\u4e00\u5b9a\u7684\u7ef4\u62a4\u6210\u672c\uff0c\u751a\u81f3\u662f\u6570\u636e\u4e22\u5931\u95ee\u9898\u3002\u6240\u4ee5\u8c28\u614e\u4f7f\u7528\u3002</p> </li> </ol> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#36","title":"3.6 \u65f6\u95f4\u7c7b\u578b","text":"<p>\u76ee\u524d ClickHouse \u6709\u4e09\u79cd\u65f6\u95f4\u7c7b\u578b\uff1a</p> <ul> <li><code>Date</code> \u5982 <code>2019-12-16</code></li> <li><code>DateTime</code> \u5982 <code>2019-12-16 20:50:10</code></li> <li><code>DateTime64</code> \u5982 <code>2019-12-16 20:50:10.66</code></li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#37","title":"3.7 \u6570\u7ec4","text":"<p><code>Array(T)</code> \u7531 <code>T</code> \u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4\u3002<code>T</code> \u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u5305\u542b\u6570\u7ec4\u7c7b\u578b\u3002\u4f46\u4e0d\u63a8\u8350\u4f7f\u7528\u591a\u7ef4\u6570\u7ec4\uff0cClickHouse \u5bf9\u591a\u7ef4\u6570\u7ec4\u7684\u652f\u6301\u6709\u9650\u3002\u4f8b\u5982\uff0c\u4e0d\u80fd\u5728 MergeTree \u8868\u4e2d\u5b58\u50a8\u591a\u7ef4\u6570\u7ec4\u3002</p> <pre><code>select array(1, 2) as x, toTypeName(x);\n\nselect [1, 2] as x, toTypeName(x);\n</code></pre> <p></p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_2","title":"\u56db\u3001\u8868\u5f15\u64ce","text":"<p>\u8868\u5f15\u64ce\u662f ClickHouse \u7684\u4e00\u5927\u7279\u8272\u3002\u53ef\u4ee5\u8bf4\uff0c\u8868\u5f15\u64ce\u51b3\u5b9a\u4e86\u5982\u4f55\u5b58\u50a8\u8868\u7684\u6570\u636e\u3002\u5305\u62ec\uff1a</p> <ul> <li>\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u548c\u4f4d\u7f6e\uff0c\u5199\u5230\u54ea\u91cc\u4ee5\u53ca\u4ece\u54ea\u91cc\u8bfb\u53d6\u6570\u636e\u3002</li> <li>\u652f\u6301\u54ea\u4e9b\u67e5\u8be2\u4ee5\u53ca\u5982\u4f55\u652f\u6301\u3002</li> <li>\u5e76\u53d1\u6570\u636e\u8bbf\u95ee\u3002</li> <li>\u7d22\u5f15\u7684\u8bbf\u95ee\uff08\u5982\u4f55\u5b58\u5728\uff09\u3002</li> <li>\u662f\u5426\u53ef\u4ee5\u6267\u884c\u591a\u7ebf\u7a0b\u8bf7\u6c42\u3002</li> <li>\u6570\u636e\u590d\u5236\u53c2\u6570\u3002</li> </ul> <p>\u8868\u5f15\u64ce\u7684\u4f7f\u7528\u65b9\u5f0f\u5c31\u662f\u5fc5\u987b\u663e\u5f0f\u5728\u521b\u5efa\u8868\u65f6\u5b9a\u4e49\u8be5\u8868\u4f7f\u7528\u7684\u5f15\u64ce\uff0c\u4ee5\u53ca\u5f15\u64ce\u4f7f\u7528\u7684\u76f8\u5173\u53c2\u6570\u3002 </p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#41-tinylog","title":"4.1 TinyLog","text":"<p>\u4ee5\u5217\u6587\u4ef6\u7684\u5f62\u5f0f\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\uff0c\u4e0d\u652f\u6301\u7d22\u5f15\uff0c\u6ca1\u6709\u5e76\u53d1\u63a7\u5236\u3002\u4e00\u822c\u4fdd\u5b58\u5c11\u91cf\u6570\u636e\u7684\u5c0f\u8868\uff0c\u751f\u4ea7\u73af\u5883\u4e0a\u4f5c\u7528\u6709\u9650\u3002\u53ef\u4ee5\u7528\u4e8e\u5e73\u65f6\u7ec3\u4e60\u6d4b\u8bd5\u7528\u3002</p> <pre><code>create table t_tinylog (id String, name String) engine = TinyLog;\n</code></pre> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#42-memory","title":"4.2 Memory","text":"<p>\u5185\u5b58\u5f15\u64ce\uff0c\u6570\u636e\u4ee5\u672a\u538b\u7f29\u7684\u539f\u59cb\u5f62\u5f0f\u76f4\u63a5\u4fdd\u5b58\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u670d\u52a1\u5668\u91cd\u542f\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u8bfb\u5199\u64cd\u4f5c\u4e0d\u4f1a\u76f8\u4e92\u963b\u585e\uff0c\u4e0d\u652f\u6301\u7d22\u5f15\u3002\u7b80\u5355\u67e5\u8be2\u4e0b\u6709\u975e\u5e38\u975e\u5e38\u9ad8\u7684\u6027\u80fd\u8868\u73b0\uff08\u8d85\u8fc7 10G/s\uff09\u3002</p> <p>\u4e00\u822c\u7528\u5230\u5b83\u7684\u5730\u65b9\u4e0d\u591a\uff0c\u9664\u4e86\u7528\u6765\u6d4b\u8bd5\uff0c\u5c31\u662f\u5728\u9700\u8981\u975e\u5e38\u9ad8\u7684\u6027\u80fd\uff0c\u540c\u65f6\u6570\u636e\u91cf\u53c8\u4e0d\u592a\u5927\uff08\u4e0a\u9650\u5927\u641e 1 \u4ebf\u884c\uff09\u7684\u573a\u666f\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#43-mergetree","title":"4.3 MergeTree","text":"<p>ClickHouse \u4e2d\u6700\u5f3a\u5927\u7684\u8868\u5f15\u64ce\u5f53\u5c5e MergeTree\uff08\u5408\u5e76\u6811\uff09\u5f15\u64ce\u4ee5\u53ca\u8be5\u7cfb\u5217\uff08*MergeTree\uff09\u4e2d\u7684\u5176\u4ed6\u5f15\u64ce\uff0c\u652f\u6301\u7d22\u5f15\u548c\u5206\u533a\uff0c\u5730\u4f4d\u76f8\u5f53\u4e8e InnoDB \u4e4b\u4e8e MySQL\u3002\u800c\u4e14\u57fa\u4e8e MergeTree\uff0c\u8fd8\u884d\u751f\u51fa\u4e86\u5f88\u591a\u5c0f\u5f1f\uff0c\u4e5f\u662f\u975e\u5e38\u6709\u7279\u8272\u7684\u5f15\u64ce\u3002</p> <pre><code>create table t_order_mt (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  DateTime\n)\nengine = MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> <pre><code>insert into t_order_mt values\n(101, 'sku_001', 1000.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 11:00:00'),\n(102, 'sku_004', 2500.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 13:00:00'),\n(102, 'sku_002', 12000.00, '2020-06-01 13:00:00'),\n(102, 'sku_002', 600.00,   '2020-06-02 12:00:00');\n</code></pre> <p></p> <p>MergeTree \u5176\u5b9e\u8fd8\u6709\u5f88\u591a\u53c2\u6570\uff08\u7edd\u5927\u591a\u6570\u53c2\u6570\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\uff09\uff0c\u4f46\u662f\u6709\u4e09\u4e2a\u53c2\u6570\u662f\u66f4\u52a0\u91cd\u8981\u7684\uff0c\u4e5f\u6d89\u53ca\u4e86\u5173\u4e8e MergeTree \u7684\u5f88\u591a\u6982\u5ff5\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#431-partition-by","title":"4.3.1 <code>partition by</code> \u5206\u533a\uff08\u53ef\u9009\uff09","text":"<p>\u5b66\u8fc7 Hive \u7684\u90fd\u4e0d\u964c\u751f\uff0c\u5206\u533a\u7684\u76ee\u7684\u4e3b\u8981\u8fd8\u662f\u964d\u4f4e\u626b\u63cf\u7684\u8303\u56f4\uff0c\u4f18\u5316\u67e5\u8be2\u901f\u5ea6\u3002\u5982\u679c\u4e0d\u586b\uff0c\u53ea\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5206\u533a\u3002MergeTree \u662f\u4ee5\u5217\u6587\u4ef6 + \u7d22\u5f15\u6587\u4ef6 + \u8868\u5b9a\u4e49\u6587\u4ef6\u7ec4\u6210\u7684\uff0c\u4f46\u662f\u5982\u4f55\u8bbe\u5b9a\u4e86\u5206\u533a\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6587\u4ef6\u5c31\u4f1a\u4fdd\u5b58\u5230\u4e0d\u540c\u7684\u5206\u533a\u76ee\u5f55\u4e2d\u3002\u5206\u533a\u540e\uff0c\u9762\u5bf9\u6d89\u53ca\u8de8\u5206\u533a\u7684\u67e5\u8be2\u7edf\u8ba1\uff0cClickHouse \u4f1a\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u5e76\u884c\u5904\u7406\u3002</p> <p>\u4efb\u4f55\u4e00\u4e2a\u6279\u6b21\u7684\u6570\u636e\u5199\u5165\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e34\u65f6\u5206\u533a\uff0c\u4e0d\u4f1a\u7eb3\u5165\u4efb\u4f55\u4e00\u4e2a\u5df2\u6709\u7684\u5206\u533a\u3002\u5199\u5165\u540e\u7684\u67d0\u4e2a\u65f6\u523b\uff08\u5927\u6982 10-15 \u5206\u949f\u540e\uff09\uff0cClickHouse \u4f1a\u81ea\u52a8\u6267\u884c\u5408\u5e76\u64cd\u4f5c\uff08\u7b49\u4e0d\u53ca\u4e5f\u53ef\u4ee5\u624b\u52a8\u901a\u8fc7 <code>optimize</code> \u6267\u884c\uff09\uff0c\u628a\u4e34\u65f6\u5206\u533a\u7684\u6570\u636e\uff0c\u5408\u5e76\u5230\u5df2\u6709\u5206\u533a\u4e2d\u3002</p> <pre><code>optimize table t_order_mt final;\n</code></pre> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#432-primary-key","title":"4.3.2 <code>primary key</code>\u4e3b\u952e\uff08\u53ef\u9009\uff09","text":"<p>ClickHouse \u4e2d\u7684\u4e3b\u952e\uff0c\u548c\u5176\u4ed6\u6570\u636e\u5e93\u4e0d\u592a\u4e00\u6837\uff0c\u5b83\u53ea\u63d0\u4f9b\u4e86\u6570\u636e\u7684\u4e00\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u5374\u4e0d\u662f\u552f\u4e00\u7ea6\u675f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u662f\u53ef\u4ee5\u5b58\u5728\u76f8\u540c <code>primary key</code>\u7684\u6570\u636e\u7684\u3002</p> <p>\u4e3b\u952e\u7684\u8bbe\u5b9a\u4e3b\u8981\u4f9d\u636e\u662f\u67e5\u8be2\u8bed\u53e5\u4e2d\u7684 <code>where</code> \u6761\u4ef6\u3002\u6839\u636e\u6761\u4ef6\u901a\u8fc7\u5bf9\u4e3b\u952e\u8fdb\u884c\u67d0\u79cd\u5f62\u5f0f\u7684\u4e8c\u5206\u67e5\u627e\uff0c\u80fd\u591f\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684 <code>index_granularity</code>\uff0c\u907f\u514d\u4e86\u5168\u8868\u626b\u63cf\u3002</p> <p><code>index_granularity</code> \u76f4\u63a5\u7ffb\u8bd1\u7684\u8bdd\u5c31\u662f\u7d22\u5f15\u7c92\u5ea6\uff0c\u6307\u5728\u7a00\u758f\u7d22\u5f15\u4e2d\u4e24\u4e2a\u76f8\u90bb\u7d22\u5f15\u5bf9\u5e94\u6570\u636e\u7684\u95f4\u9694\u3002ClickHouse \u4e2d\u7684 MergeTree \u9ed8\u8ba4\u662f 8192\u3002\u5b98\u65b9\u4e0d\u5efa\u8bae\u4fee\u6539\u8fd9\u4e2a\u503c\uff0c\u9664\u975e\u8be5\u5217\u5b58\u5728\u5927\u91cf\u91cd\u590d\u503c\uff0c\u6bd4\u5982\u5728\u4e00\u4e2a\u5206\u533a\u4e2d\u51e0\u4e07\u884c\u624d\u6709\u4e00\u4e2a\u4e0d\u540c\u6570\u636e\u3002</p> <p></p> <p>\u7a00\u758f\u7d22\u5f15\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u7528\u5f88\u5c11\u7684\u7d22\u5f15\u6570\u636e\uff0c\u5b9a\u4f4d\u66f4\u591a\u7684\u6570\u636e\uff0c\u4ee3\u4ef7\u5c31\u662f\u53ea\u80fd\u5b9a\u4f4d\u5230\u7d22\u5f15\u7c92\u5ea6\u7684\u7b2c\u4e00\u884c\uff0c\u7136\u540e\u518d\u8fdb\u884c\u626b\u63cf\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#433-order-by","title":"4.3.3 <code>order by</code>\uff08\u5fc5\u9009\uff09","text":"<p><code>order by</code>\u8bbe\u5b9a\u4e86\u5206\u533a\u5185\u7684\u6570\u636e\u6309\u7167\u54ea\u4e9b\u5b57\u6bb5\u987a\u5e8f\u8fdb\u884c\u6709\u5e8f\u4fdd\u5b58\u3002<code>order by</code>\u662f MergeTree \u4e2d\u552f\u4e00\u4e00\u4e2a\u5fc5\u586b\u9879\uff0c\u751a\u81f3\u6bd4 <code>primary key</code>\u8fd8\u91cd\u8981\uff0c\u56e0\u4e3a\u5f53\u7528\u6237\u4e0d\u8bbe\u7f6e\u4e3b\u952e\u7684\u60c5\u51b5\uff0c\u5f88\u591a\u5904\u7406\u4f9d\u7167 <code>order by</code> \u7684\u5b57\u6bb5\u8fdb\u884c\u5904\u7406\uff08\u6bd4\u5982\u540e\u9762\u4f1a\u8bb2\u7684\u53bb\u91cd\u548c\u6c47\u603b\uff09\u3002</p> <p>\u8981\u6c42\u4e3b\u952e\u5fc5\u987b\u662f <code>order by</code>\u5b57\u6bb5\u7684\u524d\u7f00\u5b57\u6bb5\u3002\u6bd4\u5982 <code>order by</code>\u7684\u5b57\u6bb5\u662f<code>(id, sku_id)</code>\u90a3\u4e48\u4e3b\u952e\u5fc5\u987b\u662f <code>(id)</code>\u6216\u8005 <code>(id, sku_id)</code>\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#434","title":"4.3.4 \u4e8c\u7ea7\u7d22\u5f15","text":"<p>\u76ee\u524d\u5728 ClickHouse \u7684\u5b98\u7f51\u4e0a\u4e8c\u7ea7\u7d22\u5f15\u7684\u529f\u80fd\u5728 <code>v20.1.2.4</code> \u4e4b\u524d\u662f\u88ab\u6807\u6ce8\u4e3a\u5b9e\u9a8c\u6027\u7684\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\u3002</p> <ol> <li> <p>\u521b\u5efa\u6d4b\u8bd5\u8868</p> <pre><code>create table t_order_mt2 (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  DateTime,\n    index a total_amount type minmax granularity 5\n)\nengine = MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> <p>\u5176\u4e2d <code>granularity N</code> \u662f\u8bbe\u5b9a\u4e8c\u7ea7\u7d22\u5f15\u5bf9\u4e00\u7ea7\u7d22\u5f15\u7684\u7c92\u5ea6\u3002</p> </li> <li> <p>\u63d2\u5165\u6570\u636e</p> <pre><code>insert into t_order_mt2 values\n(101, 'sku_001', 1000.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 11:00:00'),\n(102, 'sku_004', 2500.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 13:00:00'),\n(102, 'sku_002', 12000.00, '2020-06-01 13:00:00'),\n(102, 'sku_002', 600.00,   '2020-06-02 12:00:00');\n</code></pre> </li> <li> <p>\u5bf9\u6bd4\u6548\u679c</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u8bed\u53e5\u8fdb\u884c\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u770b\u51fa\u4e8c\u7ea7\u7d22\u5f15\u80fd\u591f\u4e3a\u975e\u4e3b\u952e\u5b57\u6bb5\u7684\u67e5\u8be2\u53d1\u6325\u4f5c\u7528\u3002</p> <pre><code>clickhouse-client --send_logs_level=trace &lt;&lt;&lt; 'select * from t_order_mt2  where total_amount &gt; toDecimal32(900, 2)';\n</code></pre> <p></p> </li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#435-ttl","title":"4.3.5 \u6570\u636e TTL","text":"<p>TTL \u5373 Time To Live\uff0cMergeTree \u63d0\u4f9b\u4e86\u53ef\u4ee5\u7ba1\u7406\u6570\u636e\u8868\u6216\u8005\u5217\u7684\u751f\u547d\u5468\u671f\u7684\u529f\u80fd\u3002</p> <ul> <li> <p>\u5217\u7ea7\u522b TTL</p> <ol> <li> <p>\u521b\u5efa\u6d4b\u8bd5\u8868</p> <pre><code>create table t_order_mt3 (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2) ttl create_time + interval 10 second,\n    create_time  DateTime\n)\nengine = MergeTree\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> </li> <li> <p>\u63d2\u5165\u6570\u636e</p> <pre><code>insert into t_order_mt3 values\n(106, 'sku_001', 1000.00, '&lt;\u5f53\u524d\u65f6\u95f4&gt;'),\n(107, 'sku_002', 2000.00, '&lt;\u5f53\u524d\u65f6\u95f4&gt;'),\n(110, 'sku_003', 600.00,  '&lt;\u5f53\u524d\u65f6\u95f4&gt;');\n</code></pre> </li> <li> <p>\u624b\u52a8\u5408\u5e76</p> <p>\u67e5\u770b\u6548\u679c\uff0c\u5230\u671f\u540e\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u6570\u636e\u5f52 0\u3002</p> <pre><code>optimize table t_order_mt3 final;\n\nselect * from t_order_mt3;\n</code></pre> </li> </ol> </li> <li> <p>\u8868\u7ea7\u522b TTL</p> <p>\u4e0b\u9762\u7684\u8fd9\u6761\u8bed\u53e5\u662f\u6570\u636e\u4f1a\u5728 <code>create_time</code> \u4e4b\u540e 10 \u79d2\u4e22\u5931\u3002</p> <pre><code>alter table t_order_mt3 modify ttl create_time + interval 10 second;\n</code></pre> <p>\u6d89\u53ca\u5224\u65ad\u7684\u5b57\u6bb5\u5fc5\u987b\u662f <code>Date</code> \u6216\u8005 <code>DateTime</code> \u7c7b\u578b\uff0c\u63a8\u8350\u4f7f\u7528\u5206\u533a\u7684\u65e5\u671f\u5b57\u6bb5\u3002\u80fd\u591f\u4f7f\u7528\u7684\u65f6\u95f4\u5468\u671f\uff1a</p> <ul> <li><code>SECOND</code></li> <li><code>MINUTE</code></li> <li><code>HOUR</code></li> <li><code>DAY</code></li> <li><code>WEEK</code></li> <li><code>MONTH</code></li> <li><code>QUARTER</code></li> <li><code>YEAR</code></li> </ul> </li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#44-replacingmergetree","title":"4.4 ReplacingMergeTree","text":"<p>ReplacingMergeTree \u662f MergeTree \u7684\u4e00\u4e2a\u53d8\u79cd\uff0c\u5b83\u5b58\u50a8\u7279\u6027\u5b8c\u5168\u7ee7\u627f MergeTree\uff0c\u53ea\u662f\u591a\u4e86\u4e00\u4e2a\u53bb\u91cd\u7684\u529f\u80fd\u3002\u5c3d\u7ba1 MergeTree \u53ef\u4ee5\u8bbe\u7f6e\u4e3b\u952e\uff0c\u4f46\u662f <code>primary key</code> \u5176\u5b9e\u6ca1\u6709\u552f\u4e00\u7ea6\u675f\u7684\u529f\u80fd\u3002\u5982\u4f55\u4f60\u60f3\u5904\u7406\u6389\u91cd\u590d\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u501f\u52a9\u8fd9\u4e2a ReplacingMergeTree\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#441","title":"4.4.1 \u53bb\u91cd\u65f6\u673a","text":"<p>\u6570\u636e\u7684\u53bb\u91cd\u53ea\u4f1a\u5728\u5408\u5e76\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u3002\u5408\u5e76\u4f1a\u5728\u672a\u77e5\u7684\u65f6\u95f4\u5728\u540e\u53f0\u8fdb\u884c\uff0c\u6240\u4ee5\u4f60\u65e0\u6cd5\u9884\u5148\u4f5c\u51fa\u8ba1\u5212\u3002\u6709\u4e00\u4e9b\u6570\u636e\u53ef\u80fd\u4ecd\u672a\u88ab\u5904\u7406\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#442","title":"4.4.2 \u53bb\u91cd\u8303\u56f4","text":"<p>\u5982\u4f55\u8868\u7ecf\u8fc7\u4e86\u5206\u533a\uff0c\u53bb\u91cd\u53ea\u4f1a\u5728\u5206\u533a\u5185\u90e8\u8fdb\u884c\u53bb\u91cd\uff0c\u4e0d\u80fd\u6267\u884c\u8de8\u5206\u533a\u7684\u53bb\u91cd\u3002\u6240\u4ee5 ReplacingMergeTree \u80fd\u529b\u6709\u9650\uff0c\u9002\u7528\u4e8e\u5728\u540e\u53f0\u6e05\u9664\u91cd\u590d\u7684\u6570\u636e\u4ee5\u8282\u7701\u7a7a\u95f4\uff0c\u4f46\u662f\u5b83\u4e0d\u4fdd\u8bc1\u6ca1\u6709\u91cd\u590d\u7684\u6570\u636e\u51fa\u73b0\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#443","title":"4.4.3 \u6848\u4f8b\u6f14\u793a","text":"<ol> <li> <p>\u521b\u5efa\u8868</p> <pre><code>create table t_order_rmt (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  DateTime\n)\nengine = ReplacingMergeTree(create_time)\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> <p><code>ReplacingMergeTree()</code>\u586b\u5165\u7684\u53c2\u6570\u4e3a\u7248\u672c\u5b57\u6bb5\uff0c\u91cd\u590d\u6570\u636e\u4fdd\u7559\u7248\u672c\u5b57\u6bb5\u503c\u6700\u5927\u7684\u3002\u5982\u679c\u4e0d\u586b\u7248\u672c\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u6309\u7167\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u6700\u540e\u4e00\u6761\u3002</p> </li> <li> <p>\u63d2\u5165\u6570\u636e</p> <pre><code>insert into t_order_rmt values\n(101, 'sku_001', 1000.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 11:00:00'),\n(102, 'sku_004', 2500.00,  '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00,  '2020-06-01 13:00:00'),\n(102, 'sku_002', 12000.00, '2020-06-01 13:00:00'),\n(102, 'sku_002', 600.00,   '2020-06-02 12:00:00');\n</code></pre> </li> <li> <p>\u67e5\u8be2</p> <pre><code>optimize table t_order_rmt final;\n\nselect * from t_order_rmt;\n</code></pre> </li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#444","title":"4.4.4 \u7ed3\u8bba","text":"<ul> <li>\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528 <code>order by</code> \u5b57\u6bb5\u4f5c\u4e3a\u552f\u4e00\u952e\u3002</li> <li>\u53bb\u91cd\u4e0d\u80fd\u8de8\u5206\u533a\u3002</li> <li>\u53ea\u6709\u540c\u4e00\u6279\u63d2\u5165\uff08\u65b0\u7248\u672c\uff09\u6216\u5408\u5e76\u5206\u533a\u65f6\u624d\u4f1a\u8fdb\u884c\u53bb\u91cd\u3002</li> <li>\u8ba4\u5b9a\u91cd\u590d\u7684\u6570\u636e\u4fdd\u7559\u7248\u672c\u5b57\u6bb5\u6700\u5927\u7684\u3002</li> <li>\u5982\u679c\u7248\u672c\u5b57\u6bb5\u76f8\u540c\u5219\u6309\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u6700\u540e\u4e00\u7b14\u3002</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#45-summingmergetree","title":"4.5 SummingMergeTree","text":"<p>\u5bf9\u4e8e\u4e0d\u67e5\u8be2\u660e\u7ec6\uff0c\u53ea\u5173\u5fc3\u4ee5\u7ef4\u5ea6\u8fdb\u884c\u6c47\u603b\u805a\u5408\u7ed3\u679c\u7684\u573a\u666f\u3002\u5982\u679c\u53ea\u4f7f\u7528\u666e\u901a\u7684 MergeTree \u7684\u8bdd\uff0c\u65e0\u8bba\u662f\u5b58\u50a8\u7a7a\u95f4\u7684\u5f00\u9500\uff0c\u8fd8\u662f\u67e5\u8be2\u65f6\u4e34\u65f6\u805a\u5408\u7684\u5f00\u9500\u90fd\u6bd4\u8f83\u5927\u3002</p> <p>ClickHouse \u4e3a\u4e86\u8fd9\u79cd\u573a\u666f\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u201c\u9884\u805a\u5408\u201d\u7684\u5f15\u64ce SummingMergeTree\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#451","title":"4.5.1 \u7ed3\u8bba","text":"<ul> <li>\u4ee5 <code>SummingMergeTree()</code>\u4e2d\u6307\u5b9a\u7684\u5217\u4f5c\u4e3a\u6c47\u603b\u6570\u636e\u5217\u3002</li> <li>\u53ef\u4ee5\u586b\u5199\u591a\u5217\u5fc5\u987b\u6570\u5b57\u5217\uff0c\u5982\u679c\u4e0d\u586b\uff0c\u4ee5\u6240\u6709\u975e\u7ef4\u5ea6\u5217\u5207\u4f4d\u6570\u5b57\u5217\u7684\u5b57\u6bb5\u4e3a\u6c47\u603b\u6570\u636e\u5217\u3002</li> <li>\u4ee5 <code>order by</code>\u7684\u5217\u4e3a\u51c6\u4f5c\u4e3a\u7ef4\u5ea6\u5217\u3002</li> <li>\u5176\u4ed6\u7684\u5217\u6309\u63d2\u5165\u987a\u5e8f\u4fdd\u7559\u7b2c\u4e00\u884c\u3002</li> <li>\u4e0d\u5728\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u805a\u5408\u3002</li> <li>\u53ea\u6709\u5728\u540c\u4e00\u6279\u63d2\u5165\uff08\u65b0\u7248\u672c\uff09\u6216\u5408\u5e76\u5206\u533a\u65f6\u624d\u4f1a\u8fdb\u884c\u805a\u5408\u3002</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#452","title":"4.5.2 \u5f00\u53d1\u5efa\u8bae","text":"<p>\u6d89\u53ca\u805a\u5408\u8868\u7684\u8bdd\uff0c\u552f\u4e00\u952e\u503c\u3001\u6d41\u6c34\u53f7\u53ef\u4ee5\u53bb\u6389\uff0c\u6240\u6709\u5b57\u6bb5\u5168\u90e8\u662f\u7ef4\u5ea6\u3001\u5ea6\u91cf\u6216\u8005\u65f6\u95f4\u6233\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#453","title":"4.5.3 \u95ee\u9898","text":"<p>\u80fd\u4e0d\u80fd\u76f4\u63a5\u6267\u884c\u4ee5\u4e0b SQL \u5f97\u5230\u6c47\u603b\u503c\u5462\uff1f</p> <pre><code>select total_amount from t_order_smt;\n</code></pre> <p>\u4e0d\u884c\uff0c\u53ef\u80fd\u4f1a\u5305\u542b\u4e00\u4e9b\u8fd8\u6ca1\u6765\u5f97\u53ca\u805a\u5408\u7684\u4e34\u65f6\u660e\u7ec6\u3002\u5982\u679c\u662f\u8981\u83b7\u53d6\u6c47\u603b\u503c\uff0c\u8fd8\u662f\u9700\u8981\u4f7f\u7528 <code>sum</code> \u8fdb\u884c\u805a\u5408\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u6709\u4e00\u5b9a\u7684\u63d0\u9ad8\uff0c\u4f46\u672c\u8eab ClickHouse \u662f\u5217\u5f0f\u5b58\u50a8\u7684\uff0c\u6548\u7387\u63d0\u5347\u6709\u9650\uff0c\u4e0d\u4f1a\u7279\u522b\u660e\u663e\u3002</p> <pre><code>select sum(total_amount) from t_order_smt;\n</code></pre> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#sql","title":"\u4e94\u3001SQL \u64cd\u4f5c","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#51-update-delete","title":"5.1 Update \u548c Delete","text":"<p>ClickHouse \u63d0\u4f9b\u4e86 Update \u548c Delete \u7684\u80fd\u529b\uff0c\u8fd9\u7c7b\u64cd\u4f5c\u88ab\u79f0\u4e3a Mutation \u67e5\u8be2\uff0c\u5b83\u53ef\u4ee5\u770b\u4f5c Alter \u7684\u4e00\u79cd\u3002\u867d\u7136\u53ef\u4ee5\u5b9e\u73b0\u4fee\u6539\u548c\u5220\u9664\uff0c\u4f46\u662f\u548c\u4e00\u822c\u7684 OLTP \u6570\u636e\u5e93\u4e0d\u4e00\u6837\uff0cMutation \u8bed\u53e5\u662f\u4e00\u79cd\u5f88\u201c\u91cd\u201d\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u4e0d\u652f\u6301\u4e8b\u52a1\u3002\u201c\u91cd\u201d\u7684\u539f\u56e0\u4e3b\u8981\u662f\u6bcf\u6b21\u4fee\u6539\u6216\u8005\u5220\u9664\u90fd\u4f1a\u5bfc\u81f4\u653e\u5f03\u76ee\u6807\u6570\u636e\u7684\u539f\u6709\u5206\u533a\uff0c\u91cd\u5efa\u65b0\u5206\u533a\u3002\u6240\u4ee5\u5c3d\u91cf\u505a\u6279\u91cf\u7684\u53d8\u66f4\uff0c\u4e0d\u8981\u8fdb\u884c\u9891\u7e41\u5c0f\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <ul> <li> <p>\u5220\u9664\u64cd\u4f5c</p> <pre><code>alter table t_order_smt delete where sku_id = 'sku_001';\n</code></pre> </li> <li> <p>\u4fee\u6539\u64cd\u4f5c</p> <pre><code>alter table t_order_smt update total_amount = toDecimal32(200.00, 2) where id = 102;\n</code></pre> </li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#52-alter","title":"5.2 Alter \u64cd\u4f5c","text":"<ul> <li> <p>\u65b0\u589e\u5b57\u6bb5</p> <pre><code>alter table t1 add column col_2 String after col_1;\n</code></pre> </li> <li> <p>\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b</p> <pre><code>alter table t1 modify column col_2 col_2 String;\n</code></pre> </li> <li> <p>\u5220\u9664\u5b57\u6bb5</p> <pre><code>alter table t1 drop column col_2;\n</code></pre> </li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#53","title":"5.3 \u5bfc\u51fa\u6570\u636e","text":"<pre><code>clickhouse-client --query \"select * from t_order_mt where create_time = '2020-06-01 12:00:00'\" --format CSVWithNames &gt; t_order_mt.csv\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_3","title":"\u516d\u3001\u526f\u672c","text":"<p>\u526f\u672c\u7684\u76ee\u7684\u4e3b\u8981\u662f\u4fdd\u969c\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u5373\u65f6\u4e00\u53f0 ClickHouse \u8282\u70b9\u5b95\u673a\uff0c\u90a3\u4e48\u4e5f\u53ef\u4ee5\u4ece\u5176\u4ed6\u670d\u52a1\u5668\u83b7\u5f97\u76f8\u540c\u7684\u6570\u636e\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#61","title":"6.1 \u526f\u672c\u5199\u5165\u6d41\u7a0b","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#62","title":"6.2 \u914d\u7f6e\u6b65\u9aa4","text":"<ol> <li> <p>\u542f\u52a8 ZooKeeper \u96c6\u7fa4\u3002</p> </li> <li> <p>\u5728 <code>/etc/clickhouse-server/config.d</code> \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>metrika.xml</code> \u7684\u914d\u7f6e\u6587\u4ef6\u3002\u914d\u7f6e\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;yandex&gt;\n    &lt;zookeeper-servers&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-101&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-102&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node &gt;\n            &lt;host&gt;clickhouse-103&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n    &lt;/zookeeper-servers&gt;\n&lt;/yandex&gt;\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>/etc/clickhouse-server/config.xml</code> \u914d\u7f6e\u6587\u4ef6\u3002\u589e\u52a0\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;yandex&gt;\n     &lt;!--  --&gt;\n     &lt;zookeeper incl=\"zookeeper-servers\" optional=\"true\" /&gt;\n     &lt;include_from&gt;/etc/clickhouse-server/config.d/metrika.xml&lt;/include_from&gt;\n&lt;/yandex&gt;\n</code></pre> </li> <li> <p>\u540c\u6b65\u914d\u7f6e\u3002</p> <pre><code>scp -r /etc/clickhouse-server clickhouse-102:/etc\nscp -r /etc/clickhouse-server clickhouse-103:/etc\n</code></pre> </li> <li> <p>\u5728\u5404\u4e2a\u8282\u70b9\u4e0a\u5206\u522b\u5efa\u8868\uff1a</p> <p>\u526f\u672c\u53ea\u80fd\u540c\u6b65\u6570\u636e\uff0c\u4e0d\u80fd\u540c\u6b65\u8868\u7ed3\u6784\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u624b\u52a8\u5efa\u8868\u3002</p> <ul> <li> <p><code>clickhouse-101</code>\u8282\u70b9</p> <pre><code>create table t_order_rep (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  Datetime\n)\nengine = ReplicatedMergeTree('/clickhouse/tables/shard-01/t_order_rep','replica-01')\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id,sku_id);\n</code></pre> </li> <li> <p><code>clickhouse-102</code>\u8282\u70b9</p> <pre><code>create table t_order_rep (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  Datetime\n)\nengine = ReplicatedMergeTree('/clickhouse/tables/shard-01/t_order_rep','replica-02')\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre> </li> </ul> <p>\u53c2\u6570\u89e3\u91ca\uff1a<code>ReplicatedMergeTree()</code>\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5206\u7247\u7684 ZooKeeper \u8def\u5f84\uff0c\u4e00\u822c\u6309\u7167 <code>/clickhouse/tables/{shard}/{table_name}</code>\u7684\u683c\u5f0f\u5199\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5206\u7247\u5c31\u5199 <code>01</code> \u5373\u53ef\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u526f\u672c\u540d\u79f0\uff0c\u76f8\u540c\u7684\u5206\u7247\u4e2d\u526f\u672c\u540d\u79f0\u4e0d\u80fd\u76f8\u540c\u3002</p> </li> <li> <p>\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\u6267\u884c\u63d2\u5165\u8bed\u53e5\u3002</p> <pre><code>insert into t_order_rep values\n(101, 'sku_001', 1000.00, '2020-06-01 12:00:00'),\n(102, 'sku_002', 2000.00, '2020-06-01 12:00:00'),\n(103, 'sku_004', 2500.00, '2020-06-01 12:00:00'),\n(104, 'sku_002', 2000.00, '2020-06-01 12:00:00'),\n(105, 'sku_003', 600.00,  '2020-06-02 12:00:00');\n</code></pre> </li> <li> <p>\u5728\u53e6\u4e00\u4e2a\u8282\u70b9\u4e0a\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff0c\u53ef\u4ee5\u67e5\u8be2\u51fa\u7ed3\u679c\uff0c\u8bf4\u660e\u526f\u672c\u914d\u7f6e\u6b63\u786e\u3002</p> </li> </ol> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_4","title":"\u4e03\u3001\u5206\u7247\u96c6\u7fa4","text":"<p>\u526f\u672c\u867d\u7136\u80fd\u591f\u63d0\u9ad8\u6570\u636e\u7684\u53ef\u7528\u6027\uff0c\u964d\u4f4e\u4e22\u5931\u98ce\u9669\uff0c\u4f46\u662f\u6bcf\u53f0\u670d\u52a1\u5668\u5b9e\u9645\u4e0a\u5fc5\u987b\u5bb9\u7eb3\u5168\u91cf\u6570\u636e\uff0c\u5bf9\u6570\u636e\u7684\u6a2a\u5411\u6269\u5bb9\u6ca1\u6709\u89e3\u51b3\u3002</p> <p>\u8981\u89e3\u51b3\u6570\u636e\u6c34\u5e73\u5207\u5206\u7684\u95ee\u9898\uff0c\u9700\u8981\u5f15\u5165\u5206\u7247\u7684\u6982\u5ff5\u3002\u901a\u8fc7\u5206\u7247\u628a\u4e00\u4efd\u5b8c\u6574\u7684\u6570\u636e\u8fdb\u884c\u5207\u5206\uff0c\u4e0d\u540c\u7684\u5206\u7247\u5206\u5e03\u5230\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u518d\u901a\u8fc7 Distributed \u8868\u5f15\u64ce\u628a\u6570\u636e\u62fc\u63a5\u8d77\u6765\u4e00\u540c\u4f7f\u7528\u3002</p> <p>Distributed \u8868\u5f15\u64ce\u672c\u8eab\u4e0d\u5b58\u50a8\u6570\u636e\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8e MyCat \u4e4b\u4e8e MySQL\uff0c\u6210\u4e3a\u4e00\u79cd\u4e2d\u95f4\u4ef6\uff0c\u901a\u8fc7\u5206\u5e03\u5f0f\u903b\u8f91\u8868\u6765\u5199\u5165\u3001\u5206\u53d1\u3001\u8def\u7531\u6765\u64cd\u4f5c\u591a\u53f0\u8282\u70b9\u4e0d\u540c\u5206\u7247\u7684\u5206\u5e03\u5f0f\u6570\u636e\u3002</p> <p>ClickHouse \u7684\u96c6\u7fa4\u662f\u8868\u7ea7\u522b\u7684\uff0c\u5b9e\u9645\u4f01\u4e1a\u4e2d\uff0c\u5927\u90e8\u5206\u505a\u4e86\u9ad8\u53ef\u7528\uff0c\u4f46\u662f\u6ca1\u6709\u7528\u5206\u7247\uff0c\u907f\u514d\u964d\u4f4e\u67e5\u8be2\u6027\u80fd\u4ee5\u53ca\u64cd\u4f5c\u96c6\u7fa4\u7684\u590d\u6742\u6027\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#71-3-2-6","title":"7.1 \u96c6\u7fa4\u5199\u5165\u6d41\u7a0b\uff083 \u5206\u7247 2 \u526f\u672c\u5171 6 \u4e2a\u8282\u70b9\uff09","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#72-3-2-6","title":"7.2 \u96c6\u7fa4\u8bfb\u53d6\u6d41\u7a0b\uff083 \u5206\u7247 2 \u526f\u672c\u5171 6 \u4e2a\u8282\u70b9\uff09","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#72-3-2-6_1","title":"7.2 \u96c6\u7fa4\u914d\u7f6e\uff083 \u5206\u7247 2 \u526f\u672c\u5171 6 \u4e2a\u8282\u70b9\uff09","text":"<ul> <li> <p><code>/etc/clickhouse-server/config.d/metrika.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;yandex&gt;\n    &lt;clickhouse_remote_servers&gt;\n        &lt;default_cluster&gt;\n            &lt;!-- \u5206\u7247\u4e00 --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;!-- \u5206\u7247\u4e00\u526f\u672c\u4e00 --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-101&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n                &lt;!-- \u5206\u7247\u4e00\u526f\u672c\u4e8c --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-102&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;!-- \u5206\u7247\u4e8c --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;!-- \u5206\u7247\u4e8c\u526f\u672c\u4e00 --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-103&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n                &lt;!-- \u5206\u7247\u4e8c\u526f\u672c\u4e8c --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-104&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;!-- \u5206\u7247\u4e09 --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;!-- \u5206\u7247\u4e09\u526f\u672c\u4e00 --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-105&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n                &lt;!-- \u5206\u7247\u4e09\u526f\u672c\u4e8c --&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-106&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n        &lt;/default_cluster&gt;\n    &lt;/clickhouse_remote_servers&gt;\n\n    &lt;zookeeper-servers&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-101&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-102&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-103&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n    &lt;/zookeeper-servers&gt;\n&lt;/yandex&gt;\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#73-3-1-3","title":"7.3 \u96c6\u7fa4\u914d\u7f6e\uff083 \u5206\u7247 1 \u526f\u672c\u5171 3 \u4e2a\u8282\u70b9\uff09","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#731","title":"7.3.1 \u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>/etc/clickhouse-server/config.d/metrika.xml</code>\uff08<code>clickhouse-101</code>\uff09</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;yandex&gt;\n    &lt;remote_servers&gt;\n        &lt;default_cluster&gt;\n            &lt;!-- \u5206\u7247\u4e00\u526f\u672c\u4e00 --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-101&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;!-- \u5206\u7247\u4e8c\u526f\u672c\u4e00 --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-102&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;!-- \u5206\u7247\u4e09\u526f\u672c\u4e00 --&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;clickhouse-103&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n        &lt;/default_cluster&gt;\n    &lt;/remote_servers&gt;\n\n    &lt;!-- \u8282\u70b9\u4e00\u5b58\u653e\u5206\u7247\u4e00\u526f\u672c\u4e00 --&gt;\n    &lt;macros&gt;\n        &lt;shard&gt;shard-01&lt;/shard&gt;\n        &lt;replica&gt;replica-01&lt;/replica&gt;\n    &lt;/macros&gt;\n\n    &lt;!-- \u8282\u70b9\u4e8c\u5b58\u653e\u5206\u7247\u4e8c\u526f\u672c\u4e00 --&gt;\n    &lt;!--\n        &lt;macros&gt;\n            &lt;shard&gt;02&lt;/shard&gt;\n            &lt;replica&gt;replica-01&lt;/replica&gt;\n        &lt;/macros&gt;\n    --&gt;\n\n    &lt;!-- \u8282\u70b9\u4e09\u5b58\u653e\u5206\u7247\u4e09\u526f\u672c\u4e00 --&gt;\n    &lt;!--\n        &lt;macros&gt;\n            &lt;shard&gt;03&lt;/shard&gt;\n            &lt;replica&gt;replica-01&lt;/replica&gt;\n        &lt;/macros&gt;\n    --&gt;\n\n    &lt;zookeeper-servers&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-101&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-102&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node&gt;\n            &lt;host&gt;clickhouse-103&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n    &lt;/zookeeper-servers&gt;\n&lt;/yandex&gt;\n</code></pre> </li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#732","title":"7.3.2 \u521b\u5efa\u672c\u5730\u8868","text":"<p>\u5206\u7247\u548c\u526f\u672c\u540d\u79f0\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5b8f\u5b9a\u4e49\u4e2d\u83b7\u53d6\u3002</p> <pre><code>create table st_order_mt on cluster default_cluster (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  Datetime\n)\nengine = ReplicatedMergeTree('/clickhouse/tables/{shard}/st_order_mt','{replica}')\npartition by toYYYYMMDD(create_time)\nprimary key (id)\norder by (id, sku_id);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#743","title":"7.4.3 \u521b\u5efa\u5206\u5e03\u5f0f\u8868","text":"<pre><code>create table st_order_mt_all on cluster default_cluster (\n    id           UInt32,\n    sku_id       String,\n    total_amount Decimal(16,2),\n    create_time  Datetime\n)\nengine = Distributed(default_cluster, default, st_order_mt, hiveHash(sku_id));\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\uff1a<code>Distributed(&lt;\u96c6\u7fa4\u540d\u79f0&gt;, &lt;\u5e93\u540d&gt;, &lt;\u672c\u5730\u8868\u540d&gt;, &lt;\u5206\u7247\u952e&gt;)</code>\u3002\u5176\u4e2d\u5206\u7247\u952e\u5fc5\u987b\u662f\u6574\u578b\u6570\u5b57\uff0c\u6240\u4ee5\u7528 <code>hiveHash()</code>\u51fd\u6570\u8f6c\u6362\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>rand()</code>\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#734","title":"7.3.4 \u63d2\u5165\u6d4b\u8bd5\u6570\u636e","text":"<pre><code>insert into st_order_mt_all values\n(201, 'sku_001', 1000.00, '2020-06-01 12:00:00'),\n(202, 'sku_002', 2000.00, '2020-06-01 12:00:00'),\n(203, 'sku_004', 2500.00, '2020-06-01 12:00:00'),\n(204, 'sku_002', 2000.00, '2020-06-01 12:00:00'),\n(205, 'sku_003', 600.00,  '2020-06-02 12:00:00');\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#735","title":"7.3.5 \u901a\u8fc7\u67e5\u8be2\u5206\u5e03\u5f0f\u8868\u548c\u672c\u5730\u8868\u89c2\u5bdf\u8f93\u51fa\u7ed3\u679c","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_5","title":"\u516b\u3001\u67e5\u770b\u6267\u884c\u8ba1\u5212","text":"<p>\u5728 ClickHouse 20.6 \u7248\u672c\u4e4b\u524d\u8981\u67e5\u770b SQL \u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u9700\u8981\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u4e3a trace \u624d\u53ef\u4ee5\u770b\u5230\uff0c\u5e76\u4e14\u771f\u6b63\u6267\u884c SQL\uff0c\u5728\u6267\u884c\u65e5\u5fd7\u91cc\u9762\u67e5\u770b\u3002\u5728 20.6 \u7248\u672c\u5f15\u5165\u4e86\u539f\u751f\u7684\u6267\u884c\u8ba1\u5212\u7684\u8bed\u6cd5\u3002\u5728 20.6.3 \u7248\u672c\u6210\u4e3a\u6b63\u5f0f\u7248\u672c\u7684\u529f\u80fd\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#81","title":"8.1 \u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#811-plan","title":"8.1.1 \u67e5\u770b <code>PLAN</code>\uff08\u9ed8\u8ba4\uff09","text":"<pre><code>-- \u7b80\u5355\u67e5\u8be2\nexplain plan select arrayJoin([1,2,3,null,null]);\n\n-- \u590d\u6742 SQL\nexplain\nselect database, table, count(1) as cnt\nfrom system.parts\nwhere database in ('datasets','system')\ngroup by database, table\norder by database, cnt desc\nlimit 2 by database;\n\n-- \u6253\u5f00\u5168\u90e8\u53c2\u6570\u7684\u6267\u884c\u8ba1\u5212\nexplain header=1, actions=1, description=1 select number from system.numbers limit 10;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#812-ast","title":"8.1.2 \u67e5\u770b <code>AST</code> \u8bed\u6cd5\u6811","text":"<pre><code>explain ast select number from system.numbers limit 10;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#813-syntax","title":"8.1.3 \u67e5\u770b <code>SYNTAX</code> \u8bed\u6cd5\u4f18\u5316","text":"<pre><code>-- \u7b80\u5355\u67e5\u8be2\nselect number = 1 ? 'hello' : (number = 2 ? 'world' : 'clickhouse') from numbers(10);\n\n-- \u67e5\u770b\u8bed\u6cd5\u4f18\u5316\nexplain syntax select number = 1 ? 'hello' : (number = 2 ? 'world' : 'clickhouse') from numbers(10);\n\n-- \u5f00\u542f\u4e09\u5143\u8fd0\u7b97\u7b26\u4f18\u5316\nset optimize_if_chain_to_multiif = 1;\n\n-- \u518d\u6b21\u67e5\u770b\u8bed\u6cd5\u4f18\u5316\nexplain syntax select number = 1 ? 'hello' : (number = 2 ? 'world' : 'clickhouse') from numbers(10);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#814-pipeline","title":"8.1.4 \u67e5\u770b <code>PIPELINE</code>","text":"<pre><code>explain pipeline select sum(number) from numbers_mt(100000) group by number % 20;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_6","title":"\u4e5d\u3001\u5efa\u8868\u4f18\u5316","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#91","title":"9.1 \u6570\u636e\u7c7b\u578b","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#911","title":"9.1.1 \u65f6\u95f4\u5b57\u6bb5\u7684\u7c7b\u578b","text":"<p>\u5efa\u8868\u65f6\u80fd\u7528\u6570\u503c\u578b\u6216\u65e5\u671f\u7c7b\u578b\u8868\u793a\u7684\u5b57\u6bb5\u5c31\u4e0d\u8981\u7528\u5b57\u7b26\u4e32\uff0c\u5168 <code>String</code> \u7c7b\u578b\u5728 Hive \u4e3a\u4e2d\u5fc3\u7684\u6570\u4ed3\u5efa\u8bbe\u4e2d\u5e38\u89c1\uff0c\u4f46 ClickHouse \u73af\u5883\u4e0d\u5e94\u53d7\u6b64\u5f71\u54cd\u3002</p> <p>\u867d\u7136 ClickHouse \u5e95\u5c42\u5c06 <code>DateTime</code> \u5b58\u50a8\u4e3a\u65f6\u95f4\u6233 <code>Long</code> \u7c7b\u578b\uff0c\u4f46\u4e0d\u5efa\u8bae\u5b58\u50a8 <code>Long</code> \u7c7b\u578b\uff0c\u56e0\u4e3a <code>DateTime</code> \u4e0d\u9700\u8981\u7ecf\u8fc7\u51fd\u6570\u8f6c\u6362\u5904\u7406\uff0c\u6267\u884c\u6548\u7387\u9ad8\uff0c\u53ef\u8bfb\u6027\u597d\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#912","title":"9.1.2 \u7a7a\u503c\u5b58\u50a8\u7c7b\u578b","text":"<p>\u5b98\u65b9\u5df2\u7ecf\u6307\u51fa <code>Nullable</code> \u7c7b\u578b\u51e0\u4e4e\u603b\u662f\u4f1a\u62d6\u7d2f\u6027\u80fd\uff0c\u56e0\u4e3a\u5b58\u50a8 <code>Nullable</code> \u5217\u65f6\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u989d\u5916\u7684\u6587\u4ef6\u6765\u5b58\u50a8 NULL \u7684\u6807\u5fd7\uff0c\u5e76\u4e14 <code>Nullable</code> \u5217\u65e0\u6cd5\u88ab\u7d22\u5f15\u3002\u56e0\u6b64\u9664\u975e\u6781\u7279\u6b8a\u60c5\u51b5\uff0c\u5e94\u76f4\u63a5\u4f7f\u7528\u5b57\u6bb5\u9ed8\u8ba4\u503c\u8868\u793a\u7a7a\uff0c\u6216\u8005\u81ea\u884c\u6307\u5b9a\u4e00\u4e2a\u5728\u4e1a\u52a1\u4e2d\u65e0\u610f\u4e49\u7684\u503c\uff08\u4f8b\u5982\u7528 -1 \u8868\u793a\u6ca1\u6709\u5546\u54c1 ID\uff09\u3002</p> <pre><code>create table t_null (x Int8, y Nullable(Int8)) engine = TinyLog;\n\ninsert into t_null values (1, null), (2, 3);\n\nselect x + y from t_null;\n</code></pre> <p>\u67e5\u770b\u5b58\u50a8\u7684\u6587\u4ef6\uff1a</p> <p></p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#92","title":"9.2 \u5206\u533a\u548c\u7d22\u5f15","text":"<p>\u5206\u533a\u7c92\u5ea6\u6839\u636e\u4e1a\u52a1\u7279\u5b9a\u51b3\u5b9a\uff0c\u4e0d\u5b9c\u8fc7\u7c97\u6216\u8fc7\u7ec6\u3002\u4e00\u822c\u9009\u62e9\u6309\u5929\u5206\u533a\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e3a <code>Tuple()</code>\uff0c\u4ee5\u5355\u8868\u4e00\u4ebf\u6570\u636e\u4e3a\u4f8b\uff0c\u5206\u533a\u5927\u5c0f\u63a7\u5236\u5728 10-30 \u4e2a\u4f4d\u6700\u4f73\u3002</p> <p>\u5fc5\u987b\u6307\u5b9a\u7d22\u5f15\u5217\uff0cClickHouse \u4e2d\u7684\u7d22\u5f15\u5373\u6392\u5e8f\u5217\uff0c\u901a\u8fc7 <code>order by</code>\u6307\u5b9a\u3002\u4e00\u822c\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u7ecf\u5e38\u88ab\u7528\u6765\u5145\u5f53\u7b5b\u9009\u6761\u4ef6\u7684\u5c5e\u6027\u53ef\u4ee5\u88ab\u7eb3\u5165\u8fdb\u6765\uff1b\u53ef\u4ee5\u662f\u5355\u4e00\u7ef4\u5ea6\uff0c\u4e5f\u53ef\u4ee5\u662f\u7ec4\u5408\u7ef4\u5ea6\u7684\u7d22\u5f15\uff1b\u901a\u5e38\u9700\u8981\u6ee1\u8db3\u9ad8\u7ea7\u5217\u5728\u524d\u3001\u67e5\u8be2\u9891\u7387\u5927\u5728\u524d\u7684\u539f\u5219\uff1b\u8fd8\u6709\u57fa\u6570\u7279\u522b\u5927\u7684\u4e0d\u9002\u5408\u505a\u7d22\u5217\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#93","title":"9.3 \u8868\u53c2\u6570","text":"<p><code>index_granularity</code>\u662f\u7528\u6765\u63a7\u5236\u7d22\u5f15\u7c92\u5ea6\u7684\uff0c\u9ed8\u8ba4\u662f 8192\uff0c\u5982\u975e\u5fc5\u987b\u4e0d\u5efa\u8bae\u8c03\u6574\u3002</p> <p>\u5982\u679c\u8868\u4e2d\u4e0d\u662f\u5fc5\u987b\u4fdd\u7559\u5168\u91cf\u5386\u53f2\u6570\u636e\uff0c\u5efa\u8bae\u6307\u5b9a TTL\uff0c\u53ef\u4ee5\u514d\u53bb\u624b\u52a8\u5904\u7406\u8fc7\u671f\u5386\u53f2\u6570\u636e\u7684\u9ebb\u70e6\uff0cTTL \u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>alter table</code> \u8bed\u53e5\u968f\u65f6\u4fee\u6539\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#94","title":"9.4 \u5199\u5165\u548c\u5220\u9664\u4f18\u5316","text":"<ul> <li>\u8fdb\u6765\u4e0d\u8981\u6267\u884c\u5355\u6761\u6216\u5c0f\u6279\u91cf\u5220\u9664\u548c\u63d2\u5165\u64cd\u4f5c\uff0c\u8fd9\u6837\u4f1a\u4ea7\u751f\u5c0f\u5206\u533a\u6587\u4ef6\uff0c\u7ed9\u540e\u53f0 Merge \u4efb\u52a1\u5e26\u6765\u5de8\u5927\u538b\u529b\u3002</li> <li>\u4e0d\u8981\u4e00\u6b21\u5199\u5165\u592a\u591a\u5206\u533a\u6216\u6570\u636e\u5199\u5165\u592a\u5feb\uff0c\u6570\u636e\u5199\u5165\u592a\u5feb\u4f1a\u5bfc\u81f4 merge \u901f\u5ea6\u8ddf\u4e0d\u4e0a\u800c\u62a5\u9519\uff0c\u4e00\u822c\u5efa\u8bae\u6bcf\u79d2\u949f\u53d1\u8d77 2-3 \u6b21\u5199\u5165\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u5199\u5165 2W-3W \u6761\u6570\u636e\uff08\u4f9d\u670d\u52a1\u5668\u6027\u80fd\u800c\u5b9a\uff09\u3002<ul> <li>\u5728\u670d\u52a1\u5668\u5185\u5b58\u5145\u88d5\u7684\u60c5\u51b5\u4e0b\u589e\u52a0\u5185\u5b58\u914d\u989d\uff0c\u4e00\u822c\u901a\u8fc7 <code>max_memory_usage</code> \u6765\u5b9e\u73b0\uff1b</li> <li>\u5728\u670d\u52a1\u5668\u5185\u5b58\u4e0d\u5145\u88d5\u7684\u60c5\u51b5\u4e0b\uff0c\u5efa\u8bae\u5c06\u8d85\u51fa\u90e8\u5206\u7684\u5185\u5b58\u5206\u914d\u5230\u7cfb\u7edf\u786c\u76d8\u4e0a\uff0c\u4f46\u4f1a\u964d\u4f4e\u6267\u884c\u901f\u5ea6\uff0c\u4e00\u822c\u901a\u8fc7 <code>max_bytes_before_external_group_by</code>\u3001<code>max_bytes_before_external_sort</code>\u53c2\u6570\u6765\u5b9e\u73b0\u3002</li> </ul> </li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#95","title":"9.5 \u5e38\u89c1\u914d\u7f6e","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#951-cpu","title":"9.5.1 CPU \u8d44\u6e90","text":"\u53c2\u6570 \u63cf\u8ff0 <code>background_pool_size</code> \u540e\u53f0\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f\u3001merge \u7ebf\u7a0b\u5c31\u662f\u5728\u8be5\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\uff0c\u8be5\u7ebf\u7a0b\u6c60\u4e0d\u4ec5\u4ec5\u662f\u7ed9 merge \u7ebf\u7a0b\u7528\u7684\u3002\u9ed8\u8ba4\u503c 16\uff0c\u5141\u8bb8\u7684\u524d\u63d0\u4e0b\u5efa\u8bae\u6539\u6210 CPU \u4e2a\u6570\u7684 2 \u500d\uff08\u7ebf\u7a0b\u6570\uff09\u3002 <code>background_schedule_pool_size</code> \u6267\u884c\u540e\u53f0\u4efb\u52a1\uff08\u590d\u5236\u8868\u3001Kafka \u6d41\u3001DNS \u7f13\u5b58\u66f4\u65b0\uff09\u7684\u7ebf\u7a0b\u6570\u3002\u9ed8\u8ba4\u503c 128\uff0c\u5efa\u8bae\u6539\u6210 CPU \u4e2a\u6570\u7684 2 \u500d\uff08\u7ebf\u7a0b\u6570\uff09\u3002 <code>background_distributed_schedule_pool_size</code> \u8bbe\u7f6e\u4e3a\u5206\u5e03\u5f0f\u53d1\u9001\u6267\u884c\u540e\u53f0\u4efb\u52a1\u7684\u7ebf\u7a0b\u6570\u3002\u9ed8\u8ba4\u503c 16\uff0c\u5efa\u8bae\u6539\u6210 CPU \u4e2a\u6570\u7684 2 \u500d\uff08\u7ebf\u7a0b\u6570\uff09\u3002 <code>max_concurrent_queries</code> \u6700\u5927\u5e76\u53d1\u5904\u7406\u7684\u8bf7\u6c42\u6570\uff08\u5305\u542b <code>select</code>\u3001<code>insert</code> \u7b49\uff09\u3002\u9ed8\u8ba4\u503c 100\uff0c\u63a8\u8350 150-300\u3002 <code>max_threads</code> \u8bbe\u7f6e\u5355\u4e2a\u67e5\u8be2\u6240\u80fd\u4f7f\u7528\u7684\u6700\u5927 CPU \u4e2a\u6570\u3002\u9ed8\u8ba4\u503c\u662f CPU \u6838\u6570\u3002"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#952","title":"9.5.2 \u5185\u5b58\u8d44\u6e90","text":"\u53c2\u6570 \u63cf\u8ff0 <code>max_memory_usage</code> \u6b64\u53c2\u6570\u5728 <code>users.xml</code>\u3002\u8868\u793a\u5355\u8bcd Query \u5360\u7528\u5185\u5b58\u6700\u5927\u503c\uff0c\u8be5\u503c\u53ef\u4ee5\u8bbe\u7f6e\u7684\u6bd4\u8f83\u5927\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u5347\u96c6\u7fa4\u67e5\u8be2\u7684\u4e0a\u9650\u3002\u4fdd\u7559\u4e00\u70b9\u7ed9 OS\uff0c\u6bd4\u5982 128GB \u5185\u5b58\u7684\u673a\u5668\uff0c\u8bbe\u7f6e\u4e3a 100GB\u3002 <code>max_bytes_before_external_group_by</code> \u56e0\u4e3a ClickHouse \u805a\u5408\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a\u67e5\u8be2\u5e76\u5efa\u7acb\u4e2d\u95f4\u6570\u636e\u3001\u5408\u5e76\u4e2d\u95f4\u6570\u636e\u3002\u4e00\u822c\u6309\u7167 <code>max_memory_usage</code>\u7684\u4e00\u534a\u8bbe\u7f6e\u5185\u5b58\uff0c\u5f53 <code>group by</code> \u4f7f\u7528\u5185\u5b58\u8d85\u8fc7\u9608\u503c\u540e\u4f1a\u5237\u65b0\u5230\u78c1\u76d8\u8fdb\u884c\u3002 <code>max_bytes_before_external_sort</code> \u5f53 <code>order by</code>\u5df2\u4f7f\u7528<code>max_bytes_before_external_sort</code>\u5185\u5b58\u5c31\u8fdb\u884c\u6ea2\u5199\u78c1\u76d8\uff08\u57fa\u4e8e\u78c1\u76d8\u6392\u5e8f\uff09\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u503c\uff0c\u90a3\u4e48\u5f53\u5185\u5b58\u4e0d\u591f\u65f6\u76f4\u63a5\u629b\u9519\uff0c\u8bbe\u7f6e\u4e86\u8be5\u503c <code>order by</code>\u53ef\u4ee5\u6b63\u5e38\u5b8c\u6210\uff0c\u4f46\u662f\u901f\u5ea6\u76f8\u5bf9\u5185\u5b58\u6765\u8bf4\u4f1a\u6162\u5f88\u591a\u3002 <code>max_table_size_to_drop</code> \u6b64\u53c2\u6570\u5728 <code>config.xml</code> \u4e2d\u3002\u5e94\u7528\u4e8e\u9700\u8981\u5220\u9664\u8868\u6216\u5206\u533a\u7684\u60c5\u51b5\uff0c\u9ed8\u8ba4\u662f 50GB\uff0c\u610f\u601d\u662f\u5982\u679c\u5220\u9664 50GB \u4ee5\u4e0a\u7684\u5206\u533a\u8868\u4f1a\u5931\u8d25\u3002\u5efa\u8bae\u4fee\u6539\u4e3a 0\uff0c\u8fd9\u6837\u4e0d\u7ba1\u591a\u5927\u7684\u5206\u533a\u8868\u90fd\u53ef\u4ee5\u5220\u9664\u3002"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#953","title":"9.5.3 \u5b58\u50a8","text":"<p>ClickHouse \u4e0d\u652f\u6301\u8bbe\u7f6e\u591a\u6570\u636e\u76ee\u5f55\uff0c\u4e3a\u4e86\u63d0\u5347 IO \u6027\u80fd\uff0c\u53ef\u4ee5\u6302\u8f7d\u865a\u62df\u5377\u7ec4\uff0c\u4e00\u4e2a\u5377\u7ec4\u7ed1\u5b9a\u591a\u5757\u7269\u7406\u78c1\u76d8\u63d0\u5347\u8bfb\u5199\u6027\u80fd\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#clickhouse_3","title":"\u5341\u3001ClickHouse \u8bed\u6cd5\u4f18\u5316\u89c4\u5219","text":"<p>ClickHouse \u7684 SQL \u4f18\u5316\u89c4\u5219\u662f\u57fa\u4e8e RBO\uff08Rule Based Optimization\uff09\uff0c\u4e0b\u9762\u662f\u4e00\u4e9b\u4f18\u5316\u89c4\u5219\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#101","title":"10.1 \u51c6\u5907\u6d4b\u8bd5\u7528\u8868","text":"<p>\u5b98\u65b9\u6587\u6863\uff1ahttps://clickhouse.com/docs/en/getting-started/example-datasets/metrica#download-and-ingest-the-data</p> <ol> <li> <p>\u521b\u5efa\u6d4b\u8bd5\u6570\u636e\u96c6\u5e93</p> <pre><code>clickhouse-client --query \"CREATE DATABASE IF NOT EXISTS datasets\"\n</code></pre> </li> <li> <p><code>hits_v1</code> \u6570\u636e\u96c6</p> <pre><code>curl https://datasets.clickhouse.com/hits/tsv/hits_v1.tsv.xz | unxz --threads=`nproc` &gt; hits_v1.tsv\n</code></pre> <pre><code>clickhouse-client --query \"CREATE TABLE datasets.hits_v1 ( WatchID UInt64,  JavaEnable UInt8,  Title String,  GoodEvent Int16,  EventTime DateTime,  EventDate Date,  CounterID UInt32,  ClientIP UInt32,  ClientIP6 FixedString(16),  RegionID UInt32,  UserID UInt64,  CounterClass Int8,  OS UInt8,  UserAgent UInt8,  URL String,  Referer String,  URLDomain String,  RefererDomain String,  Refresh UInt8,  IsRobot UInt8,  RefererCategories Array(UInt16),  URLCategories Array(UInt16), URLRegions Array(UInt32),  RefererRegions Array(UInt32),  ResolutionWidth UInt16,  ResolutionHeight UInt16,  ResolutionDepth UInt8,  FlashMajor UInt8, FlashMinor UInt8,  FlashMinor2 String,  NetMajor UInt8,  NetMinor UInt8, UserAgentMajor UInt16,  UserAgentMinor FixedString(2),  CookieEnable UInt8, JavascriptEnable UInt8,  IsMobile UInt8,  MobilePhone UInt8,  MobilePhoneModel String,  Params String,  IPNetworkID UInt32,  TraficSourceID Int8, SearchEngineID UInt16,  SearchPhrase String,  AdvEngineID UInt8,  IsArtifical UInt8,  WindowClientWidth UInt16,  WindowClientHeight UInt16,  ClientTimeZone Int16,  ClientEventTime DateTime,  SilverlightVersion1 UInt8, SilverlightVersion2 UInt8,  SilverlightVersion3 UInt32,  SilverlightVersion4 UInt16,  PageCharset String,  CodeVersion UInt32,  IsLink UInt8,  IsDownload UInt8,  IsNotBounce UInt8,  FUniqID UInt64,  HID UInt32,  IsOldCounter UInt8, IsEvent UInt8,  IsParameter UInt8,  DontCountHits UInt8,  WithHash UInt8, HitColor FixedString(1),  UTCEventTime DateTime,  Age UInt8,  Sex UInt8,  Income UInt8,  Interests UInt16,  Robotness UInt8,  GeneralInterests Array(UInt16), RemoteIP UInt32,  RemoteIP6 FixedString(16),  WindowName Int32,  OpenerName Int32,  HistoryLength Int16,  BrowserLanguage FixedString(2),  BrowserCountry FixedString(2),  SocialNetwork String,  SocialAction String,  HTTPError UInt16, SendTiming Int32,  DNSTiming Int32,  ConnectTiming Int32,  ResponseStartTiming Int32,  ResponseEndTiming Int32,  FetchTiming Int32,  RedirectTiming Int32, DOMInteractiveTiming Int32,  DOMContentLoadedTiming Int32,  DOMCompleteTiming Int32,  LoadEventStartTiming Int32,  LoadEventEndTiming Int32, NSToDOMContentLoadedTiming Int32,  FirstPaintTiming Int32,  RedirectCount Int8, SocialSourceNetworkID UInt8,  SocialSourcePage String,  ParamPrice Int64, ParamOrderID String,  ParamCurrency FixedString(3),  ParamCurrencyID UInt16, GoalsReached Array(UInt32),  OpenstatServiceName String,  OpenstatCampaignID String,  OpenstatAdID String,  OpenstatSourceID String,  UTMSource String, UTMMedium String,  UTMCampaign String,  UTMContent String,  UTMTerm String, FromTag String,  HasGCLID UInt8,  RefererHash UInt64,  URLHash UInt64,  CLID UInt32,  YCLID UInt64,  ShareService String,  ShareURL String,  ShareTitle String,  ParsedParams Nested(Key1 String,  Key2 String, Key3 String, Key4 String, Key5 String,  ValueDouble Float64),  IslandID FixedString(16),  RequestNum UInt32,  RequestTry UInt8) ENGINE = MergeTree() PARTITION BY toYYYYMM(EventDate) ORDER BY (CounterID, EventDate, intHash32(UserID)) SAMPLE BY intHash32(UserID) SETTINGS index_granularity = 8192\"\n</code></pre> <pre><code>cat hits_v1.tsv | clickhouse-client --query \"INSERT INTO datasets.hits_v1 FORMAT TSV\" --max_insert_block_size=100000\n</code></pre> <pre><code>clickhouse-client --query \"SELECT COUNT(*) FROM datasets.hits_v1\"\n</code></pre> </li> <li> <p><code>visits_v1</code> \u6570\u636e\u96c6</p> <pre><code>curl https://datasets.clickhouse.com/visits/tsv/visits_v1.tsv.xz | unxz --threads=`nproc` &gt; visits_v1.tsv\n</code></pre> <pre><code>clickhouse-client --query \"CREATE TABLE datasets.visits_v1 ( CounterID UInt32,  StartDate Date,  Sign Int8,  IsNew UInt8,  VisitID UInt64,  UserID UInt64,  StartTime DateTime,  Duration UInt32,  UTCStartTime DateTime,  PageViews Int32,  Hits Int32,  IsBounce UInt8,  Referer String,  StartURL String,  RefererDomain String,  StartURLDomain String,  EndURL String,  LinkURL String,  IsDownload UInt8,  TraficSourceID Int8,  SearchEngineID UInt16,  SearchPhrase String,  AdvEngineID UInt8,  PlaceID Int32,  RefererCategories Array(UInt16),  URLCategories Array(UInt16),  URLRegions Array(UInt32),  RefererRegions Array(UInt32),  IsYandex UInt8,  GoalReachesDepth Int32,  GoalReachesURL Int32,  GoalReachesAny Int32,  SocialSourceNetworkID UInt8,  SocialSourcePage String,  MobilePhoneModel String,  ClientEventTime DateTime,  RegionID UInt32,  ClientIP UInt32,  ClientIP6 FixedString(16),  RemoteIP UInt32,  RemoteIP6 FixedString(16),  IPNetworkID UInt32,  SilverlightVersion3 UInt32,  CodeVersion UInt32,  ResolutionWidth UInt16,  ResolutionHeight UInt16,  UserAgentMajor UInt16,  UserAgentMinor UInt16,  WindowClientWidth UInt16,  WindowClientHeight UInt16,  SilverlightVersion2 UInt8,  SilverlightVersion4 UInt16,  FlashVersion3 UInt16,  FlashVersion4 UInt16,  ClientTimeZone Int16,  OS UInt8,  UserAgent UInt8,  ResolutionDepth UInt8,  FlashMajor UInt8,  FlashMinor UInt8,  NetMajor UInt8,  NetMinor UInt8,  MobilePhone UInt8,  SilverlightVersion1 UInt8,  Age UInt8,  Sex UInt8,  Income UInt8,  JavaEnable UInt8,  CookieEnable UInt8,  JavascriptEnable UInt8,  IsMobile UInt8,  BrowserLanguage UInt16,  BrowserCountry UInt16,  Interests UInt16,  Robotness UInt8,  GeneralInterests Array(UInt16),  Params Array(String),  Goals Nested(ID UInt32, Serial UInt32, EventTime DateTime,  Price Int64,  OrderID String, CurrencyID UInt32),  WatchIDs Array(UInt64),  ParamSumPrice Int64,  ParamCurrency FixedString(3),  ParamCurrencyID UInt16,  ClickLogID UInt64,  ClickEventID Int32,  ClickGoodEvent Int32,  ClickEventTime DateTime,  ClickPriorityID Int32,  ClickPhraseID Int32,  ClickPageID Int32,  ClickPlaceID Int32,  ClickTypeID Int32,  ClickResourceID Int32,  ClickCost UInt32,  ClickClientIP UInt32,  ClickDomainID UInt32,  ClickURL String,  ClickAttempt UInt8,  ClickOrderID UInt32,  ClickBannerID UInt32,  ClickMarketCategoryID UInt32,  ClickMarketPP UInt32,  ClickMarketCategoryName String,  ClickMarketPPName String,  ClickAWAPSCampaignName String,  ClickPageName String,  ClickTargetType UInt16,  ClickTargetPhraseID UInt64,  ClickContextType UInt8,  ClickSelectType Int8,  ClickOptions String,  ClickGroupBannerID Int32,  OpenstatServiceName String,  OpenstatCampaignID String,  OpenstatAdID String,  OpenstatSourceID String,  UTMSource String,  UTMMedium String,  UTMCampaign String,  UTMContent String,  UTMTerm String,  FromTag String,  HasGCLID UInt8,  FirstVisit DateTime,  PredLastVisit Date,  LastVisit Date,  TotalVisits UInt32,  TraficSource    Nested(ID Int8,  SearchEngineID UInt16, AdvEngineID UInt8, PlaceID UInt16, SocialSourceNetworkID UInt8, Domain String, SearchPhrase String, SocialSourcePage String),  Attendance FixedString(16),  CLID UInt32,  YCLID UInt64,  NormalizedRefererHash UInt64,  SearchPhraseHash UInt64,  RefererDomainHash UInt64,  NormalizedStartURLHash UInt64,  StartURLDomainHash UInt64,  NormalizedEndURLHash UInt64,  TopLevelDomain UInt64,  URLScheme UInt64,  OpenstatServiceNameHash UInt64,  OpenstatCampaignIDHash UInt64,  OpenstatAdIDHash UInt64,  OpenstatSourceIDHash UInt64,  UTMSourceHash UInt64,  UTMMediumHash UInt64,  UTMCampaignHash UInt64,  UTMContentHash UInt64,  UTMTermHash UInt64,  FromHash UInt64,  WebVisorEnabled UInt8,  WebVisorActivity UInt32,  ParsedParams    Nested(Key1 String,  Key2 String,  Key3 String,  Key4 String, Key5 String, ValueDouble    Float64),  Market Nested(Type UInt8, GoalID UInt32, OrderID String,  OrderPrice Int64,  PP UInt32,  DirectPlaceID UInt32,  DirectOrderID  UInt32,  DirectBannerID UInt32,  GoodID String, GoodName String, GoodQuantity Int32,  GoodPrice Int64),  IslandID FixedString(16)) ENGINE = CollapsingMergeTree(Sign) PARTITION BY toYYYYMM(StartDate) ORDER BY (CounterID, StartDate, intHash32(UserID), VisitID) SAMPLE BY intHash32(UserID) SETTINGS index_granularity = 8192\"\n</code></pre> <pre><code>cat visits_v1.tsv | clickhouse-client --query \"INSERT INTO datasets.visits_v1 FORMAT TSV\" --max_insert_block_size=100000\n</code></pre> <pre><code>clickhouse-client --query \"SELECT COUNT(*) FROM datasets.visits_v1\"\n</code></pre> </li> </ol> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#102-count","title":"10.2 COUNT \u4f18\u5316","text":"<p>\u5728\u8c03\u7528 count \u51fd\u6570\u65f6\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662f <code>count()</code> \u6216\u8005 <code>count(*)</code>\uff0c\u5207\u6ca1\u6709 where \u6761\u4ef6\uff0c\u5219\u4f1a\u76f4\u63a5\u4f7f\u7528 <code>system.tables</code> \u7684 <code>table_rows</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>explain select count() from datasets.hits_v1;\n\nexplain select count(CounterID) from datasets.hits_v1;\n</code></pre> <p></p> <p>\u6ce8\u610f <code>Optimized trivial count</code> \u8fd9\u662f\u5bf9 count \u7684\u4f18\u5316\uff0c\u5982\u679c count \u5177\u4f53\u7684\u5217\u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u4f7f\u7528\u6b64\u9879\u4f18\u5316\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#103","title":"10.3 \u6d88\u9664\u5b50\u67e5\u8be2\u91cd\u590d\u5b57\u6bb5","text":"<p>\u4e0b\u9762\u8bed\u53e5\u5b50\u67e5\u8be2\u4e2d\u6709\u8fde\u4e2a\u91cd\u590d\u7684 <code>UserID</code>\u5b57\u6bb5\uff0c\u4f1a\u88ab\u53bb\u91cd\uff1a</p> <pre><code>explain syntax\nselect\n    a.UserID,\n    b.VisitID,\n    a.URL,\n    b.UserID\nfrom datasets.hits_v1 as a\nleft join (\n    select\n        UserID,\n        UserID as HaHa,\n        VisitID\n    from datasets.visits_v1\n) as b\nusing (UserID)\nlimit 3;\n</code></pre> <p></p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#103_1","title":"10.3 \u8c13\u8bcd\u4e0b\u63a8","text":"<p>\u5f53 <code>group by</code> \u6709 <code>having</code>\u5b50\u53e5\uff0c\u4f46\u662f\u6ca1\u6709 <code>with cube</code>\u3001<code>with rollup</code>\u3001<code>with totals</code> \u4fee\u9970\u7684\u65f6\u5019\uff0c<code>having</code> \u8fc7\u6ee4\u4f1a\u4e0b\u63a8\u5230 <code>where</code> \u63d0\u524d\u8fc7\u6ee4\u3002</p> <pre><code>-- having \u8c13\u8bcd\u4e0b\u63a8\nexplain syntax\nselect UserID\nfrom datasets.hits_v1\ngroup by UserID\nhaving UserID = '8585742290196126178';\n\n-- \u5b50\u67e5\u8be2\u8c13\u8bcd\u4e0b\u63a8\nexplain syntax\nselect *\nfrom (\n    select UserID from datasets.visits_v1\n)\nwhere UserID = '8585742290196126178';\n\n-- union all \u8c13\u8bcd\u4e0b\u63a8\nexplain syntax\nselect *\nfrom (\n    select *\n    from (\n        select UserID from datasets.visits_v1\n    )\n    union all\n    select *\n    from (\n        select UserID from datasets.visits_v1\n    )\n)\nwhere UserID = '8585742290196126178';\n</code></pre> <p></p> <p></p> <p></p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#105","title":"10.5 \u805a\u5408\u8ba1\u7b97\u5916\u63a8","text":"<pre><code>explain syntax\nselect sum(UserID * 2)\nfrom datasets.visits_v1;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#106","title":"10.6 \u805a\u5408\u51fd\u6570\u6d88\u9664","text":"<pre><code>explain syntax\nselect\n    sum(UserID * 2),\n    max(VisitID),\n    max(UserID)\nfrom datasets.visits_v1\ngroup by UserID;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#107-order-by-key","title":"10.7 \u5220\u9664\u91cd\u590d\u7684 order by key","text":"<pre><code>explain syntax\nselect *\nfrom datasets.visits_v1\norder by\n    UserID  asc,\n    UserID  asc,\n    VisitID asc,\n    VisitID asc;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#108-limit-by-key","title":"10.8 \u5220\u9664\u91cd\u590d\u7684 limit by key","text":"<pre><code>explain syntax\nselect *\nfrom datasets.visits_v1\nlimit 3 by VisitID, VisitID\nlimit 10;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#109-using-key","title":"10.9 \u5220\u9664\u91cd\u590d\u7684 using key","text":"<pre><code>explain syntax\nselect\n    a.UserID,\n    a.UserID,\n    b.VisitID,\n    a.URL,\n    b.UserID\nfrom datasets.hits_v1 as a\nleft join datasets.visits_v1 as b using (UserID, UserID);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1010","title":"10.10 \u6807\u91cf\u66ff\u6362","text":"<p>\u5982\u679c\u5b50\u67e5\u8be2\u53ea\u8fd4\u56de\u4e00\u884c\u6570\u636e\uff0c\u5728\u88ab\u5f15\u7528\u7684\u65f6\u5019\u7528\u6807\u91cf\u66ff\u6362\u3002</p> <pre><code>explain syntax\nwith (\n    select sum(bytes) from system.parts where active\n) as total_disk_usage\nselect\n    (sum(bytes) / total_disk_usage) * 100 as table_disk_usage,\n    table\nfrom system.parts\ngroup by table\norder by table_disk_usage desc\nlimit 10;\n</code></pre> <p></p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1011","title":"10.11 \u4e09\u5143\u8fd0\u7b97\u4f18\u5316","text":"<p>\u5982\u679c\u5f00\u542f\u4e86 <code>optimize_if_chain_to_multiif</code>\u53c2\u6570\uff0c\u4e09\u5143\u8fd0\u7b97\u7b26\u4f1a\u88ab\u66ff\u6362\u6210 ``</p> <pre><code>explain syntax\nselect number = 1 ? 'hello' : (number = 2 ? 'world' : 'clickhouse')\nfrom numbers(10)\nsettings optimize_if_chain_to_multiif = 1;\n</code></pre> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_7","title":"\u5341\u4e00\u3001\u67e5\u8be2\u4f18\u5316","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#111_1","title":"11.1 \u5355\u8868\u67e5\u8be2","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1111-prewhere-where","title":"11.1.1 <code>prewhere</code> \u66ff\u4ee3 <code>where</code>","text":"<p><code>prewhere</code> \u548c <code>where</code> \u8bed\u53e5\u7684\u4f5c\u7528\u76f8\u540c\uff0c\u7528\u6765\u8fc7\u6ee4\u6570\u636e\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e <code>prewhere</code> \u53ea\u652f\u6301 *MergeTree \u65cf\u7cfb\u5217\u5f15\u64ce\u7684\u8868\uff0c\u9996\u5148\u4f1a\u8bfb\u53d6\u6307\u5b9a\u7684\u5217\u6570\u636e\uff0c\u6765\u5224\u65ad\u6570\u636e\u8fc7\u6ee4\uff0c\u7b49\u5f85\u6570\u636e\u8fc7\u6ee4\u4e4b\u540e\u518d\u8bfb\u53d6 <code>select</code> \u58f0\u660e\u7684\u5217\u5b57\u6bb5\u6765\u8865\u5168\u5176\u4f59\u5c5e\u6027\u3002</p> <p>\u5f53\u67e5\u8be2\u5217\u660e\u663e\u591a\u4f59\u7b5b\u9009\u5217\u65f6\u4f7f\u7528 <code>prewhere</code> \u53ef\u5341\u500d\u63d0\u5347\u67e5\u8be2\u6027\u80fd\uff0c<code>prewhere</code> \u4f1a\u81ea\u52a8\u4f18\u5316\u6267\u884c\u8fc7\u6ee4\u9636\u6bb5\u7684\u6570\u636e\u8bfb\u53d6\u65b9\u5f0f\uff0c\u964d\u4f4e IO \u64cd\u4f5c\u3002</p> <p>\u5728\u67d0\u4e9b\u573a\u5408\u4e0b\uff0c<code>prewhere</code> \u8bed\u53e5\u6bd4 <code>where</code> \u8bed\u53e5\u5904\u7406\u6570\u636e\u7684\u6570\u636e\u91cf\u66f4\u5c11\u6027\u80fd\u66f4\u9ad8\u3002</p> <pre><code>set optimize_move_to_prewhere = 0;\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u80af\u5b9a\u4e0d\u4f1a\u5173\u95ed <code>where</code> \u81ea\u52a8\u4f18\u5316\u6210 <code>prewhere</code>\uff0c\u4f46\u662f\u67d0\u4e9b\u573a\u666f\u5373\u65f6\u5f00\u542f\u4f18\u5316\uff0c\u4e5f\u4e0d\u4f1a\u81ea\u52a8\u8f6c\u6362\u6210 <code>prewhere</code>\uff0c\u9700\u8981\u624b\u52a8\u624b\u52a8\u6307\u5b9a\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u4f7f\u7528\u5e38\u91cf\u8868\u8fbe\u5f0f</li> <li>\u4f7f\u7528\u9ed8\u8ba4\u503c\u4e3a alias \u7c7b\u578b\u7684\u5b57\u6bb5</li> <li>\u5305\u542b\u4e86 <code>arrayJoin</code>\u3001<code>globalIn</code>\u3001<code>globalNotIn</code> \u6216\u8005 <code>indexHint</code> \u7684\u67e5\u8be2</li> <li><code>select</code>\u67e5\u8be2\u7684\u5217\u5b57\u6bb5\u548c <code>where</code> \u7684\u8c13\u8bcd\u76f8\u540c</li> <li>\u4f7f\u7528\u4e86\u4e3b\u952e\u5b57\u6bb5</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1112","title":"11.1.2 \u6570\u636e\u91c7\u6837","text":"<p>\u901a\u8fc7\u91c7\u6837\u8fd0\u7b97\u53ef\u6781\u5927\u63d0\u5347\u6570\u636e\u5206\u6790\u7684\u6027\u80fd\u3002</p> <pre><code>select Title, count(*) as PageViews\nfrom datasets.hits_v1\nsample 0.1\nwhere CounterID = 57\ngroup by Title\norder by PageViews desc\nlimit 1000;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1113","title":"11.1.3 \u5217\u88c1\u526a\u4e0e\u5206\u533a\u88c1\u526a","text":"<p>\u6570\u636e\u91cf\u592a\u5927\u65f6\u5e94\u907f\u514d\u4f7f\u7528 <code>select *</code> \u64cd\u4f5c\uff0c\u67e5\u8be2\u7684\u6027\u80fd\u4f1a\u4e0e\u67e5\u8be2\u7684\u5b57\u6bb5\u5927\u5c0f\u548c\u6570\u91cf\u6210\u7ebf\u6027\u76f8\u5173\uff0c\u5b57\u6bb5\u8d8a\u5c11\uff0c\u6d88\u8017\u7684 IO \u8d44\u6e90\u8d8a\u5c11\uff0c\u6027\u80fd\u5c31\u4f1a\u8d8a\u9ad8\u3002\u5206\u533a\u88c1\u526a\u5c31\u662f\u53ea\u8bfb\u53d6\u9700\u8981\u7684\u5206\u533a\uff0c\u5728\u8fc7\u6ee4\u6761\u4ef6\u4e2d\u6307\u5b9a\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1114-order-by-wherelimit","title":"11.1.4 <code>order by</code>\u7ed3\u5408 <code>where</code>\u3001<code>limit</code>","text":"<p>\u5343\u4e07\u4ee5\u4e0a\u6570\u636e\u96c6\u8fdb\u884c <code>order by</code> \u67e5\u8be2\u65f6\u9700\u8981\u642d\u914d <code>where</code> \u6761\u4ef6\u548c <code>limit</code> \u8bed\u53e5\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1115","title":"11.1.5 \u907f\u514d\u6784\u5efa\u865a\u62df\u5217","text":"<p>\u5982\u975e\u5fc5\u987b\uff0c\u4e0d\u8981\u5728\u7ed3\u679c\u96c6\u4e0a\u6784\u5efa\u865a\u62df\u5217\uff0c\u865a\u62df\u5217\u975e\u5e38\u6d88\u8017\u8d44\u6e90\u6d6a\u8d39\u6027\u80fd\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u524d\u7aef\u8fdb\u884c\u5904\u7406\uff0c\u6216\u8005\u5728\u8868\u4e2d\u6784\u9020\u5b9e\u9645\u5b57\u6bb5\u8fdb\u884c\u989d\u5916\u5b58\u50a8\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1116-uniqcombined-distinct","title":"11.1.6 <code>uniqCombined</code> \u66ff\u4ee3<code>distinct</code>","text":"<p>\u6027\u80fd\u53ef\u63d0\u5347 10 \u500d\u4ee5\u4e0a\uff0c <code>uniqCombined</code>\u5e95\u5c42\u91c7\u7528\u7c7b\u4f3c HyperLogLog \u7b97\u6cd5\u5b9e\u73b0\uff0c\u80fd\u63a5\u53d7 2% \u5de6\u53f3\u7684\u6570\u636e\u8bef\u5dee\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528\u8fd9\u79cd\u53bb\u91cd\u65b9\u5f0f\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u3002<code>count(distinct)</code> \u4f1a\u4f7f\u7528 <code>uniqExact</code>\u7cbe\u786e\u53bb\u91cd\u3002</p> <p>\u4e0d\u5efa\u8bae\u5728\u5343\u4e07\u7ea7\u4e0d\u540c\u6570\u636e\u4e0a\u6267\u884c <code>distinct</code> \u53bb\u91cd\u67e5\u8be2\uff0c\u6539\u4e3a\u8fd1\u4f3c\u53bb\u91cd <code>uniqCombined</code>\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1117","title":"11.1.7 \u4f7f\u7528\u7269\u5316\u89c6\u56fe","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1118","title":"11.1.8 \u5176\u5b83\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p>\u67e5\u8be2\u7194\u65ad</p> <p>\u4e3a\u4e86\u907f\u514d\u56e0\u4e2a\u522b\u6162\u67e5\u8be2\u5f15\u8d77\u7684\u670d\u52a1\u96ea\u5d29\u7684\u95ee\u9898\uff0c\u9664\u4e86\u53ef\u4ee5\u4e3a\u5355\u4e2a\u67e5\u8be2\u8bbe\u7f6e\u8d85\u65f6\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u914d\u7f6e\u5468\u671f\u7194\u65ad\uff0c\u5728\u4e00\u4e2a\u67e5\u8be2\u5468\u671f\u5185\uff0c\u5982\u679c\u7528\u6237\u9891\u7e41\u8fdb\u884c\u6162\u67e5\u8be2\u64cd\u4f5c\u8d85\u51fa\u9608\u503c\u540e\u5c06\u65e0\u6cd5\u7ee7\u7eed\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5173\u95ed\u865a\u62df\u5185\u5b58</p> <p>\u7269\u7406\u5185\u5b58\u548c\u865a\u62df\u5185\u5b58\u7684\u6570\u636e\u4ea4\u6362\uff0c\u4f1a\u5bfc\u81f4\u67e5\u8be2\u53d8\u6162\uff0c\u8d44\u6e90\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\u5173\u95ed\u865a\u62df\u5185\u5b58\u3002</p> </li> <li> <p>\u914d\u7f6e <code>join_use_nulls</code></p> <p>\u4e3a\u6bcf\u4e00\u4e2a\u8d26\u6237\u6dfb\u52a0 <code>join_use_nulls</code>\u914d\u7f6e\uff0c\u5de6\u8868\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\u5728\u53f3\u8868\u4e2d\u4e0d\u5b58\u5728\uff0c\u53f3\u8868\u7684\u76f8\u5e94\u5b57\u6bb5\u4f1a\u8fd4\u56de\u8be5\u5b57\u6bb5\u76f8\u5e94\u6570\u636e\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\uff0c\u800c\u4e0d\u662f\u6807\u51c6 SQL \u7684 NULL \u503c\u3002</p> </li> <li> <p>\u6279\u91cf\u5199\u5165\u65f6\u5148\u6392\u5e8f</p> <p>\u6279\u91cf\u5199\u5165\u6570\u636e\u65f6\uff0c\u5fc5\u987b\u63a7\u5236\u6bcf\u4e2a\u6279\u6b21\u7684\u6570\u636e\u4e2d\u6d89\u53ca\u5230\u7684\u5206\u533a\u7684\u6570\u91cf\uff0c\u5728\u5199\u5165\u4e4b\u524d\u6700\u597d\u5bf9\u9700\u8981\u5bfc\u5165\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u3002\u65e0\u5e8f\u7684\u6570\u636e\u6216\u8005\u6d89\u53ca\u7684\u5206\u533a\u592a\u591a\uff0c\u4f1a\u5bfc\u81f4 ClickHouse \u65e0\u6cd5\u53ca\u65f6\u5bf9\u65b0\u5bfc\u5165\u7684\u6570\u636e\u8fdb\u884c\u5408\u5e76\uff0c\u4ece\u800c\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002</p> </li> <li> <p>\u5173\u6ce8 CPU</p> <p>CPU \u4e00\u822c\u5728 50% \u5de6\u53f3\u4f1a\u51fa\u73b0\u67e5\u8be2\u6ce2\u52a8\uff0c\u8fbe\u5230 70% \u4f1a\u51fa\u73b0\u5927\u8303\u56f4\u7684\u67e5\u8be2\u8d85\u65f6\uff0cCPU \u662f\u6700\u5173\u952e\u7684\u6307\u6807\uff0c\u8981\u975e\u5e38\u5173\u6ce8\u3002</p> </li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#112","title":"11.2 \u591a\u8868\u5173\u8054","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1121","title":"11.2.1 \u51c6\u5907\u8868\u548c\u6570\u636e","text":"<pre><code>-- \u521b\u5efa\u5c0f\u8868\ncreate table visits_v2\nengine = CollapsingMergeTree(Sign)\npartition by toYYYYMM(StartDate)\norder by (CounterID, StartDate, intHash32(UserID), VisitID)\nsample by intHash32(UserID)\nsettings index_granularity = 8192\nas\nselect * from datasets.visits_v1 limit 10000;\n\n-- \u521b\u5efa join \u7ed3\u679c\u8868\uff08\u907f\u514d\u63a7\u5236\u53f0\u75af\u72c2\u6253\u5370\u6570\u636e\uff09\ncreate table hits_v2\nengine = MergeTree()\npartition by toYYYYMM(EventDate)\norder by (CounterID, EventDate, intHash32(UserID))\nsample by intHash32(UserID)\nsettings index_granularity = 8192\nas\nselect * from datasets.hits_v1 where 1 = 0;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1122-in-join","title":"11.2.2 \u7528 <code>in</code> \u4ee3\u66ff <code>join</code>","text":"<p>\u5f53\u591a\u8868\u8054\u67e5\u65f6\uff0c\u67e5\u8be2\u7684\u6570\u636e\u4ec5\u4ece\u5176\u4e2d\u4e00\u5f20\u8868\u51fa\u65f6\uff0c\u53ef\u8003\u8651\u7528 <code>in</code> \u64cd\u4f5c\u800c\u4e0d\u662f <code>join</code>\u3002</p> <pre><code>insert into hits_v2\nselect a.*\nfrom datasets.hits_v1 a\nwhere a.CounterID in (\n    select CounterID from datasets.visits_v1\n);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1123-join","title":"11.2.3 \u5927\u5c0f\u8868 <code>join</code>","text":"<p>\u591a\u8868 <code>join</code> \u65f6\u8981\u6ee1\u8db3\u5c0f\u8868\u5728\u53f3\u7684\u539f\u5219\uff0c\u53f3\u8868\u5173\u8054\u65f6\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u4e0e\u5de6\u8868\u8fdb\u884c\u6bd4\u8f83\uff0cClickHouse \u4e2d\u65e0\u8bba\u662f <code>left join</code>\u3001<code>right join</code>\u8fd8\u662f <code>inner join</code> \u6c38\u8fdc\u90fd\u662f\u62ff\u7740\u53f3\u8868\u4e2d\u7684\u6bcf\u4e00\u6761\u8bb0\u5f55\u5230\u5de6\u8868\u4e2d\u67e5\u627e\u8be5\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u6240\u4ee5\u53f3\u8868\u5fc5\u987b\u662f\u5c0f\u8868\u3002</p> <pre><code>insert into table hits_v2\nselect a.*\nfrom datasets.hits_v1 a\nleft join visits_v2 b on a.CounterID = b.CounterID;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1124","title":"11.2.4 \u6ce8\u610f\u8c13\u8bcd\u4e0b\u63a8","text":"<p>ClickHouse \u5728 <code>join</code>\u67e5\u8be2\u65f6\u4e0d\u4f1a\u4e3b\u52a8\u53d1\u8d77\u8c13\u8bcd\u4e0b\u63a8\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u6bcf\u4e2a\u5b50\u67e5\u8be2\u63d0\u524d\u5b8c\u6210\u8fc7\u6ee4\u64cd\u4f5c\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u662f\u5426\u6267\u884c\u8c13\u8bcd\u4e0b\u63a8\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u5dee\u522b\u5f88\u5927\uff08\u65b0\u7248\u672c\u4e2d\u5df2\u7ecf\u4e0d\u5b58\u5728\u6b64\u95ee\u9898\uff0c\u4f46\u662f\u9700\u8981\u6ce8\u610f\u8c13\u8bcd\u7684\u4f4d\u7f6e\u7684\u4e0d\u540c\u4f9d\u7136\u6709\u6027\u80fd\u7684\u5dee\u5f02\uff09\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1125-global","title":"11.2.5 \u5206\u5e03\u5f0f\u8868\u4f7f\u7528 <code>global</code>","text":"<p>\u4e24\u5f20\u5206\u5e03\u5f0f\u8868\u4e0a\u7684 <code>in</code> \u548c <code>join</code> \u4e4b\u524d\u5fc5\u987b\u52a0\u4e0a <code>global</code>\u5173\u952e\u5b57\uff0c\u53f3\u8868\u667a\u6167\u5728\u63a5\u6536\u67e5\u8be2\u8bf7\u6c42\u7684\u90a3\u4e2a\u8282\u70b9\u67e5\u8be2\u4e00\u6b21\uff0c\u5e76\u5c06\u5176\u5206\u53d1\u5230\u5176\u4ed6\u8282\u70b9\u4e0a\u3002\u5982\u679c\u4e0d\u52a0 <code>global</code> \u5173\u952e\u5b57\u7684\u8bdd\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u5355\u72ec\u53d1\u8d77\u4e00\u6b21\u5bf9\u53f3\u8868\u7684\u67e5\u8be2\uff0c\u800c\u53f3\u8868\u53c8\u662f\u5206\u5e03\u5f0f\u8868\uff0c\u5c31\u5bfc\u81f4\u53f3\u8868\u4e00\u5171\u4f1a\u88ab\u67e5\u8be2 N<sup>2</sup>\u6b21\uff08N \u662f\u8be5\u5206\u5e03\u5f0f\u8868\u7684\u5206\u7247\u6570\u91cf\uff09\uff0c\u8fd9\u5c31\u662f\u67e5\u8be2\u653e\u5927\uff0c\u4f1a\u5e26\u6765\u5f88\u5927\u5f00\u9500\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1126","title":"11.2.6 \u4f7f\u7528\u5b57\u5178\u8868","text":"<p>\u5c06\u4e00\u4e9b\u9700\u8981\u5173\u8054\u5206\u6790\u7684\u4e1a\u52a1\u521b\u5efa\u6210\u5b57\u5178\u8868\u8fdb\u884c <code>join</code>\u64cd\u4f5c\uff0c\u524d\u63d0\u662f\u5b57\u5178\u8868\u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3a\u5b57\u5178\u8868\u4f1a\u5e38\u9a7b\u5185\u5b58\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1127","title":"11.2.7 \u63d0\u524d\u8fc7\u6ee4","text":"<p>\u901a\u8fc7\u589e\u52a0\u903b\u8f91\u8fc7\u6ee4\u53ef\u4ee5\u51cf\u5c11\u6570\u636e\u626b\u63cf\uff0c\u8fbe\u5230\u63d0\u9ad8\u6267\u884c\u901f\u5ea6\u53ca\u964d\u4f4e\u5185\u5b58\u6d88\u8017\u7684\u76ee\u7684\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_8","title":"\u5341\u4e8c\u3001\u6570\u636e\u4e00\u81f4\u6027","text":"<p>\u67e5\u8be2 ClickHouse \u624b\u518c\u53d1\u73b0\uff0c\u5373\u4fbf\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u652f\u6301\u6700\u597d\u7684 MergeTree\uff0c\u4e5f\u53ea\u662f\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u3002\u6211\u4eec\u5728\u4f7f\u7528 ReplacingMergeTree\u3001SummingMergeTree \u8fd9\u7c7b\u8868\u5f15\u64ce\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u77ed\u6682\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u5728\u67d0\u4e9b\u5bf9\u4e00\u81f4\u6027\u975e\u5e38\u654f\u611f\u7684\u573a\u666f\uff0c\u901a\u5e38\u6709\u4ee5\u4e0b\u51e0\u79cd\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#121","title":"12.1 \u51c6\u5907\u6d4b\u8bd5\u8868\u548c\u6570\u636e","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1211","title":"12.1.1 \u521b\u5efa\u8868","text":"<pre><code>create table test_a (\n    user_id     UInt64,\n    score       String,\n    deleted     UInt8    default 0,\n    create_time DateTime default toDateTime(0)\n)\nengine = ReplacingMergeTree(create_time)\norder by user_id;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1212-1000","title":"12.1.2 \u5199\u5165 1000 \u4e07\u6d4b\u8bd5\u6570\u636e","text":"<pre><code>insert into table test_a (user_id,score)\nwith (\n    select ['A','B','C','D','E','F','G']\n) as dict\nselect number as user_id, dict[number%7+1] from numbers(10000000);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1213-540-name-create_time","title":"12.1.3 \u4fee\u6539\u524d 540 \u4e07\u884c\u6570\u636e\uff0c\u4fee\u6539\u5185\u5bb9\u5305\u62ec <code>name</code> \u548c <code>create_time</code> \u5b57\u6bb5","text":"<pre><code>insert into table test_a (user_id,score,create_time)\nwith (\n    select ['AA','BB','CC','DD','EE','FF','GG']\n) as dict\nselect number as user_id, dict[number%7+1], now() as create_time from numbers(500000);\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1214","title":"12.1.4 \u7edf\u8ba1\u603b\u6570","text":"<pre><code>select count(*) from test_a;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#122-optimize","title":"12.2 \u624b\u52a8 <code>optimize</code>","text":"<p>\u5728\u5199\u5165\u6570\u636e\u540e\uff0c\u7acb\u5373\u6267\u884c <code>optimize</code> \u5f3a\u5236\u89e6\u53d1\u65b0\u5199\u5165\u5206\u533a\u7684\u5408\u5e76\u52a8\u4f5c\u3002</p> <pre><code>optimize table test_a final;\n</code></pre> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#123-group-by","title":"12.3 \u901a\u8fc7 <code>group by</code> \u53bb\u91cd","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1231","title":"12.3.1 \u6267\u884c\u53bb\u91cd\u7684\u67e5\u8be2","text":"<pre><code>select\n    user_id,\n    argMax(score, create_time) as score,\n    argMax(deleted, create_time) as deleted,\n    max(create_time) as ctime\nfrom test_a\ngroup by user_id\nhaving deleted = 0;\n</code></pre> <p>\u51fd\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>argMax(field1, field2)</code>\uff1a\u6309\u7167 <code>field2</code> \u7684\u6700\u5927\u503c\u53d6 <code>field1</code> \u7684\u503c\u3002\u5f53\u6211\u4eec\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u4f1a\u5199\u5165\u4e00\u884c\u65b0\u7684\u6570\u636e\uff0c\u4f8b\u5982\u4e0a\u9762\u8bed\u53e5\u4e2d\uff0c\u901a\u8fc7\u67e5\u8be2\u6700\u5927\u7684 <code>create_time</code> \u5f97\u5230\u4fee\u6539\u540e\u7684 <code>score</code> \u5b57\u6bb5\u503c\u3002</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1232","title":"12.3.2 \u521b\u5efa\u89c6\u56fe\uff0c\u65b9\u4fbf\u6d4b\u8bd5","text":"<pre><code>create view view_test_a as\nselect\n    user_id,\n    argMax(score, create_time) as score,\n    argMax(deleted, create_time) as deleted,\n    max(create_time) as ctime\nfrom test_a\ngroup by user_id\nhaving deleted = 0;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1332","title":"13.3.2 \u63d2\u5165\u91cd\u590d\u6570\u636e\uff0c\u518d\u6b21\u67e5\u8be2","text":"<pre><code>insert into table test_a (user_id, score, create_time) values (0, 'AAAA', now());\n\nselect * from view_test_a where user_id = 0;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1333","title":"13.3.3 \u5220\u9664\u6570\u636e\u6d4b\u8bd5","text":"<pre><code>insert into table test_a (user_id, score, deleted, create_time) values (0, 'AAAA', 1, now());\n\n-- \u518d\u6b21\u67e5\u8be2\u53d1\u73b0\u521a\u624d\u90a3\u6761\u6570\u636e\u770b\u4e0d\u5230\u4e86\nselect * from view_test_a where user_id = 0;\n</code></pre> <p>\u8fd9\u884c\u6570\u636e\u5e76\u6ca1\u6709\u88ab\u771f\u6b63\u7684\u5220\u9664\uff0c\u800c\u662f\u88ab\u8fc7\u6ee4\u6389\u4e86\u3002\u5728\u4e00\u4e9b\u5408\u9002\u7684\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u7ed3\u5408\u8868\u7ea7\u522b\u7684 TTL \u6700\u7ec8\u5c06\u7269\u7406\u6570\u636e\u5220\u9664\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#124-final","title":"12.4 \u901a\u8fc7 <code>final</code> \u67e5\u8be2","text":"<p>\u5728\u67e5\u8be2\u8bed\u53e5\u540e\u589e\u52a0 <code>final</code> \u4fee\u9970\u7b26\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u7684\u8fc7\u7a0b\u4e2d\u5c06\u4f1a\u6267\u884c Merge \u7684\u7279\u4fd7\u903b\u8f91\uff08\u4f8b\u5982\u6570\u636e\u53bb\u91cd\u3001\u9884\u805a\u5408\u7b49\uff09\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u65b9\u6cd5\u5728\u65e9\u671f\u7248\u672c\u57fa\u672c\u6ca1\u6709\u4eba\u4f7f\u7528\uff0c\u56e0\u4e3a\u5728\u589e\u52a0 <code>final</code> \u4e4b\u540e\uff0c\u6211\u4eec\u7684\u67e5\u8be2\u5c06\u4f1a\u53d8\u6210\u4e00\u4e2a\u5355\u7ebf\u7a0b\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u67e5\u8be2\u901f\u5ea6\u975e\u5e38\u6162\u3002</p> <p>\u5728 v20.5.2.7-stable \u7248\u672c\u4e2d\uff0c<code>final</code>\u67e5\u8be2\u652f\u6301\u591a\u7ebf\u7a0b\u6267\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7 <code>max_final_threads</code> \u53c2\u6570\u63a7\u5236\u5355\u4e2a\u67e5\u8be2\u7684\u7ebf\u7a0b\u6570\uff0c\u4f46\u662f\u76ee\u524d\u8bfb\u53d6 part \u90e8\u5206\u7684\u52a8\u4f5c\u4f9d\u7136\u662f\u4e32\u884c\u7684\u3002</p> <p><code>final</code> \u67e5\u8be2\u6700\u7ec8\u7684\u6027\u80fd\u8981\u548c\u5f88\u591a\u56e0\u7d20\u76f8\u5173\uff0c\u5217\u5b57\u6bb5\u7684\u5927\u5c0f\u3001\u5206\u533a\u7684\u6570\u91cf\u7b49\u7b49\u90fd\u4f1a\u5f71\u54cd\u5230\u6700\u7ec8\u7684\u67e5\u8be2\u65f6\u95f4\uff0c\u6240\u4ee5\u8fd8\u8981\u7ed3\u5408\u5b9e\u9645\u573a\u666f\u53d6\u820d\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1241","title":"12.4.1 \u666e\u901a\u8bed\u53e5\u67e5\u8be2","text":"<pre><code>explain pipeline select * from datasets.visits_v1 where StartDate = '2014-03-17' limit 100 settings max_threads = 2;\n</code></pre> <p>\u660e\u663e\u5c06\u7531 2 \u4e2a\u7ebf\u7a0b\u5e76\u884c\u8bfb\u53d6 part \u67e5\u8be2\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1242-final","title":"12.4.2 <code>final</code> \u67e5\u8be2","text":"<pre><code>explain pipeline select * from datasets.visits_v1 final where StartDate = '2014-03-17' limit 100 settings max_final_threads = 2;\n</code></pre> <p>\u67e5\u8be2\u901f\u5ea6\u6ca1\u6709\u666e\u901a\u7684\u67e5\u8be2\u5feb\uff0c\u4f46\u662f\u76f8\u6bd4\u4e4b\u524d\u5df2\u7ecf\u6709\u4e86\u4e00\u4e9b\u63d0\u5347\uff0c\u4ece <code>CollapsingSortedTransform</code> \u8fd9\u4e00\u5757\u5f00\u59cb\u5df2\u7ecf\u662f\u591a\u7ebf\u7a0b\u6267\u884c\uff0c\u4f46\u662f\u8bfb\u53d6 part \u90e8\u5206\u7684\u52a8\u4f5c\u8fd8\u662f\u4e32\u884c\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_9","title":"\u5341\u4e09\u3001\u7269\u5316\u89c6\u56fe","text":"<p>ClickHouse \u7684\u7269\u5316\u89c6\u56fe\u662f\u4e00\u79cd\u67e5\u8be2\u7ed3\u679c\u7684\u6301\u4e45\u5316\uff0c\u5b83\u786e\u5b9e\u662f\u7ed9\u6211\u4eec\u5e26\u6765\u4e86\u67e5\u8be2\u6548\u7387\u7684\u63d0\u5347\u3002\u7528\u6237\u67e5\u8d77\u6765\u8ddf\u8868\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u5b83\u5c31\u662f\u4e00\u5f20\u8868\uff0c\u5b83\u4e5f\u50cf\u662f\u4e00\u5f20\u65f6\u65f6\u523b\u523b\u5728\u9884\u8ba1\u7b97\u7684\u8868\u3002</p> <p>\u67e5\u8be2\u7ed3\u679c\u96c6\u7684\u8303\u56f4\u5f88\u5bbd\u6cdb\uff0c\u53ef\u4ee5\u662f\u57fa\u7840\u8868\u4e2d\u90e8\u5206\u6570\u636e\u7684\u4e00\u4efd\u7b80\u5355\u62f7\u8d1d\uff0c\u4e5f\u53ef\u4ee5\u662f\u591a\u8868 <code>join</code> \u4e4b\u540e\u4ea7\u751f\u7684\u7ed3\u679c\u6216\u5b50\u96c6\uff0c\u6216\u8005\u539f\u59cb\u6570\u636e\u7684\u805a\u5408\u6307\u6807\u7b49\u7b49\u3002\u6240\u4ee5\uff0c\u7269\u5316\u89c6\u56fe\u4e0d\u4f1a\u968f\u7740\u57fa\u7840\u8868\u7684\u53d8\u5316\u800c\u53d8\u5316\uff0c\u6240\u4ee5\u5b83\u4e5f\u79f0\u4e3a\u5feb\u7167\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#131","title":"13.1 \u6982\u8ff0","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1311","title":"13.1.1 \u7269\u5316\u89c6\u56fe\u4e0e\u666e\u901a\u89c6\u56fe\u7684\u533a\u522b","text":"<p>\u666e\u901a\u89c6\u56fe\u4e0d\u4fdd\u5b58\u6570\u636e\uff0c\u4fdd\u5b58\u7684\u4ec5\u4ec5\u662f\u4e2a\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u65f6\u5019\u8fd8\u662f\u4ece\u539f\u8868\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u5c06\u666e\u901a\u89c6\u56fe\u7406\u89e3\u4e3a\u662f\u4e2a\u5b50\u67e5\u8be2\u3002\u7269\u5316\u89c6\u56fe\u5219\u662f\u628a\u67e5\u8be2\u7684\u7ed3\u679c\u6839\u636e\u76f8\u5e94\u7684\u5f15\u64ce\u5b58\u5165\u5230\u4e86\u78c1\u76d8\u6216\u5185\u5b58\u4e2d\uff0c\u5bf9\u6570\u636e\u91cd\u65b0\u8fdb\u884c\u4e86\u7ec4\u7ec7\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u7269\u5316\u89c6\u56fe\u662f\u5b8c\u5168\u7684\u4e00\u5f20\u65b0\u8868\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1312","title":"13.1.2 \u4f18\u7f3a\u70b9","text":"<ul> <li> <p>\u4f18\u70b9</p> <p>\u67e5\u8be2\u901f\u5ea6\u5feb\uff0c\u8981\u662f\u628a\u7269\u5316\u89c6\u56fe\u8fd9\u4e9b\u89c4\u5219\u5168\u90e8\u5199\u597d\uff0c\u5b83\u6bd4\u539f\u59cb\u6570\u636e\u67e5\u8be2\u5feb\u4e86\u5f88\u591a\uff0c\u603b\u7684\u884c\u6570\u5c11\u4e86\uff0c\u56e0\u4e3a\u90fd\u9884\u8ba1\u7b97\u597d\u4e86\u3002</p> </li> <li> <p>\u7f3a\u70b9</p> <p>\u5b83\u7684\u672c\u8d28\u662f\u4e00\u4e2a\u6d41\u5f0f\u6570\u636e\u7684\u4f7f\u7528\u573a\u666f\uff0c\u662f\u7d2f\u52a0\u5668\u7684\u6280\u672f\uff0c\u6240\u4ee5\u8981\u7528\u5386\u53f2\u6570\u636e\u505a\u53bb\u91cd\u3001\u53bb\u6838\u8fd9\u6837\u7684\u5206\u6790\uff0c\u5728\u7269\u5316\u89c6\u56fe\u91cc\u9762\u662f\u4e0d\u592a\u597d\u7528\u7684\u3002\u5728\u67d0\u4e9b\u573a\u666f\u7684\u4f7f\u7528\u4e5f\u662f\u6709\u9650\u7684\u3002\u800c\u4e14\u5982\u679c\u4e00\u5f20\u8868\u52a0\u4e86\u597d\u591a\u7269\u5316\u89c6\u56fe\uff0c\u5728\u5199\u8fd9\u5f20\u8868\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u6d88\u8017\u5f88\u591a\u673a\u5668\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u6570\u636e\u5e26\u5bbd\u5360\u6ee1\u3001\u5b58\u50a8\u4e00\u4e0b\u5b50\u589e\u52a0\u4e86\u5f88\u591a\u3002</p> </li> </ul> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#132","title":"13.2 \u6848\u4f8b\u5b9e\u64cd","text":"<p>\u5bf9\u4e8e\u4e00\u4e9b\u786e\u5b9a\u7684\u6570\u636e\u6a21\u578b\uff0c\u53ef\u5c06\u7edf\u8ba1\u6307\u6807\u901a\u8fc7\u7269\u5316\u89c6\u56fe\u7684\u65b9\u5f0f\u8fdb\u884c\u6784\u5efa\uff0c\u8fd9\u6837\u53ef\u907f\u514d\u67e5\u8be2\u65f6\u91cd\u590d\u8ba1\u7b97\u7684\u8fc7\u7a0b\uff0c\u7269\u5316\u89c6\u56fe\u4f1a\u5728\u6709\u65b0\u6570\u636e\u63d2\u5165\u65f6\u8fdb\u884c\u66f4\u65b0\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1321","title":"13.2.1 \u51c6\u5907\u6d4b\u8bd5\u7528\u8868\u548c\u6570\u636e","text":"<ol> <li> <p>\u5efa\u8868</p> <pre><code>create table hits_test (\n    EventDate Date,\n    CounterID UInt32,\n    UserID UInt64,\n    URL String,\n    Income UInt8\n)\nengine = MergeTree()\npartition by toYYYYMM(EventDate)\norder by (CounterID, EventDate, intHash32(UserID))\nsample by intHash32(UserID)\nsettings index_granularity = 8192;\n</code></pre> </li> <li> <p>\u5bfc\u5165\u4e00\u4e9b\u6570\u636e</p> <pre><code>insert into hits_test\nselect EventDate, CounterID, UserID, URL, Income\nfrom datasets.hits_v1\nlimit 10000;\n</code></pre> </li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1323","title":"13.2.3 \u521b\u5efa\u7269\u5316\u89c6\u56fe","text":"<pre><code>create materialized view hits_mv\nengine = SummingMergeTree\npartition by toYYYYMM(EventDate)\norder by (EventDate, intHash32(UserID))\nas\nselect\n    UserID,\n    EventDate,\n    count(URL) as ClickCount,\n    sum(Income) AS IncomeSum\nfrom hits_test\nwhere EventDate &gt;= '2014-03-20'\ngroup by UserID, EventDate;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1324","title":"13.2.4 \u5bfc\u5165\u589e\u91cf\u6570\u636e","text":"<pre><code>insert into hits_test\nselect\n    EventDate,\n    CounterID,\n    UserID,\n    URL,\n    Income\nfrom datasets.hits_v1\nwhere EventDate &gt;= '2014-03-23'\nlimit 10;\n\nselect * from hits_mv;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1325","title":"13.2.5 \u5bfc\u5165\u5386\u53f2\u6570\u636e","text":"<pre><code>insert into hits_mv\nselect\n    UserID,\n    EventDate,\n    count(URL) as ClickCount,\n    sum(Income) AS IncomeSum\nfrom hits_test\nwhere EventDate = '2014-03-20'\ngroup by UserID, EventDate\n\nselect * from hits_mv;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#materializemysql","title":"\u5341\u56db\u3001MaterializeMySQL \u5f15\u64ce","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#141","title":"14.1 \u6982\u8ff0","text":"<p>MySQL \u7684\u7528\u6237\u7fa4\u4f53\u5f88\u5927\uff0c\u4e3a\u4e86\u80fd\u591f\u589e\u5f3a\u6570\u636e\u7684\u5b9e\u65f6\u6027\uff0c\u5f88\u591a\u89e3\u51b3\u65b9\u6848\u4f1a\u5229\u7528 binlog \u5c06\u6570\u636e\u5199\u5165\u5230 ClickHouse\u3002\u4e3a\u4e86\u80fd\u591f\u76d1\u542c binlog \u4e8b\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230\u7c7b\u4f3c Canal \u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u4e2d\u95f4\u4ef6\uff0c\u8fd9\u65e0\u7591\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\u3002</p> <p>ClickHouse v20.8.2.3 \u7248\u672c\u589e\u52a0\u4e86 MaterializeMySQL \u5f15\u64ce\uff0c\u8be5 database \u80fd\u6620\u5c04\u5230 MySQL \u4e2d\u7684\u67d0\u4e2a database\uff0c\u5e76\u81ea\u52a8\u5728 ClickHouse \u4e2d\u521b\u5efa\u5bf9\u5e94\u7684 ReplacingMergeTree\u3002ClickHouse \u670d\u52a1\u4f5c\u4e3a MySQL \u526f\u672c\uff0c\u8bfb\u53d6 binlog \u5e76\u6267\u884c DDL \u548c DML \u8bf7\u6c42\uff0c\u5b9e\u73b0\u4e86\u57fa\u4e8e MySQL binlog \u673a\u5236\u7684\u4e1a\u52a1\u6570\u636e\u5e93\u5b9e\u65f6\u540c\u6b65\u529f\u80fd\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1411","title":"14.1.1 \u7279\u70b9","text":"<ul> <li>MaterializeMySQL \u540c\u65f6\u652f\u6301\u5168\u91cf\u548c\u589e\u91cf\u540c\u6b65\uff0c\u5728 database \u521b\u5efa\u4e4b\u521d\u4f1a\u5168\u91cf\u540c\u6b65 MySQL \u4e2d\u7684\u8868\u548c\u6570\u636e\uff0c\u4e4b\u540e\u5219\u4f1a\u901a\u8fc7 binlog \u8fdb\u884c\u589e\u91cf\u540c\u6b65\u3002</li> <li>MaterializeMySQL database \u4e3a\u5176\u6240\u521b\u5efa\u7684\u6bcf\u5f20 ReplacingMergeTree \u81ea\u52a8\u589e\u52a0\u4e86 <code>_sign</code> \u548c <code>_version</code> \u5b57\u6bb5\u3002\u5176\u4e2d <code>_version</code> \u7528\u4f5c ReplacingMergeTree \u7684 ver \u7248\u672c\u53c2\u6570\uff0c\u6bcf\u5f53\u76d1\u542c\u5230 insert\u3001update\u3001delete \u4e8b\u4ef6\u65f6\uff0c\u5728 database \u5185\u5168\u5c40\u81ea\u589e\u3002\u800c <code>_sign</code>\u5219\u7528\u4e8e\u6807\u8bb0\u662f\u5426\u88ab\u5220\u9664\uff0c\u53d6\u503c 1 \u6216\u8005 -1\u3002</li> </ul>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#142","title":"14.2 \u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1421-mysql-binlog-gtid","title":"14.2.1 MySQL \u5f00\u542f binlog \u548c GTID \u6a21\u5f0f","text":"<pre><code>server-id=1\nlog-bin=mysql-bin\nbinlog_format=row\n\ngtid-mode=on\nenforce-gtid-consistency=1\nlog-slave-updates=1\n</code></pre> <p>\u5982\u679c ClickHouse \u4f7f\u7528\u7684\u662f v20.8 prestable \u4e4b\u540e\u53d1\u5e03\u7684\u7248\u672c\uff0c\u90a3\u4e48 MySQL \u8fd8\u9700\u8981\u914d\u7f6e\u5f00\u542f GTID \u6a21\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728 MySQL \u4e3b\u4ece\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u786e\u4fdd\u6570\u636e\u540c\u6b65\u7684\u4e00\u81f4\u6027\uff08\u4e3b\u4ece\u5207\u6362\u65f6\uff09\u3002</p> <p>GTID \u662f MySQL \u590d\u5236\u589e\u5f3a\u7248\uff0c\u4ece MySQL 5.7 \u7248\u672c\u5f00\u59cb\u652f\u6301\uff0c\u76ee\u524d\u5df2\u7ecf\u662f MySQL \u4e3b\u6d41\u590d\u5236\u6a21\u5f0f\u3002\u5b83\u4e3a\u6bcf\u4e2a Event \u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00 ID \u548c\u5e8f\u53f7\uff0c\u6211\u4e48\u53ef\u4ee5\u4e0d\u7528\u5173\u5fc3 MySQL \u96c6\u7fa4\u4e3b\u4ece\u62d3\u6251\u7ed3\u6784\uff0c\u76f4\u63a5\u544a\u77e5 MySQL \u8fd9\u4e2a GTID \u5373\u53ef\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1422-mysql","title":"14.2.2 \u51c6\u5907 MySQL \u8868\u548c\u6570\u636e","text":"<ol> <li> <p>\u5728 MySQL \u4e2d\u521b\u5efa\u6570\u636e\u8868\u5e76\u5199\u5165\u6570\u636e</p> <pre><code>create database testck;\n\ncreate table testck.t_organization (\n    id         int  not null auto_increment,\n    code       int  not null,\n    name       text,\n    updatetime datetime,\n    primary key (id),\n    unique key (code)\n)\nengine = InnoDB;\n\ninsert into testck.t_organization (code, name, updatetime) values (1000, 'Realinsight',now());\ninsert into testck.t_organization (code, name, updatetime) values (1001, 'Realindex',  now());\ninsert into testck.t_organization (code, name, updatetime) values (1002, 'EDT',        now());\n</code></pre> </li> <li> <p>\u521b\u5efa\u7b2c\u4e8c\u5f20\u8868</p> <pre><code>create table testck.t_user (\n    id   int not null auto_increment,\n    code int,\n    primary key (id)\n)\nengine = InnoDB;\n\ninsert into testck.t_user (code) values (1);\n</code></pre> </li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1423-clickhouse","title":"14.2.3 \u5f00\u542f ClickHouse \u7269\u5316\u5f15\u64ce","text":"<pre><code>set allow_experimental_database_materialized_mysql = 1;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1424","title":"14.2.4 \u521b\u5efa\u590d\u5236\u7ba1\u9053","text":"<pre><code>create database test_binlog engine = MaterializeMySQL('192.168.8.101:3306','testck','root','root');\n\nuse test_binlog;\n\nshow tables;\n\nselect * from test_binlog.t_user;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1425","title":"14.2.5 \u4fee\u6539\u6570\u636e","text":"<ol> <li>\u5728 MySQL \u4e2d\u4fee\u6539\u6570\u636e</li> </ol> <pre><code>update testck.t_organization set name = concat(name, '-v1') where id = 1;\n</code></pre> <ol> <li>\u5728 ClickHouse \u4e2d\u67e5\u770b\u6570\u636e</li> </ol> <pre><code>select * from test_binlog.t_organization;\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1426","title":"14.2.6 \u5220\u9664\u6570\u636e","text":"<ol> <li> <p>MySQL \u5220\u9664\u6570\u636e</p> <pre><code>delete from testck.t_organization where id = 2;\n</code></pre> </li> <li> <p>\u5728 ClickHouse \u4e2d\u67e5\u770b\u6570\u636e</p> <pre><code>select *, _sign, _version from test_binlog.t_organization order by _sign desc, _version desc;\n</code></pre> <p>\u5728\u67e5\u8be2\u65f6\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u88ab\u5220\u9664\u7684\u6570\u636e\uff0c<code>_sign = -1</code>\uff0cClickHouse \u4f1a\u81ea\u52a8\u91cd\u5199 SQL\uff0c\u5c06 <code>_sign = -1</code> \u7684\u6570\u636e\u8fc7\u6ee4\u6389\u3002</p> </li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1427","title":"14.2.7 \u5220\u9664\u8868","text":"<p>\u5728 MySQL \u6267\u884c\u5220\u9664\u8868\u64cd\u4f5c\uff0c\u6b64\u65f6\u5728 ClickHouse \u5904\u4f1a\u540c\u6b65\u5220\u9664\u5bf9\u5e94\u8868\uff0c\u5982\u679c\u67e5\u8be2\u4f1a\u62a5\u9519\uff0cMySQL \u65b0\u5efa\u8868\uff0cClickHouse \u53ef\u4ee5\u67e5\u8be2\u5230\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_10","title":"\u5341\u4e94\u3001\u5e38\u89c1\u95ee\u9898\u6392\u67e5","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#151-ddl","title":"15.1 \u5206\u5e03\u5f0f DDL \u67d0\u6570\u636e\u8282\u70b9\u7684\u526f\u672c\u4e0d\u6267\u884c","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1511","title":"15.1.1 \u95ee\u9898","text":"<p>\u4f7f\u7528\u5206\u5e03\u5f0f DDL \u6267\u884c\u547d\u4ee4 <code>create table on cluster xxx</code> \u67d0\u4e2a\u8282\u70b9\u4e0a\u6ca1\u6709\u521b\u5efa\u8868\uff0c\u4f46\u662f client \u8fd4\u56de\u6b63\u5e38\uff0c\u67e5\u770b\u65e5\u5fd7\u6709\u5982\u4e0b\u62a5\u9519\uff1a</p> <pre><code>&lt;Error&gt; xxx.xxx: Retrying createReplica(), because some other replicas\nwere created at the same time\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1512","title":"15.1.2 \u89e3\u51b3\u529e\u6cd5","text":"<p>\u91cd\u542f\u8be5\u90e8\u6267\u884c\u7684\u8282\u70b9\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#152","title":"15.2 \u6570\u636e\u526f\u672c\u8868\u548c\u6570\u636e\u6570\u636e\u4e0d\u4e00\u81f4","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1521","title":"15.2.1 \u95ee\u9898","text":"<p>\u7531\u4e8e\u67d0\u4e2a\u6570\u636e\u8282\u70b9\u526f\u672c\u5f02\u5e38\uff0c\u5bfc\u81f4\u4e24\u6570\u636e\u526f\u672c\u8868\u4e0d\u4e00\u81f4\uff0c\u67d0\u4e2a\u6570\u636e\u526f\u672c\u7f3a\u5c11\u8868\uff0c\u9700\u8981\u5c06\u4e24\u4e2a\u6570\u636e\u526f\u672c\u8c03\u6574\u4e00\u81f4\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1522","title":"15.2.2 \u89e3\u51b3\u529e\u6cd5","text":"<p>\u5728\u7f3a\u5c11\u8868\u7684\u6570\u636e\u526f\u672c\u4e0a\u521b\u5efa\u7f3a\u5c11\u7684\u8868\uff0c\u521b\u5efa\u4e3a\u672c\u5730\u8868\uff0c\u8868\u7ed3\u6784\u53ef\u4ee5\u5728\u5176\u5b83\u6570\u636e\u526f\u672c\u901a\u8fc7 <code>create table on cluster</code> \u83b7\u53d6\u3002\u8868\u7ed3\u6784\u521b\u5efa\u540e\uff0cClickHouse \u4f1a\u81ea\u52a8\u4ece\u5176\u5b83\u526f\u672c\u540c\u6b65\u8be5\u8868\u6570\u636e\uff0c\u9a8c\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u5373\u53ef\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#153","title":"15.3 \u526f\u672c\u8282\u70b9\u5168\u91cf\u6062\u590d","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1531","title":"15.3.1 \u95ee\u9898","text":"<p>\u67d0\u4e2a\u6570\u636e\u526f\u672c\u5f02\u5e38\u65e0\u6cd5\u542f\u52a8\uff0c\u9700\u8981\u91cd\u65b0\u642d\u5efa\u526f\u672c\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1532","title":"15.3.2 \u89e3\u51b3\u529e\u6cd5","text":"<ol> <li>\u6e05\u7a7a\u5f02\u5e38\u526f\u672c\u8282\u70b9\u7684 <code>metadata</code> \u548c <code>data</code> \u76ee\u5f55\u3002</li> <li>\u4ece\u53e6\u4e00\u4e2a\u6b63\u5e38\u526f\u672c\u5c06 <code>metadata</code> \u76ee\u5f55\u62f7\u8d1d\u8fc7\u6765\uff08\u8fd9\u4e00\u6b65\u4e4b\u540e\u53ef\u4ee5\u91cd\u542f\u6570\u636e\u5e93\uff0c\u4f46\u662f\u53ea\u6709\u8868\u7ed3\u6784\u6ca1\u6709\u6570\u636e\uff09\u3002</li> <li>\u6267\u884c <code>sudo -u clickhouse touch /data/clickhouse/flags/force_restore_data</code>\u3002</li> <li>\u542f\u52a8\u6570\u636e\u5e93\u3002</li> </ol>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#154-zk","title":"15.4 \u6570\u636e\u526f\u672c\u542f\u52a8\u7f3a\u5c11 ZK \u8868","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1541","title":"15.4.1 \u95ee\u9898","text":"<p>\u67d0\u4e2a\u6570\u636e\u526f\u672c\u5728 ZK \u4e0a\u4e22\u5931\u6570\u636e\uff0c\u6216\u8005\u4e0d\u5b58\u5728\uff0c\u4f46\u662f <code>metadata</code> \u5143\u6570\u636e\u91cc\u5b58\u5728\uff0c\u5bfc\u81f4\u542f\u52a8\u5f02\u5e38\uff0c\u62a5\u9519\uff1a</p> <pre><code>Can\u2019t get data for node /clickhouse/tables/01-\n02/xxxxx/xxxxxxx/replicas/xxx/metadata: node doesn\u2019t exist (No node):\nCannot attach table xxxxxxx\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1542","title":"15.4.2 \u89e3\u51b3\u529e\u6cd5","text":"<ol> <li> <p><code>metadata</code>\u4e2d\u79fb\u9664\u8be5\u8868\u7684\u7ed3\u6784\u6587\u4ef6\uff0c\u5982\u679c\u591a\u4e2a\u8868\u62a5\u9519\u5c31\u90fd\u79fb\u9664\uff1a</p> <pre><code>mv metadata/xxxxxx/xxxxxx.sql /tmp\n</code></pre> </li> <li> <p>\u542f\u52a8\u6570\u636e\u5e93\u3002</p> </li> <li> <p>\u624b\u52a8\u521b\u5efa\u7f3a\u5c11\u7684\u8868\uff0c\u8868\u7ed3\u6784\u4ece\u5176\u5b83\u8282\u70b9 <code>show create table</code> \u83b7\u53d6\u3002</p> </li> <li> <p>\u521b\u5efa\u540e\u81ea\u52a8\u540c\u6b65\u6570\u636e\uff0c\u9a8c\u8bc1\u6570\u636e\u662f\u5426\u4e00\u81f4\u3002</p> </li> </ol> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#155-zk-table-replicas","title":"15.5 ZK table replicas \u6570\u636e\u672a\u5220\u9664\uff0c\u5bfc\u81f4\u91cd\u5efa\u8868\u9519\u8bef","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1551","title":"15.5.1 \u95ee\u9898","text":"<p>\u91cd\u5efa\u8868\u8fc7\u7a0b\u4e2d\uff0c\u5148\u8bd5\u7528 <code>drop table xxx on cluster xxx</code>\uff0c\u5404\u8282\u70b9\u5728 ClickHouse \u4e0a table \u5df2\u7269\u7406\u5220\u9664\uff0c\u4f46\u662f ZK \u91cc\u9762\u9488\u5bf9\u67d0\u4e2a ClickHouse \u8282\u70b9\u7684 table meta \u4fe1\u606f\u672a\u88ab\u5220\u9664\uff08\u4f4e\u6982\u7387\u4e8b\u4ef6\uff09\uff0c\u56e0 ZK \u91cc\u4ecd\u5b58\u6709\u8868\u7684 meta \u4fe1\u606f\uff0c\u5bfc\u81f4\u518d\u6b21\u521b\u5efa\u8be5\u8868 <code>create table xxx on cluster xxx</code>\uff0c\u8be5\u8282\u70b9\u65e0\u6cd5\u521b\u5efa\u8868\uff08\u5176\u4ed6\u8282\u70b9\u521b\u5efa\u8868\u6210\u529f\uff09\uff0c\u62a5\u9519\uff1a</p> <pre><code>Replica /clickhouse/tables/01-03/xxxxxx/xxx/replicas/xxx already exists..\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1552","title":"15.5.2 \u89e3\u51b3\u529e\u6cd5","text":"<p>\u4ece\u5176\u4ed6\u6570\u636e\u526f\u672c CP \u8be5 table \u7684 metadata sql \u8fc7\u6765\u3002\u91cd\u542f\u8282\u70b9\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#156-clickhouse","title":"15.6 ClickHouse \u8282\u70b9\u610f\u5916\u5173\u95ed","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1561","title":"15.6.1 \u95ee\u9898","text":"<p>\u6a21\u62df\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u610f\u5916\u5b95\u673a\uff0c\u5728\u5927\u91cf <code>insert</code> \u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u5173\u95ed\u67d0\u4e2a\u8282\u70b9\u3002\u6570\u636e\u5199\u5165\u4e0d\u53d7\u5f71\u54cd\u3001\u6570\u636e\u67e5\u8be2\u53d7\u5f71\u54cd\u3001\u5efa\u8868 DDL \u6267\u884c\u5230\u5f02\u5e38\u8282\u70b9\u4f1a\u5361\u4f4f\uff0c\u62a5\u9519\uff1a</p> <pre><code>Code: 159. DB::Exception: Received from localhost:9000. DB::Exception:\nWatching task /clickhouse/task_queue/ddl/query-0000565925 is executing\nlonger than distributed_ddl_task_timeout (=180) seconds. There are 1\nunfinished hosts (0 of them are currently active), they are going to\nexecute the query in background.\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1562","title":"15.6.2 \u89e3\u51b3\u529e\u6cd5","text":"<p>\u542f\u52a8\u5f02\u5e38\u53ca\u8bf6\u6253\u4f60\uff0c\u671f\u95f4\u5176\u4ed6\u526f\u672c\u5199\u5165\u6570\u636e\u4f1a\u81ea\u52a8\u540c\u6b65\u8fc7\u6765\uff0c\u5176\u4ed6\u526f\u672c\u7684\u5efa\u8868 DDL \u4e5f\u4f1a\u540c\u6b65\u3002</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#157","title":"15.7 \u5176\u4ed6\u95ee\u9898\u53c2\u8003","text":"<p>\u9996\u9875/\u4e91\u6570\u636e\u5e93 ClickHouse/\u5e38\u89c1\u95ee\u9898</p> <p></p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#_11","title":"\u5341\u516d\u3001\u5907\u4efd\u53ca\u6062\u590d","text":""},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#161","title":"16.1 \u624b\u52a8\u5b9e\u73b0\u5907\u4efd\u53ca\u6062\u590d","text":"<p>ClickHouse \u5141\u8bb8\u4f7f\u7528 <code>alter table ... freeze partition ...</code> \u67e5\u8be2\u4ee5\u521b\u5efa\u5206\u533a\u7684\u672c\u5730\u526f\u672c\u3002\u8fd9\u662f\u5229\u7528\u786c\u94fe\u63a5\u5230 <code>/var/lib/clickhouse/shadow</code> \u6587\u4ef6\u5939\u4e2d\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u5b83\u901a\u5e38\u4e0d\u4f1a\u56e0\u4e3a\u65e7\u6570\u636e\u800c\u5360\u7528\u989d\u5916\u7684\u78c1\u76d8\u7a7a\u95f4\u3002\u521b\u5efa\u7684\u6587\u4ef6\u526f\u672c\u4e0d\u7531 ClickHouse \u670d\u52a1\u5668\u5904\u7406\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4efb\u4f55\u989d\u5916\u7684\u5916\u90e8\u7cfb\u7edf\u5c31\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u5907\u4efd\u3002\u9632\u6b62\u786c\u4ef6\u95ee\u9898\uff0c\u6700\u597d\u5c06\u5b83\u4eec\u8fdc\u7a0b\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u7136\u540e\u5220\u9664\u672c\u5730\u526f\u672c\u3002</p>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1511_1","title":"15.1.1 \u521b\u5efa\u5907\u4efd\u8def\u5f84","text":"<pre><code>sudo mkdir -p /var/lib/clickhouse/shadow\nsudo chown -R clickhouse:clickhouse /var/lib/clickhouse/shadow\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1512_1","title":"15.1.2 \u6267\u884c\u5907\u4efd\u547d\u4ee4","text":"<pre><code>echo -n 'alter table t_order_mt freeze' | clickhouse-client\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1513","title":"15.1.3 \u5c06\u5907\u4efd\u6570\u636e\u4fdd\u5b58\u5230\u5176\u4ed6\u8def\u5f84","text":"<pre><code>sudo mkdir -p /var/lib/clickhouse/backup\n\nsudo cp -r /var/lib/clickhouse/shadow /var/lib/clickhouse/backup/my-backup-name\n\nsudo rm -rf /var/lib/clickhouse/shadow/*\n</code></pre>"},{"location":"bigdata/clickhouse/ClickHouse%20%E7%AC%94%E8%AE%B0/#1514","title":"15.1.4 \u6062\u590d\u6570\u636e","text":"<ol> <li> <p>\u6a21\u62df\u5220\u9664\u5907\u4efd\u8fc7\u7684\u8868</p> <pre><code>echo -n 'drop table t_order_mt' | clickhouse-client\n</code></pre> </li> <li> <p>\u91cd\u65b0\u91cd\u5efa\u8868</p> </li> <li> <p>\u5c06\u5907\u4efd\u590d\u5236\u5230 <code>detached</code> \u76ee\u5f55</p> <pre><code>sudo cp -rl /var/lib/clickhouse/backup/my-backup-name/1/store/7a4/7a45b5db-1a1a-4b2a-b4d1-9663d634a45b/* /var/lib/clickhouse/data/default/t_order_mt/detached\n\nsudo chown -R /var/lib/clickhouse/data/default/t_order_mt/detached/*\n</code></pre> <p>ClickHouse \u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u786c\u94fe\u63a5\u6765\u5b9e\u73b0\u5373\u65f6\u5907\u4efd\uff0c\u800c\u4e0d\u4f1a\u5bfc\u81f4 ClickHouse \u670d\u52a1\u505c\u673a\uff08\u6216\u9501\u5b9a\uff09\u3002\u8fd9\u4e9b\u786c\u94fe\u63a5\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7528\u4e8e\u6709\u6548\u7684\u5907\u4efd\u5b58\u50a8\u3002\u5728\u652f\u6301\u786c\u94fe\u63a5\u7684\u6587\u4ef6\u7cfb\u7edf\uff08\u4f8b\u5982\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u6216 NFS\uff09\u4e0a\uff0c\u5c06 <code>cp</code> \u4e0e <code>-l</code> \u6807\u5fd7\u4e00\u8d77\u4f7f\u7528\uff08\u6216\u5c06 <code>rsync</code> \u4e0e <code>--hard-links</code> \u548c <code>--numeric-ids</code>\u6807\u5fd7\u4e00\u8d77\u4f7f\u7528\uff09\u4ee5\u907f\u514d\u590d\u5236\u6570\u636e\u3002</p> </li> <li> <p>\u6267\u884c <code>attach</code></p> <pre><code>echo -n 'alter table t_order_mt attach partition 20200601' | clickhouse-client\n</code></pre> </li> <li> <p>\u67e5\u770b\u6570\u636e</p> <pre><code>echo -n 'select count(*) from t_order_mt' | clickhouse-client\n</code></pre> </li> </ol>"},{"location":"bigdata/datax/","title":"DataX","text":""},{"location":"bigdata/datax/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"bigdata/datax/#python2-python3","title":"Python2 \u8f6c Python3","text":"<ul> <li> <p>Ubuntu</p> <pre><code>apt install 2to3\n\n2to3 -w /opt/module/datax/bin\n</code></pre> </li> <li> <p>Windows</p> <pre><code>python /d/env/python-3.10.2/Tools/scripts/2to3.py -w /d/env/datax/bin\n</code></pre> </li> </ul>"},{"location":"bigdata/datax/#_2","title":"\u6267\u884c\u4efb\u52a1","text":"<ul> <li> <p><code>PostgreSQLReader.json</code></p> <pre><code>{\n  \"job\": {\n    \"setting\": {\n      \"speed\": {\n        \"byte\": 1048576\n      }\n    },\n    \"content\": [\n      {\n        \"reader\": {\n          \"name\": \"postgresqlreader\",\n          \"parameter\": {\n            \"connection\": [\n              {\n                \"jdbcUrl\": [\"jdbc:postgresql://192.192.192.101:17700/demo\"],\n                \"table\": [\"t_user\"]\n              }\n            ],\n            \"username\": \"demo\",\n            \"password\": \"demo\",\n            \"column\": [\"id\", \"username\", \"age\"]\n          }\n        },\n        \"writer\": {\n          \"name\": \"streamwriter\",\n          \"parameter\": {\n            \"print\": true\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre> </li> <li> <p><code>PostgreSQLWriter.json</code></p> <pre><code>{\n  \"job\": {\n    \"setting\": {\n      \"speed\": {\n        \"channel\": 1\n      }\n    },\n    \"content\": [\n      {\n        \"reader\": {\n          \"name\": \"streamreader\",\n          \"parameter\": {\n            \"column\": [\n              { \"type\": \"Long\", \"value\": 2 },\n              { \"type\": \"String\", \"value\": \"mm\" },\n              { \"type\": \"Long\", \"value\": 23 }\n            ],\n            \"sliceRecordCount\": 1\n          }\n        },\n        \"writer\": {\n          \"name\": \"postgresqlwriter\",\n          \"parameter\": {\n            \"connection\": [\n              {\n                \"jdbcUrl\": \"jdbc:postgresql://192.192.192.101:17700/demo\",\n                \"table\": [\"t_user\"]\n              }\n            ],\n            \"username\": \"demo\",\n            \"password\": \"demo\",\n            \"column\": [\"id\", \"username\", \"age\"]\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre> </li> </ul> <pre><code>python /opt/module/datax/bin/datax.py ~/PostgreSQLReader.json\n</code></pre>"},{"location":"bigdata/datax/#_3","title":"\u63d2\u4ef6\u5f00\u53d1","text":""},{"location":"bigdata/datax/#_4","title":"\u6253\u5305","text":"<ul> <li> <p>\u6253\u5305</p> <pre><code>mvn clean package -DskipTests assembly:assembly\n</code></pre> </li> <li> <p>\u53ea\u6253\u5305\u6307\u5b9a\u63d2\u4ef6</p> <pre><code>mvn clean package assembly:assembly -U -T 1C -Dmaven.test.skip=true -Dmaven.compile.fork=true -pl postgresqlwriter -am\n</code></pre> </li> </ul>"},{"location":"bigdata/doris/","title":"Doris","text":""},{"location":"bigdata/doris/#_1","title":"\u6280\u672f\u6982\u8ff0","text":"<p>Doris \u6574\u4f53\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff0cDoris \u67b6\u6784\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u6709\u4e24\u7c7b\u8fdb\u7a0b</p> <ul> <li> <p>Frontend\uff08FE\uff09\uff0c\u4e3b\u8981\u8d1f\u8d23\u7528\u6237\u8bf7\u6c42\u7684\u63a5\u5165\u3001\u67e5\u8be2\u89e3\u6790\u89c4\u5212\u3001\u5143\u6570\u636e\u7684\u7ba1\u7406\u3001\u8282\u70b9\u7ba1\u7406\u76f8\u5173\u5de5\u4f5c\u3002</p> </li> <li> <p>Backend\uff08BE\uff09\uff0c\u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u5b58\u50a8\u3001\u67e5\u8be2\u8ba1\u5212\u7684\u6267\u884c\u3002</p> </li> </ul> <p>\u8fd9\u4e24\u7c7b\u8fdb\u7a0b\u90fd\u662f\u53ef\u4ee5\u6a2a\u5411\u6269\u5c55\u7684\uff0c\u5355\u96c6\u7fa4\u53ef\u4ee5\u652f\u6301\u5230\u6570\u767e\u53f0\u673a\u5668\uff0c\u6570\u5341 PB \u7684\u5b58\u50a8\u5bb9\u91cf\u3002\u5e76\u4e14\u8fd9\u4e24\u7c7b\u8fdb\u7a0b\u901a\u8fc7\u4e00\u81f4\u6027\u534f\u8bae\u6765\u4fdd\u8bc1\u670d\u52a1\u7684\u9ad8\u53ef\u7528\u548c\u6570\u636e\u7684\u9ad8\u53ef\u9760\u3002\u8fd9\u79cd\u9ad8\u5ea6\u96c6\u6210\u7684\u67b6\u6784\u8bbe\u8ba1\u6781\u5927\u7684\u964d\u4f4e\u4e86\u4e00\u6b3e\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u8fd0\u7ef4\u6210\u672c\u3002</p> <p>\u5728\u4f7f\u7528\u63a5\u53e3\u65b9\u9762\uff0cDoris \u91c7\u7528 MySQL \u534f\u8bae\uff0c\u9ad8\u5ea6\u517c\u5bb9 MySQL \u8bed\u6cd5\uff0c\u652f\u6301\u6807\u51c6 SQL\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5404\u7c7b\u5ba2\u6237\u7aef\u5de5\u5177\u6765\u8bbf\u95ee Doris\uff0c\u5e76\u652f\u6301\u4e0e BI \u5de5\u5177\u7684\u65e0\u7f1d\u5bf9\u63a5\u3002</p> <p>\u5728\u5b58\u50a8\u5f15\u64ce\u65b9\u9762\uff0cDoris \u91c7\u7528\u5217\u5f0f\u5b58\u50a8\uff0c\u6309\u5217\u8fdb\u884c\u6570\u636e\u7684\u7f16\u7801\u538b\u7f29\u548c\u8bfb\u53d6\uff0c\u80fd\u591f\u5b9e\u73b0\u6781\u9ad8\u7684\u538b\u7f29\u6bd4\uff0c\u540c\u65f6\u51cf\u5c11\u5927\u91cf\u975e\u76f8\u5173\u6570\u636e\u7684\u626b\u63cf\uff0c\u4ece\u800c\u66f4\u52a0\u6709\u6548\u5229\u7528 IO \u548c CPU \u8d44\u6e90\u3002</p> <p></p> <p>\u5728\u67e5\u8be2\u5f15\u64ce\u65b9\u9762\uff0cDoris \u91c7\u7528 MPP \u7684\u6a21\u578b\uff0c\u8282\u70b9\u95f4\u548c\u8282\u70b9\u5185\u90fd\u5e76\u884c\u6267\u884c\uff0c\u4e5f\u652f\u6301\u591a\u4e2a\u5927\u8868\u7684\u5206\u5e03\u5f0f Shuffle Join\uff0c\u4ece\u800c\u80fd\u591f\u66f4\u597d\u5e94\u5bf9\u590d\u6742\u67e5\u8be2\u3002</p> <p></p> <p>Doris \u67e5\u8be2\u5f15\u64ce\u662f\u5411\u91cf\u5316\u7684\u67e5\u8be2\u5f15\u64ce\uff0c\u6240\u6709\u7684\u5185\u5b58\u7ed3\u6784\u80fd\u591f\u6309\u7167\u5217\u5f0f\u5e03\u5c40\uff0c\u80fd\u591f\u8fbe\u5230\u5927\u5e45\u51cf\u5c11\u865a\u51fd\u6570\u8c03\u7528\u3001\u63d0\u5347 Cache \u547d\u4e2d\u7387\uff0c\u9ad8\u6548\u5229\u7528 SIMD \u6307\u4ee4\u7684\u6548\u679c\u3002\u5728\u5bbd\u8868\u805a\u5408\u573a\u666f\u4e0b\u6027\u80fd\u662f\u975e\u5411\u91cf\u5316\u5f15\u64ce\u7684 5-10 \u500d\u3002</p> <p></p>"},{"location":"bigdata/flink/","title":"Flink","text":""},{"location":"bigdata/flink/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"bigdata/flink/#no-executorfactory-found-to-execute-the-application","title":"No ExecutorFactory found to execute the application","text":"<p>\u53c2\u8003\uff1aFlink \u89e3\u51b3 No ExecutorFactory found to execute the application</p> <pre><code>implementation 'org.apache.flink:flink-clients_2.12:1.14.1'\n</code></pre>"},{"location":"bigdata/flink/Flink%20on%20Kubernetes/","title":"Flink on Kubernetes","text":""},{"location":"bigdata/flink/Flink%20on%20Kubernetes/#native-kubernetes","title":"Native Kubernetes","text":""},{"location":"bigdata/flink/Flink%20on%20Kubernetes/#rbac","title":"RBAC","text":"<pre><code>kubectl create namespace flink\nkubectl --namespace flink create serviceaccount flink\nkubectl create clusterrolebinding flink-role --clusterrole=edit --serviceaccount=flink:flink\n</code></pre>"},{"location":"bigdata/flink/Flink%20on%20Kubernetes/#session","title":"Session \u6a21\u5f0f","text":"<pre><code># \u542f\u52a8\u96c6\u7fa4\nbin/kubernetes-session.sh \\\n    -Dkubernetes.cluster-id=flink-session-cluster \\\n    -Dkubernetes.namespace=flink \\\n    -Dkubernetes.service-account=flink\n\n# \u63d0\u4ea4\u4efb\u52a1\nbin/flink run \\\n    --target kubernetes-session \\\n    -Dkubernetes.cluster-id=flink-session-cluster \\\n    -Dkubernetes.namespace=flink \\\n    -Dkubernetes.service-account=flink \\\n    examples/streaming/TopSpeedWindowing.jar\n\n# \u5220\u9664\u96c6\u7fa4\nkubectl --namespace flink delete deployment/flink-session-cluster\n</code></pre>"},{"location":"bigdata/flink/Flink%20on%20Kubernetes/#application","title":"Application \u6a21\u5f0f","text":"<pre><code># \u63d0\u4ea4\u4efb\u52a1\nFLINK_VERSION=\"1.16.0\"\nbin/flink run-application \\\n    --target kubernetes-application \\\n    -Dkubernetes.cluster-id=flink-application-cluster \\\n    -Dkubernetes.namespace=flink \\\n    -Dkubernetes.service-account=flink \\\n    -Dkubernetes.container.image.ref=flink:${FLINK_VERSION}-scala_2.12 \\\n    local:////opt/flink/examples/streaming/TopSpeedWindowing.jar\n\n### \u5217\u51fa\u4efb\u52a1\nbin/flink list \\\n    --target kubernetes-application \\\n    -Dkubernetes.cluster-id=flink-application-cluster \\\n    -Dkubernetes.namespace=flink \\\n    -Dkubernetes.service-account=flink\n\n### \u53d6\u6d88\u4efb\u52a1\nbin/flink cancel \\\n    --target kubernetes-application \\\n    -Dkubernetes.cluster-id=flink-application-cluster \\\n    -Dkubernetes.namespace=flink \\\n    -Dkubernetes.service-account=flink \\\n    &lt;JOB_ID&gt;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/","title":"Flink CDC","text":""},{"location":"bigdata/flink/flink-cdc/#mysql-cdc","title":"\u4e00\u3001MySQL CDC","text":""},{"location":"bigdata/flink/flink-cdc/#11","title":"1.1 \u5efa\u5e93\u5efa\u8868","text":"<pre><code>create database demo;\n\ncreate table demo.t_product (\n    id    bigint,\n    dt    datetime,\n    name  varchar(64),\n    price decimal(38,2),\n    primary key(id)\n);\n\ninsert into demo.t_product values\n    (1, current_timestamp, 'A', 99.99),\n    (2, current_timestamp, 'B', 88.88);\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#12-cdc","title":"1.2 \u542f\u7528 CDC","text":"<pre><code>show variables like '%log_bin%';\nshow variables like '%binlog_format%';\nshow variables like '%server_id%';\n</code></pre> <pre><code>create user 'cdc_readonly'@'%' identified by 'cdc_readonly';\ngrant select, replication slave, replication client on *.* to 'cdc_readonly'@'%';\nflush privileges;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#13-flink-sql-connector-mysql-cdc","title":"1.3 <code>flink-sql-connector-mysql-cdc</code>","text":"<pre><code>create table t_product_source (\n    database_name  string           metadata from 'database_name' virtual,\n    table_name     string           metadata from 'table_name'    virtual,\n    op_ts          timestamp_ltz(3) metadata from 'op_ts'         virtual,\n    id    bigint,\n    dt    timestamp(0),\n    name  string,\n    price decimal(38,2),\n    primary key(id) not enforced\n) with (\n    'connector'     = 'mysql-cdc',\n    'hostname'      = '192.168.8.101',\n    'port'          = '3306',\n    'username'      = 'cdc_readonly',\n    'password'      = 'cdc_readonly',\n    'database-name' = 'demo',\n    'table-name'    = 't_product',\n    'server-time-zone' = 'Asia/Shanghai',\n    'scan.startup.mode' = 'initial'\n);\n\nset 'sql-client.execution.result-mode' = 'tableau';\n\nselect * from t_product_source;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#postgresql-cdc","title":"\u4e8c\u3001PostgreSQL CDC","text":"<ol> <li> <p>\u5efa\u5e93\u5efa\u8868</p> <pre><code>create database demo;\n</code></pre> <pre><code>create table public.t_product (\n    id    int8,\n    dt    timestamp(0),\n    name  varchar(64),\n    price numeric(38,2),\n    primary key(id)\n);\n\ninsert into public.t_product values\n    (1, current_timestamp, 'A', 99.99),\n    (2, current_timestamp, 'B', 88.88);\n</code></pre> </li> </ol>"},{"location":"bigdata/flink/flink-cdc/#22-cdc","title":"2.2 \u542f\u7528 CDC","text":"<pre><code>-- \u67e5\u770b WAL \u7ea7\u522b\nshow wal_level;\n-- \u4fee\u6539 WAL \u7ea7\u522b\nalter system set wal_level = 'logical';\n-- \u91cd\u542f\n</code></pre> <pre><code>-- \u67e5\u770b\u590d\u5236\u69fd\nselect * from pg_replication_slots;\n-- \u5220\u9664\u590d\u5236\u69fd\nselect pg_drop_replication_slot('t_product');\n</code></pre> <pre><code>-- \u65b0\u5efa\u5177\u5907 login \u548c replication \u6743\u9650\u7684\u89d2\u8272\ncreate role cdc_readonly with login replication password 'cdc_readonly';\n\n-- \u6388\u6743\u5df2\u6709\u7684\u89d2\u8272 login \u548c replication \u6743\u9650\n-- alter role cdc_readonly login replication;\n\n-- \u6388\u6743\u6a21\u5f0f usage \u6743\u9650\ngrant usage on schema public to cdc_readonly;\n\n-- \u6388\u6743\u8868 select \u6743\u9650\ngrant select on table public.t_product to cdc_readonly;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#23-flink-sql-connector-postgres-cdc","title":"2.3 <code>flink-sql-connector-postgres-cdc</code>","text":"<pre><code>set execution.checkpointing.interval = 3s;\nset sql-client.execution.result-mode = tableau;\n\ncreate table t_product_source (\n    database_name  string           metadata from 'database_name' virtual,\n    schema_name    string           metadata from 'schema_name'   virtual,\n    table_name     string           metadata from 'table_name'    virtual,\n    op_ts          timestamp_ltz(3) metadata from 'op_ts'         virtual,\n    id    bigint,\n    dt    timestamp(0),\n    name  string,\n    price decimal(38,2),\n    primary key(id) not enforced\n) with (\n    'connector'     = 'postgres-cdc',\n    'hostname'      = '192.168.31.101',\n    'port'          = '5432',\n    'username'      = 'cdc_readonly',\n    'password'      = 'cdc_readonly',\n    'database-name' = 'demo',\n    'schema-name'   = 'public',\n    'table-name'    = 't_product',\n    'slot.name' = 't_product',\n    'decoding.plugin.name' = 'pgoutput',\n    'scan.incremental.snapshot.enabled' = 'true',\n    'scan.startup.mode' = 'initial'\n);\n\nselect * from t_product_source;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#sqlserver-cdc","title":"\u4e09\u3001SQLServer CDC","text":"<ul> <li>https://github.com/apache/flink-cdc/blob/master/docs/content/docs/connectors/cdc-connectors/sqlserver-cdc.md</li> <li>https://learn.microsoft.com/zh-cn/sql/linux/sql-server-linux-configure-environment-variables</li> </ul>"},{"location":"bigdata/flink/flink-cdc/#31","title":"3.1 \u5efa\u5e93\u5efa\u8868","text":"<pre><code>create database demo;\n\nuse demo;\n\ncreate table dbo.t_product (\n    id    bigint,\n    dt    datetime2,\n    name  varchar(64),\n    price decimal(38,2),\n    primary key(id)\n);\n\ninsert into dbo.t_product values\n    (1, current_timestamp, 'A', 99.99),\n    (2, current_timestamp, 'B', 88.88);\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#32-cdc","title":"3.2 \u542f\u7528 CDC","text":"<p>\u542f\u7528\u6210\u529f\u540e\uff0c\u4f1a\u5728\u5f53\u524d\u5e93\u7684 <code>cdc</code> \u6a21\u5f0f\u4e0b\u751f\u6210\u5982\u4e0b\u516d\u5f20\u8868:</p> <ul> <li><code>captured_columns</code></li> <li><code>change_tables</code></li> <li><code>ddl_history</code></li> <li><code>index_columns</code></li> <li><code>lsn_time_mapping</code></li> <li><code>dbo_t_product_CT</code>(\u542f\u52a8 CDC \u7684\u7528\u6237\u8868)</li> </ul> <pre><code>use demo;\n\n-- 1. \u9a8c\u8bc1 SQLServer Agent \u662f\u5426\u8fd0\u884c\nselect *  from master.dbo.sysprocesses WHERE program_name = 'SQLAgent - Generic Refresher';\n\n-- 2. \u542f\u7528\u5e93\u7ea7\u522b CDC\nexec sys.sp_cdc_enable_db;\nselect is_cdc_enabled from sys.databases where name = 'demo';\n\n-- 3. \u542f\u7528\u8868\u7ea7\u522b CDC\nexec sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 't_product', @role_name = null,;\nselect is_tracked_by_cdc from sys.tables where name = 't_product';\n\n-- 4. \u9a8c\u8bc1\u7528\u6237\u662f\u5426\u6709\u6743\u8bbf\u95ee CDC \u8868\nexec sys.sp_cdc_help_change_data_capture;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#33-flink-sql-connector-sqlserver-cdc","title":"3.3 <code>flink-sql-connector-sqlserver-cdc</code>","text":"<pre><code>set execution.checkpointing.interval = 3s;\nset sql-client.execution.result-mode = tableau;\n\ncreate table t_product_source (\n    database_name  string           metadata from 'database_name' virtual,\n    schema_name    string           metadata from 'schema_name'   virtual,\n    table_name     string           metadata from 'table_name'    virtual,\n    op_ts          timestamp_ltz(3) metadata from 'op_ts'         virtual,\n    id    bigint,\n    dt    timestamp(0),\n    name  string,\n    price decimal(38,2),\n    primary key(id) not enforced\n) with (\n    'connector'     = 'sqlserver-cdc',\n    'hostname'      = '192.168.31.101',\n    'port'          = '1433',\n    'username'      = 'sa',\n    'password'      = 'sa@sqlserver:0000',\n    'database-name' = 'demo',\n    'table-name'    = 'dbo.t_product',\n    'server-time-zone' = 'Asia/Shanghai',\n    'scan.startup.mode' = 'initial'\n);\n\nselect * from t_product_source;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#oracle-cdc","title":"\u56db\u3001Oracle CDC","text":""},{"location":"bigdata/flink/flink-cdc/#41","title":"4.1 \u5efa\u5e93\u5efa\u8868","text":"<pre><code>create table T_PRODUCT (\n    ID NUMBER(19,0),\n    DT DATE,\n    NAME VARCHAR2(64),\n    PRICE NUMBER(38,2),\n    PRIMARY KEY(ID)\n);\n\nINSERT ALL\nINTO T_PRODUCT VALUES(1, SYSDATE, 'A', 99.99)\nINTO T_PRODUCT VALUES(2, SYSDATE, 'B', 88.88)\nSELECT * FROM DUAL;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#42-cdc","title":"4.2 \u542f\u7528 CDC","text":""},{"location":"bigdata/flink/flink-cdc/#43-flink-sql-connector-oracle-cdc","title":"4.3 <code>flink-sql-connector-oracle-cdc</code>","text":"<pre><code>set execution.checkpointing.interval = 3s;\nset sql-client.execution.result-mode = tableau;\n\ncreate table t_product_source (\n    database_name string           metadata from 'database_name' virtual,\n    schema_name   string           metadata from 'schema_name'   virtual,\n    table_name    string           metadata from 'table_name'    virtual,\n    op_ts         timestamp_ltz(3) metadata from 'op_ts'         virtual,\n    ID    bigint,\n    DT    timestamp,\n    NAME  string,\n    PRICE decimal(38,2),\n    primary key(ID) not enforced\n) with (\n    'connector'     = 'oracle-cdc',\n    'hostname'      = '',\n    'url'           = '',\n    'username'      = 'cdc_readonly',\n    'password'      = 'cdc_readonly',\n    'database-name' = '',\n    'schema-name'   = '',\n    'table-name'    = 'T_PRODUCT',\n    'scan.startup.mode' = 'initial'\n);\n\nselect * from t_product_source;\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#mongodb-cdc","title":"\u4e94\u3001MongoDB CDC","text":""},{"location":"bigdata/flink/flink-cdc/#51","title":"5.1 \u5efa\u5e93\u5efa\u96c6\u5408","text":"<pre><code>use dmeo;\n\ndb.t_product.insertMany([\n  { dt: new Date(), name: 'A', price: 99.99 },\n  { dt: new Date(), name: 'B', price: 88.88 }\n]);\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#52-cdc","title":"5.2 \u542f\u7528 CDC","text":"<pre><code>use admin;\n\ndb.createRole({\n  role: 'cdc_readonly',\n  privileges: [\n    {\n      resource: { db: '', collection: '' },\n      actions: ['splitVector', 'listDatabases', 'listCollections', 'collStats', 'find', 'changeStream']\n    }\n  ],\n  roles: [{ role: 'read', db: 'config' }]\n});\n\ndb.createUser({\n  user: 'cdc_readonly',\n  pwd: 'cdc_readonly',\n  roles: [{ role: 'cdc_readonly', db: 'admin' }]\n});\n</code></pre>"},{"location":"bigdata/flink/flink-cdc/#53-flink-sql-connector-mongodb-cdc","title":"5.3 <code>flink-sql-connector-mongodb-cdc</code>","text":"<pre><code>set execution.checkpointing.interval = 3s;\nset sql-client.execution.result-mode = tableau;\n\ncreate table t_product_source (\n    database_name   string           metadata from 'database_name'   virtual,\n    collection_name string           metadata from 'collection_name' virtual,\n    op_ts           timestamp_ltz(3) metadata from 'op_ts'           virtual,\n    _id   string,\n    dt    timestamp(0),\n    name  string,\n    price decimal(38,2),\n    primary key(_id) not enforced\n) with (\n  'connector'  = 'mongodb-cdc',\n  'hosts'      = '192.168.8.101:27017',\n  'username'   = 'cdc_readonly',\n  'password'   = 'cdc_readonly',\n  'database'   = 'demo',\n  'collection' = 't_product',\n  'scan.startup.mode' = 'initial'\n);\n\nselect * from t_product_source;\n</code></pre>"},{"location":"bigdata/flume/","title":"Flume","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/","title":"Flume \u7b14\u8bb0","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#flume","title":"\u4e00\u3001Flume \u6982\u8ff0","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#11-flume","title":"1.1 Flume \u5b9a\u4e49","text":"<p>Flume \u662f Cloudera \u63d0\u4f9b\u7684\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\uff0c\u9ad8\u53ef\u9760\u7684\uff0c\u5206\u5e03\u5f0f\u7684\u6d77\u91cf\u65e5\u5fd7\u91c7\u96c6\u3001\u805a\u5408\u548c\u4f20\u8f93\u7684\u7cfb\u7edf\u3002Flume \u57fa\u4e8e\u6d41\u5f0f\u67b6\u6784\uff0c\u7075\u6d3b\u7b80\u5355\u3002</p> <p></p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#12-flume","title":"1.2 Flume \u57fa\u7840\u67b6\u6784","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#agent","title":"Agent","text":"<p>Agent \u662f\u4e00\u4e2a JVM \u8fdb\u7a0b\uff0c\u5b83\u4ee5\u4e8b\u4ef6\u7684\u5f62\u5f0f\u5c06\u6570\u636e\u4ece\u6e90\u5934\u4f20\u9001\u81f3\u76ee\u7684\u5730\u3002</p> <p>Agent \u4e3b\u8981\u7531\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\uff1aSource\u3001Channel\u3001Sink\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#source","title":"Source","text":"<p>Source \u662f\u8d1f\u8d23\u63a5\u6536\u6570\u636e\u5230 Flume Agent \u7684\u7ec4\u4ef6\u3002Source \u7ec4\u4ef6\u53ef\u4ee5\u5904\u7406\u5404\u79cd\u7c7b\u578b\u3001\u5404\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\u6570\u636e\uff0c\u5305\u62ec avro\u3001thrift\u3001exec\u3001jms\u3001spooling directory\u3001netcat\u3001taildir\u3001sequence generator\u3001syslog\u3001http\u3001legacy\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#sink","title":"Sink","text":"<p>Sink \u4e0d\u65ad\u7b2c\u8f6e\u8be2 Channel \u4e2d\u7684\u4e8b\u4ef6\u4e14\u6279\u91cf\u5730\u79fb\u9664\u5b83\u4eec\uff0c\u5e76\u5c06\u8fd9\u4e9b\u4e8b\u4ef6\u6279\u91cf\u5199\u5165\u5230\u5b58\u50a8\u6216\u7d22\u5f15\u7cfb\u7edf\u3002\u6216\u8005\u88ab\u53d1\u9001\u5230\u53e6\u4e00\u4e2a Flume Agent\u3002</p> <p>Sink \u7ec4\u4ef6\u76ee\u7684\u5730\u5305\u62ec hdfs\u3001logger\u3001avro\u3001thrift\u3001ipc\u3001file\u3001hbase\u3001solr\u3001\u81ea\u5b9a\u4e49\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#channel","title":"Channel","text":"<p>Channel \u662f\u4f4d\u4e8e Source \u548c Sink \u4e4b\u95f4\u7684\u7f13\u51b2\u533a\u3002\u56e0\u6b64 Channel \u5141\u8bb8 Source \u548c Sink \u8fd0\u4f5c\u5728\u4e0d\u540c\u7684\u901f\u7387\u4e0a\u3002Channel \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u51e0\u4e2a Source \u7684\u5199\u5165\u64cd\u4f5c\u548c\u51e0\u4e2a Sink \u7684\u8bfb\u53d6\u64cd\u4f5c\u3002</p> <p>Flume \u81ea\u5e26\u4e24\u79cd Channel\uff1a</p> <ul> <li> <p>Memory Channel</p> <p>Memory Channel \u662f\u5185\u5b58\u4e2d\u7684\u961f\u5217\u3002Memory Channel \u5728\u4e0d\u9700\u8981\u5173\u7cfb\u6570\u636e\u4e22\u5931\u7684\u60c5\u666f\u4e0b\u9002\u7528\u3002\u5982\u679c\u9700\u8981\u5173\u7cfb\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48 Memory Channel \u5c31\u4e0d\u5e94\u8be5\u9002\u7528\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u6b7b\u4ea1\u3001\u53ca\u5176\u5b95\u673a\u6216\u8005\u91cd\u542f\u90fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002</p> </li> <li> <p>File Channel</p> <p>File Channel \u5c06\u6240\u6709\u4e8b\u4ef6\u5199\u5230\u78c1\u76d8\u3002\u56e0\u6b64\u5728\u7a0b\u5e8f\u5173\u95ed\u6216\u673a\u5668\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\u3002</p> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#event","title":"Event","text":"<p>Flume \u6570\u636e\u4f20\u8f93\u7684\u57fa\u672c\u5355\u5143\uff0c\u4ee5 Event \u7684\u5f62\u5f0f\u5c06\u6570\u636e\u4ece\u6e90\u5934\u9001\u81f3\u76ee\u7684\u5730\u3002Event \u7531 Header \u548c Body \u4e24\u90e8\u5206\u7ec4\u6210\uff0cHeader \u7528\u6765\u5b58\u653e\u8be5 Event \u7684\u4e00\u4e9b\u5c5e\u6027\uff0c\u4e3a K-V \u7ed3\u6784\uff0cBody \u7528\u6765\u5b58\u653e\u8be5\u6761\u6570\u636e\uff0c\u5f62\u5f0f\u4e3a\u5b57\u8282\u6570\u7ec4\u3002</p> <p></p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#flume_1","title":"\u4e8c\u3001Flume \u5165\u95e8","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#21-flume","title":"2.1 Flume \u5b89\u88c5\u90e8\u7f72","text":"<ul> <li> <p>\u4e0b\u8f7d\u89e3\u538b</p> <pre><code>tar -zxvf apache-flume-1.9.0-bin.tar.gz -C /opt\nmv /opt/apache-flume-1.9.0-bin.tar.gz /opt/flume\n</code></pre> </li> <li> <p>\u914d\u7f6e\u73af\u5883\u53d8\u91cf</p> <pre><code>echo 'export FLUME_HOME=/opt/flume' &gt;&gt; /etc/bash.profile\nsource /etc/profile\n</code></pre> </li> <li> <p>\u517c\u5bb9 Guava \u4f9d\u8d56</p> <pre><code>rm $(find $FLUME_HOME/lib -name 'guava-*')\ncp $(find $HADOOP_HOME/share/hadoop/common/lib -name 'guava-*' | head -n 1) $FLUME_HOME/lib\n</code></pre> </li> <li> <p>\u517c\u5bb9 SLF4J \u4f9d\u8d56</p> <pre><code>rm $(find $FLUME_HOME/lib -name 'slf4j-*')\n</code></pre> </li> <li> <p>\u8c03\u6574\u5185\u5b58</p> <pre><code>cd $FLUME_HOME\n\ncp conf/flume-env.sh.template conf/flume-env.sh\n\nvim conf/flume-env.sh\n</code></pre> <p>\u4fee\u6539\u76f8\u5e94\u6ce8\u91ca\u884c\u4e3a\uff1a</p> <pre><code>export JAVA_OPTS=\"-Xms1024m -Xmx1024m -Dcom.sun.management.jmxremote\"\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#22-flume","title":"2.2 Flume \u5165\u95e8\u6848\u4f8b","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#221","title":"2.2.1 \u76d1\u63a7\u7aef\u53e3\u6570\u636e\u5b98\u65b9\u6848\u4f8b","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_1","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff0c\u6536\u96c6\u8be5\u7aef\u53e3\u6570\u636e\uff0c\u5e76\u6253\u5370\u5230\u63a7\u5236\u53f0\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_2","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u68c0\u67e5 44444 \u7aef\u53e3\u662f\u5426\u88ab\u5360\u7528</p> <pre><code>netstat -nlp | grep 44444\n</code></pre> </li> <li> <p>\u521b\u5efa Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume-netcat-logger.conf</code></p> <pre><code>cd $FLUME_HOME\n\nmkdir -p jobs\n\nvim jobs/flume-netcat-logger.conf\n</code></pre> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# NetCat TCP Source\na1.sources.r1.channels = c1\na1.sources.r1.type = netcat\na1.sources.r1.bind=localhost\na1.sources.r1.port = 44444\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent                          \\\n  --conf conf/                              \\\n  --conf-file jobs/flume-netcat-logger.conf \\\n  --name a1                                 \\\n  -Dflume.root.logger=INFO,console\n</code></pre> </li> <li> <p>\u5411\u672c\u673a 44444 \u7aef\u53e3\u53d1\u9001\u6570\u636e</p> <pre><code>nc localhost 44444\n</code></pre> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#222","title":"2.2.2 \u5b9e\u65f6\u76d1\u63a7\u5355\u4e2a\u8ffd\u52a0\u6587\u4ef6","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_3","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u5b9e\u65f6\u76d1\u63a7 <code>/opt/flume/input/a.txt</code> \u6587\u4ef6\uff0c\u5e76\u4e0a\u4f20\u81f3 HDFS\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_4","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume-file-hdfs.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Exec Source\na1.sources.r1.channels = c1\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /opt/flume/input/a.txt\na1.sources.r1.shell = /bin/bash -c\n\n# HDFS Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = hdfs://node6:9000/flume/%Y-%m-%d/%H\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.fileType = DataStream\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent -c conf/ -f jobs/flume-file-hdfs.conf -n a1\n</code></pre> </li> <li> <p>\u8ffd\u52a0\u6587\u4ef6</p> <pre><code>mkdir -p /opt/flume/input\necho $RANDOM &gt;&gt; /opt/flume/input/a.txt\n</code></pre> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#223","title":"2.2.3 \u5b9e\u65f6\u76d1\u63a7\u76ee\u5f55\u4e0b\u7684\u591a\u4e2a\u65b0\u6587\u4ef6","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_5","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u76d1\u542c <code>/opt/flume/input</code>\u6574\u4e2a\u76ee\u5f55\u7684\u6587\u4ef6\uff0c\u5e76\u4e0a\u4f20\u81f3 HDFS\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_6","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume-dir-hdfs.conf</code></p> <pre><code>a1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Spooling Directory Source\na1.sources.r1.channels = c1\na1.sources.r1.type = spooldir\na1.sources.r1.spoolDir = /opt/flume/input\na1.sources.r1.fileHeader = true\n\n# HDFS Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = hdfs://node6:9000/flume/%Y-%m-%d/%H\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.fileType = DataStream\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent -c conf/ -f jobs/flume-dir-hdfs.conf -n a1\n</code></pre> </li> <li> <p>\u65b0\u5efa\u6587\u4ef6</p> <pre><code>touch /opt/flume/input/1.txt\ntouch /opt/flume/input/2.txt\n</code></pre> </li> <li> <p>\u67e5\u770b\u76ee\u5f55\u53d8\u5316</p> <pre><code>watch ls /opt/flume/input\n</code></pre> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_7","title":"\u8bf4\u660e","text":"<p><code>spoolDir</code> \u4e0d\u652f\u6301 <code>~</code> \u8def\u5f84\u3002\u6bd4\u5982 <code>~/input</code> \u4f1a\u62a5\u9519\uff1a</p> <pre><code>java.lang.IllegalStateException: Directory does not exist: /opt/flume/~/input\n</code></pre> <p>\u5728\u4f7f\u7528 Spooling Directory Source \u65f6\uff1a</p> <ol> <li>\u4e0d\u8981\u518d\u76d1\u63a7\u76ee\u5f55\u4e2d\u521b\u5efa\u5e76\u6301\u7eed\u4fee\u6539\u6587\u4ef6</li> <li>\u4e0a\u4f20\u5b8c\u6210\u7684\u6587\u4ef6\u4f1a\u4ee5 <code>.COMPLETED</code> \u7ed3\u5c3e</li> <li>\u88ab\u76d1\u63a7\u6587\u4ef6\u5939\u6bcf 500 \u6beb\u79d2\u626b\u63cf\u4e00\u6b21\u6587\u4ef6\u53d8\u52a8</li> </ol>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#224","title":"2.2.4 \u5b9e\u65f6\u76d1\u63a7\u76ee\u5f55\u4e0b\u7684\u591a\u4e2a\u8ffd\u52a0\u6587\u4ef6","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_8","title":"\u4ecb\u7ecd","text":"<p>Exec Source \u9002\u7528\u4e8e\u76d1\u63a7\u4e00\u4e2a\u5b9e\u65f6\u8ffd\u52a0\u7684\u6587\u4ef6\uff0c\u4e0d\u80fd\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\uff1bSpooling Directory Source \u9002\u7528\u4e8e\u540c\u6b65\u65b0\u6587\u4ef6\uff0c\u4f46\u4e0d\u9002\u5408\u5bf9\u5b9e\u65f6\u8ffd\u52a0\u65e5\u5fd7\u7684\u6587\u4ef6\u8fdb\u884c\u76d1\u542c\u5e76\u540c\u6b65\uff1b\u800c Taildir Source \u9002\u5408\u7528\u4e8e\u76d1\u542c\u591a\u4e2a\u5b9e\u65f6\u8ffd\u52a0\u7684\u6587\u4ef6\uff0c\u5e76\u4e14\u80fd\u591f\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_9","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u76d1\u542c\u6574\u4e2a\u76ee\u5f55\u7684\u5b9e\u65f6\u8ffd\u52a0\u6587\u4ef6\uff0c\u5e76\u4e0a\u4f20\u81f3 HDFS\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_10","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume-taildir-hdfs.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Taildir Source\na1.sources.r1.channels = c1\na1.sources.r1.type = TAILDIR\na1.sources.r1.filegroups = f1\na1.sources.r1.filegroups.f1 = /opt/flume/input/.*txt.*\na1.sources.r1.positionFile = /opt/flume/taildir_position.json\na1.sources.r1.fileHeader = true\n\n# HDFS Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = hdfs://node6:9000/flume/%Y-%m-%d/%H\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.fileType = DataStream\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent -c conf/ -f jobs/flume-taildir-hdfs.conf -n a1\n</code></pre> </li> <li> <p>\u8ffd\u52a0\u6587\u4ef6</p> <pre><code>echo $RANDOM &gt;&gt; /opt/flume/input/a.txt\necho $RANDOM &gt;&gt; /opt/flume/input/b.txt\n</code></pre> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_11","title":"\u8bf4\u660e","text":"<p>Taildir Source \u7ef4\u62a4\u4e86\u4e00\u4e2a JSON \u683c\u5f0f\u7684 Position File\uff0c\u4f1a\u5b9a\u671f\u7684\u5f80 Position File \u4e2d\u66f4\u65b0\u6bcf\u4e2a\u6587\u4ef6\u8bfb\u53d6\u5230\u7684\u6700\u65b0\u7684\u4f4d\u7f6e\uff0c\u56e0\u6b64\u80fd\u591f\u5b9e\u73b0\u65ad\u70b9\u7eed\u4f20\u3002Position File \u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>[\n  { \"inode\": 1579598, \"pos\": 12, \"file\": \"/opt/flume/input/a.txt\" },\n  { \"inode\": 1579593, \"pos\": 6, \"file\": \"/opt/flume/input/b.txt\" }\n]\n</code></pre> <p>Linux \u4e2d\u5b58\u50a8\u6587\u4ef6\u5143\u6570\u636e\u533a\u57df\u53eb\u505a inode\uff0c\u6bcf\u4e2a inode \u90fd\u6709\u4e00\u4e2a\u53f7\u7801\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7528 inode \u53f7\u7801\u8bc6\u522b\u4e0d\u540c\u7684\u6587\u4ef6\uff0cUnix/Linux \u7cfb\u7edf\u5185\u90e8\u4e0d\u4f7f\u7528\u6587\u4ef6\u540d\uff0c\u800c\u4f7f\u7528 inode \u53f7\u7801\u6765\u8bc6\u522b\u6587\u4ef6\u3002</p> <p></p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#flume_2","title":"\u4e09\u3001Flume \u8fdb\u9636","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#31-flume","title":"3.1 Flume \u4e8b\u52a1","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#32-flume-agent","title":"3.2 Flume Agent \u5185\u90e8\u539f\u7406","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#channelselector","title":"ChannelSelector","text":"<p>ChannelSelector \u7684\u4f5c\u7528\u5c31\u662f\u9009\u51fa Event \u5c06\u8981\u88ab\u53d1\u5f80\u54ea\u4e2a Channel\u3002\u5176\u5171\u6709\u4e24\u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f Replicating\uff08\u590d\u5236\uff09\u548c Multiplexing\uff08\u591a\u8def\u590d\u7528\uff09\u3002</p> <p>ReplicatingSelector \u4f1a\u5c06\u540c\u4e00\u4e2a Event \u53d1\u5f80\u6240\u6709\u7684 Channel\uff0cMultiplexingSelector \u4f1a\u6839\u636e\u76f8\u5e94\u7684\u539f\u5219\uff0c\u5c06\u4e0d\u540c\u7684 Event \u53d1\u5f80\u4e0d\u540c\u7684 Channel\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#sinkprocessor","title":"SinkProcessor","text":"<p>SinkProcessor \u5171\u6709\u4e09\u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>DefaultSinkProcessor\uff1a\u5bf9\u5e94\u7684\u662f\u5355\u4e2a\u7684 Sink\u3002</li> <li>LoadBalancingSinkProcessor\uff1a\u5bf9\u5e94\u7684\u662f Sink Group\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd\u3002</li> <li>FailoverSinkProcessor\uff1a\u5bf9\u5e94\u7684\u662f Sink Group\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6545\u969c\u6062\u590d\u7684\u529f\u80fd\u3002</li> </ul> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#33-flume","title":"3.3 Flume \u62d3\u6251\u7ed3\u6784","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_12","title":"\u7b80\u5355\u4e32\u8054","text":"<p>\u8fd9\u79cd\u6a21\u5f0f\u662f\u5c06\u591a\u4e2a Flume \u987a\u5e8f\u8fde\u63a5\u8d77\u6765\u4e86\uff0c\u4ece\u6700\u521d\u7684 Source \u5f00\u59cb\u5230\u6700\u7ec8 Sink \u4f20\u9001\u7684\u76ee\u7684\u5b58\u50a8\u7cfb\u7edf\u3002</p> <p>\u6b64\u6a21\u5f0f\u4e0d\u5efa\u8bae\u6865\u63a5\u8fc7\u591a\u7684 Flume \u6570\u91cf\uff0cFlume \u6570\u91cf\u8fc7\u591a\u4e0d\u4ec5\u4f1a\u5f71\u54cd\u4f20\u8f93\u901f\u7387\uff0c\u800c\u4e14\u4e00\u65e6\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u67d0\u4e2a\u8282\u70b9 Flume \u5b95\u673a\uff0c\u4f1a\u5f71\u54cd\u6574\u4e2a\u4f20\u8f93\u7cfb\u7edf \u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_13","title":"\u590d\u5236\u548c\u591a\u8def\u590d\u7528","text":"<p>Flume \u652f\u6301\u5c06\u4e8b\u4ef6\u6d41\u5411\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u76ee\u7684\u5730\u3002\u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u5c06\u76f8\u540c\u6570\u636e\u590d\u5236\u5230\u591a\u4e2a Channel \u4e2d\uff0c\u6216\u8005\u5c06\u4e0d\u540c\u6570\u636e\u5206\u53d1\u5230\u4e0d\u540c\u7684 Channel \u4e2d\uff0cSink \u53ef\u4ee5\u9009\u62e9\u4f20\u9001\u5230\u4e0d\u540c\u7684\u76ee\u7684\u5730\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_14","title":"\u8d1f\u8f7d\u5747\u8861\u548c\u6545\u969c\u8f6c\u79fb","text":"<p>Flume \u652f\u6301\u4f7f\u7528\u591a\u4e2a Sink \u903b\u8f91\u4e0a\u5206\u5230\u4e00\u4e2a Sink \u7ec4\uff0cSink \u7ec4\u914d\u5408\u4e0d\u540c\u7684 SinkProcessor \u53ef\u4ee5\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u548c\u6545\u969c\u6062\u590d\u7684\u529f\u80fd\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_15","title":"\u805a\u5408","text":"<p>\u8fd9\u79cd\u6a21\u5f0f\u662f\u6211\u4eec\u6700\u5e38\u89c1\u7684\uff0c\u4e5f\u975e\u5e38\u5b9e\u7528\uff0c\u65e5\u5e38 Web \u5e94\u7528\u901a\u5e38\u5206\u5e03\u5728\u4e0a\u767e\u4e2a\u670d\u52a1\u5668\uff0c\u5927\u8005\u751a\u81f3\u4e0a\u5343\u4e2a\u3001\u4e0a\u4e07\u4e2a\u670d\u52a1\u5668\u3002\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u5904\u7406\u8d77\u6765\u4e5f\u975e\u5e38\u9ebb\u70e6\u3002</p> <p>\u7528 Flume \u7684\u8fd9\u79cd\u7ec4\u5408\u65b9\u5f0f\u80fd\u5f88\u597d\u7684\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u90e8\u7f72\u4e00\u4e2a Flume \u91c7\u96c6\u7cfb\u7edf\uff0c\u4f20\u9001\u5230\u4e00\u4e2a\u96c6\u4e2d\u6536\u96c6\u65e5\u5fd7\u7684 Flume\uff0c\u518d\u7531\u6b64 Flume \u4e0a\u4f20\u81f3 HDFS\u3001Hive\u3001Hbase \u7b49\uff0c\u8fdb\u884c\u65e5\u5fd7\u5206\u6790\u3002</p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#34-flume","title":"3.4 Flume \u5f00\u53d1\u6848\u4f8b","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#341","title":"3.4.1 \u590d\u5236\u548c\u591a\u8def\u590d\u7528","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_16","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume1 \u76d1\u63a7\u6587\u4ef6\u53d8\u52a8\uff0cFlume1 \u5c06\u53d8\u52a8\u5185\u5bb9\u4f20\u9012\u7ed9 Flume2\uff0cFlume2 \u8d1f\u8d23\u5b58\u50a8\u5230 HDFS\u3002\u540c\u65f6 Flume1 \u5c06\u53d8\u52a8\u5185\u5bb9\u4f20\u9012\u7ed9 Flume3\uff0cFlume3 \u8d1f\u8d23\u8f93\u51fa\u5230 Local File System\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_17","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa\u63a5\u6536\u6587\u4ef6\u7684 Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume1-file-flume.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1 k2\na1.channels = c1 c2\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Memory Channel\na1.channels.c2.type = memory\n\n# Exec Source\na1.sources.r1.selector.type = replicating\na1.sources.r1.channels = c1 c2\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /opt/flume/input/a.txt\na1.sources.r1.shell = /bin/bash -c\n\n# Avro Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = localhost\na1.sinks.k1.port = 4141\n\n# Avro Sink\na1.sinks.k2.channel = c2\na1.sinks.k2.type = avro\na1.sinks.k2.hostname = localhost\na1.sinks.k2.port = 4142\n</code></pre> </li> <li> <p>\u521b\u5efa\u8f93\u5165\u5230 HDFS \u7684 Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume2-flume-hdfs.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4141\n\n# HDFS Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = hdfs://node6:9000/flume/%Y-%m-%d/%H\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.roundValue = 1\na1.sinks.k1.hdfs.fileType = DataStream\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n</code></pre> </li> <li> <p>\u521b\u5efa\u8f93\u51fa\u5230\u672c\u5730\u76ee\u5f55\u7684 Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume3-flume-dir.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4142\n\n# File Roll Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = file_roll\na1.sinks.k1.sink.directory = /opt/flume/output\n</code></pre> <p>\u6ce8\u610f\uff1a\u8f93\u51fa\u7684\u76ee\u5f55\u5fc5\u987b\u6570\u5df2\u7ecf\u5b58\u5728\u7684\u76ee\u5f55\uff0c\u5982\u679c\u8be5\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5e76\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\u76ee\u5f55\u3002</p> <pre><code>mkdir -p /opt/flume/output\n</code></pre> </li> <li> <p>\u6309\u987a\u5e8f\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent -c conf/ -f jobs/flume3-flume-dir.conf -n a1\n\nbin/flume-ng agent -c conf/ -f jobs/flume2-flume-hdfs.conf -n a1\n\nbin/flume-ng agent -c conf/ -f jobs/flume1-file-flume.conf -n a1\n</code></pre> </li> <li> <p>\u5199\u5165\u6587\u4ef6</p> <pre><code>echo $RANDOM &gt;&gt; /opt/flume/input/a.txt\n</code></pre> </li> <li> <p>\u67e5\u770b HDFS \u548c\u672c\u5730\u76ee\u5f55</p> <pre><code>watch ls /opt/flume/output\n</code></pre> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#342","title":"3.4.2 \u8d1f\u8d23\u5747\u8861\u548c\u6545\u969c\u8f6c\u79fb","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_18","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume1 \u76d1\u63a7\u4e00\u4e2a\u7aef\u53e3\uff0c\u5176 Sink \u7ec4\u4e2d\u7684 Sink \u5206\u522b\u5bf9\u63a5 Flume2 \u548c Flume3\uff0c\u91c7\u7528 FailoverSinkProcessor \u5b9e\u73b0\u6545\u969c\u8f6c\u79fb\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_19","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa\u63a5\u6536\u7aef\u53e3\u6570\u636e\u7684 Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume1-netcat-flume.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinkgroups = g1\na1.sinks = k1 k2\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# NetCat TCP Source\na1.sources.r1.channels = c1\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Sink Group\na1.sinkgroups.g1.sinks = k1 k2\na1.sinkgroups.g1.processor.type = failover\na1.sinkgroups.g1.processor.priority.k1 = 5\na1.sinkgroups.g1.processor.priority.k2 = 10\na1.sinkgroups.g1.processor.maxpenalty = 10000\n\n# Avro Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = localhost\na1.sinks.k1.port = 4141\n\n# Avro Sink\na1.sinks.k2.channel = c1\na1.sinks.k2.type = avro\na1.sinks.k2.hostname = localhost\na1.sinks.k2.port = 4142\n</code></pre> </li> <li> <p>\u521b\u5efa\u4e24\u4e2a\u8f93\u51fa\u5230\u672c\u5730\u63a7\u5236\u53f0\u7684 Flume \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume2-flume-console.conf</code>\u3001<code>jobs/flume3-flume-console.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4141\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4142\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> <li> <p>\u987a\u5e8f\u542f\u52a8\u4efb\u52a1</p> <pre><code>bin/flume-ng agent -c conf/ -f jobs/flume2-flume-console.conf -n a1 -Dflume.root.logger=INFO,console\n\nbin/flume-ng agent -c conf/ -f jobs/flume3-flume-console.conf -n a1 -Dflume.root.logger=INFO,console\n\nbin/flume-ng agent -c conf/ -f jobs/flume1-netcat-flume.conf -n a1\n</code></pre> </li> <li> <p>\u5411\u672c\u673a\u7aef\u53e3\u53d1\u9001\u6570\u636e</p> <pre><code>nc loclahost 44444\n</code></pre> </li> <li> <p>\u67e5\u770b Flume2 \u53ca Flume3 \u63a7\u5236\u53f0\u65e5\u5fd7\u6253\u5370\u60c5\u51b5</p> </li> <li> <p>\u505c\u6b62 Flume2 \u67e5\u770b Flume3 \u63a7\u5236\u53f0\u65e5\u5fd7\u6253\u5370\u60c5\u51b5</p> </li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#343","title":"3.4.3 \u805a\u5408","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_20","title":"\u6848\u4f8b\u9700\u6c42","text":"<ul> <li>Flume1 \u76d1\u63a7\u6587\u4ef6 <code>/opt/flume/input/a.txt</code></li> <li>Flume2 \u76d1\u63a7\u7aef\u53e3 44444</li> <li>Flume1 \u4e0e Flume2 \u5c06\u6570\u636e\u53d1\u9001\u7ed9 Flume3\uff0cFlume3 \u5c06\u6700\u7ec8\u6570\u636e\u6253\u5370\u5230\u63a7\u5236\u53f0</li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_21","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u76d1\u63a7\u6587\u4ef6\u7684 Flume1 \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume1-file-flume.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Exec Source\na1.sources.r1.channels = c1\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /opt/flume/input/a.txt\na1.sources.r1.shell = /bin/bash -c\n\n# Avro Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = localhost\na1.sinsk.k1.port = 4141\n</code></pre> </li> <li> <p>Hadoop102 \u4e0a\u76d1\u63a7\u7aef\u53e3\u6570\u636e\u7684 Flume2 \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume2-netcat-flume.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# NetCat TCP Source\na1.sources.r1.channels = c1\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Avro Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = localhost\na1.sinsk.k1.port = 4141\n</code></pre> </li> <li> <p>Hadoop103 \u4e0a\u805a\u5408\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u7684 Flume3 \u914d\u7f6e\u6587\u4ef6 <code>jobs/flume3-flume-logger.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = arvo\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4141\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1</p> <pre><code># Flume3\nbin/flume-ng agent -c conf/ -f jobs/flume3-flume-logger.conf -n a1 -Dflume.root.logger=INFO,console\n\n# Flume2\nbin/flume-ng agent -c conf/ -f jobs/flume2-netcat-flume.conf -n a1\n\n# Flume1\nbin/flume-ng agent -c conf/ -f jobs/flume1-file-flume.conf -n a1\n</code></pre> </li> <li> <p>\u8ffd\u52a0\u6587\u4ef6\u5e76\u5411\u7aef\u53e3\u53d1\u9001\u6570\u636e</p> <pre><code># Flume1\necho $RANDOM &gt;&gt; /opt/flume/input/a.txt\n\n# Flume1\nnc localhost 44444\n</code></pre> </li> <li> <p>\u67e5\u770b Flume3 \u63a7\u5236\u53f0\u6253\u5370\u60c5\u51b5</p> </li> </ul> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#35-interceptor","title":"3.5 \u81ea\u5b9a\u4e49 Interceptor","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_22","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u91c7\u96c6\u670d\u52a1\u5668\u672c\u5730\u65e5\u5fd7\uff0c\u9700\u8981\u6309\u7167\u65e5\u5fd7\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u5c06\u4e0d\u540c\u7684\u65e5\u5fd7\u53d1\u5f80\u4e0d\u540c\u7684\u5206\u6790\u7cfb\u7edf\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_23","title":"\u9700\u6c42\u5206\u6790","text":"<p>\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u4ea7\u751f\u7684\u65e5\u5fd7\u7c7b\u578b\u53ef\u80fd\u6709\u5f88\u591a\u79cd\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\u53ef\u80fd\u9700\u8981\u53d1\u9001\u5230\u4e0d\u540c\u7684\u5206\u6790\u7cfb\u7edf\u3002</p> <p>\u6b64\u65f6\u4f1a\u7528\u5230 Flume \u62d3\u6251\u7ed3\u6784\u4e2d\u7684 Multiplexing \u7ed3\u6784\uff0cMultiplexing \u7684\u539f\u7406\u662f\uff1a\u6839\u636e Event \u4e2d Header \u7684\u67d0\u4e2a Key \u7684\u503c\uff0c\u5c06\u4e0d\u540c\u7684 Event \u53d1\u9001\u5230\u4e0d\u540c\u7684 Channel\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a Interceptor\uff0c\u4e3a\u4e0d\u540c\u7c7b\u578b\u7684 Event \u7684 Header \u7684 Key \u8d4b\u4e88\u4e0d\u540c\u7684\u503c\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_24","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ul> <li> <p>\u521b\u5efa Maven \u9879\u76ee\u5e76\u5f15\u5165\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;org.apache.flume&lt;/groupId&gt;\n  &lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt;\n  &lt;version&gt;1.9.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u521b\u5efa\u81ea\u5b9a\u4e49 Interceptor \u5e76\u5b9e\u73b0 <code>Interceptor</code> \u63a5\u53e3</p> <pre><code>import org.apache.flume.Context;\nimport org.apache.flume.Event;\nimport org.apache.flume.interceptor.Interceptor;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\npublic class MyInterceptor implements Interceptor {\n    private List&lt;Event&gt; eventList;\n\n    @Override\n    public void initialize() {\n        eventList = new ArrayList&lt;&gt;();\n    }\n\n    // \u5355\u4e2a\u4e8b\u4ef6\u62e6\u622a\n    @Override\n    public Event intercept(Event event) {\n        Map&lt;String, String&gt; headers = event.getHeaders();\n        String body = new String(event.getBody());\n        if (body.contains(\"info\")) {\n            headers.put(\"type\", \"info\");\n        } else if (body.contains(\"error\")) {\n            headers.put(\"type\", \"error\");\n        }\n        return event;\n    }\n\n    // \u6279\u91cf\u4e8b\u4ef6\u62e6\u622a\n    @Override\n    public List&lt;Event&gt; intercept(List&lt;Event&gt; events) {\n        eventList.clear();\n        for (Event event : events) {\n            eventList.add(intercept(event));\n        }\n        return eventList;\n    }\n\n    @Override\n    public void close() { }\n\n    public static class Builder implements Interceptor.Builder {\n        @Override\n        public Interceptor build() {\n            return new MyInterceptor();\n        }\n\n        @Override\n        public void configure(Context context) { }\n    }\n}\n</code></pre> </li> <li> <p>Flume \u914d\u7f6e\u6587\u4ef6 <code>flume1-netcat-flume.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1 k2\na1.channels = c1 c2\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Memory Channel\na1.channels.c2.type = memory\n\n# NetCat TCP Source\na1.sources.r1.channels = c1 c2\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\na1.sources.r1.interceptors = i1\na1.sources.r1.interceptors.i1.type = xyz.icefery.demo.interceptor.MyInterceptor$Builder\na1.sources.r1.selector.type = multiplexing\na1.sources.r1.selector.header = type\na1.sources.r1.selector.mapping.info = c1\na1.sources.r1.selector.mapping.error = c2\n\n# Avro Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = avro\na1.sinks.k1.hostname = localhost\na1.sinks.k1.port = 4141\n\n# Avro Sink\na1.sinks.k2.channel = c2\na1.sinks.k2.type = avro\na1.sinks.k2.hostname = localhost\na1.sinks.k2.port = 4142\n</code></pre> </li> <li> <p>Flume \u914d\u7f6e\u6587\u4ef6 <code>flume2-flume-logger.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4141\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> <li> <p>Flume \u914d\u7f6e\u6587\u4ef6 <code>flume3-flume-logger.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Avro Source\na1.sources.r1.channels = c1\na1.sources.r1.type = avro\na1.sources.r1.bind = localhost\na1.sources.r1.port = 4142\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> <li> <p>\u542f\u52a8\u4efb\u52a1 Flume2\u3001Flume3\u3001Flume1</p> </li> <li> <p>\u5411\u7aef\u53e3\u53d1\u9001\u6570\u636e</p> <pre><code>echo 'info' | nc localhost 44444\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#36-source","title":"3.6 \u81ea\u5b9a\u4e49 Source","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_25","title":"\u4ecb\u7ecd","text":"<p>Source \u662f\u8d1f\u8d23\u63a5\u6536\u6570\u636e\u5230 Flume Agent \u7684\u7ec4\u4ef6\u3002Source \u7ec4\u4ef6\u53ef\u4ee5\u5904\u7406\u5404\u79cd\u7c7b\u578b\u3001\u5404\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\u6570\u636e\uff0c\u5305\u62ec Avro\u3001Thrift\u3001Exec\u3001JMS\u3001Spooling Directory\u3001NetCat\u3001Sequence Generator\u3001Syslog\u3001HTTP\u3001Legacy\u3002</p> <p>\u5b98\u65b9\u63d0\u4f9b\u7684 Source \u7c7b\u578b\u5df2\u7ecf\u5f88\u591a\uff0c\u4f46\u662f\u6709\u65f6\u5019\u5e76\u4e0d\u80fd\u6ee1\u8db3\u5b9e\u9645\u5f00\u53d1\u5f53\u4e2d\u7684\u9700\u6c42\uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u81ea\u5b9a\u4e49\u67d0\u4e9b Source\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_26","title":"\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u63a5\u6536\u6570\u636e\uff0c\u5e76\u7ed9\u6bcf\u6761\u6570\u636e\u6dfb\u52a0\u524d\u7f00\uff0c\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002\u524d\u7f00\u8bfe\u4ece Flume \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_27","title":"\u7f16\u7801","text":"<ul> <li> <p>\u81ea\u5b9a\u4e49 Source\uff0c\u7ee7\u627f <code>AbstractSource</code> \u7c7b\uff0c\u5b9e\u73b0 <code>Configurable</code> \u548c <code>PollableSource</code> \u63a5\u53e3</p> <pre><code>public class MySource extends AbstractSource implements Configurable, PollableSource {\n    private Long delay;\n    private String field;\n\n    @Override\n    public void configure(Context context) {\n        delay = context.getLong(\"delay\");\n        field = context.getString(\"field\");\n    }\n\n    @Override\n    public Status process() throws EventDeliveryException {\n        try {\n            Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();\n            Event event = new SimpleEvent();\n            for (int i = 0; i &lt; 5; i++) {\n                event.setHeaders(headers);\n                event.setBody((field + i).getBytes());\n                getChannelProcessor().processEvent(event);\n                TimeUnit.MILLISECONDS.sleep(delay);\n            }\n            return Status.READY;\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n            return Status.BACKOFF;\n        }\n    }\n\n    @Override\n    public long getBackOffSleepIncrement() {\n        return 0;\n    }\n\n    @Override\n    public long getMaxBackOffSleepInterval() {\n        return 0;\n    }\n}\n</code></pre> <p>\u6253\u5305\u5e76\u4e0a\u4f20\u81f3 Flume \u7684 <code>lib</code> \u76ee\u5f55\u4e0b\u3002</p> </li> <li> <p>\u914d\u7f6e\u6587\u4ef6 <code>flume-custom-logger.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# Custom Source\na1.sources.r1.channels = c1\na1.sources.r1.type = xyz.icefery.demo.source.MySource\na1.sources.r1.prefix = custom-\n\n# Logger Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = logger\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#37-sink","title":"3.7 \u81ea\u5b9a\u4e49 Sink","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_28","title":"\u4ecb\u7ecd","text":"<p>Sink \u4e0d\u65ad\u5730\u8f6e\u8be2 Channel \u4e2d\u7684\u4e8b\u4ef6\u4e14\u6279\u91cf\u5730\u79fb\u9664\u5b83\u4eec\uff0c\u5e76\u5c06\u8fd9\u4e9b\u4e8b\u4ef6\u6279\u91cf\u5199\u5165\u5230\u5b58\u50a8\u6216\u7d22\u5f15\u7cfb\u7edf\u3001\u6216\u8005\u88ab\u53d1\u9001\u5230\u53e6\u4e00\u4e2a Flume Agent\u3002</p> <p>Sink \u662f\u5b8c\u5168\u4e8b\u52a1\u6027\u7684\uff0c\u5728\u4ece Channel \u6279\u91cf\u5220\u9664\u6570\u636e\u4e4b\u524d\uff0c\u6bcf\u4e2a Sink \u7528 Channel \u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\u3002\u6279\u91cf\u4e8b\u4ef6\u4e00\u65e6\u6210\u529f\u5199\u51fa\u5230\u5b58\u50a8\u7cfb\u7edf\u6216\u4e0b\u4e00\u4e2a Flume Agent\uff0cSink \u5c31\u5229\u7528 Channel \u63d0\u4ea4\u4e8b\u52a1\u3002\u4e8b\u52a1\u4e00\u65e6\u88ab\u63d0\u4ea4\uff0c\u8be5 Channel \u4ece\u81ea\u5df1\u7684\u5185\u90e8\u7f13\u51b2\u533a\u5220\u9664\u4e8b\u4ef6\u3002</p> <p>Sink \u7ec4\u4ef6\u76ee\u7684\u5730\u5305\u62ec HDFS\u3001Avro\u3001Thrift\u3001IPC\u3001File\u3001Null\u3001HBase\u3001Solr\u3001\u81ea\u5b9a\u4e49\u3002\u5b98\u65b9\u63d0\u4f9b\u7684 Sink \u7c7b\u578b\u5df2\u7ecf\u5f88\u591a\uff0c\u4f46\u662f\u6709\u65f6\u5019\u5e76\u4e0d\u80fd\u6ee1\u8db3\u5b9e\u9645\u5f00\u53d1\u5f53\u4e2d\u7684\u9700\u6c42\uff0c\u6b64\u65f6\u6211\u4eec\u5c31\u9700\u8981\u6839\u636e\u5b9e\u9645\u9700\u6c42\u81ea\u5b9a\u4e49\u67d0\u4e9b Sink\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_29","title":"\u9700\u6c42","text":"<p>\u4f7f\u7528 Flume \u63a5\u6536\u6570\u636e\uff0c\u5e76\u5728 Sink \u7aef\u7ed9\u6bcf\u6761\u6570\u636e\u5929\u6dfb\u52a0\u524d\u7f00\u548c\u540e\u7f00\uff0c\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002\u524d\u540e\u7f00\u53ef\u5728 Flume \u4efb\u52a1\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_30","title":"\u7f16\u7801","text":"<ul> <li> <p>\u81ea\u5b9a\u4e49 Sink\uff0c\u7ee7\u627f <code>AbstractSink</code>\uff0c\u5b9e\u73b0 <code>Configurable</code> \u63a5\u53e3</p> <pre><code>import org.apache.flume.Channel;\nimport org.apache.flume.Context;\nimport org.apache.flume.Event;\nimport org.apache.flume.EventDeliveryException;\nimport org.apache.flume.Transaction;\nimport org.apache.flume.conf.Configurable;\nimport org.apache.flume.sink.AbstractSink;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class MySink extends AbstractSink implements Configurable {\n    private static final Logger log = LoggerFactory.getLogger(AbstractSink.class);\n\n    private String prefix;\n    private String suffix;\n\n    @Override\n    public void configure(Context context) {\n        prefix = context.getString(\"prefix\");\n        suffix = context.getString(\"suffix\");\n    }\n\n    @Override\n    public Status process() throws EventDeliveryException {\n        Channel channel = getChannel();\n        Transaction tx = channel.getTransaction();\n        tx.begin();\n        // \u8bfb\u53d6 Channel \u4e2d\u7684\u4e8b\u4ef6\n        Event event;\n        while (true) {\n            event = channel.take();\n            if (event != null) {\n                break;\n            }\n        }\n        // \u5904\u7406\u4e8b\u4ef6\n        Status status;\n        try {\n            log.info(prefix + new String(event.getBody()) + suffix);\n            tx.commit();\n            status = Status.READY;\n        } catch (Exception e) {\n            tx.rollback();\n            status = Status.BACKOFF;\n        } finally {\n            tx.close();\n        }\n        return status;\n    }\n}\n</code></pre> <p>\u6253\u5305\u4e0a\u4f20\u81f3 Flume \u7684 <code>lib</code> \u76ee\u5f55\u3002</p> </li> <li> <p>\u914d\u7f6e\u6587\u4ef6 <code>flume-netcat-custom.conf</code></p> <pre><code># Agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Memory Channel\na1.channels.c1.type = memory\n\n# NetCat TCP Source\na1.sources.r1.channels = c1\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n# Custom Sink\na1.sinks.k1.channel = c1\na1.sinks.k1.type = xyz.icefery.demo.sink.MySink\na1.sinks.k1.prefix = custom-\na1.sinks.k1.suffix = -custom\n</code></pre> </li> </ul> <p></p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_31","title":"\u56db\u3001\u9762\u8bd5\u9898","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#41-flume","title":"4.1 \u4f60\u662f\u5982\u4f55\u5b9e\u73b0 Flume \u6570\u636e\u4f20\u8f93\u7684\u76d1\u63a7\u7684\uff1f","text":"<p>\u4f7f\u7528\u7b2c\u4e09\u65b9\u6846\u67b6 Ganglia \u5b9e\u65f6\u76d1\u63a7 Flume\u3002</p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#42-flume-sourcesinkchannel-source","title":"4.2 Flume \u7684 Source\u3001Sink\u3001Channel \u7684\u4f5c\u7528\uff1f\u4f60\u4eec Source \u662f\u4ec0\u4e48\u7c7b\u578b\uff1f","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#_32","title":"\u4f5c\u7528","text":"<ul> <li>Source \u7ec4\u4ef6\u662f\u4e13\u95e8\u7528\u6765\u6536\u96c6\u6570\u636e\u7684\uff0c\u53ef\u4ee5\u5904\u7406\u5404\u79cd\u7c7b\u578b\u3001\u5404\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\u6570\u636e\uff0c\u5305\u62ec Avro\u3001Thrift\u3001Exec\u3001JMS\u3001Spooling Directory\u3001NetCat\u3001Sequence Generator\u3001Syslog\u3001HTTP\u3001Legacy\u3002</li> <li>Sink \u7ec4\u4ef6\u662f\u7528\u4e8e\u628a\u6570\u636e\u53d1\u9001\u5230\u76ee\u7684\u5730\u7684\u7ec4\u4ef6\uff0c\u76ee\u7684\u5730\u5305\u62ec HDFS\u3001Logger\u3001Avro\u3001Thrift\u3001IPC\u3001File\u3001HBase\u3001Solor\u3001\u81ea\u5b9a\u4e49\u3002</li> <li>Channel \u7ec4\u4ef6\u5bf9\u91c7\u96c6\u5230\u7684\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff0c\u53ef\u4ee5\u5b58\u653e\u5728 Memory \u6216\u5728 File \u4e2d\u3002</li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#source_1","title":"Source \u7c7b\u578b","text":"<ul> <li>\u76d1\u63a7\u540e\u53f0\u65e5\u5fd7\uff1aExec</li> <li>\u76d1\u63a7\u540e\u53f0\u4ea7\u751f\u65e5\u5fd7\u7684\u7aef\u53e3\uff1aNetCat</li> </ul>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#43-flume-channel-selectors","title":"4.3 Flume \u7684 Channel Selectors","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#44-flume","title":"4.4 Flume \u53c2\u6570\u8c03\u4f18","text":""},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#source_2","title":"Source","text":"<p>\u589e\u52a0 Source \u4e2a\u6570\u53ef\u4ee5\u589e\u52a0 Source \u8bfb\u53d6\u6570\u636e\u7684\u80fd\u529b\uff08\u4f7f\u7528 Taildir Source \u65f6\u53ef\u589e\u52a0 FileGroup \u4e2a\u6570\uff09\u3002\u4f8b\u5982\uff1a\u5f53\u4e00\u4e2a\u76ee\u5f55\u4ea7\u751f\u7684\u6587\u4ef6\u8fc7\u591a\u65f6\u9700\u8981\u5c06\u8fd9\u4e2a\u6587\u4ef6\u76ee\u5f55\u62c6\u5206\u6210\u591a\u4e2a\u6587\u4ef6\u76ee\u5f55\uff0c\u540c\u65f6\u914d\u7f6e\u597d\u591a\u4e2a Source \u4ee5\u4fdd\u8bc1 Source \u6709\u8db3\u591f\u7684\u80fd\u529b\u83b7\u53d6\u5230\u65b0\u4ea7\u751f\u7684\u6570\u636e\u3002</p> <p><code>batchSize</code>\u53c2\u6570\u51b3\u5b9a Source \u4e00\u6b21\u6279\u91cf\u8fd0\u8f93\u5230 Channel \u7684 Event \u6761\u6570\uff0c\u9002\u5f53\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u63d0\u9ad8 Source \u642c\u8fd0 Event \u5230 Channel \u65f6\u7684\u6027\u80fd\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#channel_1","title":"Channel","text":"<p><code>type</code> \u9009\u62e9 <code>memory</code> \u65f6 Channel \u7684\u6027\u80fd\u6700\u597d\uff0c\u4f46\u662f\u5982\u679c Flume \u8fdb\u7a0b\u610f\u5916\u6302\u6389\u53ef\u80fd\u4f1a\u4e22\u5931\u6570\u636e\u3002<code>type</code> \u9009\u62e9 <code>file</code>\u65f6 Channel \u7684\u5bb9\u9519\u6027\u66f4\u597d\uff0c\u4f46\u662f\u6027\u80fd\u4f1a\u6bd4 Memory Channel \u5dee\u3002</p> <p>\u4f7f\u7528 File Channel \u65f6 <code>dataDirs</code> \u914d\u7f6e\u591a\u4e2a\u4e0d\u540c\u76d8\u4e0b\u7684\u76ee\u5f55\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002</p> <p><code>capacity</code> \u53c2\u6570\u51b3\u5b9a Channel \u53ef\u5bb9\u7eb3\u6700\u5927\u7684 Event \u6761\u6570\u3002<code>transactionCapacity</code> \u53c2\u6570\u51b3\u5b9a\u6bcf\u6b21 Source \u5f80 Channel \u91cc\u9762\u5199\u7684\u6700\u5927 Event \u6761\u6570\u548c\u6bcf\u6b21 Sink \u4ece Channel \u91cc\u9762\u8bfb\u7684\u6700\u5927\u7684 Event \u6761\u6570\u3002<code>transactionCapacity</code> \u9700\u8981\u5927\u4e8e Source \u548c Sink \u7684 <code>batchSize</code> \u53c2\u6570\u3002</p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#sink_1","title":"Sink","text":"<p>\u589e\u52a0 Sink \u7684\u4e2a\u6570\u53ef\u4ee5\u589e\u52a0 Sink \u6d88\u8d39 Event \u7684\u80fd\u529b\u3002Sink \u4e5f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u591f\u7528\u5c31\u884c\uff0c\u8fc7\u591a\u7684 Sink \u4f1a\u5360\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u9020\u6210\u7cfb\u7edf\u8d44\u6e90\u4e0d\u5fc5\u8981\u7684\u6d6a\u8d39\u3002</p> <p><code>batchSize</code> \u53c2\u6570\u51b3\u5b9a Sink \u4e00\u6b21\u6279\u91cf\u4ece Channel \u8bfb\u53d6\u7684 Event \u6761\u6570\uff0c\u9002\u5f53\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u63d0\u9ad8 Sink \u4ece Channel \u642c\u51fa Event \u7684\u6027\u80fd\u3002</p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#45-flume","title":"4.5 Flume \u7684\u4e8b\u52a1\u673a\u5236","text":"<p>Flume \u4f7f\u7528\u4e24\u4e2a\u72ec\u7acb\u7684\u4e8b\u52a1\u5206\u522b\u8d1f\u8d23\u4ece Source \u5230 Channel\uff0c\u4ee5\u53ca\u4ece Channel \u5230 Sink \u7684\u4e8b\u4ef6\u4f20\u9012\u3002</p> <p>\u6bd4\u5982 Spooling Directory Source \u4e3a\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u521b\u5efa\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u4e00\u65e6\u4e8b\u52a1\u4e2d\u6240\u6709\u7684\u4e8b\u4ef6\u5168\u90e8\u4f20\u9012\u5230 Channel \u4e14\u63d0\u4ea4\u6210\u529f\uff0c\u90a3\u4e48 Source \u5c31\u5c06\u8be5\u6587\u4ef6\u6807\u8bb0\u4e3a\u5b8c\u6210\u3002</p> <p>\u540c\u7406\uff0c\u4e8b\u52a1\u4ee5\u7c7b\u4f3c\u7684\u65b9\u5f0f\u5904\u7406 Channel \u5230 Sink \u7684\u4f20\u9012\u8fc7\u7a0b\uff0c\u5982\u679c\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u4f7f\u5f97\u4e8b\u4ef6\u65e0\u6cd5\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u4f1a\u56de\u6eda\u3002\u4e14\u6240\u6709\u7684\u4e8b\u4ef6\u90fd\u4f1a\u4fdd\u6301\u5230 Channel \u4e2d\uff0c\u7b49\u5f85\u91cd\u65b0\u4f20\u9012\u3002</p> <p></p>"},{"location":"bigdata/flume/Flume%20%E7%AC%94%E8%AE%B0/#46-flume","title":"4.6 Flume \u91c7\u96c6\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f","text":"<p>\u6839\u636e Flume \u7684\u67b6\u6784\u539f\u7406\uff0cFlume \u662f\u4e0d\u53ef\u80fd\u4e22\u5931\u6570\u636e\u7684\uff0c\u5176\u5185\u90e8\u6709\u5b8c\u5584\u7684\u4e8b\u52a1\u673a\u5236\uff0c Source \u5230 Channel \u662f\u4e8b\u52a1\u6027\u7684\uff0cChannel \u5230 Sink \u662f\u4e8b\u52a1\u6027\u7684\uff0c\u56e0\u6b64\u8fd9\u4e24\u4e2a\u73af\u8282\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u7684\u4e22\u5931\uff0c\u552f\u4e00\u53ef\u80fd\u4e22\u5931\u6570\u636e\u7684\u60c5\u51b5\u662f Channel \u91c7\u7528 Memory Channel\uff0cAgent \u5b95\u673a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff0c\u6216\u8005 Channel \u5b58\u50a8\u6570\u636e\u5df2\u6ee1\uff0c\u5bfc\u81f4 Source \u4e0d\u518d\u5199\u5165\uff0c\u672a\u5199\u5165\u7684\u6570\u636e\u4e22\u5931\u3002</p> <p>Flume \u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u4f46\u662f\u6709\u53ef\u80fd\u9020\u6210\u6570\u636e\u7684\u91cd\u590d\uff0c\u4f8b\u5982\u6570\u636e\u5df2\u7ecf\u7531 Sink \u53d1\u51fa\uff0c\u4f46\u662f\u6ca1\u6709\u63a5\u6536\u5230\u54cd\u5e94\uff0cSink \u4f1a\u518d\u6b21\u53d1\u9001\u6570\u636e\uff0c\u6b64\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u7684\u91cd\u590d\u3002</p>"},{"location":"bigdata/flume/__demo__/flume-demo-custom/","title":"Flume \u81ea\u5b9a\u4e49 Interceptor\u3001Source\u3001Sink","text":""},{"location":"bigdata/greenplum/","title":"Greenplum","text":""},{"location":"bigdata/greenplum/#_1","title":"\u6536\u85cf","text":""},{"location":"bigdata/greenplum/#greenplum_1","title":"Greenplum \u76ee\u5f55\u7ed3\u6784\u3001\u914d\u7f6e\u6587\u4ef6\u548c\u73af\u5883\u53d8\u91cf","text":""},{"location":"bigdata/greenplum/#greenplum6-jdbc-insert-mysql","title":"Greenplum6 JDBC insert \u6027\u80fd\u5ab2\u7f8e MySQL","text":""},{"location":"bigdata/greenplum/#greenplum_2","title":"greenplum \u5e38\u7528\u547d\u4ee4&amp;\u8fd0\u7ef4\u547d\u4ee4","text":""},{"location":"bigdata/greenplum/#_2","title":"\u5143\u6570\u636e","text":""},{"location":"bigdata/greenplum/#greenplum6","title":"Greenplum6 \u5206\u5e03\u7b56\u7565\u548c\u5206\u533a\u7b56\u7565","text":"<p>\u5173\u4e8e\u5904\u7406 <code>parkind = 'h'</code> \u7684\u54c8\u5e0c\u5206\u533a\u60c5\u51b5\uff0c\u56e0\u4e3a Greenplum6 \u53ef\u80fd\u4e0d\u652f\u6301\u54c8\u5e0c\u5206\u533a\u6216\u8be5\u529f\u80fd\u7684\u8868\u73b0\u5f62\u5f0f\u4e0d\u540c\uff0c\u901a\u5e38\u8be5\u503c\u4e0d\u88ab\u4f7f\u7528\u3002\u4f46\u662f\uff0c\u4e3a\u4e86\u63d0\u4f9b\u66f4\u5b8c\u6574\u7684\u67e5\u8be2\uff0c\u53ef\u4ee5\u5728 <code>case</code> \u8868\u8fbe\u5f0f\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5206\u652f\u4ee5\u6db5\u76d6\u8fd9\u79cd\u60c5\u51b5\u3002</p> <pre><code>select\n    pg_namespace.nspname as schema_name,\n    pg_class.relname     as table_name,\n    (case\n        when gp_distribution_policy.policytype = 'r'                                          then 'disteibuted replicated'\n        when gp_distribution_policy.policytype = 'p' and gp_distribution_policy.distkey = ''  then 'distributed randomly'\n        when gp_distribution_policy.policytype = 'p' and gp_distribution_policy.distkey != '' then 'disteibuted by (' || array_to_string(array(select attname from pg_attribute where attrelid = pg_class.oid and attnum = any(gp_distribution_policy.distkey)), ', ') || ')'\n    end) as distribution_policy,\n    (\n        (case\n            when pg_partition.parkind = 'r' then 'partition by range ('\n            when pg_partition.parkind = 'l' then 'partition by list ('\n            when pg_partition.parkind = 'h' then 'partition by hash ('\n        end)\n        ||\n        array_to_string(array(select attname from pg_attribute where attrelid = pg_class.oid and attnum = any(pg_partition.paratts)), ', ')\n        ||\n        ')'\n    ) as partition_policy\nfrom pg_catalog.pg_namespace\nleft join pg_catalog.pg_class               on pg_class.relnamespace           = pg_namespace.oid\nleft join pg_catalog.gp_distribution_policy on gp_distribution_policy.localoid = pg_class.oid\nleft join pg_catalog.pg_partition           on pg_partition.parrelid           = pg_class.oid\nwhere 1 = 1\n    and pg_namespace.nspname not in ('information_schema', 'pg_catalog', 'pg_toast', 'pg_aoseg', 'gp_bitmapindex', 'gp_toolkit')\n    and pg_class.relkind = 'r'\n    and not exists (select 1 from pg_catalog.pg_inherits where inhrelid = pg_class.oid)\norder by schema_name, table_name\n</code></pre>"},{"location":"bigdata/hadoop/","title":"Hadoop","text":""},{"location":"bigdata/hadoop/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":"<ul> <li> <p>\u542f\u52a8 hadoop \u65f6\u62a5\u9519\uff0cubuntu: datanode running as process 2934. Stop it first.\u89e3\u51b3\u529e\u6cd5</p> </li> <li> <p>Problems running Hadoop on Windows</p> </li> <li> <p>MapReduce \u6c42\u6700\u5927\u503c\u6700\u5c0f\u503c\u5e73\u5747\u503c\u6848\u4f8b</p> </li> <li> <p>\u4e00\u6587\u63a2\u7a76\u6570\u636e\u4ed3\u5e93\u4f53\u7cfb(2.7 \u4e07\u5b57\u5efa\u8bae\u6536\u85cf)</p> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/","title":"Hadoop 3.3.1 \u5b89\u88c5","text":""},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_1","title":"\u73af\u5883\u8bf4\u660e","text":"<ul> <li> <p><code>ubuntu-20.04</code></p> <ul> <li> <p>\u542f\u7528 <code>root</code> \u7528\u6237 SSH</p> </li> <li> <p>SSH \u514d\u5bc6\u767b\u5f55</p> </li> </ul> </li> <li> <p><code>jdk-8</code></p> <p><code>hadoop-3.3.1</code> \u7248\u672c\u5df2\u7ecf\u652f\u6301 <code>jdk-11</code></p> </li> <li> <p><code>zookeeper-3.7</code></p> <p>\u5730\u5740\uff1a<code>win10:2181,win10:2182,win10:2183</code></p> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_2","title":"\u53c2\u8003","text":"<ul> <li>hadoop \u4e3a\u4ec0\u4e48\u9700\u8981\u5728 hadoop-env.sh \u91cd\u65b0\u914d\u7f6e JAVA_HOME\uff1f</li> <li>HDFS_NAMENODE_USER, HDFS_DATANODE_USER &amp; HDFS_SECONDARYNAMENODE_USER not defined</li> <li>hadoop ha \u6a21\u5f0f\u4e0b\uff0ckill active \u7684 namenode \u8282\u70b9\u540e\uff0cstandby \u7684 namenode \u8282\u70b9\u6ca1\u80fd\u81ea\u52a8\u542f\u52a8</li> <li>Install Hadoop 3.3.0 on Windows 10 Step by Step Guide</li> <li>\u5916\u7f51\u65e0\u6cd5\u8bbf\u95ee HDFS \u89e3\u51b3\u65b9\u6cd5</li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#preudo-distributed","title":"Preudo-Distributed \u6a21\u5f0f","text":""},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_3","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HADOOP_HOME/etc/hadoop/hadoop-env.sh</code></p> <pre><code>export JAVA_HOME=/opt/jdk-8\nexport HADOOP_HOME=/opt/hadoop-3.3.1\nexport HDFS_NAMENODE_USER=root\nexport HDFS_SECONDARYNAMENODE_USER=root\nexport HDFS_DATANODE_USER=root\nexport YARN_RESOURCEMANAGER_USER=root\nexport YARN_NODEMANAGER_USER=root\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/workers</code></p> <pre><code>node101\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/core-site.xml</code></p> <p><code>hadoop.tmp.dir</code> \u4e0d\u80fd\u5f15\u7528\u73af\u5883\u53d8\u91cf</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;fs.defaultFS&lt;/name&gt;\n        &lt;value&gt;hdfs://node101:9000&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;\n        &lt;value&gt;/opt/hadoop-3.3.1/data&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;\n        &lt;value&gt;*&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;\n        &lt;value&gt;*&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</code></p> <p><code>dfs.replication</code> \u9ed8\u8ba4\u4e3a 3</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.client.use.datanode.hostname&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.replication&lt;/name&gt;\n        &lt;value&gt;1&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/yarn-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;\n        &lt;value&gt;604800&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/mapred-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.app.mapreduce.am.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.map.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.reduce.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;\n        &lt;value&gt;yarn&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#namenode","title":"\u683c\u5f0f\u5316 NameNode","text":"<pre><code>cd $HADOOP_HOME\nbin/hdfs namenode -format\n</code></pre> <p>\u5982\u9700\u91cd\u65b0\u683c\u5f0f\u5316\uff0c\u9700\u5148\u5220\u9664 <code>$HADOOP_HOME/data/dfs/name</code> \u76ee\u5f55</p>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_4","title":"\u542f\u52a8","text":"<pre><code>cd $HADOOP_HOME\nsbin/start-dfs.sh\nsbin/start-yarn.sh\nbin/mapred --daemon start historyserver\n</code></pre> <ul> <li>HDFS \u754c\u9762\uff1ahttp://node101:9870\u3001http://node101:9868</li> <li>YARN \u754c\u9762\uff1ahttp://node101:8088</li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#fully-distributed","title":"Fully-Distributed \u6a21\u5f0f","text":""},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_5","title":"\u96c6\u7fa4\u89c4\u5212","text":"hostname HDFS YARN node101 DataNode\u3001NameNode NodeManager node102 DataNode NodeManager\u3001ResourceManager\u3001JobHistoryServer node103 DataNode\u3001SecondaryNameNode NodeManager"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HADOOP_HOME/etc/hadoop/hadoop-env.sh</code></p> <p>\u4e0e Preudo-Distributed \u6a21\u5f0f\u76f8\u540c</p> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/workers</code></p> <pre><code>node101\nnode102\nnode103\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/core-site.xml</code></p> <p>\u4e0e Preudo-Distributed \u6a21\u5f0f\u76f8\u540c</p> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.client.use.datanode.hostname&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.http-address&lt;/name&gt;\n        &lt;value&gt;node101:9870&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;\n        &lt;value&gt;node103:9868&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/yarn-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;\n        &lt;value&gt;node102&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.log.server.url&lt;/name&gt;\n        &lt;value&gt;http://node102:19888/jobhistory/logs&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;\n        &lt;value&gt;604800&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/mapred-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n       &lt;property&gt;\n        &lt;name&gt;yarn.app.mapreduce.am.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.map.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.reduce.env&lt;/name&gt;\n        &lt;value&gt;HADOOP_MAPRED_HOME=${HADOOP_HOME}&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;\n        &lt;value&gt;yarn&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;\n        &lt;value&gt;node102:10020&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;\n        &lt;value&gt;node102:19888&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_7","title":"\u5206\u53d1\u914d\u7f6e","text":"<pre><code># node101\nrsync -a -r -v $HADOOP_HOME node102:/opt\nrsync -a -r -v $HADOOP_HOME node103:/opt\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#namenode_1","title":"\u683c\u5f0f\u5316 NameNode","text":"<pre><code># node101\ncd $HADOOP_HOMOE\nbin/hdfs namenode -format\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_8","title":"\u542f\u52a8","text":"<pre><code>cd $HADOOP_HOME\n# node101\nsbin/start-dfs.sh\n# node102\nsbin/start-yarn.sh\n# node102\nbin/mapred --daemon start historyserver\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_9","title":"\u9a8c\u8bc1","text":"<ul> <li> <p>\u5feb\u6377\u811a\u672c <code>$HADOOP_HOME/run.sh</code></p> <pre><code>#!/bin/bash\ncase $1 in\nstart)\n    ssh node101 \"${HADOOP_HOME}/sbin/start-dfs.sh\"\n    ssh node102 \"${HADOOP_HOME}/sbin/start-yarn.sh\"\n    ssh node102 \"${HADOOP_HOME}/sbin/mapred --daemon start historyserver\"\n;;\nstop)\n    ssh node101 \"${HADOOP_HOME}/sbin/stop-dfs.sh\"\n    ssh node102 \"${HADOOP_HOME}/sbin/stop-yarn.sh\"\n    ssh node102 \"${HADOOP_HOME}/sbin/mapred stop historyserver\"\n;;\nrsync)\n    for hostname in node101 node102 node103; do\n        if [[ \"$(hostname)\" != \"${hostname}\" ]]; then\n            echo \"========== ${hostname} ==========\"\n            rsync -a -r -v \"${HADOOP_HOME}\" \"${hostname}:/opt\"\n        fi\n    done\n;;\njps)\n    for hostname in node101 node102 node103; do\n        echo \"========== ${hostname} ==========\"\n        ssh \"${hostname}\" jps -mlvV\n    done\n;;\n*)\n    echo \"USAGE: $0 &lt;start | stop | rsync | jps&gt;\"\nesac\n</code></pre> <pre><code>chmod +x run.sh\n./run.sh jps\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#high-availability","title":"High-Availability \u6a21\u5f0f","text":""},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_10","title":"\u96c6\u7fa4\u89c4\u5212","text":"hostname HDFS YARN node101 DataNode\u3001NameNode NodeManager\u3001ResourceManager node102 DataNode\u3001NameNode NodeManager\u3001ResourceManager\u3001JobHistoryServer node103 DataNode\u3001NameNode NodeManager\u3001ResourceManager"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_11","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HADOOP_HOME/etc/hadoop/hadoop-env.sh</code></p> <p>HA \u6a21\u5f0f\u4e0d\u9700\u8981 SecondaryNameNode</p> <pre><code>export JAVA_HOME=/opt/jdk-8\nexport HADOOP_HOME=/opt/hadoop-3.3.1\nexport HDFS_NAMENODE_USER=root\nexport HDFS_DATANODE_USER=root\nexport HDFS_JOURNALNODE_USER=root\nexport HDFS_ZKFC_USER=root\nexport YARN_RESOURCEMANAGER_USER=root\nexport YARN_NODEMANAGER_USER=root\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/workers</code></p> <p>\u4e0e Fully-Distributed \u6a21\u5f0f\u76f8\u540c</p> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/core-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;fs.defaultFS&lt;/name&gt;\n        &lt;value&gt;hdfs://hdfs-cluster&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;\n        &lt;value&gt;/opt/hadoop-3.3.1/data&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.proxyuser.root.hosts&lt;/name&gt;\n        &lt;value&gt;*&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.proxyuser.root.groups&lt;/name&gt;\n        &lt;value&gt;*&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS Zookeeper \u5730\u5740 --&gt;\n    &lt;property&gt;\n        &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;\n        &lt;value&gt;win10:2181,win10:8182,win10:2183&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- YARN Zookeeper \u5730\u5740 --&gt;\n    &lt;property&gt;\n        &lt;name&gt;hadoop.zk.address&lt;/name&gt;\n        &lt;value&gt;win10:2181,win10:2182,win10:2183&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.client.use.datanode.hostname&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;!-- HDFS NN HA --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.nameservices&lt;/name&gt;\n        &lt;value&gt;hdfs-cluster&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.ha.namenodes.hdfs-cluster&lt;/name&gt;\n        &lt;value&gt;nn1, nn2, nn3&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS NN rpc --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.rpc-address.hdfs-cluster.nn1&lt;/name&gt;\n        &lt;value&gt;node101:8020&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.rpc-address.hdfs-cluster.nn2&lt;/name&gt;\n        &lt;value&gt;node102:8020&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.rpc-address.hdfs-cluster.nn3&lt;/name&gt;\n        &lt;value&gt;node103:8020&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS NN http --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.http-address.hdfs-cluster.nn1&lt;/name&gt;\n        &lt;value&gt;node101:9870&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.http-address.hdfs-cluster.nn2&lt;/name&gt;\n        &lt;value&gt;node102:9870&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.http-address.hdfs-cluster.nn3&lt;/name&gt;\n        &lt;value&gt;node103:9870&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS JournalNode --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;\n        &lt;value&gt;qjournal://node101:8485;node102:8485;node103:8485/hdfs-cluster&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;\n        &lt;value&gt;/opt/hadoop-3.3.1/data/dfs/journalnode/&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS fencing --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;\n        &lt;value&gt;\n            sshfence\n            shell(/bin/true)\n        &lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;\n        &lt;value&gt;/root/.ssh/id_rsa&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- HDFS automatic failover --&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;dfs.client.failover.proxy.provider.hdfs-cluster&lt;/name&gt;\n        &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/yarn-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- YARN RM HA --&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;\n        &lt;value&gt;yarn-cluster&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;\n        &lt;value&gt;rm1, rm2, rm3&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- YARN RM --&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;\n        &lt;value&gt;node101&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;\n        &lt;value&gt;node102&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.hostname.rm3&lt;/name&gt;\n        &lt;value&gt;node103&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- YARN RM http --&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.webapp.address.rm1&lt;/name&gt;\n        &lt;value&gt;node101:8088&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.webapp.address.rm2&lt;/name&gt;\n        &lt;value&gt;node102:8088&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.webapp.address.rm3&lt;/name&gt;\n        &lt;value&gt;node103:8088&lt;/value&gt;\n    &lt;/property&gt;\n\n    &lt;!-- YARN RM recovery --&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.recovery.enabled&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;yarn.resourcemanager.store.class&lt;/name&gt;\n        &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> <li> <p><code>$HADOOP_HOME/etc/hadoop/mapred-site.xml</code></p> </li> </ul> <p>\u4e0e Full-Distributed \u6a21\u5f0f\u76f8\u540c</p>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_12","title":"\u5206\u53d1\u914d\u7f6e","text":"<p>\u4e0e Full-Distributed \u6a21\u5f0f\u76f8\u540c</p>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#journalnode","title":"\u542f\u52a8 JournalNode","text":"<pre><code>cd $HADOOP_HOME\n# node101 | node102 | node103\nbin/hdfs --daemon start journalnode\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#namenode_2","title":"\u683c\u5f0f\u5316 NameNode","text":"<pre><code># node101\nbin/hdfs namenode -format\n# node102 | node103\nbin/hdfs namenode -bootstrapStandby\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#zk","title":"\u683c\u5f0f\u5316 ZK","text":"<pre><code># node102\nsbin/hdfs zkfs -formatZK\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_13","title":"\u542f\u52a8","text":"<pre><code>sbin/start-dfs.sh\nsbin/start-yarn.sh\n\n# node102\nbin/mapred --daemon start historyserver\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#ha","title":"HA \u72b6\u6001","text":"<pre><code># \u67e5\u770b\nbin/hdfs haadmin -getAllServiceState\nbin/yarn rmadmin -getAllServiceState\n\n# \u624b\u52a8\u5207\u6362\nbin/hdfs haadmin -transitionToActive --forceactive\nbin/yarn rmadmin -transitionToActive --forceactive\n</code></pre>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#wordcount","title":"WordCount","text":""},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#_14","title":"\u793a\u4f8b","text":"<ul> <li> <p>\u6587\u672c</p> <pre><code>cd $HADOOP_HOME\n\nmkdir -p input\n\ncat &gt; input/word.txt &lt;&lt;- EOF\ni keep saying no\nthis can not be the way it was supposed to be\ni keep saying no\nthere has gotta be a way to get you close to me\nEOF\n</code></pre> </li> <li> <p>\u4e0a\u4f20</p> <pre><code>bin/hadoop fs -mkdir /input\n\nbin/hadoop fs -put input/word.txt /input\n</code></pre> </li> <li> <p>\u6267\u884c</p> <pre><code>hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar wordcount /input /output\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#hdfs","title":"HDFS \u5ba2\u6237\u7aef","text":"<ul> <li> <p><code>winutils</code></p> <pre><code>wget https://github.com/kontext-tech/winutils/blob/master/hadoop-3.3.1/bin/winutils.exe\n\nmkdir -p /d/env/hadoop-3.3.1/bin\n\nmv winutils.exe /d/env/hadoop-3.3.1/bin\n</code></pre> <p>\u914d\u7f6e <code>HADOOP_HOME</code> \u5230\u73af\u5883\u53d8\u91cf</p> </li> <li> <p><code>pom.xml</code></p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n    &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n    &lt;version&gt;3.3.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u5728\u5ba2\u6237\u7aef\u6a21\u62df Hadoop \u96c6\u7fa4 DataNode \u7684 <code>hostname</code></p> <pre><code>echo '192.168.137.101 node101' &gt;&gt; /c/Windows/System32/drivers/etc/hosts\n</code></pre> </li> <li> <p>\u4e0b\u8f7d\u6587\u4ef6</p> <pre><code>public class Main {\n    public static final String CLASSPATH = Main.class.getResource(\"/\").toString();\n\n    public static void main(String[] args) throws IOException, InterruptedException {\n        Configuration conf = new Configuration();\n        conf.set(\"dfs.client.use.datanode.hostname\", \"true\");\n        FileSystem fs = FileSystem.get(URI.create(\"hdfs://node101:9000\"), conf, \"root\");\n        fs.copyToLocalFile(new Path(\"/input/word.txt\"), new Path(CLASSPATH + \"/word.txt\"));\n        fs.close();\n    }\n}\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/hadoop-3.3.1%20%E5%AE%89%E8%A3%85/#mapreduce","title":"MapReduce \u7a0b\u5e8f","text":"<ul> <li> <p><code>pom.xml</code></p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n    &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n    &lt;version&gt;3.3.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>&lt;plugin&gt;\n    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n    &lt;configuration&gt;\n        &lt;descriptorRefs&gt;\n            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n        &lt;/descriptorRefs&gt;\n    &lt;/configuration&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;make-assembly&lt;/id&gt;\n            &lt;phase&gt;package&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;single&lt;/goal&gt;\n            &lt;/goals&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre> </li> <li> <p>WordCount</p> <pre><code>public class WordCount {\n    public static void main(String[] args) throws IOException, InterruptedException, ClassNotFoundException {\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf);\n\n        job.setJarByClass(WordCount.class);\n\n        job.setMapperClass(WordCount.WordCountMapper.class);\n        job.setReducerClass(WordCount.WordCountReducer.class);\n\n        job.setMapOutputKeyClass(Text.class);\n        job.setMapOutputValueClass(IntWritable.class);\n\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(IntWritable.class);\n\n        FileInputFormat.setInputPaths(job, new Path(args[0]));\n        FileOutputFormat.setOutputPath(job, new Path(args[1]));\n\n        boolean result = job.waitForCompletion(true);\n        System.exit(result ? 0 : 1);\n    }\n\n    public static class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; {\n        @Override\n        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n            String line = value.toString();\n            String[] words = line.split(\" \");\n            for (String word : words) {\n                context.write(new Text(word), new IntWritable(1));\n            }\n        }\n    }\n\n    public static class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; {\n        @Override\n        protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException {\n            int count = 0;\n            for (IntWritable value : values) {\n                count += value.get();\n            }\n            context.write(key, new IntWritable(count));\n        }\n    }\n}\n</code></pre> </li> <li> <p>\u6253\u5305</p> <pre><code>mvn clean package\n</code></pre> </li> <li> <p>\u6267\u884c</p> <pre><code>cd $HADOOP_HOME\n\nbin/hadoop jar word-count-0.0.1-jar-with-dependencies.jar xyz.icefery.demo.WordCount /input /output\n\nbin/hadoop fs -get /output/part-r-00000 result.txt\n\ncat result.txt\n</code></pre> </li> </ul>"},{"location":"bigdata/hadoop/__demo__/hdfs-client/","title":"Index","text":"<pre><code>echo '192.168.137.101 node101' &gt;&gt; /c/Windows/System32/drivers/etc/hosts\n</code></pre> <pre><code>conf.set(\"dfs.client.use.datanode.hostname\",\"true\");\n</code></pre>"},{"location":"bigdata/hadoop/__demo__/word-count/","title":"Index","text":"<pre><code>mvn clean package\n</code></pre> <pre><code>cd $HADOOP_HOME\n\nbin/hadoop jar word-count-0.0.1-jar-with-dependencies.jar xyz.icefery.demo.WordCount /input /output\n\nbin/hadoop fs -get /output/part-r-00000 result.txt\n\ncat result.txt\n</code></pre>"},{"location":"bigdata/hadoop/__static__/config/fully/%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92/","title":"\u96c6\u7fa4\u89c4\u5212","text":"hostname HDFS YARN hadoop101 DataNode\u3001NameNode NodeManager hadoop102 DataNode NodeManager\u3001ResourceManager\u3001JobHistoryServer hadoop103 DataNode\u3001SecondaryNameNode NodeManager"},{"location":"bigdata/hadoop/hdfs/","title":"HDFS","text":""},{"location":"bigdata/hadoop/hdfs/#_1","title":"\u7ec4\u6210\u67b6\u6784","text":""},{"location":"bigdata/hadoop/hdfs/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<pre><code># \u4e0a\u4f20\nhadoop fs -put &lt;LOCAL&gt; &lt;HDFS&gt;\n\n# \u8ffd\u52a0\nhadoop -appendToFile &lt;LOCAL&gt; &lt;HDFS&gt;\n\n# \u4e0b\u8f7d\nhadoop fs -get &lt;HDFS&gt; &lt;LOCAL&gt;\n\n# \u8bbe\u7f6e\u526f\u672c\u6570\u91cf\nhadoop fs -setrep &lt;REPLICATION&gt; &lt;HDFS&gt;\n</code></pre>"},{"location":"bigdata/hadoop/map-reduce/","title":"MapReduce","text":""},{"location":"bigdata/hadoop/map-reduce/#_1","title":"\u6536\u85cf","text":""},{"location":"bigdata/hadoop/map-reduce/#mapreduce_1","title":"MapReduce \u6c42\u6700\u5927\u503c\u6700\u5c0f\u503c\u5e73\u5747\u503c\u6848\u4f8b","text":""},{"location":"bigdata/hadoop/yarn/","title":"Index","text":""},{"location":"bigdata/hadoop/yarn/#_1","title":"\u7ec4\u6210\u67b6\u6784","text":""},{"location":"bigdata/hbase/","title":"HBase","text":""},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/","title":"Hbase 2.3.6 \u5b89\u88c5","text":""},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_1","title":"\u73af\u5883\u8bf4\u660e","text":"<ul> <li> <p><code>ubuntu-20.04</code></p> </li> <li> <p><code>jdk-8</code></p> <p><code>hbase-2.3.6</code> \u652f\u6301 <code>jdk-11</code></p> </li> <li> <p><code>hadoop-3.3.1</code></p> </li> <li><code>zookeeper-3.7</code></li> </ul>"},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#preudo-distributed","title":"Preudo-Distributed \u6a21\u5f0f","text":""},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_2","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HBASE_HOME/conf/hbase-env.sh</code></p> <pre><code>export JAVA_HOME=/opt/jdk-8\nexport HBASE_MANAGES_ZK=false\nexport HBASE_DISABLE_HADOOP_CLASSPATH_LOOKUP=true\n</code></pre> </li> <li> <p><code>$HBASE_HOME/conf/hbase-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.rootdir&lt;/name&gt;\n        &lt;value&gt;hdfs://node101:9000/hbase&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;\n        &lt;value&gt;win10:2181,win10:2182,win10:2183&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> <p>\u6574\u5408 HDFS HA \u6a21\u5f0f\uff1a</p> <ul> <li> <p>\u62f7\u8d1d HDFS \u914d\u7f6e\u6587\u4ef6</p> <pre><code>ln -s $HADOOP_HOME/etc/hadoop/core-site.xml $HBASE_HOME/conf/core-site.xml\nln -s $HADOOP_HOME/etc/hadoop/hdfs-ste.xml $HBASE_HOME/conf/hdfs-site.xml\n</code></pre> </li> <li> <p>\u4fee\u6539 <code>hbase-site.xml</code></p> <pre><code>hbase.rootdir = hdfs://hdfs-cluster/hbase\n</code></pre> </li> </ul> </li> <li> <p><code>$HBASE_HOME/conf/regionservers</code></p> <pre><code>node101\n</code></pre> </li> </ul>"},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_3","title":"\u542f\u52a8","text":"<pre><code>cd $HBASE_HOME\nbin/start-hbase.sh\n</code></pre> <p>WEB \u754c\u9762 http://node101:16010\u3001http://node101:16030</p>"},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_4","title":"\u8fde\u63a5","text":"<pre><code>cd $HBASE_HOME\nbin/hbase shell\n</code></pre>"},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#fully-distributed","title":"Fully-Distributed \u6a21\u5f0f","text":""},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_5","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HBASE_HOME/conf/regionservers</code></p> <pre><code>node101\nnode102\nnode103\n</code></pre> </li> </ul>"},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#ha","title":"HA \u6a21\u5f0f","text":""},{"location":"bigdata/hbase/hbase-2.3.6%20%E5%AE%89%E8%A3%85/#_6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HBASE_HOME/conf/backup-masters</code></p> <pre><code>node102\nnode103\n</code></pre> </li> </ul>"},{"location":"bigdata/hbase/__homework__/homework-06/","title":"Index","text":""},{"location":"bigdata/hbase/__homework__/homework-06/#hbase-shell","title":"HBase Shell","text":"<pre><code>cd $HBASE_HOME\nbin/hbase shell\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#_1","title":"\u5efa\u8868","text":"<pre><code>create 'student', 'base', 'score'\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#_2","title":"\u63d2\u5165\u6570\u636e","text":"<pre><code>put 'student', '001', 'base:number',   '001'\nput 'student', '001', 'base:name',     'Tim'\nput 'student', '001', 'base:sex',      'm'\nput 'student', '001', 'base:prof',     'bigdata'\nput 'student', '001', 'scope:english', '80'\nput 'student', '001', 'score:math',    '72'\nput 'student', '001', 'score:java',    '85'\nput 'student', '001', 'scope:python',  '75'\nput 'student', '001', 'score:bigdata', '80'\n\nput 'student', '002', 'base:number',   'G02'\nput 'student', '002', 'base:nane',     'Lucy'\nput 'student', '002', 'base:sex',      'f'\nput 'student', '002', 'base:prof',     'bigdata'\nput 'student', '002', 'score:engLish', '78'\nput 'student', '002', 'score:math',    '68'\nput 'student', '002', 'score:java',    '88'\nput 'student', '002', 'scope:python',  '80'\nput 'student', '002', 'scope:bigdata', '76'\n\nput 'student', '003', 'base:number',   '003'\nput 'student', '003', 'base :name',    'Vivian'\nput 'student', '003', 'base:sex',      'f'\nput 'student', '003', 'base:prof',     'biz'\nput 'student', '003', 'score:engLish', '82'\nput 'student', '003', 'scone:math',    '70'\nput 'student', '003', 'score:market',  '88'\n\nput 'student', '004', 'base:number',   '604'\nput 'student', '004', 'base:name',     'GoLden'\nput 'student', '004', 'base:sex',      'm'\nput 'student', '004', 'base:prof',     'biz'\nput 'student', '004', 'score:engLish', '80'\nput 'student', '004', 'score:math',    '77'\nput 'student', '004', 'score:market',  '68'\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#rowkey001-scoremath","title":"\u67e5\u627e <code>rowKey=001</code> \u7684 <code>score:math</code>","text":"<pre><code>get 'student', '001', 'score:math'\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#rowkey","title":"\u6839\u636e <code>rowKey</code> \u5220\u9664","text":"<pre><code>deleteall 'student', '201831063120'\n\nscan 'student'\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#rowkey_1","title":"\u6839\u636e <code>rowKey</code> \u8303\u56f4\u67e5\u8be2","text":"<p>\u5de6\u95ed\u53f3\u5f00\u533a\u95f4 <code>[STARTROW, ENDROW)</code></p> <pre><code>count 'student'\n\nscan 'student', {COLUMN =&gt; 'base', STARTROWN =&gt; '001', ENDROW =&gt; '004'}\n</code></pre>"},{"location":"bigdata/hbase/__homework__/homework-06/#_3","title":"\u6761\u4ef6\u67e5\u8be2","text":"<pre><code>scan 'student', {FILTER =&gt; \"SingleColumnFilter('base','prof','=','binary:bigdata')\"}\n</code></pre>"},{"location":"bigdata/hdp/","title":"HDP","text":""},{"location":"bigdata/hdp/#_1","title":"\u6536\u85cf","text":""},{"location":"bigdata/hdp/#ambari-275-hdp315","title":"\u5b89\u88c5 Ambari 2.7.5 + HDP3.1.5\uff08\u9644\u5b89\u88c5\u5305\uff09","text":""},{"location":"bigdata/hdp/#ambari-ambari-bug","title":"ambari \u5b89\u88c5\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u8bef\u533a\uff08\u8df3\u5751\u6307\u5357\uff09\uff08ambari \u7684\u4e24\u4e2a bug \u4fee\u590d\uff09","text":""},{"location":"bigdata/hdp/#_2","title":"\u5b89\u88c5","text":"<pre><code>cp /var/www/html/ambari/centos7/2.7.5.0-72/ambari.repo /etc/yum.repos.d/\ncp /var/www/html/HDP/centos7/3.1.5.0-152/hdp.repo /etc/yum.repos.d/\ncp /var/www/html/HDP-GPL/centos7/3.1.5.0-152/hdp.gpl.repo /etc/yum.repos.d/\ncp /var/www/html/HDP-UTILS/centos7/1.1.0.22/hdp-utils.repo /etc/yum.repos.d/\n</code></pre> <pre><code>[ambari-2.7.5.0]\nname=ambari Version - ambari-2.7.5.0\nbaseurl=http://hdp-111/ambari/centos7/2.7.5.0-72\ngpgcheck=0\nenabled=1\npriority=1\n</code></pre> <pre><code>tee /etc/yum.repos.d/ambari.repo &gt; /dev/null &lt;&lt;- 'EOF'\n[ambari-2.7.5.0]\nname=ambari Version - ambari-2.7.5.0\nbaseurl=http://hdp-111/ambari/centos7/2.7.5.0-72\ngpgcheck=0\nenabled=1\npriority=1\nEOF\n\ntee /etc/yum.repos.d/hdp.repo &gt; /dev/null &lt;&lt;- 'EOF'\n[HDP-3.1.5.0]\nname=HDP Version - HDP-3.1.5.0\nbaseurl=http://hdp-111/HDP/centos7/3.1.5.0-152\ngpgcheck=0\nenabled=1\npriority=1\n\n[HDP-UTILS-1.1.0.22]\nname=HDP-UTILS Version - HDP-UTILS-1.1.0.22\nbaseurl=http://hdp-111/HDP-UTILS/centos7/1.1.0.22\ngpgcheck=0\nenabled=1\npriority=1\n\n[HDP-GPL-3.1.5.0]\nname=HDP-GPL Version - HDP-GPL-3.1.5.0\nbaseurl=http://hdp-111/HDP-GPL/centos7/3.1.5.0-152\ngpgcheck=0\nenabled=1\npriority=1\nEOF\n</code></pre>"},{"location":"bigdata/hive/","title":"Hive","text":""},{"location":"bigdata/hive/#_1","title":"\u6536\u85cf","text":""},{"location":"bigdata/hive/#hivemetastore","title":"\u8c03\u6574 HiveMetaStore \u5185\u5b58\u3002","text":"<p>\u8c03\u6574 hive_metastore_heapsize\uff08\u9ed8\u8ba4\u5185\u5b58 500 MiB\uff09\uff0c\u4f8b\u5982 2048\uff08\u4ee3\u8868 2 GiB \u5185\u5b58\uff09\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u9700\u8981\u53ca\u673a\u5668\u5185\u5b58\uff0c\u8c03\u6574 HiveMetastore \u5185\u5b58\u5927\u5c0f\u3002\u4fee\u6539\u5b8c\u6210\u540e\u5355\u51fb\u4fdd\u5b58\uff0c\u7136\u540e\u5728\u7ec4\u4ef6\u72b6\u6001\u9875\u9762\u91cd\u542f HiveMetaStore\uff0c\u89c2\u5bdf HiveMetaStore \u72b6\u6001\u3002</p>"},{"location":"bigdata/hive/#hiveserver2","title":"\u8c03\u6574 HiveServer2 \u5185\u5b58\u3002","text":"<p>\u8c03\u6574 hive_server2_heapsize\uff0c\u4f8b\u5982 2048\uff08\u4ee3\u8868 2 GiB \u5185\u5b58\uff09\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u9700\u8981\u53ca\u673a\u5668\u5185\u5b58\uff0c\u8c03\u6574 HiveServer2 \u5185\u5b58\u5927\u5c0f\u3002\u4fee\u6539\u5b8c\u6210\u540e\u5355\u51fb\u4fdd\u5b58\uff0c\u7136\u540e\u5728\u7ec4\u4ef6\u72b6\u6001\u9875\u9762\u91cd\u542f HiveServer2\uff0c\u89c2\u5bdf HiveServer2 \u72b6\u6001\u3002</p>"},{"location":"bigdata/hive/#hive-pk-maprucetezspark","title":"Hive \u8ba1\u7b97\u5f15\u64ce\u5927 PK\uff0c\u4e07\u5b57\u957f\u6587\u89e3\u6790 MapRuce\u3001Tez\u3001Spark \u4e09\u5927\u5f15\u64ce","text":""},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/","title":"Hive on Spark \u642d\u5efa","text":""},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#_1","title":"\u7248\u672c","text":"jdk <code>8</code> hadoop <code>3.1.3</code> spark <code>3.1.3</code> hive <code>3.1.3</code> \u624b\u52a8\u7f16\u8bd1"},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#hive","title":"Hive \u6e90\u7801\u7f16\u8bd1","text":""},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#_2","title":"\u4fee\u6539","text":"<p>hive3.1.4 \u6e90\u7801\u7f16\u8bd1\u517c\u5bb9 spark3.0.0 hive on spark hadoop3.x \u4fee\u6539\u6e90\u7801\u4f9d\u8d56 \u6b65\u9aa4\u8be6\u7ec6</p> <ul> <li> <p>\u5347\u7ea7 Guava \u4f9d\u8d56\u5230 <code>27.0-jre</code> \u7248\u672c</p> </li> <li> <p>\u89e3\u51b3 HIVE-19316 BUG</p> </li> <li> <p>\u5347\u7ea7 Spark \u4f9d\u8d56\u5230 <code>3.1.3</code> \u7248\u672c</p> </li> </ul>"},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#_3","title":"\u7f16\u8bd1","text":"<pre><code>mvn clean package -Pdist -DskipTests -Dmaven.javadoc.skip=true -fae\n</code></pre>"},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#hive-on-spark","title":"Hive on Spark","text":""},{"location":"bigdata/hive/Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/#hive_1","title":"Hive \u914d\u7f6e","text":"<ul> <li> <p>\u4e0a\u4f20 Spark \u7684 JAR \u5305\u5230 HDFS</p> <pre><code>$HADOOP_HOME/bin/hdfs dfs -mkdir /spark-jars\n\n$HADOOP_HOME/bin/hdfs dfs -put $SPARK_HOME/jars/* /spark-jars\n</code></pre> </li> <li> <p><code>conf/spark-defaults.conf</code></p> <pre><code>cp $SPARK_HOME/conf/spark-defaults.conf.template conf/spark-defaults.conf\n</code></pre> <pre><code>spark.master                     yarn\nspark.eventLog.enabled           true\nspark.eventLog.dir               hdfs://vm101:9000/spark-history\nspark.executor.memory            1g\nspark.driver.memory              1g\n</code></pre> </li> <li> <p><code>conf/hive-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n        &lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n        &lt;value&gt;jdbc:mysql://vm101:3306/hive&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hive.metastore.uris&lt;/name&gt;\n        &lt;value&gt;thrift://vm101:9083&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;\n        &lt;value&gt;vm101&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hive.execution.engine&lt;/name&gt;\n        &lt;value&gt;spark&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;spark.yarn.jars&lt;/name&gt;\n        &lt;value&gt;hdfs://vm101:9000/spark-jars/*&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> </ul>"},{"location":"bigdata/hive/Hive%20%E6%A0%B9%E6%8D%AE%E5%85%83%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF/","title":"Hive \u6839\u636e\u5143\u6570\u636e\u67e5\u8be2\u8868\u7ed3\u6784\u4fe1\u606f","text":""},{"location":"bigdata/hive/Hive%20%E6%A0%B9%E6%8D%AE%E5%85%83%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF/#_1","title":"\u67e5\u8be2\u8868\u7ed3\u6784\u4fe1\u606f","text":"<pre><code>select\n    DBS.name                    as schema_name,\n    TBLS.tbl_name               as table_name,\n    TABLE_PARAMS.param_value    as table_comment,\n    COLUMNS_V2.column_name      as column_name,\n    COLUMNS_V2.type_name        as column_type,\n    COLUMNS_V2.comment          as column_comment,\n    PARTITION_KEYS.pkey_name    as partition_column_name,\n    PARTITION_KEYS.pkey_type    as partition_column_type,\n    PARTITION_KEYS.pkey_comment as partition_column_comment\nfrom hive.DBS\n    left join hive.TBLS           on TBLS.db_id = DBS.db_id\n    left join hive.TABLE_PARAMS   on TABLE_PARAMS.tbl_id = TBLS.tbl_id and TABLE_PARAMS.param_key = 'comment'\n    left join hive.SDS            on SDS.sd_id = TBLS.sd_id\n    left join hive.COLUMNS_V2     on COLUMNS_V2.cd_id = SDS.cd_id\n    left join hive.PARTITION_KEYS on PARTITION_KEYS.tbl_id = TBLS.tbl_id\norder by DBS.name, TBLS.tbl_name, COLUMNS_V2.integer_idx\n</code></pre>"},{"location":"bigdata/hive/Hive%20%E6%A0%B9%E6%8D%AE%E5%85%83%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF/#_2","title":"\u6536\u85cf","text":"<ul> <li>Hive \u7b14\u8bb0 6-hive \u5143\u6570\u636e\u8868\u7ed3\u6784\u8be6\u89e3</li> </ul>"},{"location":"bigdata/hive/Hive%20%E7%BB%9F%E8%AE%A1%E5%90%84%E5%88%86%E5%8C%BA%E6%95%B0%E6%8D%AE%E9%87%8F/","title":"Hive \u7edf\u8ba1\u5404\u5206\u533a\u6570\u636e\u91cf","text":""},{"location":"bigdata/hive/Hive%20%E7%BB%9F%E8%AE%A1%E5%90%84%E5%88%86%E5%8C%BA%E6%95%B0%E6%8D%AE%E9%87%8F/#_1","title":"\u7edf\u8ba1\u5404\u5206\u533a\u6570\u636e\u91cf","text":"<pre><code>select t1.schema_name, t1.table_name, t2.table_comment, t3.partition_name, t4.num_files, t4.num_rows, t4.total_size\nfrom (\n    select TBLS.tbl_id, DBS.name as schema_name, TBLS.tbl_name as table_name\n    from hive.DBS\n    join hive.TBLS ON TBLS.db_id = DBS.db_id\n) t1\nleft join (\n    select tbl_id, param_value as table_comment\n    from hive.table_params\n    where param_key = 'comment'\n) t2\nleft join (\n    select part_id, tbl_id, part_name as partition_name\n    from hive.PARTITIONS\n) t3\nleft join (\n    select\n      part_id,\n        max(if(param_key = 'numFiles',  param_value + 0, null)) as num_files,\n        max(if(param_key = 'numRows',   param_value + 0, null)) as num_rows,\n        max(if(param_key = 'totalSize', param_value + 0, null)) as total_size\n    from hive.PARTITION_PARAMS\n    group by part_id\n) t4 on t4.part_id = t3.part_id\norder by t1.schema_name, t1.table_name, t3.partition_name desc\n</code></pre>"},{"location":"bigdata/hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/","title":"Hive \u884c\u5217\u8f6c\u6362","text":"<p>\u5728\u5b9e\u9645\u4f7f\u7528 Hive \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e38\u5e38\u4f1a\u6d89\u53ca\u5230\u884c\u5217\u8f6c\u6362\uff0c\u7ec6\u5206\u7684\u8bdd\uff0c\u6709\u4e0b\u9762 4 \u79cd\u7c7b\u578b\u7684\u884c\u5217\u8f6c\u6362\uff0c\u5206\u522b\u662f\uff1a</p> <ol> <li>\u884c\u8f6c\u591a\u5217</li> <li>\u591a\u5217\u8f6c\u884c</li> <li>\u884c\u8f6c\u5355\u5217</li> <li>\u5355\u5217\u8f6c\u884c</li> </ol>"},{"location":"bigdata/hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/#_1","title":"\u884c\u8f6c\u591a\u5217","text":"<p>\u5982\u679c\u9700\u8981\u5c06\u4e0a\u9762\u7684\u6837\u4f8b\u8868\u8f6c\u6362\u4e3a <code>\u59d3\u540d | \u8bed\u6587\u6210\u7ee9 | \u6570\u5b66\u6210\u7ee9 | \u82f1\u8bed\u6210\u7ee9</code> \u8fd9\u6837\u7684\u683c\u5f0f\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7528\u5230\u884c\u8f6c\u591a\u5217\u3002 \u6d89\u53ca\u5230\u884c\u8f6c\u6210\u5217\uff0c\u80af\u5b9a\u662f\u4f1a\u6309\u7167\u67d0\u4e00\u5217\u6216\u8005\u67d0\u51e0\u5217\u7684\u503c\u8fdb\u884c\u5206\u7ec4\u6765\u538b\u7f29\u884c\u6570\uff0c\u6240\u6709\u4f1a\u7528\u5230 <code>group by</code>\u3002\u5206\u7ec4\u4e4b\u540e\u9700\u8981\u7528\u5230\u805a\u5408\u51fd\u6570\uff0c\u7531\u4e8e\u591a\u5217\u4e2d\u7684\u6bcf\u5217\u53ea\u5173\u5fc3\u81ea\u5df1\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u6240\u4ee5\u8981\u4f7f\u7528 <code>case</code> \u8bed\u53e5\u6765\u8fdb\u884c\u9009\u62e9\uff0c\u81f3\u4e8e\u805a\u5408\u51fd\u6570\uff0c\u53ea\u8981\u80fd\u4fdd\u8bc1\u552f\u4e00\u6027\uff0c<code>max</code>\u3001<code>min</code>\u3001<code>sum</code> \u7b49\u90fd\u53ef\u4ee5\u3002</p> <pre><code>with score_vertical as (\n    select 'A' as name, '\u8bed\u6587' as subject, '70' as score union all\n    select 'A' as name, '\u6570\u5b66' as subject, '90' as score union all\n    select 'A' as name, '\u82f1\u8bed' as subject, '80' as score union all\n    select 'B' as name, '\u8bed\u6587' as subject, '75' as score union all\n    select 'B' as name, '\u6570\u5b66' as subject, '95' as score union all\n    select 'B' as name, '\u82f1\u8bed' as subject, '85' as score\n)\nselect\n      name,\n      max(case when subject = '\u8bed\u6587' then score end) as chinese,\n      max(case when subject = '\u6570\u5b66' then score end) as math,\n      max(case when subject = '\u82f1\u8bed' then score end) as english\nfrom score_vertical\ngroup by name;\n</code></pre>"},{"location":"bigdata/hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/#_2","title":"\u884c\u8f6c\u5355\u5217","text":"<p>\u5c06\u539f\u59cb\u8868\u8f6c\u6362\u4e3a <code>\u59d3\u540d | \u6240\u6709\u79d1\u76ee\u6210\u7ee9\u96c6\u5408</code> \u5219\u6d89\u53ca\u5230\u884c\u8f6c\u5355\u5217\u3002 \u548c\u884c\u8f6c\u591a\u5217\u4e00\u6837\uff0c\u884c\u6570\u4f1a\u51cf\u5c11\uff0c\u6240\u4ee5\u9700\u8981\u7528\u5230 <code>group by</code>\uff0c\u7136\u540e\u8f6c\u6210\u7684\u662f\u5355\u5217\uff0c\u6240\u4ee5\u9700\u8981\u7528\u5230 <code>collect_list</code> \u6216\u8005 <code>collect_set</code> \u805a\u5408\u51fd\u6570\uff0c\u5982\u679c\u5b57\u6bb5\u7c7b\u578b\u60f3\u8981\u662f\u6709\u5206\u9694\u7b26\u9694\u5f00\u7684\u5b57\u7b26\u4e32\uff0c\u518d\u5957\u4e0a\u4e00\u5c42 <code>concat_ws</code>\uff1b \u4e0a\u9762\u7684\u65b9\u6848\u5f97\u51fa\u7684 <code>array</code> \u6216\u8005\u5b57\u7b26\u4e32\u662f\u4e71\u5e8f\u7684\uff0c\u5982\u679c\u60f3\u8981\u8fdb\u884c\u6392\u5e8f\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>sort_array</code> \u53ea\u80fd\u6309\u5b57\u6bb5\u7c7b\u578b\u7684\u5347\u5e8f\u6392\u5e8f\uff08\u6570\u503c\u5b57\u6bb5\u81ea\u7136\u5e8f\uff0c\u5b57\u7b26\u4e32\u5b57\u6bb5\u5b57\u5178\u5e8f\uff09\uff1b \u5982\u679c\u60f3\u8981\u81ea\u5df1\u6307\u5b9a\u6392\u5e8f\u89c4\u5219\uff0c\u6216\u8005\u6392\u5e8f\u7684\u4e0d\u662f\u5355\u5217\u91cc\u7684\u8fd9\u4e2a\u5b57\u6bb5\uff08\u6bd4\u5982\u73ed\u7ea7\u8003\u8bd5\u6210\u7ee9\u8868\uff0c\u6240\u6709\u5206\u6570\u5b57\u6bb5\u91cc\u9700\u8981\u6839\u636e\u5b66\u79d1\u8fdb\u884c\u6392\u5e8f\uff0c\u800c\u4e0d\u662f\u5206\u6570\u9ad8\u4f4e\uff09\uff0c\u5219\u9700\u8981\u4f7f\u7528 <code>collect_list</code> \u52a0\u4e0a <code>over</code> \u5b50\u53e5\u6765\u5b9e\u73b0\u3002</p> <ul> <li>\u6210\u7ee9\u4e0d\u6392\u5e8f     <pre><code>with score_vertical as (\n    select 'A' as name, '\u8bed\u6587' as subject, '70' as score union all\n    select 'A' as name, '\u6570\u5b66' as subject, '90' as score union all\n    select 'A' as name, '\u82f1\u8bed' as subject, '80' as score union all\n    select 'B' as name, '\u8bed\u6587' as subject, '75' as score union all\n    select 'B' as name, '\u6570\u5b66' as subject, '95' as score union all\n    select 'B' as name, '\u82f1\u8bed' as subject, '85' as score\n)\nselect name, concat_ws(',', collect_list(score)) as scores\nfrom score_vertical\ngroup by name;\n</code></pre></li> <li>\u6309\u5206\u6570\u9ad8\u4f4e\u6392\u5e8f     <pre><code>with score_vertical as (\n    select 'A' as name, '\u8bed\u6587' as subject, '70' as score union all\n    select 'A' as name, '\u6570\u5b66' as subject, '90' as score union all\n    select 'A' as name, '\u82f1\u8bed' as subject, '80' as score union all\n    select 'B' as name, '\u8bed\u6587' as subject, '75' as score union all\n    select 'B' as name, '\u6570\u5b66' as subject, '95' as score union all\n    select 'B' as name, '\u82f1\u8bed' as subject, '85' as score\n)\nselect name, concat_ws(',', sort_array(collect_list(score))) as scores\nfrom score_vertical\ngroup by name;\n</code></pre></li> <li>\u6309\u5b66\u79d1\u8fdb\u884c\u6392\u5e8f     <pre><code>with score_vertical as (\n    select 'A' as name, '\u8bed\u6587' as subject, '70' as score union all\n    select 'A' as name, '\u6570\u5b66' as subject, '90' as score union all\n    select 'A' as name, '\u82f1\u8bed' as subject, '80' as score union all\n    select 'B' as name, '\u8bed\u6587' as subject, '75' as score union all\n    select 'B' as name, '\u6570\u5b66' as subject, '95' as score union all\n    select 'B' as name, '\u82f1\u8bed' as subject, '85' as score\n)\nselect name, concat_ws(',', max(scores)) as scores\nfrom (\n      select name, collect_list(score) over(partition by name order by subject rows between unbounded preceding and unbounded following) as scores\n      from score_vertical\n) t\ngroup by name;\n</code></pre></li> </ul>"},{"location":"bigdata/hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/#_3","title":"\u591a\u5217\u8f6c\u884c","text":"<p>\u5217\u8f6c\u884c\u4f1a\u6d89\u53ca\u5230\u884c\u6570\u7684\u589e\u52a0\uff0c\u6240\u4ee5\u4f1a\u7528\u5230 UDTF\uff08\u81ea\u5b9a\u4e49\u8868\u503c\u51fd\u6570\uff09,\u800c UDTF \u53ea\u662f\u9488\u5bf9\u67d0\u4e00\u5217\u7684\uff0c\u8981\u628a\u8fd9\u5217\u6269\u5c55\u540e\u751f\u6210\u7684\u591a\u884c\u6570\u636e\u548c\u539f\u8868\u4e2d\u7684\u5404\u5217\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u9700\u8981\u7528\u5230 <code>lateral view</code> \u8bed\u6cd5\uff1b \u9700\u8981\u5c06\u591a\u5217\u91cc\u5404\u5217\u7684\u5217\u540d\uff08\u4e1a\u52a1\u542b\u4e49\uff09\u5728\u65b0\u6570\u636e\u4e2d\u5f53\u6210\u4e00\u4e2a\u6807\u8bc6\u5217\uff0c\u800c\u4e0e <code>lateral view</code> \u8054\u5408\u4f7f\u7528\u7684 <code>explode</code> \u51fd\u6570\u662f\u652f\u6301 <code>map</code> \u7c7b\u578b\u7684\uff0c\u6240\u4ee5\u8981\u5148\u5c06\u539f\u8868\u91cc\u7684\u591a\u5217\u53d8\u6362\u6210 <code>map</code> \u7c7b\u578b\u7684\u4e00\u5217\uff0c\u7136\u540e\u518d\u4f7f\u7528 <code>lateral view</code> \u62c6\u5f00\u3002</p> <pre><code>with score_horizontal as (\n    select 'A' as name, '70' as chinese, '90' as math, '80' as english union all\n    select 'B' as name, '75' as chinese, '95' as math, '85' as english\n)\nselect t1.name, t2.subject, t2.score\nfrom (\n      select name, map('\u8bed\u6587', chinese, '\u6570\u5b66', math, '\u82f1\u8bed', english) as scores\n      from score_horizontal\n) t1\nlateral view explode(scores) t2 as subject, score;\n</code></pre>"},{"location":"bigdata/hive/Hive%20%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/#_4","title":"\u5355\u5217\u8f6c\u884c","text":"<p>\u548c\u591a\u5217\u8f6c\u884c\u4e00\u6837\uff0c\u4f7f\u7528 <code>lateral view</code> \u52a0 <code>explode</code> \u6765\u8f6c\u6362\u3002\u4f46\u8fd9\u79cd\u65b9\u5f0f\u8f6c\u6362\u51fa\u6765\u4f1a\u4e22\u5931\u6389\u79d1\u76ee\u4fe1\u606f\uff0c\u5219\u9700\u8981\u6309\u7167\u5355\u5217\u91cc\u9762\u7684\u987a\u5e8f\u7684\u4e1a\u52a1\u542b\u4e49\uff0c\u5148\u5c06\u5355\u5217\u8f6c\u6210 <code>map</code> \u7c7b\u578b\uff0c\u5c06\u79d1\u76ee\u52a0\u5230\u6570\u636e\u91cc\uff0c\u7136\u540e\u518d\u4f7f\u7528 <code>lateral view</code> \u8f6c\u6362\u3002</p> <ul> <li> <p>\u65e0\u79d1\u76ee\u5b57\u6bb5</p> <pre><code>with score_horizontal as (\n    select 'A' as name, '70,90,80' as scores union all\n    select 'B' as name, '75,95,85' as scores\n)\nselect t1.name, t2.score\nfrom (\n    select name, split(scores, ',') as scores\n    from score_horizontal\n) t1\nlateral view explode(scores) t2 as score;\n</code></pre> </li> <li> <p>\u6709\u79d1\u76ee\u5b57\u6bb5     <pre><code>with score_horizontal as (\n  select 'A' as name, '70,90,80' as scores union all\n  select 'B' as name, '75,95,85' as scores\n)\nselect t2.name, t3.subject, t3.score\nfrom (\n    select name, map('\u8bed\u6587', scores[0], '\u6570\u5b66', scores[1], '\u82f1\u8bed', scores[2]) as scores\n    from (\n        select name, split(scores, ',') as scores\n        from score_horizontal\n    ) t1\n) t2\nlateral view explode(scores) t3 as subject, score;\n</code></pre></p> </li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/","title":"Hive 2.3.9 \u5b89\u88c5","text":""},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_1","title":"\u73af\u5883\u8bf4\u660e","text":"<ul> <li> <p><code>ubuntu-20.04</code></p> </li> <li> <p><code>jdk-8</code></p> <p><code>hive-2.3.9</code>\u652f\u6301 <code>jdk-11</code>\uff0c\u4f46 <code>hive-3.1.2</code> \u4e0d\u652f\u6301</p> </li> <li> <p><code>hadoop-3.3.1</code></p> </li> <li> <p><code>mysql-8.0</code></p> <pre><code>CREATE DATABASE hive;\n</code></pre> <pre><code>CREATE USER 'hive'@'%' IDENTIFIED BY 'hive';\nGRANT ALL PRIVILEGES ON hive.* TO 'hive'@'%';\nFLUSH PRIVILEGES;\n</code></pre> </li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_2","title":"\u53c2\u8003","text":"<ul> <li>hive \u4f7f\u7528 hiveserver2\u3001beeline \u542f\u52a8\u8e29\u8fc7\u7684\u5751 User: root is not allowed to impersonate root</li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_3","title":"\u8fdc\u7a0b\u6a21\u5f0f","text":""},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#jar","title":"\u89e3\u51b3 JAR \u5305\u51b2\u7a81","text":"<pre><code>rm $HIVE_HOME/lib/guava-19.0.jar\n\ncp $HADOOP_HOME/share/hadoop/common/lib/guava-27.0-jre.jar $HIVE_HOME/lib\n</code></pre>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_4","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>$HIVE_HOME/conf/hive-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n        &lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n        &lt;value&gt;jdbc:mysql://win10:3306/hive&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n        &lt;value&gt;root&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hive.metastore.uris&lt;/name&gt;\n        &lt;value&gt;thrift://node101:9083&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;\n        &lt;value&gt;node101&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_5","title":"\u521d\u59cb\u5316\u5143\u6570\u636e\u5e93","text":"<ul> <li> <p>\u4e0b\u8f7d\u9a71\u52a8</p> <pre><code>wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.18/mysql-connector-java-8.0.18.jar -P $HIVE_HOME/lib\n</code></pre> </li> <li> <p>\u521d\u59cb\u5316</p> <pre><code>cd $HIVE_HOME\nbin/schematool -initSchema -dbType mysql\n</code></pre> </li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_6","title":"\u542f\u52a8","text":"<ul> <li> <p>\u542f\u52a8 MetaStore</p> <pre><code>nohup bin/hive --service metastore 1&gt;/dev/null 2&gt;&amp;1 &amp;\n</code></pre> </li> <li> <p>\u542f\u52a8 HiveServer2</p> <pre><code>nohup bin/hive --service hiveserver2 1&gt;/dev/null 2&gt;&amp;1 &amp;\n</code></pre> </li> <li> <p>\u4fbf\u6377\u811a\u672c <code>run.sh</code></p> <pre><code>#!/bin/bash\ncase $1 in\nstart)\n  nohup bin/hive --service metastore 1&gt;/dev/null 2&gt;&amp;1 &amp;\n  nohup bin/hive --service hiveserver2 1&gt;/dev/null 2&gt;&amp;1 &amp;\n;;\nstop)\n  kill -9 $(jps -ml | grep 'HiveMetaStore' | awk '{print $1}')\n  kill -9 $(jps -ml | grep 'HiveServer2' | awk '{print $1}')\n;;\n*)\n  echo \"USAGE: $0 &lt;start | stop&gt;\"\nesac\n</code></pre> <pre><code>chmod +x run.sh\n./run.sh start\n</code></pre> </li> <li> <p>WEB \u754c\u9762 http://node101:10002</p> </li> </ul>"},{"location":"bigdata/hive/hive-2.3.9%20%E5%AE%89%E8%A3%85/#_7","title":"\u8fde\u63a5","text":"<ul> <li> <p>CLI \u65b9\u5f0f</p> <pre><code>bin/hive\n</code></pre> </li> <li> <p>JDBC \u65b9\u5f0f</p> <pre><code>bin/beeline -u jdbc:hive2://node101:10000 -n roo\n</code></pre> </li> </ul>"},{"location":"bigdata/hive/__demo__/hive-udf-demo/","title":"Index","text":""},{"location":"bigdata/hive/__demo__/hive-udf-demo/#_1","title":"\u6ce8\u518c\u51fd\u6570","text":"<pre><code>bin/hdfs dfs -mkdir -p /hive\nbin/hdfs dfs -put hive-udf-demo-0.0.1-all.jar /hive\n</code></pre> <pre><code>drop function if exists zodiac;\ncreate function zodiac as 'xyz.icefery.demo.Zodiac' using jar 'hdfs:///hive/hive-udf-demo-0.0.1-all.jar';\n\ndrop function if exists json_array_flat;\ncreate function json_array_flat as 'xyz.icefery.demo.JsonArrayFlat' using jar 'hdfs:///hive/hive-udf-demo-0.0.1-all.jar';\n</code></pre>"},{"location":"bigdata/phoenix/","title":"Phoenix","text":""},{"location":"bigdata/phoenix/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"bigdata/phoenix/#hbase","title":"HBase \u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>hbase-site.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.rootdir&lt;/name&gt;\n        &lt;value&gt;hdfs://vm101:9000/hbase&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;\n        &lt;value&gt;vm101:2181&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;hbase.regionserver.wal.codec&lt;/name&gt;\n        &lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec&lt;/value&gt;\n    &lt;/property&gt;\n    &lt;property&gt;\n        &lt;name&gt;phoenix.schema.isNamespaceMappingEnabled&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> </li> </ul> <pre><code>cp $PHOENIX_HOME/phoenix-server-hbase-2.3-5.1.2.jar $HBASE_HOME/lib\n\nln -sf $HBASE_HOME/conf/hbase-site.xml $PHOENIX_HOME/bin/hbase-site.xml\n</code></pre>"},{"location":"bigdata/spark/","title":"Spark","text":""},{"location":"bigdata/spark/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"bigdata/spark/#_2","title":"\u5b89\u88c5","text":"<pre><code>wget https://archive.apache.org/dist/spark/spark-3.1.3/spark-3.1.3-bin-without-hadoop.tgz\n</code></pre>"},{"location":"bigdata/spark/#_3","title":"\u914d\u7f6e","text":"<ul> <li> <p><code>conf/spark-env.sh</code></p> <pre><code>JAVA_HOME=/opt/env/jdk-8\nSPARK_DIST_CLASSPATH=$(/opt/env/hadoop/bin/hadoop classpath)\nSPARK_MASTER_HOST=vm101\nSPARK_MASTER_PORT=7077\n</code></pre> </li> <li> <p><code>conf/workers</code></p> <pre><code>vm101\n</code></pre> </li> </ul>"},{"location":"bigdata/spark/#_4","title":"\u542f\u52a8","text":"<pre><code>sbin/start-all.sh\n</code></pre>"},{"location":"bigdata/spark/#_5","title":"\u6536\u85cf","text":""},{"location":"bigdata/spark/#spark_1","title":"Spark \u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b\u8bf4\u660e","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/","title":"Spark on Kubernetes","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#spark-on-native-kubernetes","title":"Spark on Native Kubernetes","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#_1","title":"\u67b6\u6784","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#rbac","title":"RBAC","text":"<pre><code>kubectl create namespace spark\nkubectl --namespace spark create serviceaccount spark\nkubectl create clusterrolebinding spark-role --clusterrole=edit --serviceaccount=spark:spark\n</code></pre>"},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#_2","title":"\u63d0\u4ea4\u4f5c\u4e1a","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#client","title":"Client \u6a21\u5f0f","text":"<pre><code>SPARK_VERSION=\"3.3.2\"\nSPARK_DRIVER_HOST=\"192.168.8.101\"\n\nbin/spark-submit \\\n  --master k8s://https://127.0.0.1:6443 \\\n  --deploy-mode client \\\n  --name spark-pi \\\n  --class org.apache.spark.examples.SparkPi \\\n  --conf spark.driver.host=${SPARK_DRIVER_HOST} \\\n  --conf spark.executor.instances=3 \\\n  --conf spark.kubernetes.namespace=spark \\\n  --conf spark.kubernetes.authenticate.driver.serviceAccountName=spark \\\n  --conf spark.kubernetes.container.image=apache/spark:v${SPARK_VERSION} \\\n  examples/jars/spark-examples_2.12-${SPARK_VERSION}.jar\n</code></pre>"},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#cluster","title":"Cluster \u6a21\u5f0f","text":"<pre><code>SPARK_VERSION=\"3.3.2\"\n\nbin/spark-submit \\\n  --master k8s://http://127.0.0.1:6443 \\\n  --deploy-mode cluster \\\n  --name spark-pi \\\n  --class org.apache.spark.examples.SparkPi \\\n  --conf spark.executor.instances=3 \\\n  --conf spark.kubernetes.namespace=spark \\\n  --conf spark.kubernetes.authenticate.driver.serviceAccountName=spark \\\n  --conf spark.kubernetes.container.image=apache/spark:v${SPARK_VERSION} \\\n  local:///opt/spark/examples/jars/spark-examples_2.12-${SPARK_VERSION}.jar\n</code></pre>"},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#_3","title":"\u6536\u85cf","text":""},{"location":"bigdata/spark/Spark%20on%20Kubernetes/#spark-on-k8s","title":"Spark on K8s \u5728\u8304\u5b50\u79d1\u6280\u7684\u5b9e\u8df5","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/","title":"Spark \u7b14\u8bb0","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark","title":"\u4e00\u3001Spark \u8fd0\u884c\u67b6\u6784","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#11","title":"1.1 \u8fd0\u884c\u67b6\u6784","text":"<p>Spark \u6846\u67b6\u7684\u6838\u5fc3\u662f\u4e00\u4e2a\u8ba1\u7b97\u5f15\u64ce\uff0c\u6574\u4f53\u6765\u8bf4\uff0c\u5b83\u91c7\u7528\u4e86\u6807\u51c6\u7684 master-slave \u7684\u7ed3\u6784\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5b83\u5c55\u793a\u4e86\u4e00\u4e2a Spark \u6267\u884c\u65f6\u7684\u57fa\u672c\u7ed3\u6784\u3002\u56fe\u5f62\u4e2d\u7684 Driver \u8868\u793a master\uff0c\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u4e2d\u7684\u4f5c\u4e1a\u4efb\u52a1\u8c03\u5ea6\uff0c\u56fe\u5f62\u4e2d\u7684 Executor \u5219\u662f slave\uff0c\u8d1f\u8d23\u5b9e\u9645\u6267\u884c\u4efb\u52a1\u3002</p> <p></p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#12","title":"1.2 \u6838\u5fc3\u7ec4\u4ef6","text":"<p>\u53f3\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u5bf9\u4e8e Spark \u6846\u67b6\u6709\u4e24\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff1a</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#121-driver","title":"1.2.1 Driver","text":"<p>Spark \u9a71\u52a8\u5668\u8282\u70b9\uff0c\u7528\u4e8e\u6267\u884c Spark \u4efb\u52a1\u4e2d\u7684 main \u65b9\u6cd5\uff0c\u8d1f\u8d23\u5b9e\u9645\u4ee3\u7801\u7684\u6267\u884c\u5de5\u4f5c\u3002Driver \u5728 Spark \u4f5c\u4e1a\u6267\u884c\u65f6\u4e3b\u8981\u8d1f\u8d23\uff1a</p> <ul> <li>\u5c06\u7528\u6237\u7a0b\u5e8f\u8f6c\u5316\u4e3a\u4f5c\u4e1a\uff08job\uff09</li> <li>\u5728 Executor \u4e4b\u95f4\u8c03\u5ea6\u4efb\u52a1\uff08task\uff09</li> <li>\u8ddf\u8e2a Executor \u7684\u6267\u884c\u60c5\u51b5</li> <li>\u901a\u8fc7 UI \u5c55\u793a\u67e5\u8be2\u8fd0\u884c\u60c5\u51b5</li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u65e0\u6cd5\u51c6\u786e\u5730\u63cf\u8ff0 Driver \u7684\u5b9a\u4e49\uff0c\u56e0\u4e3a\u5728\u6574\u4e2a\u7684\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u770b\u5230\u4efb\u4f55\u6709\u5173\u7684 Driver \u7684\u5b57\u773c\u3002\u6240\u4ee5\u7b80\u5355\u7406\u89e3\uff0c\u6240\u8c13\u7684 Driver \u5c31\u662f\u9a71\u52a8\u6574\u4e2a\u5e94\u7528\u8fd0\u884c\u8d77\u6765\u7684\u7a0b\u5e8f\uff0c\u4e5f\u79f0\u4e4b\u4e3a Driver \u7c7b\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#122-executor","title":"1.2.2 Executor","text":"<p>Spark Executor \u662f\u96c6\u7fa4\u4e2d\u5de5\u4f5c\u8282\u70b9\uff08Worker\uff09\u4e2d\u7684\u4e00\u4e2a JVM \u8fdb\u7a0b\uff0c\u8d1f\u8d23\u5728 Spark \u4f5c\u4e1a\u4e2d\u8fd0\u884c\u5177\u4f53\u4efb\u52a1\uff08Task\uff09\uff0c\u4efb\u52a1\u5f7c\u6b64\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\u3002Spark \u5e94\u7528\u542f\u52a8\u65f6\uff0cExecutor \u8282\u70b9\u88ab\u540c\u65f6\u542f\u52a8\uff0c\u5e76\u4e14\u59cb\u7ec8\u4f34\u968f\u7740\u6574\u4e2a Spark \u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u800c\u5b58\u5728\u3002\u5982\u679c\u6709 Executor \u8282\u70b9\u53d1\u751f\u4e86\u6545\u969c\u6216\u5d29\u6e83\uff0cSpark \u5e94\u7528\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u4f1a\u5c06\u51fa\u9519\u8282\u70b9\u4e0a\u7684\u4efb\u52a1\u8c03\u5ea6\u5230\u5176\u5b83 Executor \u8282\u70b9\u4e0a\u7ee7\u7eed\u8fd0\u884c\u3002</p> <p>Executor \u6709\u4e24\u4e2a\u6838\u5fc3\u529f\u80fd\uff1a</p> <ul> <li>\u8d1f\u8d23\u8fd0\u884c\u7ec4\u6210 Spark \u5e94\u7528\u7684\u4efb\u52a1\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u542f\u52a8\u5668\u8fdb\u7a0b</li> <li>\u5b83\u4eec\u901a\u8fc7\u81ea\u8eab\u7684\u5757\u7ba1\u7406\u5668\uff08Block Manager\uff09\u4e3a\u7528\u6237\u7a0b\u5e8f\u4e2d\u8981\u6c42\u7f13\u5b58\u7684 RDD \u63d0\u4f9b\u5185\u5b58\u5f0f\u5b58\u50a8\u3002RDD \u662f\u76f4\u63a5\u7f13\u5b58\u5728 Executor \u8fdb\u7a0b\u5185\u7684\uff0c\u56e0\u6b64\u4efb\u52a1\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u5145\u5206\u5229\u7528\u7f13\u5b58\u6570\u636e\u52a0\u901f\u8fd0\u7b97\u3002</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#123-master-worker","title":"1.2.3 Master &amp; Worker","text":"<p>Spark \u96c6\u7fa4\u7684\u72ec\u7acb\u90e8\u7f72\u73af\u5883\u4e2d\uff0c\u4e0d\u9700\u8981\u4f9d\u8d56\u5176\u5b83\u7684\u8d44\u6e90\u8c03\u5ea6\u6846\u67b6\uff0c\u81ea\u8eab\u5c31\u5b9e\u73b0\u4e86\u8d44\u6e90\u8c03\u5ea6\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u73af\u5883\u4e2d\u8fd8\u6709\u5176\u5b83\u4e24\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff1aMaster \u548c Worker\uff0c\u8fd9\u91cc\u7684 Master \u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u4e3b\u8981\u8d1f\u8d23\u8d44\u6e90\u7684\u8c03\u5ea6\u548c\u5206\u914d\uff0c\u5e76\u8fdb\u884c\u96c6\u7fa4\u7684\u76d1\u63a7\u7b49\u804c\u8d23\uff0c\u7c7b\u4f3c\u4e8e Yarn \u73af\u5883\u4e2d\u7684 RM\uff0c\u800c Worker \u5462\uff0c\u4e5f\u662f\u8fdb\u7a0b\uff0c\u4e00\u4e2a Worker \u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u7684\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u7531 Master \u5206\u914d\u8d44\u6e90\u5bf9\u6570\u636e\u8fdb\u884c\u5e76\u884c\u7684\u5904\u7406\u548c\u8ba1\u7b97\uff0c\u7c7b\u4f3c\u4e8e Yarn \u73af\u5883\u4e2d\u7684 NM\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#124-applicationmaster","title":"1.2.4 ApplicationMaster","text":"<p>Hadoop \u7528\u6237\u5411 Yarn \u96c6\u7fa4\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u63d0\u4ea4\u7a0b\u5e8f\u4e2d\u5e94\u8be5\u5305\u542b ApplicationMaster\uff0c\u7528\u4e8e\u5411\u8d44\u6e90\u8c03\u5ea6\u5668\u7533\u8bf7\u6267\u884c\u4efb\u52a1\u7684\u8d44\u6e90\u5bb9\u5668 Container\uff0c\u8fd0\u884c\u7528\u6237\u81ea\u5df1\u7684\u7a0b\u5e8f\u4efb\u52a1 Job\uff0c\u76d1\u63a7\u6574\u4e2a\u4efb\u52a1\u7684\u6267\u884c\uff0c\u8ddf\u8e2a\u6574\u4e2a\u4efb\u52a1\u7684\u72b6\u6001\uff0c\u5904\u7406\u4efb\u52a1\u5931\u8d25\u7b49\u5f02\u5e38\u60c5\u51b5\u3002</p> <p>\u8bf4\u7684\u7b80\u5355\u70b9\u5c31\u662f\uff0c ResourceManager\uff08\u8d44\u6e90\uff09\u548c Driver\uff08\u8ba1\u7b97\uff09\u4e4b\u95f4\u7684\u89e3\u8026\u5408\u9760\u7684\u5c31\u662f ApplicationMaster\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#13","title":"1.3 \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#131-executor","title":"1.3.1 Executor","text":"<p>Spark Executor \u662f\u96c6\u7fa4\u4e2d\u8fd0\u884c\u5728\u5de5\u4f5c\u8282\u70b9\uff08Worker\uff09\u4e2d\u7684\u4e00\u4e2a JVM \u8fdb\u7a0b\uff0c\u662f\u6574\u4e2a\u96c6\u7fa4\u4e2d\u7684\u4e13\u95e8\u7528\u4e8e\u8ba1\u7b97\u7684\u8282\u70b9\u3002\u5728\u63d0\u4ea4\u5e94\u7528\u4e2d\uff0c\u53ef\u4ee5\u63d0\u4f9b\u53c2\u6570\u6307\u5b9a\u8ba1\u7b97\u8282\u70b9\u7684\u4e2a\u6570\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u8d44\u6e90\u3002\u8fd9\u91cc\u7684\u8d44\u6e90\u4e00\u822c\u6307\u7684\u662f\u5de5\u4f5c\u8282\u70b9 Executor \u7684\u5185\u5b58\u548c\u4f7f\u7528\u7684\u865a\u62df CPU \u6838\u6570\u91cf\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u76f8\u5173\u542f\u52a8\u53c2\u6570\u5982\u4e0b\uff1a</p> \u540d\u79f0 \u8bf4\u660e <code>--num-executors</code> \u914d\u7f6e Executor \u7684\u6570\u91cf <code>--executor-memory</code> \u914d\u7f6e\u6bcf\u4e2a Executor \u7684\u5185\u5b58\u5927\u5c0f <code>--executor-cores</code> \u914d\u7f6e\u6bcf\u4e2a Executor \u7684\u865a\u62df CPU \u6838\u6570\u91cf"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#132-parallelism","title":"1.3.2 \u5e76\u884c\u5ea6\uff08Parallelism\uff09","text":"<p>\u5728\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\u4e2d\u4e00\u822c\u90fd\u662f\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u6267\u884c\uff0c\u7531\u4e8e\u4efb\u52a1\u5206\u5e03\u5728\u4e0d\u540c\u7684\u8ba1\u7b97\u8282\u70b9\u8fdb\u884c\u8ba1\u7b97\uff0c\u6240\u4ee5\u80fd\u591f\u771f\u6b63\u5730\u5b9e\u73b0\u591a\u4efb\u52a1\u5e76\u884c\u6267\u884c\uff0c\u8bb0\u4f4f\uff0c\u8fd9\u91cc\u662f\u5e76\u884c\uff0c\u800c\u4e0d\u662f\u5e76\u53d1\u3002\u8fd9\u91cc\u6211\u4eec\u5c06\u6574\u4e2a\u96c6\u7fa4\u5e76\u884c\u6267\u884c\u4efb\u52a1\u7684\u6570\u91cf\u79f0\u4e4b\u4e3a\u5e76\u884c\u5ea6\u3002\u90a3\u4e48\u4e00\u4e2a\u4f5c\u4e1a\u5230\u5e95\u5e76\u884c\u5ea6\u662f\u591a\u5c11\u5462\uff1f\u8fd9\u4e2a\u53d6\u51b3\u4e8e\u6846\u67b6\u7684\u9ed8\u8ba4\u914d\u7f6e\u3002\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u52a8\u6001\u4fee\u6539\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#133-dag","title":"1.3.3 \u6709\u5411\u65e0\u73af\u56fe\uff08DAG\uff09","text":"<p>\u5927\u6570\u636e\u8ba1\u7b97\u5f15\u64ce\u6846\u67b6\u6211\u4eec\u6839\u636e\u4f7f\u7528\u65b9\u5f0f\u7684\u4e0d\u540c\u4e00\u822c\u4f1a\u5206\u4e3a\u56db\u7c7b\uff0c\u5176\u4e2d\u6709\u4e00\u7c7b\u5c31\u662f Hadoop \u6240\u627f\u8f7d\u7684 MapReduce\uff0c\u5b83\u5c06\u8ba1\u7b97\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff0c\u5206\u4e3a Map \u9636\u6bb5\u548c Reduce \u9636\u6bb5\u3002\u5bf9\u4e8e\u4e0a\u5c42\u5e94\u7528\u6765\u8bf4\uff0c\u5c31\u4e0d\u5f97\u4e0d\u60f3\u65b9\u8bbe\u6cd5\u53bb\u62c6\u5206\u7b97\u6cd5\uff0c\u751a\u81f3\u4e8e\u4e0d\u5f97\u4e0d\u5728\u4e0a\u5c42\u65f6\u4e0b\u4f60\u591a\u4e2a Job \u7684\u4e32\u8054\uff0c\u4ee5\u5b8c\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u7b97\u6cd5\uff0c\u4f8b\u5982\u8fed\u4ee3\u8ba1\u7b97\u3002\u7531\u4e8e\u8fd9\u6837\u7684\u5f0a\u7aef\uff0c\u50ac\u751f\u4e86\u652f\u6301 DAG \u6846\u67b6\u7684\u4ea7\u751f\u3002\u56e0\u6b64\uff0c\u652f\u6301 DAG \u7684\u6846\u67b6\u88ab\u5212\u5206\u4e3a\u7b2c\u4e8c\u4ee3\u8ba1\u7b97\u5f15\u64ce\uff0c\u5982 Tez \u4ee5\u53ca\u66f4\u4e0a\u5c42\u7684 Oozie\u3002\u8fd9\u91cc\u6211\u4eec\u4e0d\u53bb\u7ec6\u7a76\u5404\u79cd DAG \u5b9e\u73b0\u4e4b\u95f4\u7684\u533a\u522b\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u5f53\u65f6\u7684 Tez \u548c Oozie \u6765\u8bf4\uff0c\u5927\u591a\u8fd8\u662f\u6279\u5904\u7406\u7684\u4efb\u52a1\u3002\u63a5\u4e0b\u6765\u5c31\u662f\u4ee5 Spark \u4e3a\u4ee3\u8868\u7684\u7b2c\u4e09\u4ee3\u7684\u8ba1\u7b97\u5f15\u64ce\u3002\u7b2c\u4e09\u70b9\u8ba1\u7b97\u5f15\u64ce\u7684\u7279\u70b9\u4e3b\u8981\u662f Job \u5185\u90e8\u7684 DAG \u652f\u6301\uff08\u4e0d\u8de8\u8d8a Job\uff09\uff0c\u4ee5\u53ca\u5b9e\u65f6\u8ba1\u7b97\u3002</p> <p>\u8fd9\u91cc\u6240\u8c13\u7684\u6709\u5411\u65e0\u73af\u56fe\uff0c\u5e76\u4e0d\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u56fe\u5f62\uff0c\u800c\u662f\u7531 Spark \u7a0b\u5e8f\u76f4\u63a5\u6620\u5c04\u6210\u7684\u6570\u636e\u6d41\u7684\u9ad8\u7ea7\u62bd\u8c61\u9762\u6a21\u578b\u3002\u7b80\u5355\u7406\u89e3\u5c31\u662f\u5c06\u6574\u4e2a\u7a0b\u5e8f\u8ba1\u7b97\u7684\u6267\u884c\u8fc7\u7a0b\u7528\u56fe\u5f62\u8868\u793a\u51fa\u6765\u54e6\uff0c\u8fd9\u6837\u66f4\u76f4\u89c2\uff0c\u66f4\u4fbf\u4e8e\u7406\u89e3\uff0c\u53ef\u4ee5\u7528\u4e8e\u8868\u793a\u7a0b\u5e8f\u7684\u62d3\u6251\u7ed3\u6784\u3002</p> <p>DAG\uff08Directed Acyclic Graph\uff09\u6709\u5411\u65e0\u73af\u56fe\u662f\u7531\u70b9\u548c\u53bf\u7ec4\u6210\u7684\u62d3\u6251\u56fe\u5f62\uff0c\u8be5\u56fe\u5f62\u5177\u6709\u65b9\u5411\uff0c\u4e0d\u4f1a\u95ed\u73af\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#14","title":"1.4 \u63d0\u4ea4\u6d41\u7a0b","text":"<p>\u6240\u8c13\u7684\u63d0\u4ea4\u6d41\u7a0b\uff0c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u5f00\u53d1\u4eba\u5458\u6839\u636e\u9700\u6c42\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 Spark \u5ba2\u6237\u7aef\u63d0\u4ea4 Spark \u8fd0\u884c\u73af\u5883\u6267\u884c\u8ba1\u7b97\u7684\u6d41\u7a0b\u3002\u5728\u4e0d\u540c\u7684\u90e8\u7f72\u73af\u5883\u4e2d\uff0c\u8fd9\u4e2a\u63d0\u4ea4\u8fc7\u7a0b\u57fa\u672c\u76f8\u540c\u4eba\uff0c\u4f46\u662f\u53c8\u6709\u7ec6\u5fae\u7684\u533a\u522b\uff0c\u6211\u4eec\u8fd9\u91cc\u4e0d\u8fdb\u884c\u8be6\u7ec6\u7684\u6bd4\u8f83\uff0c\u4f46\u662f\u56e0\u4e3a\u56fd\u5185\u5de5\u4f5c\u4e2d\uff0c\u5c06 Spark \u5e94\u7528\u90e8\u7f72\u5230 Yarn \u73af\u5883\u4e2d\u4f1a\u66f4\u591a\u4e00\u4e9b\uff0c\u6240\u4ee5\u540e\u7eed\u7684\u63d0\u4ea4\u6d41\u7a0b\u90fd\u662f\u57fa\u4e8e Yarn \u73af\u5883\u7684\u3002</p> <p>Spark \u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u5230 Yarn \u73af\u5883\u4e2d\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e00\u822c\u4f1a\u6709\u4e24\u79cd\u90e8\u7f72\u6267\u884c\u7684\u65b9\u5f0f\uff1aClient \u548c Cluster\u3002\u4e24\u79cd\u6a21\u5f0f\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1aDriver \u7a0b\u5e8f\u7684\u8fd0\u884c\u8282\u70b9\u4f4d\u7f6e\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#141-yarn-client","title":"1.4.1 Yarn Client \u6a21\u5f0f","text":"<p>Client \u6a21\u5f0f\u5c06\u7528\u4e8e\u76d1\u63a7\u548c\u8c03\u5ea6\u7684 Driver \u6a21\u5757\u5728\u5ba2\u6237\u7aef\u6267\u884c\uff0c\u800c\u4e0d\u662f\u5728 Yarn \u4e2d\uff0c\u6240\u4ee5\u4e00\u822c\u7528\u4e8e\u6d4b\u8bd5\u3002</p> <ul> <li>Driver \u5728\u4efb\u52a1\u63d0\u4ea4\u7684\u672c\u5730\u673a\u5668\u4e0a\u8fd0\u884c</li> <li>Driver \u542f\u52a8\u540e\u4f1a\u548c ResourceManager \u901a\u8baf\u7533\u8bf7\u542f\u52a8 ApplicationMaster</li> <li>ResourceManager \u5206\u914d Container\uff0c\u5728\u5408\u9002\u7684 NodeManager \u4e0a\u542f\u52a8 ApplicationMaster\uff0c\u8d1f\u8d23\u5411 ResourceManager \u7533\u8bf7 Executor \u5185\u5b58</li> <li>ResourceManager \u63a5\u5230 ApplicationMaster \u7684\u8d44\u6e90\u7533\u8bf7\u540e\u4f1a\u5206\u914d Container\uff0c\u7136\u540e ApplicationMaster \u5728\u8d44\u6e90\u5206\u914d\u6307\u5b9a\u7684 NodeManager \u4e0a\u542f\u52a8 Executor \u8fdb\u7a0b</li> <li>Executor \u8fdb\u7a0b\u542f\u52a8\u540e\u4f1a\u5411 Driver \u53cd\u5411\u6ce8\u518c\uff0cExecutor \u5168\u90e8\u6ce8\u518c\u5b8c\u6210\u540e Driver \u5f00\u59cb\u6267\u884c main \u51fd\u6570</li> <li>\u4e4b\u540e\u6267\u884c\u5230 Action \u7b97\u5b50\u65f6\uff0c\u89e6\u53d1\u4e00\u4e2a Job\uff0c\u5e76\u6839\u636e\u5bbd\u4f9d\u8d56\u5f00\u59cb\u5212\u5206 stage\uff0c\u6bcf\u4e2a stage \u751f\u6210\u5bf9\u5e94\u7684 TaskSet\uff0c\u4e4b\u540e\u5c06 Task \u5206\u53d1\u5230\u5404\u4e2a Executor \u4e0a\u6267\u884c\u3002</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#142-yarn-cluster","title":"1.4.2 Yarn Cluster \u6a21\u5f0f","text":"<p>Cluster \u6a21\u5f0f\u5c06\u7528\u4e8e\u76d1\u63a7\u548c\u8c03\u5ea6\u7684 Driver \u6a21\u5757\u542f\u52a8\u5728 Yarn \u96c6\u7fa4\u8d44\u6e90\u4e2d\u6267\u884c\u3002\u4e00\u822c\u5e94\u7528\u4e8e\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u3002</p> <ul> <li>\u5728 Yarn Cluster \u6a21\u5f0f\u4e0b\uff0c\u4efb\u52a1\u63d0\u4ea4\u540e\u4f1a\u548c ResourceManager \u901a\u8baf\u7533\u8bf7\u542f\u52a8 ApplicationMaster</li> <li>\u968f\u540e ResourceManager \u5206\u914d Container\uff0c\u5728\u5408\u9002\u7684 NodeManager \u4e0a\u542f\u52a8 ApplicationMaster\uff0c\u6b64\u65f6\u7684 ApplicationMaster \u5c31\u662f Driver</li> <li>Driver \u542f\u52a8\u540e\u5411 ResourceManager \u7533\u8bf7 Executor \u5185\u5b58\uff0cResourceManager \u63a5\u5230 ApplicationMaster \u7684\u8d44\u6e90\u7533\u8bf7\u540e\u4f1a\u5206\u914d Container\uff0c\u7136\u540e\u5728\u5408\u9002\u7684 NodeManager \u4e0a\u542f\u52a8 Executor \u8fdb\u7a0b</li> <li>Executor \u8fdb\u7a0b\u542f\u52a8\u540e\u4f1a\u5411 Driver \u53cd\u5411\u6ce8\u518c\uff0cExecutor \u5168\u90e8\u6ce8\u518c\u540e Driver \u5f00\u59cb\u6267\u884c main \u51fd\u6570</li> <li>\u4e4b\u540e\u6267\u884c\u5230 Action \u7b97\u5b50\u65f6\uff0c\u89e6\u53d1\u4e00\u4e2a Job\uff0c\u5e76\u6839\u636e\u5bbd\u4f9d\u8d56\u5f00\u53d1\u5212\u5206 stage\uff0c\u6bcf\u4e2a stage \u751f\u6210\u5bf9\u5e94\u7684 TaskSet\uff0c\u4e4b\u540e\u5c06 Task \u5206\u53d1\u5230\u5404\u4e2a Executor \u4e0a\u6267\u884c\u3002</li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark_1","title":"\u4e8c\u3001Spark \u6838\u5fc3\u7f16\u7a0b","text":"<p>Spark \u8ba1\u7b97\u6846\u67b6\u4e3a\u4e86\u80fd\u591f\u8fdb\u884c\u9ad8\u5e76\u53d1\u548c\u9ad8\u541e\u5410\u7684\u6570\u636e\u5904\u7406\uff0c\u5c01\u88c5\u4e86\u4e09\u5927\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u5904\u7406\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u3002\u4e09\u5927\u6570\u636e\u7ed3\u6784\u5206\u522b\u662f\uff1a</p> <ul> <li>RDD\uff1a\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6</li> <li>\u7d2f\u52a0\u5668\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf</li> <li>\u5e7f\u64ad\u53d8\u91cf\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u8bfb\u53d8\u91cf</li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#21-rdd","title":"2.1 RDD","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#211-rdd","title":"2.1.1 \u4ec0\u4e48\u662f RDD","text":"<p>RDD\uff08Resilient Distributed Dataset\uff09\u53eb\u505a\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff0c\u662f Spark \u4e2d\u6700\u57fa\u672c\u7684\u6570\u636e\u5904\u7406\u6a21\u578b\u3002\u4ee3\u7801\u4e2d\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b83\u4ee3\u8868\u4e00\u4e2a\u5f39\u6027\u3001\u4e0d\u53ef\u53d8\u3001\u53ef\u5206\u533a\u3001\u91cc\u9762\u7684\u5143\u7d20\u53ef\u5e76\u884c\u8ba1\u7b97\u7684\u8ba1\u7b97\u3002</p> <ul> <li>\u5f39\u6027<ul> <li>\u5b58\u50a8\u7684\u5f39\u6027\uff1a\u5185\u5b58\u4e0e\u78c1\u76d8\u7684\u81ea\u52a8\u5207\u6362</li> <li>\u5bb9\u9519\u7684\u5f39\u6027\uff1a\u6570\u636e\u4e22\u5931\u53ef\u4ee5\u81ea\u52a8\u6062\u590d</li> <li>\u8ba1\u7b97\u7684\u5f39\u6027\uff1a\u8ba1\u7b97\u51fa\u9519\u91cd\u8bd5\u673a\u5236</li> <li>\u5206\u7247\u7684\u5f39\u6027\uff1a\u53ef\u6839\u636e\u9700\u8981\u91cd\u65b0\u5206\u7247</li> </ul> </li> <li>\u5206\u5e03\u5f0f\uff1a\u6570\u636e\u5b58\u50a8\u5728\u5927\u6570\u636e\u96c6\u7fa4\u4e0d\u540c\u8282\u70b9\u4e0a</li> <li>\u6570\u636e\u96c6\uff1aRDD \u5c01\u88c5\u4e86\u8ba1\u7b97\u903b\u8f91\uff0c\u5e76\u4e0d\u4fdd\u5b58\u6570\u636e</li> <li>\u6570\u636e\u62bd\u8c61\uff1aRDD \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u9700\u8981\u5b50\u7c7b\u5177\u4f53\u5b9e\u73b0</li> <li>\u4e0d\u53ef\u53d8\uff1aRDD \u5c01\u88c5\u4e86\u8ba1\u7b97\u903b\u8f91\uff0c\u662f\u4e0d\u53ef\u4ee5\u6539\u53d8\u7684\uff0c\u60f3\u8981\u6539\u53d8\uff0c\u53ea\u80fd\u4ea7\u751f\u65b0\u7684 RDD\uff0c\u5728\u65b0\u7684 RDD \u91cc\u9762\u5c01\u88c5\u8ba1\u7b97\u903b\u8f91</li> <li>\u53ef\u5206\u533a\uff1a\u5e76\u884c\u8ba1\u7b97</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#212","title":"2.1.2 \u6267\u884c\u539f\u7406","text":"<p>\u4ece\u8ba1\u7b97\u7684\u89d2\u5ea6\u6765\u8bb2\uff0c\u6570\u636e\u5904\u7406\u8fc7\u7a0b\u4e2d\u9700\u8981\u8ba1\u7b97\u8d44\u6e90\uff08\u5185\u5b58 &amp; CPU\uff09\u548c\u8ba1\u7b97\u6a21\u578b\uff08\u903b\u8f91\uff09\u3002\u6267\u884c\u65f6\uff0c\u9700\u8981\u5c06\u8ba1\u7b97\u8d44\u6e90\u548c\u8ba1\u7b97\u6a21\u578b\u8fdb\u884c\u534f\u8c03\u548c\u6574\u5408\u3002</p> <p>Spark \u6846\u67b6\u5728\u6267\u884c\u65f6\uff0c\u5148\u7533\u8bf7\u5185\u5b58\uff0c\u7136\u540e\u5c06\u5e94\u7528\u7a0b\u5ea6\u7684\u6570\u636e\u5904\u7406\u903b\u8f91\u5206\u89e3\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u8ba1\u7b97\u4efb\u52a1\u3002\u7136\u540e\u5c06\u4efb\u52a1\u53d1\u5230\u5df2\u7ecf\u5206\u914d\u8d44\u6e90\u7684\u8ba1\u7b97\u8282\u70b9\u4e0a\uff0c\u6309\u7167\u6307\u5b9a\u7684\u8ba1\u7b97\u6a21\u578b\u8fdb\u884c\u6570\u636e\u8ba1\u7b97\uff0c\u6700\u540e\u5f97\u5230\u8ba1\u7b97\u7ed3\u679c\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#213","title":"2.1.3 \u57fa\u7840\u7f16\u7a0b","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2131-rdd","title":"2.1.3.1 RDD \u521b\u5efa","text":"<ol> <li> <p>\u4ece\u96c6\u5408\uff08\u5185\u5b58\uff09\u521b\u5efa RDD</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n\n    val rdd1 = sc.parallelize(List(1, 2, 3, 4))\n    val rdd2 = sc.makeRDD(List(1, 2, 3, 4))\n    rdd1.collect().foreach(println)\n    rdd2.collect().foreach(println)\n  }\n}\n</code></pre> </li> <li> <p>\u4ece\u6587\u4ef6\uff08\u5916\u90e8\u5b58\u50a8\uff09\u521b\u5efa RDD</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n\n    val rdd = sc.textFile(\"pom.xml\")\n    rdd.collect().foreach(println)\n  }\n}\n</code></pre> </li> <li> <p>\u4ece\u5176\u5b83 RDD \u521b\u5efa</p> <p>\u4e3b\u8981\u662f\u901a\u8fc7\u4e00\u4e2a RDD \u8fd0\u7b97\u5b8c\u540e\uff0c\u518d\u4ea7\u751f\u65b0\u7684 RDD\u3002</p> </li> <li> <p>\u76f4\u63a5\u521b\u5efa RDD</p> <p>\u4f7f\u7528 <code>new</code> \u7684\u65b9\u5f0f\u76f4\u63a5\u6784\u9020 RDD\uff0c\u4e00\u822c\u7531 Spark \u6846\u67b6\u81ea\u8eab\u4f7f\u7528\u3002</p> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2132-rdd","title":"2.1.3.2 RDD \u5e76\u884c\u5ea6\u4e0e\u5206\u533a","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSpark \u53ef\u4ee5\u5c06\u4e00\u4e2a\u4f5c\u4e1a\u5207\u5206\u591a\u4e2a\u4efb\u52a1\u540e\uff0c\u53d1\u9001\u7ed9 Executor \u8282\u70b9\u5e76\u884c\u8ba1\u7b97\uff0c\u800c\u80fd\u591f\u5e76\u884c\u8ba1\u7b97\u7684\u4efb\u52a1\u6570\u91cf\u6211\u4eec\u79f0\u4e4b\u4e3a\u5e76\u884c\u5ea6\u3002\u8fd9\u4e2a\u6570\u91cf\u53ef\u4ee5\u5728\u6784\u5efa RDD \u65f6\u6307\u5b9a\u3002\u8bb0\u4f4f\uff0c\u8fd9\u91cc\u7684\u5e76\u884c\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\uff0c\u5e76\u4e0d\u662f\u6307\u7684\u5207\u5206\u4efb\u52a1\u7684\u6570\u91cf\uff0c\u4e0d\u8981\u6df7\u6dc6\u4e86\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2133-rdd","title":"2.1.3.3 RDD \u8f6c\u6362\u7b97\u5b50","text":"<p>RDD \u6839\u636e\u6570\u636e\u5904\u7406\u65b9\u5f0f\u7684\u4e0d\u540c\u5c06\u7b97\u5b50\u6574\u4f53\u4e0a\u5206\u4e3a Value \u7c7b\u578b\u3001\u53cc Value \u7c7b\u578b\u548c Key-Value \u7c7b\u578b\u3002</p> <ul> <li> <p>Value \u7c7b\u578b</p> <ol> <li> <p><code>map</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def map[U: ClassTag](f: T =&gt; U): RDD[U]\n</code></pre> </li> </ul> </li> <li> <p><code>mapPartitions</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def mapPartitions[U: ClassTag](\n  f: Iterator[T] =&gt; Iterator[U],\n  preservesPartitioning: Boolean = false\n): RDD[U]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u5f85\u5904\u7406\u7684\u6570\u636e\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u53d1\u9001\u5230\u8ba1\u7b97\u8282\u70b9\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u91cc\u7684\u5904\u7406\u662f\u6307\u53ef\u4ee5\u8fdb\u884c\u4efb\u610f\u7684\u5904\u7406\uff0c\u54ea\u6015\u662f\u8fc7\u6ee4\u6570\u636e\u3002</p> <pre><code>val dataRDD1 = dataRDD.mapPartitions(items =&gt; items.filter(item =&gt; item == 2))\n</code></pre> </li> <li> <p>\u5c0f\u529f\u80fd</p> <ul> <li>\u83b7\u53d6\u6bcf\u4e2a\u6570\u636e\u5206\u533a\u7684\u6700\u5927\u503c</li> </ul> </li> <li> <p><code>map</code> \u548c <code>mapPartitions</code> \u7684\u533a\u522b</p> <ul> <li> <p>\u6570\u636e\u5904\u7406\u89d2\u5ea6</p> <p><code>map</code> \u7b97\u5b50\u65f6\u5206\u533a\u5185\u4e00\u4e2a\u6570\u636e\u4e00\u4e2a\u6570\u636e\u7684\u6267\u884c\uff0c\u7c7b\u4f3c\u4e8e\u4e32\u884c\u64cd\u4f5c\u3002\u800c <code>mapPartitions</code> \u7b97\u5b50\u65f6\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u8fdb\u884c\u6279\u5904\u7406\u64cd\u4f5c\u3002</p> </li> <li> <p>\u529f\u80fd\u89d2\u5ea6</p> <p><code>map</code> \u7b97\u5b50\u4e3b\u8981\u76ee\u7684\u5c06\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8f6c\u6362\u548c\u6539\u53d8\u3002\u4f46\u662f\u4e0d\u4f1a\u51cf\u5c11\u6216\u589e\u591a\u6570\u636e\u3002<code>mapPartitions</code> \u7b97\u5b50\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u6ca1\u6709\u8981\u6c42\u5143\u7d20\u7684\u4e2a\u6570\u4fdd\u6301\u4e0d\u53d8\uff0c\u6240\u4ee5\u53ef\u4ee5\u589e\u52a0\u6216\u51cf\u5c11\u6570\u636e\u3002</p> </li> <li> <p>\u6027\u80fd\u89d2\u5ea6</p> <p><code>map</code> \u7b97\u5b50\u56e0\u4e3a\u7c7b\u4f3c\u4e8e\u4e32\u884c\u64cd\u4f5c\uff0c\u6240\u4ee5\u6027\u80fd\u8f83\u4f4e\uff0c\u800c <code>mapPartitions</code> \u7b97\u5b50\u7c7b\u4f3c\u4e8e\u6279\u5904\u7406\uff0c\u6240\u4ee5\u6027\u80fd\u8f83\u9ad8\u3002\u4f46\u662f <code>mapPartitions</code> \u7b97\u5b50\u4f1a\u957f\u65f6\u95f4\u5360\u7528\u5185\u5b58\uff0c\u90a3\u4e48\u8fd9\u6837\u4f1a\u5bfc\u81f4\u5185\u5b58\u53ef\u80fd\u4e0d\u591f\u7528\uff0c\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u7684\u9519\u8bef\u3002\u6240\u4ee5\u5728\u5185\u5b58\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u5e94\u4f7f\u7528 <code>map</code> \u7b97\u5b50\u3002</p> </li> </ul> </li> </ul> </li> <li> <p><code>mapPartitionsWithIndex</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def mapPartitionsWithIndex[U: ClassTag](\n    f: (Int, Iterator[T]) =&gt; Iterator[U],\n    preservesPartitioning: Boolean = false\n): RDD[U]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u5f85\u5904\u7406\u7684\u6570\u636e\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u53d1\u9001\u5230\u8ba1\u7b97\u8282\u70b9\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u91cc\u7684\u5904\u7406\u662f\u6307\u53ef\u4ee5\u8fdb\u884c\u4efb\u610f\u7684\u5904\u7406\uff0c\u54ea\u6015\u662f\u8fc7\u6ee4\u6570\u636e\uff0c\u5728\u5904\u7406\u65f6\u540c\u65f6\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u5206\u533a\u7d22\u5f15\u3002</p> </li> <li> <p>\u5c0f\u529f\u80fd</p> <ul> <li>\u83b7\u53d6\u7b2c\u4e8c\u4e2a\u6570\u636e\u5206\u533a\u7684\u6570\u636e</li> </ul> </li> </ul> </li> <li> <p><code>flatMap</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def flatMap[U: ClassTag](f: T =&gt; TraversableOnce[U]): RDD[U]\n</code></pre> </li> </ul> </li> <li> <p><code>glom</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def glom(): RDD[Array[T]]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u76f4\u63a5\u8f6c\u6362\u4e3a\u76f8\u540c\u7c7b\u578b\u7684\u5185\u5b58\u6570\u7ec4\u8fdb\u884c\u5904\u7406\uff0c\u5206\u533a\u4e0d\u53d8\u3002</p> <pre><code>val dataRDD: RDD[Int] = sc.makeRDD(List(1, 2, 3, 4), 1)\nval dataRDD1: RDD[Array[Int]] = dataRDD.glom()\n</code></pre> </li> <li> <p>\u5c0f\u529f\u80fd</p> <ul> <li>\u8ba1\u7b97\u6240\u6709\u5206\u533a\u6700\u5927\u503c\u6c42\u548c\uff08\u5206\u533a\u4e4b\u5185\u53d6\u6700\u5927\u503c\uff0c\u5206\u533a\u4e4b\u95f4\u6700\u5927\u503c\u6c42\u548c\uff09</li> </ul> </li> </ul> </li> <li> <p><code>groupBy</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def groupBy[K](f: T =&gt; K)(implicit kt: ClassTag[K]): RDD[(K, Iterable[T])]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u6570\u636e\u6839\u636e\u6307\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u5206\u7ec4\uff0c\u5206\u533a\u9ed8\u8ba4\u4e0d\u53d8\uff0c\u4f46\u662f\u6570\u636e\u4f1a\u88ab\u6253\u4e71\u91cd\u65b0\u7ec4\u5408\uff0c\u6211\u4eec\u5c06\u8fd9\u6837\u7684\u64cd\u4f5c\u79f0\u4e4b\u4e3a shuffle\u3002\u6781\u9650\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u5206\u5728\u540c\u4e00\u4e2a\u5206\u533a\u4e2d\u3002\u4e00\u4e2a\u7ec4\u7684\u6570\u636e\u5728\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u4f46\u662f\u5e76\u4e0d\u662f\u8bf4\u4e00\u4e2a\u5206\u533a\u4e2d\u53ea\u6709\u4e00\u4e2a\u7ec4\u3002</p> <pre><code>val dataRDD: RDD[Int] = sc.makeRDD(List(1, 2, 3, 4), 1)\nval dataRDD1 = dataRDD.groupBy(it =&gt; it % 2)\n</code></pre> </li> <li> <p>\u5c0f\u529f\u80fd</p> <ul> <li>\u5c06 <code>List(\"hello\", \"Hive\", \"HBase\", \"Hadoop\")</code> \u6839\u636e\u9996\u5b57\u6bcd\u8fdb\u884c\u5206\u7ec4</li> <li>\u4ece\u670d\u52a1\u5668\u65e5\u5fd7\u6570\u636e <code>apache.log</code> \u4e2d\u83b7\u53d6\u6bcf\u4e2a\u65f6\u95f4\u6bb5\u8bbf\u95ee\u91cf</li> <li>WordCount</li> </ul> </li> </ul> </li> <li> <p><code>filter</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def filter(f: T =&gt; Boolean): RDD[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u6570\u636e\u6839\u636e\u6307\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u7b5b\u9009\u8fc7\u6ee4\uff0c\u7b26\u5408\u89c4\u5219\u7684\u6570\u636e\u4fdd\u7559\uff0c\u4e0d\u7b26\u5408\u89c4\u5219\u7684\u6570\u636e\u4e22\u5f03\u3002\u5f53\u6570\u636e\u8fdb\u884c\u7b5b\u9009\u8fc7\u6ee4\u540e\uff0c\u5206\u533a\u4e0d\u53d8\uff0c\u4f46\u662f\u5206\u533a\u5185\u7684\u6570\u636e\u53ef\u80fd\u4e0d\u5747\u8861\uff0c\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u6570\u636e\u503e\u659c\u3002</p> </li> </ul> </li> <li> <p><code>sample</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def sample(\n    withReplacement: Boolean,\n    fraction: Double,\n    seed: Long = Utils.random.nextLong\n): RDD[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u6839\u636e\u6307\u5b9a\u7684\u89c4\u5219\u4ece\u6570\u636e\u96c6\u4e2d\u62bd\u53d6\u6570\u636e\u3002</p> </li> </ul> </li> <li> <p><code>distinct</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def distinct(): RDD[T]\ndef distinct(numPartitions: Int)(implicit ord: Ordering[T] = null)\n</code></pre> </li> </ul> </li> <li> <p><code>coalesce</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def coalesce(\n    numPartitions: Int,\n    shuffle: Boolean = false,\n    partitionCoalescer: Option[PartitionCoalescer] = Option.empty\n)(\n    implicit ord: Ordering[T] = null\n): RDD[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u6839\u636e\u6570\u636e\u91cf\u7f29\u51cf\u5206\u533a\uff0c\u7528\u4e8e\u5927\u6570\u636e\u96c6\u8fc7\u6ee4\u540e\uff0c\u63d0\u9ad8\u5c0f\u6570\u636e\u96c6\u7684\u6267\u884c\u6548\u7387\u3002\u5f53 Spark \u7a0b\u5e8f\u4e2d\u5b58\u5728\u8fc7\u591a\u7684\u5c0f\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>coalesce</code> \u65b9\u6cd5\uff0c\u6536\u7f29\u5408\u5e76\u5206\u533a\uff0c\u51cf\u5c11\u5206\u533a\u7684\u4e2a\u6570\uff0c\u51cf\u5c0f\u4efb\u52a1\u8c03\u5ea6\u6210\u672c\u3002</p> <pre><code>val dataRDD = sc.makeRDD(List(1, 2, 3, 4, 1, 2), 6)\nval dataRDD1 = dataRDD.coalesce(2)\n</code></pre> </li> </ul> </li> <li> <p><code>repartition</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def repartition(numPartitions: Int)(implicit ord: Ordering[T] = null): RDD[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u6539\u64cd\u4f5c\u5185\u90e8\u5176\u5b9e\u6267\u884c\u7684\u662f <code>coalesce</code> \u64cd\u4f5c\uff0c\u53c2\u6570 <code>shuffle</code> \u7684\u9ed8\u8ba4\u503c\u4e3a <code>true</code>\u3002\u65e0\u8bba\u662f\u5c06\u5206\u533a\u6570\u591a\u7684 RDD \u8f6c\u6362\u4e3a\u5206\u533a\u6570\u5c11\u7684 RDD\uff0c\u8fd8\u662f\u5c06\u5206\u533a\u6570\u5c11\u7684 RDD \u8f6c\u6362\u4e3a\u5206\u533a\u6570\u591a\u7684 RDD\uff0c<code>repartition</code> \u64cd\u4f5c\u90fd\u53ef\u4ee5\u5b8c\u6210\uff0c\u56e0\u4e3a\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u7ecf Shuffle \u8fc7\u7a0b\u3002</p> <pre><code>val dataRDD = sc.makeRDD(List(1, 2, 3, 4, 1, 2), 2)\nval dataRDD1 = dataRDD.repartition(4)\n</code></pre> </li> </ul> </li> <li> <p><code>sortBy</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>sortBy[K](\n    f: (T) =&gt; K,\n    ascending: Boolean = true,\n    numPartitions: Int = this.partitions.length\n)(\n    implicit ord: Ordering[K], ctag: ClassTag[K]\n): RDD[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u8be5\u64cd\u4f5c\u7528\u4e8e\u6392\u5e8f\u6570\u636e\u3002\u5728\u6392\u5e8f\u4e4b\u524d\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u901a\u8fc7 f \u51fd\u6570\u8fdb\u884c\u5904\u7406\uff0c\u4e4b\u540e\u6309\u7167 f \u51fd\u6570\u5904\u7406\u7684\u7ed3\u6784\u8fdb\u884c\u6392\u5e8f\uff0c\u9ed8\u8ba4\u4e3a\u5347\u5e8f\u6392\u5217\u3002\u6392\u5217\u540e\u65b0\u4ea7\u751f\u7684 RDD \u5206\u533a\u6570\u4e0e\u539f RDD \u7684\u5206\u533a\u6570\u4e00\u76f4\uff0c\u4e2d\u95f4\u5b58\u5728 Shuffle \u8fc7\u7a0b\u3002</p> <pre><code>val dataRDD = sc.makeRDD(List(1, 2, 3, 4, 1, 2), 2)\nval dataRDD1 = dataRDD.sortBy(num =&gt; num, false, 4)\n</code></pre> </li> </ul> </li> </ol> </li> <li> <p>\u53cc Value \u7c7b\u578b</p> <ol> <li> <p><code>intersection</code></p> <ul> <li>\u51fd\u6570\u7b7e\u540d     <pre><code>def intersection(other: RDD[T]): RDD[T]\n</code></pre></li> </ul> </li> <li> <p><code>union</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def union(other: RDD[T]): RDD[T]\n</code></pre> </li> </ul> </li> <li> <p><code>subtract</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def subtract(other: RDD[T]): RDD[T]\n</code></pre> </li> </ul> </li> <li> <p><code>zip</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def zip[U: ClassTag](other: RDD[U]): RDD[(T, U)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u4e24\u4e2a RDD \u4e2d\u7684\u5143\u7d20\uff0c\u4ee5\u7b80\u76f4\u5bf9\u7684\u5f62\u5f0f\u8fdb\u884c\u5408\u5e76\u3002\u5176\u4e2d\uff0c\u952e\u503c\u5bf9\u4e2d\u7684 Key \u4e3a\u7b2c\u4e00\u4e2a RDD \u4e2d\u7684\u5143\u7d20\uff0cValue \u4e3a\u7b2c\u4e8c\u4e2a RDD \u4e2d\u7684\u76f8\u540c\u4f4d\u7f6e\u7684\u5143\u7d20\u3002</p> <p>\u5206\u533a\u548c\u5206\u533a\u6570\u636e\u91cf\u9700\u8981\u4e00\u81f4\u3002</p> </li> </ul> </li> </ol> </li> <li> <p>Key-Value \u7c7b\u578b</p> <ol> <li> <p><code>partitionBy</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def partitionBy(partitioner: Partitioner): RDD[(K, V)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u6570\u636e\u6309\u7167\u6307\u5b9a Partition \u91cd\u65b0\u8fdb\u884c\u5206\u533a\u3002Spark \u9ed8\u8ba4\u7684\u5206\u533a\u5668\u662f HashPartitioner\u3002</p> <pre><code>val rdd1: RDD[(Int, String)] = sc.makeRDD(Array((1, \"aaa\"), (2, \"bbb\"), (3, \"ccc\")), 3)\nval rdd2: RDD[(Int, String)] = rdd1.partitionBy(new HashPartitioner(2))\n</code></pre> </li> </ul> </li> <li> <p><code>reduceByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def reduceByKey(func: (V, V) =&gt; V): RDD[(K, V)]\ndef reduceByKey(func: (V, V) =&gt; V, numPartitions: Int): RDD[(K, V)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u53ef\u4ee5\u5c06\u6570\u636e\u6309\u7167\u76f8\u540c\u7684 Key \u7b2c Value \u8fdb\u884c\u805a\u5408\u3002</p> <pre><code>val dataRDD1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3), (\"c\", 3)))\nval dataRDD2 = dataRDD1.reduceByKey((a, b) =&gt; a + b)\nval dataRDD3 = dataRDD1.reduceByKey((a, b) =&gt; a + b, 2)\n</code></pre> </li> <li> <p>\u5c0f\u529f\u80fd</p> <ul> <li>WordCount</li> </ul> </li> </ul> </li> <li> <p><code>groupByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def groupByKey(): RDD[(K, Iterable[V])]\ndef groupByKey(numPartitions: Int): RDD[(K, Iterable[V])]\ndef groupByKey(partitioner: Partitioner): RDD[(K, Iterable[V])]\n</code></pre> </li> <li> <p><code>reduceByKey</code> \u548c <code>groupByKey</code> \u7684\u533a\u522b</p> <ul> <li> <p>\u4ece Shuffle \u7684\u89d2\u5ea6</p> <p><code>reduceByKey</code> \u548c <code>groupByKey</code> \u90fd\u5b58\u5728 Shuffle \u7684\u64cd\u4f5c\uff0c\u4f46\u662f <code>reduceByKey</code> \u53ef\u4ee5\u5728 Shuffle \u524d\u5bf9\u5206\u533a\u5185\u76f8\u540c\u7684\u6570\u636e\u8fdb\u884c\u9884\u805a\u5408\u529f\u80fd\uff0c\u8fd9\u6837\u4f1a\u51cf\u5c11\u7f57\u76d8\u7684\u6570\u91cf\u91cf\uff0c\u800c <code>groupByKey</code> \u53ea\u662f\u8fdb\u884c\u5206\u7ec4\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u91cf\u51cf\u5c11\u7684\u95ee\u9898\uff0c<code>reduceByKey</code> \u6027\u80fd\u8f83\u9ad8\u3002</p> </li> <li> <p>\u4ece\u529f\u80fd\u7684\u89d2\u5ea6</p> <p><code>reduceByKey</code> \u5176\u5b9e\u5305\u542b\u5206\u7ec4\u548c\u805a\u5408\u7684\u529f\u80fd\uff0c<code>groupByKey</code> \u53ea\u80fd\u5206\u7ec4\uff0c\u4e0d\u80fd\u805a\u5408\uff0c\u6240\u4ee5\u5728\u5206\u7ec4\u805a\u5408\u7684\u573a\u666f\u4e0b\uff0c\u63a8\u8350\u4f7f\u7528 <code>reduceByKey</code>\uff0c\u5982\u679c\u4ec5\u4ec5\u662f\u5206\u7ec4\u800c\u4e0d\u9700\u8981\u805a\u5408\u3002\u90a3\u4e48\u8fd8\u662f\u53ea\u80fd\u4f7f\u7528 <code>groupByKey</code>\u3002</p> </li> </ul> </li> </ul> </li> <li> <p><code>aggregateByKey</code></p> </li> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def aggregateByKey[U: ClassTag](\n    zeroValue: U\n)(\n    seqOp: (U, V) =&gt; U,\n    combOp: (U, U) =&gt; U\n ): RDD[(K, U)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5c06\u6570\u636e\u6839\u636e\u4e0d\u540c\u7684\u89c4\u5219\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u3002</p> <pre><code>val dataRDD1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3), (\"c\", 3)))\ndataRDD1.aggregateByKey(0)((a, b) =&gt; a + b, (a, b) =&gt; a + b)\n</code></pre> <p>\u53d6\u51fa\u6bcf\u4e2a\u5206\u533a\u76f8\u540c Key \u7684\u6700\u5927\u503c\u7136\u540e\u5206\u533a\u95f4\u76f8\u52a0\u3002</p> <pre><code>val rdd = sc.makeRDD(\n    List((\"a\", 1), (\"a\", 2), (\"c\", 3), (\"b\", 4), (\"c\", 5), (\"c\", 6)),\n    2\n)\nval resultRDD = rdd.aggregateByKey(10)(\n    (x, y) =&gt; math.max(x, y),\n    (x, y) =&gt; x + y\n)\nresultRDD.collect().foreach(println)\n</code></pre> </li> <li> <p><code>foldByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def foldByKey(zeroValue: V)(func: (V, V) =&gt; V): RDD[(K, V)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5f53\u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u76f8\u540c\u65f6\uff0c<code>aggregateByKey</code> \u5c31\u53ef\u4ee5\u7b80\u5316\u4e3a <code>foldByKey</code>\u3002</p> <pre><code>val dataRDD1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3)))\nval dataRDD2 = dataRDD1.foldByKey(0)((a, b) =&gt; a + b)\n</code></pre> </li> </ul> </li> <li> <p><code>combineByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def combineByKey[C](\n    createCombiner: V =&gt; C,\n    mergeValue: (C, V) =&gt; C,\n    mergeCombiners: (C, C) =&gt; C,\n    numPartitions: Int\n): RDD[(K, C)]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u6700\u901a\u7528\u7684\u5bf9 Key-Value \u578b RDD \u8fdb\u884c\u805a\u96c6\u64cd\u4f5c\u7684\u805a\u96c6\u51fd\u6570\uff08Aggregation Function\uff09\uff0c\u7c7b\u4f3c\u4e8e <code>aggregate()</code>\uff0c<code>combineByKey</code> \u5141\u8bb8\u7528\u6237\u8fd4\u56de\u503c\u7684\u7c7b\u578b\u4e0e\u8f93\u5165\u4e0d\u4e00\u81f4\u3002</p> <p>\u6c42\u6570\u636e\u6bcf\u4e2a Key \u7684\u5e73\u5747\u503c\u3002</p> <pre><code>val input: RDD[(String, Int)] = sc.makeRDD(List((\"a\", 88), (\"b\", 95), (\"a\", 91), (\"b\", 93), (\"a\", 95), (\"b\", 98)), 2)\nval output: RDD[(String, (Int, Int))] = input.combineByKey(\n    (_, 1),\n    (acc: (Int, Int), v) =&gt; (acc._1 + v, acc._2 + 1),\n    (acc1: (Int, Int), acc2: (Int, Int)) =&gt; (acc1._1 + acc2._1, acc1._2 + acc2._2)\n)\n</code></pre> </li> <li> <p><code>reduceByKey</code>\u3001<code>foldByKey</code>\u3001<code>aggregateByKey</code>\u3001<code>combineByKey</code> \u7684\u533a\u522b</p> <code>reduceByKey</code> \u76f8\u540c Key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u4e0d\u8fdb\u884c\u4efb\u4f55\u8ba1\u7b97\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u76f8\u540c <code>foldByKey</code> \u76f8\u540c Key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u548c\u521d\u59cb\u503c\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u76f8\u540c <code>aggregateByKey</code> \u76f8\u540c Key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u548c\u521d\u59cb\u503c\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u53ef\u4ee5\u4e0d\u76f8\u540c <code>combineByKey</code> \u5f53\u8ba1\u7b97\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u7ed3\u6784\u4e0d\u6ee1\u8db3\u8981\u6c42\u65f6\uff0c\u53ef\u4ee5\u8ba9\u7b2c\u4e00\u4e2a\u6570\u636e\u8f6c\u6362\u7ed3\u6784\u3002\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u4e0d\u76f8\u540c </li> </ul> </li> <li> <p><code>sortByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def sortByKey(\n    ascending: Boolean = true,\n    numPartitions: Int = self.partitions.length\n): RDD[(K, V)]\n</code></pre> </li> </ul> </li> <li> <p><code>join</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def join[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, W))]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <pre><code>val rdd1: RDD[(Int, String)] = sc.makeRDD(Array((1, \"a\"), (2, \"b\"), (3, \"c\")))\nval rdd2: RDD[(Int, Int)] = sc.makeRDD(Array((1, 4), (2, 5), (3, 6)))\nrdd1.join(rdd2).collect().foreach(println)\n</code></pre> </li> </ul> </li> <li> <p><code>leftOuterJoin</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def leftOuterJoin[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, Option[W]))]\n</code></pre> </li> </ul> </li> <li> <p><code>cogroup</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def cogroup[W](other: RDD[(K, W)], partitioner: Partitioner)\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <pre><code>val dataRDD1 = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"c\", 3)))\nval dataRDD2 = sc.makeRDD(List((\"a\", 1), (\"c\", 2), (\"c\", 3)))\nval resultRDD: RDD[(String, (Iterable[Int], Iterable[Int]))] = dataRDD1.cogroup(dataRDD2)\n</code></pre> </li> </ul> </li> </ol> </li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2134","title":"2.1.3.4 \u6848\u4f8b\u5b9e\u64cd","text":"<ul> <li> <p>\u6570\u636e\u51c6\u5907     <code>agent.log</code>\uff1a\u65f6\u95f4\u6233\u3001\u7701\u4efd\u3001\u57ce\u5e02\u3001\u7528\u6237\u3001\u5e7f\u544a\uff0c\u4e2d\u95f4\u5b57\u6bb5\u4f7f\u7528\u7a7a\u683c\u5206\u9694\u3002</p> </li> <li> <p>\u9700\u6c42\u63cf\u8ff0</p> <p>\u7edf\u8ba1\u51fa\u6bcf\u4e00\u4e2a\u7701\u4efd\u6bcf\u4e2a\u5e7f\u544a\u88ab\u70b9\u51fb\u6570\u91cf\u6392\u884c\u7684 Top3\u3002</p> </li> <li> <p>\u529f\u80fd\u5b9e\u73b0</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n\n    // 1. \u539f\u59cb\u6570\u636e\n    // \"\u65f6\u95f4\u6233 \u7701\u4efd \u57ce\u5e02 \u7528\u6237 \u5e7f\u544a\"\n    val rdd1: RDD[String] = sc.textFile(\"input/agent.log\")\n\n    // 2. \u539f\u59cb\u6570\u636e\u8fdb\u884c\u7ed3\u6784\u7684\u8f6c\u6362\n    // \"\u65f6\u95f4\u6233 \u7701\u4efd \u57ce\u5e02 \u7528\u6237 \u5e7f\u544a\" =&gt; ((\u7701\u4efd, \u5e7f\u544a), 1)\n    val rdd2: RDD[((String, String), Int)] = rdd1.map(\n      line =&gt; {\n        val fields = line.split(\" \")\n        ((fields(1), fields(4)), 1)\n      }\n    )\n\n    // 3. \u5c06\u8f6c\u6362\u7ed3\u6784\u540e\u7684\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u805a\u5408\n    // ((\u7701\u4efd, \u5e7f\u544a), 1) =&gt; ((\u7701\u4efd, \u5e7f\u544a), sum)\n    val rdd3: RDD[((String, String), Int)] = rdd2.reduceByKey((a, b) =&gt; a + b)\n\n    // 4. \u5c06\u805a\u5408\u7684\u7ed3\u679c\u8fdb\u884c\u7ed3\u6784\u7684\u8f6c\u6362\n    // ((\u7701\u4efd, \u5e7f\u544a), sum) =&gt; (\u7701\u4efd, (\u5e7f\u544a, sum))\n    val rdd4: RDD[(String, (String, Int))] = rdd3.map({\n      case ((province, advertisement), sum) =&gt; (province, (advertisement, sum))\n    })\n\n    // 5. \u5c06\u8f6c\u6362\u7ed3\u6784\u540e\u7684\u6570\u636e\u6839\u636e\u7701\u4efd\u8fdb\u884c\u5206\u7ec4\n    // (\u7701\u4efd, (\u5e7f\u544a, sum)) =&gt; (\u7701\u4efd, Iterable[(\u5e7f\u544a, sum)])\n    val rdd5: RDD[(String, Iterable[(String, Int)])] = rdd4.groupByKey()\n\n    // 6. \u5c06\u5206\u7ec4\u540e\u7684\u6570\u636e\u7ec4\u5185\u6392\u5e8f\u53d6\u524d 3 \u540d\n    // (\u7701\u4efd, Iterable[(\u5e7f\u544a, sum)]) =&gt; (\u7701\u4efd, List[(\u5e7f\u544a, sum)])\n    val rdd6: RDD[(String, List[(String, Int)])] = rdd5.mapValues(\n      values =&gt; values\n        .toList\n        .sortBy(t =&gt; t._2)(Ordering.Int.reverse)\n        .take(3)\n    )\n\n    // 7. \u91c7\u96c6\u6570\u636e\u6253\u5370\u5728\u63a7\u5236\u53f0\u4e0a\n    rdd6.collect().foreach(println)\n  }\n}\n</code></pre> </li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2135-rdd","title":"2.1.3.5 RDD \u884c\u52a8\u7b97\u5b50","text":"<ol> <li> <p><code>reduce</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def reduce(f: (T, T) =&gt; T): T\n</code></pre> </li> </ul> </li> <li> <p><code>collect</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def collect(): Array[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5728\u9a71\u52a8\u7a0b\u5e8f\u4e2d\uff0c\u4ee5\u6570\u7ec4 Array \u7684\u5f62\u5f0f\u8fd4\u56de\u6570\u636e\u96c6\u7684\u6240\u6709\u5143\u7d20\u3002</p> </li> </ul> </li> <li> <p><code>count</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def count(): Long\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u8fd4\u56de RDD \u4e2d\u5143\u7d20\u7684\u4e2a\u6570\u3002</p> </li> </ul> </li> <li> <p><code>first</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def first(): T\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u8fd4\u56de RDD \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002</p> </li> </ul> </li> <li> <p><code>take</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def take(num: Int): Array[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u8fd4\u56de\u4e00\u4e2a\u7531 RDD \u7684\u524d n \u4e2a\u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4\u3002</p> </li> </ul> </li> <li> <p><code>takeOrdered</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def takeOrdered(num: Int)(implicit ord: Ordering[T]): Array[T]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u8fd4\u56de\u8be5 RDD \u6392\u5e8f\u540e\u7684\u524d n \u4e2a\u5143\u7d20\u7ec4\u6210\u7684\u6570\u7ec4\u3002</p> </li> </ul> </li> <li> <p><code>aggregate</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def aggregate[U: ClassTag](zeroValue: U)(seqOp: (U, T) =&gt; U, combOp: (U, U) =&gt; U): U\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5206\u533a\u7684\u6570\u636e\u901a\u8fc7\u521d\u59cb\u503c\u548c\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u7136\u540e\u518d\u548c\u521d\u59cb\u503c\u8fdb\u884c\u5206\u533a\u95f4\u7684\u6570\u636e\u805a\u5408\u3002</p> </li> </ul> </li> <li> <p><code>fold</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def fold(zeroValue: T)(op: (T, T) =&gt; T): T\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u6298\u53e0\u64cd\u4f5c\uff0c<code>aggregate</code> \u7684\u7b80\u5316\u7248\u64cd\u4f5c\u3002</p> </li> </ul> </li> <li> <p><code>countByKey</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def countByKey(): Map[K, Long]\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u7edf\u8ba1\u6bcf\u79cd Key \u7684\u4e2a\u6570\u3002</p> </li> </ul> </li> <li> <p><code>save</code> \u76f8\u5173\u7b97\u5b50</p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def saveAsTextFile(path: String): Unit\ndef saveAsObjectFile(path: String): Unit\ndef saveAsSequenceFile(\n    path: String,\n    codec: Option[Class[_ &lt;: CompressionCodec]] = None\n): Unit\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <pre><code>val rdd: RDD[String] = sc.makeRDD(Array(\"hello\", \"world\"))\n// \u4fdd\u5b58\u6210 Text \u6587\u4ef6\nrdd.saveAsTextFile(\"output\")\n// \u5e8f\u5217\u5316\u6210\u5bf9\u8c61\u4fdd\u5b58\u5230\u6587\u4ef6\nrdd.saveAsObjectFile(\"output1\")\n// \u4fdd\u5b58\u6210 Sequencefile \u6587\u4ef6\nrdd.map(it =&gt; (it, 1)).saveAsSequenceFile(\"output2\")\n</code></pre> </li> </ul> </li> <li> <p><code>foreach</code></p> <ul> <li> <p>\u51fd\u6570\u7b7e\u540d</p> <pre><code>def foreach[U](f: A =&gt; U): Unit\n</code></pre> </li> <li> <p>\u51fd\u6570\u8bf4\u660e</p> <p>\u5206\u5e03\u5f0f\u904d\u5386 RDD \u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u8c03\u7528\u6307\u5b9a\u51fd\u6570\u3002</p> </li> </ul> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2136-rdd","title":"2.1.3.6 RDD \u5e8f\u5217\u5316","text":"<ol> <li> <p>\u95ed\u5305\u68c0\u67e5</p> <p>\u4ece\u8ba1\u7b97\u7684\u89d2\u5ea6\uff0c\u7b97\u5b50\u4ee5\u5916\u7684\u4ee3\u7801\u90fd\u662f\u5728 Driver \u7aef\u6267\u884c\uff0c\u7b97\u5b50\u91cc\u9762\u7684\u4ee3\u7801\u90fd\u662f\u5728 Executor \u7aef\u6267\u884c\u3002\u90a3\u4e48\u5728 Scala \u51fd\u6570\u5f0f\u7f16\u7a0b\u4e2d\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7b97\u5b50\u5185\u7ecf\u5e38\u4f1a\u7528\u5230\u7b97\u5b50\u5916\u7684\u6570\u636e\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u95ed\u5305\u7684\u6548\u679c\uff0c\u5982\u679c\u4f7f\u7528\u7684\u7b97\u5b50\u5916\u7684\u6570\u636e\u65e0\u6cd5\u5e8f\u5217\u5316\uff0c\u5c31\u610f\u5473\u7740\u65e0\u6cd5\u4f20\u503c\u7ed9 Executor \u7aef\u6267\u884c\uff0c\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\uff0c\u6240\u4ee5\u9700\u8981\u5728\u6267\u884c\u4efb\u52a1\u8ba1\u7b97\u524d\uff0c\u68c0\u6d4b\u95ed\u5305\u5185\u7684\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u79f0\u4e4b\u4e3a\u95ed\u5305\u68c0\u67e5\u3002</p> </li> <li> <p>\u5e8f\u5217\u5316\u65b9\u6cd5\u548c\u5c5e\u6027</p> <pre><code>class Searcher(query: String) extends Serializable {\n  def getMatchRDD(rdd: RDD[String]): RDD[String] = rdd.filter(it =&gt; it.contains(query))\n}\n\nobject App3 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n\n    val rdd = sc.makeRDD(Array(\"hello world\", \"hello spark\", \"hello flink\", \"kafka\"))\n    val searcher = new Searcher(\"hello\")\n    val result = searcher.getMatchRDD(rdd)\n    result.collect().foreach(println)\n  }\n}\n</code></pre> </li> <li> <p>Kryo \u5e8f\u5217\u5316\u6846\u67b6</p> <p>https://github.com/EsotericSoftware/kryo</p> <p>Java \u7684\u5e8f\u5217\u5316\u80fd\u591f\u5e8f\u5217\u5316\u4efb\u4f55\u7684\u7c7b\uff0c\u4f46\u662f\u6bd4\u8f83\u91cd\uff08\u5b57\u8282\u591a\uff09\uff0c\u5e8f\u5217\u5316\u540e\u5bf9\u8c61\u7684\u63d0\u4ea4\u4e5f\u6bd4\u8f83\u5927\u3002Spark \u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0cSpark 2.0 \u5f00\u59cb\u652f\u6301\u53e6\u5916\u4e00\u79cd Kryo \u5e8f\u5217\u5316\u673a\u5236\u3002Kryo \u901f\u5ea6\u662f Serializable \u7684 10 \u500d\u3002\u5f53 RDD \u5728 Shuffle \u6570\u636e\u7684\u65f6\u5019\uff0c\u7b80\u5355\u6570\u636e\u7c7b\u578b\u3001\u6570\u7ec4\u3001\u5b57\u7b26\u4e32\u7c7b\u578b\u5df2\u7ecf\u5728 Spark \u5185\u90e8\u4f7f\u7528 Kryo \u6765\u5e8f\u5217\u5316\u3002</p> <p>\u6ce8\u610f\uff1a\u5373\u4f7f\u4f7f\u7528 Kryo \u5e8f\u5217\u5316\uff0c\u4e5f\u8981\u7ee7\u627f Serializable \u63a5\u53e3\u3002</p> <pre><code>class Searcher(query: String) extends Serializable {\n  def getMatchRDD(rdd: RDD[String]): RDD[String] = rdd.filter(it =&gt; it.contains(query))\n}\n\nobject App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf()\n      .setAppName(\"App\")\n      .setMaster(\"local[*]\")\n      // \u66ff\u6362\u9ed8\u8ba4\u7684\u5e8f\u5217\u5316\u673a\u5236\n      .set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n      // \u6ce8\u518c\u9700\u8981\u4f7f\u7528 Kryo \u5e8f\u5217\u5316\u7684\u81ea\u5b9a\u4e49\u7c7b\n      .registerKryoClasses(Array(classOf[Searcher]))\n    val sc = new SparkContext(conf)\n\n    val rdd = sc.makeRDD(Array(\"hello world\", \"hello spark\", \"hello flink\", \"kafka\"))\n    val searcher = new Searcher(\"hello\")\n    val result = searcher.getMatchRDD(rdd)\n    result.collect().foreach(println)\n  }\n}\n</code></pre> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2137-rdd","title":"2.1.3.7 RDD \u4f9d\u8d56\u5173\u7cfb","text":"<ol> <li> <p>RDD \u8840\u7f18\u5173\u7cfb</p> <p>RDD \u53ea\u652f\u6301\u7c97\u7c92\u5ea6\u8f6c\u6362\uff0c\u5373\u5728\u5927\u91cf\u8bb0\u5f55\u4e0a\u6267\u884c\u7684\u5355\u4e2a\u64cd\u4f5c\u3002\u5c06\u521b\u5efa RDD \u7684\u4e00\u7cfb\u5217 Lineage\uff08\u8840\u7edf\uff09\u8bb0\u5f55\u4e0b\u6765\uff0c\u4ee5\u4fbf\u6062\u590d\u4e22\u5931\u7684\u5206\u533a\u3002RDD \u7684 Lineage \u4f1a\u8bb0\u5f55 RDD \u7684\u5143\u6570\u636e\u4fe1\u606f\u548c\u8f6c\u6362\u884c\u4e3a\uff0c\u5f53\u8be5 RDD \u7684\u90e8\u5206\u5206\u533a\u6570\u636e\u4e22\u5931\u65f6\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u6765\u91cd\u65b0\u8fd0\u7b97\u548c\u6062\u590d\u4e22\u5931\u7684\u6570\u636e\u5206\u533a\u3002</p> <pre><code>val fileRDD: RDD[String] = sc.textFile(\"input/1.txt\")\nprintln(fileRDD.toDebugString)\nprintln(\"----------------------\")\n\nval wordRDD: RDD[String] = fileRDD.flatMap(_.split(\" \"))\nprintln(wordRDD.toDebugString)\nprintln(\"----------------------\")\n\nval mapRDD: RDD[(String, Int)] = wordRDD.map((_, 1))\nprintln(mapRDD.toDebugString)\nprintln(\"----------------------\")\n\nval resultRDD: RDD[(String, Int)] = mapRDD.reduceByKey(_ + _)\nprintln(resultRDD.toDebugString)\n\nresultRDD.collect()\n</code></pre> </li> <li> <p>RDD \u4f9d\u8d56\u5173\u7cfb</p> <p>\u8fd9\u91cc\u6240\u8c13\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5176\u5b9e\u5c31\u662f\u4e24\u4e2a\u76f8\u90bb RDD \u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <pre><code>val fileRDD: RDD[String] = sc.textFile(\"input/1.txt\")\nprintln(fileRDD.dependencies)\nprintln(\"----------------------\")\n\nval wordRDD: RDD[String] = fileRDD.flatMap(_.split(\" \"))\nprintln(wordRDD.dependencies)\nprintln(\"----------------------\")\n\nval mapRDD: RDD[(String, Int)] = wordRDD.map((_, 1))\nprintln(mapRDD.dependencies)\nprintln(\"----------------------\")\n\nval resultRDD: RDD[(String, Int)] = mapRDD.reduceByKey(_ + _)\nprintln(resultRDD.dependencies)\n\nresultRDD.collect()\n</code></pre> </li> <li> <p>RDD \u7a84\u4f9d\u8d56</p> <p>\u7a84\u4f9d\u8d56\u8868\u793a\u6bcf\u4e00\u4e2a\u7236\uff08\u4e0a\u6e38\uff09 RDD \u7684 Partition \u6700\u591a\u88ab\u5b50\uff08\u4e0b\u6e38\uff09 RDD \u7684\u4e00\u4e2a Partition \u4f7f\u7528\uff0c\u7a84\u4f9d\u8d56\u6211\u4eec\u5f62\u8c61\u7684\u6bd4\u55bb\u4e3a\u72ec\u751f\u5b50\u5973\u3002</p> <pre><code>class OneToOneDependency[T](rdd: RDD[T]) extends NarrowDependency[T](rdd)\n</code></pre> </li> <li> <p>RDD \u5bbd\u4f9d\u8d56</p> <p>\u5bbd\u4f9d\u8d56\u8868\u793a\u540c\u4e00\u4e2a\u7236\uff08\u4e0a\u6e38\uff09RDD \u7684 Partition \u88ab\u591a\u4e2a\u5b50\uff08\u4e0b\u6e38\uff09RDD \u7684 Partition \u4f9d\u8d56\uff0c\u4f1a\u5f15\u8d77 Shuffle\u3002\u603b\u7ed3\uff1a\u5bbd\u4f9d\u8d56\u6211\u4eec\u5f62\u8c61\u7684\u6bd4\u55bb\u4e3a\u591a\u751f\u3002</p> <pre><code>class ShuffleDependency[K: ClassTag, V: ClassTag, C: ClassTag](\n    @transient private val _rdd: RDD[_ &lt;: Product2[K, V]],\n    val partitioner: Partitioner,\n    val serializer: Serializer = SparkEnv.get.serializer,\n    val keyOrdering: Option[Ordering[K]] = None,\n    val aggregator: Option[Aggregator[K, V, C]] = None,\n    val mapSideCombine: Boolean = false,\n    val shuffleWriterProcessor: ShuffleWriteProcessor = new ShuffleWriteProcessor\n) extends Dependency[Product2[K, V]]\n</code></pre> </li> <li> <p>RDD \u4efb\u52a1\u5212\u5206</p> <ul> <li>Application\uff1a\u521d\u59cb\u5316\u4e00\u4e2a SparkContext \u5373\u751f\u6210\u4e00\u4e2a Application\uff1b</li> <li>Job\uff1a\u4e00\u4e2a Action \u7b97\u5b50\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a Job\uff1b</li> <li>Stage\uff1aStage \u7b49\u4e8e\u5bbd\u4f9d\u8d56\uff08ShuffleDependency\uff09\u7684\u4e2a\u6570\u52a0 1\uff1b</li> <li>Task\uff1a\u4e00\u4e2a Stage \u9636\u6bb5\u4e2d\uff0c\u6700\u540e\u4e00\u4e2a RDD \u7684\u5206\u533a\u4e2a\u6570\u5c31\u662f Task \u7684\u4e2a\u6570\uff1b</li> </ul> <p>\u6ce8\u610f\uff1aApplication -&gt; Job -&gt; Stage -&gt; Task \u6bcf\u4e00\u5c42\u90fd\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002</p> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5148-rdd","title":"5.1.4.8 RDD \u6301\u4e45\u5316","text":"<ol> <li> <p>RDD Cache \u7f13\u5b58</p> <p>RDD \u901a\u8fc7 <code>cache()</code>\u6216\u8005 <code>persist()</code>\u65b9\u6cd5\u5c06\u524d\u9762\u7684\u8ba1\u7b97\u7ed3\u679c\u7f13\u5b58\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u628a\u6570\u636e\u7f13\u5b58\u5728 JVM \u7684\u5806\u5185\u5b58\u4e2d\u3002\u4f46\u662f\u5e76\u4e0d\u662f\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\u7acb\u5373\u7f13\u5b58\uff0c\u800c\u662f\u89e6\u53d1\u540e\u9762\u7684 Action \u7b97\u5b50\u65f6\uff0c\u8be5 RDD \u624d\u4f1a\u88ab\u7f13\u5b58\u5728\u8ba1\u7b97\u8282\u70b9\u7684\u5185\u5b58\u4e2d\uff0c\u5e76\u4f9b\u540e\u9762\u590d\u7528\u3002</p> <pre><code>rdd.cache()\nrdd.persist(StorageLevel.MEMORY_AND_DISK_2)\n</code></pre> <p>\u7f13\u5b58\u6709\u53ef\u80fd\u4e22\u5931\uff0c\u6216\u8005\u5b58\u50a8\u4e8e\u5185\u5b58\u7684\u6570\u636e\u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u800c\u88ab\u5220\u9664\uff0cRDD \u7684\u7f13\u5b58\u5bb9\u9519\u673a\u5236\u4fdd\u8bc1\u4e86\u5373\u4f7f\u7f13\u5b58\u4e22\u5931\u4e5f\u80fd\u4fdd\u8bc1\u8ba1\u7b97\u7684\u6b63\u786e\u6267\u884c\u3002\u901a\u8fc7\u57fa\u4e8e RDD \u7684\u7cfb\u5217\u8f6c\u6362\uff0c\u4e22\u5931\u7684\u6570\u636e\u4f1a\u88ab\u91cd\u7b97\uff0c\u7531\u4e8e RDD \u7684\u5404\u4e2a Partition \u662f\u76f8\u5bf9\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8ba1\u7b97\u4e22\u5931\u7684\u90e8\u5206\u5373\u53ef\uff0c\u5e76\u4e0d\u9700\u8981\u91cd\u7b97\u5168\u90e8 Partition\u3002</p> <p>Spark \u4f1a\u81ea\u52a8\u5bf9\u4e00\u4e9b Shuffle \u64cd\u4f5c\u7684\u4e2d\u95f4\u6570\u636e\u505a\u6301\u4e45\u5316\u64cd\u4f5c\uff08\u6bd4\u5982 <code>reduceByKey</code>\uff09\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5f53\u4e00\u4e2a\u8282\u70b9 Shuffle \u5931\u8d25\u4e86\u907f\u514d\u91cd\u65b0\u8ba1\u7b97\u6574\u4e2a\u8f93\u5165\u3002\u4f46\u662f\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u91cd\u7528\u6570\u636e\uff0c\u4ecd\u7136\u5efa\u8bae\u8c03\u7528 <code>cache()</code> \u6216 <code>persist()</code> \u3002</p> </li> <li> <p>RDD Checkpoint \u68c0\u67e5\u70b9</p> <p>\u6240\u8c13\u7684\u68c0\u67e5\u70b9\u5176\u5b9e\u5c31\u662f\u901a\u8fc7\u5c06 RDD \u4e2d\u95f4\u7ed3\u679c\u5199\u5165\u78c1\u76d8\uff0c\u7531\u4e8e\u8840\u7f18\u4f9d\u8d56\u8fc7\u957f\u4f1a\u9020\u6210\u5bb9\u9519\u6210\u672c\u8fc7\u9ad8\uff0c\u8fd9\u6837\u5c31\u4e0d\u5982\u5728\u4e2d\u95f4\u9636\u6bb5\u505a\u68c0\u67e5\u70b9\u5bb9\u9519\uff0c\u5982\u679c\u68c0\u67e5\u70b9\u4e4b\u540e\u6709\u8282\u70b9\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u4ece\u68c0\u67e5\u70b9\u91cd\u505a\u8840\u7f18\uff0c\u51cf\u5c11\u4e86\u5f00\u9500\u3002\u5bf9 RDD \u8fdb\u884c Checkpoint \u64cd\u4f5c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u88ab\u6267\u884c\uff0c\u5fc5\u987b\u6267\u884c Action \u64cd\u4f5c\u624d\u80fd\u89e6\u53d1\u3002</p> <pre><code>// \u8bbe\u7f6e\u68c0\u67e5\u70b9\u8def\u5f84\nsc.setCheckpointDir(\"checkpoint\")\nval lineRdd: RDD[String] = sc.textFile(\"input/1.txt\")\n// \u4e1a\u52a1\u903b\u8f91\nval wordRdd: RDD[String] = lineRdd.flatMap(line =&gt; line.split(\" \"))\nval wordToOneRdd: RDD[(String, Long)] = wordRdd.map(word =&gt; (word, System.currentTimeMillis()))\n// \u7f13\u5b58\nwordToOneRdd.cache()\n// \u68c0\u67e5\u70b9\nwordToOneRdd.checkpoint()\n// \u89e6\u53d1\u6267\u884c\u903b\u8f91\nwordToOneRdd.collect().foreach(println)\n</code></pre> </li> <li> <p>\u7f13\u5b58\u548c\u68c0\u67e5\u70b9\u533a\u522b</p> <ul> <li>Cache \u53ea\u662f\u5c06\u6570\u636e\u4fdd\u5b58\u8d77\u6765\uff0c\u4e0d\u5207\u65ad\u8840\u7f18\u4f9d\u8d56\uff1bCheckpoint \u5207\u65ad\u8840\u7f18\u4f9d\u8d56\u3002</li> <li>Cache \u7f13\u5b58\u7684\u6570\u636e\u901a\u5e38\u5b58\u50a8\u5728\u78c1\u76d8\u3001\u5185\u5b58\u7b49\u5730\u65b9\uff0c\u53ef\u9760\u6027\u4f4e\uff1bCheckpoint \u7684\u6570\u636e\u901a\u5e38\u5b58\u50a8\u5728 HDFS \u7b49\u5bb9\u9519\u3001\u9ad8\u53ef\u7528\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u9760\u6027\u9ad8\u3002</li> <li>\u5efa\u8bae\u5bf9 Checkpoint \u7684 RDD \u4f7f\u7528 Cache\uff0c\u8fd9\u6837 Checkpoint \u7684 Job \u53ea\u9700\u4ece Cache \u4e2d\u8bfb\u53d6\u6570\u636e\u5373\u53ef\uff0c\u5426\u5219\u9700\u8981\u518d\u4ece\u5934\u8ba1\u7b97\u4e00\u6b21 RDD\u3002</li> </ul> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2139-rdd","title":"2.1.3.9 RDD \u5206\u533a\u5668","text":"<p>Spark \u76ee\u524d\u652f\u6301 Hash \u5206\u533a\u548c Range \u5206\u533a\uff0c\u548c\u7528\u6237\u81ea\u5b9a\u4e49\u5206\u533a\u3002Hash \u5206\u533a\u4e3a\u5f53\u524d\u7684\u9ed8\u8ba4\u5206\u533a\u3002\u5206\u533a\u5668\u76f4\u63a5\u51b3\u5b9a\u4e86 RDD \u4e2d\u5206\u533a\u7684\u4e2a\u6570\u3001RDD \u4e2d\u6bcf\u6761\u6570\u636e\u7ecf\u8fc7 Shuffle \u540e\u8fdb\u5165\u54ea\u4e2a\u5206\u533a\uff0c\u8fdb\u800c\u51b3\u5b9a\u4e86 Reduce \u7684\u4e2a\u6570\u3002</p> <p>\u53ea\u6709 Key-Value \u7c7b\u578b\u7684 RDD \u624d\u6709\u5206\u533a\u5668\uff0c\u975e Key-Value \u7c7b\u578b\u7684 RDD \u5206\u533a\u7684\u503c\u662f None\u3002</p> <ul> <li>Hash \u5206\u533a\uff1a\u5bf9\u4e8e\u7ed9\u5b9a\u7684 Key\uff0c\u8ba1\u7b97\u5176 Hash Code \u5e76\u5904\u4ee5\u5206\u533a\u4e2a\u6570\u53d6\u4f59\u3002</li> <li>Range \u5206\u533a\uff1a\u5c06\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u6570\u636e\u6620\u5c04\u5230\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u6bcf\u4e2a\u5206\u533a\u6570\u636e\u5747\u5300\uff0c\u800c\u4e14\u5206\u533a\u95f4\u6709\u5e8f\u3002</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#21310-rdd","title":"2.1.3.10 RDD \u6587\u4ef6\u8bfb\u53d6\u4e0e\u4fdd\u5b58","text":"<p>Spark \u7684\u6570\u636e\u8bfb\u53d6\u53ca\u4fdd\u5b58\u53ef\u4ee5\u4ece\u4e24\u4e2a\u7ef4\u5ea6\u6765\u4f5c\u4e3a\u533a\u5206\uff1a\u6587\u4ef6\u683c\u5f0f\u4ee5\u53ca\u6587\u4ef6\u7cfb\u7edf\u3002\u6587\u4ef6\u683c\u5f0f\u5206\u4e3a Text \u6587\u4ef6\u3001CSV \u6587\u4ef6\u3001Sequence \u6587\u4ef6\u4ee5\u53ca Object \u6587\u4ef6\uff1b\u6587\u4ef6\u7cfb\u7edf\u5206\u4e3a\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3001HDFS\u3001HBase \u4ee5\u53ca\u6570\u636e\u5e93\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#22","title":"2.2 \u7d2f\u52a0\u5668","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#221","title":"2.2.1 \u5b9e\u73b0\u539f\u7406","text":"<p>\u7d2f\u52a0\u5668\u7528\u6765\u628a Executor \u7aef\u53d8\u91cf\u4fe1\u606f\u805a\u5408\u5230 Driver \u7aef\u3002\u5728 Driver \u7a0b\u5e8f\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5728 Executor \u7aef\u7684\u6bcf\u4e2a Task \u90fd\u4f1a\u5f97\u5230\u8fd9\u4e2a\u53d8\u91cf\u7684\u4e00\u4efd\u65b0\u7684\u526f\u672c\uff0c\u6bcf\u4e2a Task \u66f4\u65b0\u8fd9\u4e9b\u526f\u672c\u7684\u503c\u540e\uff0c\u4f20\u56de Driver \u7aef\u8fdb\u884c Merge\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#222","title":"2.2.2 \u57fa\u7840\u7f16\u7a0b","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2221","title":"2.2.2.1 \u7cfb\u7edf\u7d2f\u52a0\u5668","text":"<pre><code>val rdd = sc.makeRDD(List(1, 2, 3, 4, 5))\nval sum = sc.longAccumulator(\"sum\")\nrdd.foreach(it =&gt; sum.add(it))\n\nprintln(sum)\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#2222","title":"2.2.2.2 \u81ea\u5b9a\u4e49\u7d2f\u52a0\u5668","text":"<pre><code>class WordCountAccumulator extends AccumulatorV2[String, mutable.Map[String, Long]] {\n  private var map: mutable.Map[String, Long] = mutable.Map[String, Long]()\n\n  override def isZero: Boolean = map.isEmpty\n\n  override def copy(): AccumulatorV2[String, mutable.Map[String, Long]] = new WordCountAccumulator\n\n  override def reset(): Unit = map.clear()\n\n  override def add(word: String): Unit = map(word) = map.getOrElse(word, 0L) + 1L\n\n  override def merge(other: AccumulatorV2[String, mutable.Map[String, Long]]): Unit = {\n    val map1 = map\n    val map2 = other.value\n    map = map1.foldLeft(map2)(\n      (innerMap, kv) =&gt; {\n        innerMap(kv._1) = innerMap.getOrElse(kv._1, 0L) + kv._2\n        innerMap\n      }\n    )\n  }\n\n  override def value: mutable.Map[String, Long] = map\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#23","title":"2.3 \u5e7f\u64ad\u53d8\u91cf","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#231","title":"2.3.1 \u5b9e\u73b0\u539f\u7406","text":"<p>\u5e7f\u64ad\u53d8\u91cf\u7528\u6765\u9ad8\u6548\u5206\u53d1\u8f83\u5927\u7684\u5bf9\u8c61\u3002\u5411\u6240\u6709\u5de5\u4f5c\u8282\u70b9\u53d1\u9001\u4e00\u4e2a\u8f83\u5927\u7684\u53ea\u8bfb\u503c\uff0c\u4ee5\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a Spark \u64cd\u4f5c\u3002\u6bd4\u5982\uff0c\u5982\u679c\u4f60\u7684\u5e94\u7528\u9700\u8981\u5411\u6240\u6709\u8282\u70b9\u53d1\u9001\u4e00\u4e2a\u8f83\u5927\u7684\u53ea\u8bfb\u67e5\u8be2\u8868\uff0c\u5e7f\u64ad\u53d8\u91cf\u7528\u8d77\u6765\u90fd\u5f88\u987a\u624b\u3002\u5728\u591a\u4e2a\u5e76\u884c\u64cd\u4f5c\u4e2d\u4f7f\u7528\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u662f Spark \u4f1a\u4e3a\u6bcf\u4e2a\u4efb\u52a1\u5206\u522b\u53d1\u9001\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#232","title":"2.3.2 \u57fa\u7840\u7f16\u7a0b","text":"<pre><code>val list1 = List((\"a\", 1), (\"b\", 2), (\"c\", 3), (\"d\", 4))\nval list2 = List((\"a\", 4), (\"b\", 5), (\"c\", 6), (\"d\", 7))\n\nval rdd = sc.makeRDD(list1, 4)\nval broadcast = sc.broadcast(list2)\n\nval resultRDD = rdd.map({\n  case (k1, v1) =&gt; {\n    var v = 0\n    broadcast.value.foreach({\n      case (k2, v2) =&gt; {\n        if (k2 == k1) {\n          v = v2\n        }\n      }\n    })\n    (k1, (v1, v))\n  }\n})\n\nresultRDD.collect().foreach(println)\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#_1","title":"\u4e09\u3001\u6848\u4f8b\u5b9e\u64cd","text":"<ul> <li> <p>\u6837\u4f8b\u7c7b</p> <pre><code>case class UserVisitAction(\n  date: String,                 // \u7528\u6237\u70b9\u51fb\u884c\u4e3a\u7684\u65e5\u671f\n  user_id: String,              // \u7528\u6237\u7684 ID\n  session_id: String,           // \u4f1a\u8bdd\u7684 ID\n  page_id: String,              // \u9875\u9762\u7684 ID\n  action_time: String,          // \u52a8\u4f5c\u7684\u65f6\u95f4\u70b9\n  search_keyword: String,       // \u7528\u6237\u641c\u7d22\u7684\u5173\u952e\u8bcd\n  click_category_id: String,    // \u5546\u54c1\u54c1\u7c7b\u7684 ID\n  click_product_id: String,     // \u5546\u54c1\u7684 ID\n  order_category_ids: String,   // \u4e00\u6b21\u8ba2\u5355\u4e2d\u6240\u6709\u54c1\u7c7b\u7684 ID \u96c6\u5408\n  order_product_ids: String,    // \u4e00\u6b21\u8ba2\u5355\u4e2d\u6240\u6709\u54c1\u7c7b\u7684 ID \u96c6\u5408\n  pay_category_ids: String,     // \u4e00\u6b21\u652f\u4ed8\u4e2d\u6240\u6709\u54c1\u7c7b\u7684 ID \u96c6\u5408\n  pay_product_ids: String,      // \u4e00\u6b21\u652f\u4ed8\u4e2d\u6240\u6709\u5546\u54c1\u7684 ID \u96c6\u5408\n  city_id: String               // \u57ce\u5e02\u7684 ID\n)\n\ncase object UserVisitAction {\n  def parse(line: String): UserVisitAction = {\n    val fields = line.split(\"_\")\n    UserVisitAction(\n      fields(0),\n      fields(1),\n      fields(2),\n      fields(3),\n      fields(4),\n      fields(5),\n      fields(6),\n      fields(7),\n      fields(8),\n      fields(9),\n      fields(10),\n      fields(11),\n      fields(12)\n    )\n  }\n}\n</code></pre> </li> <li> <p>\u6570\u636e\u89c4\u5219</p> <p>\u6570\u636e\u53d6\u81ea\u7535\u5546\u7f51\u7ad9\u7684\u7528\u6237\u884c\u4e3a\u6570\u636e\uff0c\u4e3b\u8981\u5305\u542b\u7528\u6237\u7684 4 \u79cd\u884c\u4e3a\uff1a\u641c\u7d22\u3001\u70b9\u51fb\u3001\u4e0b\u5355\u3001\u652f\u4ed8\u3002\u6570\u636e\u89c4\u5219\u5982\u4e0b\uff1a</p> <ul> <li>\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u6bcf\u884c\u6570\u636e\u91c7\u7528\u4e0b\u5212\u7ebf\u5206\u9694\u6570\u636e\uff1b</li> <li>\u6bcf\u4e00\u884c\u6570\u636e\u8868\u793a\u7528\u6237\u7684\u4e00\u6b21\u884c\u4e3a\uff0c\u8fd9\u4e2a\u884c\u4e3a\u53ea\u80fd\u662f 4 \u79cd\u884c\u4e3a\u7684\u4e00\u79cd\uff1b</li> <li>\u5982\u679c\u641c\u7d22\u5173\u952e\u5b57\u4e3a null\uff0c\u8868\u793a\u6570\u636e\u4e0d\u662f\u641c\u7d22\u6570\u636e\uff1b</li> <li>\u5982\u679c\u70b9\u51fb\u7684\u54c1\u7c7b ID \u548c\u4ea7\u54c1 ID \u4e3a -1\uff0c\u8868\u793a\u6570\u636e\u4e0d\u662f\u70b9\u51fb\u6570\u636e\uff1b</li> <li>\u9488\u5bf9\u4e8e\u4e0b\u5355\u884c\u4e3a\uff0c\u4e00\u6b21\u53ef\u4ee5\u4e0b\u5355\u591a\u4e2a\u5546\u54c1\uff0c\u6240\u6709\u54c1\u7c7b ID \u548c\u4ea7\u54c1 ID \u53ef\u4ee5\u662f\u591a\u4e2a\uff0cid \u4e4b\u95f4\u91c7\u7528\u9017\u53f7\u5206\u9694\uff0c\u5982\u679c\u672c\u6b21\u4e0d\u662f\u4e0b\u5355\u884c\u4e3a\uff0c\u5219\u6570\u636e\u91c7\u7528 null \u8868\u793a\uff1b</li> <li>\u652f\u4ed8\u884c\u4e3a\u548c\u4e0b\u5355\u884c\u4e3a\u7c7b\u4f3c\uff1b</li> </ul> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#31-top10","title":"3.1 \u9700\u6c42\u4e00\uff1aTop10 \u70ed\u95e8\u54c1\u7c7b","text":"<pre><code>object Requirement1 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement1\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n    sc.setLogLevel(\"WARN\")\n\n    val actionRDD = sc.textFile(\"public/spark-core/user_visit_action.txt\").map(UserVisitAction.parse)\n\n    val top10Category = getTop10Category(actionRDD)\n\n    top10Category.foreach(println)\n  }\n\n  private def getTop10Category(actionRDD: RDD[UserVisitAction]): Array[(String, (Int, Int, Int))] = {\n    actionRDD\n      // \u6570\u636e\u7ed3\u6784\u8f6c\u6362\n      // &gt; click: (category_id,(1,0,0))\n      // &gt; order: (category_id,(0,1,0))\n      // &gt; pay:   (category_id,(0,0,1))\n      .flatMap(action =&gt; {\n        if (action.click_category_id != \"-1\") {\n          // \u70b9\u51fb\u7684\u573a\u5408\n          Array((action.click_category_id, (1, 0, 0)))\n        } else if (action.order_category_ids != \"null\") {\n          // \u4e0b\u5355\u7684\u573a\u5408\n          action.order_category_ids.split(\",\").map(id =&gt; (id, (0, 1, 0)))\n        } else if (action.pay_category_ids != \"null\") {\n          // \u652f\u4ed8\u7684\u573a\u5408\n          action.pay_category_ids.split(\",\").map(id =&gt; (id, (0, 0, 1)))\n        } else {\n          Nil\n        }\n      })\n      // \u5c06\u76f8\u540c\u54c1\u7c7b ID \u7684\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u805a\u5408\n      // &gt; (category_id,(click_count,order_count,pay_count))\n      .reduceByKey((a, b) =&gt; (a._1 + b._1, a._2 + b._2, a._3 + b._3))\n      // \u5c06\u7edf\u8ba1\u7ed3\u679c\u6839\u636e\u6570\u91cf\u8fdb\u884c\u964d\u5e8f\u5904\u7406\u53d6\u524d 10 \u540d\n      .sortBy(f = it =&gt; it._2, ascending = false)\n      .take(10)\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#32-top10-top10","title":"3.2 \u9700\u6c42\u4e8c\uff1aTop10 \u70ed\u95e8\u54c1\u7c7b\u4e2d\u6bcf\u4e2a\u54c1\u7c7b\u7684 Top10 \u6d3b\u8dc3\u4f1a\u8bdd\u7edf\u8ba1","text":"<pre><code>object Requirement2 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement2\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n    sc.setLogLevel(\"WARN\")\n\n    val actionRDD = sc.textFile(\"public/spark-core/user_visit_action.txt\").map(UserVisitAction.parse)\n\n    val top10Category = getTop10Category(actionRDD)\n\n    val top10CategoryTop10Session = getTop10CategoryTop10Session(\n      actionRDD,\n      top10Category.map(it =&gt; it._1)\n    )\n\n    top10CategoryTop10Session.foreach(println)\n  }\n\n  private def getTop10Category(actionRDD: RDD[UserVisitAction]): Array[(String, (Int, Int, Int))] = ???\n\n  private def getTop10CategoryTop10Session(actionRDD: RDD[UserVisitAction], top10Category: Array[String]): Array[(String, List[(String, Int)])] = {\n    actionRDD\n      // \u8fc7\u6ee4\u539f\u59cb\u6570\u636e\u4fdd\u7559\u70b9\u51fb\u548c\u524d 10 \u54c1\u7c7b\n      .filter(action =&gt; action.click_category_id != \"-1\" &amp;&amp; top10Category.contains(action.click_category_id))\n      // \u6839\u636e\u54c1\u7c7b ID \u548c\u4f1a\u8bdd ID \u8fdb\u884c\u70b9\u51fb\u91cf\u7684\u7edf\u8ba1\n      .map(action =&gt; ((action.click_category_id, action.session_id), 1))\n      .reduceByKey((a, b) =&gt; a + b)\n      // \u6570\u636e\u7ed3\u6784\u8f6c\u6362\n      // &gt; ((category_id,session_id),sum) =&gt; (category_id,(session_id,sum))\n      .map(it =&gt; it match { case ((cid, sid), sum) =&gt; (cid, (sid, sum)) })\n      // \u6839\u636e\u76f8\u540c\u7684\u54c1\u7c7b\u8fdb\u884c\u5206\u7ec4\n      .groupByKey()\n      // \u5c06\u5206\u7ec4\u540e\u7684\u6570\u636e\u8fdb\u884c\u70b9\u51fb\u91cf\u7684\u6392\u5e8f\u53d6\u524d 10 \u540d\n      .mapValues(values =&gt;\n        values\n          .toList\n          .sortBy(it =&gt; it._2)(Ordering.Int.reverse)\n          .take(10)\n      )\n      .collect()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#33","title":"3.3 \u9700\u6c42\u4e09\uff1a\u9875\u9762\u5355\u8df3\u8f6c\u5316\u7387\u7edf\u8ba1","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#331","title":"3.3.1 \u9700\u6c42\u8bf4\u660e","text":"<ul> <li> <p>\u4ec0\u4e48\u662f\u9875\u9762\u5355\u8df3\u8f6c\u5316\u7387</p> <p>\u6bd4\u5982\u4e00\u4e2a\u7528\u6237\u5728\u4e00\u6b21\u4f1a\u8bdd\u8fc7\u7a0b\u4e2d\u8bbf\u95ee\u7684\u9875\u9762\u8def\u5f84 3,5,7,9,10,21\uff0c\u90a3\u4e48\u9875\u9762 3 \u8df3\u5230\u9875\u9762 5 \u53eb\u4e00\u6b21\u5355\u6311\uff0c 7 \u5230 9 \u4e5f\u53eb\u5355\u8df3\uff0c\u90a3\u4e48\u5355\u8df3\u8f6c\u5316\u7387\u5c31\u662f\u8981\u7edf\u8ba1\u9875\u9762\u70b9\u51fb\u7684\u6982\u7387\u3002</p> <p>\u6bd4\u5982\u8ba1\u7b97 3-5 \u7684\u5355\u8df3\u8f6c\u7387\uff0c\u5148\u83b7\u53d6\u7b26\u5408\u6761\u4ef6\u7684\u4f1a\u8bdd\u5bf9\u4e8e\u9875\u9762 3 \u7684\u8bbf\u95ee\u6b21\u6570\uff08PV\uff09\u4e3a A\uff0c\u7136\u540e\u83b7\u53d6\u7b26\u5408\u6761\u4ef6\u7684\u4f1a\u8bdd\u4e2d\u8bbf\u95ee\u4e86\u9875\u9762 3 \u53c8\u7d27\u63a5\u7740\u8bbf\u95ee\u4e86\u9875\u9762 5 \u7684\u6b21\u6570\u4e3a B\uff0c\u90a3\u4e48 B/A \u5c31\u662f 3-5 \u7684\u9875\u9762\u5355\u8df3\u8f6c\u5316\u7387\u3002</p> </li> <li> <p>\u7edf\u8ba1\u9875\u9762\u5355\u8df3\u8f6c\u5316\u7387\u7684\u610f\u4e49</p> <ul> <li>\u4ea7\u54c1\u7ecf\u7406\u548c\u8fd0\u8425\u603b\u76d1\uff0c\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u6307\u6807\uff0c\u53bb\u5c1d\u8bd5\u5206\u6790\uff0c\u6574\u4e2a\u7f51\u7ad9\uff0c\u4ea7\u54c1\uff0c\u5404\u4e2a\u9875\u9762\u7684\u8868\u73b0\u600e\u4e48\u6837\uff0c\u662f\u4e0d\u662f\u9700\u8981\u53bb\u4f18\u5316\u4ea7\u54c1\u7684\u5e03\u5c40\uff0c\u5438\u5f15\u7528\u6237\u6700\u7ec8\u53ef\u4ee5\u8fdb\u5165\u6700\u540e\u7684\u652f\u4ed8\u9875\u9762\u3002</li> <li>\u6570\u636e\u5206\u6790\u5e08\uff0c\u53ef\u4ee5\u6839\u636e\u6b64\u6570\u636e\u505a\u66f4\u6df1\u4e00\u6b65\u7684\u8ba1\u7b97\u548c\u5206\u6790\u3002</li> <li>\u4f01\u4e1a\u7ba1\u7406\u5458\uff0c\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u516c\u53f8\u7684\u7f51\u7ad9\uff0c\u5404\u4e2a\u9875\u9762\u4e4b\u95f4\u8df3\u8f6c\u7684\u8868\u73b0\u5982\u4f55\uff0c\u53ef\u4ee5\u9002\u5f53\u8c03\u6574\u516c\u53f8\u7684\u7ecf\u8425\u6218\u7565\u3002</li> </ul> </li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#332","title":"3.3.2 \u529f\u80fd\u5b9e\u73b0","text":"<pre><code>object Requirement3 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement3\").setMaster(\"local[*]\")\n    val sc = new SparkContext(conf)\n    sc.setLogLevel(\"WARN\")\n\n    val actionRDD = sc.textFile(\"public/spark-core/user_visit_action.txt\").map(UserVisitAction.parse)\n\n    val pageflow = getPageflow(actionRDD)\n\n    pageflow.foreach(it =&gt; it match {case ((page1, page2), sum) =&gt; println(s\"\u4ece\u9875\u9762 ${page1} \u8df3\u8f6c\u5230\u9875\u9762 ${page2} \u7684\u5355\u8df3\u8f6c\u5316\u7387\u4e3a ${sum}\")})\n  }\n\n  private def getPageflow(actionRDD: RDD[UserVisitAction]): Array[((String, String), Double)] = {\n    // \u8ba1\u7b97\u5206\u6bcd\n    val down = actionRDD\n      .map(action =&gt; (action.page_id, 1))\n      .reduceByKey((a, b) =&gt; a + b)\n      .collect()\n      .toMap\n\n    // \u8ba1\u7b97\u5206\u5b50\n    val up = actionRDD\n      // \u6839\u636e\u4f1a\u8bdd\u5206\u7ec4\n      .groupBy(action =&gt; action.session_id)\n      // \u5206\u7ec4\u540e\u6839\u636e\u8bbf\u95ee\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\n      .mapValues(values =&gt; {\n        val ids = values\n          .toList\n          .sortBy(action =&gt; action.action_time)\n          .map(action =&gt; action.page_id)\n        ids\n          .zip(ids.tail)\n          .map(it =&gt; (it, 1))\n      })\n      .flatMap(it =&gt; it._2)\n      .reduceByKey((a, b) =&gt; a + b)\n\n    // \u8ba1\u7b97\u5355\u8df3\u8f6c\u7387\n    up\n      .map(it =&gt; it match {\n        case ((page1, page2), sum) =&gt; {\n          val d = down.getOrElse(page1, 0)\n          ((page1, page2), sum.toDouble / d)\n        }\n      })\n      .collect()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-sql","title":"\u56db\u3001Spark SQL \u6982\u8ff0","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#41-spark-sql","title":"4.1 Spark SQL \u662f\u4ec0\u4e48","text":"<p>Spark SQL \u662f Spark \u7528\u4e8e\u7ed3\u6784\u5316\u6570\u636e\u5904\u7406\u7684 Spark \u6a21\u5757\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#42-dataframe","title":"4.2 DataFrame \u662f\u4ec0\u4e48","text":"<p>\u5728 Spark \u4e2d\uff0cDataFrame \u662f\u4e00\u79cd\u4ee5 RDD \u4e3a\u57fa\u7840\u7684\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff0c\u7c7b\u4f3c\u4e8e\u4f20\u7edf\u6570\u636e\u5e93\u4e2d\u7684\u4e8c\u7ef4\u8868\u683c\u3002DataFrame \u4e0e RDD \u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0c\u524d\u8005\u5e26\u6709 Schema \u5143\u4fe1\u606f\uff0c\u5373 DataFrame \u6240\u8868\u793a\u7684\u4e8c\u7ef4\u8868\u683c\u96c6\u4e2d\u7684\u6bcf\u4e00\u5217\u90fd\u5e26\u6709\u540d\u79f0\u548c\u7c7b\u578b\u3002\u8fd9\u4f7f\u5f97 Spark SQL \u5f97\u4ee5\u6d1e\u5bdf\u66f4\u591a\u7684\u7ed3\u6784\u4fe1\u606f\uff0c\u4ece\u800c\u5bf9\u85cf\u4e8e DataFrame \u80cc\u540e\u7684\u6570\u636e\u6e90\u4ee5\u53ca\u4f5c\u7528\u4e8e DataFrame \u4e4b\u4e0a\u7684\u53d8\u6362\u8fdb\u884c\u4e86\u9488\u5bf9\u6027\u7684\u4f18\u5316\uff0c\u6700\u7ec8\u8fbe\u5230\u5927\u5e45\u63d0\u5347\u8fd0\u884c\u65f6\u6548\u7387\u7684\u76ee\u6807\u3002\u53cd\u89c2 RDD\uff0c\u7531\u4e8e\u65e0\u4ece\u5f97\u77e5\u6240\u5b58\u6570\u636e\u5143\u7d20\u7684\u5177\u4f53\u5185\u90e8\u7ed3\u6784\uff0c Spark Core \u53ea\u80fd\u5728 Stage \u5c42\u9762\u8fdb\u884c\u7b80\u5355\u3001\u901a\u7528\u7684\u6d41\u6c34\u7ebf\u4f18\u5316\u3002</p> <p>\u540c\u65f6\uff0c\u4e0e Hive \u7c7b\u4f3c\uff0cDataFrame \u4e5f\u652f\u6301\u5d4c\u5957\u6570\u636e\u7c7b\u578b\uff08<code>struct</code>\u3001<code>array</code>\u3001<code>map</code>\uff09\u3002\u4ece API \u6613\u7528\u6027\u7684\u89d2\u5ea6\u4e0a\u770b\uff0cDataFrame API \u63d0\u4f9b\u4e86\u4e00\u5957\u9ad8\u5c42\u7684\u5173\u7cfb\u64cd\u4f5c\uff0c\u6bd4\u51fd\u6570\u5f0f\u7684 RDD API \u8981\u66f4\u52a0\u53cb\u597d\uff0c\u95e8\u69db\u66f4\u4f4e\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#43-dataset","title":"4.3 DataSet \u662f\u4ec0\u4e48","text":"<p>DataSet \u662f\u5206\u5e03\u5f0f\u6570\u636e\u96c6\u5408\u3002DataSet \u662f Spark 1.6 \u4e2d\u6dfb\u52a0\u7684\u4e00\u4e2a\u65b0\u62bd\u8c61\uff0c\u662f DataFrame \u7684\u4e00\u4e2a\u6269\u5c55\u3002\u5b83\u63d0\u4f9b\u4e86 RDD \u7684\u4f18\u52bf\uff08\u5f3a\u7c7b\u578b\uff0c\u4f7f\u7528\u5f3a\u5927\u7684 Lambda \u51fd\u6570\u7684\u80fd\u529b\uff09\u4ee5\u53ca Spark SQL \u4f18\u5316\u6267\u884c\u5f15\u64ce\u7684\u4f18\u70b9\u3002DataSet \u4e5f\u53ef\u4ee5\u4f7f\u7528\u529f\u80fd\u6027\u7684\u8f6c\u6362\uff08\u64cd\u4f5c <code>map</code>\u3001<code>flatMap</code>\u3001<code>filter</code> \u7b49\u7b49\uff09\u3002</p> <ul> <li>DataSet \u662f DataFrame API \u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u662f Spark SQL \u6700\u65b0\u7684\u6570\u636e\u62bd\u8c61\uff1b</li> <li>\u7528\u6237\u53cb\u597d\u7684 API \u98ce\u683c\uff0c\u65e2\u5177\u6709\u7c7b\u578b\u5b89\u5168\u68c0\u67e5\u4e5f\u5177\u6709 DataFrame \u7684\u67e5\u8be2\u4f18\u5316\u7279\u6027\uff1b</li> <li>\u7528\u6837\u4f8b\u7c7b\u6765\u5bf9 DataSet \u4e2d\u5b9a\u4e49\u6570\u636e\u7684\u7ed3\u6784\u4fe1\u606f\uff0c\u6837\u4f8b\u7c7b\u4e2d\u6bcf\u4e2a\u5c5e\u6027\u7684\u540d\u79f0\u53ef\u76f4\u63a5\u6620\u5c04\u5230 DataSet \u4e2d\u7684\u5b57\u6bb5\u540d\u79f0\uff1b</li> <li>DataSet \u662f\u5f3a\u7c7b\u578b\u7684\uff0c\u6bd4\u5982\u53ef\u4ee5\u6709 <code>DataSet[Car]</code>\u3001<code>DataSet[Person]</code>\uff1b</li> <li>DataFrame \u662f DataSet \u7684\u7279\u4f8b\uff0c<code>DataFrame = DataSet[Row]</code>\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7 <code>as</code> \u65b9\u6cd5\u5c06 DataFrame \u8f6c\u6362\u4e3a DataSet\u3002Row \u662f\u4e00\u4e2a\u5f3a\u7c7b\u578b\uff0c\u8ddf Car\u3001Person \u8fd9\u4e9b\u7684\u7c7b\u578b\u4e00\u6837\uff0c\u6240\u6709\u7684\u8868\u7ed3\u6784\u4fe1\u606f\u90fd\u7528 Row \u6765\u8868\u793a\u3002\u83b7\u53d6\u6570\u636e\u65f6\u9700\u8981\u6307\u5b9a\u987a\u5e8f\uff1b</li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-sql_1","title":"\u4e94\u3001Spark SQL \u6838\u5fc3\u7f16\u7a0b","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#51","title":"5.1 \u65b0\u7684\u8d77\u70b9","text":"<p>Spark Core \u4e2d\uff0c\u5982\u679c\u60f3\u8981\u6267\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u9700\u554a\u54df\u9996\u5148\u6784\u5efa\u4e0a\u4e0b\u6587\u73af\u5883\u5bf9\u8c61 SparkContext\uff0cSpark SQL \u5176\u5b9e\u53ef\u4ee5\u7406\u89e3\u4e3a\u5806 Spark Core \u7684\u4e00\u79cd\u5c01\u88c5\uff0c\u4e0d\u4ec5\u4ec5\u5728\u6a21\u578b\u4e0a\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u4e0a\u4e0b\u6587\u73af\u5883\u5bf9\u8c61\u4e5f\u8fdb\u884c\u4e86\u5c01\u88c5\u3002</p> <p>\u5728\u8001\u7684\u7248\u672c\u4e2d\uff0cSpark SQL \u63d0\u4f9b\u4e24\u79cd SQL \u67e5\u8be2\u8d77\u59cb\u70b9\uff0c\u4e00\u4e2a\u662f SQLContext\uff0c\u7528\u4e8e Spark \u81ea\u5df1\u63d0\u4f9b\u7684 SQL \u67e5\u8be2\uff1b\u4e00\u4e2a\u53eb HiveContext\uff0c\u7528\u4e8e\u8fde\u63a5 Hive \u7684\u67e5\u8be2\u3002</p> <p>SparkSession \u662f Spark \u6700\u65b0\u7684 SQL \u67e5\u8be2\u8d77\u59cb\u70b9\uff0c\u5b9e\u8d28\u4e0a\u662f SQLContext \u548c HiveContext \u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u5728 SQLContext \u548c HiveContext \u4e0a\u53ef\u7528\u7684 API \u5728 SparkSession \u4e0a\u540c\u6837\u662f\u53ef\u4ee5\u4f7f\u7528\u7684\u3002SparkSession \u5185\u90e8\u5c01\u88c5\u4e86 SparkContext\uff0c\u6240\u4ee5\u8ba1\u7b97\u5b9e\u9645\u4e0a\u662f\u7531 SparkContext \u5b8c\u6210\u7684\u3002\u5f53\u6211\u4eec\u4f7f\u7528 <code>spark-shell</code> \u7684\u65f6\u5019\uff0cSpark \u6846\u67b6\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u53eb\u505a <code>spark</code> \u7684 SparkSession \u5bf9\u8c61\uff0c\u5c31\u50cf\u6211\u4eec\u4ee5\u524d\u53ef\u4ee5\u81ea\u52a8\u83b7\u53d6\u5230\u4e00\u4e2a <code>sc</code> \u6765\u8868\u793a SparkContext \u5bf9\u8c61\u4e00\u6837\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#52-dataframe","title":"5.2 DataFrame","text":"<p>Spark SQL \u7684 DataFrame API \u5141\u8bb8\u6211\u4eec\u4f7f\u7528 DataFrame \u800c\u4e0d\u7528\u5fc5\u987b\u53bb\u6ce8\u518c\u4e34\u65f6\u8868\u6216\u8005\u751f\u6210 SQL \u8868\u8fbe\u5f0f\u3002DataFrame API \u65e2\u6709 Transformation \u64cd\u4f5c\u4e5f\u6709 Action \u64cd\u4f5c\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#521-dataframe","title":"5.2.1 \u521b\u5efa DataFrame","text":"<pre><code>echo '{\"name\":\"icefery\", \"age\":24}' &gt; input/user.json\n</code></pre> <pre><code>val spark = SparkSession.builder().appName(\"App\").master(\"local[*]\").getOrCreate()\n\nval df = spark.read.json(\"input/user.json\")\ndf.printSchema()\ndf.show()\n\ndf.createOrReplaceGlobalTempView(\"user\")\nspark.sql(\"SELECT * FROM global_temp.user\").show()\n</code></pre> <p>\u666e\u901a\u8868\u4e34\u65f6\u8868\u793a Session \u8303\u56f4\u5185\u7684\uff0c\u5982\u679c\u60f3\u5e94\u7528\u8303\u56f4\u5185\u6709\u6548\uff0c\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u4e34\u65f6\u8868\u3002\u4f7f\u7528\u5168\u5c40\u4e34\u65f6\u8868\u65f6\u9700\u8981\u5168\u8def\u5f84\u8bbf\u95ee\uff0c\u5982 <code>global_temp.user</code>\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#522-rdd-dataframe","title":"5.2.2 RDD \u8f6c\u6362\u4e3a DataFrame","text":"<p>\u5728 IDEA \u4e2d\u5f00\u53d1\u7a0b\u5e8f\u65f6\uff0c\u5982\u679c\u9700\u8981 RDD \u4e0e DF \u6216\u8005 DS \u4e4b\u95f4\u4e92\u76f8\u64cd\u4f5c\uff0c\u90a3\u4e48\u9700\u8981\u5f15\u5165 <code>import spark.implicits._</code>\u3002\u8fd9\u91cc\u7684 <code>spark</code> \u4e0d\u662f Scala \u4e2d\u7684\u5305\u540d\uff0c\u800c\u662f\u521b\u5efa\u7684 SparkSession \u5bf9\u8c61\u7684\u53d8\u91cf\u540d\u79f0\uff0c\u6240\u4ee5\u5fc5\u987b\u5148\u521b\u5efa SparkSession \u5bf9\u8c61\u518d\u5bfc\u5165\u3002\u8fd9\u91cc\u7684 <code>spark</code> \u5bf9\u8c61\u4e0d\u80fd\u4f7f\u7528 <code>var</code> \u58f0\u660e\uff0c\u56e0\u4e3a Scala \u53ea\u652f\u6301 <code>val</code> \u4fee\u9970\u7684\u5bf9\u8c61\u7684\u5f15\u5165\u3002</p> <pre><code>// case calss \u4e0d\u80fd\u5b9a\u4e49\u5728 main \u65b9\u6cd5\u4e2d\u4e0e import spark.implicits._ \u4e00\u8d77\u4f7f\u7528\ncase class User(name: String, age: Int)\n</code></pre> <pre><code>val spark = SparkSession.builder().appName(\"App\").master(\"local[*]\").getOrCreate()\nval sc = spark.sparkContext\n\nimport spark.implicits._\n\nval df: DataFrame = sc\n  .makeRDD(List((\"icefery\", 24), (\"mm\", 20)))\n  .map(t =&gt; User(t._1, t._2))\n  .toDF()\n</code></pre> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#523-dataframe-rdd","title":"5.2.3 DataFrame \u8f6c\u6362\u4e3a RDD","text":"<p>DataFrame \u5176\u5b9e\u5c31\u662f\u5bf9 RDD \u7684\u5c01\u88c5\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5185\u90e8\u7684 RDD\u3002</p> <pre><code>val rdd: RDD[Row] = df.rdd\nrdd.collect().foreach(println)\n</code></pre> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#53-dataset","title":"5.3 DataSet","text":"<p>DataSet \u662f\u5177\u6709\u5f3a\u7c7b\u578b\u7684\u6570\u636e\u96c6\u5408\uff0c\u9700\u8981\u63d0\u4f9b\u5bf9\u5e94\u7684\u7c7b\u578b\u4fe1\u606f\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#531-dataset","title":"5.3.1 \u521b\u5efa DataSet","text":"<pre><code>val ds: Dataset[User] = Seq(User(\"icefery\", 24), User(\"mm\", 20)).toDS()\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#532-rdd-dataset","title":"5.3.2 RDD \u8f6c\u6362\u4e3a DataSet","text":"<p>Spark SQL \u80fd\u591f\u81ea\u52a8\u5c06\u5305\u542b\u6709 Case \u7c7b\u7684 RDD \u8f6c\u6362\u6210 DataSet\uff0cCase \u7c7b\u5b9a\u4e49\u4e86 Table \u7684\u7ed3\u6784\u3002Case \u7c7b\u5c5e\u6027\u901a\u8fc7\u53d8\u6210\u4e86\u8868\u7684\u7c7b\u540d\u3002Case \u7c7b\u53ef\u4ee5\u5305\u542b\u8bf8\u5982 Seq \u6216\u8005 Array \u7b49\u590d\u6742\u7684\u7ed3\u6784\u3002</p> <pre><code>val rdd: RDD[User] = sc.makeRDD(List(User(\"icefery\", 24), User(\"mm\", 20)))\nval ds: Dataset[User] = rdd.toDS()\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#533-dataset-rdd","title":"5.3.3 DataSet \u8f6c\u6362\u4e3a RDD","text":"<p>DataSet \u5176\u5b9e\u4e5f\u662f\u5bf9 RDD \u7684\u5c01\u88c5\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5185\u90e8\u7684 RDD\u3002</p> <pre><code>val rdd: RDD[User] = ds.rdd\nrdd.collect().foreach(println)\n</code></pre> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#54-dataframe-dataset","title":"5.4 DataFrame \u548c DataSet \u8f6c\u6362","text":"<p>DataFrame \u5176\u5b9e\u662f DataSet \u7684\u7279\u4f8b\uff0c\u6240\u4ee5\u5b83\u4eec\u4e4b\u95f4\u662f\u53ef\u4ee5\u4e92\u76f8\u8f6c\u6362\u7684\u3002</p> <ul> <li> <p>DataFrame \u8f6c\u6362\u4e3a DataSet</p> <pre><code>val df: DataFrame = sc.makeRDD(List(User(\"icefery\", 24), User(\"mm\", 20))).toDF()\n\nval ds: Dataset[User] = df.as[User]\n</code></pre> </li> <li> <p>DataSet \u8f6c\u6362\u4e3a DataFrame</p> <pre><code>val df: DataFrame = ds.toDF()\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#55-rdddataframedataset","title":"5.5 RDD\u3001DataFrame\u3001DataSet \u4e09\u8005\u7684\u5173\u7cfb","text":"<p>\u5728 Spark SQL \u4e2d Spark \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e24\u4e2a\u65b0\u7684\u62bd\u8c61\uff0c\u5206\u522b\u662f DataFrame \u548c DataSet\u3002\u4ed6\u4eec\u548c RDD \u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u9996\u5148\u4ece\u7248\u672c\u7684\u4ea7\u751f\u4e0a\u6765\u770b\uff1a</p> <ul> <li>Spark 1.0 =&gt; RDD</li> <li>Spark 1.3 =&gt; DataFrame</li> <li>Spark 1.6 =&gt; DataSet</li> </ul> <p>\u5982\u679c\u540c\u6837\u7684\u6570\u636e\u90fd\u7ed9\u5230\u8fd9\u4e09\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u4ed6\u4eec\u5206\u522b\u8ba1\u7b97\u4e4b\u540e\uff0c\u90fd\u4f1a\u7ed9\u51fa\u76f8\u540c\u7684\u7ed3\u679c\u3002\u4e0d\u540c\u7684\u662f\u4ed6\u4eec\u7684\u6267\u884c\u6548\u7387\u548c\u6267\u884c\u65b9\u5f0f\u3002\u5728\u540e\u671f\u7684 Spark \u7248\u672c\u4e2d\uff0cDataSet \u6709\u53ef\u80fd\u4f1a\u9010\u6b65\u53d6\u4ee3 RDD \u548c DataFrame \u6210\u4e3a\u552f\u4e00\u7684 API \u63a5\u53e3\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#551","title":"5.5.1 \u4e09\u8005\u7684\u5171\u6027","text":"<ul> <li>RDD\u3001DataFrame\u3001DataSet \u5168\u90fd\u662f Spark \u5e73\u53f0\u4e0b\u7684\u5206\u5e03\u5f0f\u5f39\u6027\u6570\u636e\u96c6\uff0c\u4e3a\u5904\u7406\u8d85\u5927\u578b\u6570\u636e\u63d0\u4f9b\u4fbf\u5229\uff1b</li> <li>\u4e09\u8005\u90fd\u6709\u60f0\u6027\u673a\u5236\uff0c\u5728\u8fdb\u884c\u521b\u5efa\u3001\u8f6c\u6362\u3001\u5982 <code>map</code> \u65b9\u6cd5\u65f6\uff0c\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u53ea\u6709\u5728\u9047\u5230 Action \u5982 <code>foreach</code> \u65f6\uff0c\u4e09\u8005\u624d\u4f1a\u5f00\u59cb\u904d\u5386\uff1b</li> <li>\u4e09\u8005\u6709\u8bb8\u591a\u5171\u540c\u7684\u51fd\u6570\uff0c\u5982 <code>filter</code>\u3001<code>sort</code> \u7b49\uff1b</li> <li>\u5728\u5bf9 DataFrame \u548c DataSet \u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u8bb8\u591a\u64cd\u4f5c\u90fd\u9700\u8981\u5f15\u5165 <code>import spark.implicits._</code> \uff08\u5728\u521b\u5efa\u597d SparkSession \u5bf9\u8c61\u540e\u5c3d\u91cf\u76f4\u63a5\u8fdb\u884c\u5bfc\u5165\uff09\uff1b</li> <li>\u4e09\u8005\u90fd\u4f1a\u6839\u636e Spark \u7684\u5185\u5b58\u60c5\u51b5\u81ea\u52a8\u8fdb\u884c\u7f13\u5b58\u8fd0\u7b97\uff0c\u8fd9\u6837\u5373\u4f7f\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4e5f\u4e0d\u4f1a\u62c5\u5fc3\u4f1a\u5185\u5b58\u6ea2\u51fa\uff1b</li> <li>\u4e09\u8005\u90fd\u6709 Partition \u7684\u6982\u5ff5\uff1b</li> <li>DataFrame \u548c DataSet \u5747\u53ef\u4f7f\u7528\u6a21\u5f0f\u5339\u914d\u83b7\u53d6\u67d0\u4e2a\u5b57\u6bb5\u7684\u503c\u548c\u7c7b\u578b\uff1b</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#552","title":"5.5.2 \u4e09\u8005\u7684\u533a\u522b","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5521-rdd","title":"5.5.2.1 RDD","text":"<ul> <li>RDD \u4e00\u822c\u4e0d\u548c Spark MLlib \u540c\u65f6\u4f7f\u7528</li> <li>RDD \u4e0d\u652f\u6301 Spark SQL \u64cd\u4f5c</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5522-dataframe","title":"5.5.2.2 DataFrame","text":"<ul> <li>\u4e0e RDD \u548c DataSet \u4e0d\u540c\uff0cDataFrame \u6bcf\u4e00\u884c\u7684\u7c7b\u578b\u56fa\u5b9a\u4e3a Row\uff0c\u6bcf\u4e00\u5217\u7684\u503c\u6ca1\u6cd5\u76f4\u63a5\u8bbf\u95ee\uff0c\u53ea\u6709\u901a\u8fc7\u89e3\u6790\u624d\u80fd\u83b7\u53d6\u5404\u4e2a\u5b57\u6bb5\uff1b</li> <li>DataFrame \u4e0e DataSet \u4e00\u822c\u4e0d\u4e0e Spark MLlib \u540c\u65f6\u4f7f\u7528\uff1b</li> <li>DataFrame \u4e0e DataSet \u5747\u652f\u6301 Spark SQL \u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 <code>select</code>\u3001<code>groupBy</code>\u4e4b\u7c7b\uff0c\u8fd8\u80fd\u6ce8\u518c\u4e34\u65f6\u8868/\u89c6\u56fe\uff0c\u8fdb\u884c SQL \u8bed\u53e5\u64cd\u4f5c\uff1b</li> <li>DataFrame \u4e0e DataSet \u652f\u6301\u4e00\u4e9b\u7279\u522b\u65b9\u4fbf\u7684\u4fdd\u5b58\u65b9\u5f0f\uff0c\u6bd4\u5982\u4fdd\u5b58\u6210 CSV\uff0c\u53ef\u4ee5\u5e26\u4e0a\u8868\u5934\uff0c\u8fd9\u6837\u6bcf\u4e00\u884c\u7684\u5b50\u5f39\u540d\u4e00\u76ee\u4e86\u7136\uff1b</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5523-dataset","title":"5.5.2.3 DataSet","text":"<ul> <li>DataSet \u548c DataFrame \u62e5\u6709\u5b8c\u5168\u76f8\u540c\u7684\u6210\u5458\u51fd\u6570\uff0c\u533a\u522b\u53ea\u662f\u6bcf\u4e00\u884c\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\uff0cDataFrame \u5176\u5b9e\u5c31\u662f DataSet \u7684\u4e00\u4e2a\u7279\u4f8b <code>type DataFrame = DataSet[Row]</code>\uff1b</li> <li>DataFrame \u4e5f\u53ef\u4ee5\u53eb DataSet[Row]\uff0c\u6bcf\u4e00\u884c\u7684\u7c7b\u578b\u65f6 Row\uff0c\u4e0d\u89e3\u6790\uff0c\u6bcf\u4e00\u884c\u7a76\u7adf\u6709\u54ea\u4e9b\u5b57\u6bb5\uff0c\u5404\u4e2a\u5b57\u6bb5\u53c8\u662f\u4ec0\u4e48\u7c7b\u578b\u90fd\u4e0d\u4ece\u5f97\u77e5\uff0c\u800c DataSet \u4e2d\u6bcf\u4e00\u884c\u662f\u4ec0\u4e48\u7c7b\u578b\u65f6\u4e0d\u4e00\u5b9a\u7684\uff0c\u5728\u81ea\u5b9a\u4e49\u4e86 <code>case class</code> \u4e4b\u540e\u53ef\u4ee5\u5f88\u81ea\u7531\u7684\u83b7\u5f97\u6bcf\u4e00\u884c\u7684\u4fe1\u606f\uff1b</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#56","title":"5.6 \u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#561-udf","title":"5.6.1 UDF","text":"<pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val spark = SparkSession.builder().config(conf).getOrCreate()\n\n    // \u521b\u5efa DataFrame\n    val df = spark.read.json(\"input/user.json\")\n    // \u521b\u5efa\u4e34\u65f6\u8868\n    df.createOrReplaceTempView(\"user\")\n    // \u6ce8\u518c\u51fd\u6570\n    spark.udf.register(\"add_name\", (x: String) =&gt; \"Name: \" + x)\n    // \u5e94\u7528 UDF\n    spark.sql(\"SELECT add_name(name), age FROM user\").show()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#562-udaf","title":"5.6.2 UDAF","text":"<p>\u5f3a\u7c7b\u578b\u7684 DataSet \u548c\u5f31\u7c7b\u578b\u7684 DataFrame \u90fd\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u805a\u5408\u51fd\u6570\uff0c\u5982 <code>count()</code>\u3001<code>countDistinct()</code>\u3001<code>avg()</code>\u3001<code>max()</code>\u3001<code>min()</code>\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u7528\u6237\u53ef\u4ee5\u8bbe\u5b9a\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\u3002\u901a\u8fc7\u7ee7\u627f <code>UserDefinedAggregateFunction</code> \u6765\u5b9e\u73b0\u7528\u6237\u81ea\u5b9a\u4e49\u5f31\u7c7b\u578b\u805a\u5408\u51fd\u6570\u3002\u4ece Spark 3.0 \u7248\u672c\u540e\uff0c<code>UserDefinedAggregateFunction</code> \u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u4e86\u3002\u53ef\u4ee5\u7edf\u4e00\u91c7\u7528\u5f3a\u7c7b\u578b\u805a\u5408\u51fd\u6570 <code>Aggregator</code>\u3002</p> <ul> <li> <p>\u51c6\u5907\u6570\u636e</p> <pre><code>tee input/employee.json &lt;&lt;- \"EOF\"\n{\"name\": \"Michael\", \"salary\": 3000}\n{\"name\": \"Andy\",    \"salary\": 4500}\n{\"name\": \"Justin\",  \"salary\": 3500}\n{\"name\": \"Berta\",   \"salary\": 4000}\nEOF\n</code></pre> </li> <li> <p>\u5b9a\u4e49\u51fd\u6570</p> <pre><code>case class Average(var sum: Long, var count: Long)\n\nobject MyAverage extends Aggregator[Long, Average, Double] {\n  override def zero: Average = Average(0L, 0L)\n\n  override def reduce(b: Average, a: Long): Average = {\n    b.sum += a\n    b.count += 1\n    b\n  }\n\n  override def merge(b1: Average, b2: Average): Average = {\n    b1.sum += b2.sum\n    b1.count += b2.count\n    b1\n  }\n\n  override def finish(reduction: Average): Double = reduction.sum.toDouble / reduction.count\n\n  override def bufferEncoder: Encoder[Average] = Encoders.product\n\n  override def outputEncoder: Encoder[Double] = Encoders.scalaDouble\n}\n</code></pre> </li> <li> <p>\u4f7f\u7528\u51fd\u6570</p> <pre><code>object UDAFApp {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val spark = SparkSession.builder().config(conf).getOrCreate()\n\n    import spark.implicits._\n\n    // \u521b\u5efa DataFrame\n    val df = spark.read.json(\"input/employee.json\")\n    // \u521b\u5efa\u4e34\u65f6\u8868\n    df.createOrReplaceTempView(\"employee\")\n    // \u6ce8\u518c\u51fd\u6570\n    spark.udf.register(\"my_average\", functions.udaf(MyAverage))\n    // \u5e94\u7528 UDAF\n    spark.sql(\"select my_average(salary) AS average_salary from employee\").show()\n  }\n}\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#57","title":"5.7 \u6570\u636e\u7684\u52a0\u8f7d\u548c\u4fdd\u5b58","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#571","title":"5.7.1 \u901a\u7528\u7684\u52a0\u8f7d\u548c\u4fdd\u5b58\u65b9\u5f0f","text":"<p>Spark SQL \u63d0\u4f9b\u4e86\u901a\u7528\u7684\u4fdd\u5b58\u6570\u636e\u548c\u6570\u636e\u52a0\u8f7d\u7684\u65b9\u5f0f\u3002\u8fd9\u91cc\u7684\u901a\u7528\u6307\u7684\u662f\u4f7f\u7528\u76f8\u540c\u7684 API\uff0c\u6839\u636e\u4e0d\u540c\u7684\u53c2\u6570\u8bfb\u53d6\u548c\u4fdd\u5b58\u4e0d\u540c\u683c\u5f0f\u7684\u6570\u636e\uff0c Spark SQL \u9ed8\u8ba4\u8bfb\u53d6\u548c\u4fdd\u5b58\u7684\u6587\u4ef6\u683c\u5f0f\u4e3a Parquet\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#572-parquet","title":"5.7.2 Parquet","text":"<p>Spark SQL \u7684\u9ed8\u8ba4\u6570\u636e\u6e90\u4e3a Parquet \u683c\u5f0f\u3002Parquet \u662f\u4e00\u79cd\u80fd\u591f\u6709\u6548\u5b58\u50a8\u5d4c\u5957\u6570\u636e\u7684\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\u3002</p> <p>\u6570\u636e\u6e90\u4e3a Parquet \u7684\u6587\u4ef6\u65f6\uff0cSpark SQL \u53ef\u4ee5\u65b9\u4fbf\u7684\u6267\u884c\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981\u4f7f\u7528 <code>format</code>\u3002\u4fee\u6539\u914d\u7f6e\u9879 <code>spark.sql.sources.default</code>\uff0c\u53ef\u4fee\u6539\u9ed8\u8ba4\u6570\u636e\u6e90\u683c\u5f0f\u3002</p> <pre><code>val df1 = spark.read.json(\"input/employee.json\")\ndf1.write.mode(SaveMode.Overwrite).save(\"input/employee\")\n\nval df2 = spark.read.parquet(\"input/employee\")\ndf2.show()\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#573-hive","title":"5.7.3 Hive","text":"<p>Apache Hive \u662f Hadoop \u4e0a\u7684 SQL \u5f15\u64ce\uff0cSpark SQL \u7f16\u8bd1\u65f6\u53ef\u4ee5\u5305\u542b Hive \u652f\u6301\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u5305\u542b\u3002\u5305\u542b Hive \u652f\u6301\u7684 Spark SQL \u53ef\u4ee5\u652f\u6301 Hive \u8868\u8bbf\u95ee\u3001UDF \u4ee5\u53ca Hive \u67e5\u8be2\u8bed\u8a00\u7b49\u3002\u9700\u8981\u5f3a\u8c03\u4e00\u70b9\u7684\u662f\uff0c\u5982\u679c\u8981\u5728 Spark SQL \u4e2d\u5305\u542b Hive \u7684\u5e93\uff0c\u5e76\u4e0d\u9700\u8981\u4e8b\u5148\u5b89\u88c5 Hive\u3002\u5982\u679c\u4f60\u4e0b\u8f7d\u7684\u662f\u4e8c\u8fdb\u5236\u7248\u672c\u7684 Spark\uff0c\u5b83\u5e94\u8be5\u5df2\u7ecf\u5728\u7f16\u8bd1\u65f6\u6dfb\u52a0\u4e86 Hive \u652f\u6301\u3002</p> <p>\u5982\u8981\u628a Spark SQL \u8fde\u63a5\u5230\u4e00\u4e2a\u90e8\u7f72\u597d\u7684 Hive \u4e0a\uff0c\u4f60\u5fc5\u987b\u628a <code>hive-site.xml</code> \u590d\u5236\u5230 Spark \u7684\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u4e2d\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u90e8\u7f72\u597d Hive\uff0cSpark SQL \u4f1a\u5728\u5f53\u524d\u7684\u5de5\u4f5c\u76ee\u5f55\u4e2d\u521b\u5efa\u51fa\u81ea\u5df1\u7684 Hive \u5143\u6570\u636e\u5e93\u53eb\u505a <code>metastore_db</code>\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5731-hive","title":"5.7.3.1 \u5916\u90e8 Hive","text":"<p>\u5982\u679c\u8981\u8fde\u63a5\u5916\u90e8\u5df2\u7ecf\u90e8\u7f72\u597d\u7684 Hive\uff0c\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>Spark \u8981\u63a5\u7ba1 Hive \u9700\u8981\u628a <code>hive-site.xml</code> \u62f7\u8d1d\u5230 <code>conf/</code> \u76ee\u5f55\u4e0b\uff1b</li> <li>\u628a MySQL \u9a71\u52a8\u62f7\u8d1d\u5230 <code>jars/</code> \u76ee\u5f55\u4e0b\uff1b</li> <li>\u5982\u679c\u8bbf\u95ee\u4e0d\u5230 HDFS\uff0c\u5219\u9700\u8981\u628a <code>core-site.xml</code> \u548c <code>hdfs-site.xml</code> \u62f7\u8d1d\u5230 <code>conf/</code> \u76ee\u5f55\u4e0b\uff1b</li> <li>\u91cd\u542f <code>spark-shell</code>\uff1b</li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5732-spark-beeline","title":"5.7.3.2 \u8fd0\u884c Spark beeline","text":"<p>Spark Thrift Server \u662f Spark \u793e\u533a\u57fa\u4e8e HiveServer2 \u5b9e\u73b0\u7684\u4e00\u4e2a Thrift \u670d\u52a1\uff0c\u65e8\u5728\u65e0\u7f1d\u517c\u5bb9 HiveServer2\u3002\u56e0\u4e3a Spark Thrift Server \u7684\u63a5\u53e3\u548c\u534f\u8bae\u90fd\u548c HiveServer2 \u5b8c\u5168\u4e00\u81f4\uff0c\u56e0\u6b64\u6211\u4eec\u90e8\u7f72\u597d Spark Thrift Server \u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Hive \u7684 <code>beeline</code> \u8bbf\u95ee Spark Thrift Server \u6267\u884c\u76f8\u5173\u8bed\u53e5\u3002Spark Thrift Server \u7684\u76ee\u7684\u4e5f\u53ea\u662f\u53d6\u4ee3 HiveServer2\uff0c\u56e0\u6b64\u5b83\u4f9d\u65e7\u53ef\u4ee5\u548c Hive Metastore \u8fdb\u884c\u4ea4\u4e92\uff0c\u83b7\u53d6\u5230 Hive \u7684\u5143\u6570\u636e\u3002</p> <pre><code>sbin/start-thriftserver.sh\n\nbin/beeline -u jdbc:hive2://vm101:10000 -n root\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#5733-hive","title":"5.7.3.3 \u4ee3\u7801\u64cd\u4f5c Hive","text":"<ul> <li> <p>\u5bfc\u5165\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n    &lt;artifactId&gt;spark-hive_${scala.binary.version}&lt;/artifactId&gt;\n    &lt;version&gt;${spark.version}&lt;/version&gt;\n    &lt;scope&gt;provided&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u5c06 <code>hive-site.xml</code> \u62f7\u8d1d\u5230\u9879\u76ee\u7684 <code>resources/</code> \u76ee\u5f55\u4e2d</p> </li> <li> <p><code>show tables</code></p> <pre><code>object App5 {\n  def main(args: Array[String]): Unit = {\n    val spark = SparkSession\n      .builder()\n      .appName(\"App\")\n      .master(\"local[*]\")\n      .enableHiveSupport()\n      // \u5728\u5f00\u53d1\u5de5\u5177\u4e2d\u521b\u5efa\u6570\u636e\u5e93\u9ed8\u8ba4\u662f\u5728\u672c\u5730\u4ed3\u5e93\n      .config(\"spark.sql.warehourse.dir\", \"hdfs://vm101:9000/user/hive/warehourse\")\n      .getOrCreate()\n    import spark.implicits._\n\n    spark.sql(\"show tables\").show()\n  }\n}\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-sql_2","title":"\u516d\u3001Spark SQL \u9879\u76ee\u5b9e\u6218","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#61","title":"6.1 \u6570\u636e\u51c6\u5907","text":"<pre><code>  private def createTable(spark: SparkSession): Unit = {\n    spark.sql(\n      \"\"\"\n        |create table if not exists `user_visit_action`(\n        |  `date`               string,\n        |  `user_id`            bigint,\n        |  `session_id`         string,\n        |  `page_id`            bigint,\n        |  `action_time`        string,\n        |  `search_keyword`     string,\n        |  `click_category_id`  bigint,\n        |  `click_product_id`   bigint,\n        |  `order_category_ids` string,\n        |  `order_product_ids`  string,\n        |  `pay_category_ids`   string,\n        |  `pay_product_ids`    string,\n        |  `city_id`            bigint\n        |)\n        |row format delimited fields terminated by '\\t'\n        |\"\"\".stripMargin\n    ).show()\n    spark.sql(\n      \"\"\"\n        |create table if not exists `product_info`(\n        |  `product_id`   bigint,\n        |  `product_name` string,\n        |  `extend_info`  string\n        |)\n        |row format delimited fields terminated by '\\t'\n        |\"\"\".stripMargin\n    ).show()\n    spark.sql(\n      \"\"\"\n        |create table if not exists `city_info`(\n        |  `city_id`   bigint,\n        |  `city_name` string,\n        |  `area`      string\n        |)\n        |row format delimited fields terminated by '\\t'\n        |\"\"\".stripMargin\n    ).show()\n  }\n</code></pre> <pre><code>  private def loadData(spark: SparkSession): Unit = {\n    spark.sql(\"load data local inpath 'input/user_visit_action.txt' overwrite into table user_visit_action;\").show()\n    spark.sql(\"load data local inpath 'input/product_info.txt' overwrite into table product_info;\").show()\n    spark.sql(\"load data local inpath 'input/city_info.txt' overwrite into table city_info;\").show()\n  }\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#62-top3","title":"6.2 \u9700\u6c42\uff08\u5404\u533a\u57df\u70ed\u95e8\u5546\u54c1 Top3\uff09","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#621","title":"6.2.1 \u9700\u6c42\u7b80\u4ecb","text":"<p>\u8fd9\u91cc\u7684\u70ed\u95e8\u5546\u54c1\u662f\u4ece\u70b9\u51fb\u91cf\u7684\u7ef4\u5ea6\u6765\u770b\u7684\uff0c\u8ba1\u7b97\u5404\u4e2a\u533a\u57df\u524d\u4e09\u5927\u70ed\u95e8\u5546\u54c1\uff0c\u5e76\u5907\u6ce8\u4e0a\u6bcf\u4e2a\u5546\u54c1\u5728\u4e3b\u8981\u57ce\u5e02\u4e2d\u7684\u5206\u5e03\u6bd4\u4f8b\uff0c\u8d85\u8fc7\u4e24\u4e2a\u57ce\u5e02\u7528\u5176\u4ed6\u663e\u793a\u3002</p> <p>\u4f8b\u5982\uff1a</p> \u5730\u533a \u5546\u54c1\u540d\u79f0 \u70b9\u51fb\u6b21\u6570 \u57ce\u5e02\u5907\u6ce8 \u534e\u5317 \u5546\u54c1 A 100000 \u5317\u4eac 21.2%\uff0c\u5929\u6d25 13.2%\uff0c\u5176\u4ed6 65.6% \u534e\u5317 \u5546\u54c1 P 80200 \u5317\u4eac 63.0%\uff0c\u592a\u539f 10%\uff0c\u5176\u4ed6 27.0% \u534e\u5317 \u5546\u54c1 M 40000 \u5317\u4eac 63.0%\uff0c\u592a\u539f 10%\uff0c\u5176\u4ed6 27.0% \u534e\u5317 \u5546\u54c1 J 92000 \u5927\u8fde 28%\uff0c\u8fbd\u5b81 17.0%\uff0c\u5176\u4ed6 55.0%"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#622","title":"6.2.2 \u9700\u6c42\u5206\u6790","text":"<ul> <li>\u67e5\u8be2\u51fa\u6765\u6240\u6709\u7684\u70b9\u51fb\u8bb0\u5f55\uff0c\u4e0e <code>city_info</code> \u8868\u8fde\u63a5\uff0c\u5f97\u5230\u6bcf\u4e2a\u57ce\u5e02\u6240\u5728\u7684\u5730\u533a\uff0c\u4e0e <code>product_info</code> \u8868\u8fde\u63a5\u5f97\u5230\u4ea7\u54c1\u540d\u79f0\uff1b</li> <li>\u6309\u7167\u5730\u533a\u548c\u5546\u54c1 ID \u8fdb\u884c\u5206\u7ec4\uff0c\u7edf\u8ba1\u51fa\u6bcf\u4e2a\u5546\u54c1\u5728\u6bcf\u4e2a\u5730\u533a\u7684\u603b\u70b9\u51fb\u6b21\u6570\uff1b</li> <li>\u6bcf\u4e2a\u5730\u533a\u5185\u6309\u7167\u70b9\u51fb\u6b21\u6570\u964d\u5e8f\u6392\u5217\uff1b</li> <li>\u53ea\u53d6\u524d\u4e09\u540d\uff1b</li> <li>\u57ce\u5e02\u5907\u6ce8\u9700\u8981\u81ea\u5b9a\u4e49 UDAF \u51fd\u6570\uff1b</li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#633","title":"6.3.3 \u529f\u80fd\u5b9e\u73b0","text":"<ul> <li> <p>\u81ea\u5b9a\u4e49 UDAF</p> <pre><code>  case class CityRemark(var total: Long, var cityMap: mutable.Map[String, Long])\n\n  object CityRemark extends Aggregator[String, CityRemark, String] {\n    override def zero: CityRemark = CityRemark(0L, mutable.Map[String, Long]())\n\n    override def reduce(buffer: CityRemark, city: String): CityRemark = {\n      buffer.total += 1\n      buffer.cityMap.update(city, buffer.cityMap.getOrElse(city, 0L) + 1)\n      buffer\n    }\n\n    override def merge(buffer1: CityRemark, buffer2: CityRemark): CityRemark = {\n      buffer1.total += buffer2.total\n      buffer2.cityMap.foreach(it =&gt; it match {\n        case (city, count) =&gt; buffer1.cityMap.update(city, buffer1.cityMap.getOrElse(city, 0L) + count)\n      })\n      buffer1\n    }\n\n    override def finish(reduction: CityRemark): String = {\n      val remarkList = ListBuffer[String]()\n      var sum = 0L\n\n      reduction\n        .cityMap\n        .toList\n        .sortWith((a, b) =&gt; a._2 &gt; b._2)\n        .take(2)\n        .foreach(it =&gt; it match {\n          case (city, cnt) =&gt; {\n            val percentage = cnt * 100 / reduction.total\n            remarkList.append(s\"${city} ${percentage}%\")\n            sum += percentage\n          }\n        })\n\n      if (reduction.cityMap.size &gt; 2) {\n        remarkList.append(s\"\u5176\u4ed6 ${100 - sum}%\")\n      }\n\n      remarkList.mkString(\", \")\n    }\n\n    override def bufferEncoder: Encoder[CityRemark] = Encoders.product\n\n    override def outputEncoder: Encoder[String] = Encoders.STRING\n  }\n</code></pre> </li> <li> <p>\u67e5\u8be2</p> <pre><code>select *\nfrom (\n  select *, rank() over(partition by area order by click_count desc) as rank\n  from (\n    select\n      area,\n      product_name,\n      count(*) as click_count,\n      city_remark(city_name) as city_remark\n    from (\n      select pi.product_name, ci.area, ci.city_name\n      from user_visit_action uva\n      join product_info pi on pi.product_id = uva.click_product_id\n      join city_info ci on ci.city_id = uva.city_id\n      where uva.click_product_id &gt; -1\n    ) t1\n    group by product_name, area\n  ) t2\n) t3\nwhere rank &lt;= 3\n</code></pre> </li> <li> <p>\u5165\u53e3</p> <pre><code>  def main(args: Array[String]): Unit = {\n    val spark = SparkSession.builder().appName(\"Requirement1\").master(\"local[*]\").enableHiveSupport().getOrCreate()\n    import spark.implicits._\n\n    // \u6ce8\u518c\u51fd\u6570\n    spark.udf.register(\"city_remark\", functions.udaf(CityRemark))\n\n    // \u5efa\u8868\n    // createTable(spark)\n\n    // \u5bfc\u5165\u6570\u636e\n    // loadData(spark)\n\n    // \u67e5\u8be2 Top3\n    showTop3(spark)\n  }\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-streaming","title":"\u4e03\u3001Spark Streaming \u6982\u8ff0","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#71-spark-streaming","title":"7.1 Spark Streaming \u662f\u4ec0\u4e48","text":"<p>\u548c Spark \u57fa\u4e8e RDD \u7684\u6982\u5ff5\u5f88\u76f8\u4f3c\uff0cSpark Streaming \u4f7f\u7528\u79bb\u6563\u5316\u6d41\uff08Deiscretized Stream\uff09\u4f5c\u4e3a\u62bd\u8c61\u8868\u793a\uff0c\u53eb\u505a DStream\u3002DStream \u662f\u968f\u65f6\u95f4\u63a8\u79fb\u800c\u6536\u5230\u7684\u6570\u636e\u7684\u5e8f\u5217\u3002\u5728\u5185\u90e8\uff0c\u6bcf\u4e2a\u65f6\u95f4\u533a\u95f4\u6536\u5230\u7684\u6570\u636e\u90fd\u4f5c\u4e3a RDD \u5b58\u5728\uff0c\u800c DStream \u662f\u7531\u8fd9\u4e9b RDD \u6240\u7ec4\u6210\u7684\u5e8f\u5217\uff08\u56e0\u6b64\u5f97\u540d\"\u79bb\u6563\u5316\"\uff09\u3002\u6240\u4ee5\u7b80\u5355\u6765\u8bb2\uff0cDStream \u5c31\u662f\u5bf9 RDD \u5728\u5b9e\u65f6\u6570\u636e\u5904\u7406\u573a\u666f\u7684\u4e00\u79cd\u5c01\u88c5\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-streaming_1","title":"\u516b\u3001Spark Streaming \u6838\u5fc3\u7f16\u7a0b","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#81","title":"8.1 \u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n    &lt;artifactId&gt;spark-streaming_${scala.binary.version}&lt;/artifactId&gt;\n    &lt;version&gt;${spark.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#82-dsteam","title":"8.2 DSteam \u521b\u5efa","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#821-socket","title":"8.2.1 Socket \u6570\u636e\u6e90","text":"<ul> <li> <p>NetCat</p> <pre><code>nc -lk 9999\n</code></pre> </li> <li> <p>WordCount</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(5L))\n\n    ssc\n      .socketTextStream(\"vm101\", 9999)\n      .flatMap(line =&gt; line.split(\" \"))\n      .map(word =&gt; (word, 1L))\n      .reduceByKey((a, b) =&gt; a + b)\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre> </li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#822-rdd","title":"8.2.2 RDD \u961f\u5217","text":"<pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(4L))\n\n    // \u521b\u5efa RDD \u961f\u5217\n    val rddQueue = new mutable.Queue[RDD[Int]]()\n\n    ssc\n      .queueStream(queue = rddQueue, oneAtATime = false)\n      .map(word =&gt; (word, 1L))\n      .reduceByKey((a, b) =&gt; a + b)\n      .print()\n\n    ssc.start()\n\n    // \u5faa\u73af\u521b\u5efa RDD \u5e76\u653e\u5165\u961f\u5217\u4e2d\n    for (i &lt;- 1 to 5) {\n      rddQueue += ssc.sparkContext.makeRDD(1 to 300, 10)\n      Thread.sleep(2000)\n    }\n\n    ssc.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#823-kafka","title":"8.2.3 Kafka \u6570\u636e\u6e90","text":"<ul> <li> <p>\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n    &lt;artifactId&gt;spark-streaming-kafka-0-10_${scala.binary.version}&lt;/artifactId&gt;\n    &lt;version&gt;${spark.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> </li> <li> <p>\u7a0b\u5e8f</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(5L))\n\n    val kafkaParams = Map[String, Object](\n      ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; \"vm101:9092\",\n      ConsumerConfig.GROUP_ID_CONFIG -&gt; \"consumer_demo\",\n      ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\",\n      ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\"\n    )\n\n    KafkaUtils\n      .createDirectStream[String, String](\n        ssc,\n        LocationStrategies.PreferConsistent,\n        ConsumerStrategies.Subscribe[String, String](Set(\"topic_demo\"), kafkaParams)\n      )\n      .flatMap(message =&gt; message.value().split(\" \"))\n      .map(word =&gt; (word, 1L))\n      .reduceByKey((a, b) =&gt; a + b)\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre> </li> </ul>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#824","title":"8.2.4 \u81ea\u5b9a\u4e49\u6570\u636e\u6e90","text":"<ul> <li> <p>\u81ea\u5b9a\u4e49\u6570\u636e\u6e90</p> <pre><code>  class CustomReceiver(host: String, port: Int) extends Receiver[String](StorageLevel.MEMORY_ONLY) {\n    override def onStart(): Unit = {\n      new Thread(() =&gt; {\n        val socket = new Socket(host, port);\n        val reader = new BufferedReader(new InputStreamReader(socket.getInputStream, StandardCharsets.UTF_8))\n\n        var line = reader.readLine()\n        while (!super.isStopped() &amp;&amp; line != null) {\n          super.store(line)\n          line = reader.readLine()\n        }\n\n        reader.close()\n        socket.close()\n\n        super.restart(\"restart\")\n      }).start()\n    }\n\n    override def onStop(): Unit = {}\n  }\n</code></pre> </li> <li> <p>\u7a0b\u5e8f</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(3L))\n\n    ssc\n      .receiverStream(new CustomReceiver(\"vm101\", 9999))\n      .flatMap(line =&gt; line.split(\" \"))\n      .map(word =&gt; (word, 1L))\n      .reduceByKey((a, b) =&gt; a + b)\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#83-dstream","title":"8.3 DStream \u8f6c\u6362","text":"<p>DStream \u4e0a\u7684\u64cd\u4f5c\u4e0e RDD \u7684\u7c7b\u4f3c\uff0c\u5206\u4e3a Transformations\uff08\u8f6c\u6362\uff09\u548c Output Operations\uff08\u8f93\u51fa\uff09\u4e24\u79cd\uff0c\u6b64\u5916\u8f6c\u6362\u64cd\u4f5c\u4e2d\u6d77\u6cb9\u4e00\u4e9b\u6bd4\u8f83\u7279\u6b8a\u7684\u539f\u8bed\uff0c\u5982 <code>updateStateByKey()</code>\u3001<code>transform()</code> \u4ee5\u53ca\u5404\u79cd Window \u76f8\u5173\u7684\u539f\u8bed\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#831","title":"8.3.1 \u65e0\u72b6\u6001\u8f6c\u6362\u64cd\u4f5c","text":"<p>\u65e0\u72b6\u6001\u8f6c\u6362\u64cd\u4f5c\u5c31\u662f\u628a\u7b80\u5355\u7684 RDD \u8f6c\u6362\u64cd\u4f5c\u5e94\u7528\u5230\u6bcf\u4e2a\u6279\u6b21\u4e0a\uff0c\u4e5f\u5c31\u662f\u8f6c\u6362 DStream \u4e2d\u7684\u6bcf\u4e00\u4e2a RDD\u3002\u6ce8\u610f\uff0c\u9488\u5bf9\u952e\u503c\u5bf9\u7684 DStream \u8f6c\u6362\u64cd\u4f5c\uff08\u6bd4\u5982 <code>reduceByKey()</code>\uff09 \u8981\u6dfb\u52a0 <code>import StreamingContext._</code> \u624d\u80fd\u5728 Scala \u4e2d\u4f7f\u7528\u3002</p> <p>\u9700\u8981\u8bb0\u4f4f\u7684\u662f\uff0c\u5c3d\u7ba1\u8fd9\u4e9b\u51fd\u6570\u770b\u8d77\u6765\u50cf\u4f5c\u7528\u5728\u771f\u4e2a\u6d41\u4e0a\u4e00\u6837\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u6bcf\u4e2a DStream \u5728\u5185\u90e8\u662f\u7531\u8bb8\u591a RDD\uff08\u6279\u6b21\uff09\u7ec4\u6210\uff0c\u4e14\u65e0\u72b6\u6001\u8f6c\u6362\u64cd\u4f5c\u662f\u5206\u522b\u5e94\u7528\u5230\u6bcf\u4e2a RDD \u4e0a\u7684\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#8311-transform","title":"8.3.1.1 Transform","text":"<p>Transform \u64cd\u4f5c\u5141\u8bb8\u5728 DStream \u4e0a\u6267\u884c\u4efb\u610f\u7684 RDD-to-RDD \u51fd\u6570\u3002\u5373\u4f7f\u8fd9\u4e9b\u51fd\u6570\u5e76\u6ca1\u6709\u5728 DStream \u7684 API \u4e2d\u66b4\u9732\u51fa\u6765\uff0c\u4f46\u901a\u8fc7\u8be5\u51fd\u6570\u53ef\u4ee5\u65b9\u4fbf\u7684\u6269\u5c55 Spark API\u3002\u8be5\u51fd\u6570\u6bcf\u4e00\u6279\u6b21\u8c03\u5ea6\u4e00\u6b21\u3002\u5176\u5b9e\u4e5f\u5c31\u662f\u5bf9 DStream \u4e2d\u7684 RDD \u5e94\u7528\u8f6c\u6362\u3002</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(3L))\n\n    ssc\n      .socketTextStream(\"vm101\", 9999)\n      .transform(rdd =&gt; {\n        rdd\n          .flatMap(line =&gt; line.split(\" \"))\n          .map(word =&gt; (word, 1L))\n          .reduceByKey((a, b) =&gt; a + b)\n      })\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#8312-join","title":"8.3.1.2 join","text":"<p>\u4e24\u4e2a\u6d41\u4e4b\u95f4\u7684 join \u9700\u8981\u4e24\u4e2a\u6d41\u7684\u6279\u6b21\u5927\u5c0f\u4e00\u81f4\uff0c\u8fd9\u6837\u624d\u80fd\u505a\u5230\u540c\u65f6\u89e6\u53d1\u8ba1\u7b97\u3002\u8ba1\u7b97\u8fc7\u7a0b\u5c31\u662f\u5bf9\u5f53\u524d\u6279\u6b21\u7684\u4e24\u4e2a\u6d41\u4e2d\u5404\u81ea\u7684 RDD \u8fdb\u884c join\uff0c\u4e0e\u4e24\u4e2a RDD \u7684 join \u6548\u679c\u76f8\u540c\u3002</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(3L))\n\n    val lineDStream1 = ssc.socketTextStream(\"vm101\", 9999)\n    val lineDStream2 = ssc.socketTextStream(\"vm101\", 8888)\n\n    val s1 = lineDStream1.flatMap(line =&gt; line.split(\" \")).map(word =&gt; (word, 1L))\n    val s2 = lineDStream2.flatMap(line =&gt; line.split(\" \")).map(word =&gt; (word, 1L))\n\n    s1.join(s2).print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#832","title":"8.3.2 \u6709\u72b6\u6001\u8f6c\u6362\u64cd\u4f5c","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#8321-updatestatebykey","title":"8.3.2.1 <code>updateStateByKey</code>","text":"<p><code>updateStateByKey</code> \u539f\u8bed\u7528\u4e8e\u8bb0\u5f55\u5386\u53f2\u8bb0\u5f55\uff0c\u6709\u65f6\u6211\u4eec\u9700\u8981\u5728 DStream \u4e2d\u8de8\u6279\u6b21\u7ef4\u62a4\u72b6\u6001\uff08\u4f8b\u5982\u6d41\u8ba1\u7b97\u4e2d\u7d2f\u52a0 WordCount\uff09\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c<code>updateStateByKey</code> \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5bf9\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\u7684\u8bbf\u95ee\uff0c\u7528\u4e8e\u952e\u503c\u5bf9\u5f62\u5f0f\u7684 DStream\u3002\u7ed9\u5b9a\u4e00\u4e2a\u7531\uff08\u952e\uff0c\u4e8b\u4ef6\uff09\u5bf9\u6784\u6210\u7684 DStream\uff0c\u5e76\u4f20\u9012\u4e00\u4e2a\u6307\u5b9a\u5982\u4f55\u6839\u636e\u65b0\u7684\u4e8b\u4ef6\u66f4\u65b0\u6bcf\u4e2a\u952e\u5bf9\u5e94\u72b6\u6001\u7684\u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u6784\u5efa\u51fa\u4e00\u4e2a\u65b0\u7684 DStream\uff0c\u5176\u5185\u90e8\u6570\u636e\u4e3a\uff08\u952e\uff0c\u72b6\u6001\uff09\u5bf9\u3002</p> <p><code>updateStateByKey</code> \u9700\u8981\u5bf9\u68c0\u67e5\u70b9\u76ee\u5f55\u8fdb\u884c\u914d\u7f6e\uff0c\u4f1a\u4f7f\u7528\u68c0\u67e5\u70b9\u6765\u4fdd\u5b58\u72b6\u6001\u3002</p> <p><code>updateStateByKey</code> \u7684\u7ed3\u679c\u4f1a\u662f\u4e00\u4e2a\u65b0\u7684 DStream\uff0c\u5176\u5185\u90e8\u7684 RDD \u5e8f\u5217\u65f6\u7531\u6bcf\u4e2a\u65f6\u95f4\u533a\u95f4\u5bf9\u5e94\u7684\uff08\u952e\uff0c\u72b6\u6001\uff09\u5bf9\u7ec4\u6210\u7684\u3002</p> <p><code>updateStateByKey</code> \u64cd\u4f5c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5728\u7528\u65b0\u6d88\u606f\u8fdb\u884c\u66f4\u65b0\u65f6\u4fdd\u6301\u4efb\u610f\u7684\u72b6\u6001\u3002\u4e3a\u4f7f\u7528\u8fd9\u4e2a\u529f\u80fd\uff0c\u9700\u8981\u505a\u4ee5\u4e0b\u4e24\u6b65\uff1a</p> <ol> <li>\u5b9a\u4e49\u72b6\u6001\uff1a\u72b6\u6001\u53ef\u4ee5\u662f\u4e00\u4e2a\u4efb\u610f\u7684\u6570\u636e\u7c7b\u578b\uff1b</li> <li>\u5b9a\u4e49\u72b6\u6001\u66f4\u65b0\u51fd\u6570\uff0c\u7528\u6b64\u51fd\u6570\u9610\u660e\u5982\u4f55\u4f7f\u7528\u4e4b\u524d\u7684\u72b6\u6001\u548c\u6765\u81ea\u8f93\u5165\u6d41\u7684\u65b0\u952e\u503c\u5bf9\u72b6\u6001\u8fdb\u884c\u66f4\u65b0\uff1b</li> </ol> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(3L))\n\n    // \u8bbe\u7f6e\u68c0\u67e5\u70b9\n    ssc.checkpoint(\"checkpoint\")\n\n    // \u5b9a\u4e49\u66f4\u65b0\u72b6\u6001\u51fd\u6570\n    val updateFunc: (Seq[Int], Option[Int]) =&gt; Option[Int] = (values, state) =&gt; {\n      // \u53c2\u6570 values \u4e3a\u5f53\u524d\u6279\u6b21\u5355\u8bcd\u9891\u5ea6\n      // \u53c2\u6570 state  \u4e3a\u4ee5\u5f80\u6279\u6b21\u5355\u8bcd\u9891\u5ea6\n      val currCount = values.sum\n      val prevCount = state.getOrElse(0)\n      Some(currCount + prevCount)\n    }\n\n    ssc\n      .socketTextStream(\"vm101\", 9999)\n      .flatMap(line =&gt; line.split(\" \"))\n      .map(word =&gt; (word, 1))\n      .updateStateByKey[Int](updateFunc)\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#833-window-operations","title":"8.3.3 Window Operations","text":"<p>Window Operations \u53ef\u4ee5\u8bbe\u7f6e\u7a97\u53e3\u7684\u5927\u5c0f\u548c\u6ed1\u52a8\u7a97\u53e3\u7684\u95f4\u9694\u6765\u52a8\u6001\u7684\u83b7\u53d6\u5f53\u524d Streaming \u7684\u72b6\u6001\u3002\u6240\u6709\u57fa\u4e8e\u7a97\u53e3\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u4e3a\u7a97\u53e3\u65f6\u957f\u4ee5\u53ca\u6ed1\u52a8\u6b65\u957f\u3002</p> <ul> <li>\u7a97\u53e3\u65f6\u957f\uff1a\u8ba1\u7b97\u5185\u5bb9\u7684\u65f6\u95f4\u8303\u56f4\uff1b</li> <li>\u6ed1\u52a8\u6b65\u957f\uff1a\u9694\u591a\u4e45\u89e6\u53d1\u4e00\u6b21\u8ba1\u7b97\uff1b</li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u4e24\u8005\u90fd\u5fc5\u987b\u4e3a\u91c7\u96c6\u5468\u671f\u5927\u5c0f\u7684\u6574\u6570\u500d\u3002</p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"App\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(3L))\n\n    ssc\n      .socketTextStream(\"vm101\", 9999)\n      .flatMap(line =&gt; line.split(\" \"))\n      .map(word =&gt; (word, 1))\n      .reduceByKeyAndWindow(\n        reduceFunc = (a, b) =&gt; a + b,\n        windowDuration = Seconds(12),\n        slideDuration = Seconds(6)\n      )\n      .print()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre> <p>\u5173\u4e8e Window \u7684\u64cd\u4f5c\u8fd8\u6709\u5982\u4e0b\u65b9\u6cd5\uff1a</p> <ul> <li> <p><code>window(windowLength, slideInterval)</code></p> <p>\u57fa\u4e8e\u5bf9\u6e90 DStream \u7a97\u5316\u7684\u6279\u6b21\u8fdb\u884c\u8ba1\u7b97\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 DStream\u3002</p> </li> <li> <p><code>countByWindow(windowLength, slideInterval)</code></p> <p>\u8fd4\u56de\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\u8ba1\u7b97\u6d41\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u3002</p> </li> <li> <p><code>reduceByWindow(func, windowLength, slideInterval)</code></p> <p>\u901a\u8fc7\u81ea\u5b9a\u4e49\u51fd\u6570\u6574\u5408\u6ed1\u52a8\u533a\u95f4\u6d41\u5143\u7d20\u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5355\u5143\u7d20\u7684\u6d41\u3002</p> </li> <li> <p><code>reduceByKeyAndWindow(func, windowLength, slideInterval)</code></p> <p>\u5f53\u5728\u4e00\u4e2a\u952e\u503c\u5bf9\u7684 DStream \u4e0a\u8c03\u7528\u6b64\u51fd\u6570\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u952e\u503c\u5bf9\u7684 DStream\uff0c\u901a\u8fc7\u5bf9\u6ed1\u52a8\u7a97\u53e3\u4e2d\u6279\u6b21\u6570\u636e\u4f7f\u7528 Reduce \u51fd\u6570\u6765\u6574\u5408\u6bcf\u4e2a Key \u7684 value \u503c\u3002</p> </li> <li> <p><code>reduceByKeyAndWindow(func, invFunc, windowLength, slideInterval)</code></p> <p>\u8fd9\u4e2a\u51fd\u6570\u662f\u4e0a\u8ff0\u51fd\u6570\u7684\u53d8\u5316\u7248\u672c\uff0c\u6bcf\u4e2a\u7a97\u53e3\u5f97\u5230 Reduce \u503c\u90fd\u662f\u901a\u8fc7\u524d\u4e00\u4e2a\u7a97\u53e3\u7684 Reduce \u503c\u6765\u9012\u589e\u8ba1\u7b97\u3002</p> <p>\u901a\u8fc7 Reduce \u8fdb\u5165\u6ed1\u52a8\u7a97\u53e3\u6570\u636e\u5e76\u201c\u53cd\u5411 Reduce\u201d \u79bb\u5f00\u7a97\u53e3\u7684\u65e7\u6570\u636e\u6765\u5b9e\u73b0\u8fd9\u4e2a\u64cd\u4f5c\u3002\u4e00\u4e2a\u4f8b\u5b50\u5c31\u662f\u968f\u7740\u7a97\u53e3\u6ed1\u52a8\u5bf9 Keys \u7684\u201c\u52a0\u201d\u3001\u201c\u51cf\u201d\u8ba1\u7b97\u3002</p> <p>\u901a\u8fc7\u524d\u8fb9\u4ecb\u7ecd\u53ef\u4ee5\u60f3\u5230\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ea\u9002\u7528\u4e8e\u201c\u53ef\u9006\u7684 Reduce \u51fd\u6570\u201d\u3002</p> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#84-dstream","title":"8.4 DStream \u8f93\u51fa","text":"<p>\u8f93\u51fa\u64cd\u4f5c\u6307\u5b9a\u4e86\u5bf9\u6d41\u6570\u636e\u7ecf\u8f6c\u6362\u64cd\u4f5c\u5f97\u5230\u7684\u6570\u636e\u6240\u8981\u6267\u884c\u7684\u64cd\u4f5c\u3002\u4e0e RDD \u4e2d\u7684\u60f0\u6027\u6c42\u503c\u7c7b\u4f3c\uff0c\u5982\u679c\u4e00\u4e2a DStream \u53ca\u5176\u6d3e\u751f\u51fa\u7684 DStream \u90fd\u6ca1\u6709\u88ab\u6267\u884c\u8f93\u51fa\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b DStream \u5c31\u90fd\u4e0d\u4f1a\u88ab\u6c42\u503c\u3002\u5982\u679c StreamingContext \u4e2d\u6ca1\u6709\u8bbe\u7f6e\u8f93\u51fa\u64cd\u4f5c\uff0c\u6574\u4e2a Context \u5c31\u90fd\u4e0d\u4f1a\u542f\u52a8\u3002</p> <p>\u8f93\u51fa\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <ul> <li><code>print()</code></li> <li><code>saveAsTextFiles(prefix, [suffix])</code></li> <li><code>saveAsObjectFiles(prefix, [suffix])</code></li> <li><code>saveAsHadoopFiles(prefix, [suffix])</code></li> <li><code>foreachRDD(func)</code></li> </ul> <p>\u901a\u7528\u7684\u8f93\u51fa\u64cd\u4f5c <code>foreachRDD()</code> \u7528\u6765\u5bf9 DStream \u4e2d\u7684 RDD \u8fdb\u884c\u4efb\u610f\u8ba1\u7b97\u3002\u8fd9\u548c <code>transform()</code> \u6709\u4e9b\u7c7b\u4f3c\uff0c\u90fd\u53ef\u4ee5\u8ba9\u6211\u4eec\u8bbf\u95ee\u5230\u4efb\u610f RDD\u3002\u5728<code>foreachRDD()</code> \u4e2d\uff0c\u53ef\u4ee5\u91cd\u7528\u6211\u4eec\u5728 Spark \u4e2d\u5b9e\u73b0\u7684\u6240\u6709 Action \u64cd\u4f5c\u3002\u6bd4\u5982\uff0c\u6700\u5e38\u89c1\u7684\u7528\u4f8b\u4e4b\u4e00\u5c31\u662f\u628a\u6570\u636e\u5199\u5230\u8bf8\u5982 MySQL \u7684\u5916\u90e8\u6570\u636e\u5e93\u4e2d\u3002</p> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#85","title":"8.5 \u4f18\u96c5\u5173\u95ed","text":"<p>\u6d41\u5f0f\u4efb\u52a1\u9700\u8981 7*24 \u5c0f\u65f6\u6267\u884c\uff0c\u4f46\u662f\u6709\u65f6\u5019\u6d89\u53ca\u5230\u5347\u7ea7\u4ee3\u7801\u9700\u8981\u4e3b\u52a8\u505c\u6b62\u7a0b\u5e8f\uff0c\u800c\u5206\u5e03\u5f0f\u7a0b\u5e8f\u6ca1\u529e\u6cd5\u505a\u5230\u4e00\u4e2a\u4e2a\u8fdb\u7a0b\u53bb\u6740\u6b7b\uff0c\u6240\u4ee5\u914d\u7f6e\u4f18\u96c5\u7684\u5173\u95ed\u5c31\u663e\u5f97\u81f3\u5173\u91cd\u8981\u4e86\u3002</p> <p>\u4f7f\u7528\u5916\u90e8\u6587\u4ef6\u7cfb\u7edf\u6765\u63a7\u5236\u5185\u90e8\u7a0b\u5e8f\u5173\u95ed\u3002</p> <ul> <li> <p><code>MonitorStop</code></p> <pre><code>class MonitorStop(ssc: StreamingContext) extends Runnable {\n  override def run(): Unit = {\n    val fs = FileSystem.get(URI.create(\"hdfs://vm101:9000\"), new Configuration(), \"root\")\n\n    while (true) {\n      try {\n        Thread.sleep(5000)\n      } catch {\n        case e: InterruptedException =&gt; e.printStackTrace()\n      }\n\n      if (fs.exists(new Path(\"hdfs://vm101:9000/stop-spark\"))) {\n        if (ssc.getState() == StreamingContextState.ACTIVE) {\n          ssc.stop(stopSparkContext = true, stopGracefully = true)\n          System.exit(0)\n        }\n      }\n    }\n  }\n}\n</code></pre> </li> <li> <p><code>App</code></p> <pre><code>object App {\n  def main(args: Array[String]): Unit = {\n    val ssc = StreamingContext.getActiveOrCreate(\"checkpoint\",() =&gt; createSSC())\n\n    new Thread(new MonitorStop(ssc)).start()\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n\n  private def createSSC(): StreamingContext = {\n    val conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkTest\")\n    // \u8bbe\u7f6e\u4f18\u96c5\u5173\u95ed\n    conf.set(\"spark.streaming.stopGracefullyOnShutdown\", \"true\")\n\n    val ssc = new StreamingContext(conf, Seconds(5L))\n    ssc.checkpoint(\"./checkpoint\")\n\n    val updateFunc: (Seq[Int], Option[Int]) =&gt; Option[Int] = (values, state) =&gt; {\n      val curr = values.sum\n      val prev = state.getOrElse(0)\n      Some(curr + prev)\n    }\n\n    ssc\n      .socketTextStream(\"vm101\", 9999)\n      .flatMap(line =&gt; line.split(\" \"))\n      .map(word =&gt; (word, 1))\n      .updateStateByKey(updateFunc)\n      .print()\n\n    ssc\n  }\n}\n</code></pre> </li> </ul> <p></p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#spark-streaming_2","title":"\u4e5d\u3001Spark Streaming \u6848\u4f8b\u5b9e\u64cd","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#91","title":"9.1 \u73af\u5883\u51c6\u5907","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#931","title":"9.3.1 \u6570\u636e\u751f\u6210\u5de5\u5177\u7c7b","text":"<pre><code>object Mock {\n  def main(args: Array[String]): Unit = {\n    val properties = new Properties()\n    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"vm101:9092\")\n    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\")\n    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\")\n    val producer = new KafkaProducer[String, String](properties)\n\n    val areaList = List[String](\"\u534e\u4e1c\", \"\u534e\u5357\", \"\u534e\u897f\", \"\u534e\u5317\")\n    val cityList = List[String](\"\u5317\u4eac\", \"\u4e0a\u6d77\", \"\u5e7f\u5dde\", \"\u6df1\u5733\")\n    val random = new Random()\n    while (true) {\n      // \u4e00\u6b21\u6027\u751f\u6210\u591a\u6761\u6d88\u606f\n      val messageList = ListBuffer[String]()\n      for (i &lt;- 1 to random.nextInt(100) + 1) {\n        val ts = System.currentTimeMillis()\n        val area = areaList(random.nextInt(areaList.length))\n        val city = cityList(random.nextInt(cityList.length))\n        val user = random.nextInt(5) + 1\n        val ad = random.nextInt(5) + 1\n        messageList.append(s\"${ts} ${area} ${city} ${user} ${ad}\")\n      }\n      // \u4e00\u6b21\u6027\u53d1\u9001\u591a\u6761\u6d88\u606f\n      val futureList = messageList.map(message =&gt; {\n        val record = new ProducerRecord[String, String](\"topic_demo\", message)\n        val future = producer.send(record)\n        CompletableFuture.supplyAsync(() =&gt; future.get())\n      })\n      CompletableFuture.allOf(futureList: _*).get(1000L, TimeUnit.MILLISECONDS)\n      // \u6253\u5370\u6d88\u606f\u6570\u91cf\n      println(messageList.length)\n      Thread.sleep(1000L)\n    }\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#932","title":"9.3.2 \u6570\u636e\u5e93\u64cd\u4f5c\u5de5\u5177\u7c7b","text":"<pre><code>object JDBCUtil {\n  private val datasource: DataSource = init()\n\n  // insert | update | delete\n  def update(sql: String, args: Array[Any] = Array[Any]()): Int = {\n    // \u5b9a\u4e49\u8fd4\u56de\u503c\n    var result = 0\n    // \u83b7\u53d6\u8fde\u63a5\n    val connection = datasource.getConnection()\n    try {\n      val ps = connection.prepareStatement(sql)\n      // \u7ed1\u5b9a\u53c2\u6570\n      bind(ps, args)\n      // \u6267\u884c\u8bed\u53e5\n      result = ps.executeUpdate()\n      // \u91ca\u653e\u8d44\u6e90\n      ps.close()\n      connection.close()\n    } catch {\n      case e: Exception =&gt; e.printStackTrace()\n    }\n    result\n  }\n\n  // select\n  def queryForValList[T](sql: String, args: Array[Any] = Array[Any]()): ListBuffer[T] = {\n    val result = ListBuffer[T]()\n    val connection = datasource.getConnection()\n    try {\n      val ps = connection.prepareStatement(sql)\n      bind(ps, args)\n      val rs = ps.executeQuery()\n      while (rs.next()) {\n        val item = rs.getString(1).asInstanceOf[T]\n        result.append(item)\n      }\n      ps.close()\n      connection.close()\n    } catch {\n      case e: Exception =&gt; e.printStackTrace()\n    }\n    result\n  }\n\n  // select\n  def queryForCaseList[T](sql: String, args: Array[Any] = Array[Any]())(implicit ct: ClassTag[T]): ListBuffer[T] = {\n    // \u5b9a\u4e49\u8fd4\u56de\u503c\n    val result = ListBuffer[T]()\n    // \u53cd\u5c04\u83b7\u53d6\u7c7b\u578b\u4fe1\u606f\n    val fields = ct.runtimeClass.getDeclaredFields\n    val constructor = ct.runtimeClass.getConstructors.head\n    // \u83b7\u53d6\u8fde\u63a5\n    val connection = datasource.getConnection()\n    try {\n      val ps = connection.prepareStatement(sql)\n      bind(ps, args)\n      val rs = ps.executeQuery()\n      while (rs.next()) {\n        val parameters = fields.map(field =&gt; rs.getString(field.getName))\n        val instance = constructor.newInstance(parameters: _*).asInstanceOf[T]\n        result.append(instance)\n      }\n    } catch {\n      case e: Exception =&gt; e.printStackTrace()\n    }\n    result\n  }\n\n  private def bind(ps: PreparedStatement, args: Array[Any]): Unit = {\n    if (args != null &amp;&amp; args.length &gt; 0) {\n      for (i &lt;- args.indices) {\n        ps.setObject(i + 1, args(i))\n      }\n    }\n  }\n\n  private def init(): DataSource = {\n    val properties = new Properties()\n    properties.setProperty(DruidDataSourceFactory.PROP_DRIVERCLASSNAME, \"com.mysql.cj.jdbc.Driver\")\n    properties.setProperty(DruidDataSourceFactory.PROP_URL, \"jdbc:mysql://vm101:3306/demo\")\n    properties.setProperty(DruidDataSourceFactory.PROP_USERNAME, \"root\")\n    properties.setProperty(DruidDataSourceFactory.PROP_PASSWORD, \"root\")\n    DruidDataSourceFactory.createDataSource(properties)\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#92","title":"9.2 \u9700\u6c42\u4e00\uff08\u5e7f\u544a\u9ed1\u540d\u5355\uff09","text":"<p>\u5b9e\u73b0\u5b9e\u65f6\u7684\u52a8\u6001\u9ed1\u540d\u5355\u673a\u5236\uff0c\u5c06\u6bcf\u5929\u5bf9\u67d0\u4e2a\u5e7f\u544a\u70b9\u51fb\u8d85\u8fc7 100 \u6b21\u7684\u7528\u6237\u62c9\u9ed1\u3002\u9ed1\u540d\u5355\u4fdd\u5b58\u5728 MySQL \u4e2d\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#931_1","title":"9.3.1 \u601d\u8def\u5206\u6790","text":"<ol> <li>\u8bfb\u53d6 Kafka \u6570\u636e\u4e4b\u540e\uff0c\u5e76\u5bf9 MySQL \u4e2d\u5b58\u50a8\u7684\u9ed1\u540d\u5355\u6570\u636e\u505a\u6821\u9a8c\uff1b</li> <li>\u6821\u9a8c\u901a\u8fc7\u5219\u5bf9\u7528\u6237\u70b9\u51fb\u5e7f\u544a\u6b21\u6570\u7d2f\u52a0\u4e00\u5e76\u5b58\u5165 MySQL \u4e2d\uff1b</li> <li>\u5728\u5b58\u5165 MySQL \u4e4b\u540e\u5bf9\u6570\u636e\u505a\u6821\u9a8c\uff0c\u5982\u679c\u5355\u65e5\u8d85\u8fc7 100 \u6b21\u5219\u5c06\u8be5\u7528\u6237\u62c9\u5165\u9ed1\u540d\u5355\uff1b</li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#932-mysql","title":"9.3.2 MySQL \u5efa\u8868","text":"<pre><code>create table blacklist (\n    user varchar(64),\n    primary key (user)\n);\n\ncreate table user_ad_count (\n    date  varchar(64),\n    user  varchar(64),\n    ad    varchar(64),\n    count bigint,\n    primary key (date, user, ad)\n);\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#933","title":"9.3.3 \u529f\u80fd\u5b9e\u73b0","text":"<pre><code>object Requirement1 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement1\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(5))\n    ssc.sparkContext.setLogLevel(\"WARN\")\n\n    val kafkaParams = Map[String, Object](\n      ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; \"vm101:9092\",\n      ConsumerConfig.GROUP_ID_CONFIG -&gt; \"consumer_demo\",\n      ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\",\n      ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\"\n    )\n\n    KafkaUtils\n      .createDirectStream[String, String](ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](Set(\"topic_demo\"), kafkaParams))\n      // filter + map\n      .flatMap(record =&gt; record.value().split(\" \") match {\n        case Array(ts, area, city, user, ad) =&gt; Array[ADClick](ADClick(ts, area, city, user, ad))\n        case _ =&gt; Array[ADClick]()\n      })\n      .transform(rdd =&gt; {\n        // \u8fc7\u6ee4\u9ed1\u540d\u5355\u5185\u6570\u636e\n        val blacklistList = JDBCUtil.queryForValList[String](\"SELECT user FROM blacklist\")\n        rdd\n          .filter(it =&gt; !blacklistList.contains(it.user))\n          .map(it =&gt; {\n            val date = new SimpleDateFormat(\"yyyy-MM-dd\").format(new Date(it.ts.toLong))\n            val user = it.user\n            val ad = it.ad\n            ((date, user, ad), 1)\n          })\n          .reduceByKey((a, b) =&gt; a + b)\n      })\n      .foreachRDD(rdd =&gt; {\n        rdd.foreach(it =&gt; it match {\n          case ((date, user, ad), count) =&gt; {\n            // \u7edf\u8ba1\u6b21\u6570\n            JDBCUtil.update(\n              s\"\"\"\n                 |INSERT INTO user_ad_count (date, user, ad, count)\n                 |VALUES ('${date}', '${user}', '${ad}', ${count})\n                 |ON DUPLICATE KEY UPDATE count = count + ${count}\n                 |\"\"\".stripMargin\n            )\n            // \u5237\u65b0\u9ed1\u540d\u5355\n            JDBCUtil.update(\n              s\"\"\"\n                 |INSERT INTO blacklist (user)\n                 |SELECT user FROM user_ad_count t WHERE count &gt; 100\n                 |ON DUPLICATE KEY UPDATE user = t.user\n                 |\"\"\".stripMargin\n            )\n          }\n        })\n      })\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n\n  case class ADClick(ts: String, area: String, city: String, user: String, ad: String)\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#93","title":"9.3 \u9700\u6c42\u4e8c\uff08\u5e7f\u544a\u70b9\u51fb\u91cf\u5b9e\u65f6\u7edf\u8ba1\uff09","text":"<p>\u5b9e\u65f6\u7edf\u8ba1\u6bcf\u5929\u5404\u5730\u533a\u5404\u5e7f\u544a\u7684\u70b9\u51fb\u603b\u6d4f\u89c8\uff0c\u5e76\u5c06\u5176\u5b58\u5165 MySQL\u3002</p>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#931_2","title":"9.3.1 \u601d\u8def\u5206\u6790","text":"<ol> <li> <p>\u5355\u4e2a\u6279\u6b21\u5185\u5bf9\u6570\u636e\u8fdb\u884c\u6309\u7167\u5929\u7ef4\u5ea6\u7684\u805a\u5408\u5904\u7406\uff1b</p> </li> <li> <p>\u7ed3\u5408 MySQL \u6570\u636e\u8ddf\u5f53\u524d\u6279\u6b21\u6570\u636e\u66f4\u65b0\u539f\u6709\u6570\u636e\uff1b</p> </li> </ol>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#932-mysql_1","title":"9.3.2 MySQL \u5efa\u8868","text":"<pre><code>create table user_city_ad_count (\n    user  varchar(64),\n    date  varchar(64),\n    city  varchar(64),\n    ad    varchar(64),\n    count bigint,\n    primary key (user, date, city, ad)\n);\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#933_1","title":"9.3.3 \u529f\u80fd\u5b9e\u73b0","text":"<pre><code>object Requirement2 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement2\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(5))\n    ssc.sparkContext.setLogLevel(\"WARN\")\n\n    val kafkaParams = Map[String, Object](\n      ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; \"vm101:9092\",\n      ConsumerConfig.GROUP_ID_CONFIG -&gt; \"consumer_demo\",\n      ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\",\n      ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\"\n    )\n\n    KafkaUtils\n      .createDirectStream[String, String](ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](Set(\"topic_demo\"), kafkaParams))\n      // filter + map\n      .flatMap(message =&gt; message.value().split(\" \") match {\n        case Array(ts, area, city, user, ad) =&gt; {\n          val date = new SimpleDateFormat(\"yyyy-MM-dd\").format(new Date(ts.toLong))\n          Array[((String, String, String, String), Int)](((date, area, city, ad), 1))\n        }\n        case _ =&gt; Array[((String, String, String, String), Int)]()\n      })\n      .reduceByKey((a, b) =&gt; a + b)\n      .foreachRDD(rdd =&gt; {\n        rdd.foreachPartition(values =&gt; {\n          values.foreach(it =&gt; it match {\n            case ((date, area, city, ad), count) =&gt; {\n              JDBCUtil.update(\n                s\"\"\"\n                   |INSERT INTO area_city_ad_count (date, area, city, ad, count)\n                   |VALUES ('${date}', '${area}', '${city}', '${ad}', ${count})\n                   |ON DUPLICATE KEY UPDATE count = ${count}\n                   |\"\"\".stripMargin\n              )\n            }\n          })\n        })\n      })\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre>"},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#94","title":"9.4 \u6700\u8fd1\u4e00\u5206\u949f\u5e7f\u544a\u70b9\u51fb\u91cf","text":""},{"location":"bigdata/spark/spark%20%E7%AC%94%E8%AE%B0/#941","title":"9.4.1 \u529f\u80fd\u5b9e\u73b0","text":"<ul> <li> <p>\u7a0b\u5e8f</p> <pre><code>object Requirement3 {\n  def main(args: Array[String]): Unit = {\n    val conf = new SparkConf().setAppName(\"Requirement3\").setMaster(\"local[*]\")\n    val ssc = new StreamingContext(conf, Seconds(1L))\n    ssc.sparkContext.setLogLevel(\"WARN\")\n\n    val kafkaParams = Map[String, Object](\n      ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; \"vm101:9092\",\n      ConsumerConfig.GROUP_ID_CONFIG -&gt; \"consumer_demo\",\n      ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\",\n      ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\"\n    )\n\n    KafkaUtils\n      .createDirectStream[String, String](ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](Set(\"topic_demo\"), kafkaParams))\n      // filter + map\n      .flatMap(record =&gt; record.value().split(\" \") match {\n        case Array(ts, area, city, user, ad) =&gt; {\n          // \u5206\u949f\u5411\u4e0b\u53d6\u6574\n          // 12:01 =&gt; 12:00 | 01 / 10 * 10 =&gt; 00\n          // 12:11 =&gt; 12:10 | 10 / 10 * 10 =&gt; 10\n          // 12:19 =&gt; 12:10 | 19 / 10 * 10 =&gt; 10\n          // 12:25 =&gt; 12:20 | 25 / 10 * 10 =&gt; 20\n          // 12:59 =&gt; 12:50 | 59 / 10 * 10 =&gt; 50\n          val newTS = ts.toLong / 10000 * 10000\n          Array[(Long, Int)]((newTS, 1))\n        }\n        case _ =&gt; Array[(Long, Int)]()\n      })\n      // \u6700\u8fd1\u4e00\u5206\u949f\u6bcf 10 \u79d2\u8ba1\u7b97\u4e00\u6b21\n      .reduceByKeyAndWindow(\n        reduceFunc = (a, b) =&gt; a + b,\n        windowDuration = Seconds(60),\n        slideDuration = Seconds(10)\n      )\n      .foreachRDD(rdd =&gt; {\n        val jsonMapper = JsonMapper.builder().addModule(DefaultScalaModule).build()\n        val list = rdd\n          .sortByKey()\n          .map(it =&gt; it match {\n            case (ts, count) =&gt; {\n              val time = new SimpleDateFormat(\"HH:mm:ss\").format(new Date(ts))\n              // (time -&gt; count)\n              Map(\"x\" -&gt; time, \"y\" -&gt; count)\n            }\n          })\n          .collect()\n        val json = jsonMapper.writeValueAsString(list)\n        val fr = new FileWriter(\"public/spark-streaming/requirement3/data.json\")\n        fr.write(json)\n        fr.flush()\n        println(json)\n      })\n\n    ssc.start()\n    ssc.awaitTermination()\n  }\n}\n</code></pre> </li> <li> <p>\u5c55\u793a\u9875\u9762</p> <pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.1/echarts.min.js\"&gt;&lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div id=\"main\" style=\"width: 1000px; height: 300px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%)\"&gt;&lt;/div&gt;\n    &lt;script&gt;\n      // \u83b7\u53d6 DOM\n      const mainDOM = document.getElementById('main')\n      // \u521d\u59cb\u5316 chart\n      const chart = echarts.init(mainDOM, 'dark')\n      // \u9ed8\u8ba4 cahrt \u53c2\u6570\n      const option = {\n        xAxis: { type: 'category', data: [] },\n        yAxis: { type: 'value' },\n        series: [{ type: 'line', data: [] }]\n      }\n      // \u5b9a\u65f6\u66f4\u65b0 chart \u53c2\u6570\n      setInterval(() =&gt; {\n        fetch('/data.json').then(response =&gt; {\n          response.json().then(json =&gt; {\n            option.xAxis.data = json.map(it =&gt; it.x)\n            option.series[0].data = json.map(it =&gt; it.y)\n            chart.setOption(option)\n          })\n        })\n      }, 1000)\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> </li> <li> <p>\u542f\u52a8 Web \u670d\u52a1</p> <pre><code>python -m http.server\n</code></pre> </li> </ul>"},{"location":"bigdata/spark/__demo__/spark-demo/","title":"Spark Demo","text":""},{"location":"bigdata/spark/__demo__/spark-demo/#tutorial","title":"Tutorial","text":""},{"location":"bigdata/spark/__demo__/spark-demo/#demo","title":"Demo","text":""},{"location":"bigdata/spark/__demo__/spark-demo/#app1","title":"App1","text":"<pre><code>create table stg.stg_erp_t1 (\n    col_1 text,\n    col_2 text,\n    col_3 text,\n    col_4 text,\n    col_5 text\n);\n</code></pre>"},{"location":"bigdata/sqoop/","title":"Sqoop","text":""},{"location":"bigdata/sqoop/#export","title":"Export","text":""},{"location":"bigdata/sqoop/#hive-postgresql","title":"Hive \u5230 PostgreSQL","text":"<pre><code>sqoop export \\\n  --connect 'jdbc:postgresql://192.168.8.101:5432/warehouse' \\\n  --username 'postgres' \\\n  --password 'postgres' \\\n  --columns 'col_1, col_2, col_3' \\\n  --hcatalog-database 'stg' \\\n  --hcatalog-table 'stg_sys_user' \\\n  --table 'stg_sys_user' \\\n  --update-mode allowinsert \\\n  --m 1 \\\n  -- --schema 'stg'\n</code></pre>"},{"location":"bigdata/zookeeper/","title":"ZooKeeper","text":""},{"location":"bigdata/zookeeper/zookeeper-3.6.3%20%E5%AE%89%E8%A3%85/","title":"Zookeeper 3.6.3 \u5b89\u88c5","text":""},{"location":"bigdata/zookeeper/zookeeper-3.6.3%20%E5%AE%89%E8%A3%85/#_1","title":"\u5b89\u88c5","text":"<pre><code>wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3-bin.tar.gz\ntar -zxvf apache-zookeeper-3.6.3-bin.tar.gz -C /opt\ncd /opt\nmv apache-zookeeper-3.6.3-bin zookeeper-3.6.3\n</code></pre>"},{"location":"bigdata/zookeeper/zookeeper-3.6.3%20%E5%AE%89%E8%A3%85/#_2","title":"\u914d\u7f6e","text":"<pre><code>cd conf\nmv zoo_sample.cfg zoo.cfg\n</code></pre> <ul> <li> <p><code>zoo.cfg</code></p> <pre><code># The number of milliseconds of each tick\ntickTime=2000\n# The number of ticks that the initial\n# synchronization phase can take\ninitLimit=10\n# The number of ticks that can pass between\n# sending a request and getting an acknowledgement\nsyncLimit=5\n# the directory where the snapshot is stored.\n# do not use /tmp for storage, /tmp here is just\n# example sakes.\ndataDir=/opt/zookeeper-3.6.3/data\n# the port at which the clients will connect\nclientPort=2181\n# the maximum number of client connections.\n# increase this if you need to handle more clients\n#maxClientCnxns=60\n#\n# Be sure to read the maintenance section of the\n# administrator guide before turning on autopurge.\n#\n# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance\n#\n# The number of snapshots to retain in dataDir\n#autopurge.snapRetainCount=3\n# Purge task interval in hours\n# Set to \"0\" to disable auto purge feature\n#autopurge.purgeInterval=1\n\n## Metrics Providers\n#\n# https://prometheus.io Metrics Exporter\n#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider\n#metricsProvider.httpPort=7000\n#metricsProvider.exportJvmInfo=true\n</code></pre> </li> </ul>"},{"location":"build-tool/","title":"\u6784\u5efa\u5de5\u5177","text":""},{"location":"build-tool/gradle/","title":"Gradle","text":""},{"location":"build-tool/gradle/#_1","title":"\u6536\u85cf","text":""},{"location":"build-tool/gradle/#gradle-initgradle","title":"Gradle \u7cfb\u5217\u4e4b\u4ece init.gradle \u8bf4\u8d77","text":""},{"location":"build-tool/maven/","title":"Maven","text":""},{"location":"build-tool/maven/#_1","title":"\u955c\u50cf\u6e90","text":""},{"location":"build-tool/maven/#settingsxml","title":"\u4fee\u6539 <code>settings.xml</code> \u65b9\u5f0f","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;settings&gt;\n    &lt;mirrors&gt;\n        &lt;mirror&gt;\n            &lt;id&gt;aliyun&lt;/id&gt;\n            &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;\n            &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\n        &lt;/mirror&gt;\n    &lt;/mirrors&gt;\n    &lt;proxies&gt;\n        &lt;proxy&gt;\n            &lt;id&gt;http-proxy&lt;/id&gt;\n            &lt;active&gt;true&lt;/active&gt;\n            &lt;protocol&gt;http&lt;/protocol&gt;\n            &lt;host&gt;127.0.0.1&lt;/host&gt;\n            &lt;port&gt;7890&lt;/port&gt;\n        &lt;/proxy&gt;\n        &lt;proxy&gt;\n            &lt;id&gt;https-proxy&lt;/id&gt;\n            &lt;active&gt;true&lt;/active&gt;\n            &lt;protocol&gt;https&lt;/protocol&gt;\n            &lt;host&gt;127.0.0.1&lt;/host&gt;\n            &lt;port&gt;7890&lt;/port&gt;\n        &lt;/proxy&gt;\n    &lt;/proxies&gt;\n&lt;/settings&gt;\n</code></pre>"},{"location":"build-tool/maven/#pomxml","title":"\u4fee\u6539 <code>pom.xml</code> \u65b9\u5f0f","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;project&gt;\n    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;id&gt;aliyun&lt;/id&gt;\n            &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n\n    &lt;pluginRepositories&gt;\n        &lt;pluginRepository&gt;\n            &lt;id&gt;aliyun&lt;/id&gt;\n            &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;\n        &lt;/pluginRepository&gt;\n    &lt;/pluginRepositories&gt;\n&lt;/project&gt;\n</code></pre>"},{"location":"cloud-native/","title":"\u4e91\u539f\u751f","text":""},{"location":"cloud-native/#_2","title":"\u6536\u85cf","text":""},{"location":"cloud-native/#mysql-sql","title":"\u5229\u7528\u5bb9\u5668\u4e2d\u7684 mysql \u5ba2\u6237\u7aef\u6267\u884c sql \u6587\u4ef6\u6216\u6587\u672c","text":"<pre><code>docker exec -i mysql mysql -uroot -proot -e 'show databases';\n\ndocker exec -i mysql mysql -uroot -proot &lt; script/seatunnel_server_mysql.sql\n# cat script/seatunnel_server_mysql.sql | docker exec -i mysql mysql -uroot -proot\n</code></pre>"},{"location":"cloud-native/#k8s","title":"\u6ca1\u9519\uff0c\u6570\u636e\u5e93\u786e\u5b9e\u5e94\u8be5\u653e\u5165 K8s \u91cc\uff01","text":""},{"location":"cloud-native/#kubesphere-rainbond","title":"\u5f00\u6e90\u4e91\u539f\u751f\u5e73\u53f0 KubeSphere \u4e0e Rainbond \u5bf9\u6bd4","text":""},{"location":"cloud-native/#openebs","title":"openEBS","text":""},{"location":"cloud-native/#docker","title":"docker \u5bb9\u5668\u64cd\u4f5c\u5bbf\u4e3b\u673a\u6267\u884c\u547d\u4ee4","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/","title":"GitLab CI \u96c6\u6210 Nexus \u548c Harbor","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_1","title":"\u73af\u5883\u51c6\u5907","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_2","title":"\u57fa\u7840\u7ec4\u4ef6","text":"<ul> <li>K8S \u5355\u8282\u70b9\u96c6\u7fa4\uff08<code>v1.24.4+k3s1</code>\uff09\u3001Ingress Controller\u3001Storage Class</li> <li>Containerd\uff08<code>v1.6.6</code>\uff09\u3001BuildKit</li> <li><code>kubectl</code>\u3001<code>helm</code>\u3001<code>nerdctl</code></li> </ul>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab","title":"GitLab","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_3","title":"\u5b89\u88c5","text":"<p>\u901a\u8fc7 Helm \u5b89\u88c5 GitLab \u9ed8\u8ba4\u914d\u7f6e\u81f3\u5c11\u9700\u8981 8C32G \u8d44\u6e90\uff0c\u4f46\u662f GitLab \u6587\u6863\u4e2d\u4e5f\u63d0\u4f9b\u4e86\u9488\u5bf9 MiniKube \u6ee1\u8db3 2C4G \u8d44\u6e90\u7684\u914d\u7f6e values-minikube-minimum.yaml\u3002</p> <p>\u6700\u7ec8\u7684\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff0c\u5e76\u4e14\u7981\u7528\u4e86\u4e00\u4e9b\u975e\u5fc5\u8981\u7684\u7ec4\u4ef6\uff1a</p> <ul> <li>HTTPS</li> <li>Cert Manager</li> <li>Nginx Ingress Controller\uff08\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 Ingress Controller\uff09</li> <li>Prometheus</li> <li>Docker Registry\uff08\u4f7f\u7528 Harbor\uff09</li> <li>GitLab Agent Server</li> </ul> <p>\u9700\u8981\u6ce8\u610f\u7684\u914d\u7f6e\u662f <code>global.ingress.class</code> \u9700\u8981\u8bbe\u7f6e\u4e3a <code>none</code>\u624d\u4f1a\u8ba9 GitLab \u4f7f\u7528\u9ed8\u8ba4\u7684 Ingress Controller\u3002</p> <pre><code>global:\n  edition: ce\n  hosts:\n    domain: dev.icefery.xyz\n    https: false\n  ingress:\n    configureCertmanager: false\n    class: none\n    tls:\n      enabled: false\n  kas:\n    enabled: false\n  rails:\n    bootsnap:\n      enabled: false\n  time_zone: Asia/Shanghai\ncertmanager:\n  install: false\nnginx-ingress:\n  enabled: false\nprometheus:\n  install: false\nregistry:\n  enabled: false\ngitlab-runner:\n  install: true\n  rbac:\n    create: true\n    clusterWideAccess: true\n  runners:\n    privileged: true\n    config: |\n      [[runners]]\n        [runners.kubernetes]\n          image = \"ubuntu:22.04\"\n          {{- if .Values.global.minio.enabled }}\n          [runners.cache]\n            Type = \"s3\"\n            Path = \"gitlab-runner\"\n            Shared = true\n            [runners.cache.s3]\n              ServerAddress = {{ include \"gitlab-runner.cache-tpl.s3ServerAddress\" . }}\n              BucketName = \"runner-cache\"\n              BucketLocation = \"us-east-1\"\n              Insecure = true\n          {{ end }}\ngitlab:\n  webservice:\n    minReplicas: 1\n    maxReplicas: 1\n  sidekiq:\n    minReplicas: 1\n    maxReplicas: 1\n  gitlab-shell:\n    minReplicas: 1\n    maxReplicas: 1\n</code></pre> <p>\u56fe\u8868\u91c7\u7528\u4e86 <code>gitlab-jh/gitlab</code>\uff0c\u56e0\u4e3a\u6781\u72d0 GitLab \u4e0e\u539f\u751f GitLab \u4f7f\u7528\u76f8\u540c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u4e14\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7cfb\u7edf\u754c\u9762\u662f\u4e2d\u6587\u7684\u4e0d\u9700\u8981\u518d\u9891\u7e41\u505a\u8c03\u6574\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u4fee\u6539 Chart \u4ed3\u5e93\u5373\u53ef\u3002</p> <pre><code># helm repo add gitlab http://charts.gitlab.io/\nhelm repo add gitlab-jh https://charts.gitlab.cn\n\nhelm repo update\n\n# helm upgrade gitlab gitlab/gitlab --install --namespace gitlab --create-namespace --values gitlab.yaml\nhelm upgrade gitlab gitlab-jh/gitlab --install --namespace gitlab --create-namespace --values gitlab.yaml\n\n# \u67e5\u770b root \u5bc6\u7801\nkubectl get secret -n gitlab gitlab-gitlab-initial-root-password -ojsonpath='{.data.password}' | base64 --decode ; echo\n</code></pre> <p> </p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#harbor","title":"Harbor","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_4","title":"\u5b89\u88c5","text":"<p>Harbor \u7684\u5b89\u88c5\u4f7f\u7528\u4e86 Bitnami \u7cfb\u5217\u7684\u56fe\u8868\uff0c\u5e76\u4e14\u7981\u7528\u4e86 HTTPS \u4ee5\u53ca Ingress \u7684\u81ea\u52a8\u8df3\u8f6c\u3002</p> <p>\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a Docker \u65e0\u6cd5\u4f7f\u7528 HTTP \u6ce8\u518c\u8868\uff0c\u5f53 Harbor \u7981\u7528\u4e86 TLS \u540e\u4e5f\u5373\u65e0\u6cd5\u518d\u5728 Docker \u4e0a\u8fdb\u884c\u4f7f\u7528\u4e86\uff0c\u56e0\u6b64\u8fd9\u91cc\u91c7\u7528\u7684\u955c\u50cf\u6784\u5efa\u5de5\u5177\u662f Containerd \u548c <code>nerdctl</code>\uff0c\u8fd9\u4e24\u8005\u7684\u642d\u914d\u76f8\u6bd4\u4e8e Docker \u53ca\u5176 CLI \u529f\u80fd\u4f1a\u66f4\u591a\u4e00\u4e9b\uff0c\u5e76\u4e14\u5728\u591a\u5e73\u53f0\u955c\u50cf\u6784\u5efa\u65b9\u4fbf\u76f8\u6bd4 Docker CLI \u7684 <code>docker buildx</code> \u9650\u5236\u66f4\u5c11\u3002</p> <pre><code>adminPassword: admin\nexternalURL: http://core.harbor.dev.icefery.xyz\nexposureType: ingress\ningress:\n  core:\n    hostname: core.harbor.dev.icefery.xyz\n    annotations:\n      ingress.kubernetes.io/ssl-redirect: 'false'\n      nginx.ingress.kubernetes.io/ssl-redirect: 'false'\n  notary:\n    hostname: notary.harbor.dev.icefery.xyz\n    annotations:\n      ingress.kubernetes.io/ssl-redirect: 'false'\n      nginx.ingress.kubernetes.io/ssl-redirect: 'false'\n</code></pre> <pre><code>helm upgrade harbor bitnami/harbor --install --namespace harbor --create-namespace --values values.yaml\n</code></pre>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_5","title":"\u955c\u50cf\u6ce8\u518c\u8868\u914d\u7f6e","text":"<p>\u5b89\u88c5\u5b8c Harbor \u540e\uff0c\u53ef\u4ee5\u5c06 Harbor \u6dfb\u52a0\u5230 Containerd \u4ee5\u53ca K3S \u5185\u7f6e\u7684 Containerd \u4e2d\u3002</p> <p>\u76f8\u6bd4\u4e8e Docker \u6362\u6e90\uff0cContainerd \u7684\u6362\u6e90\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u9ebb\u70e6\u4e00\u4e9b\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863 registry.md\uff1a</p> <ul> <li> <p>\u66f4\u6539 Containerd \u914d\u7f6e\u6587\u4ef6</p> <pre><code>mkdir -p /etc/containerd/\n\ncat &gt; /etc/containerd/config.toml &lt;&lt;- \"EOF\"\nversion = 2\n[plugins.\"io.containerd.grpc.v1.cri\".registry]\n  config_path = \"/etc/containerd/certs.d\"\nEOF\n</code></pre> </li> <li> <p>\u6dfb\u52a0\u955c\u50cf\u6ce8\u518c\u8868\u914d\u7f6e</p> <p>\u5982\u679c Ingress Controller \u66b4\u9732\u7684\u7aef\u53e3\u4e0d\u662f 80 \u5219\u4e0d\u80fd\u7701\u7565 Harbor \u5730\u5740\u4e2d\u7684\u7aef\u53e3\uff0c\u4f8b\u5982 <code>core.harbor.dev.icefery.xyz:30080</code>\u3002</p> <pre><code>mkdir -p /etc/containerd/certs.d/core.harbor.dev.icefery.xyz/\n\ncat &gt; /etc/containerd/certs.d/core.harbor.dev.icefery.xyz/hosts.toml &lt;&lt;- \"EOF\"\nserver = \"http://core.harbor.dev.icefery.xyz\"\n[host.\"http://core.harbor.dev.icefery.xyz\"]\n  skip_verify = true\nEOF\n</code></pre> </li> <li> <p>\u5bf9 <code>docker.io</code> \u8fdb\u884c\u6362\u6e90</p> <pre><code>mkdir -p /etc/containerd/certs.d/docker.io/\n\ncat &gt; /etc/containerd/certs.d/docker.io/hosts.toml &lt;&lt;- \"EOF\"\nserver = \"https://registry-1.docker.io\"\n[host.\"https://uwk49ut2.mirror.aliyuncs.com\"]\n  capabilities = [\"pull\"]\nEOF\n</code></pre> </li> </ul> <p>\u4ee5\u4e0a\u7684\u914d\u7f6e\u65b9\u5f0f\u6765\u6e90\u4e8e 1.6.6 \u7248\u672c\u7684 Containerd \u6587\u6863\uff0c\u662f\u4e00\u79cd\u8f83\u65b0\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u4e0b\u5e76\u4e0d\u80fd\u6307\u5b9a Harbor \u7684\u5bc6\u7801\u3002\u5982\u679c\u5728 Harbor \u521b\u5efa\u7684\u662f\u79c1\u6709\u9879\u76ee\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4f7f\u7528\u539f\u5148\u7684\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <pre><code>cat &gt; /etc/containerd/config.toml &lt;&lt;- \"EOF\"\nversion = 2\n[plugins.\"io.containerd.grpc.v1.cri\".registry]\n  config_path = \"/etc/containerd/certs.d\"\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n  endpoint = [\"https://uwk49ut2.mirror.aliyuncs.com\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"core.harbor.dev.icefery.xyz\"]\n  endpoint = [\"http://core.harbor.dev.icefery.xyz\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"core.harbor.dev.icefery.xyz\".tls]\n  insecure_skip_verify = true\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"core.harbor.dev.icefery.xyz\".auth]\n  username = \"admin\"\n  password = \"admin\"\nEOF\n</code></pre> <p>K3S \u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\u53bb\u914d\u7f6e\u5185\u7f6e Containerd \u7684\u955c\u50cf\u6ce8\u518c\u8868\uff0c\u867d\u7136\u6700\u7ec8\u4e5f\u4f1a\u540c\u6b65\u5230<code>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</code>\u4e2d\uff1a</p> <pre><code>cat &gt; /etc/rancher/k3s/registries.yaml &lt;&lt;- \"EOF\"\nmirrors:\n  docker.io:\n    endpoint:\n      - \"https://uwk49ut2.mirror.aliyuncs.com\"\n  \"core.harbor.dev.icefery.xyz\":\n    endpoint:\n      - \"http://core.harbor.dev.icefery.xyz\"\nconfigs:\n  \"core.harbor.dev.icefery.xyz\":\n    tls:\n      insecure_skip_verify: true\n    auth:\n      username: admin\n      password: admin\nEOF\n</code></pre>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_6","title":"\u591a\u5e73\u53f0\u955c\u50cf\u6784\u5efa\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u4ece GitHub \u7684 <code>containerd/nerdctl</code> \u5b89\u88c5\u5b8c\u6210\u540e\u5e76\u6ca1\u6709\u542f\u52a8 BuildKit\uff0c\u4e3a\u4e86\u542f\u7528 BuildKit \u4ee5\u53ca\u652f\u6301\u591a\u5e73\u53f0\u955c\u50cf\u6784\u5efa\uff0c\u8fd8\u9700\u8981\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>systemctl enable --now buildkit\n\nnerdctl run --privileged --rm tonistiigi/binfmt --install all\n</code></pre>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_7","title":"\u56fe\u8868\u4ed3\u5e93\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u80fd\u591f\u63a8\u9001\u5230 Harbor \u5185\u7f6e\u7684 ChartMuseum \u4ed3\u5e93\uff0c\u8fd8\u9700\u4e3a Helm \u5b89\u88c5 <code>helm-push</code> \u5dee\u8ddd\uff1a</p> <pre><code>helm plugin install https://github.com/chartmuseum/helm-push\n</code></pre> <p></p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#nexus","title":"Nexus \u5b89\u88c5","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_8","title":"\u5b89\u88c5","text":"<pre><code>ingress:\n  enabled: true\n  ingressClassName: ''\n  hostRepo: nexus.dev.icefery.xyz\n</code></pre> <pre><code>helm repo add sonatype https://sonatype.github.io/helm3-charts/\n\nhelm repo update\n\nhelm upgrade nexus sonatype/nexus-repository-manager --install --namespace nexus --create-namespace --values values.yaml\n\n# \u67e5\u770b admin \u5bc6\u7801\nkubectl exec -n nexus pods/&lt;POD&gt; -- cat /nexus-data/admin.password\n</code></pre>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#maven","title":"Maven \u4ee3\u7406\u4ed3\u5e93\u914d\u7f6e","text":"<p>Nexus \u6709\u4e09\u79cd\u7c7b\u578b\u7684\u4ed3\u5e93\uff1a</p> <ul> <li><code>proxy</code> \u4ee3\u7406\u4ed3\u5e93\uff0c\u53ea\u8bfb</li> <li><code>hosted</code> \u5bbf\u4e3b\u4ed3\u5e93\uff0c\u5b58\u50a8\u81ea\u5b9a\u4e49 JAR \u5305\uff0c\u53ef\u5199</li> <li><code>group</code> \u7ec4\u4ed3\u5e93\uff0c\u805a\u5408\u4ee3\u7406\u4ed3\u5e93\u548c\u5bbf\u4e3b\u4ed3\u5e93\uff0c\u4e3a\u5176\u63d0\u4f9b\u7edf\u4e00\u7684\u670d\u52a1\u5730\u5740\uff0c\u53ef\u5199</li> </ul> <p>\u53c2\u8003\u4ee5\u4e0b\u7684\u914d\u7f6e\uff0c\u901a\u8fc7\u4ee3\u7406\u963f\u91cc\u4e91\u4e91\u6548 Maven \u548c\u9ed8\u8ba4\u7684 <code>repo.maven.apache.org</code> \u57fa\u672c\u53ef\u4ee5\u7f13\u5b58\u5927\u90e8\u5206\u4ed3\u5e93\u7684\u8bbf\u95ee\u3002</p> <pre><code>- { type: proxy, name: maven-proxy-aliyun-public, url: https://maven.aliyun.com/repository/public }\n- { type: proxy, name: maven-proxy-aliyun-google, url: https://maven.aliyun.com/repository/google }\n- { type: proxy, name: maven-proxy-aliyun-spring, url: https://maven.aliyun.com/repository/spring }\n- { type: proxy, name: maven-proxy-aliyun-spring-plugin, url: https://maven.aliyun.com/repository/spring-plugin }\n- { type: proxy, name: maven-proxy-aliyun-gradle-plugin, url: https://maven.aliyun.com/repository/gradle-plugin }\n- { type: proxy, name: maven-proxy-repo, url: https://repo.maven.apache.org/maven2 }\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab-ci","title":"GitLab CI","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab-runner","title":"GitLab Runner","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_9","title":"\u6267\u884c\u5668\u5bf9\u6bd4","text":"<p>GitLab Runner \u5404\u79cd\u7c7b\u578b\u7684 Runner \u5bf9\u6bd4\u5982\u4e0bExecutors\uff1a</p> \u6267\u884c\u5668 SSH Shell VirtualBox Parallels Docker Kubernetes \u81ea\u5b9a\u4e49 \u4e3a\u6bcf\u4e2a\u6784\u5efa\u6e05\u7406\u6784\u5efa\u73af\u5883 \u2717 \u2717 \u2713 \u2713 \u2713 \u2713 \u6709\u6761\u4ef6\u7684 \u91cd\u7528\u4e4b\u524d\u7684\u514b\u9686\uff08\u5982\u679c\u6709\uff09 \u2713 \u2713 \u2717 \u2717 \u2713 \u2717 \u6709\u6761\u4ef6\u7684 \u4fdd\u62a4 Runner \u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee \u2713 \u2717 \u2713 \u2713 \u2713 \u2713 \u6709\u6761\u4ef6\u7684 \u8fc1\u79fb Runner \u673a\u5668 \u2717 \u2717 \u90e8\u5206 \u90e8\u5206 \u2713 \u2713 \u2713 \u5e76\u53d1\u6784\u5efa\u7684\u96f6\u914d\u7f6e\u652f\u6301 \u2717 \u2717 \u2713 \u2713 \u2713 \u2713 \u6709\u6761\u4ef6\u7684 \u590d\u6742\u6784\u5efa\u73af\u5883 \u2717 \u2717 \u2713 \u2713 \u2713 \u2713 \u2713 \u4fee\u590d\u6784\u5efa\u95ee\u9898 \u7b80\u5355 \u7b80\u5355 \u56f0\u96be \u56f0\u96be \u9002\u4e2d \u9002\u4e2d \u9002\u4e2d"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#kubernetes","title":"Kubernetes \u6267\u884c\u5668","text":"<p>\u901a\u8fc7 Helm \u5b89\u88c5 GitLab \u65f6\u5df2\u7ecf\u9ed8\u8ba4\u5b89\u88c5\u4e86\u4e00\u4e2a Kubernetes \u6267\u884c\u5668\uff0c\u8fd9\u91cc\u7ed9\u9700\u8981\u5b83\u8bbe\u7f6e\u4e00\u4e2a\u6267\u884c\u5668\u7684\u6807\u7b7e\uff08<code>executor=kubernetes</code>\uff09\u3002\u6807\u7b7e\u662f\u7528\u4e8e\u7ed9 GitLab CI \u9009\u62e9 GitLab Runner \u7684\uff0c\u540e\u7eed\u5728\u521b\u5efa\u6ce8\u518c Shell \u6267\u884c\u5668\u7684 GitLab Runner \u65f6\u4e5f\u4f1a\u4e3a\u5176\u6dfb\u52a0\u6807\u7b7e\u3002</p> <p></p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#shell","title":"Shell \u6267\u884c\u5668","text":"<p>\u5176\u4e2d\u5c06 GitLab Runner \u5b89\u88c5\u4e3a\u670d\u52a1\u7684\u547d\u4ee4\u9700\u8981\u8c03\u6574\u4e00\u4e0b\uff1a</p> <pre><code># \u76f4\u63a5\u4f7f\u7528 root \u7528\u6237\u8fd0\u884c runner \u4f46\u662f\u5de5\u4f5c\u76ee\u5f55\u4f9d\u7136\u5728\u539f\u5148\u7684\u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\nmkdir -p /home/gitlab-runner\n\ngitlab-runner install --user=root --working-directory=/home/gitlab-runner\n</code></pre> <p>\u9488\u5bf9 Shell \u6267\u884c\u5668\uff0c\u76f4\u63a5\u4f7f\u7528 <code>root</code> \u7528\u6237\u542f\u52a8 GitLab Runner \u540e\u7eed\u7684\u914d\u7f6e\u76f8\u5bf9\u4f1a\u5c11\u5f88\u591a\u4e5f\u6700\u4e3a\u7b80\u5355\uff1a</p> <ul> <li> <p>\u4f7f\u7528 <code>gitlab-runner</code> \u7528\u6237\u6267\u884c\u9700\u8981\u914d\u7f6e\u514d\u5bc6<code>sudo</code>\u3002</p> <pre><code>echo \"gitlab-runner ALL=(ALL:ALL)  NOPASSWD:ALL\" &gt; /etc/sudoers.d/gitlab-runner\n\n# \u5728 Ubuntu \u73af\u5883\u4e0b\u9700\u8981\u5148\u6e05\u7a7a `gitlab-runner` \u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\u7684\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\u624d\u80fd\u6b63\u5e38\u6267\u884c\u4f5c\u4e1a\ncd /home/gitlab-runner\n\nrm -rf .bash_history  .bash_logout  .bashrc  .profile  .sudo_as_admin_successful\n</code></pre> <p>\u4f46\u662f\u5373\u904d\u5df2\u7ecf\u914d\u7f6e\u514d\u5bc6<code>sudo</code> \u548c <code>KUBECONFIG</code>\uff0c\u901a\u8fc7 <code>sudo</code> \u547d\u4ee4\u8fd0\u884c <code>helm</code> \u547d\u4ee4\u65f6\u8fd8\u662f\u62a5 <code>Error: Kubernetes cluster unreachable: Get \"http://localhost:8080/version\": dial tcp 127.0.0.1:8080: connect: connection refused</code> \u7684\u95ee\u9898\uff0c\u76ee\u524d\u6682\u672a\u89e3\u51b3\u3002</p> </li> <li> <p>\u6ce8\u518c\u4e3a SSH \u6267\u884c\u5668\u4e5f\u4ecd\u7136\u9700\u8981\u8fde\u63a5\u7684\u673a\u5668\u5b89\u88c5\uff08\u4e0d\u9700\u542f\u52a8\uff09 GitLab Runner \u624d\u80fd\u5728\u4efb\u52a1\u95f4\u4f20\u9012 Artifacts\uff0c\u5e76\u4e14\u9488\u5bf9\u53ea\u80fd\u4f7f\u7528 PublicKey \u767b\u5f55\u7684\u60c5\u51b5\u8fd8\u9700\u4e3a GitLab Runner \u6302\u8f7d SSH Key\u3002</p> <pre><code>services:\n  gitlab-runner-ssh:\n    image: gitlab/gitlab-runner:ubuntu-v15.3.0\n    container_name: gitlab-runner-ssh\n    volumes:\n      - /root/.ssh/gitlab-runner:/root/.ssh/gitlab-runner\nnetworks:\n  default:\n    external: true\n    name: compose\n</code></pre> </li> </ul> <p>\u6ce8\u518c\u5b8c GitLab Runner \u540e\u5982\u679c\u6ca1\u6709\u586b\u5199 Tag \u8fd8\u53ef\u4ee5\u5728 GitLab \u8fdb\u884c\u4fee\u6539\uff1a</p> <p> </p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#maven_1","title":"Maven \u9879\u76ee","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_10","title":"\u521b\u5efa\u9879\u76ee","text":"<p>\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684 Spring Boot \u9879\u76ee\uff1a</p> <ul> <li> <p><code>pom.xml</code></p> <p></p> </li> <li> <p><code>App.java</code></p> <p></p> </li> <li> <p><code>Dockerfile</code></p> <p></p> </li> <li> <p><code>kubectl.yaml</code></p> <p></p> </li> </ul>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab-ci_1","title":"GitLab CI \u6d41\u6c34\u7ebf","text":"<pre><code>variables:\n  # \u955c\u50cf\u6ce8\u518c\u8868\n  IMAGE_REGISTRY_NAME: core.harbor.dev.icefery.xyz\n  IMAGE_REGISTRY_USERNAME: admin\n  IMAGE_REGISTRY_PASSWORD: admin\n  # \u5e94\u7528\n  APP_GROUP: icefery\n  APP_NAME: my-app-maven\n  APP_VERSION: 0.0.1\n\nstages:\n  - package\n  - build\n  - deploy\n\npackage-jar:\n  image: maven:3.8-openjdk-17\n  stage: package\n  tags:\n    # \u9009\u62e9\u6267\u884c\u5668\u4e3a Kubernetes \u7684 GitLab Runner \u6267\u884c\u4f5c\u4e1a\n    - executor=kubernetes\n  variables:\n    MAVEN_OPTS: -Dmaven.repo.local=${CI_PROJECT_DIR}/.m2\n  cache:\n    key: m2\n    paths:\n      - .m2\n  before_script:\n    # \u79fb\u9664 Maven \u955c\u50cf\u4e2d\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\n    - rm -rf /usr/share/maven/conf/settings.xml\n  script:\n    - mvn clean package\n  artifacts:\n    paths:\n      - target/*.jar\n\nbuild-docker-image:\n  stage: build\n  tags:\n    # \u9009\u62e9\u6267\u884c\u5668\u4e3a Shell \u5e76\u4e14\u53ef\u4ee5\u6267\u884c nerdctl \u547d\u4ee4\u7684 GitLab Runner \u6267\u884c\u4f5c\u4e1a\n    - executor=shell\n    - command=nerdctl\n  before_script:\n    # non-interactively shell \u9700\u8981\u624b\u52a8\u914d\u7f6e\u73af\u5883\u53d8\u91cf\n    - source /etc/custom.sh\n  script:\n    # \u6784\u5efa\u955c\u50cf\n    - nerdctl build --tag ${IMAGE_REGISTRY_NAME}/${APP_GROUP}/${APP_NAME}:${APP_VERSION} --platform linux/amd64,linux/arm64 .\n    # \u767b\u5f55\u955c\u50cf\u6ce8\u518c\u8868\n    - nerdctl login http://${IMAGE_REGISTRY_NAME} --username ${IMAGE_REGISTRY_USERNAME} --password ${IMAGE_REGISTRY_PASSWORD}\n    # \u63a8\u9001\u955c\u50cf\n    - nerdctl push ${IMAGE_REGISTRY_NAME}/${APP_GROUP}/${APP_NAME}:${APP_VERSION} --all-platforms\n\ndeploy-to-kubernetes:\n  stage: deploy\n  tags:\n    - executor=shell\n    - command=kubectl\n  before_script:\n    - source /etc/custom.sh\n  script:\n    - kubectl apply -f ci/kubectl.yaml\n</code></pre> <p>\u7531\u4e8e Maven \u540e\u7eed\u7684\u9ad8\u7248\u672c\u4e2d\u4f1a\u963b\u6b62 HTTP \u7c7b\u578b\u4ed3\u5e93\u7684\u8bbf\u95ee\uff0c\u5bfc\u81f4 <code>pom.xml</code> \u4e2d\u914d\u7f6e\u7684 <code>&lt;repository&gt;</code> \u548c <code>&lt;pluginRepository&gt;</code> \u65e0\u6548\uff0c\u56e0\u6b64\u9700\u8981\u5148\u5220\u9664\u8be5\u6587\u4ef6\uff0c\u5f53\u7136\u5c06\u672c\u5730\u7684 <code>settings.xml</code> \u6587\u4ef6\u5e26\u5165\u9879\u76ee\u7248\u672c\u63a7\u5236\u968f\u7740\u6d41\u6c34\u7ebf\u4e00\u8d77 <code>mvn --settings ci/settings.xml clean package</code> \u4e5f\u53ef\u884c\u3002</p> <p></p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#nexus-jar","title":"\u7f13\u5b58\u5230 Nexus \u4e2d\u7684 Jar","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#npm","title":"NPM \u9879\u76ee","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_11","title":"\u521b\u5efa\u9879\u76ee","text":"<ul> <li> <p><code>index.js</code></p> <p></p> </li> <li> <p><code>Dockerfile</code></p> <p></p> </li> <li> <p><code>chart/templates/my-app-npm.yaml</code></p> <p></p> </li> </ul>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab-ci_2","title":"GitLab CI \u6d41\u6c34\u7ebf","text":"<p>\u5bf9\u4e8e NodeJS \u9879\u76ee\u53ef\u80fd\u591a\u9636\u6bb5\u6784\u5efa\u955c\u50cf\u4f1a\u66f4\u9002\u7528\u4e00\u4e9b\uff0c\u56e0\u4e3a\u5728\u6267\u884c <code>npm install</code> \u4e0b\u8f7d\u5305\u65f6\u5e76\u4e0d\u50cf Maven \u90a3\u6837\u900f\u660e\u5e76\u4e14\u4e0b\u8f7d\u8fc7\u7a0b\u5f88\u53ef\u80fd\u4f1a\u6267\u884c\u4e00\u4e9b\u4f9d\u8d56\u4e8e\u5e73\u53f0\u7684\u5de5\u4f5c\uff0c\u5982\u679c\u50cf\u6253\u5305 Jar \u5305\u90a3\u6837\u653e\u5728 GitLab Runner \u7684\u4f5c\u4e1a\u4e2d\uff0c\u867d\u7136\u53ef\u4ee5\u5bf9 <code>node_moduels</code> \u8fdb\u884c\u7f13\u5b58\uff0c\u4f46\u4e5f\u6709\u53ef\u80fd\u56e0\u4e3a\u67d0\u4e9b\u4f9d\u8d56\u7684\u5e73\u53f0\u7ed1\u5b9a\uff0c\u5bfc\u81f4\u540e\u7eed\u7684\u591a\u5e73\u53f0\u955c\u50cf\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u3002</p> <pre><code>variables:\n  # \u955c\u50cf\u6ce8\u518c\u8868\n  IMAGE_REGISTRY_NAME: core.harbor.dev.icefery.xyz\n  IMAGE_REGISTRY_USERNAME: admin\n  IMAGE_REGISTRY_PASSWORD: admin\n  # \u56fe\u8868\u4ed3\u5e93\n  CHART_REPO_NAME: icefery\n  CHART_REPO_URL: http://core.harbor.dev.icefery.xyz/chartrepo/icefery\n  CHART_REPO_USERNAME: admin\n  CHART_REPO_PASSWORD: admin\n  # \u5e94\u7528\n  APP_GROUP: icefery\n  APP_NAME: my-app-npm\n  APP_VERSION: 0.0.1\n\nstages:\n  - build\n  - deploy\n\nbuild-docker-image:\n  stage: build\n  tags:\n    # \u9009\u62e9\u6267\u884c\u5668\u4e3a Shell \u5e76\u4e14\u53ef\u4ee5\u6267\u884c nerdctl \u547d\u4ee4\u7684 GitLab Runner \u6267\u884c\u4f5c\u4e1a\n    - executor=shell\n    - command=nerdctl\n  before_script:\n    # non-interactively shell \u9700\u8981\u624b\u52a8\u914d\u7f6e\u73af\u5883\u53d8\u91cf\n    - source /etc/custom.sh\n  script:\n    # \u6784\u5efa\u955c\u50cf\n    - nerdctl build -t ${IMAGE_REGISTRY_NAME}/${APP_GROUP}/${APP_NAME}:${APP_VERSION} --platform linux/amd64,linux/arm64 .\n    # \u767b\u5f55\u955c\u50cf\u6ce8\u518c\u8868\n    - nerdctl login http://${IMAGE_REGISTRY_NAME} --username ${IMAGE_REGISTRY_USERNAME} --password ${IMAGE_REGISTRY_PASSWORD}\n    # \u63a8\u9001\u955c\u50cf\n    - nerdctl push ${IMAGE_REGISTRY_NAME}/${APP_GROUP}/${APP_NAME}:${APP_VERSION} --all-platforms\n\nbuild-helm-chart:\n  stage: build\n  tags:\n    - executor=shell\n    - command=helm\n  before_script:\n    - source /etc/custom.sh\n    - mkdir -p artifacts\n  script:\n    # \u6dfb\u52a0\u56fe\u8868\u4ed3\u5e93\n    - helm repo add ${CHART_REPO_NAME} ${CHART_REPO_URL} --username=${CHART_REPO_USERNAME} --password=${CHART_REPO_PASSWORD} || echo \"\u5ffd\u7565\u9519\u8bef\"\n    # \u63a8\u9001\u56fe\u8868\n    - helm cm-push chart/ ${CHART_REPO_NAME}\n    # \u5bfc\u51fa\u56fe\u8868\n    - helm package chart/ --destination artifacts\n  artifacts:\n    paths:\n      - artifacts/*.tgz\n\ndeploy-to-kubernetes:\n  stage: deploy\n  tags:\n    - executor=shell\n    - command=helm\n  before_script:\n    - source /etc/custom.sh\n  script:\n    - echo \"$(whoami)\"\n    # \u5378\u8f7d\n    - helm uninstall ${APP_NAME} --namespace ${APP_GROUP} || echo \"\u5ffd\u7565\u9519\u8bef\"\n    # \u66f4\u65b0\n    - helm repo update\n    # \u5b89\u88c5\n    - helm install ${APP_NAME} ${CHART_REPO_NAME}/${APP_NAME} --namespace ${APP_GROUP} --create-namespace --version ${APP_VERSION}\n</code></pre>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#harbor_1","title":"\u4e0a\u4f20\u5230 Harbor \u7684\u955c\u50cf","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#_12","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#gitlab-ci_3","title":"GitLab CI \u7f13\u5b58","text":"<p>\u5bf9\u4e8e\u901a\u8fc7 Maven \u6784\u5efa Jar \u5305\u7684\u4f5c\u4e1a\uff0c\u867d\u7136\u6211\u4eec\u5df2\u7ecf\u914d\u7f6e\u4e86 Nexus \u4f5c\u4e3a Jar \u5305\u7684\u4e00\u7ea7\u7f13\u5b58\uff0c\u4f46\u662f\u5c06 Jar \u5305\u4ece Nexus \u4e0b\u8f7d\u5230\u672c\u5730\u4ed3\u5e93\u4f9d\u7136\u9700\u8981\u6d88\u8017\u5927\u91cf\u8d44\u6e90\uff0c\u5982\u679c\u80fd\u591f\u5c06\u672c\u5730\u4ed3\u5e93\u7f13\u5b58\u8d77\u6765\u4f5c\u4e1a\u7684\u6267\u884c\u901f\u5ea6\u5c06\u4f1a\u5feb\u4e0d\u5c11\u3002</p> <p>GitLab CI \u9ed8\u8ba4\u662f\u672c\u5730\u7f13\u5b58\uff0c\u5bf9\u4e8e Kubernetes \u7b49\u901a\u8fc7\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\u6267\u884c\u7684 GitLab Runner \u6765\u8bf4\u5373\u4fbf\u8bbe\u7f6e\u4e86\u7f13\u5b58\u4e0b\u6b21\u4e5f\u65e0\u6cd5\u8fdb\u884c\u590d\u7528\u3002\u5728\u901a\u8fc7 Helm \u5b89\u88c5 GitLab \u65f6\u6211\u4eec\u5728\u914d\u7f6e\u4e86\u56fe\u8868\u81ea\u5e26\u7684 MinIO \u4f5c\u4e3a CI \u4f5c\u4e1a\u7684\u5206\u5e03\u5f0f\u7f13\u5b58\uff1a</p> <p></p> <p>\u56e0\u6b64\u5728\u901a\u8fc7 Maven \u6784\u5efa Jar \u5305\u65f6\u53ef\u4ee5\u76f4\u63a5\u590d\u7528\u7f13\u5b58\uff08\u4ece MinIO \u4e0b\u8f7d\uff09\uff1a</p> <p></p> <p>\u8981\u67e5\u770b GitLab \u56fe\u8868\u4e2d\u81ea\u5e26\u7684 MinIO \u6216\u8005\u9700\u8981\u4e3a\u5176\u5b83 GitLab Runner \u914d\u7f6e\u5206\u5e03\u5f0f\u7f13\u5b58\uff0c\u9700\u8981\u5148\u62ff\u5230\u5176 AccessKey \u548c Secret Key\uff1a</p> <pre><code>kubectl get -n gitlab secrets gitlab-minio-secret -ojsonpath='{.data.accesskey}' | base64 --decode\n\nkubectl get -n gitlab secrets gitlab-minio-secret -ojsonpath='{.data.secretkey}' | base64 --decode\n</code></pre> <p></p> <p></p>"},{"location":"cloud-native/GitLab%20CI%20%E9%9B%86%E6%88%90%20Nexus%20%E5%92%8C%20Harbor/#dns","title":"\u5185\u7f51 DNS","text":"<p>Nexus \u548c Harbor \u90fd\u662f\u9700\u8981\u66b4\u9732\u51fa\u6765\u4f9b\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u670d\u52a1\uff0c\u5e76\u4e14 CI \u4f5c\u4e1a\u540c\u6837\u9700\u8981\u9891\u7e41\u7684\u8bbf\u95ee Nexus \u548c Harbor \u7b49\u670d\u52a1\uff0c\u90a3\u4e48\u5982\u679c\u975e\u8981\u901a\u8fc7 Ingress \u8bbf\u95ee\u670d\u52a1\u4e0d\u53ef\uff0c\u5728\u4e0d\u8003\u8651 Ingress Controller \u7684\u5206\u6d41\u65b9\u6848\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4e24\u4e2a DNS \u670d\u52a1\u6765\u5206\u522b\u89e3\u6790 Ingress \u7684\"\u865a\u62df\u4e3b\u673a\" \u6765\u8fbe\u5230\u5bbf\u4e3b\u673a\u5185\u548c\u5bbf\u4e3b\u673a\u5916\u7684\u5206\u6d41\u6548\u679c\u3002</p> <p>\u4e4b\u524d\uff0c\u6211\u4eec\u4f7f\u7528 ExternalDNS + ETCD + CoreDNS \u5b9e\u73b0\u4e86\u5c40\u57df\u7f51\u7684 DNS \u81ea\u52a8\u6ce8\u518c\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4e2a\u66f4\u8f7b\u91cf\u7ea7\u7684 DNS \u670d\u52a1\u2014\u2014\u2014\u2014DNSmasq\u3002\u76f8\u6bd4 CoreDNS \u4f7f\u7528 DNSmasq \u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u914d\u7f6e\u6cdb\u89e3\u6790\uff1a</p> <pre><code>apt install -y dnsmasq\n\necho \"address=/dev.icefery.xyz/192.192.192.6\" &gt; /etc/dnsmasq.conf\n\nsystemctl restart dnsmasq\n</code></pre> <p>\u7136\u540e\u518d\u5c06\u96c6\u7fa4\u5185\u7684 CoreDNS \u515c\u5e95 <code>forward</code> \u5230\u8be5 DNS \u670d\u52a1\uff0c\u8fd9\u6837\u65e0\u8bba\u662f<code>gitlab.dev.icefery.xyz</code>\u8fd8\u662f <code>nexus.dev.icefery.xyz</code> \u90fd\u5c06\u89e3\u6790\u5230 <code>192.192.192.6</code> \u8fd9\u4e2a\u5bbf\u4e3b\u673a\u5185\u7684 IP \u4e0a\uff0c\u8fd9\u5bf9\u4f7f\u7528 HostNetwork + NodeSelector \u7684 Ingress Controller \u4f1a\u66f4\u52a0\u65b9\u4fbf\u4e00\u4e9b\u3002</p>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/","title":"\u901a\u8fc7 CoreDNS + ETCD + ExternalDNS \u6253\u901a\u5185\u7f51 Ingress \u57df\u540d\u8bbf\u95ee","text":""},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#_1","title":"\u76ee\u7684","text":"<p>\u5bf9\u4e8e HTTP \u7c7b\u578b\u7684\u670d\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Ingress \u8d44\u6e90\u4ee5\u201c\u865a\u62df\u4e3b\u673a\u201d\u7684\u5f62\u5f0f\u5c06\u670d\u52a1\u66b4\u9732\u51fa\u6765\uff0c\u4f46\u662f\u5728\u5185\u7f51\u73af\u5883\u4e0b\uff0c\u8fd9\u4e9b\u57df\u540d\u901a\u5e38\u90fd\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\uff0c\u4e8e\u662f\u6709\u4e86\u914d\u7f6e <code>hosts</code> \u6587\u4ef6\u8fdb\u884c\u672c\u5730\u57df\u540d\u89e3\u6790\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5f53\u96c6\u7fa4\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b\uff0c\u5c31\u4f1a\u9047\u5230\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u5982\u4f55\u5728\u5404\u4e2a\u8282\u70b9\u4ee5\u53ca\u5ba2\u6237\u7aef\u540c\u6b65\u57df\u540d\u89e3\u6790\u914d\u7f6e\uff1f</li> <li>\u5982\u4f55\u8fdb\u884c\u6cdb\u89e3\u6790\uff1f</li> <li>\u5982\u4f55\u5728\u96c6\u7fa4\u5185\u4e5f\u80fd\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff1f</li> <li>\u5982\u4f55\u5728 Ingress \u8d44\u6e90\u53d8\u52a8\u65f6\u81ea\u52a8\u66f4\u65b0\u57df\u540d\u89e3\u6790\u914d\u7f6e\uff1f</li> </ul> <p>\u524d\u4e24\u4e2a\u95ee\u9898\u5176\u5b9e\u662f\u60f3\u5f15\u51fa\u81ea\u5efa DNS \u670d\u52a1\u7684\u8bdd\u9898\uff0c\u901a\u8fc7\u81ea\u5efa DNS \u670d\u52a1\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u5185\u7f51\u73af\u5883\u4e2d\u5404\u8282\u70b9\u4ee5\u53ca\u5ba2\u6237\u7aef\u7684\u57df\u540d\u89e3\u6790\uff0c\u7b2c\u4e09\u4e2a\u95ee\u9898\u662f\u6307\u5c06\u96c6\u7fa4\u7684 CoreDNS \u505a\u4e00\u4e2a\u515c\u5e95 <code>forward</code> \u5230\u81ea\u5efa DNS \u670d\u52a1\uff0c\u7b2c\u56db\u4e2a\u95ee\u9898\u662f\u6307\u901a\u8fc7 ExternalDNS \u5c06 Ingress \u8d44\u6e90\u7684\u914d\u7f6e\u81ea\u52a8\u540c\u6b65\u5230\u81ea\u5efa DNS \u4e2d\u3002</p>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#_2","title":"\u5b9e\u8df5","text":"<p>\u5355\u7eaf\u81ea\u5efa DNS \u7684\u8bdd\u5176\u5b9e\u53ef\u4ee5\u4f7f\u7528\u7684\u8f6f\u4ef6\u6709\u5f88\u591a\uff0c\u4f46\u662f\u51fa\u4e8e\u5bf9\u8f7b\u91cf\u7ea7\u548c\u914d\u7f6e ExternalDNS \u7684\u8003\u8651\u5c31\u76f4\u63a5\u4f7f\u7528 CoreDNS \u4f5c\u4e3a DNS \u670d\u52a1\u5668\u8f6f\u4ef6\u3002\u53e6\u5916 CoreDNS \u672c\u8eab\u5df2\u7ecf\u80fd\u591f\u5b9e\u73b0\u57df\u540d\u89e3\u6790\u4e86\uff0c\u4f46\u4e5f\u4ec5\u4ec5\u662f\u53ea\u80fd\u8fdb\u884c\u9759\u6001\u57df\u540d\u89e3\u6790\uff0c\u56e0\u6b64\u9700\u8981\u7ed9\u5b83\u642d\u914d\u4e00\u4e2a ETCD \u6570\u636e\u5e93\uff0c\u540e\u7eed ExternalDNS \u5728\u8bfb\u53d6\u5230 Ingress \u914d\u7f6e\u540e\u4e5f\u4f1a\u5c06\u5176\u5199\u5165\u5230 ETCD \u4e2d\u3002</p> <p>\u6b64\u65f6\u81ea\u5efa DNS \u5df2\u7ecf\u80fd\u591f\u89e3\u6790 Ingress \u8d44\u6e90\u4e2d\u914d\u7f6e\u7684\u57df\u540d\u4e86\uff0c\u4f46\u662f\u4e3a\u4e86\u8ba9\u96c6\u7fa4\u5185\u4e5f\u80fd\u901a\u8fc7\u81ea\u5efa DNS \u8fdb\u884c\u57df\u540d\u89e3\u6790\uff0c\u8fd8\u9700\u914d\u7f6e\u96c6\u7fa4\u5185\u7684 CoreDNS \u8fdb\u884c\u515c\u5e95 <code>forward</code> \u5230\u81ea\u5efa DNS\u3002</p> <p>\u6700\u7ec8\u7684\u5404\u4e2a\u7ec4\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#_3","title":"\u73af\u5883\u51c6\u5907","text":"<p>\u4e3a\u4e86\u6d4b\u8bd5 Ingress \u7684\u6548\u679c\uff0c\u9700\u8981\u6709\u4e00\u4e2a IngressController\u3002\u5176\u6b21\uff0c\u5b89\u88c5 CoreDNS\u3001ETCD\u3001ExternalDNS \u65f6\u4f1a\u7528\u5230 Helm\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Docker\u3001Containerd \u5c06\u5176\u5b89\u88c5\u5728\u96c6\u7fa4\u5916\u3002</p>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#etcd","title":"\u5b89\u88c5\u81ea\u5efa ETCD","text":"<p>ETCD \u5e76\u6ca1\u6709\u91c7\u7528\u5b98\u65b9\u63a8\u8350\u7684 <code>etcd-operator</code> \u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Bitnami Chart\uff0c\u56e0\u4e3a Bitnami Chart \u7684\u955c\u50cf\u57fa\u672c\u90fd\u5728 DockerHub\uff0c\u6613\u4e8e\u8bbf\u95ee\u3002</p> <p>\u6682\u65f6\u53ea\u4fee\u6539\u4e86\u8ba4\u8bc1\u914d\u7f6e\u548c\u670d\u52a1\u66b4\u9732\u914d\u7f6e\uff08<code>kube-apiserver</code> \u7aef\u53e3\u8303\u56f4\u5df2\u653e\u5f00\uff09\uff1a</p> <ul> <li> <p><code>values.yaml</code></p> <pre><code>auth:\n  rbac:\n    create: false\n\nservice:\n  type: NodePort\n  nodePorts:\n    client: 2379\n</code></pre> </li> <li> <p>\u5b89\u88c5</p> <pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade etcd bitnami/etcd --install --namespace etcd --create-namespace --values values.yaml --version 8.3.7\n</code></pre> </li> <li> <p><code>etcdctl</code> \u547d\u4ee4\u884c\u6d4b\u8bd5\u5de5\u5177</p> <pre><code>kubectl run etcd-client --restart=\"Never\" --image docker.io/bitnami/etcd:3.5.4-debian-11-r22 --env ETCDCTL_ENDPOINTS=\"etcd.etcd.svc.cluster.local:2379\" --namespace etcd --command -- sleep infinity\n\nkubectl exec --namespace etcd -it etcd-client -- bash\n</code></pre> </li> </ul>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#coredns","title":"\u5b89\u88c5\u81ea\u5efa CoreDNS","text":"<p>\u4e3b\u8981\u4fee\u6539\u4e86\u670d\u52a1\u66b4\u9732\u65b9\u5f0f\u4ee5\u53ca\u76f4\u63a5\u6539\u5199\u7684 CoreDNS Chart \u9ed8\u8ba4\u7684 <code>Corefile</code> \u63d2\u4ef6\u914d\u7f6e\uff1a</p> <ul> <li> <p><code>values.yaml</code></p> <pre><code>serviceType: NodePort\n\nisClusterService: false\n\nservers:\n  - zones:\n      - zone: .\n    port: 53\n    nodePort: 53\n    plugins:\n      - name: errors\n      - name: health\n        configBlock: |-\n          lameduck 5s\n      - name: ready\n      - name: hosts\n        configBlock: |-\n          fallthrough\n      - name: etcd\n        configBlock: |-\n          endpoint http://etcd.etcd.svc.cluster.local:2379\n          fallthrough\n      - name: forward\n        parameters: . 114.114.114.114\n      - name: cache\n        parameters: 30\n      - name: loop\n      - name: reload\n      - name: loadbalance\n</code></pre> </li> <li> <p>\u5b89\u88c5</p> <pre><code>helm repo add coredns https://coredns.github.io/helm\n\nhelm repo update\n\nhelm upgrade coredns coredns/coredns --install --namespace coredns --create-namespace --values values.yaml --version 1.19.4\n</code></pre> </li> <li> <p>\u547d\u4ee4\u884c\u6d4b\u8bd5\u5de5\u5177</p> <pre><code>kubectl run -it --rm --restart=Never --image=infoblox/dnstools:latest dnstools\n</code></pre> </li> </ul> <p>\u56e0\u4e3a CoreDNS \u672c\u8eab\u5c31\u53ea\u6709\u4e00\u4e2a\u51e0\u5146\u5927\u5c0f\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u76f4\u63a5\u672c\u5730\u8fd0\u884c\u6216\u8005\u901a\u8fc7\u5728 Docker \u7b49\u96c6\u7fa4\u5916\u8fd0\u884c\u65f6\uff0c\u9700\u8981\u7684 <code>Corefile</code> \u5176\u5b9e\u66f4\u7b80\u6d01\uff1a</p> <pre><code>.: 53 {\n    hosts {\n        fallthrough\n    }\n    etcd {\n        endpoint http://192.192.192.6:2379\n        fallthrough\n    }\n    forward . 114.114.114.114\n}\n</code></pre> <p>\u5176\u4e2d <code>endpoint</code> \u662f\u6307 ETCD \u6570\u636e\u5e93\u7684\u5730\u5740\uff0c\u7531\u4e8e\u5b89\u88c5 ETCD \u65f6\u5df2\u7ecf\u901a\u8fc7 NodePort \u65b9\u5f0f\u66b4\u9732\u4e86\u7aef\u53e3\u56e0\u800c\u53ef\u4ee5\u76f4\u63a5\u91c7\u7528\u5bbf\u4e3b\u673a\u5730\u5740 + \u7aef\u53e3\u7684\u65b9\u5f0f\u8bbf\u95ee\u3002\u53ef\u4ee5\u5728 <code>hosts</code> \u63d2\u4ef6\u5757\u4e2d\u786c\u7f16\u7801\u4e00\u4e9b\u57df\u540d\u89e3\u6790\uff0c\u4e5f\u53ef\u4ee5\u8ba9\u5176\u76f4\u63a5\u5f15\u7528\u5bbf\u4e3b\u673a\u7684 <code>hosts</code> \u6587\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u501f\u52a9 template \u63d2\u4ef6 \u914d\u7f6e\u6cdb\u89e3\u6790\u3002\u6700\u540e\u515c\u5e95\u8f6c\u53d1\u5230 114 DNS \u670d\u52a1\u5668\u3002</p>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#externaldns","title":"\u5b89\u88c5 ExternalDNS","text":"<p>ExternalDNS \u4e5f\u662f\u4e3a\u4e86\u56fe\u955c\u50cf\u6613\u4e8e\u8bbf\u95ee\u76f4\u63a5\u4f7f\u7528 Bitnami Chart\uff1a</p> <ul> <li> <p><code>values.yaml</code></p> <pre><code>provider: coredns\n\ncoredns:\n  etcdEndpoints: 'http://etcd.etcd.svc.cluster.local:2379'\n</code></pre> </li> <li> <p>\u5b89\u88c5</p> <pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade external-dns bitnami/external-dns --install --namespace external-dns --create-namespace --values values.yaml --version 6.7.4\n</code></pre> </li> <li> <p>\u65e5\u5fd7\uff1a\u5f53 Ingress \u8d44\u6e90\u53d8\u52a8\u65f6\u53ef\u4ee5\u4ece ExternalDNS \u7684\u65e5\u5fd7\u4e2d\u770b\u5230\u65b0\u7684 DNS \u8bb0\u5f55\u88ab\u5199\u5165\u5230 ETCD \u4e2d\u3002</p> </li> </ul>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#coredns-dns","title":"\u5c06\u96c6\u7fa4\u5185\u7684 CoreDNS \u515c\u5e95\u8f6c\u53d1\u5230\u81ea\u5efa DNS","text":"<p>\u5bf9\u4e8e\u96c6\u7fa4\u5185\u9ed8\u8ba4\u7684 CoreDNS \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u5176 ConfigMap \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\uff08\u5177\u4f53\u53ef\u53c2\u8003 \u81ea\u5b9a\u4e49 DNS \u670d\u52a1\uff09\uff1a</p> <ul> <li> <p>\u67e5\u770b\u9ed8\u8ba4 ConfigMap</p> <pre><code>kubectl -n kube-system edit ConfigMap coredns\n</code></pre> </li> <li> <p><code>cm.yaml</code></p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . 192.192.192.6 114.114.114.114\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n</code></pre> </li> <li> <p>Apply</p> <pre><code>kubectl apply -f cm.yaml\n</code></pre> </li> </ul>"},{"location":"cloud-native/%E9%80%9A%E8%BF%87%20CoreDNS%20%2B%20ETCD%20%2B%20ExternalDNS%20%E6%89%93%E9%80%9A%E5%86%85%E7%BD%91%20Ingress%20%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE/#_4","title":"\u6548\u679c","text":""},{"location":"cloud-native/containerd/","title":"Containerd","text":""},{"location":"cloud-native/containerd/#_1","title":"\u5b89\u88c5","text":"<pre><code>REPO=\"containerd/nerdctl\"\nTAG=$(curl -fsSL \"https://api.github.com/repos/${REPO}/releases/latest\" | jq -r \".tag_name\")\nASSET=\"nerdctl-full-${TAG//v/}-linux-$(dpkg --print-architecture).tar.gz\"\n\nwget \"https://github.com/${REPO}/releases/download/${TAG}/${ASSET}\" -O \"${ASSET}\"\n\ntar Cxzvvf /usr/local \"${ASSET}\"\n\nsystemctl enable --now containerd\n\nsystemctl enable --now buildkit\n\nnerdctl completion bash &gt; /etc/bash_completion.d/nerdctl\n\nsource /etc/profile\n\nnerdctl network create compose\n\nnerdctl run --privileged --rm tonistiigi/binfmt --install all\n</code></pre>"},{"location":"cloud-native/containerd/#_2","title":"\u67e5\u770b\u9ed8\u8ba4\u914d\u7f6e","text":"<pre><code>containerd config default\n</code></pre>"},{"location":"cloud-native/containerd/#_3","title":"\u547d\u4ee4\u8865\u5168","text":"<pre><code>nerdctl completion bash &gt; /etc/bash_completion.d/nerdctl\n\nsource /etc/profile\n</code></pre>"},{"location":"cloud-native/containerd/#_4","title":"\u8bbe\u7f6e\u955c\u50cf\u6e90","text":"<ul> <li>https://github.com/containerd/containerd/blob/main/docs/cri/registry.md</li> <li>https://github.com/containerd/containerd/blob/main/docs/hosts.md</li> </ul> <pre><code>mkdir -p /etc/containerd/certs.d/docker.io\n\ncat &gt; /etc/containerd/certs.d/docker.io/hosts.toml &lt;&lt;- \"EOF\"\nserver = \"https://registry-1.docker.io\"\n[host.\"https://uwk49ut2.mirror.aliyuncs.com\"]\n  capabilities = [\"pull\"]\nEOF\n</code></pre> <pre><code>mkdir -p /etc/containerd\n\ncat &gt; /etc/containerd/config.toml &lt;&lt;- \"EOF\"\nversion = 2\n\n[plugins.\"io.containerd.grpc.v1.cri\".registry]\n  config_path = \"/etc/containerd/certs.d\"\nEOF\n</code></pre>"},{"location":"cloud-native/containerd/#_5","title":"\u8bbe\u7f6e\u5b88\u62a4\u8fdb\u7a0b\u4ee3\u7406","text":"<pre><code>mkdir -p /etc/systemd/system/containerd.service.d\n\ncat &gt; /etc/systemd/system/containerd.service.d/proxy.conf &lt;&lt;- \"EOF\"\n[Service]\nEnvironment=\"HTTP_PROXY=http://192.192.192.10:7890\"\nEnvironment=\"HTTPS_PROXY=http://192.192.192.10:7890\"\nEOF\n\nsystemctl daemon-reload\n\nsystemctl restart containerd\n</code></pre>"},{"location":"cloud-native/containerd/#_6","title":"\u6784\u5efa\u591a\u5e73\u53f0\u955c\u50cf","text":"<ul> <li>https://docs.docker.com/build/buildx/multiplatform-images/</li> <li>https://docs.docker.com/engine/reference/commandline/manifest/</li> </ul>"},{"location":"cloud-native/containerd/#qemu","title":"\u914d\u7f6e QEMU \u591a\u5e73\u53f0\u652f\u6301","text":"<pre><code># docker run --privileged --rm tonistiigi/binfmt --install all\n\nnerdctl run --privileged --rm tonistiigi/binfmt --install all\n\nls -1 /proc/sys/fs/binfmt_misc/qemu*\n</code></pre>"},{"location":"cloud-native/containerd/#docker","title":"\u901a\u8fc7 <code>docker</code> \u6784\u5efa","text":"<pre><code># \u521b\u5efa Builder\ndocker buildx create --use\ndocker buildx ls\n\n# \u6784\u5efa\u591a\u4e2a\u5e73\u53f0\u955c\u50cf\u5e76\u63a8\u9001\u5230 DockerHub\ndocker login\ndocker buildx build --tag icefery/my-app:0.0.1 --platform linux/amd64,linux/arm64 --push .\n\n# \u6784\u5efa\u5355\u4e2a\u5e73\u53f0\u5e76\u5bfc\u51fa\u5230\u672c\u5730\ndocker buildx build --tag icefery/my-app:0.0.1 --platform linux/arm64 --load .\n</code></pre> <p>\u5bfc\u51fa\u5230\u672c\u5730\u53ea\u80fd\u6784\u5efa\u4e00\u4e2a\u955c\u50cf\uff0c\u672c\u5730\u4e0d\u652f\u6301\u540c\u65f6\u5bfc\u51fa manifest lists\u3002</p>"},{"location":"cloud-native/containerd/#nerdctl","title":"\u901a\u8fc7 <code>nerdctl</code> \u6784\u5efa","text":"<pre><code>nerdctl build -t icefery/my-app:0.0.1 --platform linux/arm64,linux/amd64 .\n\nnerdctl image ls\n\nnerdctl login\n\nnerdctl push --all-platforms icefery/my-app:0.0.1\n</code></pre>"},{"location":"cloud-native/containerd/#_7","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"cloud-native/containerd/#fata0000-failed-to-create-shim-task-oci-runtime-create-failed-runc-create-failed-mountpoint-for-devices-not-found-unknown","title":"<code>FATA[0000] failed to create shim task: OCI runtime create failed: runc create failed: mountpoint for devices not found: unknown</code>","text":"<ul> <li>docker \u542f\u52a8\u95ee\u9898 mountpoint for devices not found</li> <li>https://github.com/tianon/cgroupfs-mount</li> </ul>"},{"location":"cloud-native/containerd/#ctr-http","title":"<code>ctr</code> \u62c9\u53d6 HTTP \u955c\u50cf","text":"<pre><code>ctr image pull --plain-http &lt;image&gt;\n</code></pre>"},{"location":"cloud-native/docker/","title":"Docker","text":""},{"location":"cloud-native/docker/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>Install Docker Engine on Ubuntu</p>"},{"location":"cloud-native/docker/#_2","title":"\u6536\u85cf","text":""},{"location":"cloud-native/docker/#dockerfile-echo","title":"\u5173\u4e8e Dockerfile \u4e2d echo \u7684\u7528\u6cd5","text":""},{"location":"cloud-native/docker/#docker_1","title":"docker \u6302\u8f7d\u6570\u636e\u5377","text":""},{"location":"cloud-native/docker/#warning-stopping-dockerservice-but-it-can-still-be-activated-by-dockersocket","title":"<code>Warning: Stopping docker.service, but it can still be activated by: docker.socket</code>","text":""},{"location":"cloud-native/docker/#_3","title":"\u8fdc\u7a0b\u8bbf\u95ee","text":"<p>https://docs.docker.com/config/daemon/remote-access/#configuring-remote-access-with-systemd-unit-file</p>"},{"location":"cloud-native/docker/#_4","title":"\u65b9\u5f0f\u4e00","text":"<ul> <li> <p><code>/etc/systemd/system/multi-user.target.wants/docker.service</code></p> <pre><code>ExecStart=/usr/bin/dockerd -H fd:// -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375\n</code></pre> </li> </ul>"},{"location":"cloud-native/docker/#_5","title":"\u65b9\u5f0f\u4e8c","text":"<ul> <li> <p><code>/etc/systemd/system/multi-user.target.wants/docker.service</code></p> <pre><code>ExecStart=/usr/bin/dockerd\n</code></pre> </li> <li> <p><code>/etc/docker/daemon.json</code></p> <pre><code>{\n  \"data-root\": \"/opt/data/docker\",\n  \"registry-mirrors\": [\"https://uwk49ut2.mirror.aliyuncs.com\"],\n  \"hosts\": [\"unix:///var/run/docker.sock\", \"tcp://0.0.0.0:2375\"]\n}\n</code></pre> </li> </ul>"},{"location":"cloud-native/docker/#_6","title":"\u6ce8\u610f\u9879","text":"<p>\u8bbf\u95ee\u6307\u4ee4\u53ea\u80fd\u9009\u62e9\u4e00\u5904\u8fdb\u884c\u914d\u7f6e\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff1a</p> <pre><code>unable to configure the Docker daemon with file /etc/docker/daemon.json: the following directives are specified both as a flag and in the configuration file: hosts: (from flag: [fd:// unix:///var/run/docker.sock], from file: [tcp://0.0.0.0:2375])\n</code></pre>"},{"location":"cloud-native/docker/#_7","title":"\u6d4b\u8bd5","text":"<pre><code>sudo daemon-reload\n\nsudo systemctl restart docker\n\nsudo netstat -lntp | grep dockerd\n</code></pre>"},{"location":"cloud-native/docker/#_8","title":"\u5e38\u7528\u547d\u4ee4","text":"<ul> <li> <p>\u5220\u9664\u5df2\u505c\u6b62\u7684\u5bb9\u5668</p> <pre><code>docker rm $(docker ps -a | grep Exited | awk '{print $1}')\n</code></pre> </li> <li> <p>\u83b7\u53d6\u6700\u65b0\u955c\u50cf\u7248\u672c\u53f7</p> <pre><code>VERSION=$(docker image ls | grep 'nginx' | awk '{print $2}' | sort -r | head -n 1)\n</code></pre> </li> <li> <p>\u81ea\u52a8\u6e05\u7406\u7a7a\u95f4</p> <pre><code>docker system prune\n</code></pre> </li> <li> <p>\u67e5\u770b\u5360\u7528</p> <pre><code>docker system df\n</code></pre> </li> </ul>"},{"location":"cloud-native/docker/build-minio-image/","title":"\u6784\u5efa MinIO \u955c\u50cf","text":""},{"location":"cloud-native/docker/build-minio-image/#minio-package","title":"MinIO package","text":"<pre><code>wget https://dl.min.io/server/minio/release/linux-amd64/archive/minio_0.0.20210116021944_amd64.deb\n</code></pre>"},{"location":"cloud-native/docker/build-minio-image/#dockerfile","title":"Dockerfile","text":"<pre><code>FROM ubuntu:20.04\n\nENV MINIO_ACCESS_KEY=admin \\\n    MINIO_SECRET_KEY=admin123\n\n# System\nRUN echo \"\\\n    deb http://mirrors.ustc.edu.cn/ubuntu/ focal           main restricted universe multiverse\\n \\\n    deb http://mirrors.ustc.edu.cn/ubuntu/ focal-security  main restricted universe multiverse\\n \\\n    deb http://mirrors.ustc.edu.cn/ubuntu/ focal-updates   main restricted universe multiverse\\n \\\n    deb http://mirrors.ustc.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\\n \\\n    \"&gt; /etc/apt/sources.list &amp;&amp; \\\n    apt-get update -y &amp;&amp; \\\n    apt-get install -y vim sudo\n\n# Custom\nCOPY minio_0.0.20210116021944_amd64.deb /root/minio.deb\nRUN apt-get install -y /root/minio.deb\n\nRUN groupadd icefery &amp;&amp; useradd icefery -g icefery -u 1000 -m -s /bin/bash &amp;&amp; mkdir -p /data\n\n# Permission\nRUN echo \"icefery ALL=(ALL) NOPASSWD:ALL\" &gt; /etc/sudoers.d/icefery\n\n# Endpoint\nEXPOSE 9000\nVOLUME [ \"/data\" ]\n\n# Runtime\nUSER icefery\n\n# Start\nENTRYPOINT sudo chmod 777 /data &amp;&amp; minio server /data\n</code></pre>"},{"location":"cloud-native/docker/build-minio-image/#build-run","title":"Build &amp; Run","text":"<pre><code>docker build -t my-minio:0.0.0 .\n</code></pre> <pre><code>docker run -p 9000:9000 -v /data/:/data/ my-minio:0.0.0\n</code></pre>"},{"location":"cloud-native/helm/","title":"Helm","text":""},{"location":"cloud-native/helm/#_1","title":"\u5b89\u88c5","text":"<pre><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n\nhelm completion bash &gt; /etc/bash_completion.d/helm\n\nsource /etc/profile\n</code></pre>"},{"location":"cloud-native/helm/#_2","title":"\u6536\u85cf","text":""},{"location":"cloud-native/helm/#_3","title":"\u8d44\u6e90\u6267\u884c\u987a\u5e8f","text":"<p>https://github.com/helm/helm/blob/release-3.0/pkg/releaseutil/kind_sorter.go</p> <pre><code>package releaseutil\n\ntype KindSortOrder []string\n\nvar InstallOrder KindSortOrder = []string{\n    \"Namespace\",\n    \"NetworkPolicy\",\n    \"ResourceQuota\",\n    \"LimitRange\",\n    \"PodSecurityPolicy\",\n    \"PodDisruptionBudget\",\n    \"Secret\",\n    \"ConfigMap\",\n    \"StorageClass\",\n    \"PersistentVolume\",\n    \"PersistentVolumeClaim\",\n    \"ServiceAccount\",\n    \"CustomResourceDefinition\",\n    \"ClusterRole\",\n    \"ClusterRoleList\",\n    \"ClusterRoleBinding\",\n    \"ClusterRoleBindingList\",\n    \"Role\",\n    \"RoleList\",\n    \"RoleBinding\",\n    \"RoleBindingList\",\n    \"Service\",\n    \"DaemonSet\",\n    \"Pod\",\n    \"ReplicationController\",\n    \"ReplicaSet\",\n    \"Deployment\",\n    \"HorizontalPodAutoscaler\",\n    \"StatefulSet\",\n    \"Job\",\n    \"CronJob\",\n    \"Ingress\",\n    \"APIService\",\n}\n\nvar UninstallOrder KindSortOrder = []string{\n    \"APIService\",\n    \"Ingress\",\n    \"Service\",\n    \"CronJob\",\n    \"Job\",\n    \"StatefulSet\",\n    \"HorizontalPodAutoscaler\",\n    \"Deployment\",\n    \"ReplicaSet\",\n    \"ReplicationController\",\n    \"Pod\",\n    \"DaemonSet\",\n    \"RoleBindingList\",\n    \"RoleBinding\",\n    \"RoleList\",\n    \"Role\",\n    \"ClusterRoleBindingList\",\n    \"ClusterRoleBinding\",\n    \"ClusterRoleList\",\n    \"ClusterRole\",\n    \"CustomResourceDefinition\",\n    \"ServiceAccount\",\n    \"PersistentVolumeClaim\",\n    \"PersistentVolume\",\n    \"StorageClass\",\n    \"ConfigMap\",\n    \"Secret\",\n    \"PodDisruptionBudget\",\n    \"PodSecurityPolicy\",\n    \"LimitRange\",\n    \"ResourceQuota\",\n    \"NetworkPolicy\",\n    \"Namespace\",\n}\n</code></pre>"},{"location":"cloud-native/helm/#helm-template","title":"Helm template \u5feb\u901f\u5165\u95e8","text":""},{"location":"cloud-native/helm/#error-upgrade-failed-create-failed-to-create-request-entity-too-large-limit-is-3145728","title":"<code>Error: UPGRADE FAILED: create: failed to create: Request entity too large: limit is 3145728</code>","text":"<p>HelmChart \u76ee\u5f55\u592a\u5927\u3002\u53ef\u80fd\u662f\u5c06\u5f88\u5927\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e0b\u8f7d\u5230\u4e86\u8be5\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"cloud-native/istio/","title":"Istio","text":""},{"location":"cloud-native/istio/#_1","title":"\u4e00\u3001\u5feb\u901f\u5f00\u59cb","text":""},{"location":"cloud-native/istio/#11","title":"1.1 \u5b89\u88c5","text":"<pre><code># \u4e0b\u8f7d\u89e3\u538b\ncurl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.17.1 TARGET_ARCH=x86_64 sh -\nmv istio-1.17.1 /opt/env/istio\ncd /opt/env/istio\n\n# \u914d\u7f6e\u73af\u5883\u53d8\u91cf\ntee /etc/profile.d/istio.sh &lt;&lt;- 'EOF'\nexport ISTIO_HOME=/opt/env/istio\nexport PATH=$ISTIO_HOME/bin:$PATH\nEOF\n\n# \u914d\u7f6e\u547d\u4ee4\u81ea\u52a8\u8865\u5168\ncp tools/istioctl.bash /etc/bash_completion.d\n\n# \u5237\u65b0\u73af\u5883\u53d8\u91cf\nsource /etc/profile\n</code></pre> <pre><code># \u5b89\u88c5 istio\nistioctl install --set profile=demo -y\n\n# \u914d\u7f6e\u81ea\u52a8\u6ce8\u5165\nkubectl label namespace default istio-injection=enabled\n\n# \u67e5\u770b\u7f51\u5173\u5730\u5740\nexport INGRESS_HOST=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\nexport INGRESS_PORT=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.spec.ports[?(@.name==\"http2\")].port}')\nexport GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT\n\n# \u5b89\u88c5\u63d2\u4ef6\nkubectl apply -f samples/addons\nkubectl rollout status deployment/kiali -n istio-system\nistioctl dashboard kiali --address=$INGRESS_HOST\n</code></pre>"},{"location":"cloud-native/istio/#12-bookinfo","title":"1.2 \u90e8\u7f72 Bookinfo \u793a\u4f8b\u5e94\u7528","text":"<pre><code># \u90e8\u7f72 bookinfo\nkubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml\n\n# \u521b\u5efa istio Gateway\nkubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\n\n# \u9a8c\u8bc1\nistioctl analyze\n</code></pre>"},{"location":"cloud-native/istio/#13","title":"1.3 \u6d4b\u8bd5","text":""},{"location":"cloud-native/istio/#131","title":"1.3.1 \u8bbf\u95ee\u5e94\u7528\u7a0b\u5e8f","text":"<pre><code>echo \"http://$GATEWAY_URL/productpage\"\n</code></pre>"},{"location":"cloud-native/istio/#132","title":"1.3.2 \u6279\u91cf\u53d1\u9001\u8bf7\u6c42","text":"<pre><code>for i in $(seq 1 100); do curl -s -o /dev/null \"http://$GATEWAY_URL/productpage\"; done\n</code></pre>"},{"location":"cloud-native/istio/#14","title":"1.4 \u5378\u8f7d","text":"<pre><code># \u6e05\u7406 bookinfo\nNAMESPACE=default samples/bookinfo/platform/kube/cleanup.sh\n\n# \u5378\u8f7d istio\nkubectl delete -f samples/addons\nistioctl uninstall -y --purge\n\n# \u6e05\u7406\u547d\u540d\u7a7a\u95f4\nkubectl delete namespace istio-system\nkubectl label namespace default istio-injection-\n</code></pre>"},{"location":"cloud-native/istio/#_2","title":"\u4e8c\u3001\u67b6\u6784","text":"<p>Istio \u670d\u52a1\u7f51\u683c\u4ece\u903b\u8f91\u4e0a\u5206\u4e3a\u6570\u636e\u5e73\u9762\u548c\u63a7\u5236\u5e73\u9762\u3002</p> <ul> <li>\u6570\u636e\u5e73\u9762\u7531\u4e00\u7ec4\u4ee3\u7406\uff08Envoy\uff09\u7ec4\u6210\uff0c\u88ab\u90e8\u7f72\u4f4d Sidecar\u3002\u8fd9\u4e9b\u4ee3\u7406\u8d1f\u8d23\u534f\u8c03\u548c\u63a7\u5236\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u6240\u6709\u7f51\u7edc\u901a\u4fe1\u3002\u5b83\u4eec\u8fd8\u6536\u96c6\u548c\u62a5\u544a\u6240\u6709\u7f51\u683c\u6d41\u91cf\u7684\u9065\u6d4b\u6570\u636e\u3002</li> <li>\u63a7\u5236\u5e73\u9762\u7ba1\u7406\u5e76\u914d\u7f6e\u4ee3\u7406\u6765\u8fdb\u884c\u6d41\u91cf\u8def\u7531\u3002</li> </ul>"},{"location":"cloud-native/istio/#21","title":"2.1 \u7ec4\u4ef6","text":""},{"location":"cloud-native/istio/#211-envoy","title":"2.1.1 Envoy","text":"<p>Istio \u4f7f\u7528 Envoy \u4ee3\u7406\u7684\u6269\u5c55\u7248\u672c\u3002Envoy \u662f\u7528 C++ \u5f00\u53d1\u7684\u9ad8\u6027\u80fd\u4ee3\u7406\uff0c\u7528\u4e8e\u534f\u8c03\u670d\u52a1\u7f51\u683c\u4e2d\u6240\u6709\u670d\u52a1\u7684\u5165\u7ad9\u548c\u51fa\u7ad9\u6d41\u91cf\u3002Envoy \u4ee3\u7406\u662f\u552f\u4e00\u4e0e\u6570\u636e\u5e73\u9762\u6d41\u91cf\u4ea4\u4e92\u7684 Istio \u7ec4\u4ef6\u3002</p> <p>Envoy \u4ee3\u7406\u88ab\u90e8\u7f72\u4f4d\u670d\u52a1\u7684 Sidecar\uff0c\u5728\u903b\u8f91\u4e0a\u4f4d\u670d\u52a1\u589e\u52a0\u4e86 Envoy \u7684\u8bb8\u591a\u5185\u7f6e\u7279\u6027\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u52a8\u6001\u670d\u52a1\u53d1\u73b0</li> <li>\u8d1f\u8f7d\u5747\u8861</li> <li>TLS \u7ec8\u7aef</li> <li>HTTP/2 \u4e0e gRPC \u4ee3\u7406</li> <li>\u7194\u65ad\u5668</li> <li>\u5065\u5eb7\u68c0\u67e5</li> <li>\u57fa\u4e8e\u767e\u5206\u6bd4\u6d41\u91cf\u5206\u5272\u7684\u5206\u9636\u6bb5\u53d1\u5e03</li> <li>\u6545\u969c\u6ce8\u5165</li> <li>\u4e30\u5bcc\u7684\u6307\u6807</li> </ul> <p>\u8fd9\u79cd Sidecar \u90e8\u7f72\u5141\u8bb8 Istio \u53ef\u4ee5\u6267\u884c\u7b56\u7565\u51b3\u7b56\uff0c\u5e76\u63d0\u53d6\u4e30\u5bcc\u7684\u9065\u6d4b\u6570\u636e\uff0c\u63a5\u7740\u5c06\u8fd9\u4e9b\u6570\u636e\u53d1\u9001\u5230\u76d1\u63a7\u7cfb\u7edf\u4ee5\u63d0\u4f9b\u6709\u5173\u6574\u4e2a\u7f51\u7edc\u884c\u4e3a\u7684\u4fe1\u606f\u3002</p> <p>Sidecar \u4ee3\u7406\u6a21\u578b\u8fd8\u5141\u8bb8\u60a8\u5411\u73b0\u6709\u7684\u90e8\u7f72\u6dfb\u52a0 Istio \u529f\u80fd\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u8bbe\u8ba1\u67b6\u6784\u6216\u91cd\u5199\u4ee3\u7801\u3002</p> <p>\u7531 Envoy \u4ee3\u7406\u542f\u7528\u7684\u4e00\u4e9b Istio \u529f\u80fd\u548c\u4efb\u52a1\u5305\u62ec\uff1a</p> <ul> <li>\u6d41\u91cf\u63a7\u5236\u529f\u80fd\uff1a\u901a\u8fc7\u4e30\u5bcc\u7684 HTTP\u3001gRPC\u3001WebSocket \u548c TCP \u6d41\u91cf\u8def\u7531\u89c4\u5219\u6765\u6267\u884c\u7ec6\u7c92\u5ea6\u7684\u6d41\u91cf\u63a7\u5236\u3002</li> <li>\u7f51\u7edc\u5f39\u6027\u7279\u6027\uff1a\u91cd\u8bd5\u8bbe\u7f6e\u3001\u6545\u969c\u8f6c\u79fb\u3001\u7194\u65ad\u5668\u548c\u6545\u969c\u6ce8\u5165\u3002</li> <li>\u5b89\u5168\u6027\u548c\u8eab\u4efd\u8ba4\u8bc1\u7279\u6027\uff1a\u6267\u884c\u5b89\u5168\u6027\u7b56\u7565\uff0c\u5e76\u5f3a\u5236\u5b9e\u884c\u901a\u8fc7\u914d\u7f6e API \u5b9a\u4e49\u7684\u8bbf\u95ee\u63a7\u5236\u548c\u901f\u7387\u9650\u5236\u3002</li> <li>\u57fa\u4e8e WebAssembly \u7684\u53ef\u63d2\u62d4\u6269\u5c55\u6a21\u578b\uff0c\u5141\u8bb8\u901a\u8fc7\u81ea\u5b9a\u4e49\u7b56\u7565\u6267\u884c\u548c\u751f\u6210\u7f51\u7edc\u6d41\u91cf\u7684\u9065\u6d4b\u3002</li> </ul>"},{"location":"cloud-native/istio/#212-istiod","title":"2.1.2 Istiod","text":"<p>Istiod \u63d0\u4f9b\u670d\u52a1\u53d1\u73b0\u3001\u914d\u7f6e\u548c\u8bc1\u4e66\u7ba1\u7406\u3002</p> <p>Istiod \u5c06\u63a7\u5236\u6d41\u91cf\u884c\u4e3a\u7684\u9ad8\u7ea7\u8def\u7531\u89c4\u5219\u8f6c\u6362\u4e3a Envoy \u7279\u5b9a\u7684\u914d\u7f6e\uff0c\u5e76\u5728\u8fd0\u884c\u65f6\u5c06\u5176\u4f20\u64ad\u7ed9 Sidecar\u3002Pilot \u63d0\u53d6\u4e86\u7279\u5b9a\u5e73\u53f0\u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff0c\u5e76\u5c06\u5176\u7efc\u5408\u4e3a\u4e00\u79cd\u6807\u51c6\u683c\u5f0f\uff0c\u4efb\u4f55\u670d\u52a1 Envoy API \u7684 Sidecar \u90fd\u53ef\u4ee5\u4f7f\u7528\u3002</p> <p>Istio \u53ef\u4ee5\u652f\u6301\u53d1\u73b0\u591a\u79cd\u73af\u5883\uff0c\u5165 Kubernetes \u6216 VM\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 Istio \u6d41\u91cf\u7ba1\u7406 API \u8ba9 Istiod \u91cd\u65b0\u6784\u9020 Envoy \u7684\u914d\u7f6e\uff0c\u4ee5\u4fbf\u670d\u52a1\u7f51\u683c\u4e2d\u7684\u6d41\u91cf\u8fdb\u884c\u66f4\u7cbe\u7ec6\u7684\u63a7\u5236\u3002</p> <p>Istiod \u5b89\u5168\u901a\u8fc7\u5185\u7f6e\u7684\u8eab\u4efd\u548c\u51ed\u8bc1\u7ba1\u7406\uff0c\u5b9e\u73b0\u4e86\u5f3a\u5927\u7684\u670d\u52a1\u5bf9\u670d\u52a1\u548c\u7ec8\u7aef\u7528\u6237\u8ba4\u8bc1\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Istio \u6765\u5347\u7ea7\u670d\u52a1\u7f51\u7edc\u4e2d\u672a\u52a0\u5bc6\u7684\u6d41\u91cf\u3002\u4f7f\u7528 Istio\uff0c\u8fd0\u8425\u5546\u53ef\u4ee5\u57fa\u4e8e\u670d\u52a1\u8eab\u4efd\u800c\u4e0d\u662f\u76f8\u5bf9\u4e0d\u7a33\u5b9a\u7684\u7b2c 3 \u5c42\u6216\u7b2c 4 \u5c42\u7f51\u7edc\u6807\u8bc6\u7b26\u6765\u6267\u884c\u7b56\u7565\u3002\u6b64\u5916\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Istio \u7684\u6388\u6743\u529f\u80fd\u63a7\u5236\u8c01\u53ef\u4ee5\u8bbf\u95ee\u60a8\u7684\u670d\u52a1\u3002</p> <p>Istiod \u5145\u5f53\u8bc1\u4e66\u6388\u6743\uff08CA\uff09\uff0c\u751f\u6210\u8bc1\u4e66\u4ee5\u5141\u8bb8\u5728\u6570\u636e\u5e73\u9762\u4e2d\u8fdb\u884c\u5b89\u5168\u7684 mTLS \u901a\u4fe1\u3002</p>"},{"location":"cloud-native/k3s/","title":"K3S","text":""},{"location":"cloud-native/k3s/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":"<ul> <li>\u79c1\u6709\u955c\u50cf\u4ed3\u5e93\u914d\u7f6e</li> <li>\u914d\u7f6e HTTP \u4ee3\u7406</li> </ul>"},{"location":"cloud-native/k3s/#21","title":"2.1 \u5feb\u901f\u5b89\u88c5","text":""},{"location":"cloud-native/k3s/#211-server","title":"2.1.1 \u542f\u52a8 Server \u8282\u70b9","text":"<pre><code># \u53ef\u7981\u7528\u7684\u7ec4\u4ef6\u6709 coredns | servicelb | traefik | local-storage | metrics-server\ncurl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server\n</code></pre> <pre><code>cat /data/k3s/var/lib/rancher/k3s/server/token\n</code></pre>"},{"location":"cloud-native/k3s/#22-etcd","title":"2.2 \u9ad8\u53ef\u7528\u5d4c\u5165\u5f0f etcd \u5b89\u88c5","text":"<p>\u9ad8\u53ef\u7528\u5d4c\u5165\u5f0f etcd</p>"},{"location":"cloud-native/k3s/#221-server","title":"2.2.1 \u542f\u52a8 Server \u8282\u70b9","text":"<p>\u4f7f\u7528 <code>--cluster-init</code> \u6807\u5fd7\u5f15\u5bfc\u96c6\u7fa4\u3002</p> <pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --cluster-init\n</code></pre> <pre><code>cat /data/k3s/var/lib/rancher/k3s/server/token\n</code></pre>"},{"location":"cloud-native/k3s/#222-server","title":"2.2.2 \u52a0\u5165\u5176\u5b83 Server \u8282\u70b9","text":"<p>\u914d\u7f6e\u6807\u8bc6\u5728\u6240\u6709 Server \u8282\u70b9\u5fc5\u987b\u662f\u76f8\u540c\u7684\u3002</p> <pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --server https://&lt;HOST&gt;:6443 \\\n    --token &lt;TOKEN&gt;\n</code></pre>"},{"location":"cloud-native/k3s/#23","title":"2.3 \u9ad8\u53ef\u7528\u5916\u90e8\u6570\u636e\u5e93\u5b89\u88c5","text":"<p>\u9ad8\u53ef\u7528\u5916\u90e8\u6570\u636e\u5e93</p>"},{"location":"cloud-native/k3s/#231-server","title":"2.3.1 \u542f\u52a8 Server \u8282\u70b9","text":"<pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --datastore-endpoint \"mysql://username:password@tcp(hostname:3306)/database-name\"\n</code></pre> <pre><code>cat /data/k3s/var/lib/rancher/k3s/server/token\n</code></pre>"},{"location":"cloud-native/k3s/#232-server","title":"2.3.2 \u5176\u5b83 Server \u8282\u70b9","text":"<pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --datastore-endpoint \"mysql://username:password@tcp(hostname:3306)/database-name\" \\\n    --token &lt;TOKEN&gt;\n</code></pre>"},{"location":"cloud-native/k3s/#24-agent","title":"2.4 \u52a0\u5165 Agent \u8282\u70b9","text":"<pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.26.12+k3s1 bash -s - agent \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --server https://&lt;HOST&gt;:6443 \\\n    --token &lt;TOKEN&gt;\n</code></pre>"},{"location":"cloud-native/k3s/#_2","title":"\u6536\u85cf","text":""},{"location":"cloud-native/k3s/#nerdctl-containerd","title":"\u4f7f\u7528 <code>nerdctl</code> \u8bbf\u95ee Containerd","text":"<pre><code>nerdctl --address /var/run/k3s/containerd/containerd.sock ps -a\n</code></pre>"},{"location":"cloud-native/k3s/#bitnami","title":"bitnami \u955c\u50cf\u5377\u6620\u5c04\u6743\u9650\u4e0d\u8db3","text":"<pre><code>docker compose up -d\n\nchown -R 1001:1001 /data/compose\n\ndocker compose restart\n</code></pre>"},{"location":"cloud-native/k3s/nfs-dynamic-pvc/","title":"NFS \u52a8\u6001 PVC \u7684 StorageClass \u548c StatefulSet","text":""},{"location":"cloud-native/k3s/nfs-dynamic-pvc/#_1","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>K3S/K8S \u4e2d\u52a8\u6001\u521b\u5efa PVC \u65f6 SelfLink \u95ee\u9898\u89e3\u51b3</li> </ul>"},{"location":"cloud-native/k3s/nfs-dynamic-pvc/#nfs","title":"\u642d\u5efa NFS \u670d\u52a1\u5668","text":"<ol> <li> <p>\u5b89\u88c5</p> <pre><code>apt install -y nfs-kernel-server\n</code></pre> </li> <li> <p>\u521b\u5efa\u5171\u4eab\u76ee\u5f55</p> <pre><code>mkdir -p /d/nfs\n</code></pre> </li> <li> <p>\u5bfc\u51fa</p> <pre><code>echo '/d/nfs *(rw,sync,no_root_squash)' &gt;&gt; /etc/exports\n\nexportfs -r\n</code></pre> </li> </ol>"},{"location":"cloud-native/k3s/nfs-dynamic-pvc/#nfs-storageclass","title":"\u521b\u5efa NFS StorageClass","text":"<ol> <li> <p>\u514b\u9686 NFS Provisioner \u9879\u76ee</p> <pre><code>git clone https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner.git\n</code></pre> </li> <li> <p>\u4e0b\u8f7d\u8d44\u6e90\u6587\u4ef6</p> <pre><code>wget -O nfs-client-provisioner-rbac.yaml   https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/rbac.yaml\n\nwget -O nfs-client-provisioner-deploy.yaml https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/deployment.yaml\n\nwget -O nfs-client-sc.yaml                 https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/class.yaml\n</code></pre> </li> <li> <p>\u6279\u91cf\u66ff\u6362 Namespace</p> <pre><code>NAMESPACE=local\n\nsed -i'' \"s/namespace:.*/namespace: $NAMESPACE/g\" nfs-client-provisioner-deploy.yaml nfs-client-provisioner-rbac.yaml\n</code></pre> </li> <li> <p>\u4fee\u6539 Deployment \u914d\u7f6e</p> <ul> <li>\u955c\u50cf <code>registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0</code></li> <li>NFS \u4e3b\u673a <code>192.192.192.6</code></li> <li>NFS \u76ee\u5f55 <code>/d/nfs</code></li> </ul> </li> <li> <p>\u521b\u5efa\u8d44\u6e90</p> <pre><code>kubectl create -f nfs-client-provisioner-rbac.yaml\n\nkubectl create -f nfs-client-provisioner-deploy.yaml\n\nkubectl create -f nfs-client-sc.yaml\n</code></pre> </li> </ol>"},{"location":"cloud-native/k3s/nfs-dynamic-pvc/#statefulset","title":"\u521b\u5efa StatefulSet","text":"<ul> <li> <p><code>mysql-sts.yaml</code></p> <pre><code>apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  namespace: local\n  name: mysql-sts\n  labels:\n    app: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  serviceName: mysql\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n        - name: mysql\n          image: mysql:8.0.20\n          args:\n            - --lower-case-table-names=1\n            - --default-authentication-plugin=mysql_native_password\n            - --default-time-zone=+8:00\n          env:\n            - name: MYSQL_ROOT_PASSWORD\n              value: root\n          ports:\n            - containerPort: 3306\n          volumeMounts:\n            - mountPath: /var/lib/mysql\n              name: data\n  volumeClaimTemplates:\n    - metadata:\n        name: data\n      spec:\n        storageClassName: nfs-client\n        accessModes:\n          - ReadWriteOnce\n        resources:\n          requests:\n            storage: 1Gi\n</code></pre> </li> <li> <p><code>mysql-svc.yaml</code></p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  namespace: local\n  name: mysql-svc\n  labels:\n    app: mysql\nspec:\n  type: ClusterIP\n  clusterIP: None\n  selector:\n    app: mysql\n  ports:\n    - port: 3306\n</code></pre> </li> </ul>"},{"location":"cloud-native/k3s/nfs-dynamic-pvc/#_2","title":"\u68c0\u67e5","text":"<pre><code>kubectl get all -n local -o wide\n\nkubectl get pvc -n local -o wide\n\nkubectl get pv -o wide\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/","title":"\u79bb\u7ebf\u5b89\u88c5 K3S","text":""},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#_1","title":"\u4e00\u3001\u524d\u8a00","text":"<p>\u7b80\u8981\u8bb0\u5f55\u4e00\u4e0b\u79bb\u7ebf\u73af\u5883\u4e0b K3S \u7684\u642d\u5efa\uff0c\u7248\u672c\u4e3a <code>v1.23.17+k3s1</code>\uff0c\u4f7f\u7528\u5916\u90e8\u6570\u636e\u5e93 MySQL \u4f5c\u5143\u6570\u636e\u5b58\u50a8\uff0c\u7981\u7528\u9ed8\u8ba4\u7ec4\u4ef6\uff08<code>coredns</code>\u3001<code>servicelb</code>\u3001<code>traefik</code>\u3001<code>local-storage</code>\u3001<code>metrics-server</code>\uff09\u5e76\u4f7f\u7528 Helm \u5355\u72ec\u5b89\u88c5\uff08<code>coredns</code>\u3001<code>metrics-server</code>\u3001<code>traefik</code>\u3001<code>longhorn</code>\uff09\u3002</p> <p>\u9700\u8981\u4e00\u53f0\u8054\u7f51\u4e3b\u673a\uff08\u865a\u62df\u673a\uff09\uff0c\u548c\u591a\u53f0\u672a\u8054\u7f51\u4e3b\u673a\uff08\u670d\u52a1\u5668\uff09\u3002</p>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#_2","title":"\u4e8c\u3001\u8054\u7f51\u865a\u62df\u673a","text":""},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#21","title":"2.1 \u5feb\u901f\u5f15\u5bfc\u4e00\u4e2a\u5355\u8282\u70b9\u96c6\u7fa4","text":"<pre><code>curl -fsSL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.23.17+k3s1 bash -s - server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#22-longhorn","title":"2.2 \u5feb\u901f\u5b89\u88c5 Longhorn \u7684\u4f9d\u8d56","text":"<p>Installation Requirements</p> <pre><code># yum\nyum install iscsi-initiator-utils nfs-utils\n\n# ubuntu\napt install open-iscsi nfs-common\n\n# \u542f\u52a8\nsystemctl enable iscsid --now\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#23-helm-controller","title":"2.3 \u5feb\u901f\u5b89\u88c5\u5e94\u7528\uff08\u901a\u8fc7 Helm Controller\uff09","text":"<pre><code>### coredns\n---\napiVersion: helm.cattle.io/v1\nkind: HelmChart\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n    app: coredns\nspec:\n  repo: https://coredns.github.io/helm\n  chart: coredns\n  version: 1.29.0\n  targetNamespace: kube-system\n  bootstrap: true\n  valuesContent: |-\n    fullnameOverride: coredns\n    serviceType: ClusterIP\n    prometheus:\n      service:\n        enabled: true\n    service:\n      name: coredns\n      clusterIP: 10.16.0.10\n    servers:\n      - zones:\n          - zone: .\n        port: 53\n        plugins:\n          - name: errors\n          - name: health\n            configBlock: |-\n              lameduck 5s\n          - name: ready\n          - name: kubernetes\n            parameters: cluster.local in-addr.arpa ip6.arpa\n            configBlock: |-\n              pods insecure\n              fallthrough in-addr.arpa ip6.arpa\n              ttl 30\n          - name: prometheus\n            parameters: 0.0.0.0:9153\n          - name: forward\n            parameters: . /etc/resolv.conf\n          - name: cache\n            parameters: 30\n          - name: loop\n          - name: reload\n          - name: loadbalance\n\n\n###  metrics-server\n---\napiVersion: helm.cattle.io/v1\nkind: HelmChart\nmetadata:\n  name: metrics-server\n  namespace: kube-system\n  labels:\n    app: metrics-server\nspec:\n  repo: https://charts.bitnami.com/bitnami\n  chart: metrics-server\n  version: 6.8.0\n  targetNamespace: kube-system\n  bootstrap: true\n  valuesContent: |\n    apiService:\n      create: true\n    extraArgs:\n      - --kubelet-insecure-tls\n      - --kubelet-use-node-status-port\n      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n      - --metric-resolution=15s\n\n\n### traefik\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: traefik-system\n\n---\napiVersion: helm.cattle.io/v1\nkind: HelmChart\nmetadata:\n  name: traefik\n  namespace: traefik-system\n  labels:\n    app: traefik\nspec:\n  repo: https://traefik.github.io/charts\n  chart: traefik\n  version: 26.0.0\n  targetNamespace: traefik-system\n  bootstrap: true\n  valuesContent: |-\n    deployment:\n      kind: Deployment\n    ingressClass:\n      enabled: true\n      isDefaultClass: true\n    providers:\n      kubernetesCRD:\n        enabled: true\n        allowCrossNamespace: true\n        allowExternalNameServices: true\n        allowEmptyServices: true\n      kubernetesIngress:\n        enabled: true\n        allowExternalNameServices: true\n        allowEmptyServices: true\n        publishedService:\n          enabled: true\n    ports:\n      traefik:\n        port: 9000\n        protocol: TCP\n        expose: false\n        exposedPort: 9000\n      metrics:\n        port: 9100\n        protocol: TCP\n        expose: false\n        exposedPort: 9100\n      web:\n        port: 80\n        protocol: TCP\n        expose: true\n        exposedPort: 80\n        nodePort: 30080\n      websecure:\n        port: 443\n        protocol: TCP\n        expose: true\n        exposedPort: 443\n        ndoePort: 30443\n        tls:\n          enabled: true\n    service:\n      type: NodePort\n    securityContext:\n      capabilities:\n        drop: []\n        add: [NET_BIND_SERVICE]\n      readOnlyRootFilesystem: false\n    podSecurityContext:\n      runAsGroup: 0\n      runAsNonRoot: false\n      runAsUser: 0\n\n\n### longhorn\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: longhorn-system\n\n---\napiVersion: helm.cattle.io/v1\nkind: HelmChart\nmetadata:\n  name: longhorn\n  namespace: longhorn-system\n  labels:\n    app: longhorn\nspec:\n  repo: https://charts.longhorn.io\n  chart: longhorn\n  version: 1.5.3\n  targetNamespace: longhorn-system\n  bootstrap: true\n  valuesContent: |-\n    persistence:\n      defaultClassReplicaCount: 1\n    csi:\n      attacherReplicaCount: 1\n      provisionerReplicaCount: 1\n      resizerReplicaCount: 1\n      snapshotterReplicaCount: 1\n    defaultSettings:\n      defaultDataPath: /data/longhorn\n      defaultReplicaCount: 1\n      deletingConfirmationFlag: true\n    longhornUI:\n      replicas: 1\n    ingress:\n      enabled: true\n      host: longhorn.example.org\n</code></pre> <pre><code>kubectl apply -f charts.yaml\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#_3","title":"\u4e09\u3001\u8d44\u6e90\u51c6\u5907","text":""},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#31-longhorn","title":"3.1 \u4e0b\u8f7d Longhorn \u4f9d\u8d56","text":"<ol> <li> <p>\u67e5\u770b\u670d\u52a1\u5668 glibc \u7248\u672c</p> <pre><code>ldd --version\n</code></pre> os os version glibc version centos 7.9 2.17 centos 8.4 2.28 ubuntu 18.04 2.27 ubuntu 20.04 2.31 ubuntu 22.04 2.35 </li> <li> <p>\u521b\u5efa\u5bf9\u5e94 glibc \u7248\u672c\u7684\u5bb9\u5668</p> <pre><code># centos 7\nkubectl run centos --image=centos:7.9.2009 --command -- /bin/sleep infinity\nkubectl exec -it pod/centos -- /bin/bash\n\n# ubuntu 22\nkubectl run ubuntu --image=ubuntu:22.04 --command -- /bin/sleep infinity\nkubectl exec -it pod/ubuntu -- /bin/bash\n</code></pre> </li> <li> <p>\u4e0b\u8f7d\u4f9d\u8d56</p> <pre><code># yum\nyum install iscsi-initiator-utils nfs-utils --downloadonly --downloaddir=rpm -y\ntar -czvf ./rpm.tar.gz ./rpm\n\n# apt\napt update &amp;&amp; apt install open-iscsi nfs-common --download-only -y &amp;&amp; mkdir -p deb &amp;&amp; cp /var/cache/apt/archives/*.deb deb\ntar -czvf ./deb.tar.gz ./deb\n</code></pre> </li> <li> <p>\u590d\u5236\u51fa\u4f9d\u8d56</p> <pre><code># yum\nkubectl cp centos:/rpm.tar.gz ./rpm.tar.gz\n\n# apt\nkubectl cp ubuntu:/deb.tar.gz ./deb.tar.gz\n</code></pre> </li> </ol>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#32-k3s","title":"3.2 \u4e0b\u8f7d K3S \u8d44\u6e90","text":"<p>\u53c2\u8003\u6587\u6863\uff1a\u79bb\u7ebf\u5b89\u88c5</p> <pre><code>wget https://github.com/k3s-io/k3s/releases/download/v1.23.17+k3s1/k3s-airgap-images-amd64.tar.gz\nwget https://github.com/k3s-io/k3s/releases/download/v1.23.17+k3s1/k3s\nwget https://get.helm.sh/helm-v3.12.2-linux-amd64.tar.gz\nwget https://get.k3s.io -O install.sh\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#33-helmchart","title":"3.3 \u4e0b\u8f7d HelmChart \u548c\u5bfc\u51fa\u955c\u50cf","text":"<pre><code># \u4e0b\u8f7d helm chart \u5305\nhelm repo add coredns  https://coredns.github.io/helm     &amp;&amp; helm pull coredns/coredns        --version 1.29.0\nhelm repo add bitnami  https://charts.bitnami.com/bitnami &amp;&amp; helm pull bitnami/metrics-server --version 6.8.0\nhelm repo add traefik  https://traefik.github.io/charts   &amp;&amp; helm pull traefik/traefik        --version 26.0.0\nhelm repo add longhorn https://charts.longhorn.io         &amp;&amp; helm pull longhorn/longhorn      --version 1.5.3\n\n# \u5bfc\u51fa\u955c\u50cf\nk3s ctr image ls -q | grep -v 'sha256' | sort -u | xargs k3s ctr image export image.tar\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#_4","title":"\u56db\u3001\u672a\u8054\u7f51\u670d\u52a1\u5668","text":""},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#41-k3s","title":"4.1 \u51c6\u5907 K3S \u8d44\u6e90","text":"<pre><code># \u51c6\u5907 k3s \u955c\u50cf\nmkdir -p /data/k3s/var/lib/rancher/k3s/agent/images\ncp ./k3s-airgap-images-amd64.tar.gz /data/k3s/var/lib/rancher/k3s/agent/images\n\n# \u51c6\u5907 k3s \u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\ninstall ./k3s /usr/local/bin\n\n# \u51c6\u5907 helm \u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\ntar -zxvf ./helm-v3.12.2-linux-amd64.tar.gz\ninstall ./linux-amd64/helm /usr/local/bin\n\n# \u51c6\u5907 k3s \u5b89\u88c5\u811a\u672c\nchmod +x ./install.sh\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#42-server","title":"4.2 \u542f\u52a8 Server \u8282\u70b9","text":"<pre><code># \u5f15\u5bfc Server\nINSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.23.17+k3s1 ./install.sh server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --datastore-endpoint \"mysql://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@tcp(&lt;HOST&gt;:&lt;PORT&gt;)/&lt;DATABASE&gt;\"\n\n# \u67e5\u770b Token\ncat /data/k3s/var/lib/rancher/k3s/server/token\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#43-server","title":"4.3 \u52a0\u5165\u5176\u5b83 Server \u8282\u70b9","text":"<p>\u914d\u7f6e\u6807\u8bc6\u5728\u6240\u6709 Server \u8282\u70b9\u5fc5\u987b\u662f\u76f8\u540c\u7684\u3002</p> <pre><code>INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.23.17+k3s1 ./install.sh server \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --cluster-cidr 10.8.0.0/16 \\\n    --service-cidr 10.16.0.0/16 \\\n    --cluster-dns 10.16.0.10 \\\n    --service-node-port-range 1-65535 \\\n    --kube-proxy-arg proxy-mode=ipvs \\\n    --disable coredns \\\n    --disable servicelb \\\n    --disable traefik \\\n    --disable local-storage \\\n    --disable metrics-server \\\n    --datastore-endpoint \"mysql://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@tcp(&lt;HOST&gt;:&lt;PORT&gt;)/&lt;DATABASE&gt;\" \\\n    --token &lt;TOKEN&gt;\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#44-agent","title":"4.4 \u52a0\u5165 Agent \u8282\u70b9","text":"<pre><code>INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.23.17+k3s1 ./install.sh agent \\\n    --data-dir /data/k3s/var/lib/rancher/k3s \\\n    --server \"https://&lt;HOST&gt;:6443\" \\\n    --token &lt;TOKEN&gt;\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#45-longhorn","title":"4.5 \u5b89\u88c5 Longhorn \u4f9d\u8d56","text":"<pre><code># yum\ntar -zxvf rpm.tar.gz\nrpm -ivh ./rpm/*.rpm\n\n# apt\ntar -zxvf deb.tar.gz\napt install ./deb/*.deb\n</code></pre>"},{"location":"cloud-native/k3s/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%20K3S/#44","title":"4.4 \u5bfc\u5165\u955c\u50cf\u548c\u5b89\u88c5\u5e94\u7528","text":"<pre><code># \u5bfc\u51fa\u955c\u50cf\nk3s ctr image import ./image.tar\n\n# coredns\nhelm install coredns coredns-1.29.0.tgz --namespace kube-system --values &lt;VALUES_YAML_FILE&gt;\n</code></pre>"},{"location":"cloud-native/knative/","title":"Knative","text":""},{"location":"cloud-native/knative/#_1","title":"\u4e00\u3001\u5feb\u901f\u5f00\u59cb","text":""},{"location":"cloud-native/knative/#11-function","title":"1.1 Function","text":"<pre><code># \u521b\u5efa\u51fd\u6570\nfunc create f1 --language=typescript --template=http\n\ncd f1\n\n# \u6784\u5efa\u51fd\u6570\nfunc build --builder=s2i --image=ghcr.io/icefery/f1:0.0.1 --platform=linux/arm64\n\n# \u6d4b\u8bd5\u51fd\u6570\nfunc run\n\n# \u90e8\u7f72\u51fd\u6570\nfunc deploy\n\n# \u8c03\u7528\u51fd\u6570\nfunc invoke\n\n# \u67e5\u770b\u51fd\u6570\nfunc list\n</code></pre>"},{"location":"cloud-native/knative/#12-serving","title":"1.2 Serving","text":""},{"location":"cloud-native/knative/#13-eventing","title":"1.3 Eventing","text":""},{"location":"cloud-native/kubekey/","title":"KubeKey","text":""},{"location":"cloud-native/kubernetes/","title":"Kubernetes","text":""},{"location":"cloud-native/kubernetes/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"cloud-native/kubernetes/#01-nodes-are-available-1-nodes-had-taint-node-rolekubernetesiomaster-that-the-pod-didnt-tolerate","title":"0/1 nodes are available: 1 node(s) had taint {node-role.kubernetes.io/master: }, that the pod didn't tolerate.","text":"<pre><code>kubectl taint nodes --all node-role.kubernetes.io/master-\n</code></pre>"},{"location":"cloud-native/kubernetes/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"cloud-native/kubernetes/#completed-pod","title":"\u6e05\u7406 <code>Completed</code> \u72b6\u6001\u7684 Pod","text":"<pre><code>kubectl get pod --field-selector=status.phase==Succeeded\n\n\nkubectl delete pod --field-selector=status.phase==Succeeded\n</code></pre>"},{"location":"cloud-native/kubernetes/#replicaset","title":"\u5220\u9664\u4e0d\u7528\u7684 ReplicaSet","text":"<pre><code>NAMESPACE=test\nkubectl get replicaset.apps -A | grep \"0         0         0\" | awk '{print $2}' | xargs kubectl delete replicaset.apps -n ${NAMESPACE}\n</code></pre>"},{"location":"cloud-native/kubernetes/#_3","title":"\u65e0\u6cd5\u5220\u9664\u547d\u540d\u7a7a\u95f4","text":"<pre><code># \u4ee3\u7406\u63a5\u53e3\nkubectl proxy --port=8081\n\nNS=longhorn-system\n# \u5bfc\u51fa\u8d44\u6e90\u6587\u4ef6\nkubectl get namespaces ${NS} -o json &gt; ${NS}.json\n# \u8c03\u7528\u63a5\u53e3\ncurl -k -H \"Content-Type:application/json\" -X PUT --data-binary @${NS}.json http://127.0.0.1:8081/api/v1/namespaces/${NS}/finalize\n</code></pre>"},{"location":"cloud-native/kubernetes/#_4","title":"\u67e5\u770b\u67d0\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u6240\u6709\u955c\u50cf","text":"<pre><code>kubectl get pods -n harbor -o=jsonpath='{range .items[*]}{range .spec.containers[*]}{.image}{\"\\n\"}{end}{end}'\n</code></pre>"},{"location":"cloud-native/kubernetes/#_5","title":"\u6536\u85cf","text":""},{"location":"cloud-native/kubernetes/#pod-service-account","title":"\u4e3a pod \u914d\u7f6e\u670d\u52a1\u8d26\u6237(Service Account)","text":""},{"location":"cloud-native/kubernetes/K8S%20%E4%BF%AE%E6%94%B9%20NodePort%20%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4/","title":"K8S \u4fee\u6539 NodePort \u7aef\u53e3\u8303\u56f4","text":"<p>\u9ed8\u8ba4\u7aef\u53e3\u8303\u56f4\u662f <code>30000-32767</code></p> <pre><code>vim /etc/kubernetes/manifests/kube-apiserver.yaml\n</code></pre> <pre><code>--service-node-port-range=1-65535\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/","title":"Kubernetes \u7b14\u8bb0","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#pod","title":"\u4e00\u3001Pod","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-pod","title":"1 Pod \u6982\u8ff0","text":"<p>Pod \u662f K8S \u7cfb\u7edf\u4e2d\u53ef\u4ee5\u521b\u5efa\u548c\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u662f\u8d44\u6e90\u5bf9\u8c61\u6a21\u578b\u4e2d\u6700\u5c0f\u8d44\u6e90\u5bf9\u8c61\u6a21\u578b\uff0c\u4e5f\u662f\u5728 K8S \u4e0a\u8fd0\u884c\u5bb9\u5668\u5316\u5e94\u7528\u7684\u8d44\u6e90\u5bf9\u8c61\uff0c\u5176\u5b83\u7684\u8d44\u6e90\u5bf9\u8c61\u90fd\u662f\u7528\u6765\u652f\u6491\u6216\u8005\u6269\u5c55 Pod \u5bf9\u8c61\u529f\u80fd\u7684\uff0c\u6bd4\u5982\u63a7\u5236\u5668\u5bf9\u8c61\u662f\u7528\u6765\u7ba1\u63a7 Pod \u5bf9\u8c61\u7684\uff0cService \u6216\u8005 Ingress \u8d44\u6e90\u5bf9\u8c61\u662f\u7528\u6765\u66b4\u9732 Pod \u5f15\u7528\u5bf9\u8c61\u7684\uff0cPersistentVolume \u8d44\u6e90\u5bf9\u8c61\u662f\u7528\u6765\u4e3a Pod \u63d0\u4f9b\u5b58\u50a8\u7b49\u7b49\uff0cK8S \u4e0d\u4f1a\u76f4\u63a5\u5904\u7406\u5bb9\u5668\uff0c\u800c\u662f Pod\uff0cPod \u662f\u7531\u4e00\u4e2a\u6216\u591a\u4e2a Container \u7ec4\u6210\u7684\u3002</p> <p>Pod \u662f Kubernetes \u7684\u6700\u91cd\u8981\u6982\u5ff5\uff0c\u6bcf\u4e00\u4e2a Pod \u90fd\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u88ab\u79f0\u4e3a \"\u6839\u5bb9\u5668\" \u7684 Pause \u5bb9\u5668\u3002Pause \u5bb9\u5668\u5bf9\u5e94\u7684\u955c\u50cf\u5c5e\u4e8e Kubernetes \u5e73\u53f0\u7684\u4e00\u90e8\u5206\uff0c\u9664\u4e86 Pause \u5bb9\u5668\uff0c\u6bcf\u4e2a Pod \u8fd8\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u7d27\u5bc6\u76f8\u5173\u7684\u7528\u6237\u4e1a\u52a1\u5bb9\u5668\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#11-pod","title":"1.1 Pod \u548c\u5e94\u7528\u7684\u5173\u7cfb","text":"<p>\u6bcf\u4e2a Pod \u90fd\u662f\u5e94\u7528\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u6709\u4e13\u6709\u7684 IP\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#12-pod","title":"1.2 Pod \u548c\u5bb9\u5668\u7684\u5173\u7cfb","text":"<p>\u4e00\u4e2a Pod \u53ef\u4ee5\u6709\u591a\u4e2a\u5bb9\u5668\uff0c\u5f7c\u6b64\u95f4\u5171\u4eab\u7f51\u7edc\u548c\u5b58\u50a8\u8d44\u6e90\uff0c\u6bcf\u4e2a Pod \u4e2d\u6709\u4e00\u4e2a Pause \u5bb9\u5668\u4fdd\u5b58\u6240\u6709\u7684\u5bb9\u5668\u72b6\u6001\uff0c\u901a\u8fc7\u7ba1\u7406 Pause \u5bb9\u5668\uff0c\u8fbe\u5230\u7ba1\u7406 Pod \u4e2d\u6240\u6709\u5bb9\u5668\u7684\u6548\u679c\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#13-pod","title":"1.3 Pod \u548c\u8282\u70b9\u7684\u5173\u7cfb","text":"<p>\u540c\u4e00\u4e2a Pod \u4e2d\u7684\u5bb9\u5668\u603b\u4f1a\u88ab\u8c03\u5ea6\u5230\u76f8\u540c\u8282\u70b9\uff0c\u4e0d\u540c\u8282\u70b9\u95f4 Pod \u7684\u901a\u4fe1\u57fa\u4e8e\u865a\u62df\u4e8c\u5c42\u7f51\u7edc\u6280\u672f\u5b9e\u73b0\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-pod","title":"2 Pod \u7279\u6027","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#21","title":"2.1 \u8d44\u6e90\u5171\u4eab","text":"<p>\u4e00\u4e2a Pod \u91cc\u7684\u591a\u4e2a\u5bb9\u5668\u53ef\u4ee5\u5171\u4eab\u5b58\u50a8\u548c\u7f51\u7edc\uff0c\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a\u903b\u8f91\u7684\u4e3b\u673a\u3002\u5171\u4eab\u7684\u5982 Namespace\u3001Cgroups \u6216\u8005\u5176\u5b83\u7684\u9694\u79bb\u8d44\u6e90\u3002</p> <p>\u591a\u4e2a\u5bb9\u5668\u5171\u4eab\u540c\u4e00 Network Namespace\uff0c\u7531\u6b64\u5728\u4e00\u4e2a Pod \u91cc\u7684\u591a\u4e2a\u5bb9\u5668\u5171\u4eab Pod \u7684 IP \u548c\u7aef\u53e3 Namespace\uff0c\u6240\u4ee5\u4e00\u4e2a Pod \u5185\u7684\u591a\u4e2a\u5bb9\u5668\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7 localhost \u6765\u8fdb\u884c\u901a\u4fe1\uff0c\u6240\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e0d\u540c\u5bb9\u5668\u8981\u6ce8\u610f\u4e0d\u8981\u6709\u7aef\u53e3\u51b2\u7a81\u5373\u53ef\u3002\u4e0d\u540c\u7684 Pod \u6709\u4e0d\u540c\u7684 IP\uff0c\u4e0d\u540c Pod \u5185\u7684\u591a\u4e2a\u5bb9\u5668\u4e4b\u95f4\u901a\u4fe1\uff0c\u4e0d\u53ef\u4ee5\u4f7f\u7528 IPC\uff08\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u6307\u5b9a\u7684\u8bdd\uff09\u901a\u4fe1\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u4f7f\u7528 Pod \u7684 IP \u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u4e00\u4e2a Pod \u91cc\u7684\u591a\u4e2a\u5bb9\u5668\u53ef\u4ee5\u5171\u4eab\u5b58\u50a8\u5377\uff0c\u8fd9\u4e2a\u5b58\u50a8\u5377\u4f1a\u88ab\u5b9a\u4e49\u4e3a Pod \u7684\u4e00\u90e8\u5206\uff0c\u5e76\u4e14\u53ef\u4ee5\u6302\u8f7d\u5230\u8be5 Pod \u91cc\u7684\u6240\u6709\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#22","title":"2.2 \u751f\u547d\u5468\u671f\u77ed\u6682","text":"<p>Pod \u5c5e\u4e8e\u751f\u547d\u5468\u671f\u6bd4\u8f83\u77ed\u6682\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982\uff0c\u5f53 Pod \u6240\u5728\u8282\u70b9\u53d1\u751f\u6545\u969c\uff0c\u90a3\u4e48\u8be5\u8282\u70b9\u4e0a\u7684 Pod \u4f1a\u88ab\u8c03\u5ea6\u5230\u5176\u5b83\u8282\u70b9\u4e0a\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u88ab\u91cd\u65b0\u8c03\u5ea6\u7684 Pod \u662f\u4e00\u4e2a\u5168\u65b0\u7684 Pod\uff0c\u8ddf\u4e4b\u524d\u7684 Pod \u6ca1\u6709\u534a\u6bdb\u94b1\u5173\u7cfb\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#23","title":"2.3 \u5e73\u5766\u7684\u7f51\u7edc","text":"<p>K8S \u96c6\u7fa4\u7684\u6240\u6709 Pod \u90fd\u5728\u540c\u4e00\u4e2a\u5171\u4eab\u7f51\u7edc\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e2a Pod \u90fd\u53ef\u4ee5\u901a\u8fc7\u5176\u5b83 Pod \u7684 IP \u5730\u5740\u6765\u5b9e\u73b0\u8bbf\u95ee\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-pod","title":"3 Pod \u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5","text":"<p>\u5728 Kubernetes \u4e2d\u5bf9\u8fd0\u884c\u5bb9\u5668\u7684\u8981\u6c42\uff1a\u5bb9\u5668\u7684\u4e3b\u7a0b\u5e8f\u9700\u8981\u4e00\u76f4\u5728\u524d\u53f0\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u5728\u540e\u53f0\u8fd0\u884c\u3002\u5982\u679c\u6211\u4eec\u521b\u5efa\u7684 Docker \u955c\u50cf\u7684\u542f\u52a8\u547d\u4ee4\u662f\u540e\u53f0\u6267\u884c\u7a0b\u5e8f\uff0c\u5219\u5728 kubelet \u521b\u5efa\u5305\u542b\u8fd9\u4e2a\u5bb9\u5668\u7684 Pod \u4e4b\u540e\u8fd0\u884c\u5b8c\u8be5\u547d\u4ee4\uff0c\u5373\u8ba4\u4e3a Pod \u5df2\u7ecf\u7ed3\u675f\uff0c\u5c06\u7acb\u5373\u9500\u6bc1\u8be5 Pod\u3002\u5982\u679c\u4e3a\u8be5 Pod \u5b9a\u4e49\u4e86 RC\uff0c\u5219\u521b\u5efa\u3001\u9500\u6bc1\u4f1a\u9677\u5165\u4e00\u4e2a\u65e0\u9650\u5faa\u73af\u7684\u8fc7\u7a0b\u4e2d\u3002Pod \u53ef\u4ee5\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u5bb9\u5668\u7ec4\u5408\u800c\u6210\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4-pod","title":"4 Pod \u7684\u5206\u7c7b","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#41-pod","title":"4.1 \u666e\u901a Pod","text":"<p>\u666e\u901a Pod \u4e00\u65e6\u88ab\u521b\u5efa\uff0c\u5c31\u4f1a\u88ab\u653e\u5165\u5230 Etcd \u4e2d\u5b58\u50a8\uff0c\u968f\u540e\u4f1a\u88ab Kubernetes Master \u8c03\u5ea6\u5230\u67d0\u4e2a\u5177\u4f53\u7684 Node \u4e0a\u5e76\u8fdb\u884c\u7ed1\u5b9a\uff0c\u968f\u540e\u8be5 Pod \u5bf9\u5e94\u7684 Node \u4e0a\u7684 kubelet \u8fdb\u7a0b\u5b9e\u4f8b\u5316\u6210\u4e00\u7ec4\u76f8\u5173\u7684 Docker \u5bb9\u5668\u5e76\u542f\u52a8\u8d77\u6765\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53 Pod \u91cc\u67d0\u4e2a\u5bb9\u5668\u505c\u6b62\u65f6\uff0cKubernetes \u4f1a\u81ea\u52a8\u68c0\u6d4b\u5230\u8fd9\u4e2a\u95ee\u9898\u5e76\u4e14\u91cd\u65b0\u542f\u52a8\u8fd9\u4e2a Pod \u91cc\u7684\u6240\u6709\u5bb9\u5668\uff0c\u5982\u679c Pod \u6240\u5728\u7684 Node \u5b95\u673a\uff0c\u5219\u4f1a\u5c06\u8fd9\u4e2a Node \u4e0a\u6240\u6709 Pod \u91cd\u65b0\u8c03\u5ea6\u5230\u5176\u5b83\u8282\u70b9\u4e0a\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#42-pod","title":"4.2 \u9759\u6001 Pod","text":"<p>\u9759\u6001 Pod \u662f\u7531 kubelet \u8fdb\u884c\u7ba1\u7406\u7684\u4ec5\u5b58\u5728\u4e8e\u7279\u5b9a Node \u4e0a\u7684 Pod\uff0c\u5b83\u4eec\u4e0d\u80fd\u901a\u8fc7 API Server \u8fdb\u884c\u7ba1\u7406\uff0c\u65e0\u6cd5\u4e0e ReplicationController\u3001Deployment \u6216 DaemonSet \u8fdb\u884c\u5173\u8054\uff0c\u5e76\u4e14 kubelet \u4e5f\u65e0\u6cd5\u5bf9\u5b83\u4eec\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#5-pod","title":"5 Pod \u7684\u751f\u547d\u5468\u671f\u548c\u91cd\u542f\u7b56\u7565","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#51-pod","title":"5.1 Pod \u7684\u72b6\u6001","text":"\u72b6\u6001 \u8bf4\u660e Pending API Server \u5df2\u7ecf\u521b\u5efa\u4e86\u8be5 Pod\uff0c\u4f46 Pod \u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5bb9\u5668\u7684\u955c\u50cf\u8fd8\u6ca1\u6709\u521b\u5efa\uff0c\u5305\u62ec\u955c\u50cf\u4e0b\u8f7d\u8fc7\u7a0b\u3002 Running Pod \u5185\u6240\u6709\u5bb9\u5668\u5df2\u7ecf\u521b\u5efa\uff0c\u4e14\u81f3\u5c11\u4e00\u4e2a\u5bb9\u5668\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u3001\u6b63\u5728\u542f\u52a8\u72b6\u6001\u6216\u6b63\u5728\u91cd\u542f\u72b6\u6001\u3002 Completed Pod \u5185\u6240\u6709\u5bb9\u5668\u5747\u6210\u529f\u6267\u884c\u9000\u51fa\uff0c\u4e14\u4e0d\u4f1a\u518d\u91cd\u542f\u3002 Failed Pod \u5185\u6240\u6709\u5bb9\u5668\u5747\u5df2\u9000\u51fa\uff0c\u4f46\u81f3\u5c11\u6709\u4e00\u4e2a\u5bb9\u5668\u9000\u51fa\u5931\u8d25\u3002 Unkown \u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u65e0\u6cd5\u83b7\u53d6 Pod \u72b6\u6001\uff0c\u4f8b\u5982\u7f51\u7edc\u901a\u4fe1\u4e0d\u7545\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#52-pod","title":"5.2 Pod \u7684\u91cd\u542f\u7b56\u7565","text":"\u91cd\u542f\u72b6\u6001 \u8bf4\u660e Always \u5f53\u5bb9\u5668\u5931\u6548\u65f6\uff0c\u7531 kubelet \u81ea\u52a8\u91cd\u542f\u8be5\u5bb9\u5668\u3002\u9ed8\u8ba4\u503c\u3002 OnFailure \u5f53\u5bb9\u5668\u7ec8\u6b62\u8fd0\u884c\u4e14\u9000\u51fa\u7801\u4e0d\u4e3a 0 \u65f6\uff0c\u7531 kubelet \u81ea\u52a8\u91cd\u542f\u8be5\u5bb9\u5668\u3002 Never \u65e0\u8bba\u5bb9\u5668\u8fd0\u884c\u72b6\u6001\u5982\u4f55\uff0ckubelet \u90fd\u4e0d\u4f1a\u91cd\u542f\u8be5\u5bb9\u5668\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#53","title":"5.3 \u5e38\u89c1\u72b6\u6001\u8f6c\u6362","text":"\u5bb9\u5668\u6570 \u5f53\u524d\u72b6\u6001 \u53d1\u751f\u4e8b\u4ef6 \u7ed3\u679c\u72b6\u6001\uff08restartPolicy=Always\uff09 \u7ed3\u679c\u72b6\u6001\uff08restartPolicy=OnFailure\uff09 \u7ed3\u679c\u72b6\u6001\uff08restartPolicy=Never\uff09 1 Running \u5bb9\u5668\u6210\u529f\u9000\u51fa Running Succeeded Succeeded 1 Running \u5bb9\u5668\u5931\u8d25\u9000\u51fa Running Running Failure 2 Runing \u4e00\u4e2a\u5bb9\u5668\u5931\u8d25\u9000\u51fa Running Running Running 2 Running \u5bb9\u5668\u88ab OOM \u6740\u6389 Running Running Failure"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#54-pod","title":"5.4 Pod \u7684\u8d44\u6e90\u914d\u7f6e","text":"<p>\u6bcf\u4e2a Pod \u90fd\u53ef\u4ee5\u5bf9\u5176\u80fd\u4f7f\u7528\u7684\u670d\u52a1\u5668\u4e0a\u7684\u8ba1\u7b97\u8d44\u6e90\u8bbe\u7f6e\u9650\u989d\uff0cKubnernetes \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u9650\u989d\u7684\u8ba1\u7b97\u8d44\u6e90\u6709 CPU \u4e0e Memory \u4e24\u79cd\uff0c\u5176\u4e2d CPU \u7684\u8d44\u6e90\u5355\u4f4d\u4e3a CPU \u6570\u91cf\uff08\u6beb\u6838\uff09\uff0c\u662f\u4e00\u79cd\u7edd\u5bf9\u503c\u800c\u975e\u76f8\u5bf9\u503c\u3002Memory \u914d\u989d\u4e5f\u662f\u4e00\u4e2a\u7edd\u5bf9\u503c\uff0c\u5b83\u7684\u5355\u4f4d\u662f\u5185\u5b58\u5b57\u8282\u6570\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#label","title":"\u4e8c\u3001Label","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-label","title":"1 Label \u6982\u8ff0","text":"<p>Label \u662f Kubernetes \u7cfb\u7edf\u4e2d\u53e6\u4e00\u4e2a\u6838\u5fc3\u6982\u5ff5\u3002\u4e00\u4e2a Label \u662f\u4e00\u4e2a key=value \u7684\u952e\u503c\u5bf9\uff0c\u5176\u4e2d key \u4e0e value \u7531\u7528\u6237\u81ea\u5df1\u6307\u5b9a\u3002Label \u53ef\u4ee5\u9644\u52a0\u5230\u5404\u79cd\u8d44\u6e90\u5bf9\u8c61\u4e0a\uff0c\u5982 Node\u3001Pod\u3001Service\u3001RC\uff0c\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u6570\u91cf\u7684 Label\uff0c\u540c\u4e00\u4e2a Label \u4e5f\u53ef\u4ee5\u88ab\u6dfb\u52a0\u5230\u4efb\u610f\u6570\u91cf\u7684\u8d44\u6e90\u5bf9\u8c61\u4e0a\uff0cLabel \u901a\u5e38\u5728\u8d44\u6e90\u5bf9\u8c61\u5b9a\u4e49\u65f6\u786e\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u5728\u5bf9\u8c61\u521b\u5efa\u540e\u52a8\u6001\u6dfb\u52a0\u6216\u5220\u9664\u3002</p> <p>Label \u7684\u6700\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u4f7f\u7528 <code>metadata.labels</code> \u5b57\u6bb5\u6765\u4e3a\u5bf9\u8c61\u6dfb\u52a0 Label\uff0c\u901a\u8fc7 <code>spec.selector</code> \u6765\u5f15\u7528\u5bf9\u8c61\u3002</p> <p>Label \u9644\u52a0\u5230 Kubernetes \u96c6\u7fa4\u4e2d\u5404\u79cd\u8d44\u6e90\u5bf9\u8c61\u4e0a\uff0c\u76ee\u7684\u5c31\u662f\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u5bf9\u8c61\u8fdb\u884c\u5206\u7ec4\u7ba1\u7406\uff0c\u800c\u5206\u7ec4\u7ba1\u7406\u7684\u6838\u5fc3\u5c31\u662f Label Selector\u3002Label \u548c Label Selector \u90fd\u4e0d\u80fd\u5355\u72ec\u5b9a\u4e49\uff0c\u5fc5\u987b\u9644\u52a0\u5728\u4e00\u4e9b\u8d44\u6e90\u5bf9\u8c61\u7684\u5b9a\u4e49\u6587\u4ef6\u4e0a\uff0c\u4e00\u822c\u9644\u52a0\u5728 RC \u548c Service \u7684\u8d44\u6e90\u5b9a\u4e49\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#controller","title":"\u4e09\u3001Controller \u63a7\u5236\u5668","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-replication-controller","title":"1 Replication Controller","text":"<p>Replication Controller\uff08RC\uff09\u662f Kubernetes \u7cfb\u7edf\u4e2d\u6838\u5fc3\u6982\u5ff5\u4e4b\u4e00\uff0c\u5f53\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a RC \u5e76\u63d0\u4ea4\u5230 Kubernetes \u96c6\u7fa4\u4e2d\u4ee5\u540e\uff0cMaster \u8282\u70b9\u4e0a\u7684 Controller Manager \u7ec4\u4ef6\u5c31\u5f97\u5230\u901a\u77e5\uff0c\u5b9a\u671f\u68c0\u67e5\u7cfb\u7edf\u4e2d\u5b58\u6d3b\u7684 Pod\uff0c\u5e76\u786e\u5b9a\u76ee\u6807 Pod \u5b9e\u4f8b\u7684\u6570\u91cf\u521a\u597d\u7b49\u4e8e RC \u7684\u9884\u671f\u503c\uff0c\u5982\u679c\u6709\u8fc7\u591a\u6216\u8fc7\u5c11\u7684 Pod \u8fd0\u884c\uff0c\u7cfb\u7edf\u5c31\u4f1a\u505c\u6389\u6216\u521b\u5efa\u4e00\u4e9b Pod\u3002\u6b64\u5916\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 RC \u7684\u526f\u672c\u6570\u91cf\uff0c\u6765\u5b9e\u73b0 Pod \u7684\u52a8\u6001\u7f29\u653e\u529f\u80fd\u3002</p> <pre><code>kubectl scale rc nginx --replicas=5\n</code></pre> <p>\u7531\u4e8e Replication Controller \u4e0e Kubernetes \u4ee3\u7801\u4e2d\u7684\u6a21\u5757 Replication Controller \u540c\u540d\uff0c\u6240\u4ee5\u5728 Kubernetes v1.2 \u65f6\uff0c\u5b83\u5c31\u5347\u7ea7\u6210\u4e86\u53e6\u5916\u4e00\u4e2a\u65b0\u7684\u6982\u5ff5 Replica Set\uff0c\u5b98\u65b9\u89e3\u91ca\u4e3a\u4e0b\u4e00\u4ee3\u7684 RC\uff0c\u5b83\u4e0e RC \u7684\u533a\u522b\u662f\uff1aReplica Set \u662f\u57fa\u4e8e\u96c6\u5408\u7684 Label Selector\uff0c\u800c RC \u53ea\u652f\u6301\u57fa\u4e8e\u7b49\u5f0f\u7684 Label Selector\u3002\u6211\u4eec\u5f88\u5c11\u5355\u72ec\u4f7f\u7528 Replica Set\uff0c\u5b83\u4e3b\u8981\u88ab Deployment \u8fd9\u4e2a\u66f4\u9ad8\u5c42\u9762\u7684\u8d44\u6e90\u5bf9\u8c61\u6240\u4f7f\u7528\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u6574\u5957 Pod \u521b\u5efa\u3001\u5220\u9664\u3001\u66f4\u65b0\u7684\u7f16\u6392\u673a\u5236\u3002\u6700\u597d\u4e0d\u597d\u8d8a\u8fc7 RC \u76f4\u63a5\u521b\u5efa Pod\uff0c\u56e0\u4e3a Replication Controller \u4f1a\u901a\u8fc7 RC \u7ba1\u7406 Pod \u526f\u672c\uff0c\u5b9e\u73b0\u81ea\u52a8\u521b\u5efa\u3001\u8865\u8db3\u3001\u66ff\u6362\u3001\u5220\u9664 Pod \u526f\u672c\uff0c\u8fd9\u6837\u5c31\u80fd\u63d0\u9ad8\u5e94\u7528\u7684\u5bb9\u707e\u80fd\u529b\uff0c\u51cf\u5c11\u7531\u4e8e\u8282\u70b9\u5d29\u6e83\u7b49\u610f\u5916\u72b6\u51b5\u9020\u6210\u7684\u635f\u5931\u3002\u5373\u4f7f\u5e94\u7528\u7a0b\u5e8f\u53ea\u6709\u4e00\u4e2a Pod \u526f\u672c\uff0c\u4e5f\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 RC \u6765\u5b9a\u4e49 Pod\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-replica-set","title":"2 Replica Set","text":"<p>Replica Set \u8ddf Replication Controller \u6ca1\u6709\u672c\u8d28\u7684\u4e0d\u540c\uff0c\u53ea\u662f\u540d\u5b57\u4e0d\u4e00\u6837\uff0c\u5e76\u4e14 Replica Set \u652f\u6301\u96c6\u5408\u5f0f\u7684 Selector\u3002Kubernetes \u5b98\u65b9\u5f3a\u70c8\u5efa\u8bae\u907f\u514d\u76f4\u63a5\u4f7f\u7528 Replica Set\uff0c\u800c\u5e94\u8be5\u901a\u8fc7 Deployment \u6765\u521b\u5efa RS \u548c Pod\u3002\u7531\u4e8e Replica Set \u662f Replication Controller \u7684\u4ee3\u66ff\u7269\uff0c\u56e0\u6b64\u7528\u6cd5\u57fa\u672c\u76f8\u540c\uff0c\u552f\u4e00\u7684\u533a\u522b\u5728\u4e8e Replica Set \u652f\u6301\u96c6\u5408\u5f0f\u7684 Selector\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-deployment","title":"3 Deployment","text":"<p>Deployment \u662f Kubernetes v1.2 \u5f15\u5165\u7684\u65b0\u6982\u5ff5\uff0c\u5f15\u5165\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u89e3\u51b3 Pod \u7684\u7f16\u6392\u95ee\u9898\uff0cDeployment \u5185\u90e8\u4f7f\u7528\u4e86 Replica Set \u6765\u5b9e\u73b0\u3002Deployment \u7684\u5b9a\u4e49\u4e0e Replica Set \u7684\u5b9a\u4e49\u5f88\u7c7b\u4f3c\uff0c\u9664\u4e86 API \u58f0\u660e\u4e0e kind \u7c7b\u578b\u6709\u6240\u533a\u522b\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4-horizontal-pod-autoscaler","title":"4 Horizontal Pod Autoscaler","text":"<p>Horizontal Pod Autoscaler\uff08Pod \u6a2a\u5411\u6269\u5bb9\uff0c\u7b80\u79f0 HPA\uff09\u4e0e RC\u3001Deployment \u4e00\u6837\uff0c\u4e5f\u5c5e\u4e8e\u4e00\u79cd Kunernetes \u8d44\u6e90\u5bf9\u8c61\u3002\u901a\u8fc7\u8ffd\u8e2a\u5206\u4e1c\u897f PC \u63a7\u5236\u5668\u7684\u6240\u6709\u76ee\u6807 Pod \u7684\u8d1f\u8f7d\u53d8\u5316\u60c5\u51b5\uff0c\u6765\u786e\u5b9a\u662f\u5426\u9700\u8981\u9488\u5bf9\u6027\u5730\u8c03\u6574\u76ee\u6807 Pod \u7684\u526f\u672c\u6570\uff0c\u8fd9\u662f HPA \u7684\u5b9e\u73b0\u539f\u7406\u3002</p> <p>Kubernetes \u5bf9 Pod \u6269\u5bb9\u4e0e\u7f29\u5bb9\u63d0\u4f9b\u4e86\u624b\u52a8\u548c\u81ea\u52a8\u4e24\u79cd\u6a21\u5f0f\uff0c\u624b\u52a8\u6a21\u5f0f\u901a\u8fc7 <code>kubectl scale</code> \u547d\u4ee4\u5bf9\u4e00\u4e2a Deployment/RC \u8fdb\u884c\u526f\u672c\u6570\u91cf\u7684\u8bbe\u7f6e\u3002\u81ea\u52a8\u6a21\u5f0f\u5219\u9700\u8981\u6839\u636e\u67d0\u4e2a\u6027\u80fd\u6307\u6807\u6216\u8005\u81ea\u5b9a\u4e49\u4e1a\u52a1\u6307\u6807\uff0c\u5e76\u6307\u5b9a Pod \u526f\u672c\u6570\u91cf\u7684\u8303\u56f4\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u6839\u636e\u6027\u80fd\u6307\u6807\u7684\u53d8\u5316\u8fdb\u884c\u8c03\u6574\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#volume","title":"\u56db\u3001Volume","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-volume","title":"1 Volume \u6982\u8ff0","text":"<p>Volume \u662f Pod \u4e2d\u80fd\u591f\u88ab\u591a\u4e2a\u5bb9\u5668\u8bbf\u95ee\u7684\u5171\u4eab\u76ee\u5f55\u3002Kubernetes \u7684 Volume \u5b9a\u4e49\u5728 Pod \u4e0a\uff0c\u5b83\u88ab\u4e00\u4e2a Pod \u4e2d\u7684\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u5230\u5177\u4f53\u7684\u6587\u4ef6\u76ee\u5f55\u4e0b\u3002Volume \u4e0e Pod \u7684\u751f\u547d\u5468\u671f\u76f8\u540c\uff0c\u4f46\u4e0e\u5bb9\u5668\u7684\u58f0\u660e\u5468\u671f\u4e0d\u76f8\u5173\uff0c\u5f53\u5bb9\u5668\u7ec8\u6b62\u6216\u91cd\u542f\u65f6\uff0cVolume \u4e2d\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002</p> <p>\u8981\u4f7f\u7528 Volume\uff0cPod \u9700\u8981\u6307\u5b9a Volume \u7684\u7c7b\u578b\u548c\u5185\u5bb9\uff0c\u548c\u6620\u5c04\u5230\u5bb9\u5668\u7684\u4f4d\u7f6e\u3002</p> <p>Kubernetes \u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684 Volume\u3002emptyDir \u7c7b\u578b\u7684 Volume \u521b\u5efa\u4e8e Pod \u88ab\u8c03\u5ea6\u5230\u67d0\u4e2a\u5bbf\u4e3b\u673a\u7684\u65f6\u5019\uff0c\u800c\u540c\u4e00\u4e2a Pod \u5185\u7684\u5bb9\u5668\u90fd\u80fd\u8bfb\u5199 emptyDir \u4e2d\u7684\u540c\u4e00\u4e2a\u6587\u4ef6\u3002\u4e00\u65e6\u8fd9\u4e2a Pod \u79bb\u5f00\u4e86\u8fd9\u4e2a\u5bbf\u4e3b\u673a\uff0cEmptyDir \u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u88ab\u6c38\u4e45\u5220\u9664\u3002\u6240\u4ee5\u76ee\u524d emptyDir \u7c7b\u578b\u7684 Volume \u4e3b\u8981\u7528\u4f5c\u4e34\u65f6\u7a7a\u95f4\uff0c\u6bd4\u5982 Web \u670d\u52a1\u5668\u5199\u65e5\u5fd7\u6216\u8005 tmp \u6587\u4ef6\u9700\u8981\u7684\u4e34\u65f6\u76ee\u5f55\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-hostpath","title":"2 hostPath","text":"<p>hostPath \u7c7b\u578b\u7684 Volume \u4f7f\u5f97\u5bf9\u5e94\u7684\u5bb9\u5668\u80fd\u591f\u8bbf\u95ee\u5f53\u524d\u5bbf\u4e3b\u673a\u4e0a\u7684\u6307\u5b9a\u76ee\u5f55\u3002\u4f8b\u5982\uff0c\u9700\u8981\u8fd0\u884c\u4e00\u4e2a\u8bbf\u95ee Docker \u7cfb\u7edf\u76ee\u5f55\u7684\u5bb9\u5668\uff0c\u90a3\u4e48\u4f7f\u7528 <code>/var/lib/mysql</code> \u76ee\u5f55\u4f5c\u4e3a\u4e00\u4e2a hostPath \u7c7b\u578b\u7684 Volume\u3002\u4e00\u65e6\u8fd9\u4e2a Pod \u79bb\u5f00\u4e86\u8fd9\u4e2a\u5bbf\u4e3b\u673a\uff0chostPath \u4e2d\u7684\u6570\u636e\u867d\u7136\u4e0d\u4f1a\u6c38\u4e45\u5220\u9664\uff0c\u4f46\u6570\u636e\u4e5f\u4e0d\u4f1a\u968f Pod \u8fc1\u79fb\u5230\u5176\u5b83\u5bbf\u4e3b\u673a\u4e0a\u3002\u56e0\u6b64\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u5404\u4e2a\u5bbf\u4e3b\u673a\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784\u548c\u5185\u5bb9\u5e76\u4e0d\u5b8c\u5168\u76f8\u540c\uff0c\u6240\u6709\u76f8\u540c Pod \u7684 hostPath \u53ef\u80fd\u4f1a\u5728\u4e0d\u540c\u7684\u5bbf\u4e3b\u673a\u548c\u662f\u54ea\u4e2a\u8868\u73b0\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-nfs","title":"3 nfs","text":"<p>nfs \u7c7b\u578b\u7684 Volume \u5141\u8bb8\u4e00\u5757\u73b0\u6709\u7684\u7f51\u7edc\u786c\u76d8\u5728\u540c\u4e00\u4e2a Pod \u5185\u7684\u5bb9\u5668\u95f4\u5171\u4eab\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#pvc-pv","title":"\u4e94\u3001PVC \u548c PV","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1","title":"1 \u57fa\u672c\u6982\u5ff5","text":"<p>\u7ba1\u7406\u5b58\u50a8\u662f\u7ba1\u7406\u8ba1\u7b97\u7684\u4e00\u4e2a\u660e\u663e\u95ee\u9898\u3002\u8be5 PersistentVolume \u5b50\u7cfb\u7edf\u4e3a\u7528\u6237\u548c\u7ba1\u7406\u5458\u63d0\u4f9b\u4e86\u4e00\u4e2a API\uff0c\u7528\u4e8e\u62bd\u8c61\u5982\u4f55\u6839\u636e\u6d88\u8d39\u65b9\u5f0f\u63d0\u4f9b\u5b58\u50a8\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5f15\u5165\u4e86\u4e24\u4e2a\u65b0\u7684 API \u8d44\u6e90\uff1aPersistentVolumeClaim \u548c PersistentVolume\u3002</p> <p>PersistentVolume\uff08PV\uff09\u662f\u96c6\u7fa4\u4e2d\u7531\u7ba1\u7406\u5458\u914d\u7f6e\u7684\u4e00\u6bb5\u7f51\u7edc\u5b58\u50a8\u3002\u5b83\u662f\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\uff0c\u5c31\u50cf\u8282\u70b9\u662f\u96c6\u7fa4\u8d44\u6e90\u4e00\u6837\u3002PV \u662f\u5bb9\u91cf\u63d2\u4ef6\uff0c\u5982 Volumes\uff0c\u4f46\u5176\u751f\u547d\u5468\u671f\u72ec\u7acb\u4e8e\u4f7f\u7528 PV \u7684\u4efb\u52a1\u5355\u4e2a Pod\u3002\u6b64 API \u5bf9\u8c61\u6355\u83b7\u5b58\u50a8\u5b9e\u73b0\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec nfs\u3001iscsi \u6216\u7279\u5b9a\u4e8e\u4e91\u63d0\u4f9b\u7a0b\u5e8f\u7684\u5b58\u50a8\u7cfb\u7edf\u3002</p> <p>PersistentVolumeClaim\uff08PVC\uff09\u662f\u7531\u7528\u6237\u8fdb\u884c\u5b58\u50a8\u7684\u8bf7\u6c42\u3002\u5b83\u7c7b\u4f3c\u4e8e Pod\uff0cPod \u6d88\u8017\u8282\u70b9\u8d44\u6e90\uff0cPVC \u6d88\u8017 PV \u8d44\u6e90\uff0cPod \u53ef\u4ee5\u8bf7\u6c42\u7279\u5b9a\u7ea7\u522b\u7684\u8d44\u6e90\uff08CPU \u548c\u5185\u5b58\uff09\uff0cClaim \u53ef\u4ee5\u8bf7\u6c42\u7279\u5b9a\u7684\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\uff08\u5982\u4e00\u6b21\u8bfb\u5199\u6216\u591a\u6b21\u53ea\u8bfb\uff09\u3002</p> <p>\u867d\u7136 PersistentVolumeClaim \u5141\u8bb8\u7528\u6237\u4f7f\u7528\u62bd\u8c61\u5b58\u50a8\u8d44\u6e90\uff0c\u4f46\u662f PersistentVolume \u5bf9\u4e8e\u4e0d\u540c\u7684\u95ee\u9898\uff0c\u7528\u6237\u901a\u5e38\u9700\u8981\u5177\u6709\u4e0d\u540c\u5c5e\u6027\uff08\u4f8b\u5982\u6027\u80fd\uff09\u3002\u96c6\u7fa4\u7ba1\u7406\u5458\u9700\u8981\u80fd\u591f\u63d0\u4f9b\u5404\u79cd PersistentVolume \u4e0d\u540c\u7684\u65b9\u5f0f\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5927\u5c0f\u548c\u8bbf\u95ee\u6a21\u5f0f\uff0c\u800c\u4e0d\u4f1a\u8ba9\u7528\u6237\u4e86\u89e3\u8fd9\u4e9b\u5377\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\u5bf9\u4e8e\u8fd9\u4e9b\u9700\u6c42\uff0c\u6709 StorageClass \u8d44\u6e90\u3002</p> <p>StorageClass \u4e3a\u7ba1\u7406\u5458\u63d0\u4f9b\u4e86\u4e00\u79cd\u63cf\u8ff0\u5b83\u4eec\u7684\u5b58\u50a8\u7684 \"\u7c7b\" \u7684\u65b9\u6cd5\u3002\u4e0d\u540c\u7684\u7c7b\u53ef\u80fd\u6620\u5c04\u5230\u670d\u52a1\u8d28\u91cf\u7ea7\u522b\uff0c\u6216\u5907\u4efd\u7b56\u7565\uff0c\u6216\u8005\u7531\u96c6\u7fa4\u7ba1\u7406\u5458\u786e\u5b9a\u7684\u4efb\u610f\u7b56\u7565\u3002</p> <p>PVC \u548c PV \u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2","title":"2 \u751f\u547d\u5468\u671f","text":"<p>PV \u662f\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\uff0cPVC \u5bf9\u8fd9\u4e9b\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14\u8fd8\u5145\u5f53\u5bf9\u8d44\u6e90\u7684\u68c0\u67e5\u3002PV \u548c PVC \u4e4b\u95f4\u7684\u76f8\u4e92\u4f5c\u7528\u9075\u5faa\u4ee5\u4e0b\u751f\u547d\u5468\u671f\uff1a</p> <ol> <li>Provissioning\uff1a\u901a\u8fc7\u96c6\u7fa4\u5916\u7684\u5b58\u50a8\u7cfb\u7edf\u6216\u8005\u4e91\u5e73\u53f0\u6765\u63d0\u4f9b\u6301\u4e45\u5316\u652f\u6301\u3002<ul> <li>\u9759\u6001\u63d0\u4f9b\uff1a\u96c6\u7fa4\u7ba1\u7406\u5458\u521b\u5efa\u591a\u4e2a PV\uff0c\u5b83\u4eec\u643a\u5e26\u53ef\u4f9b\u96c6\u7fa4\u7528\u6237\u4f7f\u7528\u7684\u771f\u5b9e\u5b58\u50a8\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5b83\u4eec\u5b58\u5728\u4e8e Kubnernetes API \u4e2d\uff0c\u53ef\u7528\u4e8e\u6d88\u8d39\u3002</li> <li>\u52a8\u6001\u63d0\u4f9b\uff1a\u5f53\u96c6\u7fa4\u7ba1\u7406\u5458\u521b\u5efa\u7684\u9759\u6001 PV \u90fd\u4e0d\u5339\u914d\u7528\u6237\u7684 PVC \u65f6\uff0c\u96c6\u7fa4\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u4e3a PVC \u52a8\u6001\u914d\u7f6e\u5377\u3002\u6b64\u914d\u7f6e\u57fa\u4e8e StorageClass\uff0cPVC \u5fc5\u987b\u8bf7\u6c42\u4e00\u4e2a\u7c7b\uff0c\u5e76\u4e14\u7ba1\u7406\u5458\u5fc5\u987b\u5df2\u521b\u5efa\u5e76\u914d\u7f6e\u8be5\u7c7b\u624d\u80fd\u8fdb\u884c\u52a8\u6001\u914d\u7f6e\u3002</li> </ul> </li> <li>Binding\uff1a\u7528\u6237\u521b\u5efa PVC \u5e76\u6307\u5b9a\u9700\u8981\u7684\u8d44\u6e90\u548c\u8bbf\u95ee\u6a21\u5f0f\uff0c\u5728\u627e\u5230\u53ef\u7528 PV \u4e4b\u524d\uff0cPVC \u4f1a\u4fdd\u6301\u672a\u7ed1\u5b9a\u72b6\u6001\u3002</li> <li>Using\uff1a\u7528\u6237\u53ef\u5728 Pod \u4e2d\u50cf\u4f7f\u7528 Volume \u4e00\u6837\u4f7f\u7528 PVC\u3002</li> <li>Releasing\uff1a\u7528\u6237\u5220\u9664 PVC \u6765\u56de\u6536\u5b58\u50a8\u8d44\u6e90\uff0cPV \u5c06\u53d8\u6210 \"Released\" \u72b6\u6001\u3002\u7531\u4e8e\u8fd8\u4fdd\u7559\u7740\u4e4b\u524d\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u7b56\u7565\u6765\u5904\u7406\uff0c\u5426\u5219\u8fd9\u4e9b\u5b58\u50a8\u8d44\u6e90\u65e0\u6cd5\u88ab\u5176\u5b83 PVC \u4f7f\u7528\u3002</li> <li>Recycling\uff1aPV \u53ef\u4ee5\u8bbe\u7f6e\u4e09\u79cd\u56de\u6536\u7b56\u7565\u3002<ul> <li>Retain\uff08\u4fdd\u7559\u7b56\u7565\uff09\uff1a\u5141\u8bb8\u4eba\u5de5\u5904\u7406\u4fdd\u7559\u7684\u6570\u636e\u3002</li> <li>Delete\uff08\u5220\u9664\u7b56\u7565\uff09\uff1a\u5c06\u5220\u9664 PV \u548c\u5916\u90e8\u5173\u8054\u7684\u5b58\u50a8\u8d44\u6e90\uff0c\u9700\u8981\u63d2\u4ef6\u652f\u6301\u3002</li> <li>Recycle\uff08\u56de\u6536\u7b56\u7565\uff09\uff1a\u5c06\u6267\u884c\u6e05\u9664\u64cd\u4f5c\uff0c\u4e4b\u540e\u53ef\u4ee5\u88ab\u65b0\u7684 PVC \u4f7f\u7528\uff0c\u9700\u8981\u63d2\u4ef6\u652f\u6301\u3002</li> </ul> </li> </ol>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-pv","title":"3 PV \u5377\u9636\u6bb5\u72b6\u6001","text":"\u72b6\u6001 \u8bf4\u660e Availble \u8d44\u6e90\u5c1a\u672a\u88ab Claim \u4f7f\u7528\u3002 Bound \u5377\u5df2\u7ecf\u7ed1\u5b9a\u5230 Claim \u4e86\u3002 Released Claim \u88ab\u5220\u9664\uff0c\u5377\u5904\u4e8e\u91ca\u653e\u72b6\u6001\uff0c\u4f46\u672a\u88ab\u96c6\u7fa4\u56de\u6536\u3002 Failed \u5377\u81ea\u52a8\u56de\u6536\u5931\u8d25\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#secret","title":"\u516d\u3001Secret","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-secret","title":"1 Secret \u5b58\u5728\u610f\u4e49","text":"<p>Secret \u89e3\u51b3\u4e86\u5bc6\u7801\u3001Token\u3001\u79d8\u94a5\u7b49\u654f\u611f\u6570\u636e\u7684\u914d\u7f6e\u95ee\u9898\uff0c\u800c\u4e0d\u9700\u8981\u5427\u8fd9\u4e9b\u654f\u611f\u6570\u636e\u66b4\u9732\u5230\u955c\u50cf\u6216\u8005 Pod Spec \u4e2d\u3002Secret \u53ef\u4ee5\u4ee5 Volume \u6216\u8005\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u4f7f\u7528\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-secret","title":"2 Secret \u7c7b\u578b","text":"\u7c7b\u578b \u8bf4\u660e Service Account \u7528\u6765\u8bbf\u95ee Kubernetes API\uff0c\u7531 Kubernetes \u81ea\u52a8\u521b\u5efa\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u6302\u8f7d\u5230 Pod \u7684 <code>/run/secrets/kubernetes.io/serviceaccount</code> \u76ee\u5f55\u4e2d\u3002 Opaque base64 \u7f16\u7801\u683c\u5f0f\u7684 Secret\uff0c\u7528\u6765\u5b58\u50a8\u5bc6\u7801\u3001\u79d8\u94a5\u7b49\u3002 kubernetes.io/dockerconfigjson \u7528\u6765\u5b58\u50a8\u79c1\u6709 docker registry \u7684\u8ba4\u8bc1\u4fe1\u606f\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-service-account","title":"3 Service Account","text":"<p>Service Account \u7528\u6765\u8bbf\u95ee Kunernetes API\uff0c\u7531 Kunernetes \u81ea\u52a8\u521b\u5efa\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u6302\u8f7d\u5230 Pod \u7684 <code>/run/secrets/kubernetes.io/serviceaccount</code> \u76ee\u5f55\u4e2d\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4-opaque-secret","title":"4 Opaque Secret","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#41-secret","title":"4.1 \u521b\u5efa Secret","text":"<pre><code>echo -n 'admin' | base64\n\necho -n 'admin123456' | base64\n\ncat &lt;&lt;- EOF &gt; secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: my-secret\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: YWRtaW4xMjM0NTY=\nEOF\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#42-secret-volume","title":"4.2 \u5c06 Secret \u6302\u8f7d\u5230 Volume \u4e2d","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: secret-test\nspec:\n  containers:\n    - name: secret-test\n      image: my-app:0.0.1\n      volumeMounts:\n        - mountPath: /my-secret\n          name: my-secret\n  volumes:\n    - name: my-secret\n      secret:\n        secretName: my-secret\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#43-secret","title":"4.3 \u5c06 Secret \u8bbe\u7f6e\u4e3a\u73af\u5883\u53d8\u91cf","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: secret-test\nspec:\n  containers:\n    - name: secret-test\n      image: my-app:0.0.1\n      env:\n        - name: USERNAME\n          valueFrom:\n            secretKeyRef:\n              name: my-secret\n              key: username\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#configmap","title":"\u4e03\u3001ConfigMap","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-configmap","title":"1 ConfigMap \u6982\u8ff0","text":"<p>ConfigMap \u529f\u80fd\u5728 Kubernetes 1.2 \u7248\u672c\u4e2d\u5f15\u5165\uff0c\u8bb8\u591a\u5e94\u7528\u7a0b\u5e8f\u4f1a\u4ece\u914d\u7f6e\u6587\u4ef6\u3001\u547d\u4ee4\u884c\u53c2\u6570\u6216\u73af\u5883\u53d8\u91cf\u4e2d\u8bfb\u53d6\u914d\u7f6e\u4fe1\u606f\u3002ConfigMap \u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u5411\u5bb9\u5668\u6ce8\u5165\u914d\u7f6e\u4fe1\u606f\u7684\u673a\u5236\uff0cConfigMap \u53ef\u4ee5\u88ab\u7528\u6765\u4fdd\u5b58\u5355\u4e2a\u5c5e\u6027\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u6216\u8005 JSON \u4e8c\u8fdb\u5236\u5927\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-configmap","title":"2 ConfigMap \u521b\u5efa","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#21_1","title":"2.1 \u4f7f\u7528\u76ee\u5f55\u521b\u5efa","text":"<p><code>--from-file</code> \u6307\u5b9a\u5728\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u7528\u5728 ConfigMap \u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u952e\u7684\u540d\u5b57\u5c31\u662f\u6587\u4ef6\u540d\uff0c\u503c\u5c31\u662f\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <pre><code>kubectl create configmap game-config --from-file=docs/user-guide/configmap\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#22_1","title":"2.2 \u4f7f\u7528\u6587\u4ef6\u521b\u5efa","text":"<p><code>--from-file</code> \u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528\u591a\u6b21\uff0c\u6548\u679c\u8ddf\u6307\u5b9a\u6574\u4e2a\u76ee\u5f55\u662f\u4e00\u6837\u7684\u3002</p> <pre><code>kubectl create configmap game-config --from-file=docs/user-guide/configmap/game.properteis\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#23_1","title":"2.3 \u4f7f\u7528\u5b57\u9762\u91cf\u521b\u5efa","text":"<pre><code>kubectl create configmap special-config \\\n    --from-literal=special.how=very \\\n    --from-literal=special.type=charm\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-pod-configmap","title":"3 Pod \u4e2d\u4f7f\u7528 ConfigMap","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#31-configmap","title":"3.1 \u4f7f\u7528 ConfigMap \u4ee3\u66ff\u73af\u5883\u53d8\u91cf","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: special-config\ndata:\n  special.how: very\n  special.type: charm\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: special-pod\nspec:\n  containers:\n    - name: special-container\n      image: my-app:0.0.1\n      command: ['/bin/bash', '-c', 'env']\n      env:\n        - name: SPECIAL_CONFIG_HOW\n          valueFrom:\n            configMapKeyRef:\n              name: special-config\n              key: special.how\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#32-configmap","title":"3.2 \u901a\u8fc7\u6570\u636e\u5377\u63d2\u4ef6\u4f7f\u7528 ConfigMap","text":"<p>\u5728\u6570\u636e\u5377\u91cc\u9762\u4f7f\u7528\u8fd9\u4e2a ConfigMap\uff0c\u6709\u4e0d\u540c\u7684\u9009\u9879\u3002\u6700\u57fa\u672c\u7684\u5c31\u662f\u5c06\u6587\u4ef6\u586b\u5165\u6570\u636e\u5377\uff0c\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u952e\u5c31\u662f\u6587\u4ef6\u540d\uff0c\u503c\u5c31\u662f\u6587\u4ef6\u5185\u5bb9\u3002</p> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: special-config\ndata:\n  special.how: very\n  special.type: charm\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: special-pod\nspec:\n  containers:\n    - name: special-container\n      image: my-app:0.0.1\n      command: ['/bin/bash', '-c', 'cat /etc/config/special.how']\n      volumeMounts:\n        - mountPath: /etc/config\n          name: config-volume\n  volumes:\n    - name: config-volume\n      configMap:\n        name: special-config\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#namespace","title":"\u516b\u3001Namespace","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-namespace","title":"1 Namespace \u6982\u8ff0","text":"<p>Namespace \u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u7528\u4e8e\u5b9e\u73b0\u591a\u7528\u6237\u7684\u8d44\u6e90\u9694\u79bb\uff0c\u901a\u8fc7\u5c06\u96c6\u7fa4\u5185\u90e8\u7684\u8d44\u6e90\u5bf9\u8c61\u5206\u914d\u5230\u4e0d\u540c\u7684 Namespace \u4e2d\uff0c\u5f62\u6210\u903b\u8f91\u4e0a\u7684\u5206\u7ec4\uff0c\u4fbf\u4e8e\u4e0d\u540c\u7684\u5206\u7ec4\u5728\u5171\u4eab\u4f7f\u7528\u6574\u4e2a\u96c6\u7fa4\u7684\u8d44\u6e90\u540c\u65f6\u8fd8\u80fd\u88ab\u5206\u522b\u7ba1\u7406\u3002Kubernetes \u96c6\u7fa4\u5728\u542f\u52a8\u540e\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a default \u7684 Namespace\uff0c\u5982\u679c\u4e0d\u7279\u522b\u6307\u660e Namespace\uff0c\u5219\u7528\u6237\u521b\u5efa\u7684 Pod\u3001RC\u3001Service \u90fd\u5c06\u88ab\u7cfb\u7edf\u521b\u5efa\u5230\u8fd9\u4e2a\u9ed8\u8ba4\u7684\u540d\u4e3a default \u7684 Namespace \u4e2d\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#service","title":"\u4e5d\u3001Service","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-service","title":"1 Service \u6982\u8ff0","text":"<p>Service \u662f Kubernetes \u6700\u6838\u5fc3\u7684\u6982\u5ff5\u4e4b\u4e00\uff0c\u901a\u8fc7\u521b\u5efa Service\uff0c\u53ef\u4ee5\u4e3a\u4e00\u7ec4\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u5bb9\u5668\u5e94\u7528\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u5165\u53e3\u5730\u5740\uff0c\u5e76\u4e14\u5c06\u8bf7\u6c42\u8d1f\u8f7d\u5206\u53d1\u5230\u540e\u7aef\u7684\u5404\u4e2a\u5bb9\u5668\u5e94\u7528\u4e0a\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-service","title":"2 \u5916\u90e8\u670d\u52a1 Service","text":"<p>\u5728\u67d0\u4e9b\u7279\u6b8a\u73af\u5883\u4e2d\uff0c\u5e94\u7528\u7cfb\u7edf\u9700\u8981\u5c06\u4e00\u4e2a\u5916\u90e8\u6570\u636e\u5e93\u4f5c\u4e3a\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u8fde\u63a5\uff0c\u6216\u5c06\u53e6\u4e00\u4e2a\u96c6\u7fa4\u6216 Namespace \u4e2d\u7684\u670d\u52a1\u4f5c\u4e3a\u670d\u52a1\u7684\u540e\u7aef\uff0c\u8fd9\u65f6\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u65e0 Label Selector \u7684 Service \u6765\u5b9e\u73b0\u3002</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\nspec:\n  ports:\n    - port: 3306\n      protocol: TCP\n      targetPort: 3306\n---\napiVersion: v1\nkind: Endpoints\nsubsets:\n  - addresses:\n      - ip: 192.192.192.6\n    ports:\n      - port: 3306\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#_1","title":"\u5341\u3001\u63a2\u9488","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-livenessprobe","title":"1 livenessProbe\uff08\u5b58\u6d3b\u63a2\u9488\uff09","text":"<p>\u7528\u4e8e\u5224\u65ad\u5bb9\u5668\u662f\u5426\u5b58\u6d3b\uff0c\u5373 Pod \u662f\u5426\u4e3a Running \u72b6\u6001\uff0c\u5982\u679c livenessProbe \u63a2\u9488\u63a2\u6d4b\u5230\u5bb9\u5668\u4e0d\u5065\u5eb7\uff0c\u5219 kubectl \u5c06 kill \u6389\u5bb9\u5668\uff0c\u5e76\u6839\u636e\u5bb9\u5668\u7684\u91cd\u542f\u7b56\u7565\u51b3\u5b9a\u662f\u5426\u91cd\u542f\u3002\u5982\u679c\u4e00\u4e2a\u5bb9\u5668\u4e0d\u5305\u542b livenessProbe \u63a2\u9488\uff0c\u5219 kubelet \u8ba4\u4e3a\u5bb9\u5668\u7684 livenessProbe \u63a2\u9488\u7684\u8fd4\u56de\u503c\u6c38\u8fdc\u6210\u529f\u3002</p> <p>\u6709\u65f6\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\uff08\u540e\u7aef\u670d\u52a1\u6545\u969c\u7b49\uff09\u5bfc\u81f4\u6682\u65f6\u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u5e94\u7528\u8f6f\u4ef6\u6ca1\u6709\u7ec8\u6b62\uff0c\u5bfc\u81f4 K8S \u65e0\u6cd5\u9694\u79bb\u6709\u6545\u969c\u7684 Pod\uff0c\u8c03\u7528\u8005\u53ef\u80fd\u4f1a\u8bbf\u95ee\u5230\u6709\u6545\u969c\u7684 Pod\uff0c\u5bfc\u81f4\u4e1a\u52a1\u4e0d\u7a33\u5b9a\u3002K8S \u63d0\u4f9b livenessProbe \u6765\u68c0\u6d4b\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u4e14\u5bf9\u76f8\u5e94\u72b6\u51b5\u8fdb\u884c\u76f8\u5e94\u7684\u8865\u6551\u63aa\u65bd\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-readinessprobe","title":"2 readinessProbe\uff08\u5c31\u7eea\u63a2\u9488\uff09","text":"<p>\u7528\u4e8e\u5224\u65ad\u5bb9\u5668\u662f\u5426\u542f\u52a8\u5b8c\u6210\uff0c\u5373\u5bb9\u5668\u7684 Ready \u662f\u5426\u4e3a True\uff0c\u53ef\u4ee5\u63a5\u6536\u8bf7\u6c42\uff0c\u5982\u679c readinessProbe \u63a2\u6d4b\u5931\u8d25\uff0c\u5219\u5bb9\u5668\u7684 Ready \u5c06\u4e3a False\uff0c\u63a7\u5236\u5668\u5c06\u6b64 Pod \u7684 Endpoint \u4ece\u5bf9\u5e94\u7684 Service \u7684 Endpoint \u5217\u8868\u4e2d\u79fb\u9664\uff0c\u4ece\u6b64\u4e0d\u518d\u5c06\u4efb\u4f55\u8bf7\u6c42\u8c03\u5ea6\u5230\u6b64 Pod \u4e0a\uff0c\u76f4\u5230\u4e0b\u6b21\u63a2\u6d4b\u6210\u529f\u3002\u901a\u8fc7\u4f7f\u7528 readinessProbe \u63a2\u9488\uff0cKubernetes \u80fd\u591f\u7b49\u5f85\u5e94\u7528\u7a0b\u5e8f\u5b8c\u5168\u542f\u52a8\uff0c\u7136\u540e\u624d\u5141\u8bb8\u670d\u52a1\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u65b0\u526f\u672c\u3002</p> <p>\u6bd4\u5982\u4f7f\u7528 Tomcat \u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5e76\u4e0d\u662f\u7b80\u5355\u5730\u8bf4 Tomcat \u542f\u52a8\u6210\u529f\u5c31\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\uff0c\u8fd8\u9700\u8981\u7b49\u5f85 Spring \u5bb9\u5668\u521d\u59cb\u5316\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u8fde\u63a5\u7b49\u7b49\u3002\u5bf9\u4e8e Spring Boot \u5e94\u7528\uff0c\u9ed8\u8ba4\u7684 Actuator \u5e26\u6709 <code>/health</code> \u63a5\u53e3\uff0c\u53ef\u4ee5\u7528\u6765\u8fdb\u884c\u542f\u52a8\u6210\u529f\u7684\u5224\u65ad\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3","title":"3 \u63a2\u6d4b\u65b9\u6cd5","text":"<p>\u6bcf\u7c7b\u63a2\u9488\u90fd\u652f\u6301\u4e09\u79cd\u63a2\u6d4b\u65b9\u6cd5\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#31-exec","title":"3.1 exec","text":"<p>\u901a\u8fc7\u6267\u884c\u547d\u4ee4\u6765\u68c0\u67e5\u670d\u52a1\u662f\u5426\u6b63\u5e38\uff0c\u9488\u5bf9\u590d\u6742\u68c0\u6d4b\u68c0\u6d4b\u6216\u65e0 HTTP \u63a5\u53e3\u7684\u670d\u52a1\uff0c\u547d\u4ee4\u8fd4\u56de\u503c\u4e3a 0 \u5219\u8868\u793a\u5bb9\u5668\u5065\u5eb7\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#32-httpget","title":"3.2 httpGet","text":"<p>\u901a\u8fc7\u53d1\u9001 HTTP \u8bf7\u6c42\u68c0\u6d4b\u670d\u52a1\u662f\u5426\u6b63\u5e38\uff0c\u8fd4\u56de 200-399 \u72b6\u6001\u7801\u5219\u8868\u793a\u5bb9\u5668\u5065\u5eb7\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#33-tcpsocket","title":"3.3 tcpSocket","text":"<p>\u901a\u8fc7\u5bb9\u5668\u7684 IP \u548c Port \u6267\u884c TCP \u68c0\u6d4b\uff0c\u5982\u679c\u80fd\u591f\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u5219\u8868\u660e\u5bb9\u5668\u5065\u5eb7\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4","title":"4 \u793a\u4f8b","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: goproxy\n  labels:\n    app: goproxy\nspec:\n  containers:\n    - name: goproxy\n      image: k8s.gcr.io/goproxy:0.1\n      ports:\n        - containerPort: 8080\n      readinessProbe:\n        tcpSocket:\n          port: 8080\n        initialDelaySeconds: 5\n        periodSeconds: 10\n      livenessProbe:\n        tcpSocket:\n          port: 8080\n        initialDelaySeconds: 15\n        periodSeconds: 20\n</code></pre> <p>\u63a2\u9488\u6709\u8bb8\u591a\u53ef\u9009\u5b57\u6bb5\uff0c\u53ef\u4ee5\u7528\u6765\u66f4\u52a0\u7cbe\u786e\u7684\u63a7\u5236 livenessProbe \u548c readinessPorbe \u4e24\u79cd\u63a2\u9488\u7684\u884c\u4e3a\u3002\u8fd9\u4e9b\u53c2\u6570\u5305\u62ec\uff1a</p> \u53c2\u6570 \u8bf4\u660e <code>initialDelaySeconds</code> \u5bb9\u5668\u542f\u52a8\u540e\u7b2c\u4e00\u6b21\u6267\u884c\u63a2\u6d4b\u65f6\u9700\u8981\u7b49\u5f85\u591a\u5c11\u79d2\u3002 <code>periodSeconds</code> \u6267\u884c\u63a2\u6d4b\u7684\u9891\u7387\u3002\u9ed8\u8ba4 10 \u79d2\uff0c\u6700\u5c0f 1 \u79d2\u3002 <code>timeoutSeconds</code> \u63a2\u6d4b\u8d85\u65f6\u65f6\u95f4\u3002\u9ed8\u8ba4 1 \u79d2\uff0c\u6700\u5c0f 1 \u79d2\u3002 <code>successThreshold</code> \u63a2\u6d4b\u5931\u8d25\u540e\uff0c\u6700\u5c11\u8fde\u7eed\u63a2\u6d4b\u6210\u529f\u591a\u5c11\u6b21\u624d\u88ab\u8ba4\u5b9a\u4e3a\u6210\u529f\u3002\u9ed8\u8ba4 1\uff0c\u6700\u5c0f\u503c 1\u3002\u5bf9\u4e8e livenessProbe \u5fc5\u987b\u662f 1\u3002 <code>failureThreshold</code> \u63a2\u6d4b\u6210\u529f\u540e\uff0c\u6700\u5c11\u8fde\u7eed\u63a2\u6d4b\u5931\u8d25\u591a\u5c11\u6b21\u624d\u88ab\u8ba4\u5b9a\u4e3a\u5931\u8d25\u3002\u9ed8\u8ba4 3\uff0c\u6700\u5c0f\u503c 1\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#_2","title":"\u5341\u4e00\u3001\u8c03\u5ea6\u5668","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1_1","title":"1 \u6982\u8ff0","text":"<p>\u4e00\u4e2a\u5bb9\u5668\u5e73\u53f0\u7684\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u4e3a\u5bb9\u5668\u5206\u914d\u8fd0\u884c\u65f6\u6240\u9700\u8981\u7684\u8ba1\u7b97\u3001\u5b58\u50a8\u548c\u7f51\u7edc\u8d44\u6e90\u3002\u5bb9\u5668\u8c03\u5ea6\u7cfb\u7edf\u8d1f\u8d23\u9009\u62e9\u5728\u6700\u5408\u9002\u7684\u4e3b\u673a\u4e0a\u542f\u52a8\u5bb9\u5668\uff0c\u5e76\u4e14\u5c06\u5b83\u4eec\u5173\u8054\u8d77\u6765\u3002\u5b83\u5fc5\u987b\u80fd\u591f\u81ea\u52a8\u7684\u5904\u7406\u5bb9\u5668\u6545\u969c\u5e76\u4e14\u80fd\u591f\u5728\u66f4\u591a\u7684\u4e3b\u673a\u4e0a\u81ea\u52a8\u542f\u52a8\u66f4\u591a\u7684\u5bb9\u5668\u6765\u5e94\u5bf9\u66f4\u591a\u7684\u5e94\u7528\u8bbf\u95ee\u3002</p> <p>\u76ee\u524d\u4e09\u5927\u4e3b\u6d41\u7684\u5bb9\u5668\u5e73\u53f0 Swarm\u3001Mesos \u548c Kubernetes \u5177\u6709\u4e0d\u540c\u7684\u5bb9\u5668\u8c03\u5ea6\u7cfb\u7edf\u3002</p> <ul> <li>Swarm \u7684\u7279\u70b9\u662f\u76f4\u63a5\u8c03\u5ea6 Docker \u5bb9\u5668\uff0c\u5e76\u4e14\u63d0\u4f9b\u548c\u6807\u51c6 Docker API \u4e00\u81f4\u7684 API\u3002</li> <li>Mesos \u9488\u5bf9\u4e0d\u540c\u7684\u8fd0\u884c\u6846\u67b6\u91c7\u7528\u76f8\u5bf9\u72ec\u7acb\u7684\u8c03\u5ea6\u7cfb\u7edf\uff0c\u5176\u4e2d Marathon \u6846\u67b6\u63d0\u4f9b\u4e86 Docker \u5bb9\u5668\u7684\u539f\u751f\u652f\u6301\u3002</li> <li>Kubernetes \u91c7\u7528\u4e86 Pod \u548c Label \u8fd9\u6837\u7684\u6982\u5ff5\u628a\u5bb9\u5668\u7ec4\u5408\u6210\u4e00\u4e2a\u4e2a\u7684\u4e92\u76f8\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u7684\u903b\u8f91\u5355\u5143\u3002\u76f8\u5173\u5bb9\u5668\u88ab\u7ec4\u5408\u6210 Pod \u540e\u88ab\u5171\u540c\u90e8\u7f72\u548c\u8c03\u5ea6\u3002\u5f62\u6210\u670d\u52a1\u3002</li> </ul> <p>\u76f8\u5bf9\u6765\u8bf4\uff0cKubernetes \u91c7\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u7b80\u5316\u4e86\u96c6\u7fa4\u8303\u56f4\u5185\u76f8\u5173\u5bb9\u5668\u88ab\u5171\u540c\u8c03\u5ea6\u7684\u590d\u6742\u6027\u3002\u6362\u4e00\u79cd\u89d2\u5ea6\u6765\u770b\uff0cKubernetes \u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u80fd\u591f\u76f8\u5bf9\u5bb9\u6613\u7684\u652f\u6301\u66f4\u5f3a\u5927\u3001\u66f4\u590d\u6742\u7684\u5bb9\u5668\u8c03\u5ea6\u7b97\u6cd5\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-k8s","title":"2 K8S \u8c03\u5ea6\u5de5\u4f5c\u65b9\u5f0f","text":"<p>Kubernetes \u8c03\u5ea6\u5668\u4f5c\u4e3a\u96c6\u7fa4\u7684\u5927\u8111\uff0c\u5728\u5982\u4f55\u63d0\u9ad8\u96c6\u7fa4\u7684\u8d44\u6e90\u5229\u7528\u7387\u3001\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u670d\u52a1\u7684\u7a33\u5b9a\u8fd0\u884c\u4e2d\u4e5f\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u91cd\u8981\u3002Kubernetes \u7684\u8d44\u6e90\u5206\u4e3a\u4e24\u79cd\u5c5e\u6027\u3002</p> <ul> <li>\u53ef\u538b\u7f29\u8d44\u6e90\uff08\u4f8b\u5982 CPU \u5faa\u73af\u3001Disk I/O \u5bbd\u5e26\uff09\u90fd\u662f\u53ef\u4ee5\u88ab\u9650\u5236\u548c\u88ab\u56de\u6536\u7684\uff0c\u5bf9\u4e8e\u4e00\u4e2a Pod \u6765\u8bf4\u53ef\u4ee5\u964d\u4f4e\u8fd9\u4e9b\u8d44\u6e90\u7684\u4f7f\u7528\u91cf\u800c\u4e0d\u53bb\u6740\u6389 Pod\u3002</li> <li>\u4e0d\u53ef\u538b\u7f29\u8d44\u6e90\uff08\u4f8b\u5982\u5185\u5b58\u3001\u786c\u76d8\u7a7a\u95f4\uff09\u4e00\u822c\u6765\u8bf4\u4e0d\u6740\u6389 Pod \u5c31\u6ca1\u6cd5\u56de\u6536\u3002\u672a\u6765 Kubernetes \u4f1a\u52a0\u5165\u66f4\u591a\u8d44\u6e90\uff0c\u4f8b\u5982\u7f51\u7edc\u5e26\u5bbd\u3001\u5b58\u50a8 IOPS \u7684\u652f\u6301\u3002</li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-k8s","title":"3 K8S \u8c03\u5ea6\u5668","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#31","title":"3.1 \u6982\u8ff0","text":"<p>kube-scheduler \u662f Kubernetes \u7cfb\u7edf\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u4e3b\u8981\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u8d44\u6e90\u7684\u8c03\u5ea6\u529f\u80fd\uff0c\u6839\u636e\u7279\u5b9a\u7684\u8c03\u5ea6\u7b97\u6cd5\u548c\u7b56\u7565\uff0c\u5c06 Pod \u8c03\u5ea6\u5230\u6700\u4f18\u7684\u5de5\u4f5c\u8282\u70b9\u4e0a\u9762\u53bb\uff0c\u4ece\u800c\u66f4\u52a0\u5408\u7406\u3001\u66f4\u52a0\u5145\u5206\u7684\u5229\u7528\u96c6\u7fa4\u7684\u8d44\u6e90\uff0c\u8fd9\u4e5f\u662f\u9009\u62e9\u4f7f\u7528 Kubernetes \u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u7406\u7531\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#32","title":"3.2 \u8c03\u5ea6\u6d41\u7a0b","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckube-scheduler \u63d0\u4f9b\u7684\u9ed8\u8ba4\u8c03\u5ea6\u5668\u80fd\u591f\u6ee1\u8db3\u6211\u4eec\u7edd\u5927\u591a\u6570\u7684\u8981\u6c42\uff0c\u4e4b\u524d\u63a5\u89e6\u7684\u793a\u4f8b\u4e5f\u57fa\u672c\u4e0a\u7528\u7684\u9ed8\u8ba4\u7684\u7b56\u7565\uff0c\u90fd\u53ef\u4ee5\u4fdd\u8bc1\u6211\u4eec\u7684 Pod \u53ef\u4ee5\u88ab\u5206\u914d\u5230\u8d44\u6e90\u5145\u8db3\u7684\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u4f46\u662f\u5728\u5b9e\u9645\u7684\u7ebf\u4e0a\u9879\u76ee\u4e2d\uff0c\u53ef\u80fd\u6211\u4eec\u81ea\u5df1\u4f1a\u6bd4 Kubernetes \u66f4\u52a0\u4e86\u89e3\u6211\u4eec\u81ea\u5df1\u7684\u5e94\u7528\uff0c\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u4e00\u4e2a Pod \u53ea\u80fd\u8fd0\u884c\u5728\u7279\u5b9a\u7684\u51e0\u4e2a\u8282\u70b9\u4e0a\uff0c\u6216\u8005\u8fd9\u51e0\u4e2a\u53ca\u8bf6\u70b9\u53ea\u80fd\u7528\u6765\u8fd0\u884c\u7279\u5b9a\u7c7b\u578b\u7684\u5e94\u7528\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u7684\u8c03\u5ea6\u5668\u80fd\u591f\u53ef\u63a7\u3002</p> <p>kube-scheduler \u662f Kubernetes \u7684\u8c03\u5ea6\u5668\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u6839\u636e\u7279\u5b9a\u7684\u8c03\u5ea6\u7b97\u6cd5\u548c\u8c03\u5ea6\u7b56\u7565\u5c06 Pod \u8c03\u5ea6\u5230\u5408\u9002\u7684 Node \u8282\u70b9\u4e0a\u53bb\uff0c\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u542f\u52a8\u4e4b\u540e\u4f1a\u4e00\u76f4\u76d1\u542c API Server\uff0c\u83b7\u53d6\u5230 PodSpec.NodeName\uff0c\u5bf9\u6bcf\u4e2a Pod \u90fd\u4f1a\u548c\u85cf\u5bb6\u4e00\u4e2a Binding\u3002</p> <p>\u8c03\u5ea6\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> <ul> <li> <p>\u9996\u5148\u662f\u9884\u9009\u8fc7\u7a0b\uff0c\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a Predicates\u3002</p> </li> <li> <p>\u7136\u540e\u662f\u4f18\u9009\u8fc7\u7a0b\uff0c\u5bf9\u901a\u8fc7\u7684\u8282\u70b9\u6309\u7167\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a Priorities\u3002</p> </li> <li> <p>\u6700\u540e\u4ece\u4e2d\u9009\u62e9\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u8282\u70b9\uff0c\u5982\u679c\u4e2d\u95f4\u4efb\u4f55\u4e00\u6b65\u6709\u9519\u8bef\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002</p> </li> </ul> <p>Predicates \u9636\u6bb5\u9996\u5148\u904d\u5386\u5168\u90e8\u8282\u70b9\uff0c\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8282\u70b9\uff0c\u5c5e\u4e8e\u5f3a\u5236\u6027\u89c4\u5219\uff0c\u8fd9\u4e00\u9636\u6bb5\u8f93\u51fa\u7684\u6240\u6709\u6ee1\u8db3\u8981\u6c42\u7684 Node \u5c06\u88ab\u8bb0\u5f55\u5e76\u4f5c\u4e3a\u7b2c\u4e8c\u9636\u6bb5\u7684\u8f93\u5165\uff0c\u5982\u679c\u6240\u6709\u7684\u8282\u70b9\u90fd\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48 Pod \u5c06\u4f1a\u4e00\u76f4\u5904\u4e8e Pending \u72b6\u6001\uff0c\u76f4\u5230\u8282\u70b9\u6ee1\u8db3\u6761\u4ef6\uff0c\u5728\u8fd9\u671f\u95f4\u8c03\u5ea6\u5668\u4f1a\u4e0d\u65ad\u7684\u91cd\u8bd5\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5728\u90e8\u7f72\u5e94\u7528\u7684\u65f6\u5019\uff0c\u5982\u679c\u53d1\u73b0\u6709 Pod \u4e00\u76f4\u5904\u4e8e Pending \u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u662f\u6ca1\u6709\u6ee1\u8db3\u8c03\u5ea6\u6761\u4ef6\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u53bb\u68c0\u67e5\u4e0b\u8282\u70b9\u8d44\u6e90\u662f\u5426\u53ef\u7528\u3002</p> <p>Priorities \u9636\u6bb5\u5373\u518d\u6b21\u5bf9\u8282\u70b9\u8fdb\u884c\u7b5b\u9009\uff0c\u5982\u679c\u6709\u591a\u4e2a\u8282\u70b9\u90fd\u6ee1\u8db3\u6761\u4ef6\u7684\u8bdd\uff0c\u90a3\u4e48\u7cfb\u7edf\u4f1a\u6309\u7167\u8282\u70b9\u7684\u4f18\u5148\u7ea7\u5927\u5c0f\u5bf9\u8282\u70b9\u8fdb\u884c\u6392\u5e8f\uff0c\u6700\u540e\u9009\u62e9\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u8282\u70b9\u6765\u90e8\u7f72 Pod \u5e94\u7528\u3002</p> <p>\u800c Priorities \u4f18\u5148\u7ea7\u662f\u7531\u4e00\u7cfb\u5217\u952e\u503c\u5bf9\u7ec4\u6210\u7684\uff0c\u952e\u662f\u8be5\u8be5\u4f18\u5148\u7ea7\u7684\u540d\u79f0\uff0c\u503c\u662f\u5b83\u7684\u6743\u91cd\u503c\uff0c\u540c\u6837\uff0c\u6211\u4eec\u8fd9\u91cc\u7ed9\u5927\u5bb6\u5217\u4e3e\u51e0\u4e2a\u5177\u6709\u4ee3\u8868\u6027\u7684\u9009\u578b\u3002</p> \u9009\u9879 \u8bf4\u660e LeastRequestedPriority \u901a\u8fc7\u8ba1\u7b97 CPU \u548c\u5185\u5b58\u7684\u4f7f\u7528\u7387\u6765\u51b3\u5b9a\u6743\u91cd\uff0c\u4f7f\u7528\u7387\u8d8a\u4f4e\u6743\u91cd\u8d8a\u9ad8\u3002\u5f53\u7136\u6b63\u5e38\u4e5f\u662f\u8d44\u6e90\u4f7f\u7528\u7387\u8d8a\u4f4e\u6743\u91cd\u8d8a\u9ad8\uff0c\u80fd\u7ed9\u522b\u7684 Pod \u8fd0\u884c\u7684\u53ef\u80fd\u6027\u5c31\u8d8a\u5927\u3002 SelectorSpreadPriority \u4e3a\u4e86\u66f4\u597d\u7684\u9ad8\u53ef\u7528\uff0c\u5bf9\u540c\u5c5e\u4e00\u4e2a Deployment \u6216\u8005 RC \u4e0b\u9762\u7684\u7684\u591a\u4e2a Pod \u526f\u672c\uff0c\u5c3d\u91cf\u8c03\u5ea6\u5230\u591a\u4e2a\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u5f53\u4e00\u4e2a Pod \u88ab\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u53bb\u67e5\u627e\u8be5 Pod \u5bf9\u5e94\u7684 Controller\uff0c\u7136\u540e\u67e5\u770b\u8be5 Controller \u4e0b\u9762\u7684\u5df2\u5b58\u5728\u7684 Pod\uff0c\u8fd0\u884c Pod \u8d8a\u5c11\u7684\u8282\u70b9\u6743\u91cd\u8d8a\u9ad8\u3002 ImageLocalityPriority \u5c31\u662f\u5982\u679c\u67d0\u4e2a\u8282\u70b9\u4e0a\u5df2\u7ecf\u6709\u8981\u4f7f\u7528\u7684\u955c\u50cf\u4e86\uff0c\u955c\u50cf\u603b\u5927\u5c0f\u503c\u8d8a\u5927\uff0c\u6743\u91cd\u5c06\u5c31\u8d8a\u9ad8\u3002 NodeAffinityPriority \u8fd9\u4e2a\u5c31\u662f\u6839\u636e\u8282\u70b9\u7684\u4eb2\u548c\u6027\u6765\u8ba1\u7b97\u4e00\u4e2a\u6743\u91cd\u503c\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4_1","title":"4 \u8282\u70b9\u8d44\u6e90\u8c03\u5ea6\u4eb2\u548c\u6027","text":"<p>\u8282\u70b9\u4eb2\u548c\u6027\u89c4\u5219\uff1a\u786c\u4eb2\u548c\u6027 required\u3001\u8f6f\u4eb2\u548c\u6027 preferred\u3002</p> <p>\u786c\u4eb2\u548c\u6027\u89c4\u5219\u4e0d\u6ee1\u8db3\u65f6\uff0cPod \u4f1a\u7f6e\u4e8e Pending \u72b6\u6001\uff0c\u8f6f\u4eb2\u548c\u6027\u89c4\u5219\u4e0d\u6ee1\u8db3\u65f6\uff0c\u4f1a\u9009\u62e9\u4e00\u4e2a\u4e0d\u5339\u914d\u7684\u8282\u70b9\u3002\u5f53\u8282\u70b9\u6807\u7b7e\u6539\u53d8\u800c\u4e0d\u518d\u7b26\u5408\u6b64\u8282\u70b9\u4eb2\u548c\u6027\u89c4\u5219\u65f6\uff0c\u4e0d\u4f1a\u5c06 Pod \u4ece\u8be5\u8282\u70b9\u79fb\u51fa\uff0c\u4ec5\u5bf9\u65b0\u5efa\u7684 Pod \u5bf9\u8c61\u751f\u6548\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#41","title":"4.1 \u8282\u70b9\u786c\u4eb2\u548c\u6027","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app\nspec:\n  containers:\n    - { name: 'my-app', image: 'my-app:0.0.1' }\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n          - matchExpressions:\n              - { key: 'zone', operator: 'In', values: ['foo'] }\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#42","title":"4.2 \u8282\u70b9\u8f6f\u4eb2\u548c\u6027","text":"<p>\u67d4\u6027\u63a7\u5236\u903b\u8f91\uff0c\u5f53\u6761\u4ef6\u4e0d\u6ee1\u8db3\u65f6\uff0c\u80fd\u63a5\u53d7\u522b\u7f16\u6392\u4e0e\u5176\u5b83\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u8282\u70b9\u4e4b\u4e0a\uff0c\u6743\u91cd weight \u5b9a\u4e49\u4f18\u5148\u7ea7\uff0c1-100 \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u4f59\u8d8a\u9ad8\u3002</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-app\nspec:\n  selector:\n    matchLabels: { app: 'my-app' }\n  replicas: 2\n  template:\n    metadata:\n      name: my-app\n      labels: { app: 'my-app' }\n    spec:\n      containers:\n        - { name: 'my-app', image: 'my-app:0.0.1' }\n      affinity:\n        nodeAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n            - weight: 60\n              preference:\n                matchExpressions:\n                  - { key: 'zone', operator: 'In', values: ['foo'] }\n            - weight: 30\n              preference:\n                matchExpressions:\n                  - { key: 'ssd', operator: 'Exists', values: [] }\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#5-pod_1","title":"5 Pod \u8d44\u6e90\u8c03\u5ea6\u8c03\u5ea6\u4eb2\u548c\u6027","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#51-pod_1","title":"5.1 Pod \u786c\u4eb2\u548c\u8c03\u5ea6","text":"<p>Pod \u786c\u4eb2\u548c\u6027\u63cf\u8ff0\u4e00\u4e2a Pod \u4e0e\u5177\u6709\u67d0\u4e2a\u7279\u5f81\u7684\u73b0\u5b58 Pod \u8fd0\u884c\u4f4d\u7f6e\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5373\u9700\u554a\u54df\u4e8b\u5148\u5b58\u5728\u88ab\u4f9d\u8d56\u7684 Pod \u5bf9\u8c61\u3002</p> <pre><code>kubectl run tomcat --labels=\"app=tomcat\" --image=tomcat:latest\n</code></pre> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app\nspec:\n  containers:\n    - name: my-app\n      image: my-app:0.0.1\n  affinity:\n    podAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchExpressions:\n              - { key: 'app', operator: 'In', values: ['tomcat'] } # \u5f53\u524d Pod \u8981\u8ddf\u6807\u7b7e\u4e3a app \u503c\u4e3a tomcat \u7684 Pod \u5728\u4e00\u8d77\n          topologyKey: kubernetes.io/hostname # \u6839\u636e\u6311\u9009\u51fa\u6765\u7684 Pod \u6240\u6709\u8282\u70b9\u7684 hostname \u4f5c\u4e3a\u540c\u4e00\u4f4d\u7f6e\u7684\u5224\u5b9a\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#52-pod_1","title":"5.2 Pod \u8f6f\u4eb2\u548c\u8c03\u5ea6","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-app\nspec:\n  selector:\n    matchLabels: { app: 'my-app' }\n  replicas: 3\n  template:\n    metadata:\n      name: my-app\n      labels: { app: 'my-app' }\n    spec:\n      containers:\n        - { name: 'my-app', image: 'my-app:0.0.1' }\n      affinity:\n        podAffinity:\n          preferredDuringSchedulingIgnoredDuringExecution:\n            - weight: 80\n              podAffinityTerm:\n                topologyKey: zone\n                labelSelector:\n                  matchExpressions:\n                    - { key: 'app', operator: 'In', values: ['cache'] }\n            - weight: 20\n              podAffinityTerm:\n                topologyKey: zone\n                labelSelector:\n                  matchExpressions:\n                    - { key: 'app', operator: 'In', values: ['db'] }\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#53-pod","title":"5.3 Pod \u53cd\u4eb2\u548c\u7b56\u7565","text":"<p>Pod \u53cd\u4eb2\u5408\u8c03\u5ea6\u7528\u4e8e\u5206\u6563\u540c\u4e00\u7c7b\u5e94\u7528\uff0c\u8c03\u5ea6\u81f3\u4e0d\u540c\u7684\u533a\u57df\u3001\u673a\u67b6\u6216\u8282\u70b9\u7b49\uff0c\u5c06 <code>spec.affinity.podAffinity</code> \u66ff\u6362\u4e3a <code>sepc.affinity.podAntiAffinity</code>\u3002\u53cd\u4eb2\u548c\u7b56\u7565\u4e5f\u5206\u4e3a\u67d4\u6027\u7ea6\u675f\u548c\u5f3a\u5236\u7ea6\u675f\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#6","title":"6 \u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6","text":"<p>\u6c61\u70b9 taints \u662f\u5b9a\u4e49\u5728\u8282\u70b9\u4e0a\u7684\u952e\u503c\u578b\u6570\u636e\uff0c\u7528\u4e8e\u8ba9\u8282\u70b9\u62d2\u7edd\u5c06 Pod \u8c03\u5ea6\u8fd0\u884c\u4e0e\u5176\u4e0a\uff0c\u9664\u975e Pod \u6709\u63a5\u7eb3\u6c61\u70b9\u7684\u5bb9\u5fcd\u5ea6\u3002\u5bb9\u5fcd\u5ea6 tolerations \u662f\u5b9a\u4e49\u5728 Pod \u4e0a\u7684\u952e\u503c\u578b\u6570\u636e\uff0c\u7528\u4e8e\u914d\u7f6e\u53ef\u5bb9\u5fcd\u7684\u6c61\u70b9\uff0c\u4e14\u8c03\u5ea6\u5668\u5c06 Pod \u8c03\u5ea6\u81f3\u5176\u80fd\u5bb9\u5fcd\u8be5\u8282\u70b9\u6c61\u70b9\u7684\u8282\u70b9\u4e0a\u6216\u6ca1\u6709\u6c61\u70b9\u7684\u8282\u70b9\u4e0a\u3002</p> <p>Kubernetes \u4f7f\u7528\u9884\u9009\u7b56\u7565\u548c\u4f18\u9009\u51fd\u6570\u5b8c\u6210\u8be5\u673a\u5236\u3002</p> <p>\u8282\u70b9\u4eb2\u548c\u6027\u4f7f\u5f97 Pod \u5bf9\u8c61\u88ab\u5438\u5f15\u5230\u4e00\u7c7b\u7279\u5b9a\u7684\u8282\u70b9\uff08nodeSelector \u548c affinity\uff09\uff0c\u6c61\u70b9\u63d0\u4f9b\u8ba9\u8282\u70b9\u6392\u65a5\u7279\u5b9a Pod \u5bf9\u8c61\u7684\u80fd\u529b\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#61","title":"6.1 \u5b9a\u4e49\u6c61\u70b9\u548c\u5bb9\u5fcd\u5ea6","text":"<p>\u6c61\u70b9\u5b9a\u4e49\u4e8e <code>nodes.spec.taints</code>\uff0c\u5bb9\u5fcd\u5ea6\u5b9a\u4e49\u4e8e <code>pods.spec.tolerations</code>\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#62","title":"6.2 \u5b9a\u4e49\u6392\u65a5\u7b49\u7ea7","text":"<ul> <li>NoSchedule\uff0c\u4e0d\u80fd\u5bb9\u5fcd\uff0c\u4f46\u4ec5\u5f71\u54cd\u8c03\u5ea6\u8fc7\u7a0b\uff0c\u5df2\u8c03\u5ea6\u4e0a\u53bb\u7684 Pod \u4e0d\u53d7\u5f71\u54cd\uff0c\u4ec5\u5bf9\u65b0\u589e\u52a0\u7684 Pod \u751f\u6548\u3002</li> <li>PreferNoSchedule\uff0c\u67d4\u6027\u7ea6\u675f\uff0c\u8282\u70b9\u73b0\u5b58 Pod \u4e0d\u53d7\u5f71\u54cd\uff0c\u5982\u679c\u5b9e\u5728\u662f\u6ca1\u6709\u7b26\u5408\u7684\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u8c03\u5ea6\u4e0a\u6765\u3002</li> <li>NoExecute\uff0c\u4e0d\u80fd\u5bb9\u5fcd\uff0c\u5f53\u6c61\u70b9\u53d8\u52a8\u65f6\uff0cPod \u5bf9\u8c61\u4f1a\u88ab\u9a71\u9010\u3002</li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#63-pod","title":"6.3 \u5728 Pod \u4e0a\u5b9a\u4e49\u5bb9\u5fcd\u5ea6","text":"<ul> <li>\u7b49\u503c\u6bd4\u8f83\uff0c\u5bb9\u5fcd\u5ea6\u4e0e\u6c61\u70b9\u5728 key\u3001value\u3001effect\uff08\u6392\u65a5\u7b49\u7ea7\uff09 \u4e09\u8005\u5b8c\u5168\u5339\u914d\u3002</li> <li>\u5b58\u5728\u6027\u5224\u65ad\uff0ckey\u3001effect \u5b8c\u5168\u5339\u914d\uff0cvalue \u4f7f\u7528\u7a7a\u503c\u3002</li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#64","title":"6.4 \u7ba1\u7406\u8282\u70b9\u4e0a\u7684\u6c61\u70b9","text":"<p>\u540c\u4e00\u4e2a\u952e\u503c\u6570\u636e\uff0ceffect \u4e0d\u540c\uff0c\u4e5f\u5c5e\u4e8e\u4e0d\u540c\u7684\u6c61\u70b9\u3002</p> <ul> <li> <p>\u7ed9\u8282\u70b9\u6dfb\u52a0\u6c61\u70b9</p> <pre><code>kubectl taint node node2 node-type=production:NoSchedule\n</code></pre> </li> <li> <p>\u67e5\u770b\u8282\u70b9\u6c61\u70b9</p> <pre><code>kubectl get nodes &lt;node-name&gt; -o go-template={{.spec.taints}}\n</code></pre> </li> <li> <p>\u5220\u9664\u8282\u70b9\u6c61\u70b9</p> <pre><code>kubectl taint node node1 node-type=production:NoSchedule\n\n# \u5220\u9664\u6240\u6709\u6c61\u70b9\nkubectl patch nodes node1 -p '{\"spec\": {\"taints\": []}}'\n</code></pre> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#65","title":"6.5 \u95ee\u9898\u8282\u70b9\u6807\u8bc6","text":"<p>K8S \u6838\u5fc3\u7ec4\u4ef6\u901a\u5e38\u90fd\u5bb9\u5fcd\u6b64\u7c7b\u6c61\u70b9\u3002</p> \u6c61\u70b9 \u8bf4\u660e <code>node.kubernetes.io/not-ready</code> \u8282\u70b9\u8fdb\u5165 NotReady \u72b6\u6001\u65f6\u81ea\u52a8\u6dfb\u52a0\u3002 <code>node.alpha.kubernetes.io/unreachable</code> \u8282\u70b9\u8fdb\u5165 NotReachable \u72b6\u6001\u65f6\u81ea\u52a8\u6dfb\u52a0\u3002 <code>node.kubernetes.io/out-of-disk</code> \u8282\u70b9\u8fdb\u5165 OutOfDisk \u72b6\u6001\u65f6\u81ea\u52a8\u6dfb\u52a0\u3002 <code>node.kubernetes.io/memory-pressure</code> \u8282\u70b9\u5185\u5b58\u8d44\u6e90\u9762\u4e34\u538b\u529b\u3002 <code>node.kubernetes.io/disk-pressure</code> \u8282\u70b9\u78c1\u76d8\u9762\u4e34\u538b\u529b <code>node.kubernetes.io/network-unavailable</code> \u8282\u70b9\u7f51\u7edc\u4e0d\u53ef\u7528 <code>node.cloudprovider.kubernetes.io/uninitialized</code> kubelet \u7531\u5916\u90e8\u4e91\u73af\u5883\u7a0b\u5e8f\u542f\u52a8\u65f6\u81ea\u52a8\u6dfb\u52a0\uff0c\u5f85\u5230\u63a7\u5236\u5668\u521d\u59cb\u5316\u6b64\u8282\u70b9\u65f6\u518d\u5c06\u5176\u5220\u9664\u3002"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#7-pod","title":"7 Pod \u4f18\u5148\u7ea7\u548c\u62a2\u5360\u5f0f\u8c03\u5ea6","text":"<p>\u4f18\u9009\u7ea7\u4f1a\u5f71\u54cd\u8282\u70b9\u4e0a Pod \u7684\u8c03\u5ea6\u987a\u5e8f\u548c\u9a71\u9010\u6b21\u5e8f\u3002\u4e00\u4e2a Pod \u5bf9\u8c61\u65e0\u6cd5\u88ab\u8c03\u5ea6\u65f6\uff0c\u8c03\u5ea6\u5668\u4f1a\u5c1d\u8bd5\u62a2\u5360\uff08\u9a71\u9010\uff09\u8f83\u4f4e\u4f18\u5148\u7ea7\u7684 Pod \u5bf9\u8c61\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u8c03\u5ea6\u5f53\u524d Pod\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#8-pod","title":"8 Pod \u4f18\u5148\u7ea7\u548c\u62a2\u5360\u673a\u5236\u9ed8\u8ba4\u5904\u4e8e\u7981\u7528\u72b6\u6001","text":"<p>\u542f\u7528\uff1a\u540c\u65f6\u4e3a kube-apiserver\u3001kube-scheduler\u3001kubelet \u7a0b\u5e8f\u7684 <code>--feature-gates</code> \u6dfb\u52a0 <code>PodPriority=true</code>\u3002</p> <p>\u4f7f\u7528\uff1a\u4e8b\u5148\u521b\u5efa\u4f18\u5148\u7ea7\u7c7b\u522b\uff0c\u5e76\u5728\u521b\u5efa Pod \u8d44\u6e90\u65f6\u901a\u8fc7 <code>priorityClassName</code> \u5c5e\u6027\u6307\u5b9a\u6240\u5c5e\u4f18\u9009\u7ea7\u7c7b\u522b\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#rbac","title":"\u5341\u4e8c\u3001\u96c6\u7fa4\u5b89\u5168\u673a\u5236 RBAC","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1_2","title":"1 \u57fa\u672c\u6982\u5ff5","text":"<p>RBAC \u5728 K8S v1.5 \u4e2d\u5f15\u5165\uff0c\u5728 v1.6 \u7248\u672c\u65f6\u5347\u7ea7\u4e3a Beta \u7248\u672c\uff0c\u5e76\u6210\u4e3a kubeadm \u5b89\u88c5\u65b9\u5f0f\u4e0b\u7684\u9ed8\u8ba4\u9009\u578b\uff0c\u76f8\u5bf9\u4e8e\u5176\u5b83\u8bbf\u95ee\u63a7\u5236\u65b9\u5f0f\uff0c\u65b0\u7684 RBAC \u5177\u6709\u5982\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li>\u5bf9\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\u548c\u975e\u8d44\u6e90\u6743\u9650\u5747\u6709\u5b8c\u6574\u7684\u8986\u76d6\u3002</li> <li>\u6574\u4e2a RBAC \u5b8c\u5168\u7531\u51e0\u4e2a API \u5bf9\u8c61\u5b8c\u6210\uff0c\u540c\u5176\u5b83 API \u5bf9\u8c61\u4e00\u6837\uff0c\u53ef\u4ee5\u7528 kubectl \u6216 API \u8fdb\u884c\u64cd\u4f5c\u3002</li> <li>\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\u8c03\u6574\uff0c\u65e0\u9700\u91cd\u542f API Server\u3002</li> </ul> <p>\u8981\u4f7f\u7528 RBAC \u6388\u6743\uff0c\u9700\u8981\u5728 API Server \u7684\u542f\u52a8\u53c2\u6570\u4e2d\u52a0\u4e0a <code>--authorization-mode=RBAC</code>\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-rbac-api","title":"2 RBAC \u7684 API \u8d44\u6e90\u5bf9\u8c61\u8bf4\u660e","text":"<p>RBAC \u5f15\u5165\u4e86 4 \u4e2a\u65b0\u7684\u9876\u7ea7\u8d44\u6e90\u5bf9\u8c61\uff1aRole\u3001ClusterRole\u3001RoleBinding\u3001ClusterRoleBinding\u3002\u540c\u5176\u5b83 API \u8d44\u6e90\u5bf9\u8c61\u4e00\u6837\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 kubectl \u6216\u8005 API \u8c03\u7528\u7b49\u65b9\u5f0f\u64cd\u4f5c\u8fd9\u4e9b\u8d44\u6e90\u5bf9\u8c61\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#21-role","title":"2.1 Role\uff08\u89d2\u8272\uff09","text":"<p>\u4e00\u4e2a\u89d2\u8272\u5c31\u662f\u4e00\u7ec4\u6743\u9650\u7684\u96c6\u5408\uff0c\u8fd9\u91cc\u7684\u6743\u9650\u90fd\u662f\u8bb8\u53ef\u5f62\u5f0f\uff0c\u4e0d\u5b58\u5728\u62d2\u7edd\u7684\u89c4\u5219\u3002\u5728\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u7528 Role \u6765\u5b9a\u4e49\u4e00\u4e2a\u89d2\u8272\uff0c\u5982\u679c\u662f\u96c6\u7fa4\u7ea7\u522b\u7684\uff0c\u5c31\u9700\u8981\u4f7f\u7528 ClusterRole \u4e86\u3002\u89d2\u8272\u53ea\u80fd\u5bf9\u547d\u540d\u7a7a\u95f4\u5185\u7684\u8d44\u6e90\u8fdb\u884c\u6388\u6743\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u5b9a\u4e49\u7684\u89d2\u8272\u5177\u5907\u8bfb\u53d6 Pod \u7684\u6743\u9650\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: local\n  name: pod-reader\nrules:\n  - apiGroups: [''] # \u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u6838\u5fc3 API \u7fa4\n    resources: ['pods'] # \u652f\u6301\u7684\u8d44\u6e90\u5bf9\u8c61\u5217\u8868\uff0c\u4f8b\u5982\uff1apods\u3001deployments\u3001jobs \u7b49\n    verbs: ['get', 'watch', 'list'] # \u5bf9\u8d44\u6e90\u5bf9\u8c61\u7684\u64cd\u4f5c\u65b9\u6cd5\u5217\u8868\uff0c\u4f8b\u5982\uff1aget\u3001watch\u3001list\u3001delete\u3001replace \u7b49\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#22-clusterrole","title":"2.2 ClusterRole\uff08\u96c6\u7fa4\u89d2\u8272\uff09","text":"<p>\u96c6\u7fa4\u89d2\u8272\u9664\u4e86\u5177\u6709\u548c\u89d2\u8272\u4e00\u81f4\u7684\u547d\u540d\u7a7a\u95f4\u5185\u8d44\u6e90\u7684\u7ba1\u7406\u80fd\u529b\uff0c\u56e0\u5176\u96c6\u7fa4\u7ea7\u522b\u7684\u8303\u56f4\uff0c\u8fd8\u53ef\u4ee5\u7528\u4e8e\u4ee5\u4e0b\u7279\u6b8a\u5143\u7d20\u7684\u6388\u6743\u3002</p> <ul> <li>\u96c6\u7fa4\u8303\u56f4\u5185\u7684\u8d44\u6e90\uff0c\u4f8b\u5982 Node\u3002</li> <li>\u975e\u8d44\u6e90\u578b\u7684\u8def\u5f84\u3002</li> <li>\u5305\u542b\u5168\u90e8\u547d\u540d\u7a7a\u95f4\u7684\u8d44\u6e90\uff0c\u4f8b\u5982 Pods\u3002</li> </ul> <p>\u4e0b\u9762\u7684\u96c6\u7fa4\u89d2\u8272\u53ef\u4ee5\u8ba9\u7528\u6237\u6709\u6743\u8bbf\u95ee\u4efb\u610f\u4e00\u4e2a\u6216\u6240\u6709\u547d\u540d\u7a7a\u95f4\u7684 Secrets\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  # ClusterRole \u4e0d\u53d7\u9650\u4e8e\u547d\u540d\u7a7a\u95f4\n  name: secret-reader\nrules:\n  - apiGroups: ['']\n    resources: ['secrets']\n    verbs: ['get', 'watch', 'list']\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#23-rolebinding-clusterrolebinding","title":"2.3 RoleBinding\uff08\u89d2\u8272\u7ed1\u5b9a\uff09\u548c ClusterRoleBinding\uff08\u96c6\u7fa4\u89d2\u8272\u7ed1\u5b9a\uff09","text":"<p>\u89d2\u8272\u7ed1\u5b9a\u6216\u96c6\u7fa4\u89d2\u8272\u7ed1\u5b9a\u7528\u6765\u628a\u4e00\u4e2a\u89d2\u8272\u7ed1\u5b9a\u5230\u4e00\u4e2a\u76ee\u6807\u4e0a\uff0c\u7ed1\u5b9a\u76ee\u6807\u53ef\u4ee5\u662f User Group \u6216\u8005 Service Account\u3002\u4f7f\u7528 RoleBinding \u4e3a\u67d0\u4e2a\u547d\u540d\u7a7a\u95f4\u6388\u6743\uff0cClusterRoleBinding \u4e3a\u96c6\u7fa4\u8303\u56f4\u5185\u6388\u6743\u3002</p> <p>RoleBinding \u53ef\u4ee5\u5f15\u7528 Role \u8fdb\u884c\u6388\u6743\uff0c\u4e0b\u4f8b\u4e2d\u7684 RoleBinding \u5c06\u5728 default \u547d\u540d\u7a7a\u95f4\u628a pod-reader \u89d2\u8272\u6388\u4e88\u7528\u6237 jane\uff0c\u53ef\u4ee5\u8ba9 jane \u7528\u6237\u8bfb\u53d6 default \u547d\u540d\u7a7a\u95f4\u7684 Pod\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  namespace: default\n  name: read-pods\nsubjects:\n  - kind: User\n    name: jane\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  apiGroup: Role\n  kind: pod-reader\n  name: rbac.authorization.k8s.io\n</code></pre> <p>RoleBinding \u4e5f\u53ef\u4ee5\u5f15\u7528 ClusterRole\uff0c\u5bf9\u5c5e\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u5185 ClusterRole \u5b9a\u4e49\u7684\u8d44\u6e90\u4e3b\u4f53\u8fdb\u884c\u6388\u6743\u3002\u4e00\u79cd\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u96c6\u7fa4\u7ba1\u7406\u5458\u4e3a\u96c6\u7fa4\u8303\u56f4\u9884\u5148\u5b9a\u4e49\u597d\u4e00\u7ec4\u89d2\uff08ClusterRole\uff09\uff0c\u7136\u540e\u518d\u5404\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u91cd\u590d\u4f7f\u7528\u8fd9\u4e9b ClusterRole\u3002</p> <p>\u4f7f\u7528 RoleBinding \u7ed1\u5b9a\u96c6\u7fa4\u89d2\u8272 secret-reader\uff0c\u4f7f dave \u53ea\u80fd\u8bfb\u53d6 development \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 secret\uff1a</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  namespace: development\n  name: read-pods\nsubjects:\n  - kind: User\n    name: dave\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  apiGroup: ClusterRole\n  kind: secret-reader\n  name: rbac.authorization.k8s.io\n</code></pre> <p>\u96c6\u7fa4\u89d2\u8272\u7ed1\u5b9a\u4e2d\u7684\u89d2\u8272\u53ea\u80fd\u662f\u96c6\u7fa4\u89d2\u8272\uff0c\u7528\u4e8e\u8fdb\u884c\u96c6\u7fa4\u7ea7\u522b\u6216\u8005\u5bf9\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u751f\u6548\u6388\u6743\u3002\u5141\u8bb8 manager \u7ec4\u7684\u7528\u6237\u8bfb\u53d6\u4efb\u610f Namespace \u4e2d\u7684 secret\uff1a</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: read-secrets-global\nsubjects:\n  - kind: Group\n    name: manager\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  apiGroup: ClusterRole\n  kind: secret-reader\n  name: rbac.authorization.k8s.io\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3_1","title":"3 \u5bf9\u8d44\u6e90\u7684\u5f15\u7528\u65b9\u5f0f","text":"<p>\u591a\u6570\u8d44\u6e90\u53ef\u4ee5\u7528\u5176\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u6765\u8868\u8fbe\uff0c\u4e5f\u5c31\u662f Endpoint \u4e2d\u7684 URL \u76f8\u5bf9\u8def\u5f84\uff0c\u4f8b\u5982 Pods\uff0c\u7136\u540e\uff0c\u67d0\u4e9b kubernetes API \u5305\u542b\u4e0b\u7ea7\u8d44\u6e90\uff0c\u4f8b\u5982 Pod \u7684\u65e5\u5fd7\uff0cPod \u65e5\u5fd7\u7684 Endpoint \u662f<code>GET /api/v1/namsepaces/{namespace}/pods/{name}/log</code>\u3002</p> <p>Pod \u662f\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u5185\u7684\u8d44\u6e90\uff0clog \u5c31\u662f\u4e00\u4e2a\u4e0b\u7ea7\u8d44\u6e90\u3002\u8981\u5728\u4e00\u4e2a RBAC \u89d2\u8272\u4e2d\u4f53\u73b0\uff0c\u5219\u9700\u8981\u7528\u659c\u7ebf\u6765\u5206\u9694\u8d44\u6e90\u548c\u4e0b\u7ea7\u8d44\u6e90\u3002\u82e5\u60f3\u6388\u6743\u8ba9\u67d0\u4e2a\u4e3b\u4f53\u540c\u65f6\u80fd\u591f\u8bfb\u53d6 Pod \u548c Pod log\uff0c\u5219\u53ef\u4ee5\u914d\u7f6e resources \u4e3a\u4e00\u4e2a\u6570\u7ec4\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: default\n  name: pod-and-logs-reader\nrules:\n  - apiGroups: ['']\n    resources: ['pods', 'pods/log']\n    verbs: ['get', 'list']\n</code></pre> <p>\u8d44\u6e90\u8fd8\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u8fdb\u884c\u5f15\u7528\u3002\u5728\u6307\u5b9a ResourceName \u540e\uff0c\u4f7f\u7528 get\u3001delete\u3001update\u3001patch \u52a8\u8bcd\u7684\u8bf7\u6c42\uff0c\u5c31\u4f1a\u88ab\u9650\u5236\u5728\u8fd9\u4e2a\u8d44\u6e90\u5b9e\u4f8b\u8303\u56f4\u5185\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u58f0\u660e\u8ba9\u4e00\u4e2a\u4e3b\u4f53\u53ea\u80fd\u5bf9\u4e00\u4e2a\u53eb my-configmap \u7684 ConfigMap \u8fdb\u884c get \u548c update \u64cd\u4f5c\u3002</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: default\n  name: configmap-updater\nrules:\n  - apiGroups: ['']\n    resources: ['configmap']\n    resourceNames: ['my-configmap']\n    verbs: ['get', 'update']\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4_2","title":"4 \u5e38\u89c1\u7684\u89d2\u8272\u793a\u4f8b","text":"<ul> <li> <p>\u5141\u8bb8\u8bfb\u53d6\u6838\u5fc3 API \u7ec4\u4e2d Pod \u7684\u8d44\u6e90</p> <pre><code>rules:\n  - apiGroups: ['']\n    resources: ['pods']\n    verbs: ['get', 'list', 'watch']\n</code></pre> </li> <li> <p>\u5141\u8bb8\u8bfb\u5199 extensions \u548c app \u4e24\u4e2a API \u7ec4\u4e2d\u7684 deployment \u8d44\u6e90</p> <pre><code>rules:\n  - apiGroups: ['extensions', 'app']\n    resources: ['deployments']\n    verbs: ['get', 'list', 'watch', 'create', 'update', 'patch', 'delete']\n</code></pre> </li> <li> <p>\u5141\u8bb8\u8bfb\u5199 Pods \u548c Jobs</p> <pre><code>rules:\n  - apiGroups: ['']\n    resources: ['pods']\n    verbs: ['get', 'list', 'watch']\n  - apiGroups: ['batch', 'extensions']\n    resources: ['jobs']\n    verbs: ['get', 'list', 'watch', 'create', 'update', 'patch', 'delete']\n</code></pre> </li> <li> <p>\u5141\u8bb8\u8bfb\u53d6\u4e00\u4e2a\u540d\u4e3a my-config \u7684 ConfigMap\uff08\u5fc5\u987b\u7ed1\u5b9a\u5230\u4e00\u4e2a RoleBinding \u6765\u9650\u5236\u5230\u4e00\u4e2a Namespace \u4e0b\u7684 ConfigMap\uff09</p> <pre><code>rules:\n  - apiGroups: ['']\n    resources: ['configmaps']\n    verbs: ['get']\n</code></pre> </li> <li> <p>\u8bfb\u53d6\u6838\u5fc3\u7ec4\u7684 Node \u8d44\u6e90\uff08Node \u5c5e\u4e8e\u96c6\u7fa4\u7ea7\u522b\u7684\u8d44\u6e90\uff0c\u5fc5\u987b\u653e\u5728 ClusterRole \u4e2d\uff0c\u5e76\u4f7f\u7528 ClusterRoleBinding \u8fdb\u884c\u7ed1\u5b9a\uff09</p> <pre><code>rules:\n  - apiGroups: [ '' ]\n    resources: [ 'nodes' 'list', 'watch' ]\n    verbs: [ 'get', ]\n</code></pre> </li> <li> <p>\u5141\u8bb8\u5bf9\u975e\u8d44\u6e90\u7aef\u70b9 <code>/healthz</code> \u53ca\u5176\u6240\u6709\u5b50\u8def\u5f84\u8fdb\u884c GET/POST \u64cd\u4f5c\uff08\u5fc5\u987b\u4f7f\u7528 ClusterRole \u548c ClusterRoleBinding\uff09</p> <pre><code>rules:\n  - nonResourceURLs: ['/healthz', '/healthz/*']\n    verbs: ['get', 'post']\n</code></pre> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#5","title":"5 \u5e38\u89c1\u7684\u89d2\u8272\u7ed1\u5b9a","text":"<ul> <li> <p>\u7528\u6237\u540d <code>Alice@example.com</code></p> <pre><code>subjects:\n  - kind: User\n    name: 'Alice@example.com'\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>\u7ec4\u540d <code>frontend-admins</code></p> <pre><code>subjects:\n  - kind: Group\n    name: 'frontend-admins'\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>kube-admin \u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u9ed8\u8ba4 ServiceAccount</p> <pre><code>subjects:\n  - kind: ServiceAccount\n    namespace: kube-system\n    name: default\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>qa \u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709 ServiceAccount</p> <pre><code>subjects:\n  - kind: ServiceAccount\n    name: system:serviceaccounts:qa\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>\u6240\u6709 ServiceAccount</p> <pre><code>subjects:\n  - kind: Group\n    name: system:serviceaccounts\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>\u6240\u6709\u8ba4\u8bc1\u7528\u6237</p> <pre><code>subjects:\n  - kind: Group\n    name: system:authentication\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>\u6240\u6709\u672a\u8ba4\u8bc1\u7528\u6237</p> <pre><code>subjects:\n  - kind: Group\n    name: system:unauthentication\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> <li> <p>\u5168\u90e8\u7528\u6237</p> <pre><code>subjects:\n  - kind: Group\n    name: system:authentication\n    apiGroup: rbac.authorization.k8s.io\n  - kind: Group\n    name: system:unauthentication\n    apiGroup: rbac.authorization.k8s.io\n</code></pre> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#6_1","title":"6 \u9ed8\u8ba4\u7684\u89d2\u8272\u548c\u89d2\u8272\u7ed1\u5b9a","text":"<p>API Server \u4f1a\u521b\u5efa\u4e00\u5957\u9ed8\u8ba4\u7684 ClusterRole \u548c ClusterRoleBinding \u5bf9\u8c61\uff0c\u5176\u4e2d\u5f88\u591a\u662f\u4ee5 <code>system:</code> \u4e3a\u524d\u7f00\u7684\uff0c\u4ee5\u8868\u660e\u8fd9\u4e9b\u8d44\u6e90\u5c5e\u4e8e\u57fa\u7840\u67b6\u6784\uff0c\u5bf9\u8fd9\u4e9b\u5bf9\u8c61\u7684\u6539\u52a8\u53ef\u80fd\u9020\u6210\u96c6\u7fa4\u6545\u969c\u3002</p> <p>\u6240\u6709\u9ed8\u8ba4\u7684 ClusterRole \u548c RoleBinding \u90fd\u4f1a\u7528\u6807\u7b7e <code>kubernetes.io/bootstrapping=rbac-defaults</code> \u8fdb\u884c\u6807\u8bb0\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#7","title":"7 \u6388\u6743\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#_3","title":"\u9884\u9632\u63d0\u6743\u548c\u6388\u6743\u521d\u59cb\u5316","text":"<p>RBAC API \u62d2\u7edd\u7528\u6237\u5229\u7528\u7f16\u8f91\u89d2\u8272\u6216\u8005\u89d2\u8272\u7ed1\u5b9a\u7684\u65b9\u5f0f\u8fdb\u884c\u63d0\u6743\u3002\u8fd9\u4e00\u9650\u5236\u662f\u5728 API \u5c42\u9762\u4f5c\u51fa\uff0c\u56e0\u6b64\u5373\u4f7f RBAC \u6ca1\u6709\u542f\u7528\u4e5f\u4ecd\u7136\u6709\u6548\u3002</p> <p>\u7528\u6237\u53ea\u80fd\u5728\u62e5\u6709\u4e00\u4e2a\u89d2\u8272\u7684\u6240\u6709\u6743\u9650\uff0c\u4e14\u4e0e\u8be5\u89d2\u8272\u7684\u751f\u6548\u8303\u56f4\u4e00\u81f4\u7684\u524d\u63d0\u4e0b\uff0c\u624d\u80fd\u5bf9\u89d2\u8272\u8fdb\u884c\u521b\u5efa\u548c\u66f4\u65b0\u3002\u4f8b\u5982\u7528\u6237 user-1 \u6ca1\u6709\u5217\u51fa\u96c6\u7fa4\u4e2d\u6240\u6709 Secret \u7684\u6743\u9650\uff0c\u5c31\u4e0d\u80fd\u521b\u5efa\u5177\u6709\u8fd9\u4e00\u6743\u9650\u7684\u96c6\u7fa4\u89d2\u8272\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#_4","title":"\u5341\u4e09\u3001\u6027\u80fd\u76d1\u63a7\u5e73\u53f0","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1_3","title":"1 \u6982\u8ff0","text":"<p>\u5f00\u6e90\u8f6f\u4ef6 cAdvisor\uff08Container Advisor\uff09\u7528\u4e8e\u76d1\u63a7\u6240\u5728\u8282\u70b9\u7684\u5bb9\u5668\u8fd0\u884c\u72b6\u6001\uff0c\u5f53\u524d\u5df2\u7ecf\u88ab\u9ed8\u8ba4\u96c6\u6210\u5230 kubelet \u7ec4\u4ef6\u5185\uff0c\u9ed8\u8ba4\u4f7f\u7528 TCP 4194 \u7aef\u53e3\u3002\u5728\u5927\u89c4\u6a21\u5bb9\u5668\u96c6\u7fa4\uff0c\u4e00\u822c\u4f7f\u7528 Heapster + InfluxDB + Grafana \u5e73\u53f0\u5b9e\u73b0\u96c6\u7fa4\u6027\u80fd\u6570\u636e\u7684\u91c7\u96c6\u3001\u5b58\u50a8\u4e0e\u5c55\u793a\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2_1","title":"2 \u5c55\u793a\u51c6\u5907","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#21_2","title":"2.1 \u57fa\u7840\u73af\u5883","text":"<p>Kubernetes + Heapster + InfluxDB + Grafana\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#23_2","title":"2.3 \u539f\u7406","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#231-heapster","title":"2.3.1 Heapster","text":"<p>\u96c6\u7fa4\u4e2d\u5404 Node \u8282\u70b9\u7684 cAdvisor \u7684\u6570\u636e\u91c7\u96c6\u6c47\u805a\u7cfb\u7edf\uff0c\u901a\u8fc7\u8c03\u7528 Node \u4e0a kubelet \u7684 API\uff0c\u518d\u901a\u8fc7 kubelet \u8c03\u7528 cAdvisor \u7684 API \u6765\u91c7\u96c6\u6240\u5728\u8282\u70b9\u4e0a\u6240\u6709\u5bb9\u5668\u7684\u6027\u80fd\u548c\u6570\u636e\u3002Heapster \u5bf9\u6027\u80fd\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u5e76\u5c06\u7ed3\u6784\u4fdd\u5b58\u5230\u540e\u7aef\u5b58\u50a8\u7cfb\u7edf\uff0cHeapster \u652f\u6301\u591a\u79cd\u540e\u7aef\u5b58\u50a8\u7cfb\u7edf\uff0c\u5982 Memory\u3001Influxed \u7b49\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#232-influxdb","title":"2.3.2 InfluxDB","text":"<p>\u5206\u5e03\u5f0f\u65f6\u5e8f\u6570\u636e\u5e93\uff08\u6bcf\u6761\u8bb0\u5f55\u90fd\u5e26\u6709\u65f6\u95f4\u6233\u5c5e\u6027\uff09\uff0c\u4e3b\u8981\u7528\u4e8e\u5b9e\u65f6\u6570\u636e\u91c7\u96c6\uff0c\u65f6\u95f4\u8ddf\u8e2a\u8bb0\u5f55\uff0c\u5b58\u50a8\u65f6\u95f4\u56fe\u8868\uff0c\u539f\u59cb\u6570\u636e\u7b49\u3002InfluxDB \u63d0\u4f9b REST API \u7528\u4e8e\u6570\u636e\u7684\u5b58\u50a8\u4e0e\u67e5\u8be2\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#233-grafana","title":"2.3.3 Grafana","text":"<p>\u901a\u8fc7 Dashboard \u5c06 InfluxDB \u4e2d\u7684\u65f6\u5e8f\u6570\u636e\u5c55\u73b0\u6210\u56fe\u8868\u6216\u66f2\u7ebf\u7b49\u5f62\u5f0f\uff0c\u4fbf\u4e8e\u67e5\u770b\u96c6\u7fa4\u8fd0\u884c\u72b6\u6001\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#helm","title":"\u5341\u56db\u3001Helm","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#1-helm","title":"1 Helm \u5f15\u5165","text":"<p>K8S \u4e0a\u7684\u5e94\u7528\u5bf9\u8c61\uff0c\u90fd\u662f\u7531\u7279\u5b9a\u7684\u8d44\u6e90\u63cf\u8ff0\u7ec4\u6210\uff0c\u5305\u62ec Deployment\u3001Service \u7b49\u3002\u90fd\u4fdd\u5b58\u5404\u81ea\u6587\u4ef6\u4e2d\u6216\u8005\u96c6\u4e2d\u5199\u5230\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e <code>kubectl apply -f</code> \u90e8\u7f72\u3002</p> <p>\u5982\u679c\u5e94\u7528\u53ea\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u8fd9\u6837\u7684\u670d\u52a1\u7ec4\u6210\uff0c\u4e0a\u9762\u90e8\u7f72\u65b9\u5f0f\u8db3\u591f\u4e86\u3002\u800c\u5bf9\u4e8e\u4e00\u4e2a\u590d\u6742\u7684\u5e94\u7528\uff0c\u4f1a\u6709\u5f88\u591a\u7c7b\u4f3c\u4e0a\u9762\u7684\u8d44\u6e90\u63cf\u8ff0\u6587\u4ef6\uff0c\u4f8b\u5982\u5fae\u670d\u52a1\u67b6\u6784\u5e94\u7528\uff0c\u7ec4\u6210\u5e94\u7528\u7684\u670d\u52a1\u53ef\u80fd\u591a\u8fbe\u5341\u4e2a\u3001\u51e0\u5341\u4e2a\u3002\u5982\u679c\u6709\u66f4\u65b0\u6216\u56de\u6eda\u5e94\u7528\u7684\u9700\u6c42\uff0c\u53ef\u80fd\u8981\u4fee\u6539\u548c\u7ef4\u62a4\u6240\u6d89\u53ca\u7684\u5927\u91cf\u8d44\u6e90\u6587\u4ef6\uff0c\u800c\u8fd9\u79cd\u7ec4\u7ec7\u548c\u7ba1\u7406\u5e94\u7528\u7684\u65b9\u5f0f\u5c31\u663e\u5f97\u529b\u4e0d\u4ece\u5fc3\u4e86\u3002\u4e14\u7531\u4e8e\u7f3a\u5c11\u5bf9\u53d1\u5e03\u8fc7\u7684\u5e94\u7528\u7248\u672c\u7ba1\u7406\u548c\u63a7\u5236\uff0c\u4f7f Kubernetes \u4e0a\u7684\u5e94\u7528\u7ef4\u62a4\u548c\u66f4\u65b0\u7b49\u9762\u4e34\u8bf8\u591a\u7684\u6311\u6218\uff0c\u4e3b\u8981\u9762\u4e34\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li> <p>\u5982\u4f55\u5c06\u8fd9\u4e9b\u670d\u52a1\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u7ba1\u7406</p> </li> <li> <p>\u8fd9\u4e9b\u8d44\u6e90\u6587\u4ef6\u5982\u4f55\u9ad8\u6548\u590d\u7528</p> </li> <li> <p>\u4e0d\u652f\u6301\u5e94\u7528\u7ea7\u522b\u7684\u7248\u672c\u7ba1\u7406</p> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#2-helm","title":"2 Helm \u4ecb\u7ecd","text":"<p>Helm \u662f\u4e00\u4e2a Kubernetes \u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5c31\u50cf Linux \u4e0b\u7684\u5305\u7ba1\u7406\u5668\uff0c\u5982 yum/apt \u7b49\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5c06\u4e4b\u524d\u6253\u5305\u597d\u7684 yaml \u6587\u4ef6\u90e8\u7f72\u5230 Kubernetes \u4e0a\u3002</p> <p>Helm \u6709\u4e09\u4e2a\u91cd\u8981\u6982\u5ff5\uff1a</p> <ul> <li> <p>helm\uff1a\u4e00\u4e2a\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u4e3b\u8981\u7528\u6237 Kubernetes \u5e94\u7528 Chart \u7684\u521b\u5efa\u3001\u6253\u5305\u3001\u53d1\u5e03\u548c\u7ba1\u7406\u3002</p> </li> <li> <p>Chart\uff1a\u5e94\u7528\u63cf\u8ff0\uff0c\u4e00\u7cfb\u5217\u7528\u4e8e\u63cf\u8ff0 K8S \u8d44\u6e90\u76f8\u5173\u6587\u4ef6\u7684\u96c6\u5408\u3002</p> </li> <li> <p>Release\uff1a\u57fa\u4e8e Chart \u7684\u90e8\u7f72\u5b9e\u4f53\uff0c\u4e00\u4e2a Chart \u88ab Helm \u8fd0\u884c\u540e\u5c06\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u4e00\u4e2a Release\uff0c\u5c06\u5728 K8S \u4e2d\u521b\u5efa\u51fa\u771f\u5b9e\u8fd0\u884c\u7684\u8d44\u6e90\u5bf9\u8c61\u3002</p> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#3-helm-v3","title":"3 Helm v3 \u53d8\u5316","text":"<p>2019 \u5e74 11 \u6708 13 \u65e5\uff0cHelm \u56e2\u961f\u53d1\u5e03 Helm v3 \u7684\u7b2c\u4e00\u4e2a\u7248\u672c\uff0c\u8be5\u7248\u672c\u7684\u4e3b\u8981\u53d8\u5316\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u6700\u660e\u663e\u7684\u53d8\u5316\u5c31\u662f Tiller \u7684\u5220\u9664\u3002</p> </li> <li> <p>Release \u540d\u79f0\u53ef\u4ee5\u5728\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u91cd\u7528\u3002</p> </li> <li> <p>\u652f\u6301\u5c06 Chart \u63a8\u9001\u81f3 Docker \u955c\u50cf\u4ed3\u5e93\u4e2d\u3002</p> </li> <li> <p>\u5176\u5b83\u3002</p> </li> </ol>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#4-helm","title":"4 Helm \u5ba2\u6237\u7aef","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#41-chart","title":"4.1 \u914d\u7f6e\u56fd\u5185 Chart \u4ed3\u5e93","text":"<ul> <li> <p><code>https://mirror.azure.cn/kubernetes/charts/</code></p> </li> <li> <p><code>https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</code></p> </li> <li> <p><code>https://hub.kubeapps.com/charts/incubator</code></p> </li> </ul>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#411","title":"4.1.1 \u6dfb\u52a0\u5b58\u50a8\u5e93","text":"<pre><code>helm repo add stable https://mirror.azure.cn/kubernetes/charts\n\nhelm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\n\nhelm repo update\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#412","title":"4.1.2 \u67e5\u770b\u914d\u7f6e\u7684\u5b58\u50a8\u5e93","text":"<pre><code>helm repo list\n\nhelm search repo stable\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#413","title":"4.1.3 \u5220\u9664\u5b58\u50a8\u5e93","text":"<pre><code>helm repo remove aliyun\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#5-helm","title":"5 Helm \u57fa\u672c\u4f7f\u7528","text":""},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#51-helm","title":"5.1 \u4f7f\u7528 Helm \u90e8\u7f72\u4e00\u4e2a\u5e94\u7528","text":"<pre><code>helm search repo mysql\n\nhelm show chart stable/mysql\n\nhelm install mysql stable/mysql\n\nhelm list\n\nhelm status mysql\n</code></pre>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#52-chart","title":"5.2 \u5b89\u88c5\u524d\u81ea\u5b9a\u4e49 Chart \u914d\u7f6e\u9009\u9879","text":"<p>\u81ea\u5b9a\u4e49\u9009\u9879\u662f\u56e0\u4e3a\u5e76\u4e0d\u662f\u6240\u6709\u7684 Chart \u90fd\u80fd\u6309\u7167\u9ed8\u8ba4\u914d\u7f6e\u8fd0\u884c\u6210\u529f\uff0c\u53ef\u80fd\u4f1a\u9700\u8981\u4e00\u4e9b\u73af\u5883\u4f9d\u8d56\uff0c\u4f8b\u5982 PV\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49 Chart \u914d\u7f6e\u9009\u9879\uff0c\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u4f20\u9012\u914d\u7f6e\u6570\u636e\uff1a</p> <ul> <li> <p><code>--values</code>\uff08\u6216 <code>-f</code>\uff09\uff1a\u6307\u5b9a\u5e26\u6709\u8986\u76d6\u7684 YAML \u6587\u4ef6\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u6b21\uff0c\u6700\u53f3\u8fb9\u7684\u6587\u4ef6\u4f18\u5148\u3002</p> </li> <li> <p><code>--set</code>\uff1a\u5728\u547d\u4ee4\u884c\u4e0a\u6307\u5b9a\u66ff\u4ee3\u3002</p> </li> </ul> <p>\u5982\u679c\u4e24\u8005\u90fd\u7528\uff0c<code>--set</code> \u4f18\u5148\u7ea7\u66f4\u9ad8\u3002</p>"},{"location":"cloud-native/kubernetes/Kubernetes%20%E7%AC%94%E8%AE%B0/#_5","title":"Kubernetes \u7b14\u8bb0","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/","title":"Install kubernetes on ubuntu","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_1","title":"\u524d\u7f6e\u6761\u4ef6","text":"<pre><code>cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\n\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\ncat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\nsudo sysctl --system\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#containerd","title":"\u914d\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6 Containerd","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_2","title":"\u8bbe\u7f6e\u5b88\u62a4\u8fdb\u7a0b\u4ee3\u7406","text":"<pre><code>mkdir -p /etc/systemd/system/containerd.service.d\n\ncat &lt;&lt;- EOF &gt; /etc/systemd/system/containerd.service.d/proxy.conf\n[Service]\nEnvironment=\"HTTP_PROXY=http://192.192.192.10:7890\"\nEnvironment=\"HTTPS_PROXY=http://192.192.192.10:7890\"\nEOF\n\nsystemctl daemon-reload &amp;&amp; systemctl restart containerd\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#cgroup","title":"\u8bbe\u7f6e Cgroup","text":"<pre><code>sed -i 's#SystemdCgroup = false#SystemdCgroup = true#g' /etc/containerd/config.toml\n\nsystemctl restart containerd\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#kubeletkubeadmkubectl","title":"\u5b89\u88c5 <code>kubelet</code>\u3001<code>kubeadm</code>\u3001<code>kubectl</code>","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_3","title":"\u8bf4\u660e","text":"<ul> <li><code>kubeadm</code>\uff1a\u7528\u6765\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u6307\u4ee4\u3002</li> <li><code>kubelet</code>\uff1a\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7528\u6765\u542f\u52a8 Pod \u548c\u5bb9\u5668\u7b49\u3002</li> <li><code>kubectl</code>\uff1a\u7528\u6765\u4e0e\u96c6\u7fa4\u901a\u4fe1\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002</li> </ul>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_4","title":"\u8bbe\u7f6e\u4ee3\u7406","text":"<pre><code>alias set-proxy='export http_proxy=http://192.192.192.10:7890 https_proxy=http://192.192.192.10:7890'\nalias unset-proxy='unset http_proxy https_proxy'\n\nset-proxy\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_5","title":"\u5b89\u88c5","text":"<pre><code>apt-get update &amp;&amp; apt-get install -y apt-transport-https\n\ncurl -o /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg\n\ncat &lt;&lt;- EOF &gt; /etc/apt/sources.list.d/kubernetes.list\ndeb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\nEOF\n\napt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl\n\napt-mark hold kubelet kubeadm kubectl\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#kubectl","title":"<code>kubectl</code> \u81ea\u52a8\u8865\u5168","text":"<pre><code>kubectl completion bash | sudo tee /etc/bash_completion.d/kubectl &gt; /dev/null\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#flanneld","title":"\u5b89\u88c5 <code>flanneld</code>","text":"<pre><code>mkdir -p /opt/bin &amp;&amp; wget -O /opt/bin/flanneld https://github.com/flannel-io/flannel/releases/download/v0.17.0/flanneld-amd64\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_6","title":"\u62c9\u53d6\u955c\u50cf","text":"<pre><code>crictl config runtime-endpoint unix:///run/containerd/containerd.sock\n</code></pre> <pre><code>kubeadm config images list\n\nkubeadm config images pull\n\n# kubeadm config images list | xargs nerdctl pull --namespace k8s.io\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_7","title":"\u521b\u5efa\u96c6\u7fa4","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_8","title":"\u53d6\u6d88\u4ee3\u7406","text":"<pre><code>unset http_proxy https_proxy\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_9","title":"\u91cd\u7f6e\u96c6\u7fa4","text":"<pre><code>kubeadm reset\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_10","title":"\u521d\u59cb\u5316\u96c6\u7fa4","text":"<pre><code>kubeadm init --pod-network-cidr=10.244.0.0/16\n\nkubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml\n</code></pre> <pre><code>cat &lt;&lt;- EOF &gt;&gt; /etc/bash.bashrc\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nEOF\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_11","title":"\u52a0\u5165\u96c6\u7fa4","text":"<ul> <li> <p>\u521b\u5efa Token</p> <pre><code>kubeadm token create --print-join-command\n</code></pre> </li> </ul>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_12","title":"\u8bbe\u7f6e\u4e3b\u8282\u70b9\u53ef\u8c03\u5ea6","text":"<pre><code>kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master-\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#kubernetes-dashboard","title":"\u5b89\u88c5 <code>kubernetes-dashboard</code>","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_13","title":"\u521b\u5efa\u8d44\u6e90","text":"<pre><code>wget -O kubernetes-dashboard.yaml https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.1/aio/deploy/recommended.yaml\n\n# \u5c06 ClusterIP \u4fee\u6539\u4e3a NodePort\n\nkubectl apply -f kubernetes-dashboard.yaml\n</code></pre> <pre><code>kubectl create serviceaccount admin-user --namespace=kubernetes-dashboard\n\nkubectl create clusterrolebinding admin-user --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:admin-user\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#token","title":"\u83b7\u53d6 Token","text":"<pre><code>kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=\"{.secrets[0].name}\") -o go-template=\"{{.data.token | base64decode}}\"\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#helm","title":"Helm","text":""},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_14","title":"\u5b89\u88c5","text":"<pre><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n</code></pre>"},{"location":"cloud-native/kubernetes/install%20kubernetes%20on%20ubuntu/#_15","title":"\u81ea\u52a8\u8865\u5168","text":"<pre><code>helm completion bash &gt; /etc/bash_completion.d/helm\n</code></pre>"},{"location":"container-app/clash/","title":"Clash","text":""},{"location":"container-app/clash/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"container-app/clash/#_2","title":"\u7ec8\u7aef\u8bbe\u7f6e\u4ee3\u7406","text":"<pre><code>tee &gt; /etc/profile.d/custom.sh &lt;&lt;- 'EOF'\nfunction start-proxy() {\n    export http_proxy=http://127.0.0.1:7890\n    export https_proxy=${http_proxy}\n    export no_proxy=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16\n}\nfunction stop-proxy() {\n    unset http_proxy\n    unset https_proxy\n    unset no_proxy\n}\nEOF\n\nchmod +x /etc/profile.d/custom.sh\n\nsource /etc/profile\n</code></pre>"},{"location":"container-app/clash/#systemd","title":"Systemd \u8bbe\u7f6e\u4ee3\u7406","text":"<pre><code>mkdir -p /etc/systemd/system/docker.service.d\n\ntee /etc/systemd/system/docker.service.d/proxy.conf &gt; /dev/null &lt;&lt;- 'EOF'\n[Service]\nEnvironment=\"HTTP_PROXY=http://192.168.8.10:7890\"\nEnvironment=\"HTTPS_PROXY=http://192.168.8.10:7890\"\nEnvironment=\"NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16\"\nEOF\n</code></pre>"},{"location":"container-app/coredns/","title":"CoreDNS","text":""},{"location":"container-app/coredns/#dns","title":"\u81ea\u5b9a\u4e49 DNS \u670d\u52a1","text":""},{"location":"container-app/coredns/#docker-coredns","title":"Docker \u5b89\u88c5 CoreDNS","text":"<pre><code>mkdir -p /d/mount/coredns/\n\ncp -f Corefile /d/mount/coredns/\n\nnerdctl network create compose\n\nnerdctl compose up -d\n</code></pre>"},{"location":"container-app/coredns/#helm-coredns","title":"Helm \u5b89\u88c5 CoreDNS","text":"<pre><code>helm repo add coredns https://coredns.github.io/helm\n\nhelm repo update\n\nhelm upgrade coredns coredns/coredns --install --namespace coredns --create-namespace --values values.yaml --version 1.19.4\n</code></pre>"},{"location":"container-app/coredns/#k8s-dns","title":"\u5728 K8S \u96c6\u7fa4\u5185\u5f15\u5165\u81ea\u5b9a\u4e49 DNS \u670d\u52a1","text":"<pre><code>kubectl apply -f cm.yaml\n</code></pre>"},{"location":"container-app/coredns/#_1","title":"\u6d4b\u8bd5","text":"<pre><code>kubectl run -it --rm --restart=Never --image=infoblox/dnstools:latest dnstools\n</code></pre>"},{"location":"container-app/coredns/#todo","title":"TODO","text":"<ul> <li>\u76f4\u63a5\u4f7f\u7528 HelmChart \u90e8\u7f72\u81ea\u5b9a\u4e49 DNS \u670d\u52a1</li> </ul>"},{"location":"container-app/coredns/#_2","title":"\u5e38\u89c1\u95ee\u9898","text":"<ul> <li> <p><code>systemd-resolved</code> \u5360\u7528 53 \u7aef\u53e3</p> <pre><code>sed -i -e '/#DNSStubListener=/c DNSStubListener=no' -e '/#DNS=/c DNS=114.114.114.114' /etc/systemd/resolved.conf\n\nln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf\n\nsystemctl restart systemd-resolved\n</code></pre> </li> </ul>"},{"location":"container-app/dolphinscheduler/","title":"DolphinScheduler","text":""},{"location":"container-app/dolphinscheduler/#docker","title":"Docker","text":"<pre><code>sudo nerdctl compose --profile schema up -d\nsudo nerdctl compose --profile all    up -d\n</code></pre>"},{"location":"container-app/dolphinscheduler/#kubernetes","title":"Kubernetes","text":"<pre><code>git clone https://github.com/apache/dolphinscheduler.git\n\ncd dolphinscheduler/deploy/kubernetes/dolphinscheduler\n\n# \u4fee\u6539 HelmChart\n\nhelm install dolphinscheduler . --namespace dolphinscheduler --create-namespace --values ./values-override.yaml\n</code></pre>"},{"location":"container-app/dolphinscheduler/#helmchart","title":"\u4fee\u6539 HelmChart","text":"<ul> <li> <p><code>Charts.yaml</code></p> </li> <li> <p>ZooKeeper\uff1a<code>11.4.11</code> \u662f\u6700\u65b0\u4e00\u4e2a 11 \u7248\u672c\uff0c\u5bf9\u5e94 ZooKeeper \u7248\u672c\u4e3a <code>3.8.2</code>\u3002</p> </li> <li>PostgreSQL\uff1a<code>12.12.10</code> \u662f\u6700\u65b0\u4e00\u4e2a 12 \u7248\u672c\uff0c\u5bf9\u5e94 PostgreSQL \u7248\u672c\u4e3a <code>15.4.0</code>\u3002</li> <li>MySQL\uff1a<code>TODO</code>\u3002</li> <li> <p>MinIO\uff1a<code>11.10.26</code> \u662f\u6700\u65b0\u4e00\u4e2a 11 \u7248\u672c\uff0c\u5bf9\u5e94 MinIO \u7248\u672c\u4e3a <code>2022.12.12</code>\u3002</p> <pre><code>dependencies:\n  - name: postgresql\n    version: 12.12.10\n    repository: https://charts.bitnami.com/bitnami\n    condition: postgresql.enabled\n  - name: zookeeper\n    version: 11.4.11\n    repository: https://charts.bitnami.com/bitnami\n    condition: zookeeper.enabled\n  - name: mysql\n    version: 9.4.1\n    repository: https://charts.bitnami.com/bitnami\n    condition: mysql.enabled\n  - name: minio\n    version: 11.10.26\n    repository: https://charts.bitnami.com/bitnami\n    condition: minio.enabled\n</code></pre> </li> <li> <p><code>templates/_helpers.tpl</code></p> <ul> <li>Sub HelmChart \u9876\u7ea7 <code>params</code>\u3002</li> <li>Bitnami HelmChart \u666e\u901a\u6570\u636e\u5e93\u7528\u6237\u7684 Secret Key \u4e3a <code>database</code>\u3002</li> </ul> <pre><code>- name: SPRING_DATASOURCE_URL\n  {{- if .Values.postgresql.enabled }}\n  value: jdbc:postgresql://{{ template \"dolphinscheduler.postgresql.fullname\" . }}:5432/{{ .Values.postgresql.postgresqlDatabase }}?{{ .Values.postgresql.params }}\n  {{- else if .Values.mysql.enabled }}\n  value: jdbc:mysql://{{ template \"dolphinscheduler.mysql.fullname\" . }}:3306/{{ .Values.mysql.auth.database }}?{{ .Values.mysql.params }}\n  {{- else }}\n  value: jdbc:{{ .Values.externalDatabase.type }}://{{ .Values.externalDatabase.host }}:{{ .Values.externalDatabase.port }}/{{ .Values.externalDatabase.database }}?{{ .Values.externalDatabase.params }}\n  {{- end }}\n- name: SPRING_DATASOURCE_USERNAME\n  {{- if .Values.postgresql.enabled }}\n  value: {{ .Values.postgresql.auth.username }}\n  {{- else if .Values.mysql.enabled }}\n  value: {{ .Values.mysql.auth.username }}\n  {{- else }}\n  value: {{ .Values.externalDatabase.username | quote }}\n  {{- end }}\n- name: SPRING_DATASOURCE_PASSWORD\n  valueFrom:\n    secretKeyRef:\n      {{- if .Values.postgresql.enabled }}\n      name: {{ template \"dolphinscheduler.postgresql.fullname\" . }}\n      key: password\n      {{- else if .Values.mysql.enabled }}\n      name: {{ template \"dolphinscheduler.mysql.fullname\" . }}\n      key: password\n      {{- else }}\n      name: {{ include \"dolphinscheduler.fullname\" . }}-externaldb\n      key: database-password\n      {{- end }}\n</code></pre> </li> <li> <p><code>values.yaml</code></p> <ul> <li>Sub HelmChart \u9876\u7ea7 <code>params</code>\u3002</li> <li>PostgreSQL JDBC \u7684\u53c2\u6570\u66f4\u6362\u4e3a\u6709\u610f\u4e49\u7684\u503c\u3002https://jdbc.postgresql.org/documentation/use/#connection-parameters</li> </ul> <pre><code>postgresql:\n  enabled: true\n  driverClassName: 'org.postgresql.Driver'\n  params: 'stringtype=unspecified'\n  auth:\n    postgresPassword: postgres\n    username: dolphinscheduler\n    password: dolphinscheduler\n    database: dolphinscheduler\nmysql:\n  enabled: true\n  driverClassName: 'com.mysql.cj.jdbc.Driver'\n  params: 'characterEncoding=utf8'\n  auth:\n    rootPassword: root\n    username: dolphinscheduler\n    password: dolphinscheduler\n    database: dolphinscheduler\n</code></pre> </li> </ul>"},{"location":"container-app/dolphinscheduler/#_1","title":"\u96c6\u6210","text":""},{"location":"container-app/dolphinscheduler/#python","title":"Python","text":"<pre><code>bash ./Miniconda3-py311_23.10.0-1-Linux-x86_64.sh -b -p /opt/soft/python\n\nexport PYTHON_LAUNCHER=/opt/soft/python/bin/python\n</code></pre>"},{"location":"container-app/dolphinscheduler/#datax","title":"DataX","text":"<pre><code>wget https://datax-opensource.oss-cn-hangzhou.aliyuncs.com/202308/datax.tar.gz\n\ntar -zxvf ./datax.tar.gz /opt/soft\n</code></pre>"},{"location":"container-app/doris/","title":"Doris","text":""},{"location":"container-app/doris/#doris-operator","title":"Doris Operator","text":"<pre><code># \u6dfb\u52a0\u8d44\u6e90\u5b9a\u4e49\nkubectl apply -f https://raw.githubusercontent.com/selectdb/doris-operator/master/config/crd/bases/doris.selectdb.com_dorisclusters.yaml\n\n# \u90e8\u7f72 Doris Operator\nkubectl apply -f https://raw.githubusercontent.com/selectdb/doris-operator/master/config/operator/operator.yaml\n\n# \u90e8\u7f72 Doris \u96c6\u7fa4\nkubectl apply -f doris.yaml\n</code></pre>"},{"location":"container-app/doris/#_1","title":"\u8bbe\u7f6e\u5bc6\u7801","text":"<pre><code>set password for 'root' = password('root')\n</code></pre>"},{"location":"container-app/elasticsearch/","title":"Elasticsearch","text":""},{"location":"container-app/elasticsearch/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"container-app/elasticsearch/#x-pack","title":"\u4ea4\u4e92\u5f0f\u8bbe\u7f6e X-Pack \u5bc6\u7801\u8ba4\u8bc1","text":"<pre><code>bin/elasticsearch-setup-passwords interactive\n</code></pre>"},{"location":"container-app/elasticsearch/#_2","title":"\u6536\u85cf","text":"<ul> <li>ES8 unable to authenticate user [kibana_system] for REST request#10076</li> </ul> <pre><code>kibana:\n  elasticsearch:\n    security:\n      auth:\n        enabled: true\n        createSystemUser: true\n        kibanaPassword: kibana_system\n        elasticsearchPasswordSecret: elasticsearch\n      tls:\n        enabled: true\n        existingSecret: elasticsearch-master-crt\n        # coordinating-only\n        # existingSecret: elasticsearch-coordinating-crt\n        usePemCerts: true\n  ingress:\n    enabled: true\n    hostname: kibana.example.org\n</code></pre>"},{"location":"container-app/etcd/","title":"etcd","text":""},{"location":"container-app/etcd/#_1","title":"\u6d4b\u8bd5","text":"<pre><code>kubectl run etcd-client --restart=Never --image docker.io/bitnami/etcd:3.5 --env ETCDCTL_ENDPOINTS=etcd.etcd.svc.cluster.local:2379 --namespace etcd --command -- sleep infinity\nkubectl exec --namespace etcd -it etcd-client -- bash\n\netcdctl put /skydns/xyz/icefery/demo/x1 '{ \"host\": \"192.168.8.110\", \"ttl\": 60 }'\netcdctl get --prefix /skydns\n</code></pre>"},{"location":"container-app/external-dns/","title":"External-DNS","text":""},{"location":"container-app/external-dns/#_1","title":"\u5b89\u88c5","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade external-dns bitnami/external-dns --install --namespace kube-system --values values.yaml --version 6.7.4\n</code></pre>"},{"location":"container-app/gitlab/","title":"GitLab","text":""},{"location":"container-app/gitlab/#gitlab_1","title":"GitLab","text":""},{"location":"container-app/gitlab/#docker-gitlab","title":"Docker \u5b89\u88c5 GitLab","text":"<pre><code>nerdctl create network compose\n\nnerdctl compose up -d\n\nnerdctl exec -it gitlab cat /etc/gitlab/initial_root_password\n</code></pre>"},{"location":"container-app/gitlab/#helm-gitlab","title":"Helm \u5b89\u88c5 GitLab","text":"<pre><code># helm repo add gitlab http://charts.gitlab.io/\nhelm repo add gitlab-jh https://charts.gitlab.cn\n\nhelm repo update\n\n# helm upgrade gitlab gitlab/gitlab --install --namespace gitlab --create-namespace --values gitlab.yaml --version 6.3.2\nhelm upgrade gitlab gitlab-jh/gitlab --install --namespace gitlab --create-namespace --values gitlab.yaml --version 6.3.2\n\nkubectl get secret -n gitlab gitlab-gitlab-initial-root-password -ojsonpath='{.data.password}' | base64 --decode ; echo\n</code></pre>"},{"location":"container-app/gitlab/#gitlab-ci","title":"GitLab CI","text":"<p>\u6307\u5b9a\u81ea\u5b9a\u4e49 CI/CD \u914d\u7f6e\u6587\u4ef6</p>"},{"location":"container-app/gitlab/#gitlab-runner","title":"GitLab Runner","text":""},{"location":"container-app/gitlab/#shell","title":"Shell \u6267\u884c\u5668","text":"<pre><code>curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64\n\nchmod +x /usr/local/bin/gitlab-runner\n\n# \u76f4\u63a5\u4f7f\u7528 root \u7528\u6237\u8fd0\u884c runner \u4f46\u662f\u5de5\u4f5c\u76ee\u5f55\u4f9d\u7136\u5728\u539f\u5148\u7684\u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\nmkdir -p /home/gitlab-runner\n\ngitlab-runner install --user=root --working-directory=/home/gitlab-runner\n\ngitlab-runner start\n</code></pre>"},{"location":"container-app/gitlab/#ssh","title":"SSH \u6267\u884c\u5668","text":"<ul> <li> <p>\u751f\u6210 SSH \u79d8\u94a5</p> <pre><code>ssh-keygen -t rsa -q -N \"\" -f ~/.ssh/gitlab-runner\n\ncat ~/.ssh/gitlab-runner.pub &gt;&gt; ~/.ssh/authorized_keys\n</code></pre> </li> <li> <p>\u542f\u52a8\u5bb9\u5668</p> <pre><code>nerdctl compose -f gitlab-runner-ssh.compose.yaml up -d\n</code></pre> </li> <li> <p>\u6ce8\u518c</p> <pre><code>gitlab-runner register --url http://gitlab.dev.icefery.xyz/ --registration-token &lt;TOKEN&gt;\n</code></pre> </li> <li> <p>\u89e3\u51b3 <code>error: ssh: handshake failed: knownhosts: key is unknown</code></p> <pre><code>echo \"    disable_strict_host_key_checking = true\" &gt;&gt; /etc/gitlab-runner/config.toml\n\ngitlab-runner restart\n</code></pre> </li> </ul>"},{"location":"container-app/gitlab/#kubernetes","title":"Kubernetes \u6267\u884c\u5668","text":"<pre><code>helm repo add gitlab http://charts.gitlab.io/\n\nhelm repo update\n\nhelm upgrade gitlab-runner gitlab/gitlab-runner --install --namespace gitlab --create-namespace --values gitlab-runner.yaml --version 0.43.1\n</code></pre>"},{"location":"container-app/gitlab/#gitlab-agent","title":"GitLab Agent","text":""},{"location":"container-app/gitlab/#helm-gitlab-agent","title":"Helm \u5b89\u88c5 GitLab Agent","text":"<pre><code>helm repo add gitlab https://charts.gitlab.io\n\nhelm repo update\n\nhelm upgrade gitlab-agent gitlab/gitlab-agent \\\n  --install \\\n  --namespace gitlab \\\n  --create-namespace \\\n  --set image.tag=v15.2.0 \\\n  --set config.token=&lt;TOKEN&gt; \\\n  --set config.kasAddress=ws://kas.dev.icefery.xyz\n</code></pre>"},{"location":"container-app/gitlab/#gitlab-minio","title":"GitLab MinIO","text":""},{"location":"container-app/gitlab/#access-key-secrey-key","title":"\u67e5\u770b Access Key \u548c Secrey Key","text":"<pre><code>kubectl get -n gitlab secrets gitlab-minio-secret -ojsonpath='{.data.accesskey}' | base64 --decode\n\nkubectl get -n gitlab secrets gitlab-minio-secret -ojsonpath='{.data.secretkey}' | base64 --decode\n</code></pre>"},{"location":"container-app/gitlab/#_1","title":"\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"container-app/gitlab/#gitlab-ingress-controller-80-443","title":"GitLab \u5e76\u4e0d\u80fd\u8bc6\u522b Ingress Controller \u66b4\u9732\u7684\u975e 80 \u548c 443 \u4ee5\u5916\u7684\u7aef\u53e3","text":""},{"location":"container-app/grafana/","title":"Grafana","text":""},{"location":"container-app/greenplum/","title":"GreenPlum","text":""},{"location":"container-app/greenplum/#docker","title":"Docker","text":"<p>https://hub.docker.com/r/andruche/greenplum</p>"},{"location":"container-app/greenplum/#_1","title":"\u73af\u5883\u53d8\u91cf","text":"<pre><code>SHELL=/bin/bash\nMASTER_DATA_DIRECTORY=/data/master/gpsne-1/\nPWD=/home/gpadmin/\nLOGNAME=gpadmin\nHOME=/home/gpadmin/\nGPHOME=/usr/local/gpdb\nPYTHONPATH=/usr/local/gpdb/lib/python\nTERM=xterm\nUSER=gpadmin\nSHLVL=1\nLD_LIBRARY_PATH=/usr/local/gpdb/lib\nPS1=\\[\\033[1;35m\\][\\u@\\h \\W]\\[\\033[0;31m\\]$\\[\\033[0;37m\\]\nPATH=/usr/local/gpdb/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin\nMAIL=/var/mail/gpadmin\n_=/usr/bin/env\n</code></pre>"},{"location":"container-app/greenplum/#_2","title":"\u4fee\u6539\u5bc6\u7801","text":"<pre><code>su -l -s /bin/bash gpadmin\n\npsql -d postgres\n</code></pre> <pre><code>alter user gpadmin with password 'gpadmin';\n</code></pre>"},{"location":"container-app/harbor/","title":"Harbor","text":""},{"location":"container-app/harbor/#_1","title":"\u5b89\u88c5","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade harbor bitnami/harbor --install --namespace harbor --create-namespace --values values.yaml --version 15.1.0\n</code></pre>"},{"location":"container-app/harbor/#_2","title":"\u955c\u50cf\u4ed3\u5e93","text":""},{"location":"container-app/harbor/#containerd","title":"\u914d\u7f6e Containerd \u955c\u50cf\u4ed3\u5e93","text":"<ul> <li>https://github.com/containerd/containerd/blob/main/docs/cri/registry.md</li> <li>https://github.com/containerd/containerd/blob/main/docs/hosts.md</li> </ul> <ul> <li> <p><code>/etc/containerd/certs.d/docker.io/hosts.toml</code></p> <pre><code>server = \"https://registry-1.docker.io\"\n[host.\"https://uwk49ut2.mirror.aliyuncs.com\"]\n  capabilities = [\"pull\"]\n</code></pre> </li> <li> <p><code>/etc/containerd/certs.d/core.harbor.dev.icefery.xyz/hosts.toml</code></p> <pre><code>server = \"http://core.harbor.dev.icefery.xyz\"\n[host.\"http://core.harbor.dev.icefery.xyz\"]\n  skip_verify = true\n</code></pre> </li> <li> <p><code>/etc/containerd/config.toml</code></p> <p>Although we have deprecated the old CRI config pattern for specifying registry.mirrors and registry.configs you can still specify your credentials via CRI config .</p> <pre><code>version = 2\n\n[plugins.\"io.containerd.grpc.v1.cri\".registry]\n  config_path = \"/etc/containerd/certs.d\"\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\n  endpoint = [\"https://uwk49ut2.mirror.aliyuncs.com\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"core.harbor.dev.icefery.xyz\"]\n  endpoint = [\"http://core.harbor.dev.icefery.xyz\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"core.harbor.dev.icefery.xyz\".tls]\n  insecure_skip_verify = true\n[plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"core.harbor.dev.icefery.xyz\".auth]\n  username = \"admin\"\n  password = \"admin\"\n</code></pre> </li> </ul>"},{"location":"container-app/harbor/#k3s-containerd","title":"\u914d\u7f6e K3S \u5185\u7f6e Containerd \u955c\u50cf\u4ed3\u5e93","text":"<p>https://docs.rancher.cn/docs/k3s/installation/private-registry/_index</p> <ul> <li><code>/etc/rancher/k3s/registries.yaml</code> <pre><code>mirrors:\n  docker.io:\n    endpoint:\n      - 'https://uwk49ut2.mirror.aliyuncs.com'\n  'core.harbor.dev.icefery.xyz':\n    endpoint:\n      - 'http://core.harbor.dev.icefery.xyz'\nconfigs:\n  'core.harbor.dev.icefery.xyz':\n    tls:\n      insecure_skip_verify: true\n    auth:\n      username: admin\n      password: admin\n</code></pre></li> </ul>"},{"location":"container-app/harbor/#_3","title":"\u63a8\u9001\u955c\u50cf","text":"<p>nerdctl \u5e76\u4e0d\u8d70 CRI \u7684 <code>tls.insecure_skip_verify</code>\uff0c\u9700\u8981\u6dfb\u52a0 <code>--insecure-registry</code> \u9009\u9879\u3002</p> <pre><code>docker login http://core.harbor.dev.icefery.xyz --username=admin --password=admin\n\n# nerdctl login http://core.harbor.dev.icefery.xyz --username=admin --password=admin --insecure-registry\n</code></pre> <pre><code>docker push core.harbor.dev.icefery.xyz/library/my-app:0.0.1\n\n# nerdctl push core.harbor.dev.icefery.xyz/library/my-app:0.0.1 --insecure-registry\n</code></pre> <pre><code>docker pull core.harbor.dev.icefery.xyz/library/my-app:0.0.1\n\n# nerdctl pull core.harbor.dev.icefery.xyz/library/my-app:0.0.1 --insecure-registry\n</code></pre>"},{"location":"container-app/harbor/#chart","title":"Chart \u4ed3\u5e93","text":""},{"location":"container-app/harbor/#_4","title":"\u62c9\u53d6","text":"<pre><code># \u6dfb\u52a0 Harbor \u4f5c\u4e3a\u7edf\u4e00\u7684\u5355\u4e00\u7d22\u5f15\u5165\u53e3\u70b9\n# helm repo add chartmuseum-global http://core.harbor.dev.icefery.xyz/chartrepo --username=admin --password=admin\n\n# \u5c06 Harbor \u9879\u76ee\u6dfb\u52a0\u4e3a\u5355\u72ec\u7684\u7d22\u5f15\u5165\u53e3\u70b9\nhelm repo add chartmuseum-library http://core.harbor.dev.icefery.xyz/chartrepo/library --username=admin --password=admin\n</code></pre> <pre><code>helm search repo my-app\n</code></pre>"},{"location":"container-app/harbor/#_5","title":"\u63a8\u9001","text":"<pre><code>helm plugin install https://github.com/chartmuseum/helm-push\n</code></pre> <pre><code># helm cm-push chart/ http://core.harbor.dev.icefery.xyz/chartrepo/library --username=admin --password=admin\n\nhelm cm-push chart/ chartmuseum-library\n</code></pre> <p>\u76f4\u63a5\u63a8\u9001\u5230\u5df2\u6dfb\u52a0\u7684\u4ed3\u5e93\u4e2d\u4e0d\u9700\u8981\u518d\u9a8c\u8bc1\u7528\u6237\u548c\u5bc6\u7801\uff0c\u4f46\u662f\u4f7f\u7528 Harbor \u4f5c\u4e3a\u7edf\u4e00\u7684\u5355\u4e00\u7d22\u5f15\u5165\u53e3\u70b9\u65f6\u4f1a\u9ed8\u8ba4\u63a8\u9001\u5230 <code>library</code> \u9879\u76ee\u3002</p>"},{"location":"container-app/harbor/#_6","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"container-app/harbor/#docker-push-http","title":"Docker \u65e0\u6cd5 <code>push</code> \u5230 HTTP \u955c\u50cf\u4ed3\u5e93","text":"<p>docker pull push invalid character 'p' after top-level value: \"404 page not found\\n\" #12248</p>"},{"location":"container-app/influxdb/","title":"InfluxDB","text":""},{"location":"container-app/jenkins/","title":"Jenkins","text":""},{"location":"container-app/jenkins/#install","title":"Install","text":""},{"location":"container-app/jenkins/#helm","title":"Helm","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade jenkins bitnami/jenkins --install --namespace jenkins --create-namespace --values values-bitnami.yaml --version 11.0.0\n</code></pre>"},{"location":"container-app/kafka/","title":"Kafka","text":""},{"location":"container-app/kafka/#install","title":"Install","text":""},{"location":"container-app/kafka/#docker","title":"Docker","text":"<pre><code>mkdir -p /d/mount/kafka\n\nchmod 777 -R /d/mount/kafka\n</code></pre>"},{"location":"container-app/kafka/#helm","title":"Helm","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm upgrade kafka bitnami/kafka \\\n    --install \\\n    --create-namespace \\\n    --namespace kafka \\\n    --version 18.0.0 \\\n    --values values.yaml\n</code></pre>"},{"location":"container-app/longhorn/","title":"Longhorn","text":""},{"location":"container-app/longhorn/#_1","title":"\u524d\u7f6e\u6761\u4ef6","text":"<p>https://longhorn.io/docs/1.5.3/deploy/install/#installation-requirements</p> <pre><code># \u73af\u5883\u68c0\u67e5\ncurl -sSfL https://raw.githubusercontent.com/longhorn/longhorn/v1.5.3/scripts/environment_check.sh | bash\n\n# \u81ea\u52a8\u5b89\u88c5 open-iscsi \u548c nfs-client\nkubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.5.3/deploy/prerequisite/longhorn-iscsi-installation.yaml\nkubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.5.3/deploy/prerequisite/longhorn-nfs-installation.yaml\n\n# \u624b\u52a8\u5b89\u88c5\napt install open-iscsi nfs-common -y\nsystemctl enable iscsid --now\n</code></pre>"},{"location":"container-app/metallb/","title":"MetalLB","text":""},{"location":"container-app/metallb/#layer2","title":"Layer2 \u6a21\u5f0f","text":""},{"location":"container-app/metallb/#ipvs-strictarp","title":"IPVS \u6a21\u5f0f\u4e0b\u542f\u7528 strictARP","text":"<p>INSTALLATION</p> <pre><code>kubectl -n kube-system edit configmaps kube-proxy\n</code></pre> <pre><code>mode: ipvs\nipvs:\n  strictARP: true\n</code></pre>"},{"location":"container-app/mongodb/","title":"MongoDB","text":""},{"location":"container-app/mongodb/#helm-mongodb","title":"Helm \u5b89\u88c5 MongoDB","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade mongodb bitnami/mongodb --install --namespace mongodb --create-namespace --values values.yaml --version 13.0.2\n</code></pre>"},{"location":"container-app/mysql/","title":"MySQL","text":""},{"location":"container-app/mysql/#install","title":"Install","text":""},{"location":"container-app/mysql/#docker","title":"Docker","text":"<pre><code>mysql -p\n</code></pre> <pre><code>create database if not exists demo;\n\ncreate user 'demo'@'%' identified by 'demo';\n\nrevoke all on *.* from 'demo'@'%';\n\ngrant all on demo.* to 'demo'@'%';\n\ngrant select on *.* to 'demo'@'%';\n\nflush privileges;\n</code></pre> <pre><code>use mysql;\n\ndelete from user where user = 'root' and host = '%';\n</code></pre>"},{"location":"container-app/mysql/#helm","title":"Helm","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade mysql bitnami/mysql --install --namespace mysql --create-namespace --values values.yaml --version 9.2.6\n</code></pre>"},{"location":"container-app/mysql/#replication","title":"Replication","text":""},{"location":"container-app/mysql/#master","title":"Master","text":"<pre><code>show master status;\n</code></pre>"},{"location":"container-app/mysql/#slave","title":"Slave","text":"<pre><code>stop replica;\n\nreset replica;\n\nchange replication source to\n    source_host='192.192.192.101',\n    source_port=3306,\n    source_user='root',\n    source_password='root',\n    source_log_file=&lt;File&gt;,\n    source_log_pos=&lt;Position&gt;;\n\nstart replica;\n\nshow replica status;\n</code></pre>"},{"location":"container-app/nexus/","title":"Nexus","text":""},{"location":"container-app/nexus/#helm-nexus","title":"Helm \u5b89\u88c5 Nexus","text":"<pre><code>helm repo add sonatype https://sonatype.github.io/helm3-charts/\n\nhelm repo update\n\nhelm upgrade nexus sonatype/nexus-repository-manager --install --namespace nexus --create-namespace --values values.yaml --version 41.1.2\n\n# \u67e5\u770b\u9ed8\u8ba4\u5bc6\u7801\nkubectl exec -n nexus pods/&lt;POD&gt; -- cat /nexus-data/admin.password\n</code></pre>"},{"location":"container-app/nexus/#_1","title":"\u4ed3\u5e93\u914d\u7f6e","text":""},{"location":"container-app/nexus/#maven","title":"Maven","text":"<pre><code>- { type: proxy,  name: maven-proxy-aliyun-public,        url: https://maven.aliyun.com/repository/public }\n- { type: proxy,  name: maven-proxy-aliyun-google,        url: https://maven.aliyun.com/repository/google }\n- { type: proxy,  name: maven-proxy-aliyun-spring,        url: https://maven.aliyun.com/repository/spring }\n- { type: proxy,  name: maven-proxy-aliyun-spring-plugin, url: https://maven.aliyun.com/repository/spring-plugin }\n- { type: proxy,  name: maven-proxy-aliyun-gradle-plugin, url: https://maven.aliyun.com/repository/gradle-plugin }\n- { type: proxy,  name: maven-proxy-repo,                 url: https://repo.maven.apache.org/maven2 }\n- { type: hosted, name: maven-custom }\n- { type: group,  name: maven-public }\n</code></pre>"},{"location":"container-app/nexus/#_2","title":"\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"container-app/nexus/#nexus-ingress-controller-80-443","title":"Nexus \u5e76\u4e0d\u80fd\u8bc6\u522b Ingress Controller \u66b4\u9732\u7684\u975e 80 \u548c 443 \u4ee5\u5916\u7684\u7aef\u53e3","text":""},{"location":"container-app/nginx-ingress-controller/","title":"Nginx Ingress Controller","text":""},{"location":"container-app/nginx-ingress-controller/#_1","title":"\u5b89\u88c5","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade nginx-ingress-controller bitnami/nginx-ingress-controller --install --namespace kube-system --values values.yaml --version 9.2.28\n</code></pre>"},{"location":"container-app/openebs/","title":"OpenEBS","text":""},{"location":"container-app/openebs/#_1","title":"\u5b89\u88c5","text":"<pre><code>helm repo add openebs https://openebs.github.io/charts\n\nhelm repo update\n\nhelm upgrade openebs openebs/openebs --install --namespace openebs --create-namespace --values values.yaml --version 3.3.0\n</code></pre>"},{"location":"container-app/opengauss/","title":"openGauss","text":""},{"location":"container-app/oracle/","title":"Oracle","text":""},{"location":"container-app/oracle/#prerequisites","title":"Prerequisites","text":""},{"location":"container-app/oracle/#build-image","title":"Build image","text":"<pre><code>git clone https://github.com/oracle/docker-images.git --depth=1\n\ncd docker-images/OracleDatabase/SingleInstance/dockerfiles\n\n./buildContainerImage.sh -v 18.4.0 -x\n</code></pre>"},{"location":"container-app/postgresql/","title":"PostgreSQL","text":""},{"location":"container-app/postgresql/#docker-postgresql","title":"Docker \u5b89\u88c5 PostgreSQL","text":""},{"location":"container-app/postgresql/#_1","title":"\u521b\u5efa\u7528\u6237\u548c\u6570\u636e\u5e93","text":"<pre><code>psql -U postgres\n</code></pre> <pre><code>CREATE ROLE demo WITH LOGIN PASSWORD 'demo';\n\nCREATE DATABASE demo OWNER demo;\n</code></pre> <pre><code>sed -i 's/host all all all md5/host all demo all md5/' /var/lib/postgresql/data/pg_hba.conf\n</code></pre>"},{"location":"container-app/postgresql/#helm-postgresql","title":"Helm \u5b89\u88c5 PostgreSQL","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade postgresql bitnami/postgresql --install --namespace postgresql --create-namespace --values values.yaml --version 11.7.6\n</code></pre>"},{"location":"container-app/postgresql/#_2","title":"\u5e38\u89c1\u95ee\u9898","text":"<ul> <li>Desktop Desktop for Windows \u4e0d\u80fd\u6620\u5c04\u6570\u636e\u5377\u3002</li> </ul>"},{"location":"container-app/prometheus/","title":"Prometheus","text":""},{"location":"container-app/redis/","title":"Redis","text":""},{"location":"container-app/redis/#helm-redis","title":"Helm \u5b89\u88c5 Redis","text":""},{"location":"container-app/redis/#helm","title":"Helm","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\n\nhelm repo update\n\nhelm upgrade redis bitnami/redis --install --namespace redis --create-namespace --values values.yaml --version 17.0.11\n</code></pre>"},{"location":"container-app/shardingsphere-proxy/","title":"ShardingSphere Proxy","text":""},{"location":"container-app/traefik/","title":"Traefik Ingress Controller","text":""},{"location":"container-app/traefik/#_1","title":"\u6536\u85cf","text":"<ul> <li> <p>Exposing the Traefik dashboard</p> </li> <li> <p>Unable to bind to port 53 #516</p> </li> <li> <p>Default values on securityContext will render the container useless #163</p> </li> </ul>"},{"location":"data-structure/","title":"\u6570\u636e\u7ed3\u6784","text":""},{"location":"database/","title":"\u6570\u636e\u5e93","text":""},{"location":"database/#_2","title":"\u6536\u85cf","text":"<ul> <li> <p>sql \u91cc\u9762\u5982\u4f55\u5f15\u7528\u5217\u7684\u522b\u540d</p> </li> <li> <p>Greenplum 6 \u5df2\u5408\u5e76\u5230 PostgreSQL 9.3 \u7248\u672c - \u6bd4\u4e0a\u4e00\u4ee3 GP \u63d0\u5347\uff1a8 \u500d\u8bfb\uff0c195 \u500d\u66f4\u65b0\u3001\u5220\u9664 - \u53e6\u6709\u5927\u91cf PG \u65b0\u7279\u6027</p> </li> <li> <p>Oracle \u5f02\u5e38\u4ee3\u7801</p> </li> <li> <p>https://neo4j.com/developer/cypher/intro-cypher/</p> </li> <li> <p>\u5173\u4e8e varchar \u7684\u603b\u7ed3</p> </li> <li> <p>Oracle \u67e5\u8be2\u8bed\u53e5\u7ec3\u4e60\uff08\u4e8c\uff09</p> </li> <li> <p>\u5982\u4f55\u5728 SQL \u4e2d\u4f7f\u7528 JOIN \u6267\u884c UPDATE \u8bed\u53e5\uff1f</p> </li> <li> <p>\u540e\u7aef\u7a0b\u5e8f\u5458\u5fc5\u5907\uff1a\u4e66\u5199\u9ad8\u8d28\u91cf SQL \u7684 30 \u6761\u5efa\u8bae</p> </li> <li> <p>\u817e\u8baf\u9762\u8bd5\uff1a\u4e00\u6761 SQL \u8bed\u53e5\u6267\u884c\u5f97\u5f88\u6162\u7684\u539f\u56e0\u6709\u54ea\u4e9b\uff1f---\u4e0d\u770b\u540e\u6094\u7cfb\u5217</p> </li> <li> <p>\u4e00\u6761 SQL \u8bed\u53e5\u5728 MySQL \u4e2d\u5982\u4f55\u6267\u884c\u7684</p> </li> <li> <p>MySQL \u9ad8\u6027\u80fd\u4f18\u5316\u89c4\u8303\u5efa\u8bae,\u901f\u5ea6\u6536\u85cf</p> </li> <li> <p>SqlServer \u57fa\u7840\u4e4b(\u89e6\u53d1\u5668)</p> </li> <li> <p>Sql Server \u4e2d\u7684 DBCC \u547d\u4ee4\u8be6\u7ec6\u4ecb\u7ecd</p> </li> <li> <p>PostgreSQL \u4e4b\u7a97\u53e3\u51fd\u6570\u7684\u7528\u6cd5</p> </li> <li> <p>\u9ad8\u6027\u80fd MySQL\u2014\u2014Count(1) OR Count(*)\uff1f</p> </li> <li> <p>\u5d4c\u5165\u5f0f\u6570\u636e\u5e93(Java): Derby\uff0cSQLite\uff0cH2</p> </li> <li> <p>\u770b\u4e00\u904d\u5c31\u7406\u89e3\uff1aMVCC \u539f\u7406\u8be6\u89e3</p> </li> <li> <p>\u96ea\u82b1\u7b97\u6cd5\u751f\u6210\u7684 id \u662f\u5168\u7403\u552f\u4e00\u5417\uff1f</p> </li> <li> <p>\u96ea\u82b1\u7b97\u6cd5(Snowflake) - \u6539\u8fdb\u7248</p> </li> </ul>"},{"location":"database/db2/","title":"DB2","text":""},{"location":"database/db2/#_1","title":"\u6536\u85cf","text":""},{"location":"database/db2/#_2","title":"\u67e5\u770b\u8868\u7ed3\u6784\u4fe1\u606f","text":"<p>\u6570\u636e\u7c7b\u578b\uff1a</p> <ul> <li><code>BIGINT</code></li> <li><code>BLOB</code></li> <li><code>CHARACTER</code></li> <li><code>CLOB</code></li> <li><code>DATE</code></li> <li><code>DB2SECURITYLABEL</code></li> <li><code>DECIMAL</code></li> <li><code>DOUBLE</code></li> <li><code>INTEGER</code></li> <li><code>REAL</code></li> <li><code>SMALLINT</code></li> <li><code>TIMESTAMP</code></li> <li><code>VARCHAR</code></li> <li><code>XML</code></li> </ul> <pre><code>select \"table_schema\", \"table_name\", \"table_type\", \"table_comment\", \"column_name\", \"column_type\", \"column_order\", \"column_default\", \"column_nullable\"\nfrom (\n    select\n        t.tabschema   as \"table_schema\",\n        t.tabname     as \"table_name\",\n        lower(t.type) as \"table_type\",\n        t.remarks     as \"table_comment\",\n        c.colname     as \"column_name\",\n        (case\n            when c.typename = 'BIGINT'           then c.typename\n            when c.typename = 'BLOB'             then c.typename\n            when c.typename = 'CHARACTER'        then c.typename || '(' || c.length || ')'\n            when c.typename = 'CLOB'             then c.typename\n            when c.typename = 'DATE'             then c.typename\n            when c.typename = 'DB2SECURITYLABEL' then c.typename\n            when c.typename = 'DECIMAL'          then c.typename || '(' || c.length || ',' || c.scale || ')'\n            when c.typename = 'DOUBLE'           then c.typename\n            when c.typename = 'INTEGER'          then c.typename\n            when c.typename = 'REAL'             then c.typename\n            when c.typename = 'SMALLINT'         then c.typename\n            when c.typename = 'TIMESTAMP'        then c.typename || '(' || c.length || ')'\n            when c.typename = 'VARCHAR'          then c.typename || '(' || c.length || ')'\n            when c.typename = 'XML'              then c.typename\n        end)        as \"column_type\",\n        c.colno + 1 as \"column_order\",\n        c.default   as \"column_default\",\n        (case when c.nulls = 'Y' then 1 when c.nulls = 'N' then 0 end) as \"column_nullable\"\n    from syscat.tables t\n    join syscat.columns c on c.tabschema = t.tabschema and c.tabname = t.tabname\n    where t.tabschema not in ('SYSCAT', 'SYSIBM', 'SYSIBM', 'SYSPUBLC', 'SYSSTAT', 'SYSTOOLS') and t.type IN ('T', 'V')\n    order by \"table_schema\", \"table_type\", \"column_order\"\n) t\n</code></pre>"},{"location":"database/etcd/","title":"ETCD","text":""},{"location":"database/etcd/#_1","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"database/etcd/#put","title":"\u589e(<code>put</code>)","text":"<pre><code>etcdctl put a \"hello\"\n</code></pre>"},{"location":"database/etcd/#get","title":"\u67e5(<code>get</code>)","text":"<ul> <li>\u5355\u4e2a\u67e5\u627e     <pre><code>etcdctl get a\n</code></pre></li> <li> <p>\u8303\u56f4\u67e5\u627e</p> <pre><code># \u67e5\u627e\u8303\u56f4\u4e3a [a1, a3)\netcdctl get a1 a3\n</code></pre> </li> <li> <p>\u524d\u7f00\u67e5\u627e</p> <pre><code># \u67e5\u627e\u6240\u6709\u4ee5 /a/b \u5f00\u5934\u7684 key\netcdctl get /a/b/ --prefix\n</code></pre> </li> <li> <p>\u9650\u5236\u6570\u91cf</p> <pre><code># \u6700\u591a\u663e\u793a\u4e24\u4e2a\netcdctl get /a/b/ --prefix --limit 2\n</code></pre> </li> </ul>"},{"location":"database/etcd/#del","title":"\u5220(<code>del</code>)","text":"<ul> <li>\u8303\u56f4\u5220\u9664     <pre><code># \u5220\u9664\u8303\u56f4\u4e3a [a1, a3)\netcdctl del a1 a3\n</code></pre></li> </ul>"},{"location":"database/etcd/#watch","title":"\u5386\u53f2\u53d8\u52a8(<code>watch</code>)","text":"<pre><code>etcdctl watch a\n</code></pre>"},{"location":"database/etcd/#lease","title":"\u79df\u7ea6(<code>lease</code>)","text":"<p><code>lease</code> \u7c7b\u4f3c\u4e8e Redis \u4e2d\u7684 <code>TTL</code>\u3002</p> <ul> <li> <p>\u6388\u4e88\u79df\u7ea6</p> <pre><code>etcdctl lease grant 100\n# lease 694d84b3b6d6c614 granted with TTL(100s)\n</code></pre> </li> <li> <p>\u5c06\u79df\u7ea6\u6dfb\u52a0\u5230 key4 \u4e0a</p> <pre><code>etcdctl put key4 \"hello\" --lease=694d84b3b6d6c614\n</code></pre> </li> <li> <p>\u67e5\u770b\u79df\u7ea6\u5269\u4f59\u65f6\u95f4</p> <pre><code>etcdctl lease timetolive 694d84b3b6d6c614\n</code></pre> </li> </ul>"},{"location":"database/mysql/","title":"MySQL","text":""},{"location":"database/mysql/#_1","title":"\u5143\u6570\u636e","text":""},{"location":"database/mysql/#_2","title":"\u8868\u7ed3\u6784\u4fe1\u606f","text":"<pre><code>select\n    tables.table_schema                                                                                as schema_name,\n    tables.table_name                                                                                  as table_name,\n    (case when tables.table_type = 'BASE TABLE' then 't' when tables.table_type = 'VIEW' then 'v' end) as table_type,\n    tables.table_comment                                                                               as table_comment,\n    columns.column_name                                                                                as column_name,\n    columns.ordinal_position                                                                           as column_order,\n    columns.column_type                                                                                as column_type,\n    (case when columns.is_nullable = 'YES' then 1 else 0 end)                                          as column_nullable,\n    (case when columns.column_key  = 'PRI' then 1 else 0 end)                                          as column_primary_key,\n    columns.column_default                                                                             as column_default,\n    columns.column_comment                                                                             as column_comment\nfrom information_schema.tables\njoin information_schema.columns on columns.table_schema = columns.table_schema and columns.table_name = tables.table_name\nwhere 1 = 1\nand tables.table_schema not in ('information_schema','mysql', 'performance_schema', 'sys')\norder by tables.table_schema, tables.table_name, columns.ordinal_position\n</code></pre>"},{"location":"database/mysql/#_3","title":"\u6536\u85cf","text":""},{"location":"database/mysql/#mysql-utf8mb4-utf8mb4_general_ci-utf8mb4_0900_ai_ci","title":"mysql \u8bbe\u7f6e\u4e86 utf8mb4\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u6709 utf8mb4_general_ci \u548c utf8mb4_0900_ai_ci\uff1f","text":""},{"location":"database/mysql/basic/","title":"Basic","text":""},{"location":"database/mysql/basic/#_1","title":"\u6570\u636e\u5e93\u8303\u5f0f","text":"\u7b2c\u4e00\u8303\u5f0f\uff081NF\uff09 \u6240\u6709\u5c5e\u6027\u90fd\u4e0d\u53ef\u518d\u5206\uff081NF \u662f\u6240\u6709\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6700\u57fa\u672c\u8981\u6c42\uff09 \u7b2c\u4e8c\u8303\u5f0f\uff082NF\uff09 \u975e\u4e3b\u5c5e\u6027\u5b8c\u5168\u4f9d\u8d56\u4e8e\u5019\u9009\u7801\uff08\u6d88\u9664\u975e\u4e3b\u5c5e\u6027\u5bf9\u5019\u9009\u7801\u7684\u90e8\u5206\u51fd\u6570\u4f9d\u8d56\uff09 \u7b2c\u4e09\u8303\u5f0f\uff083NF\uff09 \u975e\u4e3b\u5c5e\u6027\u76f4\u63a5\u4f9d\u8d56\u4e8e\u540e\u5019\u9009\u7801\uff08\u6d88\u9664\u975e\u4e3b\u5c5e\u6027\u5bf9\u5019\u9009\u7801\u7684\u4f20\u9012\u51fd\u6570\u4f9d\u8d56\uff09 \u5df4\u65af-\u79d1\u5fb7\u8303\u5f0f\uff08BCNF\uff09 \u4e3b\u5c5e\u6027\u4e4b\u95f4\u4e0d\u5b58\u5728\u4f9d\u8d56\uff08\u6d88\u9664\u4e3b\u5c5e\u6027\u5bf9\u5019\u9009\u7801\u7684\u90e8\u5206\u51fd\u6570\u4f9d\u8d56\u6216\u4f20\u9012\u51fd\u6570\u4f9d\u8d56\uff09"},{"location":"database/mysql/basic/#_2","title":"\u6570\u636e\u5e93\u8bbe\u8ba1","text":""},{"location":"database/mysql/basic/#_3","title":"\u6570\u636e\u5e93\u8bbe\u8ba1\u901a\u5e38\u6b65\u9aa4","text":"<ol> <li>\u9700\u6c42\u5206\u6790\uff1a\u5206\u6790\u7528\u6237\u7684\u9700\u6c42\uff0c\u5305\u62ec\u6570\u636e\u3001\u529f\u80fd\u3001\u6027\u80fd\u9700\u6c42</li> <li>\u6982\u5ff5\u7ed3\u6784\u8bbe\u8ba1\uff1a\u4e3b\u8981\u91c7\u7528 E-R \u6a21\u578b\u8fdb\u884c\u8bbe\u8ba1\uff0c\u5305\u62ec\u753b E-R \u56fe</li> <li>\u903b\u8f91\u7ed3\u6784\u8bbe\u8ba1\uff1a\u901a\u8fc7\u5c06 E-R \u56fe\u8f6c\u6362\u6210\u8868\uff0c\u5b9e\u73b0\u4ece E-R \u6a21\u578b\u5230\u5173\u7cfb\u6a21\u578b\u7684\u8f6c\u6362</li> <li>\u7269\u7406\u7ed3\u6784\u8bbe\u8ba1\uff1a\u4e3b\u8981\u662f\u4e3a\u6240\u8bbe\u8ba1\u7684\u6570\u636e\u5e93\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u7ed3\u6784\u548c\u5b58\u53d6\u8def\u5f84</li> <li>\u6570\u636e\u5e93\u5b9e\u65bd\uff1a\u5305\u62ec\u7f16\u7a0b\u3001\u6d4b\u8bd5\u548c\u8bd5\u8fd0\u884c</li> <li>\u6570\u636e\u5e93\u8fd0\u884c\u548c\u7ef4\u62a4\uff1a\u7cfb\u7edf\u7684\u8fd0\u884c\u548c\u6570\u636e\u5e93\u7684\u65e5\u5e38\u7ef4\u62a4</li> </ol>"},{"location":"database/mysql/command/","title":"Command","text":""},{"location":"database/mysql/command/#mysql","title":"\u67e5\u8be2 MySQL \u63d0\u4f9b\u7684\u6240\u6709\u5b58\u50a8\u5f15\u64ce","text":"<pre><code>SHOW ENGINES;\n</code></pre>"},{"location":"database/mysql/command/#mysql_1","title":"\u67e5\u770b MySQL \u5f53\u524d\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce","text":"<pre><code>SHOW VARIABLES LIKE '%storage_engine%';\n</code></pre>"},{"location":"database/mysql/command/#_1","title":"\u67e5\u770b\u8868\u7684\u5b58\u50a8\u5f15\u64ce","text":"<pre><code>SHOW TABLE STATUS LIKE 'table_name';\n</code></pre>"},{"location":"database/mysql/command/#mysql_2","title":"\u67e5\u770b MySQL \u4e8b\u52a1\u9694\u79bb\u7ea7\u522b","text":"<pre><code>SELECT @@tx_isolation;\n</code></pre>"},{"location":"database/mysql/lock/","title":"Lock","text":""},{"location":"database/mysql/lock/#innodb","title":"InnoDB \u9501\u7b97\u6cd5","text":"\u8bb0\u5f55\u9501\uff08Record Lock\uff09 \u9501\u5b9a\u5355\u4e2a\u884c\u8bb0\u5f55 \u95f4\u9699\u9501\uff08Gap Lock\uff09 \u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\u4e0d\u5305\u62ec\u8bb0\u5f55\u672c\u8eab \u4e34\u952e\u9501\uff08Next-Key Lock\uff09 \u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\u5305\u542b\u8bb0\u5f55\u672c\u8eab"},{"location":"database/mysql/lock/#innodb_1","title":"InnoDB \u9501\u7279\u6027","text":"<ul> <li><code>SELECT</code> \u64cd\u4f5c\u7684\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u901a\u8fc7 MVCC \u89e3\u51b3</li> <li><code>UPDATE</code>\u3001<code>DELETE</code> \u7684\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u901a\u8fc7 Record Lock \u89e3\u51b3</li> <li><code>INSERT</code> \u7684\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u901a\u8fc7 Next-Key Lock \u89e3\u51b3</li> </ul>"},{"location":"database/mysql/lock/#_1","title":"\u5168\u5c40\u9501","text":""},{"location":"database/mysql/lock/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u5168\u5c40\u903b\u8f91\u5907\u4efd\uff08<code>mysqldump</code>\uff09</li> </ul>"},{"location":"database/mysql/lock/#_3","title":"\u542f\u52a8\u65b9\u6cd5","text":"<ul> <li> <p>\u65b9\u6cd5\u4e00\uff08FTWRL\uff09</p> <pre><code>FLUSH TABLES WITH READ LOCK;\n\n-- UNLOCK TABLES;\n</code></pre> </li> <li> <p>\u65b9\u6cd5\u4e8c</p> <pre><code>SET GLOBAL readonly=true;\n</code></pre> </li> </ul>"},{"location":"database/mysql/lock/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p>\u6709\u4e9b\u7cfb\u7edf\u4e2d <code>readonly</code> \u7684\u503c\u4f1a\u88ab\u7528\u6765\u5904\u7406\u5176\u5b83\u903b\u8f91\uff08\u5982\u5224\u65ad\u4e00\u4e2a\u5e93\u662f\u4e3b\u5e93\u8fd8\u662f\u5907\u5e93\uff09</p> </li> <li> <p>\u5982\u679c\u6267\u884c FTWRL \u540e\u7531\u4e8e\u5ba2\u6237\u7aef\u53d1\u751f\u5f02\u5e38\u65ad\u5f00\uff0cMySQL \u4f1a\u81ea\u52a8\u91ca\u653e\u8fd9\u4e2a\u5168\u5c40\u9501\uff0c\u6574\u4e2a\u5e93\u56de\u5230\u53ef\u6b63\u5e38\u66f4\u65b0\u72b6\u6001</p> </li> <li> <p>\u5c06\u5e93\u8bbe\u7f6e\u672a <code>readonly</code> \u540e\uff0c\u82e5\u5ba2\u6237\u7aef\u53d1\u751f\u5f02\u5e38\uff0c\u6570\u636e\u5e93\u4f1a\u4e00\u76f4\u4fdd\u6301 <code>readonly</code> \u72b6\u6001\uff0c\u5bfc\u81f4\u6574\u5e93\u957f\u65f6\u95f4\u5904\u4e8e\u4e0d\u53ef\u5199\u72b6\u6001</p> </li> <li> <p><code>readonly</code> \u5bf9 <code>Super</code> \u6743\u9650\u65e0\u6548</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u9700\u8981 FWTRL\uff1f</p> <ul> <li>\u5f53 <code>mysqldump</code> \u4f7f\u7528\u53c2\u6570 <code>--single-transaction</code> \u7684\u65f6\u5019\uff0c\u5bfc\u6570\u636e\u4e4b\u524d\u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\u6765\u786e\u4fdd\u62ff\u5230\u4e00\u81f4\u6027\u5feb\u7167\u89c6\u56fe\u3002\u800c\u7531\u4e8e MVCC \u7684\u652f\u6301\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6570\u636e\u662f\u53ef\u4ee5\u6b63\u5e38\u66f4\u65b0\u7684\u3002</li> <li>\u6240\u4ee5 <code>--single-transaction</code> \u65b9\u6cd5\u53ea\u9002\u7528\u4e8e\u6240\u6709\u7684\u8868\u4f7f\u7528\u4e8b\u52a1\u5f15\u64ce\u7684\u5e93\u3002\u5982\u679c\u6709\u7684\u8868\u4f7f\u7528\u4e86\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5f15\u64ce\uff0c\u90a3\u4e48\u5907\u4efd\u5c31\u53ea\u80fd\u901a\u8fc7 FTWRL \u65b9\u6cd5</li> </ul> </li> </ul>"},{"location":"database/mysql/lock/#_5","title":"\u8868\u7ea7\u9501","text":""},{"location":"database/mysql/lock/#_6","title":"\u8bfb\u5199\u9501","text":"<ul> <li> <p>\u8868\u5171\u4eab\u8bfb\u9501\uff08\u5171\u4eab\u9501\uff09</p> <pre><code>LOCK TABLES table_name READ;\n</code></pre> </li> <li> <p>\u8868\u72ec\u5360\u5199\u9501\uff08\u6392\u5b83\u9501\uff09</p> <pre><code>LOCK TABLES table_name WRITE;\n</code></pre> </li> </ul>"},{"location":"database/mysql/lock/#mdl","title":"\u5143\u6570\u636e\u9501\uff08MDL\uff09","text":"<ul> <li>MDL \u7684\u4f5c\u7528\u662f\u9632\u6b62 DDL \u548c DML \u5e76\u53d1\u7684\u51b2\u7a81\uff0c\u4fdd\u8bc1\u8bfb\u5199\u7684\u6b63\u786e\u6027</li> <li>\u4e0d\u9700\u8981\u663e\u5f0f\u7684\u4f7f\u7528 MDL\uff0c\u56e0\u4e3a\u5f53\u6211\u4eec\u5bf9\u6570\u636e\u5e93\u8868\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u8fd9\u4e2a\u8868\u52a0\u4e0a MDL</li> </ul>"},{"location":"database/mysql/lock/#intention-lock","title":"\u610f\u5411\u9501\uff08Intention Lock\uff09","text":"<ul> <li> <p>\u610f\u5411\u9501\u662f\u8868\u7ea7\u9501\uff0c\u662f InnoDB \u4e3b\u52a8\u52a0\u7684\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u5904\u7406\uff0c\u5176\u76ee\u7684\u662f\u4e3a\u4e86\u5feb\u901f\u5224\u65ad\u8868\u91cc\u662f\u5426\u6709\u8bb0\u5f55\u88ab\u52a0\u9501</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u610f\u5411\u9501\uff0c\u90a3\u4e48\u52a0\u72ec\u5360\u9501\u65f6\uff0c\u5c31\u9700\u8981\u904d\u5386\u8868\u91cc\u6240\u6709\u8bb0\u5f55\uff0c\u67e5\u770b\u662f\u5426\u6709\u8bb0\u5f55\u5b58\u5728\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u5f88\u4f4e</li> <li>\u5982\u679c\u6709\u4e86\u610f\u5411\u9501\uff0c\u5728\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u524d\uff0c\u4f1a\u5148\u52a0\u4e0a\u8868\u7ea7\u7684\u610f\u5411\u72ec\u5360\u9501\uff0c\u90a3\u4e48\u5728\u52a0\u72ec\u5360\u9501\u65f6\uff0c\u76f4\u63a5\u67e5\u8be5\u8868\u662f\u5426\u6709\u610f\u5411\u72ec\u5360\u9501\uff0c\u5982\u679c\u6709\u5c31\u610f\u5473\u7740\u8868\u91cc\u5df2\u7ecf\u6709\u8bb0\u5f55\u88ab\u52a0\u4e86\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u53bb\u904d\u5386\u8868\u91cc\u7684\u8bb0\u5f55</li> </ul> </li> <li> <p>\u5bf9\u4e8e <code>INSERT</code>\u3001<code>UPDATE</code>\u3001<code>DELETE</code>\uff0cInnoDB \u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u6570\u636e\u52a0\u6392\u5b83\u9501</p> </li> <li> <p>\u5bf9\u4e8e\u4e00\u822c\u7684 <code>SELECT</code> \u8bed\u53e5\uff0cInnoDB \u4e0d\u4f1a\u52a0\u4efb\u4f55\u6240\uff0c\u4e8b\u52a1\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u663e\u793a\u52a0\u5171\u4eab\u9501\u6216\u6392\u5b83\u9501</p> <ul> <li> <p>\u5171\u4eab\u9501</p> <pre><code>SELECT ... LOCK IN SHARE MODE;\n</code></pre> </li> <li> <p>\u6392\u5b83\u9501</p> <pre><code>SELECT ... FOR UPDATE;\n</code></pre> </li> </ul> </li> <li> <p>\u610f\u5411\u5171\u4eab\u9501\uff08IS\uff09\u662f\u6307\u5f53\u4e8b\u52a1\u51c6\u5907\u5728\u67d0\u884c\u8bb0\u5f55\u4e0a\u52a0\u5171\u4eab\u9501\uff08S\uff09\u65f6\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e00\u4e2a IS \u9501</p> </li> <li>\u610f\u5411\u6392\u5b83\u9501\uff08IX\uff09\u662f\u6307\u5f53\u4e8b\u52a1\u51c6\u5907\u5728\u67d0\u884c\u8bb0\u5f55\u4e0a\u52a0\u6392\u5b83\u9501\uff08X\uff09\u65f6\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e00\u4e2a IX \u9501</li> </ul>"},{"location":"database/mysql/lock/#auto-inc-lock","title":"\u81ea\u589e\u9501\uff08AUTO-INC Lock\uff09","text":"<ul> <li> <p>\u5728\u4e3a\u67d0\u4e2a\u5b57\u6bb5\u7533\u660e <code>AUTO_INCREMENT</code> \u5c5e\u6027\u540e\uff0c\u53ef\u4ee5\u5728\u63d2\u5165\u6570\u636e\u65f6\u4e0d\u6307\u5b9a\u8be5\u5b57\u6bb5\u7684\u503c\uff0c\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u8fd9\u4e3b\u8981\u662f\u901a\u8fc7 <code>AUTO-INC</code> \u9501\u5b9e\u73b0\u7684</p> </li> <li> <p><code>AUTO-INC</code> \u9501\u662f\u7279\u6b8a\u7684\u8868\u9501\u673a\u5236\uff0c\u9501\u4e0d\u662f\u5728\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u91ca\u653e\uff0c\u800c\u662f\u5728\u6267\u884c\u5b8c\u63d2\u5165\u8bed\u53e5\u540e\u5c31\u4f1a\u7acb\u5373\u91ca\u653e</p> </li> <li> <p><code>AUTO-INC</code> \u9501\u5728\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u63d2\u5165\u7684\u65f6\u5019\uff0c\u4f1a\u5f71\u54cd\u63d2\u5165\u6027\u80fd\uff0c\u56e0\u4e3a\u53e6\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u989d\u63d2\u5165\u4f1a\u88ab\u963b\u585e</p> <ul> <li> <p>\u56e0\u6b64\uff0c\u5728 MySQL 5.1.22 \u7248\u672c\u5f00\u59cb\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u79cd\u8f7b\u91cf\u7ea7\u9501\u6765\u5b9e\u73b0\u81ea\u589e</p> </li> <li> <p>\u4e00\u6837\u662f\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u88ab <code>AUTO_INCREMENT</code>\u4fee\u9970\u7684\u5b57\u6bb5\u52a0\u4e0a\u8f7b\u91cf\u7ea7\u9501\uff0c\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u4e00\u4e2a\u81ea\u589e\u7684\u503c\u540e\u5c31\u91ca\u653e\u8fd9\u4e2a\u8f7b\u91cf\u7ea7\u9501\uff0c\u800c\u4e0d\u9700\u8981\u7b49\u5f85\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u4e4b\u540e\u624d\u91ca\u653e\u9501</p> </li> <li> <p>InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u4e2a <code>innodb_autoinc_lock_mode</code> \u7684\u7cfb\u7edf\u53d8\u91cf\uff0c\u7528\u6765\u63a7\u5236\u9009\u62e9\u7528 <code>AUTO-INC</code>\u9501\u8fd8\u662f\u8f7b\u91cf\u7ea7\u9501</p> <pre><code>innodb_autoinc_lock_mode=0 -- \u91c7\u7528 AUTO_INC \u9501\ninnodb_autoinc_lock_mode=1 -- \u9ed8\u8ba4\u4e24\u79cd\u9501\u6df7\u7528\uff08\u5982\u679c\u80fd\u591f\u786e\u5b9a\u63d2\u5165\u7684\u8bb0\u5f55\u7684\u6570\u91cf\u5c31\u91c7\u7528\u8f7b\u91cf\u7ea7\u9501\uff1b\u4e0d\u786e\u5b9a\u65f6\u5c31\u91c7\u7528 AUTO_INC \u9501\uff09\ninnodb_autoinc_lock_mode=2 -- \u91c7\u7528\u8f7b\u91cf\u7ea7\u9501\uff08\u6027\u80fd\u6700\u9ad8\uff0c\u4f46\u81ea\u589e\u957f\u53ef\u80fd\u4e0d\u8fde\u7eed\uff0c\u5728\u4e3b\u4ece\u590d\u5236\u573a\u666f\u4e2d\u4e0d\u5b89\u5168\uff09\n</code></pre> </li> </ul> </li> </ul>"},{"location":"database/mysql/lock/#_7","title":"\u9875\u7ea7\u9501","text":"<ul> <li>\u9875\u7ea7\u9501\u662f MySQL \u4e2d\u9501\u5b9a\u7c92\u5ea6\u4ecb\u4e8e\u884c\u7ea7\u9501\u548c\u8868\u7ea7\u9501\u4e4b\u95f4\u7684\u4e00\u79cd\u9501</li> <li>\u8868\u7ea7\u9501\u901f\u5ea6\u5feb\uff0c\u4f46\u51b2\u7a81\u591a\uff1b\u884c\u7ea7\u9501\u51b2\u7a81\u5c11\uff0c\u4f46\u901f\u5ea6\u6162\uff1b\u56e0\u6b64\u91c7\u53d6\u4e86\u6298\u4e2d\u7684\u9875\u7ea7\u9501\uff0c\u4e00\u6b21\u9501\u5b9a\u76f8\u90bb\u7684\u4e00\u7ec4\u8bb0\u5f55</li> <li>BDB \u5b58\u50a8\u5f15\u64ce\u652f\u6301\u9875\u7ea7\u9501</li> </ul>"},{"location":"database/mysql/lock/#_8","title":"\u884c\u7ea7\u9501","text":""},{"location":"database/mysql/lock/#_9","title":"\u7b80\u4ecb","text":"<ul> <li>\u5728 InnoDB \u4e8b\u52a1\u4e2d\uff0c\u884c\u9501\u901a\u8fc7\u7ed9\u7d22\u5f15\u4e0a\u7684\u7d22\u5f15\u9879\u52a0\u9501\u6765\u5b9e\u73b0</li> <li>\u53ea\u6709\u901a\u8fc7\u7d22\u5f15\u6761\u4ef6\u68c0\u7d22\u6570\u636e\uff0c\u624d\u4f1a\u4f7f\u7528\u884c\u7ea7\u9501\uff0c\u5426\u5219\u5c06\u4f7f\u7528\u8868\u7ea7\u9501</li> <li>\u884c\u7ea7\u9501\u540c\u6837\u5206\u4e3a\u5171\u4eab\u9501\u548c\u6392\u5b83\u9501\uff0c\u4ee5\u53ca\u52a0\u9501\u524d\u9700\u8981\u5148\u83b7\u5f97\u7684\u610f\u5411\u5171\u4eab\u9501\u548c\u610f\u5411\u6392\u5b83\u9501</li> <li>\u884c\u9501\u662f\u5728\u9700\u8981\u7684\u65f6\u5019\u624d\u52a0\u4e0a\u7684\uff0c\u4f46\u5e76\u4e0d\u662f\u4e0d\u9700\u8981\u4e86\u5c31\u7acb\u5373\u91ca\u653e\uff0c\u800c\u662f\u8981\u7b49\u5230\u4e8b\u52a1\u7ed3\u675f\u65f6\u624d\u91ca\u653e</li> </ul>"},{"location":"database/mysql/lock/#_10","title":"\u9501\u5b9e\u73b0\u65b9\u5f0f","text":""},{"location":"database/mysql/lock/#record-lock","title":"\u8bb0\u5f55\u9501\uff08Record Lock\uff09","text":"<ul> <li>\u5fc5\u987b\u4e3a\u552f\u4e00\u7d22\u5f15\u5217\u6216\u4e3b\u952e\u5217\uff0c\u5426\u5219\u4e0a\u8ff0\u8bed\u53e5\u52a0\u7684\u9501\u5c31\u4f1a\u53d8\u6210\u4e34\u952e\u9501</li> <li>\u67e5\u8be2\u8bed\u53e5\u5fc5\u987b\u4e3a\u7cbe\u51c6\u5339\u914d\uff08<code>=</code>\uff09\uff0c\u5426\u5219\u4e5f\u4f1a\u9000\u5316\u4e3a\u4e34\u952e\u9501</li> <li>\u5728 MySQL \u4e2d\uff0c\u884c\u7ea7\u9501\u5e76\u4e0d\u662f\u76f4\u63a5\u9501\u8bb0\u5f55\uff0c\u800c\u662f\u9501\u7d22\u5f15<ul> <li>\u5982\u679c\u4e00\u6761\u8bed\u53e5\u64cd\u4f5c\u4e86\u4e3b\u952e\u7d22\u5f15\uff0cMySQL \u4f1a\u9501\u5b9a\u8fd9\u6761\u4e3b\u952e\u7d22\u5f15</li> <li>\u5982\u679c\u4e00\u6761\u8bed\u53e5\u64cd\u4f5c\u4e86\u975e\u4e3b\u952e\u7d22\u5f15\uff0cMySQL \u4f1a\u5148\u9501\u5b9a\u8be5\u975e\u4e3b\u952e\u7d22\u5f15\uff0c\u518d\u9501\u5b9a\u76f8\u5173\u7684\u4e3b\u952e\u7d22\u5f15</li> </ul> </li> </ul>"},{"location":"database/mysql/lock/#gap-lock","title":"\u95f4\u9699\u9501\uff08Gap Lock\uff09","text":"<ul> <li>\u95f4\u9699\u9501\u57fa\u4e8e\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u5b83\u9501\u5b9a\u4e00\u6bb5\u8303\u56f4\u5185\u7684\u7d22\u5f15\u8bb0\u5f55</li> <li>\u4ea7\u751f\u95f4\u9699\u9501\u7684\u6761\u4ef6<ul> <li>\u4f7f\u7528\u666e\u901a\u7d22\u5f15\u9501\u5b9a</li> <li>\u4f7f\u7528\u591a\u5217\u552f\u4e00\u7d22\u5f15</li> <li>\u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u9501\u5b9a\u591a\u884c\u8bb0\u5f55</li> </ul> </li> </ul>"},{"location":"database/mysql/lock/#next-key-lock","title":"\u4e34\u952e\u9501\uff08Next-Key Lock\uff09","text":"<ul> <li>\u4e34\u952e\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u901a\u8fc7\u4e34\u952e\u9501\u53ef\u4ee5\u89e3\u51b3\u5e7b\u8bfb\u7684\u95ee\u9898</li> <li>\u6bcf\u4e2a\u6570\u636e\u884c\u4e0a\u7684\u975e\u552f\u4e00\u7d22\u5f15\u5217\u4e0a\u90fd\u4f1a\u5b58\u5728\u4e00\u628a\u4e34\u952e\u9501\uff0c\u5f53\u67d0\u4e2a\u4e8b\u52a1\u6301\u6709\u8be5\u6570\u636e\u884c\u7684\u4e34\u952e\u9501\u65f6\uff0c\u4f1a\u9501\u4f4f\u4e00\u6bb5\u5de6\u5f00\u53f3\u5f00\u533a\u95f4\u7684\u6570\u636e</li> <li>InnoDB \u4e2d\u884c\u7ea7\u9501\u662f\u57fa\u4e8e\u7d22\u5f15\u5b9e\u73b0\u7684\uff0c\u4e34\u952e\u9501\u53ea\u4e0e\u975e\u552f\u4e00\u7d22\u5f15\u5217\u6709\u5173\uff0c\u5728\u552f\u4e00\u7d22\u5f15\u5217\uff08\u5305\u62ec\u4e3b\u952e\u5217\uff09\u4e0a\u4e0d\u5b58\u5728\u4e34\u952e\u9501</li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/","title":"Mysql group replication","text":""},{"location":"database/mysql/mysql%20group%20replication/#mgr","title":"MGR \u4ecb\u7ecd","text":"<p>MySQL \u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u56fd\u5185\u91d1\u878d\u884c\u4e1a\u4e5f\u5f00\u59cb\u5168\u9762\u4f7f\u7528\uff0c\u5176\u4e2d MySQL 5.7.17 \u63d0\u51fa\u7684 MGR\uff08MySQL Group Replication\uff09\u65e2\u53ef\u4ee5\u5f88\u597d\u7684\u4fdd\u8bc1\u4e00\u81f4\u6027\u53c8\u53ef\u4ee5\u81ea\u52a8\u5207\u6362\uff0c\u5177\u5907\u6545\u969c\u68c0\u6d4b\u529f\u80fd\u3001\u652f\u6301\u591a\u8282\u70b9\u5199\u5165\uff0cMGR \u662f\u4e00\u9879\u88ab\u666e\u904d\u770b\u597d\u7684\u6280\u672f\u3002</p> <p>MGR \u662f MySQL \u81ea\u5e26\u7684\u4e00\u4e2a\u63d2\u4ef6\uff0c\u53ef\u4ee5\u7075\u6d3b\u90e8\u7f72 \u3002MySQL MGR \u96c6\u7fa4\u662f\u591a\u4e2a MySQL Server \u8282\u70b9\u5171\u540c\u7ec4\u6210\u7684\u5206\u5e03\u5f0f\u96c6\u7fa4\uff0c\u6bcf\u4e2a Server \u90fd\u6709\u5b8c\u6574\u7684\u526f\u672c\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#mgr_1","title":"MGR \u4f18\u70b9","text":"<ul> <li> <p>\u5f3a\u4e00\u81f4\u6027\u3002\u57fa\u4e8e\u539f\u751f\u590d\u5236\u548c Paxos \u534f\u8bae\u7684\u7ec4\u590d\u5236\u6280\u672f\uff0c\u5e76\u4ee5\u63d2\u4ef6\u7684\u65b9\u5f0f\u63d0\u4f9b\uff0c\u63d0\u4f9b\u4e00\u81f4\u7684\u6570\u636e\u5b89\u5168\u4fdd\u8bc1\u3002</p> </li> <li> <p>\u9ad8\u5bb9\u9519\u6027\u3002\u53ea\u8981\u4e0d\u662f\u5927\u591a\u6570\u8282\u70b9\u574f\u6389\u5c31\u8981\u53ef\u4ee5\u7ee7\u7eed\u5de5\u4f5c\uff0c\u6709\u81ea\u52a8\u68c0\u6d4b\u673a\u5236\uff0c\u5f53\u4e0d\u540c\u8282\u70b9\u4ea7\u751f\u8d44\u6e90\u4e89\u7528\u51b2\u7a81\u65f6\uff0c\u4e0d\u4f1a\u51fa\u73b0\u9519\u8bef\uff0c\u6309\u7167\u5148\u5230\u8005\u4f18\u5148\u539f\u5219\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u4e14\u5185\u7f6e\u4e86\u81ea\u52a8\u5316\u8111\u88c2\u9632\u62a4\u673a\u5236\u3002</p> </li> <li> <p>\u9ad8\u6269\u5c55\u6027\u3002\u8282\u70b9\u7684\u65b0\u589e\u548c\u79fb\u9664\u90fd\u662f\u81ea\u52a8\u7684\uff0c\u65b0\u8282\u70b9\u52a0\u5165\u540e\uff0c\u4f1a\u81ea\u52a8\u4ece\u5176\u5b83\u8282\u70b9\u4e0a\u540c\u6b65\u72b6\u6001\uff0c\u76f4\u5230\u65b0\u8282\u70b9\u548c\u5176\u5b83\u8282\u70b9\u4fdd\u6301\u4e00\u81f4\uff0c\u5982\u679c\u67d0\u8282\u70b9\u88ab\u79fb\u9664\u4e86\uff0c\u5176\u5b83\u8282\u70b9\u81ea\u52a8\u66f4\u65b0\u7ec4\u4fe1\u606f\uff0c\u81ea\u52a8\u7ef4\u62a4\u65b0\u7684\u7ec4\u4fe1\u606f\u3002</p> </li> <li> <p>\u9ad8\u7075\u6d3b\u6027\u3002\u6709\u5355\u4e3b\u6a21\u5f0f\u548c\u591a\u4e3b\u6a21\u5f0f\uff0c\u5355\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u4f1a\u81ea\u52a8\u9009\u4e3b\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u5728\u4e3b\u8282\u70b9\u4e0a\u8fdb\u884c\uff1b\u591a\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u6240\u6709 Server \u90fd\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u66f4\u65b0\u64cd\u4f5c\u3002</p> </li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#mgr_2","title":"MGR \u4f7f\u7528\u7ea6\u675f","text":"<ul> <li> <p>\u4ec5\u652f\u6301 InnoDB \u5f15\u64ce\uff0c\u5e76\u4e14\u6bcf\u5f20\u8868\u4e00\u5b9a\u8981\u6709\u4e00\u4e2a\u4e3b\u952e\uff0c\u7528\u4e8e\u505a Write Set \u7684\u51b2\u7a81\u68c0\u6d4b\u3002</p> </li> <li> <p>\u5fc5\u987b\u6253\u5f00 GTID \u7279\u6027\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u683c\u5f0f\u5fc5\u987b\u8bbe\u7f6e\u4e3a ROW\uff0c\u7528\u4e8e\u9009\u4e3b\u4e0e Write Set\uff1b\u4e3b\u4ece\u72b6\u6001\u4fe1\u606f\u5b58\u5728\u4e8e\u8868\u4e2d\u3002</p> </li> <li> <p>MGR \u4e0d\u652f\u6301\u5927\u4e8b\u52a1\uff0c\u4e8b\u52a1\u5927\u5c0f\u6700\u597d\u4e0d\u8d85\u8fc7 143MB\uff0c\u5f53\u4e8b\u52a1\u8fc7\u5927\uff0c\u65e0\u6cd5\u5728 5s \u7684\u65f6\u95f4\u5185\u901a\u8fc7\u7f51\u7edc\u5728\u7ec4\u6210\u5458\u4e4b\u95f4\u590d\u5236\u6d88\u606f\uff0c\u5219\u53ef\u80fd\u4f1a\u6000\u7591\u6210\u5458\u5931\u8d25\u4e86\uff0c\u7136\u540e\u5c06\u5176\u9a71\u9010\u51fa\u5c40\u3002</p> </li> <li> <p>\u76ee\u524d\u4e00\u4e2a MGR \u96c6\u7fa4\u6700\u591a\u652f\u6301 9 \u4e2a\u8282\u70b9\u3002</p> </li> <li> <p>\u4e0d\u652f\u6301 Save Point \u7279\u6027\uff0c\u65e0\u6cd5\u505a\u5230\u5168\u5c40\u95f4\u7684\u7ea6\u675f\u68c0\u6d4b\u4e0e\u90e8\u5206\u4e8b\u52a1\u56de\u6eda\u3002</p> </li> <li> <p>\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u652f\u6301 Binlog Event Checksum\u3002</p> </li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#mgr_3","title":"MGR \u9002\u7528\u573a\u666f","text":"<ul> <li> <p>\u91d1\u878d\u4ea4\u6613\u3001\u91cd\u8981\u6570\u636e\u5b58\u50a8\u3001\u5bf9\u4e3b\u4ece\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\u7684\u573a\u666f\u3002</p> </li> <li> <p>\u6838\u5fc3\u6570\u636e\u603b\u91cf\u672a\u8fc7\u4ebf\u3002</p> </li> <li> <p>\u8bfb\u591a\u5199\u5c11\u7684\u5e94\u7528\u573a\u666f\uff0c\u5982\u4e92\u8054\u7f51\u7535\u5546\u3002</p> </li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#mgr_4","title":"\u5355\u4e3b MGR \u96c6\u7fa4\u642d\u5efa","text":""},{"location":"database/mysql/mysql%20group%20replication/#1-docker-compose","title":"1 docker-compose","text":""},{"location":"database/mysql/mysql%20group%20replication/#11","title":"1.1 \u76ee\u5f55\u7ed3\u6784","text":"<pre><code>mgr/\n|-- docker-compose.yaml\n|-- mysql101/\n\u00a0\u00a0\u00a0\u00a0|-- etc/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- mysql/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- conf.d/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- my.cnf\n|-- mysql102/\n\u00a0\u00a0\u00a0\u00a0|-- etc/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- mysql/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- conf.d/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- my.cnf\n|-- mysql103/\n\u00a0\u00a0\u00a0\u00a0|-- etc/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- mysql/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- conf.d/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|-- my.cnf\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#12-docker-composeyaml","title":"1.2 <code>docker-compose.yaml</code>","text":"<pre><code>version: '3'\n\nservices:\n  mysql101:\n    image: mysql:8.0.28\n    container_name: mysql101\n    hostname: mysql101\n    volumes:\n      - ./mysql101/etc/mysql/conf.d/:/etc/mysql/conf.d/\n    environment:\n      - TZ=Asia/Shanghai\n      - MYSQL_ROOT_PASSWORD=root\n  mysql102:\n    image: mysql:8.0.28\n    container_name: mysql102\n    hostname: mysql102\n    volumes:\n      - ./mysql102/etc/mysql/conf.d/:/etc/mysql/conf.d/\n    environment:\n      - TZ=Asia/Shanghai\n      - MYSQL_ROOT_PASSWORD=root\n  mysql103:\n    image: mysql:8.0.28\n    container_name: mysql103\n    hostname: mysql103\n    volumes:\n      - ./mysql103/etc/mysql/conf.d/:/etc/mysql/conf.d/\n    environment:\n      - TZ=Asia/Shanghai\n      - MYSQL_ROOT_PASSWORD=root\n\nnetworks:\n  default:\n    external: true\n    name: local\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#13","title":"1.3 \u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p>mysql101 \u914d\u7f6e\u3002</p> <pre><code>mkdir -p mysql101/etc/mysql/conf.d\n\ncat &lt;&lt;-EOF &gt;mysql101/etc/mysql/conf.d/my.cnf\n[mysqld]\n# custom\nbind-address                  = 0.0.0.0\nlower-case-table-names        = 1\ndefault-time-zone             = +8:00\ndefault-authentication-plugin = mysql_native_password\n\n# mgr\ndisabled_storage_engines=\"MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY\"\nserver_id=101\ngtid_mode=ON\nenforce_gtid_consistency=ON\nbinlog_checksum=NONE\n\nplugin_load_add='group_replication.so'\nloose-group_replication_group_name=\"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\"\nloose-group_replication_start_on_boot=off\nloose-group_replication_local_address=\"mysql101:33061\"\nloose-group_replication_group_seeds=\"mysql101:33061,mysql102:33061,mysql103:33061\"\nloose-group_replication_bootstrap_group=off\nEOF\n</code></pre> </li> <li> <p>mysql102\u3001mysql103 \u4fee\u6539 <code>server_id</code> \u548c <code>loose-group_replication_local_address</code>\u3002</p> </li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#14","title":"1.4 \u542f\u52a8","text":"<pre><code>docker network create local\n\ndocker-compose up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker logs -f mysql101\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#2","title":"2 \u7ec4\u4ef6\u96c6\u7fa4","text":""},{"location":"database/mysql/mysql%20group%20replication/#21","title":"2.1 \u4e3b\u8282\u70b9","text":"<pre><code>SET GLOBAL group_replication_bootstrap_group=ON;\nSTART GROUP_REPLICATION;\nSET GLOBAL group_replication_bootstrap_group=OFF;\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#22","title":"2.2 \u4ece\u8282\u70b9","text":"<pre><code>RESET MASTER;\nSTART GROUP_REPLICATION;\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#23","title":"2.3 \u9a8c\u8bc1","text":"<pre><code>SELECT * FROM performance_schema.replication_group_members;\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#3","title":"3 \u6545\u969c\u8f6c\u79fb\u6d4b\u8bd5","text":""},{"location":"database/mysql/mysql%20group%20replication/#31","title":"3.1 \u9009\u4e3b\u7b56\u7565","text":"<ul> <li>\u4f18\u5148\u4f4e\u7248\u672c\u8282\u70b9</li> <li>\u5982\u679c\u7248\u672c\u4e00\u6837\uff0c\u4f18\u5148\u6743\u91cd\u5927\u7684\u8282\u70b9</li> <li>\u5982\u679c\u7248\u672c\u4e0e\u6743\u91cd\u4e00\u6837\uff0c\u6309\u7167 <code>MEMBER_ID</code> \u7684\u987a\u5e8f\u9009\u4e3b</li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#32","title":"3.2 \u6ce8\u610f\u4e8b\u9879","text":"<p>\u5f53\u53ea\u5269\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u96c6\u7fa4\u8282\u70b9\u6570\u5c11\u4e8e Paxos n/2+1 \u7684\u89c4\u5219\uff0c\u5bfc\u81f4\u6574\u4f53 MGR \u96c6\u7fa4\u5931\u6548\uff0c\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u65e0\u6cd5\u91cd\u65b0\u9009\u4e3e\uff0c\u540c\u65f6\u65e5\u5fd7\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u65b0\u5185\u5bb9\u4ea7\u751f\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#33","title":"3.3 \u6574\u4f53\u96c6\u7fa4\u6062\u590d","text":"<pre><code>START GROUP_REPLICATION;\n</code></pre>"},{"location":"database/mysql/mysql%20group%20replication/#_1","title":"\u5355\u4e3b\u6a21\u5f0f\u548c\u591a\u4e3b\u6a21\u5f0f","text":"<p>\u5728\u5355\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u7ec4\u590d\u5236\u5177\u6709\u81ea\u52a8\u9009\u4e3b\u529f\u80fd\uff0c\u6bcf\u6b21\u53ea\u6709\u4e00\u4e2a Server \u6210\u529f\u63a5\u53d7\u66f4\u65b0\u3002\u5355\u5199\u6a21\u5f0f Group \u5185\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u53ea\u53ef\u4ee5\u8bfb\u3002\u5bf9\u4e8e Group \u7684\u90e8\u7f72\uff0c\u9700\u8981\u5148\u8dd1 Primary \u8282\u70b9\uff0c\u7136\u540e\u518d\u8dd1\u5176\u4ed6\u8282\u70b9\uff0c\u5e76\u628a\u8fd9\u4e9b\u8282\u70b9\u52a0\u8fdb Group\u3002\u5176\u5b83\u7684\u8282\u70b9\u5c31\u4f1a\u81ea\u52a8\u540c\u6b65 Primary \u8282\u70b9\u4e0a\u7684\u53d8\u5316\uff0c\u7136\u540e\u5c06\u81ea\u5df1\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u6a21\u5f0f\u3002\u5f53 Primary \u8282\u70b9\u53d1\u751f\u610f\u5916\u5b95\u673a\u6216\u8005\u4e0b\u7ebf\uff0c\u5728\u6ee1\u8db3\u591a\u8282\u70b9\u5b58\u6d3b\u7684\u60c5\u51b5\u4e0b\uff0cGroup \u5185\u90e8\u53d1\u8d77\u9009\u4e3e\uff0c\u9009\u51fa\u4e0b\u4e00\u4e2a\u53ef\u7528\u7684\u8bfb\u8282\u70b9\uff0c\u63d0\u5347\u4e3a Primary \u8282\u70b9\u3002Primary \u9009\u4e3e\u6839\u636e Group \u5185\u5269\u4e0b\u5b58\u6d3b\u8282\u70b9\u7684 UUID \u6309\u5b57\u5178\u5347\u5e8f\u6765\u9009\u62e9\uff0c\u7136\u540e\u9009\u62e9\u6392\u5728\u6700\u524d\u9762\u7684\u8282\u70b9\u4f5c\u4e3a\u65b0\u7684 Primary \u8282\u70b9\u3002</p> <p>\u5728\u591a\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u6240\u6709\u7684 Server \u6210\u5458\u90fd\u53ef\u4ee5\u540c\u65f6\u63a5\u53d7\u66f4\u65b0\u3002Group \u5185\u7684\u6240\u6709\u6210\u5458\u673a\u5668\u90fd\u662f Primary \u8282\u70b9\uff0c\u540c\u65f6\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u5e76\u4e14\u6570\u636e\u90fd\u662f\u4e00\u81f4\u7684\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#1","title":"1 \u8fd0\u884c\u65f6\u5207\u6362\u4e3a\u591a\u4e3b\u6a21\u5f0f","text":""},{"location":"database/mysql/mysql%20group%20replication/#11_1","title":"1.1 \u542f\u52a8\u591a\u4e3b\u6a21\u5f0f","text":"<pre><code>-- \u505c\u6b62\u7ec4\u590d\u5236\nSTOP GROUP_REPLICATION;\n\n-- \u542f\u7528\u591a\u4e3b\u6a21\u5f0f\nSET global_group_replication_single_primary_mode=OFF;\n\n-- \u542f\u7528\u6761\u4ef6\u68c0\u67e5\nSET global_group_replication_enforce_update_everywhere_checks=ON;\n</code></pre> <p>\u591a\u4e3b\u7684\u7ea6\u675f\u66f4\u4e3a\u4e25\u683c\uff0c\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u76f4\u63a5\u62d2\u7edd\u3002</p> <ul> <li>\u4e0d\u652f\u6301\u5916\u952e\u7684\u7ea7\u8054\u64cd\u4f5c</li> <li>\u4e0d\u652f\u6301 Serializable\uff08\u4e32\u884c\u5316\uff09</li> </ul>"},{"location":"database/mysql/mysql%20group%20replication/#12","title":"1.2 \u5f15\u5bfc\u7ec4\u590d\u5236","text":"<p>\u540c\u5355\u7ec4\u6a21\u5f0f\u3002\u5404\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u540e\uff0c\u6240\u6709\u8282\u70b9\u90fd\u662f Primary \u8282\u70b9\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#2_1","title":"2 \u5e94\u7528\u5c42\u53cc\u6d3b\u548c\u6570\u636e\u5e93\u53cc\u6d3b\u3001\u5e94\u7528\u5c42\u53cc\u6d3b\u548c\u6570\u636e\u5e93\u5355\u6d3b","text":""},{"location":"database/mysql/mysql%20group%20replication/#21-mgr","title":"2.1 MGR \u96c6\u7fa4\u591a\u6d3b\u67b6\u6784","text":"<p>\u57fa\u4e8e MGR \u7684\u591a\u6d3b\u7279\u6027\uff0c\u6570\u636e\u7684\u5199\u5165\u53ef\u4ee5\u5728\u591a\u4e2a\u8282\u70b9\u4e4b\u95f4\u590d\u5236\uff0c\u5b9e\u73b0\u6570\u636e\u5899\u5f3a\u4e00\u81f4\u6027\u9700\u6c42\uff0c\u5e76\u4e14\u5728\u8282\u70b9\u95f4\u901a\u4fe1\u51fa\u73b0\u5ef6\u8fdf\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u81ea\u52a8\u5b9e\u73b0\u670d\u52a1\u964d\u7ea7\u3002\u5bf9\u4e8e\u6b64\u7c7b\u65b9\u6848\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u540c\u673a\u623f\u591a\u5199\uff0c\u540c\u57ce\u5f02\u673a\u623f\u53ea\u8bfb\u7684\u65b9\u6848\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#22_1","title":"2.2 \u53cc\u4e3b\u6a21\u5f0f\u7684\u591a\u6d3b","text":"<p>\u4e24\u4e2a\u8282\u70b9\u5747\u53ef\u4ee5\u5199\u5165\u6570\u636e\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8de8\u673a\u623f\u7684\u6570\u636e\u590d\u5236\uff0c\u5ef6\u8fdf\u8f83\u4f4e\uff0c\u5728\u4e1a\u52a1\u5c42\u9700\u8981\u505a\u9694\u79bb\uff0c\u5728\u6545\u969c\u53d1\u751f\u65f6\u80fd\u591f\u5feb\u901f\u5207\u6362\u5230\u540c\u673a\u623f\u7684 Slave \u8282\u70b9\u3002\u6b64\u65b9\u6848\u5bf9\u4e8e\u4e24\u4e2a IDC \u673a\u623f\u7684\u573a\u666f\u4e2d\u8f83\u4e3a\u5b9e\u7528\uff0c\u4f46\u662f\u673a\u623f\u591a\u6d3b\u7684\u573a\u666f\u4e0d\u9002\u5408\u3002</p>"},{"location":"database/mysql/mysql%20group%20replication/#23_1","title":"2.3 \u4e1a\u52a1\u4ea4\u53c9\u7684\u53cc\u6d3b\u65b9\u6848","text":""},{"location":"database/mysql/query-cache/","title":"Query cache","text":""},{"location":"database/mysql/query-cache/#_1","title":"\u67e5\u8be2\u7f13\u5b58","text":"<p>\u5f00\u542f\u67e5\u8be2\u7f13\u5b58\u540e\u5728\u540c\u6837\u7684\u67e5\u8be2\u6761\u4ef6\u4ee5\u53ca\u6570\u636e\u60c5\u51b5\u4e0b\uff08\u8fd9\u91cc\u7684\u67e5\u8be2\u6761\u4ef6\u5305\u62ec\u67e5\u8be2\u672c\u8eab\u3001\u5f53\u524d\u8981\u67e5\u8be2\u7684\u6570\u636e\u5e93\u3001\u5ba2\u6237\u7aef\u534f\u8bae\u7248\u672c\u53f7\u7b49\u4e00\u4e9b\u53ef\u80fd\u5f71\u54cd\u7ed3\u679c\u7684\u4fe1\u606f\uff09\uff0c\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u67e5\u8be2\u7f13\u5b58\u3002\u4e0d\u8fc7\uff0cMySQL 8.0 \u7248\u672c\u540e\u79fb\u9664\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u529f\u80fd\u4e0d\u592a\u5b9e\u7528</p>"},{"location":"database/mysql/query-cache/#_2","title":"\u5f00\u542f\u67e5\u8be2\u7f13\u5b58","text":"<ul> <li><code>my.cnf</code> \u52a0\u5165\u4ee5\u4e0b\u914d\u7f6e\uff0c\u91cd\u542f MySQL \u5f00\u542f\u67e5\u8be2\u7f13\u5b58     <pre><code>query_cache_type=1\nquery_cache_size=3145728\n</code></pre></li> <li> <p>MySQL \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e5f\u53ef\u4ee5\u5f00\u542f\u67e5\u8be2\u7f13\u5b58</p> <pre><code>SET GLOBAL query_cache_type=1;\nSET GLOBAL query_cache_size=3145728;\n</code></pre> </li> <li> <p>\u63a7\u5236\u67d0\u4e2a\u67e5\u8be2\u8bed\u53e5\u662f\u5426\u9700\u8981\u67e5\u8be2\u7f13\u5b58</p> <pre><code>SELECT sql_no_cache COUNT(*) FROM table_name;\n</code></pre> </li> </ul>"},{"location":"database/mysql/query-cache/#_3","title":"\u67e5\u8be2\u7f13\u5b58\u4e0d\u547d\u4e2d\u7684\u60c5\u51b5","text":"<ul> <li>\u4efb\u4f55\u4e24\u4e2a\u67e5\u8be2\u5728\u4efb\u4f55\u5b57\u7b26\u4e0a\u7684\u4e0d\u540c\u90fd\u4f1a\u5bfc\u81f4\u7f13\u5b58\u4e0d\u547d\u4e2d</li> <li>\u5982\u679c\u67e5\u8be2\u4e2d\u5305\u542b\u4efb\u4f55\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u3001\u5b58\u50a8\u8fc7\u7a0b\u3001\u7528\u6237\u53d8\u91cf\u3001\u4e34\u65f6\u8868\uff0c\u5176\u67e5\u8be2\u7ed3\u679c\u4e5f\u4e0d\u4f1a\u88ab\u7f13\u5b58</li> <li>\u7f13\u5b58\u5efa\u7acb\u4e4b\u540e\uff0cMySQL \u7684\u67e5\u8be2\u7f13\u5b58\u7cfb\u7edf\u4f1a\u8ddf\u8e2a\u67e5\u8be2\u4e2d\u6d89\u53ca\u7684\u6bcf\u5f20\u8868\uff0c\u5982\u679c\u8fd9\u4e9b\u8868\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u8fd9\u5f20\u8868\u7684\u6240\u6709\u7f13\u5b58\u6570\u636e\u90fd\u5c06\u5931\u6548</li> </ul>"},{"location":"database/mysql/transaction/","title":"Transaction","text":""},{"location":"database/mysql/transaction/#_1","title":"\u4e8b\u52a1","text":""},{"location":"database/mysql/transaction/#_2","title":"\u5f00\u542f\u4e8b\u52a1","text":"<pre><code>START TRANSACTION;\n-- sql_1;\n-- ...\n-- sql_n;\nCOMMIT;\n</code></pre>"},{"location":"database/mysql/transaction/#acid","title":"\u4e8b\u52a1 ACID \u7279\u6027","text":"\u539f\u5b50\u6027\uff08Atomicity\uff09 \u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282 \u4e00\u81f4\u6027\uff08Consistency\uff09 \u5728\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u548c\u4e8b\u52a1\u7ed3\u675f\u4ee5\u540e\uff0c\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\u6ca1\u6709\u88ab\u7834\u574f \u9694\u79bb\u6027\uff08Isolation\uff09 \u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002\u4e8b\u52a1\u9694\u79bb\u5206\u4e3a\u4e0d\u540c\u7ea7\u522b\uff0c\u5305\u62ec**\u8bfb\u672a\u63d0\u4ea4**\uff08READ-UNCOMMITED\uff09\u3001\u8bfb\u5df2\u63d0\u4ea4\uff08READ-COMMITED\uff09\u3001\u53ef\u91cd\u590d\u8bfb\uff08REPEATABLE-READ\uff09\u3001\u53ef\u4e32\u884c\u5316\uff08SERIALIZABLE\uff09 \u6301\u4e45\u6027\uff08Durability\uff09 \u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931"},{"location":"database/mysql/transaction/#innodb","title":"InnoDB \u4e8b\u52a1\u5b9e\u73b0\u539f\u7406","text":"\u6301\u4e45\u6027 \u91cd\u505a\u65e5\u5fd7\uff08redo log\uff09 \u539f\u5b50\u6027 \u56de\u6eda\u65e5\u5fd7\uff08undo log\uff09 \u9694\u79bb\u6027 \u9501\u673a\u5236\u3001\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff08MVCC\uff09 \u7b49 \u4e00\u81f4\u6027 \u6301\u4e45\u6027\u3001\u539f\u5b50\u6027\u3001\u9694\u79bb\u6027"},{"location":"database/mysql/transaction/#_3","title":"\u5e76\u53d1\u4e8b\u52a1\u95ee\u9898","text":"\u7b2c\u4e00\u7c7b\u4e22\u5931\u66f4\u65b0\uff08\u56de\u6eda\u4e22\u5931\uff09 \u56de\u6eda\u4e00\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u8986\u76d6\u4e86\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u63d0\u4ea4\u7684\u4fee\u6539 \u810f\u8bfb \u8bfb\u53d6\u5230\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5c1a\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff0c\u5e76\u57fa\u4e8e\u8fd9\u4e2a\u6570\u636e\u8fdb\u884c\u4e86\u64cd\u4f5c \u4e0d\u53ef\u91cd\u590d\u8bfb \u5728\u4e24\u6b21\u8bfb\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u5176\u5b83\u4e8b\u52a1\u7684\u4fee\u6539\uff0c\u5bfc\u81f4\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4 \u7b2c\u4e8c\u7c7b\u4e22\u5931\u66f4\u65b0\uff08\u8986\u76d6\u4e22\u5931\uff09 \u63d0\u4ea4\u4e00\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u8986\u76d6\u4e86\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u63d0\u4ea4\u7684\u4fee\u6539 \u5e7b\u8bfb \u5728\u4e24\u6b21\u8bfb\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u5176\u5b83\u4e8b\u52a1\u7684\u4fee\u6539\uff0c\u5bfc\u81f4\u4e24\u6b21\u8bfb\u53d6\u7684\u96c6\u5408\u4e0d\u4e00\u81f4"},{"location":"database/mysql/transaction/#_4","title":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b","text":"<p>SQL \u6807\u51c6\u5b9a\u4e49\u4e86\u56db\u4e2a\u9694\u79bb\u7ea7\u522b</p> \u7b2c\u4e00\u7c7b\u4e22\u5931\u66f4\u65b0 \u810f\u8bfb \u4e0d\u53ef\u91cd\u590d\u8bfb \u7b2c\u4e8c\u7c7b\u4e22\u5931\u66f4\u65b0 \u5e7b\u8bfb \u8bfb\u672a\u63d0\u4ea4 \u4e0d\u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u8bfb\u5df2\u63d0\u4ea4 \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u53ef\u80fd \u53ef\u91cd\u590d\u8bfb \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u53ef\u80fd \u53ef\u4e32\u884c\u5316 \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd \u4e0d\u53ef\u80fd"},{"location":"database/mysql/%E5%AE%89%E8%A3%85/","title":"\u5b89\u88c5","text":""},{"location":"database/mysql/%E5%AE%89%E8%A3%85/#_1","title":"\u5b89\u88c5","text":""},{"location":"database/mysql/%E5%AE%89%E8%A3%85/#yum","title":"yum","text":""},{"location":"database/mysql/%E5%AE%89%E8%A3%85/#_2","title":"\u79bb\u7ebf\u5b89\u88c5","text":"<pre><code>wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.44-1.el7.x86_64.rpm-bundle.tar\n\ntar -xvf ./mysql-5.7.44-1.el7.x86_64.rpm-bundle.tar\n\nyum install \\\n    ./mysql-community-server-5.7.44-1.el7.x86_64.rpm \\\n    ./mysql-community-client-5.7.44-1.el7.x86_64.rpm \\\n    ./mysql-community-common-5.7.44-1.el7.x86_64.rpm \\\n    ./mysql-community-libs-5.7.44-1.el7.x86_64.rpm\n</code></pre>"},{"location":"database/mysql/%E5%AE%89%E8%A3%85/#_3","title":"\u9ed8\u8ba4\u914d\u7f6e","text":"<ul> <li> <p><code>/etc/my.cnf</code></p> <pre><code># For advice on how to change settings please see\n# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html\n\n[mysqld]\n#\n# Remove leading # and set to the amount of RAM for the most important data\n# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.\n# innodb_buffer_pool_size = 128M\n#\n# Remove leading # to turn on a very important data integrity option: logging\n# changes to the binary log between backups.\n# log_bin\n#\n# Remove leading # to set options mainly useful for reporting servers.\n# The server defaults are faster for transactions and fast SELECTs.\n# Adjust sizes as needed, experiment to find the optimal values.\n# join_buffer_size = 128M\n# sort_buffer_size = 2M\n# read_rnd_buffer_size = 2M\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\n\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\nlog-error=/var/log/mysqld.log\npid-file=/var/run/mysqld/mysqld.pid\n</code></pre> </li> <li> <p><code>/etc/systemd/system/multi-user.target.wants/mysqld.service</code></p> <pre><code># Copyright (c) 2015, 2023, Oracle and/or its affiliates.\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License, version 2.0,\n# as published by the Free Software Foundation.\n#\n# This program is also distributed with certain software (including\n# but not limited to OpenSSL) that is licensed under separate terms,\n# as designated in a particular file or component or in included license\n# documentation.  The authors of MySQL hereby grant you an additional\n# permission to link the program and your derivative works with the\n# separately licensed software that they have included with MySQL.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License, version 2.0, for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program; if not, write to the Free Software\n# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA\n#\n# systemd service file for MySQL forking server\n#\n\n[Unit]\nDescription=MySQL Server\nDocumentation=man:mysqld(8)\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=mysql\nGroup=mysql\n\nType=forking\n\nPIDFile=/var/run/mysqld/mysqld.pid\n\n# Disable service start and stop timeout logic of systemd for mysqld service.\nTimeoutSec=0\n\n# Execute pre and post scripts as root\nPermissionsStartOnly=true\n\n# Needed to create system tables\nExecStartPre=/usr/bin/mysqld_pre_systemd\n\n# Start main service\nExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS\n\n# Use this to switch malloc implementation\nEnvironmentFile=-/etc/sysconfig/mysql\n\n# Sets open_files_limit\nLimitNOFILE = 5000\n\nRestart=on-failure\n\nRestartPreventExitStatus=1\n\nPrivateTmp=false\n</code></pre> </li> </ul>"},{"location":"database/mysql/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"\u5e38\u7528\u547d\u4ee4","text":"<pre><code>\\h\n</code></pre>"},{"location":"database/mysql/__guide__/1/","title":"1","text":""},{"location":"database/mysql/__guide__/1/#_1","title":"\u4ec0\u4e48\u662f\u6570\u636e\u5e93\u3001\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u3001\u6570\u636e\u5e93\u7cfb\u7edf\u3001\u6570\u636e\u5e93\u7ba1\u7406\u5458\uff1f","text":"\u6570\u636e\u5e93\uff08DB\uff09 \u6570\u636e\u5e93\u5c31\u662f\u4fe1\u606f\u7684\u96c6\u5408\u6216\u8005\u8bf4\u6570\u636e\u5e93\u662f\u7531\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u7ba1\u7406\u7684\u6570\u636e\u7684\u96c6\u5408 \u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff08DBMS\uff09 \u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u662f\u4e00\u79cd\u64cd\u7eb5\u548c\u7ba1\u7406\u6570\u636e\u5e93\u7684\u5927\u578b\u8f6f\u4ef6\uff0c\u901a\u5e38\u7528\u4e8e\u5efa\u7acb\u3001\u4f7f\u7528\u548c\u7ef4\u62a4\u6570\u636e\u5e93 \u6570\u636e\u5e93\u7cfb\u7edf\uff08DBS\uff09 \u6570\u636e\u5e93\u7cfb\u7edf\u901a\u5e38\u7531\u8f6f\u4ef6\u3001\u6570\u636e\u5e93\u3001\u548c\u7ba1\u7406\u5458\u7ec4\u6210 \u6570\u636e\u5e93\u7ba1\u7406\u5458\uff08DBA\uff09 \u6570\u636e\u5e93\u7ba1\u7406\u5458\u8d1f\u8d23\u5168\u9762\u7ba1\u7406\u548c\u63a7\u5236\u6570\u636e\u5e93\u7cfb\u7edf"},{"location":"database/mysql/__guide__/1/#_2","title":"\u4ec0\u4e48\u662f\u5143\u7ec4\u3001\u7801\u3001\u5019\u9009\u7801\u3001\u4e3b\u7801\u3001\u5916\u7801\u3001\u4e3b\u5c5e\u6027\u3001\u975e\u4e3b\u5c5e\u6027\uff1f","text":"\u5143\u7ec4 \u5143\u7ec4\u662f\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u5173\u7cfb\u662f\u4e00\u5f20\u8868\uff0c\u8868\u4e2d\u7684\u6bcf\u884c\uff08\u5373\u6570\u636e\u5e93\u7cfb\u7edf\u4e2d\u7684\u6bcf\u6761\u8bb0\u5f55\uff09\u5c31\u662f\u4e00\u4e2a\u5143\u7ec4\uff0c\u6bcf\u5217\u5c31\u662f\u4e00\u4e2a\u5c5e\u6027\u3002\u5728\u4e8c\u7ef4\u8868\u4e2d\uff0c\u5143\u7ec4\u4e5f\u79f0\u4e3a\u884c \u7801 \u7801\u5c31\u662f\u80fd\u552f\u4e00\u6807\u8bc6\u5b9e\u4f53\u7684\u5c5e\u6027\uff0c\u5bf9\u5e94\u8868\u4e2d\u7684\u5217 \u5019\u9009\u7801 \u82e5\u5173\u7cfb\u4e2d\u7684\u67d0\u4e00\u5c5e\u6027\u6216\u5c5e\u6027\u7ec4\u7684\u503c\u80fd\u552f\u4e00\u7684\u6807\u8bc6\u4e00\u4e2a\u5143\u7ec4\uff0c\u800c\u5176\u4efb\u4f55\u5b50\u96c6\u90fd\u4e0d\u80fd\u518d\u6807\u8bc6\uff0c\u5219\u79f0\u8be5\u5c5e\u6027\u7ec4\u4e3a\u5019\u9009\u7801 \u4e3b\u7801 \u4e3b\u7801\u4e5f\u53eb\u4e3b\u952e\u3002\u4e3b\u7801\u662f\u4ece\u5019\u9009\u7801\u4e2d\u9009\u51fa\u6765\u7684\u3002\u4e00\u4e2a\u5b9e\u4f53\u96c6\u4e2d\u53ea\u80fd\u7531\u4e00\u4e2a\u4e3b\u7801\uff0c\u4f46\u53ef\u4ee5\u6709\u591a\u4e2a\u5019\u9009\u7801 \u5916\u7801 \u5916\u7801\u4e5f\u53eb\u5916\u952e\u3002\u5982\u679c\u4e00\u4e2a\u5173\u7cfb\u4e2d\u7684\u4e00\u4e2a\u5c5e\u6027\u662f\u53e6\u5916\u4e00\u4e2a\u5173\u7cfb\u4e2d\u7684\u4e3b\u7801\uff0c\u5219\u8fd9\u4e2a\u5c5e\u6027\u4e3a\u5916\u7801 \u4e3b\u5c5e\u6027 \u5019\u9009\u7801\u4e2d\u51fa\u73b0\u8fc7\u7684\u5c5e\u6027\u79f0\u4e3a\u4e3b\u5c5e\u6027 \u975e\u4e3b\u5c5e\u6027 \u4e0d\u5305\u542b\u5728\u4efb\u4f55\u4e00\u4e2a\u5019\u9009\u7801\u4e2d\u7684\u5c5e\u6027\u79f0\u4e3a\u975e\u4e3b\u5c5e\u6027"},{"location":"database/mysql/__guide__/1/#_3","title":"\u4e3b\u952e\u548c\u5916\u952e\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"\u4e3b\u952e \u4e3b\u952e\u7528\u4e8e\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u5143\u7ec4\uff0c\u4e0d\u80fd\u6709\u91cd\u590d\uff0c\u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002\u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952e \u5916\u952e \u5916\u952e\u7528\u6765\u548c\u5176\u5b83\u8868\u5efa\u7acb\u8054\u7cfb\uff0c\u5916\u952e\u662f\u53e6\u4e00\u4e2a\u8868\u7684\u4e3b\u952e\uff0c\u5916\u952e\u662f\u53ef\u4ee5\u6709\u91cd\u590d\u7684\uff0c\u53ef\u4ee5\u662f\u7a7a\u503c\u3002\u4e00\u4e2a\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u5916\u952e"},{"location":"database/mysql/__guide__/1/#_4","title":"\u4e3a\u4ec0\u4e48\u4e0d\u63a8\u8350\u4f7f\u7528\u5916\u952e\u548c\u7ea7\u8054\uff1f","text":"<ul> <li>\u589e\u52a0\u4e86\u590d\u6742\u6027</li> <li>\u589e\u52a0\u4e86\u989d\u5916\u5de5\u4f5c</li> <li>\u5916\u952e\u8fd8\u4f1a\u56e0\u4e3a\u9700\u8981\u8bf7\u6c42\u5bf9\u5176\u5b83\u8868\u5185\u90e8\u52a0\u9501\u800c\u5bb9\u6613\u51fa\u73b0\u6b7b\u9501\u60c5\u51b5</li> <li>\u5bf9\u5206\u5e93\u5206\u8868\u4e0d\u53cb\u597d</li> </ul>"},{"location":"database/mysql/__guide__/1/#_5","title":"\u6570\u636e\u5e93\u8303\u5f0f\uff1f","text":"\u7b2c\u4e00\u8303\u5f0f\uff081NF\uff09 \u5c5e\u6027\u4e0d\u53ef\u518d\u5206\uff0c1NF \u662f\u6240\u6709\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6700\u57fa\u672c\u8981\u6c42 \u7b2c\u4e8c\u8303\u5f0f\uff082NF\uff09 1NF \u7684\u57fa\u7840\u4e0a\uff0c\u6d88\u9664\u4e86\u975e\u4e3b\u5c5e\u6027\u5bf9\u4e8e\u7801\u7684\u90e8\u5206\u51fd\u6570\u4f9d\u8d56 \u7b2c\u4e09\u8303\u5f0f\uff083NF\uff09 2NF \u7684\u57fa\u7840\u4e0a\uff0c\u6d88\u9664\u4e86\u975e\u4e3b\u5c5e\u6027\u5bf9\u4e8e\u7801\u7684\u4f20\u9012\u51fd\u6570\u4f9d\u8d56"},{"location":"database/mysql/__guide__/1/#droptruncatedelete","title":"<code>DROP</code>\u3001<code>TRUNCATE</code>\u3001<code>DELETE</code> \u7684\u533a\u522b\uff1f","text":"\u7c7b\u578b \u7528\u9014 \u901f\u5ea6 <code>DROP</code> DDL \u4e22\u5f03\u6570\u636e 1 <code>TRUNCATE</code> DDL \u6e05\u7a7a\u6570\u636e 2 <code>DELETE</code> DML \u5220\u9664\u6570\u636e 3"},{"location":"database/mysql/__guide__/1/#_6","title":"\u6570\u636e\u5e93\u8bbe\u8ba1\u901a\u5e38\u5206\u4e3a\u54ea\u51e0\u90e8\uff1f","text":"<ol> <li> <p>\u9700\u6c42\u5206\u6790\uff1a\u5206\u6790\u7528\u6237\u7684\u9700\u6c42\uff0c\u5305\u62ec\u6570\u636e\u3001\u529f\u80fd\u3001\u6027\u80fd\u9700\u6c42</p> </li> <li> <p>\u6982\u5ff5\u7ed3\u6784\u8bbe\u8ba1\uff1a\u4e3b\u8981\u91c7\u7528 E-R \u6a21\u578b\u8fdb\u884c\u8bbe\u8ba1\uff0c\u5305\u62ec\u753b E-R \u56fe</p> </li> <li> <p>\u903b\u8f91\u7ed3\u6784\u8bbe\u8ba1\uff1a\u901a\u8fc7\u5c06 E-R \u56fe\u8f6c\u6362\u6210\u8868\uff0c\u5b9e\u73b0\u4ece E-R \u6a21\u578b\u5230\u5173\u7cfb\u6a21\u578b\u7684\u8f6c\u6362</p> </li> <li> <p>\u7269\u7406\u7ed3\u6784\u8bbe\u8ba1\uff1a\u4e3b\u8981\u662f\u4e3a\u6240\u8bbe\u8ba1\u7684\u6570\u636e\u5e93\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u7ed3\u6784\u548c\u5b58\u53d6\u8def\u5f84</p> </li> <li> <p>\u6570\u636e\u5e93\u5b9e\u65bd\uff1a\u5305\u62ec\u7f16\u7a0b\u3001\u6d4b\u8bd5\u548c\u8bd5\u8fd0\u884c</p> </li> <li> <p>\u6570\u636e\u5e93\u8fd0\u884c\u548c\u7ef4\u62a4\uff1a\u7cfb\u7edf\u7684\u8fd0\u884c\u548c\u6570\u636e\u5e93\u7684\u65e5\u5e38\u7ef4\u62a4</p> </li> </ol>"},{"location":"database/mysql/__guide__/2/","title":"2","text":"<p>\u5fae\u4fe1\u672c\u5730\u7684\u804a\u5929\u8bb0\u5f55\u7684\u5b58\u50a8\u5c31\u662f\u7528\u7684 SQLite</p>"},{"location":"database/mysql/__guide__/2/#_1","title":"\u5b58\u50a8\u5f15\u64ce","text":""},{"location":"database/mysql/__guide__/2/#_2","title":"\u5b58\u50a8\u5f15\u64ce\u76f8\u5173\u7684\u547d\u4ee4","text":"<ul> <li> <p>\u67e5\u770b MySQL \u63d0\u4f9b\u7684\u6240\u6709\u5b58\u50a8\u5f15\u64ce</p> <pre><code>SHOW ENGINES;\n</code></pre> </li> <li> <p>\u67e5\u770b MySQL \u5f53\u524d\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce</p> <pre><code>SHOW VARIABLES LIKE '%storage_engine%';\n</code></pre> </li> <li> <p>\u67e5\u770b\u8868\u7684\u5b58\u50a8\u5f15\u64ce</p> <pre><code>SHOW TABLE STATUS LIKE 'table_name';\n</code></pre> </li> </ul>"},{"location":"database/mysql/__guide__/2/#myisam-innodb","title":"MyISAM \u548c InnoDB \u7684\u533a\u522b","text":"MyISAM InnoDB \u662f\u5426\u652f\u6301\u884c\u7ea7\u9501 \u53ea\u6709\u8868\u7ea7\u9501 \u9ed8\u8ba4\u884c\u7ea7\u9501 \u662f\u5426\u652f\u6301\u4e8b\u52a1 \u4e0d\u652f\u6301 \u652f\u6301 \u662f\u5426\u652f\u6301\u5916\u952e \u4e0d\u652f\u6301 \u652f\u6301 \u662f\u5426\u652f\u6301\u6570\u636e\u5e93\u5f02\u5e38\u5d29\u6e83\u540e\u7684\u5b89\u5168\u6062\u590d \u4e0d\u652f\u6301 \u4f7f\u7528 InnoDB \u7684\u6570\u636e\u5e93\u518d\u5f02\u5e38\u5d29\u6e83\u540e\uff0c\u6570\u636e\u5e93\u91cd\u65b0\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u4fdd\u8bc1\u6570\u636e\u5e93\u6062\u590d\u5230\u5d29\u6e83\u524d\u7684\u72b6\u6001\u3002\u8fd9\u4e2a\u6062\u590d\u7684\u8fc7\u7a0b\u4f9d\u8d56\u4e8e <code>redo log</code> \u662f\u5426\u652f\u6301 MVCC \u4e0d\u652f\u6301 MVCC \u53ef\u4ee5\u770b\u4f5c\u662f\u884c\u7ea7\u9501\u7684\u4e00\u4e2a\u5347\u7ea7\uff0c\u53ef\u4ee5\u6709\u6548\u51cf\u5c11\u52a0\u9501\u64cd\u4f5c\uff0c\u63d0\u9ad8\u6027\u80fd <ul> <li>MySQL InnoDB \u5f15\u64ce\u901a\u8fc7 <code>redo log</code> \u4fdd\u8bc1\u4e8b\u52a1\u7684**\u6301\u4e45\u6027**\uff0c\u4f7f\u7528 <code>undo log</code> \u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684**\u539f\u5b50\u6027**</li> <li>MySQL InnoDB \u5f15\u64ce\u901a\u8fc7**\u9501\u673a\u5236**\u3001MVCC \u7b49\u624b\u6bb5\u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff08\u9ed8\u8ba4\u652f\u6301\u7684\u9694\u79bb\u7ea7\u522b\u662f <code>REPEATABLE-READ</code>\uff09</li> <li>\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u7684**\u6301\u4e45\u6027**\u3001\u539f\u5b50\u6027\u3001**\u9694\u79bb\u6027**\u4e4b\u540e\uff0c**\u4e00\u81f4\u6027**\u624d\u80fd\u5f97\u5230\u4fdd\u969c</li> </ul>"},{"location":"database/mysql/__guide__/2/#innodb","title":"\u9501\u673a\u5236\u4e0e InnoDB \u7b97\u6cd5","text":""},{"location":"database/mysql/__guide__/2/#_3","title":"\u8868\u7ea7\u9501\u548c\u884c\u7ea7\u9501\u5bf9\u6bd4","text":"\u8868\u7ea7\u9501 MySQL \u4e2d\u9501\u5b9a\u7c92\u5ea6\u6700\u5927\u7684\u4e00\u79cd\u9501\uff0c\u5bf9\u5f53\u524d\u64cd\u4f5c\u7684\u6574\u5f20\u8868\u52a0\u9501\uff0c\u5b9e\u73b0\u7b80\u5355\uff0c\u8d44\u6e90\u6d88\u8017\u4e5f\u6bd4\u8f83\u5c11\uff0c\u52a0\u9501\u5feb\uff0c\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002\u5176\u9501\u5b9a\u7c92\u5ea6\u6700\u5927\uff0c\u89e6\u53d1\u9501\u51b2\u7a81\u989d\u6982\u7387\u6700\u9ad8\uff0c\u5e76\u53d1\u5ea6\u6700\u4f4e \u884c\u7ea7\u9501 MySQL \u4e2d\u9501\u5b9a\u7c92\u5ea6\u6700\u5c0f\u7684\u4e00\u79cd\u9501\uff0c\u53ea\u9488\u5bf9\u5f53\u524d\u64cd\u4f5c\u7684\u884c\u8fdb\u884c\u52a0\u9501\u3002\u884c\u7ea7\u9501\u80fd\u5927\u5927\u51cf\u5c11\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u51b2\u7a81\u3002\u5176\u52a0\u9501\u7c92\u5ea6\u6700\u5c0f\uff0c\u5e76\u53d1\u5ea6\u9ad8\uff0c\u4f46\u52a0\u9501\u7684\u5f00\u9500\u4e5f\u6700\u5927\uff0c\u52a0\u9501\u6162\uff0c\u4f1a\u51fa\u73b0\u6b7b\u9501"},{"location":"database/mysql/__guide__/2/#innodb_1","title":"InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u9501\u7b97\u6cd5","text":"<ul> <li>Record Lock\uff1a\u8bb0\u5f55\u9501\uff0c\u5355\u4e2a\u884c\u8bb0\u5f55\u4e0a\u5927\u7684\u9501</li> <li>Gap Lock\uff1a\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4e0d\u5305\u62ec\u8bb0\u5f55\u672c\u8eab</li> <li>Next-Key Lock\uff1a\u4e34\u952e\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5305\u542b\u8bb0\u5f55\u672c\u8eab</li> </ul>"},{"location":"database/mysql/__guide__/2/#_4","title":"\u67e5\u8be2\u7f13\u5b58","text":"<p>\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u67e5\u8be2\u7f13\u5b58\u3002\u4e0d\u8fc7\uff0cMySQL 8.0 \u7248\u672c\u540e\u79fb\u9664\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u529f\u80fd\u4e0d\u592a\u5b9e\u7528</p>"},{"location":"database/mysql/__guide__/2/#_5","title":"\u5f00\u542f","text":"<ul> <li> <p><code>my.cnf</code> \u52a0\u5165\u4ee5\u4e0b\u914d\u7f6e\uff0c\u91cd\u542f MySQL \u5f00\u542f\u67e5\u8be2\u7f13\u5b58</p> <pre><code>query_cache_type=1\nquery_cache_size=600000\n</code></pre> </li> <li> <p>MySQL \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e5f\u53ef\u4ee5\u5f00\u542f\u67e5\u8be2\u7f13\u5b58</p> <pre><code>SET GLOBAL query_cache_type=1;\nSET GLOBAL query_cache_size=600000;\n</code></pre> </li> <li> <p>\u901a\u8fc7 <code>sql_cache</code> \u548c <code>sql_no_cache</code> \u6765\u63a7\u5236\u67d0\u4e2a\u8bed\u53e5\u662f\u5426\u9700\u8981\u7f13\u5b58</p> <pre><code>SELECT sql_no_cache COUNT(*) FROM user;\n</code></pre> </li> </ul>"},{"location":"database/mysql/__guide__/2/#_6","title":"\u67e5\u8be2\u7f13\u5b58\u4e0d\u547d\u4e2d\u7684\u60c5\u51b5","text":"<ul> <li>\u4efb\u4f55\u4e24\u4e2a\u67e5\u8be2\u5728\u4efb\u4f55\u5b57\u7b26\u4e0a\u7684\u4e0d\u540c\u90fd\u4f1a\u5bfc\u81f4\u7f13\u5b58\u4e0d\u547d\u4e2d</li> <li>\u5982\u679c\u67e5\u8be2\u4e2d\u5305\u542b\u4efb\u4f55\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u3001\u5b58\u50a8\u8fc7\u7a0b\u3001\u73af\u5883\u53d8\u91cf\u3001\u4e34\u65f6\u8868\u3001MySQL \u5e93\u4e2d\u7684\u7cfb\u7edf\u8868\uff0c\u5176\u67e5\u8be2\u7ed3\u679c\u4e5f\u4e0d\u4f1a\u88ab\u7f13\u5b58</li> <li>\u7f13\u5b58\u5efa\u7acb\u4e4b\u540e\uff0cMySQL \u7684\u67e5\u8be2\u7f13\u5b58\u7cfb\u7edf\u7cfb\u7edf\u4f1a\u8ddf\u8e2a\u67e5\u8be2\u4e2d\u6d89\u53ca\u7684\u6bcf\u5f20\u8868\uff0c\u5982\u679c\u8fd9\u4e9b\u8868\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u548c\u8fd9\u5f20\u8868\u76f8\u5173\u7684\u6240\u6709\u7f13\u5b58\u6570\u636e\u90fd\u5c06\u5931\u6548</li> </ul>"},{"location":"database/mysql/__guide__/2/#_7","title":"\u4e8b\u52a1","text":"<p>\u4e8b\u52a1\u662f\u903b\u8f91\u4e0a\u7684\u4e00\u7ec4\u64cd\u4f5c\uff0c\u8981\u4e48\u90fd\u6267\u884c\uff0c\u8981\u4e48\u90fd\u4e0d\u6267\u884c</p>"},{"location":"database/mysql/__guide__/2/#_8","title":"\u6570\u636e\u5e93\u4e8b\u52a1","text":"<ul> <li> <p>\u5f00\u542f\u4e8b\u52a1</p> <pre><code>START TRANSACTION;\n# \u591a\u6761 SQL \u8bed\u53e5\nCOMMIT;\n</code></pre> </li> </ul>"},{"location":"database/mysql/__guide__/2/#acid","title":"\u4f55\u4e3a ACID \u7279\u6027","text":"\u539f\u5b50\u6027\uff08Actomicity\uff09 \u4e8b\u52a1\u662f\u6700\u5c0f\u7684\u6267\u884c\u5355\u4f4d\uff0c\u4e0d\u5141\u8bb8\u5206\u9694\u3002\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u786e\u4fdd\u52a8\u4f5c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5b8c\u5168\u4e0d\u8d77\u4f5c\u7528 \u4e00\u81f4\u6027\uff08Consistency\uff09 \u6267\u884c\u4e8b\u52a1\u524d\u540e\uff0c\u6570\u636e\u4fdd\u6301\u4e00\u81f4 \u9694\u79bb\u6027\uff08Isolation\uff09 \u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u4e00\u4e2a\u7528\u6237\u7684\u4e8b\u52a1\u4e0d\u88ab\u5176\u5b83\u4e8b\u52a1\u6240\u5e72\u6270\uff0c\u5404\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u6570\u636e\u5e93\u662f\u72ec\u7acb\u7684\uff1b \u6301\u4e45\u6027\uff08Durability\uff09 \u4e00\u4e2a\u4e8b\u52a1\u88ab\u63d0\u4ea4\u4e4b\u540e\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u4e2d\u6570\u636e\u989d\u6539\u53d8\u662f\u6301\u4e45\u7684\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u53d1\u751f\u6545\u969c\u4e5f\u4e0d\u5e94\u8be5\u5bf9\u5176\u6709\u4efb\u4f55\u5f71\u54cd"},{"location":"database/mysql/__guide__/2/#_9","title":"\u6570\u636e\u4e8b\u52a1\u7684\u5b9e\u73b0\u539f\u7406","text":"<ul> <li>MySQL InnoDB \u5f15\u64ce<ul> <li>MySQL InnoDB \u5f15\u64ce\u901a\u8fc7\u4f7f\u7528 <code>redo log</code> \u4fdd\u8bc1\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u4f7f\u7528 <code>undo log</code> \u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u539f\u5b50\u6027</li> <li>MySQL InnoDB \u5f15\u64ce\u901a\u8fc7\u9501\u673a\u5236\u3001MVCC \u7b49\u624b\u6bb5\u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff08\u9ed8\u8ba4\u652f\u6301\u7684\u9694\u79bb\u7ea7\u522b\u662f <code>REPEATABLE-READ</code>\uff09</li> <li>\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u3001\u539f\u5b50\u6027\u3001\u9694\u79bb\u6027\u4e4b\u540e\uff0c\u4e00\u81f4\u6027\u624d\u80fd\u5f97\u5230\u4fdd\u969c</li> </ul> </li> </ul>"},{"location":"database/mysql/__guide__/2/#_10","title":"\u5e76\u53d1\u4e8b\u52a1\u5e26\u6765\u54ea\u4e9b\u95ee\u9898","text":""},{"location":"database/neo4j/","title":"Neo4j","text":""},{"location":"database/neo4j/#_1","title":"\u660e\u661f\u5173\u7cfb\u56fe\u8c31","text":"<ul> <li> <p>\u5bfc\u5165\u6570\u636e</p> <pre><code>LOAD CSV WITH HEADERS FROM 'https://raw.githubusercontent.com/DesertsX/gulius-projects/master/5_YuLeQuan_Neo4j/ylq_star_nodes.csv' AS row\nCREATE (:Star{name:row.name, id: row.id});\n\nLOAD CSV WITH HEADERS FROM 'https://raw.githubusercontent.com/DesertsX/gulius-projects/master/5_YuLeQuan_Neo4j/ylq_star_relations.csv' AS row\nMATCH (n1:Star{name: row.subject}) , (n2:Star{name: row.object})\nCREATE (n1) - [:Relation{relation: row.relation}] -&gt; (n2);\n</code></pre> </li> <li> <p>\u67e5\u8be2\u7279\u5b9a\u5173\u7cfb</p> <pre><code>MATCH p = () - [:Relation{relation: '\u65e7\u7231'}] -&gt; () RETURN p LIMIT 25;\n</code></pre> <p></p> </li> <li> <p>\u67e5\u8be2\u6700\u77ed\u8def\u5f84</p> <pre><code>MATCH p = shortestpath((:Star{name:\"\u5f20\u56fd\u8363\"}) - [*..5] -&gt; (:Star{name:\"\u5f20\u536b\u5065\"})) RETURN p;\n</code></pre> <p></p> </li> </ul>"},{"location":"database/oceanbase/","title":"OceanBase","text":""},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/","title":"OceanBase \u7b14\u8bb0","text":""},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#docker-oceanbase","title":"docker \u5b89\u88c5 oceanbase","text":"<ul> <li> <p><code>docker-compose.yml</code></p> <pre><code>version: '3'\nservices:\n  oceanbase:\n    image: oceanbase/obce-mini:latest\n    container_name: oceanbase\n    hostname: oceanbase\n    environment:\n      - OB_ROOT_PASSWORD=root\n      - OB_TENANT_NAME=icefery\n    ports:\n      - 2881:2881\n    volumes:\n      - ./oceanbase/root/boot/boot-tmp.yaml:/root/boot/boot-tmp.yaml\n      - ./oceanbase/root/ob/:/root/ob/\nnetworks:\n  default:\n    name: local\n    external: true\n</code></pre> </li> <li> <p><code>/root/boot/boot-tmp.yaml</code></p> <p><code>system_memory</code>\u4e3a\u7cfb\u7edf\u9884\u7559\u5185\u5b58\uff0c\u53ef\u4ee5\u8c03\u5c0f\uff0c\u4f46 <code>memory_limit</code> \u81f3\u5c11\u4e3a 8G \u65f6 OBServer \u624d\u80fd\u6b63\u5e38\u542f\u52a8</p> <pre><code>#FROM https://gitee.com/oceanbase/obdeploy/blob/master/example/mini-local-example.yaml\noceanbase-ce:\n  servers:\n    - 127.0.0.1\n  global:\n    home_path: @OB_HOME_PATH@ # default: /root/ob\n    devname: lo\n    mysql_port: @OB_MYSQL_PORT@ # default: 2881\n    rpc_port: @OB_RPC_PORT@ # default: 2882\n    zone: zone1\n    cluster_id: 1\n    memory_limit: 8G\n    system_memory: 1G\n    stack_size: 512K\n    cpu_count: 16\n    cache_wash_threshold: 1G\n    __min_full_resource_pool_memory: 268435456\n    workers_per_cpu_quota: 10\n    schema_history_expire_time: 1d\n    net_thread_count: 4\n    sys_bkgd_migration_retry_num: 3\n    minor_freeze_times: 10\n    enable_separate_sys_clog: 0\n    enable_merge_by_turn: FALSE\n    enable_auto_leader_switch: FALSE\n    enable_one_phase_commit: FALSE\n    weak_read_version_refresh_interval: 5s\n    trace_log_slow_query_watermark: 10s\n    large_query_threshold: 1s\n    clog_sync_time_warn_threshold: 2000ms\n    syslog_io_bandwidth_limit: 10M\n    enable_sql_audit: FALSE\n    enable_perf_event: FALSE\n    clog_max_unconfirmed_log_count: 5000\n    autoinc_cache_refresh_interval: 86400s\n    cpu_quota_concurrency: 2\n    datafile_size: 5G\n    syslog_level: WARN\n    enable_syslog_recycle: TRUE\n    max_syslog_file_count: 2\n    enable_early_lock_release: false tenant=all\n    default_compress_func: lz4_1.0\n    root_password: @OB_ROOT_PASSWORD@ # default: null\n</code></pre> </li> <li> <p>\u8fde\u63a5</p> <pre><code># \u8fde\u63a5 sys \u79df\u6237\nob-mysql sys\n\n# \u8fde\u63a5\u9ed8\u8ba4\u79df\u6237\u7684 root y\nob-mysql root\n</code></pre> </li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#oracle","title":"Oracle \u517c\u5bb9\u6027\u6682\u4e0d\u652f\u6301\u7684\u529f\u80fd","text":"<ul> <li>\u4e0d\u652f\u6301 <code>LONG</code> \u548c <code>LONG RAW</code> \u6570\u636e\u7c7b\u578b</li> <li><code>SELECT</code> \u8bed\u53e5\u4e2d\u4e0d\u652f\u6301 <code>pivot</code> \u548c <code>unpivot</code> \u5b50\u53e5</li> <li>\u5bf9\u4e8e\u89e6\u53d1\u5668\uff0c\u4e0d\u652f\u6301\u5728\u89c6\u56fe\u4e0a\u521b\u5efa\u89e6\u53d1\u5668\uff1b\u4e0d\u652f\u6301\u5bf9\u89e6\u53d1\u5668\u8fdb\u884c<code>DISABLE</code>\u548c<code>ENABLE</code>\u64cd\u4f5c</li> <li>PL \u4e2d\u6682\u4e0d\u652f\u6301\u6761\u4ef6\u7f16\u8bd1</li> <li>\u6570\u636e\u5e93\u7ea6\u675f\u4e2d\uff0c\u4e0d\u652f\u6301 <code>UNIQUE</code> \u7ea6\u675f\u7684 <code>DISABLE</code> \u64cd\u4f5c\uff1b\u4e0d\u652f\u6301\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\u7684 <code>DISABLE</code> \u548c <code>ENABLE</code>\uff1b\u4e0d\u652f\u6301\u7ea7\u8054\u4e2d\u7684 <code>SET NULL</code></li> <li>\u6682\u4e0d\u652f\u6301 SPLIT\u3001MERGE\u3001EXCHANGE \u548c TRUNCATE \u5206\u533a</li> <li>\u4e0d\u652f\u6301\u51fd\u6570\u3001\u4f4d\u56fe\u548c\u53cd\u5411\u7b49\u7d22\u5f15\u7c7b\u578b</li> <li>\u4e0d\u652f\u6301\u6570\u636e\u5e93\u94fe\u63a5</li> <li>\u4e0d\u652f\u6301 <code>WITH CHECK OPTION</code> \u5b50\u53e5</li> <li>\u6682\u4e0d\u652f\u6301\u5220\u9664\u5ba1\u8ba1\u76f8\u5173\u7684\u5404\u7c7b\u89c6\u56fe</li> <li>\u5bf9\u4e8e\u5907\u4efd\u6062\u590d\u529f\u80fd\uff0c\u4e0d\u652f\u6301\u7ec4\u7ea7\u522b\u7684\u5907\u4efd\uff1b\u4e0d\u652f\u6301\u79df\u6237\u7ea7\u6307\u5b9a\u5907\u4efd\u7684\u624b\u52a8\u5220\u9664\uff1b\u4e0d\u652f\u6301\u5907\u4efd\u6570\u636e\u7684\u6709\u6548\u6027\u9a8c\u8bc1\uff1b\u4e0d\u652f\u6301\u6570\u636e\u5e93\u548c\u8868\u7ea7\u522b\u7684\u5907\u4efd\u6062\u590d</li> <li>\u5bf9\u4e8e SQL \u5f15\u64ce\uff0c\u6682\u4e0d\u652f\u6301\u4f30\u7b97\u5668\u3001\u6267\u884c\u8ba1\u5212\u9694\u79bb\u3001\u8868\u8fbe\u5f0f\u7edf\u8ba1\u5b58\u50a8\uff08ESS\uff09\u548c\u8fd1\u4f3c\u67e5\u8be2\u5904\u7406\u529f\u80fd</li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#mysql","title":"MySQL \u517c\u5bb9\u6027\u6682\u4e0d\u652f\u6301\u7684\u529f\u80fd","text":"<ul> <li>\u6682\u4e0d\u652f\u6301\u7a7a\u95f4\u6570\u636e\u7c7b\u578b\u548c JSON \u6570\u636e\u7c7b\u578b\u3002</li> <li>\u4e0d\u652f\u6301 <code>SELECT \u2026 FOR SHARE \u2026</code> \u8bed\u6cd5\u3002</li> <li>\u4e0d\u652f\u6301\u7a7a\u95f4\u5206\u6790\u51fd\u6570\u3001JSON \u51fd\u6570\u548c\u6027\u80fd\u6a21\u5f0f\u51fd\u6570\u3002</li> <li>\u5bf9\u4e8e\u5907\u4efd\u6062\u590d\u529f\u80fd\uff0c\u4e0d\u652f\u6301\u6570\u636e\u5e93\u548c\u8868\u7ea7\u7684\u5907\u4efd\u6062\u590d\uff1b\u4e0d\u652f\u6301\u5907\u4efd\u6570\u636e\u7684\u6709\u6548\u6027\u9a8c\u8bc1\u3002</li> <li>\u5bf9\u4e8e\u4f18\u5316\u5668\uff0c\u67e5\u770b\u6267\u884c\u8ba1\u5212\u7684\u547d\u4ee4\u4e0d\u652f\u6301\u4f7f\u7528 <code>SHOW WARNINGS</code> \u663e\u793a\u989d\u5916\u7684\u4fe1\u606f\uff1b\u4e0d\u652f\u6301\u6267\u884c <code>ANALYZE TABLE</code> \u67e5\u8be2\u6570\u636e\u5b57\u5178\u4e2d\u8868\u5b58\u50a8\u6709\u5173\u5217\u503c\u7684\u76f4\u65b9\u56fe\u7edf\u8ba1\u4fe1\u606f\u3002</li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"\u5730\u57df Region \u6307\u4e00\u4e2a\u5730\u57df\u6216\u8005\u57ce\u5e02\uff08\u4f8b\u5982\u676d\u5dde\u3001\u4e0a\u6d77\u3001\u6df1\u5733\u7b49\uff09\uff0c\u4e00\u4e2a Region \u5305\u542b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Zone \u53ef\u7528\u533a \u4e00\u4e2a OceanBase \u96c6\u7fa4\uff0c\u7531\u82e5\u5e72\u4e2a\u53ef\u7528\u533a\uff08Zone\uff09\u7ec4\u6210\uff0c\u901a\u5e38\u7531\u4e00\u4e2a\u673a\u623f\u5185\u7684\u82e5\u5e72\u670d\u52a1\u5668\u7ec4\u6210\u4e00\u4e2a Zone \u8d44\u6e90\u6c60 \u4e00\u4e2a\u79df\u6237\u62e5\u6709\u82e5\u5e72\u4e2a\u8d44\u6e90\u6c60\uff0c\u4e00\u4e2a\u8d44\u6e90\u6c60\u53ea\u80fd\u5c5e\u4e8e\u4e00\u4e2a\u79df\u6237 OBServer \u8fd0\u884c OBServer \u8fdb\u7a0b\u7684\u7269\u7406\u673a\u3002\u4e00\u53f0\u7269\u7406\u673a\u4e0a\u53ef\u4ee5\u90e8\u7f72\u4e00\u4e2a\u6216\u8005\u591a\u4e2a OBServer OBProxy \u517c\u5bb9 Oracle/MySQL \u7684\u5ba2\u6237\u7aef\u7684\u4ee3\u7406\u670d\u52a1 RootServer \u4e3b\u63a7\u670d\u52a1\u5668\u3002\u4e3b\u8981\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406\u3001\u6570\u636e\u5206\u5e03\u548c\u526f\u672c\u7ba1\u7406"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#_2","title":"\u6570\u636e\u5206\u5e03","text":"<ul> <li> <p>Hash \u5206\u533a</p> <p>\u901a\u5e38\u7528\u4e8e\u7ed9\u5b9a\u5206\u533a\u952e\u7684\u70b9\u67e5\u8be2\uff0c\u4f8b\u5982\u6309\u7167\u7528\u6237 ID \u6765\u5206\u533a\u3002Hash \u5206\u533a\u901a\u5e38\u80fd\u6d88\u9664\u70ed\u70b9\u67e5\u8be2</p> <pre><code>CREATE TABLE t1 (\n    c1 INT,\n    c2 INT\n) PARTITION BY HASH(c1) PARTITIONS 5\n</code></pre> </li> <li> <p>Range \u5206\u533a</p> <p>\u901a\u5e38\u7528\u4e8e\u5bf9\u5206\u533a\u952e\u9700\u8981\u6309\u7167\u8303\u56f4\u7684\u67e5\u8be2\u3002\u4f8b\u5982\u901a\u8fc7\u6309\u7167\u65f6\u95f4\u5b57\u6bb5\u8fdb\u884c\u8303\u56f4\u5206\u533a\uff0c\u8fd8\u6709\u4ef7\u683c\u533a\u95f4\u7b49\u4e00\u4e9b\u5206\u533a\u65b9\u5f0f</p> <pre><code>CREATE TABLE t2 (\n    c1 NUMBER,\n    c2 NUMBER\n) PARTITION BY RANGE(c1) (\n    PARTITION p0 VALUES LESS THAN(100),\n    PARTITION p1 VALUES LESS THAN(500),\n    PARTITION p2 VALUES LESS THAN(MAXVALUE)\n);\n</code></pre> </li> <li> <p>List \u5206\u533a</p> <p>\u4e3b\u8981\u7528\u4e8e\u679a\u4e3e\u7c7b\u578b</p> <pre><code>CREATE TABLE t3 (\n    c1 NUMBER,\n    c2 NUMBER\n) PARTITION BY RANGE(c1) (\n    PARTITION p0 VALUES IN (1,2,3),\n    PARTITION p1 VALUES IN (5, 6),\n    PARTITION p2 VALUES IN (DEFAULT)\n);\n</code></pre> </li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#sql","title":"SQL \u5f15\u64ce","text":""},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#_3","title":"\u57fa\u4e8e\u89c4\u5219\u7684\u67e5\u8be2\u6539\u5199","text":"<ul> <li> <p>\u89c6\u56fe\u5408\u5e76</p> <pre><code>SELECT t1.c1, v.c1\nFROM t1, (SELECT t2.c1, t3.c2 FROM t2, t3 WHERE t2.c1 = t3.c1) v\nWHERE t1.c2 = v.c2;\n</code></pre> <pre><code>SELECT t1.c1, t2.c1\nFROM t1, t2, t3\nWHERE t2.c1 = t3.c1 AND t1.c2 = t3.c2;\n</code></pre> </li> <li> <p>\u5b50\u67e5\u8be2\u5c55\u5f00</p> <pre><code>SELECT * FROM t1 WHERE t1.c1 IN  (SELECT t2.c1 FROM t2)\n</code></pre> <pre><code>SELECT t1.* FROM t1, t2 WHERE t1.c1 = t2.c1;\n</code></pre> </li> <li> <p><code>ANY</code>/<code>ALL</code> \u4f7f\u7528 <code>MAX/MIN</code> \u6539\u5199</p> <pre><code>SELECT c1 FROM t1 WHERE c1 &gt; ANY(SELECT c1 FROM t2);\n</code></pre> <pre><code>SELECT c1 FROM t1 WHERE c1 &gt; (SELECT MIN(c1) FROM t2);\n</code></pre> </li> <li> <p>\u5916\u8054\u63a5\u6d88\u9664</p> <pre><code>SELECT t1.c1, t2.c2 FROM t1 LEFT JOIN t2 ON t1.c2 = t2.c2 WHERE t2.c2 &gt; 5;\n</code></pre> <pre><code>SELECT t1.c1, t2.c2 FROM t1 INNER JOIN t2 ON t1.c2 = t2.c2 WHERE t2.c2 &gt; 5;\n</code></pre> </li> <li> <p><code>HAVING</code>\u6761\u4ef6\u6d88\u9664</p> <p>\u5982\u679c\u67e5\u8be2\u4e2d\u6ca1\u6709\u805a\u96c6\u64cd\u4f5c\u548c <code>GROUP BY</code>\uff0c\u5219 <code>HAVING</code> \u53ef\u4ee5\u5408\u5e76\u5230 <code>WHERE</code> \u6761\u4ef6\u4e2d\uff0c\u5e76\u5c06 <code>HAVING</code> \u6761\u4ef6\u5220\u9664\uff0c \u4ece\u800c\u53ef\u4ee5\u5c06 <code>HAVING</code> \u6761\u4ef6\u5728 <code>WHERE</code> \u6761\u4ef6\u4e2d\u7edf\u4e00\u7ba1\u7406\uff0c\u5e76\u505a\u8fdb\u4e00\u6b65\u4f18\u5316</p> <pre><code>SELECT * FROM t1, t2 WHERE t1.c1 = t2.c1 HAVING t1.c2 &gt; 1;\n</code></pre> <pre><code>SELECT * FROM t1, t2 WHERE t1.c1 = t2.c1 AND t1.c2 &gt; 1;\n</code></pre> </li> <li> <p>\u7b49\u4ef7\u5173\u7cfb\u63a8\u5bfc</p> <p>\u901a\u8fc7 <code>a \uff1d b AND a &gt; 1</code> \u53ef\u4ee5\u63a8\u5bfc\u51fa <code>a \uff1d b AND a &gt; 1 AND b &gt; 1</code>\uff0c \u5982\u679c <code>b</code> \u5217\u4e0a\u6709\u7d22\u5f15\uff0c\u4e14 <code>b &gt; 1</code> \u5728\u8be5\u7d22\u5f15\u9009\u62e9\u7387\u5f88\u4f4e\uff0c\u5219\u53ef\u4ee5\u5927\u5927\u63d0\u5347\u8bbf\u95ee <code>b</code> \u5217\u6240\u5728\u8868\u7684\u6027\u80fd</p> </li> <li> <p>\u6052\u771f/\u5047\u6d88\u9664</p> <p>\u5bf9\u4e8e <code>WHERE 0 &gt; 1 AND c1 \uff1d 3</code>\uff0c\u7531\u4e8e <code>0 &gt; 1</code> \u4f7f\u5f97 <code>AND</code> \u6052\u5047\uff0c \u6240\u4ee5\u8be5 SQL \u4e0d\u7528\u6267\u884c\uff0c\u53ef\u76f4\u63a5\u8fd4\u56de\uff0c\u4ece\u800c\u52a0\u5feb\u67e5\u8be2\u7684\u6267\u884c</p> </li> <li> <p>\u5197\u4f59\u6392\u5e8f\u6d88\u9664</p> <p><code>ORDER BY</code> \u5217\u4e2d\u5b58\u5728 <code>WHERE</code> \u4e2d\u6709\u5355\u503c\u6761\u4ef6\u7684\u5217\uff0c\u8be5\u5217\u6392\u5e8f\u53ef\u5220\u9664</p> <pre><code>SELECT * FROM t1 WHERE c2 = 5 ORDER BY c1, c2, c3;\n</code></pre> <pre><code>SELECT * FROM t1 WHERE c2 = 5 ORDER BY c1, c3;\n</code></pre> <p>\u5982\u679c\u672c\u5c42\u67e5\u8be2\u6709 <code>ORDER BY</code> \u4f46\u662f\u6ca1\u6709 <code>LIMIT</code>\uff0c\u4e14\u672c\u5c42\u67e5\u8be2\u4f4d\u4e8e\u7236\u67e5\u8be2\u7684\u96c6\u5408\u64cd\u4f5c\u4e2d\uff0c\u5219 <code>ORDER BY</code> \u53ef\u6d88\u9664\u3002\u56e0\u4e3a\u5bf9\u4e24\u4e2a\u6709\u5e8f\u7684\u96c6\u5408\u505a <code>UNION</code> \u64cd\u4f5c\uff0c\u5176\u7ed3\u679c\u662f\u4e71\u5e8f\u7684\u3002\u4f46\u662f\u5982\u679c <code>ORDER BY</code> \u4e2d\u6709 <code>LIMIT</code>\uff0c\u5219\u8bed\u4e49\u662f\u53d6\u6700\u5927/\u6700\u5c0f\u7684 N \u4e2a\uff0c\u6b64\u65f6\u4e0d\u80fd\u6d88\u9664 <code>ORDER BY</code>\uff0c\u5426\u5219\u6709\u8bed\u4e49\u9519\u8bef</p> <pre><code>(SELECT c1,c2 FROM t1 ORDER BY c1) UNION (SELECT c3,c4 FROM t2 ORDER BY c3)\uff1b\n</code></pre> <pre><code>(SELECT c1,c2 FROM t1) UNION (SELECT c3,c4 FROM t2)\uff1b\n</code></pre> </li> <li> <p>LIMIT \u4e0b\u538b</p> <p><code>LIMIT</code> \u4e0b\u538b\u6539\u5199\u662f\u6307\u5c06 <code>LIMIT</code> \u4e0b\u964d\u5230\u5b50\u67e5\u8be2\u4e2d</p> <pre><code>SELECT * FROM (SELECT * FROM t1 ORDER BY c1) a LIMIT 1;\n</code></pre> <pre><code>SELECT * FROM (SELECT * FROM t1 ORDER BY c1 LIMIT 1) a LIMIT 1;\n</code></pre> </li> <li> <p>DISTINCT \u6d88\u9664</p> <p>\u5982\u679c Select Item \u4e2d\u53ea\u5305\u542b\u5e38\u91cf\uff0c\u5219\u53ef\u4ee5\u6d88\u9664 <code>DISTINCT</code>\uff0c\u5e76\u52a0\u4e0a <code>LIMIT 1</code></p> <p>\u5982\u679c Select Item \u4e2d\u5305\u542b\u786e\u4fdd\u552f\u4e00\u6027\u7ea6\u675f\u7684\u5217\uff0c\u5219 <code>DISTINCT</code> \u80fd\u591f\u88ab\u6d88\u9664</p> </li> <li> <p>MIN/MAX \u6539\u5199</p> <p>\u5f53 <code>MIN</code>/<code>MAX</code> \u51fd\u6570\u4e2d\u7684\u53c2\u6570\u4e3a\u7d22\u5f15\u524d\u7f00\u5217\uff0c\u4e14\u4e0d\u542b <code>GROUP BY</code> \u65f6\uff0c\u53ef\u5c06\u8be5 <code>scalar aggregate</code> \u8f6c\u6362\u4e3a\u8d70\u7d22\u5f15\u626b\u63cf 1 \u884c\u7684\u60c5\u51b5</p> <pre><code>SELECT MIN(c2) FROM t1;\n</code></pre> <pre><code>SELECT MIN(c2) FROM (SELECT c2 FROM t2 ORDER BY c2 LIMIT 1) AS t;\n</code></pre> <p>\u5982\u679c <code>SELECT MIN</code>/<code>SELECT MAX</code> \u7684\u53c2\u6570\u4e3a\u5e38\u91cf\uff0c\u800c\u4e14\u5305\u542b <code>GROUP BY</code>\uff0c\u53ef\u4ee5\u5c06 <code>MIN</code>/<code>MAX</code> \u6539\u4e3a\u5e38\u91cf\uff0c\u4ece\u800c\u51cf\u5c11 <code>MIN</code>/<code>MAX</code> \u7684\u8ba1\u7b97\u5f00\u9500</p> <pre><code>SELECT MAX(1) FROM t1 GROUP BY c1;\n</code></pre> <pre><code>SELECT 1 FROM t1 GROUP BY c1;\n</code></pre> <p>\u5982\u679c <code>SELECT MIN</code>/<code>SELECT MAX</code> \u7684\u53c2\u6570\u4e3a\u5e38\u91cf\uff0c\u800c\u4e14\u4e0d\u542b <code>GROUP BY</code>\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u793a\u4f8b\u8fdb\u884c\u6539\u5199\uff0c\u4ece\u800c\u8d70\u7d22\u5f15\u53ea\u9700\u626b\u63cf 1 \u884c</p> <pre><code>SELECT MAX(1) FROM t1;\n</code></pre> <pre><code>SELECT MAX(t.a) FROM (SELECT 1 AS a FROM t1 LIMIT 1) t;\n</code></pre> </li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#_4","title":"\u57fa\u4e8e\u4ee3\u4ef7\u7684\u67e5\u8be2\u6539\u5199","text":"<ul> <li> <p>OR \u5c55\u5f00</p> <p><code>LNNVL</code>\u7528\u4e8e\u67d0\u4e2a\u8bed\u53e5\u7684 <code>WHERE</code> \u5b50\u53e5\u4e2d\u7684\u6761\u4ef6\uff0c\u5982\u679c\u6761\u4ef6\u4e3a <code>true</code> \u5c31\u8fd4\u56de <code>false</code>\uff1b\u5982\u679c\u6761\u4ef6\u4e3a UNKNOWN \u6216\u8005 <code>false</code> \u5c31\u8fd4\u56de <code>true</code>\u3002\u8be5\u51fd\u6570\u4e0d\u80fd\u7528\u4e8e\u590d\u5408\u6761\u4ef6\u5982 <code>AND</code>\u3001<code>OR</code>\u3001<code>BETWEEN</code>\u4e2d</p> <pre><code>SELECT * FROM t1 WHERE t1.a = 1 OR t1.b = 1;\n</code></pre> <pre><code>SELECT * FROM t1 WHERE t1.a = 1\nUNION ALL\nSELECT * FROM t1.b = 1 AND LNNVL(t1.a = 1);\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <ul> <li>\u5141\u8bb8\u6bcf\u4e2a\u5206\u652f\u4f7f\u7528\u4e0d\u540c\u7684\u7d22\u5f15\u6765\u52a0\u901f\u67e5\u8be2</li> <li>\u5141\u8bb8\u6bcf\u4e2a\u5206\u652f\u4f7f\u7528\u4e0d\u540c\u7684\u8054\u63a5\u7b97\u6cd5\u6765\u52a0\u901f\u67e5\u8be2\uff0c\u907f\u514d\u4f7f\u7528\u7b1b\u5361\u5c14\u8054\u63a5</li> <li>\u5141\u8bb8\u6bcf\u4e2a\u5206\u652f\u5206\u522b\u6d88\u9664\u6392\u5e8f\uff0c\u66f4\u52a0\u5feb\u901f\u7684\u83b7\u53d6 TOP-K \u7ed3\u679c</li> </ul> </li> </ul>"},{"location":"database/oceanbase/OceanBase%20%E7%AC%94%E8%AE%B0/#fqa","title":"FQA","text":"<ul> <li> <p>\u4f7f\u7528 OceanBase \u6570\u636e\u5e93\u5728\u5f00\u53d1\u4e2d\u8981\u7279\u522b\u6ce8\u610f\u4ec0\u4e48</p> <ul> <li>\u8868\u5efa\u597d\u540e\uff0c\u4e3b\u952e\u4e0d\u80fd\u66f4\u6539\u3002\u5982\u679c\u9700\u8981\u4fee\u6539\uff0c\u53ea\u80fd\u5220\u8868\u91cd\u5efa</li> <li>\u5217\u7c7b\u578b\u4fee\u6539\u6709\u8f83\u5927\u9650\u5236\u3002Varchar \u957f\u5ea6\u53ea\u80fd\u7531\u77ed\u53d8\u957f\uff0c\u4e0d\u80fd\u7531\u957f\u53d8\u77ed\u3002</li> <li>\u7d22\u5f15\u751f\u6548\u65f6\u95f4\u8f83\u957f\uff0c\u5efa\u8bae\u5728\u5efa\u8868\u65f6\u5c06\u7d22\u5f15\u8bed\u53e5\u4e00\u5e76\u7eb3\u5165\u3002</li> <li>\u5927\u6570\u636e\u91cf\u5bfc\u5165\u9700\u8981\u7279\u522b\u5173\u6ce8\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\u3002</li> <li>mysql-connector-java \u7684\u7248\u672c\u5efa\u8bae\u4f7f\u7528 5.1.30 \u53ca\u4ee5\u4e0a\u3002</li> <li>\u5982\u679c\u4e00\u4e2a\u8fde\u63a5\u8d85\u8fc7 15 \u5206\u949f\u7a7a\u95f2\uff0c\u670d\u52a1\u7aef\u4f1a\u4e3b\u52a8\u65ad\u5f00\uff0c\u5728\u4f7f\u7528\u8fde\u63a5\u6c60\u7684\u65f6\u5019\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u8fde\u63a5\u6700\u5927\u7684\u7a7a\u95f2\u65f6\u95f4\u3002\u4f8b\u5982\uff0cDruid \u7684 minEvictableIdleTimeMillis \u5c0f\u4e8e 15 \u5206\u949f</li> </ul> </li> </ul>"},{"location":"database/opengauss/","title":"openGauss","text":""},{"location":"database/opengauss/#_1","title":"\u6536\u85cf","text":""},{"location":"database/opengauss/#_2","title":"\u4fee\u6539\u8868\u7a7a\u95f4","text":"<pre><code>-- \u666e\u901a\u8868\nalter table &lt;table_name&gt; set tablespace &lt;table_space&gt;;\n\n-- \u5206\u533a\u8868\nalter table &lt;table_name&gt; move partition &lt;table_partition&gt; tablespace &lt;table_space&gt;;\n\n-- \u7d22\u5f15\nalter index &lt;index_name&gt; set tablespace &lt;table_space&gt;;\n</code></pre>"},{"location":"database/opengauss/#_3","title":"\u517c\u5bb9\u6027","text":"<p>https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/SQLReference/CREATE-DATABASE.html</p> \u517c\u5bb9\u6027 \u517c\u5bb9\u7684\u6570\u636e\u5e93\u7c7b\u578b \u8bf4\u660e <code>A</code> Oracle \u6570\u636e\u5e93\u4f1a\u5c06\u7a7a\u5b57\u7b26\u4e32\u4f5c\u4e3a <code>NULL</code> \u5904\u7406\uff0c\u6570\u636e\u7c7b\u578b <code>DATE</code> \u4f1a\u88ab\u66ff\u6362\u4e3a <code>TIMESTAMP(0) WITHOUT TIME ZONE</code>\u3002 <code>B</code> MySQL \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u6574\u6570\u65f6\uff0c\u5982\u4f55\u8f93\u5165\u4e0d\u5408\u6cd5\uff0c <code>B</code> \u517c\u5bb9\u6027\u4f1a\u5c06\u8f93\u5165\u8f6c\u6362\u4e3a <code>0</code>\uff0c\u800c\u5176\u5b83\u517c\u5bb9\u6027\u5219\u4f1a\u62a5\u9519\u3002 <code>C</code> Teradata <code>PG</code> PostgreSQL <code>PG</code> \u517c\u5bb9\u6027\u4e0b\uff0c<code>CHAR</code> \u548c <code>VARCHAR</code> \u5df2\u5b57\u7b26\u4e3a\u8ba1\u6570\u5355\u4f4d\uff0c\u5176\u5b83\u517c\u5bb9\u6027\u4ee5\u5b57\u8282\u4e3a\u8ba1\u6570\u5355\u4f4d\u3002 <pre><code>create database demo encoding = 'UTF8' dbcompatibility = 'PG';\n</code></pre>"},{"location":"database/opengauss/#_4","title":"\u538b\u7f29","text":"<ul> <li>https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/SQLReference/CREATE-TABLE.html</li> <li>https://docs-opengauss.osinfra.cn/zh/docs/5.0.0/docs/SQLReference/\u5217\u5b58\u8868\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b.html</li> </ul> <pre><code>create table ods.ods_dwd_urs_claim (\n\n)\nwith (\n    orientation=column,\n    compression=yes\n);\n</code></pre>"},{"location":"database/opengauss/#_5","title":"\u8ba4\u8bc1","text":"<p>https://blog.csdn.net/weixin_48456383/article/details/124019202</p> <ul> <li><code>5.x</code> \u7248\u672c\uff1a\u4f7f\u7528 <code>org.postgresql:postgresql:42.7.1</code> \u9a71\u52a8\u4f1a\u62a5\u9519 <code>Invalid or unsupported by client SCRAM mechanisms</code> \uff1b\u4f7f\u7528 <code>org.opengauss:opengauss-jdbc:5.1.0</code> \u6b63\u5e38\u3002</li> <li><code>3.x</code> \u7248\u672c\uff1a\u4f7f\u7528\u4e24\u79cd\u9a71\u52a8\u90fd\u80fd\u6b63\u5e38\u8fde\u63a5\u3002</li> </ul>"},{"location":"database/oracle/","title":"Oracle","text":""},{"location":"database/oracle/#_1","title":"\u6536\u85cf","text":""},{"location":"database/oracle/#oracle-system","title":"Oracle \u521b\u5efa\u4e00\u4e2a\u8868\u5982\u679c\u4e0d\u6307\u5b9a\u8868\u7a7a\u95f4\u662f\u4e0d\u662f\u5c31\u662f\u7528\u9ed8\u8ba4\u7684 <code>system</code> \u8868\u7a7a\u95f4","text":"<p>https://bbs.csdn.net/topics/390217815</p> <p>\u521b\u5efa\u8868\u683c\u65f6\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u6240\u7528\u7684\u8868\u7a7a\u95f4\uff0c\u5b89\u88c5\u4ee5\u4e0b\u987a\u5e8f\u4f7f\u7528\u7528\u6237\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\uff1a</p> <ol> <li> <p>\u521b\u5efa\u7528\u6237\u65f6\u6307\u5b9a\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\u3002</p> <pre><code>create user identified by oracle default tablespace users;\n</code></pre> </li> <li> <p>\u521b\u5efa\u6570\u636e\u5e93\u662f\u6307\u5b9a\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b \u8bed\u53e5\u4fee\u6539\uff1a</p> <pre><code>alter database default tablespace users;\n</code></pre> <p>\u5982\u679c\u521b\u5efa\u7528\u6237\u65f6\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u7684 <code>tablespace</code>\uff0c\u5219\u6b64\u7528\u6237\u5219\u4f1a\u4ee5\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\u4f5c\u4e3a\u9ed8\u8ba4\u8868\u7a7a\u95f4\u3002</p> <pre><code>-- \u67e5\u770b\u7528\u6237\u7684\u9ed8\u8ba4\u8868\u7a7a\u95f4\nselect username, default_tablespace from dba_users;\n</code></pre> </li> <li> <p>\u5982\u679c 1) \u548c 2) \u90fd\u6ca1\u6709\u8bbe\u7f6e\uff0c\u624d\u4f1a\u4f7f\u7528 <code>system</code> \u8868\u7a7a\u95f4\u3002</p> </li> </ol>"},{"location":"database/oracle/#oracle-sql","title":"Oracle \u67e5\u8be2\u5386\u53f2 SQL \u8bb0\u5f55","text":"<pre><code>select * from v$sqlarea where sql_text like '%select * from user%'\n</code></pre>"},{"location":"database/oracle/#oracle-5-6-30","title":"Oracle \u6839\u636e\u5f53\u524d\u65f6\u95f4\u83b7\u53d6\u6700\u8fd1 5 \u5e74\uff0c\u6700\u8fd1 6 \u4e2a\u6708\uff0c\u6700\u8fd1 30 \u5929\u7684\u65f6\u95f4","text":""},{"location":"database/oracle/#_2","title":"\u67e5\u770b\u6240\u6709\u8868","text":"<pre><code>select * from all_tables where table_name like '%%'\n</code></pre>"},{"location":"database/oracle/#_3","title":"\u67e5\u8be2\u8868\u7ed3\u6784\u4fe1\u606f","text":"<pre><code>select\n    tc.owner      as \"schema_name\",\n    tc.table_name as \"table_name\",\n    (case\n        when tc.table_type = 'TABLE' then 't'\n        when tc.table_type = 'VIEW'  then 'v'\n        else tc.table_type\n    end)                                                                         as \"table_type\",\n    tc.comments                                                                  as \"table_comment\",\n    c.column_name                                                                as \"column_name\",\n    row_number() over(partition by tc.owner, tc.table_name order by c.column_id) as \"column_order\",\n    (case\n        when c.data_type in ('CHAR', 'VARCHAR2', 'NCHAR', 'NVARCHAR2')                            then c.data_type || '(' || to_char(c.char_length) || ')'\n        when c.data_type = 'NUMBER' and c.data_precision is not null and c.data_scale is not null then c.data_type || '(' || to_char(c.data_precision) || ',' || to_char(c.data_scale) || ')'\n        when c.data_type = 'NUMBER' and c.data_precision is not null                              then c.data_type || '(' || to_char(c.data_precision) || ')'\n        else c.data_type\n        end)                                                     as \"column_type\",\n    (case when c.nullable = 'Y' then 1 else 0 end)               as \"column_nullable\",\n    c.data_default                                               as \"column_default\",\n    (case when pk_col.column_name is not null then 1 else 0 end) as \"column_primary_key\",\n    cc.comments                                                  as \"column_comment\"\nfrom all_tab_comments tc\njoin all_tab_columns  c  on c.owner  = tc.owner and c.table_name  = tc.table_name\njoin all_col_comments cc on cc.owner = c.owner  and cc.table_name = c.table_name and cc.column_name = c.column_name\nleft join (\n    select acc.owner, acc.table_name, acc.column_name\n    from all_cons_columns acc\n    join all_constraints ac on ac.owner = acc.owner and ac.constraint_name = acc.constraint_name\n    where ac.constraint_type = 'P'\n) pk_col on pk_col.owner = tc.owner and pk_col.table_name = tc.table_name and pk_col.column_name = c.column_name\nwhere 1 = 1\nand tc.owner not in ('SYS', 'SYSTEM')\nand tc.table_type in ('TABLE', 'VIEW')\nand c.data_type not in ('ROWID', 'UROWID')\norder by tc.owner, tc.table_name, c.column_id\n</code></pre>"},{"location":"database/oracle/#oracle-ebs","title":"Oracle EBS \u521d\u59cb\u5316\u7528\u6237\u5bc6\u7801","text":""},{"location":"database/oracle/#_4","title":"\u67e5\u770b\u89c6\u56fe\u5b9a\u4e49","text":"<pre><code>select dbms_metadata.get_ddl('VIEW', '&lt;VIEW_NAME&gt;') from dual\n</code></pre> <pre><code>select * from all_views where owner not in ('SYS', 'SYSTEM')\n</code></pre>"},{"location":"database/oracle/#_5","title":"\u67e5\u770b\u6240\u6709\u5bf9\u8c61","text":"<pre><code>select\n    owner                                     as \"\u5bf9\u8c61\u5f52\u5c5e\",\n    object_type                               as \"\u5bf9\u8c61\u7c7b\u578b\",\n    object_name                               as \"\u5bf9\u8c61\u540d\u79f0\",\n    object_id                                 as \"\u5bf9\u8c61\u6807\u8bc6\",\n    status                                    as \"\u5bf9\u8c61\u72b6\u6001\",\n    to_char(created, 'yyyy-mm-dd hh24:mi:ss') as \"\u5bf9\u8c61\u521b\u5efa\u65f6\u95f4\"\nfrom sys.all_objects\nwhere owner not in ('sys', 'system')\norder by owner, object_type, object_name\n</code></pre>"},{"location":"database/oracle/#_6","title":"\u67e5\u770b\u4f1a\u8bdd\u4fe1\u606f","text":"<pre><code>select\n    s.sid,\n    s.serial#,\n    s.username,\n    t.sql_text,\n    (case\n        when last_call_et &gt;= 86400 then floor(last_call_et / 86400) || ' days ' || floor(mod(last_call_et, 86400) / 3600) || ' hours ' || floor(mod(mod(last_call_et, 86400), 3600) / 60) || ' minutes ' || mod(mod(last_call_et, 86400), 60) || ' seconds'\n        when last_call_et &gt;= 3600  then floor(last_call_et / 3600) || ' hours ' || floor(mod(last_call_et, 3600) / 60) || ' minutes ' || mod(last_call_et, 60) || ' seconds'\n        else floor(last_call_et / 60) || ' minutes ' || mod(last_call_et, 60) || ' seconds'\n    end) as \"elapsed time\"\nfrom v$session s\njoin v$sqltext t on s.sql_id = t.sql_id\nwhere 1 = 1\n    and s.last_call_et &gt; 1 * 60 * 60\n    and t.sql_text like 'insert %'\n</code></pre>"},{"location":"database/postgresql/","title":"PostgreSQL","text":""},{"location":"database/postgresql/#_1","title":"\u6536\u85cf","text":""},{"location":"database/postgresql/#postgresql_1","title":"PostgreSQL \u535a\u6587\u3001\u8d44\u6599\u3001\u5b66\u4e60\u7b14\u8bb0\u3001\u7cfb\u5217\u6559\u7a0b\u6c47\u603b","text":""},{"location":"database/postgresql/#postgresql-with","title":"PostgreSQL-with \u5b50\u53e5\u5b9e\u73b0\u9012\u5f52","text":""},{"location":"database/postgresql/#pg","title":"PG \u590d\u5236\u8868\u7ed3\u6784","text":"<pre><code>create table src ( like dst including all );\n</code></pre>"},{"location":"database/postgresql/#pg_1","title":"PG \u8fdb\u7a0b\u7ba1\u7406","text":"<pre><code>-- \u67e5\u770b\u6570\u636e\u5e93\u5f53\u524d\u7684\u8fdb\u7a0b \u770b\u4e00\u4e0b\u6709\u65e0\u6b63\u5728\u6267\u884c\u7684\u6162 SQL \u8bb0\u5f55\u7ebf\u7a0b\nselect\n    procpid,\n    start,\n    now() - start as lap,\n    current_query\nfrom (\n    select\n        backendid,\n        pg_stat_get_backend_pid(s.backendid) as procpid,\n        pg_stat_get_backend_activity_start(s.backendid) as start,\n        pg_stat_get_backend_activity(s.backendid) as current_query\n    from (\n        select pg_stat_get_backend_idset() as backendid\n    ) as s\n) as s\nwhere current_query !~* '(&lt;idle&gt;|&lt;insufficient privilege&gt;|SET application_name|SET search_path|SET SESSION search_path|SHOW search_path)'\norder by lap desc;\n\n-- \u6740\u4e8b\u52a1\nselect pg_cancel_backend(pid);\nselect pg_terminate_backend(pid);\n\n--\u67e5\u8be2\u5177\u4f53\u8868\u7684\u6267\u884c\u60c5\u51b5\nselect * from pg_stat_activity where query ~ '\u8868\u540d';\n</code></pre>"},{"location":"database/postgresql/#pg_2","title":"PG \u4fee\u6539\u5e8f\u5217\u8d77\u59cb\u503c","text":"<p>\u9488\u5bf9\u4e0d\u652f\u6301 <code>ALTER SEQUENCE</code> \u64cd\u4f5c\u7684\u573a\u666f\u3002</p> <pre><code>-- \u521b\u5efa\u4e34\u65f6\u5e8f\u5217\nCREATE SEQUENCE pms.temp_id_seq INCREMENT BY 1 START 1;\n-- \u7ed1\u5b9a\u4e34\u65f6\u5e8f\u5217\nALTER TABLE pms.pms_product ALTER COLUMN id SET DEFAULT nextval('pms.temp_id_seq');\n-- \u91cd\u5efa\u539f\u6709\u5e8f\u5217\nDROP SEQUENCE pms.pms_product_id_seq;\nCREATE SEQUENCE pms.pms_product_id_seq INCREMENT BY 1 START 1000000;\n-- \u7ed1\u5b9a\u539f\u6709\u5e8f\u5217\nALTER TABLE pms.pms_product ALTER COLUMN id SET DEFAULT nextval('pms.pms_product_id_seq');\n</code></pre>"},{"location":"database/postgresql/#pg_3","title":"PG \u6570\u7ec4\u622a\u53d6","text":"<p>\u63d0\u53d6\u8868\u540d\u4e2d\u7684\u4fe1\u606f\u3002</p> <pre><code>select segments[2] as province_code, segments[3] as topic_code, array_to_string(segments[4:(array_length(segments, 1))], '_')\nfrom (\n    select string_to_array(table_name, '_') as segments\n    from (\n        select 'stg_bi_topic1_t_a_b_l_e_1' as table_name union all\n        select 'stg_tj_topic2_t_a_b_l_e_2' as table_name union all\n        select 'stg_sh_topic3_t_a_b_l_e_3' as table_name union all\n        select 'stg_cq_topic4_t_a_b_l_e_4' as table_name\n    ) t1\n) t2\n</code></pre> province_code topic_code table_name bi topic1 t_a_b_l_e_1 tj topic2 t_a_b_l_e_2 sh topic3 t_a_b_l_e_3 cq topic4 t_a_b_l_e_4"},{"location":"database/postgresql/#pg_4","title":"PG \u67e5\u770b\u8868\u7ed3\u6784\u4fe1\u606f","text":"<p>PostgreSQL \u4e2d\u7cfb\u7edf\u8868</p> <pre><code>select table_schema, table_name, table_type, table_comment, column_name, column_type, column_order, column_comment, column_nullable, column_default\nfrom (\n    select\n        pg_namespace.nspname          as table_schema,\n        pg_class.relname              as table_name,\n        (case pg_class.relkind when 'r' then 't' when 'v' then 'v' end) as table_type,\n        obj_description(pg_class.oid) as table_comment,\n        pg_attribute.attname          as column_name,\n        concat_ws('', pg_type.typname, substring(format_type(pg_attribute.atttypid, pg_attribute.atttypmod) from '\\(.*\\)')) as column_type,\n        pg_attribute.attnum           as column_order,\n        pg_description.description    as column_comment,\n        not pg_attribute.attnotnull   as column_nullable,\n        pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) as column_default\n    from      pg_catalog.pg_namespace\n    left join pg_catalog.pg_class       on pg_class.relnamespace = pg_namespace.oid\n    left join pg_catalog.pg_attribute   on pg_attribute.attrelid = pg_class.oid\n    left join pg_catalog.pg_attrdef     on pg_attrdef.adrelid    = pg_attribute.attrelid and pg_attrdef.adnum = pg_attribute.attnum\n    left join pg_catalog.pg_type        on pg_type.oid           = pg_attribute.atttypid\n    left join pg_catalog.pg_description on pg_description.objoid = pg_attribute.attrelid and pg_description.objsubid = pg_attribute.attnum\n    where pg_namespace.nspname not in ('information_schema', 'pg_catalog', 'pg_toast') and pg_class.relkind in ('r', 'v') and pg_attribute.attnum &gt; 0 and pg_attribute.attisdropped = false\n    order by table_schema, table_name, column_order\n) t\n</code></pre>"},{"location":"database/postgresql/#pg_5","title":"PG \u67e5\u770b\u7d22\u5f15\u4fe1\u606f","text":"<pre><code>select table_schema, table_name, index_name, index_def\nfrom (\n    select schemaname as table_schema, tablename as table_name, indexname as index_name, indexdef as index_def\n    from pg_indexes\n    where schemaname not in ('information_schema', 'pg_catalog', 'pg_toast')\n    order by table_schema, table_name, index_name\n) t\n</code></pre>"},{"location":"database/postgresql/#pg_6","title":"PG \u67e5\u770b\u5206\u533a\u4fe1\u606f","text":"<pre><code>select table_schema\uff0c table_name, partition_name\nfrom (\n    select\n        n.nspname as table_schema,\n        c.relname as table_name,\n        p.relname as partition_name\n    from pg_namespace n\n    join pg_class c on c.relnamespace = n.oid\n    join (select * from pg_partition where pg_partition.parttype = 'r') r on r.parentid = c.oid\n    join (select * from pg_partition where pg_partition.parttype = 'p') p on p.parentid = r.parentid\n    where n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n    order by table_schema, table_name, partition_name\n) t\n</code></pre>"},{"location":"database/postgresql/#_2","title":"\u67e5\u770b\u8868\u7a7a\u95f4\u4fe1\u606f","text":"<pre><code>select spcname as tablespace_name, pg_size_pretty(pg_tablespace_size(spcname)) as tablespace_size\nfrom pg_tablespace\n</code></pre>"},{"location":"database/postgresql/#pg-id-in","title":"PG \u62ff\u5230\u6240\u6709 ID \u653e\u5728 IN \u4e2d","text":"<p><code>''</code> \u8868\u793a\u8f6c\u4e49\u4e00\u4e2a\u5355\u5f15\u53f7</p> <pre><code>select array_to_string(array_agg('''' || id ||''''), ', ') from a;\n</code></pre>"},{"location":"database/postgresql/#pg-with","title":"PG <code>WITH</code> \u9012\u5f52","text":"<pre><code>-- \u5411\u4e0b\u9012\u5f52\nwith recursive tree AS (\n    select m.id, m.parent_id, m.code, m.name from menu m where m.id = #{id}\n    union all\n    select m.id, m.parent_id, m.code, m.name from menu m join tree on m.parent_id = tree.id\n)\nselect * from tree;\n-- \u5411\u4e0a\u9012\u5f52\nwith recursive tree AS (\n    select m.id, m.parent_id, m.code, m.name from menu m where m.id = #{id}\n    union all\n    select m.id, m.parent_id, m.code, m.name from menu m join tree on m.id = tree.parent_id\n)\nselect * from tree;\n</code></pre>"},{"location":"database/postgresql/CHAR%20%E5%92%8C%20VARCHAR%20%E5%92%8C%20TEXT%20%E7%B1%BB%E5%9E%8B/","title":"CHAR \u548c VARCHAR \u548c TEXT \u7c7b\u578b","text":""},{"location":"database/postgresql/CHAR%20%E5%92%8C%20VARCHAR%20%E5%92%8C%20TEXT%20%E7%B1%BB%E5%9E%8B/#postgresql","title":"PostgreSQL \u5b57\u7b26\u4e32\u7c7b\u578b\u7b80\u4ecb","text":"<p>PostgreSQL \u63d0\u4f9b\u4e86\u4e09\u79cd\u5b57\u7b26\u7c7b\u578b\uff1a<code>CHAR(n)</code>\u3001<code>VARCHAR(n)</code> \u548c <code>TEXT</code>\uff0c\u5176\u4e2d <code>n</code> \u662f\u6b63\u6574\u6570\u3002</p> \u7c7b\u578b \u63cf\u8ff0 <code>CHAR(n)</code> \u5b9a\u957f\uff0c\u7a7a\u767d\u586b\u5145 <code>VARCHAR(n)</code> \u53d8\u957f\uff0c\u6709\u957f\u5ea6\u9650\u5236 <code>TEXT</code> \u53d8\u957f\uff0c\u65e0\u957f\u5ea6\u9650\u5236 <p>\u7b80\u5355\u6765\u8bf4\uff0c<code>varchar</code> \u7684\u957f\u5ea6\u53ef\u53d8\uff0c\u800c <code>char</code> \u7684\u957f\u5ea6\u4e0d\u53ef\u53d8\uff0c\u5bf9\u4e8e postgresql \u6570\u636e\u5e93\u6765\u8bf4 <code>varchar</code> \u548c <code>char</code> \u7684\u533a\u522b\u4ec5\u4ec5\u5728\u4e8e\u524d\u8005\u662f\u53d8\u957f\uff0c\u800c\u540e\u8005\u662f\u5b9a\u957f\uff0c\u6700\u5927\u957f\u5ea6\u90fd\u662f 10485760\uff081GB\uff09\u3002</p> <p><code>varchar</code> \u4e0d\u6307\u5b9a\u957f\u5ea6\uff0c\u53ef\u4ee5\u5b58\u50a8\u6700\u5927\u957f\u5ea6\uff081GB\uff09\u7684\u5b57\u7b26\u4e32\uff0c\u800c <code>char</code> \u4e0d\u6307\u5b9a\u957f\u5ea6\uff0c\u9ed8\u8ba4\u5219\u4e3a 1\uff0c\u8fd9\u70b9\u9700\u8981\u6ce8\u610f\u3002</p> <p>\u5728 postgresql \u6570\u636e\u5e93\u91cc\u8fb9\uff0c<code>text</code> \u548c <code>varchar</code> \u51e0\u4e4e\u65e0\u6027\u80fd\u5dee\u522b\uff0c\u533a\u522b\u4ec5\u5728\u4e8e\u5b58\u50a8\u7ed3\u6784\u7684\u4e0d\u540c\u3002</p> <p>\u5bf9\u4e8e <code>char</code> \u7684\u4f7f\u7528\uff0c\u5e94\u8be5\u5728\u786e\u5b9a\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\uff0c\u5426\u5219\u5e94\u8be5\u9009\u62e9 <code>varchar</code> \u6216\u8005 <code>text</code>\u3002</p>"},{"location":"database/postgresql/CHAR%20%E5%92%8C%20VARCHAR%20%E5%92%8C%20TEXT%20%E7%B1%BB%E5%9E%8B/#_1","title":"\u6536\u85cf","text":"<p>postgresql \u6570\u636e\u5e93 varchar\u3001char\u3001text \u7684\u6bd4\u8f83</p> <p>\u8fd9\u4e09\u79cd\u7c7b\u578b\u4e4b\u95f4\u6ca1\u6709\u6027\u80fd\u5dee\u522b\uff0c\u9664\u4e86\u5f53\u4f7f\u7528\u586b\u5145\u7a7a\u767d\u7c7b\u578b\u65f6\u7684\u589e\u52a0\u5b58\u50a8\u7a7a\u95f4\uff0c\u548c\u5f53\u5b58\u50a8\u957f\u5ea6\u7ea6\u675f\u7684\u5217\u65f6\u4e00\u4e9b\u68c0\u67e5\u5b58\u5165\u65f6\u957f\u5ea6\u7684\u989d\u5916\u7684 CPU \u5468\u671f\u3002\u867d\u7136\u5728\u67d0\u4e9b\u5176\u5b83\u7684\u6570\u636e\u5e93\u7cfb\u7edf\u91cc\uff0c<code>character(n)</code> \u6709\u4e00\u5b9a\u7684\u6027\u80fd\u4f18\u52bf\uff0c\u4f46\u5728 PostgreSQL \u91cc\u6ca1\u6709\u3002\u4e8b\u5b9e\u4e0a\uff0c<code>character(n)</code> \u901a\u5e38\u662f\u8fd9\u4e09\u4e2a\u4e2d\u6700\u6162\u7684\uff0c\u56e0\u4e3a\u989d\u5916\u5b58\u50a8\u6210\u672c\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u4f7f\u7528 <code>text</code> \u6216 <code>character varying</code>\u3002</p>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/","title":"PawSQL \u91cd\u5199\u89c4\u5219","text":""},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#all","title":"<code>ALL</code> \u4fee\u9970\u7b26\u7684\u5b50\u67e5\u8be2\u91cd\u5199\u4f18\u5316","text":"<pre><code>select * from customer where c_regdate &gt; all(select o_orderdate from orders)\n</code></pre> <p>\u5982\u679c\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u4e2d\u5b58\u5728 <code>NULL</code>\uff0c\u8fd9\u4e2a SQL \u6c38\u8fdc\u8fd4\u56de\u4e3a\u7a7a\u3002\u6b63\u786e\u7684\u5199\u6cd5\u5e94\u8be5\u662f\u5728\u5b50\u67e5\u8be2\u91cc\u52a0\u4e0a\u975e\u7a7a\u9650\u5236\uff0c\u6216\u4f7f\u7528 <code>MAX/MIN</code> \u7684\u5199\u6cd5\u3002</p> <pre><code>select * from customer where c_regdate &gt; (select max(o_custkey) from orders)\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#count","title":"<code>COUNT</code> \u6807\u91cf\u5b50\u67e5\u8be2\u91cd\u5199\u4f18\u5316","text":"<pre><code>select * from customer where (select count(*) from orders where c_custkey=o_custkey) &gt; 0\n</code></pre> <p>\u907f\u514d\u4e86\u4e00\u6b21\u805a\u96c6\u8fd0\u7b97\u3002</p> <pre><code>select * from customer where exists(select 1 from orders where c_custkey=o_custkey)\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#having-where","title":"<code>HAVING</code> \u6761\u4ef6\u4e0b\u63a8\u5230 <code>WHERE</code>","text":"<pre><code>select c_custkey, count(*) from customer group by c_custkey having c_custkey &lt; 100\n</code></pre> <pre><code>select c_custkey, count(*) from customer where c_custkey &lt; 100 group by c_custkey\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#in","title":"<code>IN</code> \u5b50\u67e5\u8be2\u91cd\u5199\u4f18\u5316","text":"<ul> <li> <p>\u5b50\u67e5\u8be2\u91cd\u5199\u4e3a <code>EXISTS</code></p> <pre><code>-- \u83b7\u53d6\u6700\u8fd1\u4e00\u5e74\u6709\u8ba2\u5355\u7684\u7528\u6237\u4fe1\u606f\nselect * from customer where c_custkey in (select o_custkey from orders where o_orderdate &gt;= current_date - interval 1 year)\n</code></pre> <pre><code>-- \u83b7\u53d6\u6700\u8fd1\u4e00\u5e74\u6709\u8ba2\u5355\u7684\u7528\u6237\u4fe1\u606f\nselect * from customer where exists (select * from orders where c_custkey = o_custkey and o_orderdate &gt;= current_date - interval 1 year)\n</code></pre> </li> <li> <p>\u5b50\u67e5\u8be2\u91cd\u5199\u4e3a\u5185\u5173\u8054</p> <pre><code>select * from orders where o_custkey in (select c_custkey from customer where c_phone like '139%')\n</code></pre> <pre><code>select orders.* from orders, customer where o_custkey = c_custkey and c_phone like '139%'\n</code></pre> </li> </ul>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#maxmin","title":"<code>MAX</code>/<code>MIN</code> \u5b50\u67e5\u8be2\u91cd\u5199\u4f18\u5316","text":"<pre><code>select * from customer where c_custkey = (select max(o_custkey) from orders)\n</code></pre> <pre><code>select * from customer where c_custkey = (select o_custkey from orders order by o_custkey desc null last limit 1)\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#in_1","title":"IN \u53ef\u7a7a\u5b50\u67e5\u8be2\u91cd\u5199","text":"<pre><code>-- \u67e5\u8be2\u6ca1\u6709\u8ba2\u5355\u7684\u7528\u6237\nselect * from customer where c_custkey not in (select o_custkey from orders)\n</code></pre> <p>\u5982\u679c\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u91cc\u6709\u7a7a\u503c\uff0c\u8fd9\u4e2a SQL \u6c38\u8fdc\u8fd4\u56de\u4e3a\u7a7a\u3002\u6b63\u786e\u7684\u5199\u6cd5\u5e94\u8be5\u662f\u5728\u5b50\u67e5\u8be2\u91cc\u52a0\u4e0a\u975e\u7a7a\u9650\u5236\u3002</p> <pre><code>-- \u67e5\u8be2\u6ca1\u6709\u8ba2\u5355\u7684\u7528\u6237\nselect * from customer where c_custkey not in (select o_custkey from orders where o_custkey is not null)\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#_1","title":"\u5916\u8fde\u63a5\u8f6c\u5316\u4e3a\u5185\u8fde\u63a5","text":"<pre><code>select c_custkey from orders left join customer on c_custkey = o_custkey where c_nationkey &lt; 20\n</code></pre> <p><code>c_nationkey &lt; 20</code> \u662f\u4e00\u4e2a <code>customer</code> \u8868\u4e0a\u7684 <code>null</code>\u62d2\u7edd\u6761\u4ef6\uff0c\u6240\u4ee5\u5de6\u5916\u8fde\u63a5\u53ef\u4ee5\u91cd\u5199\u4e3a\u5185\u8fde\u63a5</p> <pre><code>select c_custkey from orders join customer on c_custkey = o_custkey where c_nationkey &lt; 20\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#_2","title":"\u6295\u5f71\u4e0b\u63a8","text":"<p>\u6295\u5f71\u4e0b\u63a8\u6307\u7684\u901a\u8fc7\u5220\u9664 DT \u5b50\u67e5\u8be2\u4e2d\u65e0\u610f\u4e49\u7684\u5217\uff08\u5728\u5916\u67e5\u8be2\u4e2d\u6ca1\u6709\u4f7f\u7528\uff09\uff0c\u51cf\u5c11 IO \u548c\u7f51\u7edc\u7684\u4ee3\u4ef7\uff0c\u540c\u4e8b\u63d0\u5347\u4f18\u5316\u5668\u5728\u8fdb\u884c\u8868\u8bbf\u95ee\u7684\u89c4\u5212\u65f6\uff0c\u91c7\u7528\u65e0\u9700\u56de\u8868\u7684\u4f18\u5316\u9009\u9879\u7684\u51e0\u7387\u3002</p> <pre><code>select count(1) from (select c_custkey, avg(age) from customer group by c_custkey) as derived_t1;\n</code></pre> <pre><code>select count(1) from (select 1 from customer group by c_custkey) as derived_t1;\n</code></pre>"},{"location":"database/postgresql/PawSQL%20%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#_3","title":"\u67e5\u8be2\u6298\u53e0","text":"<pre><code>select * from (select c_custkey, c_name from customer) as derived_t1;\n</code></pre> <pre><code>select c_custkey, c_name from customer\n</code></pre>"},{"location":"database/redis/","title":"Redis","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/","title":"Redis \u54e8\u5175\u6a21\u5f0f\u6a21\u5f0f\u4e0e\u96c6\u7fa4\u6a21\u5f0f\u642d\u5efa","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_1","title":"\u4e3b\u4ece\u590d\u5236","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_2","title":"\u4e3b\u4ece\u590d\u5236\u4f5c\u7528","text":"<p>\u901a\u8fc7\u6301\u4e45\u5316\u529f\u80fd\uff0cRedis \u4fdd\u8bc1\u4e86\u5373\u4f7f\u5728\u670d\u52a1\u5668\u91cd\u542f\u7684\u65f6\u5019\u4e5f\u4e0d\u4f1a\u4e22\u5931\uff08\u6216\u5c11\u91cf\u4e22\u5931\uff09\u6570\u636e\uff0c\u56e0\u4e3a\u6301\u4e45\u5316\u4f1a\u628a\u5185\u5b58\u4e2d\u6570\u636e\u4fdd\u5b58\u5230\u786c\u76d8\u4e0a\uff0c\u91cd\u542f\u4f1a\u4ece\u786c\u76d8\u4e0a\u52a0\u8f7d\u6570\u636e\u3002\u4f46\u662f\u7531\u4e8e\u6570\u636e\u662f\u5b58\u50a8\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u5982\u679c\u8fd9\u53f0\u670d\u52a1\u5668\u51fa\u73b0\u786c\u76d8\u6545\u969c\u7b49\u95ee\u9898\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5355\u70b9\u6545\u969c\uff0c\u901a\u5e38\u7684\u505a\u6cd5\u662f\u5c06\u6570\u636e\u590d\u5236\u591a\u4e2a\u526f\u672c\u4ee5\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8fd9\u6837\u5373\u4f7f\u6709\u4e00\u53f0\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>\u4e3a\u6b64\uff0cRedis \u63d0\u4f9b\u4e86\u590d\u5236\uff08Replication\uff09\u529f\u80fd\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5f53\u4e00\u53f0\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u66f4\u65b0\u540e\uff0c\u81ea\u52a8\u5c06\u66f4\u65b0\u7684\u6570\u636e\u540c\u6b65\u5230\u5176\u4ed6\u6570\u636e\u5e93\u4e0a\u3002</p> <p>\u5728\u590d\u5236\u7684\u6982\u5ff5\u4e2d\uff0c\u6570\u636e\u5e93\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u4e3b\u6570\u636e\u5e93\uff08Master\uff09\uff0c\u53e6\u4e00\u7c7b\u662f\u4ece\u6570\u636e\u5e93\uff08Slave\uff09\u3002\u4e3b\u6570\u636e\u5e93\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u5f53\u5199\u64cd\u4f5c\u5bfc\u81f4\u6570\u636e\u53d8\u5316\u65f6\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u6570\u636e\u5e93\u3002\u800c\u4ece\u6570\u636e\u5e93\u4e00\u822c\u662f\u53ea\u8bfb\u7684\uff0c\u5e76\u63a5\u6536\u4e3b\u6570\u636e\u5e93\u540c\u6b65\u8fc7\u6765\u7684\u6570\u636e\u3002\u4e00\u4e2a\u4e3b\u6570\u636e\u5e93\u53ef\u4ee5\u62e5\u6709\u54e6\u591a\u4e2a\u4ece\u6570\u636e\u5e93\uff0c\u800c\u4e00\u4e2a\u4ece\u6570\u636e\u5e93\u53ea\u80fd\u62e5\u6709\u4e00\u4e2a\u4e3b\u6570\u636e\u5e93\u3002</p> <p>\u603b\u7ed3\uff1a\u5f15\u5165\u4e3b\u4ece\u590d\u5236\u7684\u76ee\u7684\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662f\u8bfb\u5199\u5206\u79bb\uff0c\u5206\u62c5 Master \u7684\u8bfb\u5199\u538b\u529b\uff0c\u53e6\u4e00\u4e2a\u6570\u65b9\u4fbf\u505a\u5bb9\u707e\u6062\u590d\u3002</p>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_3","title":"\u4e3b\u4ece\u590d\u5236\u539f\u7406","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_4","title":"\u4e3b\u4ece\u590d\u5236\u4f18\u70b9","text":"<ul> <li>\u652f\u6301\u4e3b\u4ece\u590d\u5236\uff0c\u4e3b\u673a\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u540c\u6b65\u5230\u4ece\u673a\uff0c\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u5206\u79bb\uff1b</li> <li>\u4e3a\u4e86\u5206\u8f7d Master \u7684\u8bfb\u64cd\u4f5c\u538b\u529b\uff0cSlave \u670d\u52a1\u5668\u53ef\u4ee5\u4e3a\u5ba2\u6237\u7aef\u63d0\u4f9b\u53ea\u8bfb\u64cd\u4f5c\u7684\u670d\u52a1\uff0c\u5199\u670d\u52a1\u4ecd\u7136\u5fc5\u987b\u7531 Master \u6765\u5b8c\u6210;</li> <li>Slave \u540c\u6837\u53ef\u4ee5\u63a5\u6536\u5176\u5b83 Slave \u7684\u8fde\u63a5\u548c\u540c\u6b65\u8bf7\u6c42\uff0c\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u7684\u5206\u8f7d Master \u7684\u540c\u6b65\u538b\u529b\uff1b</li> <li>Master \u662f\u4ee5\u975e\u963b\u585e\u7684\u65b9\u5f0f\u4e3a Slave \u63d0\u4f9b\u670d\u52a1\u3002\u6240\u4ee5\u5728 Master-Slave \u540c\u6b65\u671f\u95f4\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u63d0\u4ea4\u67e5\u8be2\u6216\u4fee\u6539\u8bf7\u6c42\uff1b</li> <li>Slave \u540c\u6837\u662f\u4ee5\u975e\u963b\u585e\u7684\u65b9\u5f0f\u5b8c\u6210\u6570\u636e\u540c\u6b65\u3002\u5728\u540c\u6b65\u671f\u95f4\uff0c\u5982\u679c\u6709\u5ba2\u6237\u7aef\u63d0\u4ea4\u67e5\u8be2\u8bf7\u6c42\uff0cRedis \u5219\u8fd4\u56de\u4e4b\u524d\u7684\u6570\u636e\uff1b</li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_5","title":"\u4e3b\u4ece\u590d\u5236\u7f3a\u70b9","text":"<ul> <li>Redis \u4e0d\u5177\u5907\u81ea\u52a8\u5bb9\u9519\u548c\u6062\u590d\u529f\u80fd\uff0c\u4e3b\u673a\u4ece\u673a\u7684\u5b95\u673a\u90fd\u4f1a\u5bfc\u81f4\u90e8\u5206\u8bfb\u5199\u8bf7\u6c42\u5931\u8d25\uff0c\u9700\u8981\u7b49\u5f85\u673a\u5668\u91cd\u542f\u6216\u8005\u624b\u52a8\u5207 IP \u624d\u80fd\u6062\u590d\uff08\u4e5f\u5c31\u662f\u8981\u4eba\u5de5\u4ecb\u5165\uff09\uff1b</li> <li>\u4e3b\u673a\u5b95\u673a\uff0c\u5b95\u673a\u524d\u6709\u90e8\u5206\u6570\u636e\u672a\u80fd\u53ca\u65f6\u540c\u6b65\u5230\u4ece\u673a\uff0c\u5207\u6362 IP \u540e\u8fd8\u4f1a\u5f15\u5165\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684\u53ef\u7528\u6027\uff1b</li> <li>\u5982\u679c\u591a\u4e2a Slave \u65ad\u7ebf\u4e86\uff0c\u9700\u8981\u91cd\u542f\u7684\u65f6\u5019\uff0c\u5c3d\u91cf\u4e0d\u8981\u518d\u540c\u4e00\u65f6\u95f4\u6bb5\u8fdb\u884c\u91cd\u542f\u3002\u56e0\u4e3a\u53ea\u8981 Slave \u542f\u52a8\uff0c\u5c31\u4f1a\u53d1\u9001 sync \u8bf7\u6c42\u548c\u4e3b\u673a\u5168\u91cf\u540c\u6b65\uff0c\u5f53\u591a\u4e2a Slave \u91cd\u542f\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4 Master IO \u5267\u589e\u4ece\u800c\u5b95\u673a\uff1b</li> <li>Redis \u8f83\u96be\u652f\u6301\u5728\u7ebf\u6269\u5bb9\uff0c\u5728\u96c6\u7fa4\u5bb9\u91cf\u8fbe\u5230\u4e0a\u9650\u65f6\u5728\u7ebf\u6269\u5bb9\u4f1a\u53d8\u5f97\u5f88\u590d\u6742\uff1b</li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_6","title":"\u54e8\u5175\u6a21\u5f0f","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_7","title":"\u54e8\u5175\u6a21\u5f0f\u4f5c\u7528","text":"<ul> <li>\u901a\u8fc7\u53d1\u9001\u547d\u4ee4\uff0c\u8ba9 Redis \u670d\u52a1\u5668\u8fd4\u56de\u76d1\u63a7\u5176\u8fd0\u884c\u72b6\u6001\uff0c\u5305\u62ec\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\uff1b</li> <li>\u5f53\u54e8\u5175\u76d1\u6d4b\u5230 Master \u5b95\u673a\uff0c\u4f1a\u81ea\u52a8\u5c06 Slave \u5207\u6362\u6210 Master\uff0c\u7136\u540e\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u901a\u77e5\u5176\u5b83\u7684\u4ece\u670d\u52a1\u5668\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u8ba9\u5b83\u4eec\u5207\u6362\u4e3b\u673a\uff1b</li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_8","title":"\u54e8\u5175\u6a21\u5f0f\u6545\u969c\u5207\u6362\u7684\u8fc7\u7a0b","text":"<p>\u5047\u8bbe\u4e3b\u670d\u52a1\u5668\u5b95\u673a\uff0c\u54e8\u5175 1 \u5148\u76d1\u6d4b\u5230\u8fd9\u4e2a\u7ed3\u679c\uff0c\u7cfb\u7edf\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u8fdb\u884c failover \u8fc7\u7a0b\uff0c\u4ec5\u4ec5\u662f\u54e8\u5175 1 \u4e3b\u89c2\u7684\u8ba4\u4e3a\u4e3b\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u8fd9\u4e2a\u7ebf\u4e0b\u79f0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002\u5f53\u540e\u9762\u7684\u54e8\u5175\u4e5f\u76d1\u6d4b\u5230\u4e3b\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u8fbe\u5230\u4e00\u5b9a\u503c\u65f6\uff0c\u90a3\u4e48\u54e8\u5175\u4e4b\u95f4\u5c31\u4f1a\u8fdb\u884c\u4e00\u6b21\u6295\u7968\uff0c\u6295\u7968\u7684\u7ed3\u679c\u7531\u4e00\u4e2a\u54e8\u5175\u53d1\u8d77\uff0c\u8fdb\u884c failover \u64cd\u4f5c\u3002\u5207\u6362\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u901a\u8fc7\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff0c\u8ba9\u5404\u4e2a\u54e8\u5175\u628a\u81ea\u5df1\u76d1\u63a7\u7684\u4ece\u670d\u52a1\u5668\u5b9e\u73b0\u5207\u6362\u4e3b\u673a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u53ef\u89c2\u4e0b\u7ebf\u3002\u8fd9\u6837\u5bf9\u5ba2\u6237\u7aef\u800c\u8a00\uff0c\u4e00\u5207\u90fd\u662f\u900f\u660e\u7684\u3002</p>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_9","title":"\u54e8\u5175\u6a21\u5f0f\u642d\u5efa(\u76f8\u540c\u4e3b\u673a\u4e0d\u540c\u7aef\u53e3)","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_10","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p>Master(<code>redis_6379.conf</code>)</p> <pre><code>bind 0.0.0.0\nport 6379\nrequirepass 1234\nprotected-mode no\ndaemonize yes\npidfile /var/run/redis_6379.pid\ndbfilename dump_6379.rdb\nlogfile redis_6379.log\n</code></pre> </li> <li> <p>Slave(<code>redis_6380.conf</code>)</p> <p>\u5bf9\u5e94\u4fee\u6539\u5176\u5b83\u4ece\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u7684\u7aef\u53e3\u3002</p> <pre><code>bind 0.0.0.0\nport 6380\nrequirepass 1234\nprotected-mode no\ndaemonize yes\npidfile /var/run/redis_6380.pid\ndbfilename dump_6380.rdb\nlogfile redis_6380.log\n\nreplicaof 127.0.0.1 6379\nmasterauth 1234\n</code></pre> </li> <li> <p>Sentinel(<code>sentinel_26379.conf</code>)     &gt; \u5bf9\u5e94\u4fee\u6539\u5176\u5b83\u54e8\u5175\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u7684\u7aef\u53e3\uff0c\u5e76\u4e14\u9700\u8981\u6307\u5b9a\u4e3b\u8282\u70b9\u670d\u52a1\u5668\u7684 IP\uff0c\u5426\u5219 Java \u5ba2\u6237\u7aef\u8fde\u63a5\u4e0d\u6210\u529f\u3002     <pre><code>port 26379\nrequirepass 1234\nprotected-mode no\ndaemonize yes\npidfile /var/run/redis-sentinel_26379.pid\nlogfile redis-sentinel_26379.log\n# sentinel monitor &lt;master-group-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;\nsentinel monitor master 192.192.192.101 6379 2\nsentinel auth-pass master 1234\n</code></pre></p> </li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_11","title":"\u542f\u52a8\u96c6\u7fa4","text":"<pre><code>redis-server redis_6379.conf\nredis-server redis_6380.conf\nredis-server redis_6381.conf\nredis-sentinel sentinel_26379.conf\nredis-sentinel sentinel_26380.conf\nredis-sentinel sentinel_26381.conf\n</code></pre>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_12","title":"\u67e5\u770b\u96c6\u7fa4\u4fe1\u606f","text":"<pre><code>redis-cli -h 127.0.0.1 -p 6379 -a 1234\n\n127.0.0.1:6379&gt; info replication\n</code></pre>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#spring-boot","title":"Spring Boot \u8fde\u63a5","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> <pre><code>spring:\n  redis:\n    sentinel:\n      nodes:\n        - 192.192.192.101:26379\n        - 192.192.192.101:26380\n        - 192.192.192.101:26381\n      password: 1234\n      master: master\n    password: 1234\n</code></pre>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_13","title":"\u96c6\u7fa4\u6a21\u5f0f","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_14","title":"\u96c6\u7fa4\u6a21\u5f0f\u7279\u70b9","text":"<ul> <li>\u96c6\u7fa4\u5b8c\u5168\u53bb\u4e2d\u5fc3\u5316\uff0c\u91c7\u7528\u591a\u4e3b\u591a\u4ece\uff1b\u6240\u6709\u7684 Redis \u8282\u70b9\u5f7c\u6b64\u4e92\u8054\uff0c\u5185\u90e8\u4f7f\u7528\u4e8c\u8fdb\u5236\u534f\u8bae\u4f18\u5316\u4f20\u8f93\u901f\u5ea6\u548c\u5e26\u5bbd\u3002</li> <li>\u5ba2\u6237\u7aef\u4e0e Redis \u8282\u70b9\u76f4\u8fde\uff0c\u4e0d\u9700\u8981\u4e2d\u95f4\u4ee3\u7406\u5c42\u3002\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u8fde\u63a5\u96c6\u7fa4\u6240\u6709\u8282\u70b9\uff0c\u8fde\u63a5\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u53ef\u7528\u8282\u70b9\u5373\u53ef\u3002</li> <li>\u6bcf\u4e00\u4e2a\u5206\u533a\u90fd\u662f\u7531\u4e00\u4e2a\u4e3b\u673a\u548c\u591a\u4e2a\u4ece\u673a\u7ec4\u6210\uff0c\u5206\u7247\u548c\u5206\u7247\u4e4b\u95f4\u662f\u76f8\u4e92\u5e73\u884c\u7684\u3002</li> <li>\u6bcf\u4e00\u4e2a Master \u8282\u70b9\u8d1f\u8d23\u7ef4\u62a4\u4e00\u90e8\u5206\u69fd\uff0c\u4ee5\u53ca\u69fd\u6240\u6620\u5c04\u7684\u952e\u503c\u6570\u636e\uff1b\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u8282\u70b9\u90fd\u6709\u5168\u91cf\u7684\u69fd\u4fe1\u606f\uff0c\u901a\u8fc7\u69fd\u6bcf\u4e2a\u8282\u70b9\u90fd\u77e5\u9053\u5177\u4f53\u6570\u636e\u5b58\u50a8\u5728\u54ea\u4e2a\u8282\u70b9\u4e0a\u3002</li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_15","title":"\u96c6\u7fa4\u6a21\u5f0f\u642d\u5efa(\u76f8\u540c\u4e3b\u673a\u4e0d\u540c\u7aef\u53e3)","text":""},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_16","title":"\u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li>Master(<code>redis_6379.conf</code>)     &gt; \u5bf9\u5e94\u4fee\u6539\u5176\u5b83\u4e3b\u8282\u70b9\u7684\u7aef\u53e3\u53f7\u3002</li> <li> <p><code>redis_6379.conf</code></p> <pre><code>bind 0.0.0.0\nport 6379\nrequirepass 1234\nprotected-mode no\ndaemonize yes\npidfile /var/run/redis_6379.pid\ndbfilename dump_6379.rdb\nlogfile redis_6379.log\n\ncluster-enabled yes\ncluster-config-file nodes_6379.conf\nmasterauth 1234\n</code></pre> </li> </ul>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_17","title":"\u542f\u52a8\u96c6\u7fa4","text":"<pre><code>redis-server redis_6379.conf\nredis-server redis_6380.conf\nredis-server redis_6381.conf\nredis-server redis_6382.conf\nredis-server redis_6383.conf\nredis-server redis_6384.conf\n\n# --cluster-replicas 1 \u6307\u5b9a\u521b\u5efa master \u65f6\u540c\u65f6\u521b\u5efa\u4e00\u4e2a slave\nredis-cli --cluster create 192.192.192.101:6379 192.192.192.101:6380 192.192.192.101:6381 192.192.192.101:6382 192.192.192.101:6383 192.192.192.101:6384 --cluster-replicas 1 -a 1234\n</code></pre>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#_18","title":"\u67e5\u770b\u96c6\u7fa4\u4fe1\u606f","text":"<pre><code># \u96c6\u7fa4\u6a21\u5f0f\u4e0b\u9700\u8981\u5e26\u4e0a\u53c2\u6570 -c\nredis-cli -c -h 127.0.0.1 -p 6379 -a 1234\n\n127.0.0.1:6379&gt; cluster nodes\n</code></pre>"},{"location":"database/redis/Redis%20%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%90%AD%E5%BB%BA/#spring-boot_1","title":"Spring Boot \u8fde\u63a5","text":"<pre><code>spring:\n  redis:\n    cluster:\n      nodes:\n        - 192.192.192.101:6379\n        - 192.192.192.101:6380\n        - 192.192.192.101:6381\n        - 192.192.192.101:6382\n        - 192.192.192.101:6383\n        - 192.192.192.101:6384\n    password: 1234\n</code></pre>"},{"location":"database/redis/__demo__/bloom-filter-demo/","title":"Index","text":""},{"location":"database/redis/__demo__/bloom-filter-demo/#_1","title":"\u7248\u672c","text":"<code>jdk</code> <code>17</code> <code>spring-boot</code> <code>2.7.6</code> <code>mybatis-plus</code> <code>3.5.2</code> <code>redisson</code> <code>3.18.0</code>"},{"location":"database/redis/__demo__/bloom-filter-demo/#_2","title":"\u5f00\u59cb","text":""},{"location":"database/redis/__demo__/bloom-filter-demo/#_3","title":"\u751f\u6210\u6570\u636e","text":"<ul> <li> <p><code>MyTest.generate()</code></p> <pre><code>totalCount=1000000 batchSize=1000 batchCount=1000 cost=8703\n</code></pre> </li> </ul>"},{"location":"database/redis/__demo__/bloom-filter-demo/#_4","title":"\u521d\u59cb\u5316\u5e03\u9686\u8fc7\u6ee4\u5668","text":"<ul> <li> <p><code>curl http://127.0.0.1:8080/bloom-filter/rebuild</code></p> <pre><code>filterName=user:id_list filterFactor=0.01 listSize=1000000 rebuildCost=134633\n</code></pre> </li> </ul>"},{"location":"database/sqlserver/","title":"SQLServer","text":""},{"location":"database/sqlserver/#sqlserver-on-linux","title":"SQLServer on Linux","text":"<ul> <li>https://learn.microsoft.com/zh-cn/sql/linux/sql-server-linux-configure-environment-variables</li> </ul>"},{"location":"frontend/","title":"Index","text":""},{"location":"frontend/#_1","title":"\u524d\u7aef","text":""},{"location":"frontend/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/","title":"\u6d4f\u89c8\u5668\u6e32\u67d3\u539f\u7406","text":""},{"location":"frontend/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/#reflow","title":"\u4ec0\u4e48\u662f reflow?","text":"<p>reflow \u7684\u672c\u8d28\u662f\u91cd\u65b0\u8ba1\u7b97 layout \u6811\u3002</p> <p>\u5f53\u8fdb\u884c\u4e86\u4f1a\u5f71\u54cd\u5e03\u5c40\u6811\u7684\u64cd\u4f5c\u540e\uff0c\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u5e03\u5c40\u6811\uff0c\u4f1a\u5f15\u53d1 layout\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fde\u7eed\u7684\u591a\u6b21\u64cd\u4f5c\u5bfc\u81f4\u5e03\u5c40\u6811\u53cd\u590d\u8ba1\u7b97\uff0c\u6d4f\u89c8\u5668\u4f1a\u5408\u5e76\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u5f53 JS \u4ee3\u7801\u5168\u90e8\u5b8c\u6210\u540e\u518d\u8fdb\u884c\u7edf\u4e00\u8ba1\u7b97\u3002</p> <p>\u6240\u4ee5\uff0c\u6539\u52a8\u5c5e\u6027\u9020\u6210\u7684 reflow \u662f\u5f02\u6b65\u5b8c\u6210\u7684\u3002</p> <p>\u4e5f\u540c\u6837\u662f\u56e0\u4e3a\u5982\u6b64\uff0c\u5f53 JS \u83b7\u53d6\u5e03\u5c40\u5c5e\u6027\u65f6\uff0c\u5c31\u53ef\u80fd\u9020\u6210\u65e0\u6cd5\u83b7\u53d6\u5230\u6700\u65b0\u7684\u5e03\u5c40\u4fe1\u606f\u3002</p> <p>\u6d4f\u89c8\u5668\u518d\u53cd\u590d\u6743\u8861\u4e0b\uff0c\u6700\u7ec8\u51b3\u5b9a\u83b7\u53d6\u5c5e\u6027\u7acb\u5373 reflow\u3002</p>"},{"location":"frontend/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/#repaint","title":"\u4ec0\u4e48\u662f repaint?","text":"<p>repaint \u7684\u672c\u8d28\u5c31\u662f\u91cd\u65b0\u6839\u636e\u5206\u5c42\u4fe1\u606f\u8ba1\u7b97\u4e86\u7ed8\u5236\u6307\u4ee4\u3002</p> <p>\u5f53\u6539\u52a8\u4e86\u53ef\u89c1\u6837\u5f0f\u540e\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\uff0c\u4f1a\u5f15\u53d1 repaint\u3002</p> <p>\u7531\u4e8e\u5143\u7d20\u7684\u5e03\u5c40\u4fe1\u606f\u4e5f\u5c5e\u4e8e\u53ef\u89c1\u6837\u5f0f\uff0c\u6240\u4ee5 reflow \u4e00\u5b9a\u4f1a\u5f15\u8d77 repaint\u3002</p>"},{"location":"frontend/qt/","title":"Qt","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/","title":"\u3010QT\u3011Mac \u642d\u5efa QT  \u73af\u5883","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#_1","title":"\u4e00\u3001\u5b89\u88c5\u76f8\u5173","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#11","title":"1.1 \u5728\u7ebf\u5b89\u88c5","text":"<ul> <li>https://www.qt.io/download-qt-installer</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#12","title":"1.2 \u5347\u7ea7\u7ef4\u62a4","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#13","title":"1.3 \u6587\u6863","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#_2","title":"\u4e8c\u3001\u547d\u4ee4\u884c\u7f16\u8bd1\u8fd0\u884c","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#21","title":"2.1 \u73af\u5883\u53d8\u91cf","text":"<p>\u5c06 Qt \u5e93\u7684 <code>bin</code> \u76ee\u5f55\u52a0\u5165 <code>PATH</code> \u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>export PATH=$PATH:/opt/qt/6.2.2/macos/bin\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91Mac%20%E6%90%AD%E5%BB%BA%20QT%20%20%E7%8E%AF%E5%A2%83/#22","title":"2.2 \u793a\u4f8b","text":"<ol> <li> <p>\u624b\u52a8\u521b\u5efa\u9879\u76ee\u76ee\u5f55</p> <pre><code>mkdir -p qt-demo\n</code></pre> </li> <li> <p><code>main.cpp</code></p> <p></p> </li> <li> <p>QMake \u751f\u6210 <code>.pro</code> \u6587\u4ef6</p> <pre><code>qmake -project\n</code></pre> <p></p> </li> <li> <p>\u624b\u52a8\u6dfb\u52a0\u6784\u5efa\u9009\u9879</p> <pre><code>QT += widgets\n</code></pre> <p></p> </li> <li> <p>\u751f\u6210 <code>Makefile</code></p> <pre><code>qmake\n</code></pre> <p></p> </li> <li> <p>\u7f16\u8bd1\u94fe\u63a5</p> <pre><code>make\n</code></pre> <p></p> </li> <li> <p>\u8fd0\u884c</p> <p></p> </li> </ol>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91SQLite%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%AD%A6%E7%94%9F%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/","title":"\u3010QT\u3011SQLite \u6570\u636e\u5e93\u6848\u4f8b\u2014\u2014\u5b66\u751f\u6210\u7ee9\u7ba1\u7406\u7cfb\u7edf","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91SQLite%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%AD%A6%E7%94%9F%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/#_1","title":"\u6848\u4f8b\u2014\u2014\u5b66\u4e60\u6210\u7ee9\u7ba1\u7406\u7cfb\u7edf","text":"<ul> <li> <p><code>student-management.pro</code></p> <pre><code>QT       += core gui sql\n\ngreaterThan(QT_MAJOR_VERSION, 4): QT += widgets\n\nCONFIG += c++11\n\nSOURCES += \\\n    main.cpp \\\n    dialog.cpp\n\nHEADERS += \\\n    dialog.h\n\nFORMS += \\\n    dialog.ui\n</code></pre> </li> <li> <p><code>dialog.ui</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;ui version=\"4.0\"&gt;\n &lt;class&gt;Dialog&lt;/class&gt;\n &lt;widget class=\"QDialog\" name=\"Dialog\"&gt;\n  &lt;property name=\"geometry\"&gt;\n   &lt;rect&gt;\n    &lt;x&gt;0&lt;/x&gt;\n    &lt;y&gt;0&lt;/y&gt;\n    &lt;width&gt;600&lt;/width&gt;\n    &lt;height&gt;400&lt;/height&gt;\n   &lt;/rect&gt;\n  &lt;/property&gt;\n  &lt;property name=\"font\"&gt;\n   &lt;font&gt;\n    &lt;family&gt;Inconsolata&lt;/family&gt;\n    &lt;pointsize&gt;16&lt;/pointsize&gt;\n   &lt;/font&gt;\n  &lt;/property&gt;\n  &lt;property name=\"windowTitle\"&gt;\n   &lt;string&gt;\u5b66\u751f\u6210\u7ee9\u7ba1\u7406\u7cfb\u7edf&lt;/string&gt;\n  &lt;/property&gt;\n  &lt;layout class=\"QVBoxLayout\" name=\"verticalLayout\"&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QHBoxLayout\" name=\"horizontalLayout\"&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QComboBox\" name=\"sortColumnComboBox\"&gt;\n       &lt;item&gt;\n        &lt;property name=\"text\"&gt;\n         &lt;string&gt;id&lt;/string&gt;\n        &lt;/property&gt;\n       &lt;/item&gt;\n       &lt;item&gt;\n        &lt;property name=\"text\"&gt;\n         &lt;string&gt;score&lt;/string&gt;\n        &lt;/property&gt;\n       &lt;/item&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QComboBox\" name=\"sortTypeComboBox\"&gt;\n       &lt;item&gt;\n        &lt;property name=\"text\"&gt;\n         &lt;string&gt;ASC&lt;/string&gt;\n        &lt;/property&gt;\n       &lt;/item&gt;\n       &lt;item&gt;\n        &lt;property name=\"text\"&gt;\n         &lt;string&gt;DESC&lt;/string&gt;\n        &lt;/property&gt;\n       &lt;/item&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QPushButton\" name=\"sortButton\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u6392\u5e8f&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;widget class=\"QTableView\" name=\"tableView\"/&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QGridLayout\" name=\"gridLayout\"&gt;\n     &lt;item row=\"0\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"idLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u5b66\u751f\u5b66\u53f7\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"0\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"idEdit\"/&gt;\n     &lt;/item&gt;\n     &lt;item row=\"1\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"nameLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u5b66\u751f\u59d3\u540d\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"1\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"nameEdit\"/&gt;\n     &lt;/item&gt;\n     &lt;item row=\"2\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"scoreLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u5b66\u751f\u6210\u7ee9\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"2\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"scoreEdit\"/&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QHBoxLayout\" name=\"horizontalLayout_2\"&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QPushButton\" name=\"insertButton\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u63d2\u5165&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QPushButton\" name=\"deleteButton\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u5220\u9664&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QPushButton\" name=\"updateButton\"&gt;\n       &lt;property name=\"font\"&gt;\n        &lt;font&gt;\n         &lt;family&gt;Inconsolata&lt;/family&gt;\n         &lt;pointsize&gt;16&lt;/pointsize&gt;\n        &lt;/font&gt;\n       &lt;/property&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u66f4\u65b0&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n  &lt;/layout&gt;\n &lt;/widget&gt;\n &lt;resources/&gt;\n &lt;connections/&gt;\n&lt;/ui&gt;\n</code></pre> </li> <li> <p><code>dialog.h</code></p> <pre><code>#ifndef DIALOG_H\n#define DIALOG_H\n\n#include &lt;QDialog&gt;\n#include &lt;QSqlDatabase&gt;\n#include &lt;QSqlQuery&gt;\n#include &lt;QSqlQueryModel&gt;\n#include &lt;QSqlError&gt;\n#include &lt;QMessageBox&gt;\n\nQT_BEGIN_NAMESPACE\nnamespace Ui { class Dialog; }\nQT_END_NAMESPACE\n\nclass Dialog : public QDialog {\nQ_OBJECT\npublic:\n    Dialog(QWidget* parent = nullptr);\n    ~Dialog();\nprivate slots:\n    void on_insertButton_clicked();\n    void on_deleteButton_clicked();\n    void on_updateButton_clicked();\n    void on_sortButton_clicked();\nprivate:\n    void createDB();\n    void createTable();\n    void queryTable();\nprivate:\n    Ui::Dialog* ui;\n    QSqlDatabase db;\n};\n\n#endif // DIALOG_H\n</code></pre> </li> <li> <p><code>dialog.cpp</code></p> <pre><code>#include \"dialog.h\"\n#include \"ui_dialog.h\"\n\nDialog::Dialog(QWidget* parent) : QDialog(parent), ui(new Ui::Dialog) {\n    ui-&gt;setupUi(this);\n    createDB();\n    createTable();\n    queryTable();\n}\n\nDialog::~Dialog() {\n    delete ui;\n}\n\nvoid Dialog::on_insertButton_clicked() {\n    int id = ui-&gt;idEdit-&gt;text().toInt();\n    if (id == 0) {\n        QMessageBox::critical(this, \"Error\", \"\u5b66\u53f7\u8f93\u5165\u9519\u8bef\");\n        return;\n    }\n    QString name = ui-&gt;nameEdit-&gt;text();\n    if (name == \"\") {\n        QMessageBox::critical(this, \"Error\", \"\u59d3\u540d\u8f93\u5165\u9519\u8bef\");\n        return;\n    }\n    double score = ui-&gt;scoreEdit-&gt;text().toDouble();\n    if (score &lt; 0 || score &gt; 100) {\n        QMessageBox::critical(this, \"Error\", \"\u6210\u7ee9\u8f93\u5165\u9519\u8bef\");\n        return;\n    }\n    QString sql = QString(\"INSERT INTO student(id, name, score) VALUES(%1, '%2', %3)\").arg(id).arg(name).arg(score);\n    QSqlQuery query(db);\n    if (!query.exec(sql)) {\n        qDebug() &lt;&lt; sql &lt;&lt; query.lastError();\n    } else {\n        qDebug() &lt;&lt; \"\u63d2\u5165\u6570\u636e\u6210\u529f\";\n        queryTable();\n    }\n}\n\nvoid Dialog::on_deleteButton_clicked() {\n    int id = ui-&gt;idEdit-&gt;text().toInt();\n    QString sql = \"DELETE FROM student WHERE id = :id\";\n    QSqlQuery query(db);\n    query.prepare(sql);\n    query.bindValue(\":id\", id);\n    if (!query.exec()) {\n        qDebug() &lt;&lt; sql &lt;&lt; query.lastError();\n    } else {\n        qDebug() &lt;&lt; \"\u5220\u9664\u6570\u636e\u6210\u529f\";\n        queryTable();\n    }\n}\n\nvoid Dialog::on_updateButton_clicked() {\n    int id = ui-&gt;idEdit-&gt;text().toInt();\n    if (id == 0) {\n        QMessageBox::critical(this, \"Error\", \"\u5b66\u53f7\u8f93\u5165\u9519\u8bef\");\n        return;\n    }\n    double score = ui-&gt;scoreEdit-&gt;text().toDouble();\n    if (score &lt; 0 || score &gt; 100) {\n        QMessageBox::critical(this, \"Error\", \"\u6210\u7ee9\u8f93\u5165\u9519\u8bef\");\n        return;\n    }\n    QString sql = \"UPDATE student SET score = :score WHERE id = :id\";\n    QSqlQuery query(db);\n    query.prepare(sql);\n    query.bindValue(\":id\", id);\n    query.bindValue(\":score\", score);\n    if (!query.exec()) {\n        qDebug() &lt;&lt; sql &lt;&lt; query.lastError();\n    } else {\n        qDebug() &lt;&lt; \"\u66f4\u65b0\u6570\u636e\u6210\u529f\";\n        queryTable();\n    }\n}\n\nvoid Dialog::on_sortButton_clicked() {\n    QString sortColumn = ui-&gt;sortColumnComboBox-&gt;currentText();\n    QString sortType = ui-&gt;sortTypeComboBox-&gt;currentText();\n    QString sql = QString(\"SELECT * FROM student ORDER BY %1 %2\").arg(sortColumn).arg(sortType);\n    QSqlQueryModel* model = new QSqlQueryModel();\n    model-&gt;setQuery(sql, db);\n    ui-&gt;tableView-&gt;setModel(model);\n}\n\nvoid Dialog::createDB() {\n    // \u6dfb\u52a0\u6570\u636e\u5e93\u9a71\u52a8\n    db = QSqlDatabase::addDatabase(\"QSQLITE\");\n    // \u8bbe\u7f6e\u5e93\u540d(\u6587\u4ef6\u540d)\n    db.setDatabaseName(\"student.db\");\n    // \u6253\u5f00\u6570\u636e\u5e93\n    if (!db.open()) {\n        qDebug() &lt;&lt; \"\u521b\u5efa/\u6253\u5f00\u6570\u636e\u5e93\u5931\u8d25\";\n    } else {\n        qDebug() &lt;&lt; \"\u521b\u5efa/\u6253\u5f00\u6570\u636e\u5e93\u6210\u529f\";\n    }\n}\n\nvoid Dialog::createTable() {\n    QString sql = QString(\n        \"CREATE TABLE student (\"\n        \"id    INT NOT NULL PRIMARY KEY,\"\n        \"name  TEXT NOT NULL,\"\n        \"score REAL NOT NULL\"\n        \")\"\n    );\n    QSqlQuery query(db);\n    if (!query.exec(sql)) {\n        qDebug() &lt;&lt; sql &lt;&lt; query.lastError();\n    } else {\n        qDebug() &lt;&lt; \"\u5efa\u8868\u6210\u529f\";\n    }\n}\n\nvoid Dialog::queryTable() {\n    QString sql = \"SELECT * FROM student\";\n    QSqlQueryModel* model = new QSqlQueryModel();\n    model-&gt;setQuery(sql, db);\n    ui-&gt;tableView-&gt;setModel(model);\n}\n</code></pre> </li> </ul> <p></p>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91SQLite%20%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%AD%A6%E7%94%9F%E6%88%90%E7%BB%A9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/#_2","title":"\u6548\u679c","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/","title":"\u3010QT\u3011\u7236\u7a97\u53e3\u3001\u4fe1\u53f7\u548c\u69fd\u3001\u9762\u5411\u5bf9\u8c61","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_1","title":"\u4e00\u3001\u7236\u7a97\u53e3","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#11","title":"1.1 \u4ecb\u7ecd","text":"<p>\u521b\u5efa\u63a7\u4ef6\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u505c\u9760\u5728\u67d0\u4e2a\u7236\u7a97\u53e3\u4e0a\u9762\uff0c\u8fd9\u65f6\u63a7\u4ef6\u5c06\u4f5c\u4e3a\u5b50\u7a97\u53e3\u88ab\u675f\u7f1a\u5728\u5176\u7236\u7a97\u53e3\u7684\u5185\u90e8\uff0c\u5e76\u4f34\u968f\u7236\u7a97\u53e3\u4e00\u8d77\u79fb\u52a8\u3001\u9690\u85cf\u3001\u663e\u793a\u548c\u5173\u95ed\uff0c\u5426\u5219\u8be5\u63a7\u4ef6\u5c06\u4f5c\u4e3a\u72ec\u7acb\u7a97\u53e3\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\uff0c\u4e14\u6e38\u79bb\u4e8e\u5176\u5b83\u7a97\u53e3\u4e4b\u5916\u3002</p> <p><code>QWidgets</code> \u53ca\u5176\u5b50\u7c7b\u7684\u5bf9\u8c61\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u5176\u5b83\u63a7\u4ef6\u7684\u7236\u7a97\u53e3\uff0c\u5e38\u89c1\u7684\u7236\u7a97\u53e3\u7c7b\u6709\u5982\u4e0b\u4e09\u4e2a\uff1a</p> <ul> <li><code>QWidgets</code></li> <li><code>QMainWindow</code>\uff1a<code>QWidgets</code> \u7684\u76f4\u63a5\u5b50\u7c7b</li> <li><code>QDialog</code>\uff1a<code>QWidgets</code> \u7684\u76f4\u63a5\u5b50\u7c7b</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#12","title":"1.2 \u6790\u6784\u51fd\u6570","text":"<p>\u7236\u7a97\u53e3\u7684\u6790\u6784\u51fd\u6570\u4f1a\u81ea\u52a8\u9500\u6bc1\u5176\u6240\u6709\u5b50\u7a97\u53e3\u5bf9\u8c61\uff0c\u56e0\u6b64\u5373\u4f7f\u5b50\u7a97\u53e3\u5bf9\u8c61\u662f\u901a\u8fc7 <code>new</code> \u64cd\u4f5c\u7b26\u52a8\u6001\u521b\u5efa\u7684\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u663e\u5f0f\u7684\u6267\u884c <code>delete</code> \u64cd\u4f5c\uff0c\u800c\u4e14\u4e0d\u7528\u62c5\u5fc3\u5185\u5b58\u6cc4\u6f0f\u7684\u95ee\u9898\uff0c\u53ea\u8981\u4fdd\u8bc1\u7236\u7a97\u53e3\u5bf9\u8c61\u88ab\u6b63\u786e\u9500\u6bc1 u\uff0c\u5176\u5b50\u7a97\u53e3\u4e5f\u5c06\u968f\u4e4b\u88ab\u9500\u6bc1\u3002</p>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#13","title":"1.3 \u8bbe\u7f6e\u7a97\u53e3\u7684\u4f4d\u7f6e\u548c\u5927\u5c0f","text":"<pre><code>void move(int x, int y);\nvoid resize(int w, int h);\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_2","title":"\u4e8c\u3001\u4fe1\u53f7\u548c\u69fd","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#21","title":"2.1 \u4ecb\u7ecd","text":"<ul> <li>\u4fe1\u53f7\u548c\u69fd\u662f QT \u81ea\u884c\u5b9a\u4e49\u7684\u4e00\u79cd\u901a\u4fe1\u673a\u5236\uff0c\u5b9e\u73b0\u5bf9\u8c61\u4e4b\u95f4\u7684\u6570\u636e\u4ea4\u4e92\u3002</li> <li>\u5f53\u7528\u6237\u6216\u7cfb\u7edf\u89e6\u53d1\u4e86\u4e00\u4e2a\u52a8\u4f5c\uff0c\u5bfc\u81f4\u67d0\u4e2a\u63a7\u4ef6\u7684\u72b6\u6001\u53d1\u9001\u4e86\u6539\u53d8\uff0c\u8be5\u63a7\u4ef6\u5c31\u4f1a\u53d1\u5c04\u4e00\u4e2a\u4fe1\u53f7\uff0c\u5373\u8c03\u7528\u5176\u7c7b\u4e2d\u4e00\u4e2a\u7279\u5b9a\u7684\u6210\u5458\u51fd\u6570\uff08\u4fe1\u53f7\uff09\uff0c\u540c\u65f6\u8fd8\u53ef\u80fd\u643a\u5e26\u6709\u5fc5\u8981\u7684\u53c2\u6570\u3002</li> <li>\u69fd\u548c\u666e\u901a\u7684\u6210\u5458\u51fd\u6570\u51e0\u4e4e\u6ca1\u6709\u592a\u591a\u533a\u522b\uff0c\u53ef\u4ee5\u662f\u516c\u6709\u7684\u3001\u4fdd\u62a4\u7684\u6216\u79c1\u6709\u7684\uff0c\u53ef\u4ee5\u88ab\u91cd\u8f7d\uff0c\u4e5f\u53ef\u4ee5\u88ab\u8986\u76d6\uff0c\u5176\u53c2\u6570\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u5e76\u53ef\u4ee5\u50cf\u666e\u901a\u6210\u5458\u51fd\u6570\u4e00\u6837\u8c03\u7528\u3002</li> <li>\u69fd\u51fd\u6570\u4e0e\u666e\u901a\u6210\u5458\u51fd\u6570\u7684\u5dee\u522b\u4e0d\u5728\u4e8e\u5176\u8bed\u6cd5\u7279\u6027\uff0c\u800c\u5728\u4e8e\u5176\u529f\u80fd\u3002\u69fd\u51fd\u6570\u66f4\u591a\u4f53\u73b0\u4e3a\u5bf9\u67d0\u79cd\u7279\u5b9a\u4fe1\u53f7\u7684\u5904\u7406\uff0c\u53ef\u4ee5\u5c06\u69fd\u548c\u5176\u5b83\u5bf9\u8c61\u4fe1\u53f7\u5efa\u7acb\u8fde\u63a5\uff0c\u8fd9\u6837\u5f53\u53d1\u5c04\u4fe1\u53f7\u65f6\uff0c\u69fd\u51fd\u6570\u5c06\u88ab\u89e6\u53d1\u548c\u6267\u884c\uff0c\u8fdb\u800c\u6765\u5b8c\u6210\u5177\u4f53\u529f\u80fd\u3002</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#22","title":"2.2 \u4fe1\u53f7\u548c\u69fd\u7684\u8fde\u63a5","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_3","title":"\u51fd\u6570\u7b7e\u540d","text":"<pre><code>QObject:connect(\n  const QObject* sender,\n  const char* signal,\n  const QObject* receiver,\n  const char* method\n);\n</code></pre> <ul> <li><code>sender</code>\uff1a\u4fe1\u53f7\u53d1\u9001\u5bf9\u8c61\u6307\u9488</li> <li><code>signal</code>\uff1a\u8981\u53d1\u9001\u7684\u4fe1\u53f7\u51fd\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>SIGNAL()</code> \u5b8f\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362</li> <li><code>receiver</code>\uff1a\u4fe1\u53f7\u7684\u63a5\u6536\u5bf9\u8c61\u6307\u9488</li> <li><code>method</code>\uff1a\u63a5\u6536\u4fe1\u53f7\u540e\u8981\u6267\u884c\u7684\u69fd\u51fd\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>SLOT()</code> \u5b8f\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_4","title":"\u5e94\u7528","text":"<ul> <li>\u4e00\u4e2a\u4fe1\u53f7\u53ef\u4ee5\u88ab\u8fde\u63a5\u5230\u591a\u4e2a\u69fd\uff08\u4e00\u5bf9\u591a\uff09</li> <li>\u591a\u4e2a\u4fe1\u53f7\u4e5f\u53ef\u4ee5\u8fde\u63a5\u540c\u4e00\u4e2a\u69fd\uff08\u591a\u5bf9\u4e00\uff09</li> <li>\u4e24\u4e2a\u4fe1\u53f7\u53ef\u4ee5\u76f4\u63a5\u8fde\u63a5\uff08\u4fe1\u53f7\u7ea7\u8054\uff09</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#23","title":"2.3 \u6848\u4f8b","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_5","title":"\u70b9\u51fb\u6309\u94ae\u5173\u95ed\u6807\u7b7e\u3001\u9000\u51fa\u7a0b\u5e8f","text":"<pre><code>#include&lt;QApplication&gt;\n#include&lt;QDialog&gt;\n#include&lt;QLabel&gt;\n#include&lt;QPushButton&gt;\n\nint main(int argc, char* argv[]) {\n    QApplication app(argc, argv);\n\n    QDialog parent;\n    parent.resize(320, 240);\n\n    QLabel label(\"\u6807\u7b7e\", &amp;parent);\n    label.move(50, 50);\n\n    QPushButton button1(\"\u5173\u95ed\u6807\u7b7e\", &amp;parent);\n    button1.move(50, 140);\n\n    QPushButton button2(\"\u9000\u51fa\u7a0b\u5e8f\", &amp;parent);\n    button1.move(200, 140);\n\n    parent.show();\n\n    QObject::connect(\n        &amp;button1,\n        SIGNAL(clicked()),\n        &amp;label,\n        SLOT(close())\n    );\n\n    QObject::connect(\n        &amp;button2,\n        SIGNAL(clicked()),\n        &amp;app,\n        SLOT(quit())\n    );\n    return app.exec();\n}\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_6","title":"\u6ed1\u5757\u8054\u52a8\u9009\u503c\u6846","text":"<pre><code>#include&lt;QApplication&gt;\n#include&lt;QDialog&gt;\n#include&lt;QSlider&gt;\n#include&lt;QSpinBox&gt;\n\nint main(int argc, char ** argv) {\n    QApplication app(argc, argv);\n\n    QDialog parent;\n    parent.resize(320, 240);\n\n    // \u521b\u5efa\u6c34\u5e73\u6ed1\u5757\n    QSlider slider(Qt::Horizontal, &amp;parent);\n    slider.move(20,100);\n    slider.setRange(0,200);\n\n    // \u521b\u5efa\u9009\u503c\u6846\n    QSpinBox spinBox(&amp;parent);\n    spinBox.move(220,100);\n    spinBox.setRange(0,200);\n\n    // \u6ed1\u5757\u6ed1\u52a8\u8ba9\u9009\u503c\u968f\u503c\u6539\u53d8\n    QObject::connect(\n        &amp;slider,\n        SIGNAL(valueChanged(int)),\n        &amp;spinBox,\n        SLOT(setValue(int))\n    );\n\n    // \u9009\u503c\u6846\u6570\u503c\u6539\u53d8\u8ba9\u6ed1\u5757\u968f\u4e4b\u6ed1\u52a8\n    QObject::connect(\n        &amp;spinBox,\n        SIGNAL(valueChanged(int)),\n        &amp;slider,\n        SLOT(setValue(int))\n    );\n\n    parent.show();\n\n    return app.exec();\n}\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#24","title":"2.4 \u4fe1\u53f7\u548c\u69fd\u8fde\u63a5\u7684\u8bed\u6cd5\u8981\u6c42","text":"<ul> <li> <p>\u4fe1\u53f7\u548c\u69fd\u53c2\u6570\u8981\u4e00\u81f4</p> <pre><code>QObject::connect(A, SIGNAL(sigfun(int)), B, SLOT(slotfun(int))); // OK\n\nQObject::connect(A, SIGNAL(sigfun(int)), B, SLOT(slotfun(int, int))); // ERROR\n</code></pre> </li> <li> <p>\u53ef\u4ee5\u5e26\u6709\u7f3a\u7701\u53c2\u6570</p> <pre><code>QObject::connect(A, SIGNAL(sigfun(int)), B, SLOT(slotfun(int, int=0))); // OK\n</code></pre> </li> <li> <p>\u4fe1\u53f7\u51fd\u6570\u7684\u53c2\u6570\u53ef\u4ee5\u591a\u4e8e\u69fd\u51fd\u6570\uff0c\u591a\u4e8e\u53c2\u6570\u5c06\u88ab\u5ffd\u7565</p> <pre><code>QObject::connect(A, SIGNAL(sigfun(int, int)), B, SLOT(slotfun(int))); // OK\n</code></pre> </li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#qt","title":"\u4e09\u3001\u9762\u5411\u5bf9\u8c61 QT \u7f16\u7a0b","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#31","title":"3.1 \u4ecb\u7ecd","text":"<ul> <li>\u5b8c\u5168\u4e0d\u4f7f\u7528\u4efb\u4f55\u9762\u5411\u5bf9\u8c61\u6280\u672f\uff0c\u800c\u53ea\u662f\u5229\u7528 QT \u6240\u63d0\u4f9b\u7684\u7c7b\u521b\u5efa\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u5bf9\u8c61\u7684\u63a5\u53e3\u4ee5\u6ee1\u8db3\u7528\u6237\u7684\u9700\u8981\u662f\u53ef\u80fd\uff0c\u4f46\u8fd9\u6837\u6784\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u5176\u529f\u80fd\u5fc5\u7136\u662f\u5341\u5206\u6709\u9650\u7684\u3002</li> <li>\u9996\u5148\uff0cQt \u7c7b\u4fdd\u62a4\u6210\u5458\u4e2d\u7684\u8bf8\u591a\u5b9e\u73b0\u65e0\u6cd5\u5728\u7c7b\u7684\u5916\u90e8\u88ab\u590d\u7528\uff0cQt \u8bd5\u56fe\u901a\u591a\u6001\u5b9e\u73b0\u7684\u5f88\u591a\u673a\u5236\uff0c\u5982\u4e8b\u4ef6\u5904\u7406\uff0c\u5b8c\u5168\u65e0\u6cd5\u4f7f\u7528\u3002</li> <li>\u518d\u6b21\uff0cQt \u63d0\u4f9b\u7684\u4fe1\u53f7\u548c\u69fd\u4e0d\u53ef\u80fd\u6ee1\u8db3\u7528\u6237\u6240\u6709\u7684\u9700\u6c42\uff0c\u81ea\u5b9a\u4e49\u4fe1\u53f7\u548c\u69fd\u9700\u8981\u9762\u5411\u5bf9\u8c61\u6280\u672f\u3002</li> <li>\u6700\u540e\uff0cQt \u8bbe\u8ba1\u5e08\u3001Qt \u521b\u5efa\u5668\u7b49\u5de5\u5177\u94fe\u90fd\u4ee5\u9762\u5411\u5bf9\u8c61\u7684\u65b9\u5f0f\u4f7f\u7528 Qt\uff0c\u53cd\u5176\u9053\u800c\u884c\u4e4b\u4e0d\u4f1a\u6709\u597d\u7ed3\u679c\u3002</li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#32","title":"3.2 \u6848\u4f8b","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#321","title":"3.2.1 \u52a0\u6cd5\u8ba1\u7b97\u5668","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#calculatordialog","title":"<code>CalculatorDialog</code>","text":"<ul> <li> <p><code>calculator_dialog.h</code></p> <pre><code>#ifndef CALCULATOR_DIALOG_H\n\n#include&lt;QDialog&gt;\n#include&lt;QLabel&gt;\n#include&lt;QPushButton&gt;\n#include&lt;QLineEdit&gt;        // \u884c\u7f16\u8f91\u63a7\u4ef6\n#include&lt;QHBoxLayout&gt;      // \u6c34\u5e73\u5e03\u5c40\u5668\n#include&lt;QDoubleValidator&gt; // \u9a8c\u8bc1\u5668\n\nclass CalculatorDialog : public QDialog {\nQ_OBJECT // moc\n\npublic:\n    // \u6784\u9020\u51fd\u6570\n    CalculatorDialog();\n\npublic slots:\n    // \u542f\u7528\u7b49\u53f7\u6309\u94ae\n    void enableButton();\n    // \u8ba1\u7b97\u548c\u663e\u793a\u7ed3\u679c\n    void calc();\n\nprivate:\n    QLineEdit* m_editX;    // \u5de6\u64cd\u4f5c\u6570\n    QLineEdit* m_editY;    // \u53f3\u64cd\u4f5c\u6570\n    QLineEdit* m_editZ;    // \u663e\u793a\u7ed3\u679c\n    QLabel* m_label;       // \"+\"\n    QPushButton* m_button; // \"=\"\n};\n\n#endif // CALCULATOR_DIALOG_H\n</code></pre> </li> <li> <p><code>calculator_dialog.cpp</code></p> <pre><code>#include \"calculator_dialog.h\"\n\n// \u6784\u9020\u51fd\u6570\nCalculatorDialog::CalculatorDialog() {\n    // 1. \u754c\u9762\u521d\u59cb\u5316\n    setWindowTitle(\"\u8ba1\u7b97\u5668\");\n    // \u5de6\u64cd\u4f5c\u6570\n    m_editX = new QLineEdit(this);\n    m_editX-&gt;setAlignment(Qt::AlignRight);               // \u8bbe\u7f6e\u6587\u672c\u5bf9\u9f50\n    m_editX-&gt;setValidator(new QDoubleValidator(this)); // \u8bbe\u7f6e\u6570\u5b57\u9a8c\u8bc1\u5668\n    // \u53f3\u64cd\u4f5c\u6570\n    m_editY = new QLineEdit(this);\n    m_editY-&gt;setAlignment(Qt::AlignRight);\n    m_editY-&gt;setValidator(new QDoubleValidator(this));\n    // \u663e\u793a\u7ed3\u679c\n    m_editZ = new QLineEdit(this);\n    m_editZ-&gt;setAlignment(Qt::AlignRight);\n    m_editZ-&gt;setReadOnly(true); // \u8bbe\u7f6e\u53ea\u8bfb\n    // \"+\"\n    m_label = new QLabel(\"+\", this);\n    // \"=\"\n    m_button = new QPushButton(\"=\", this);\n    m_button-&gt;setEnabled(false); // \u8bbe\u7f6e\u7981\u7528\n    // \u521b\u5efa\u5e03\u5c40\u5668(\u81ea\u52a8\u8c03\u6574\u6bcf\u4e2a\u63a7\u4ef6\u7684\u5927\u5c0f\u548c\u4f4d\u7f6e)(\u6309\u6c34\u5e73\u65b9\u5411\u4ee5\u6b64\u5c06\u63a7\u4ef6\u6dfb\u52a0\u5230\u5e03\u5c40\u5bb9\u5668\u4e2d)\n    QHBoxLayout* layout = new QHBoxLayout(this);\n    layout-&gt;addWidget(m_editX);\n    layout-&gt;addWidget(m_label);\n    layout-&gt;addWidget(m_editY);\n    layout-&gt;addWidget(m_button);\n    layout-&gt;addWidget(m_editZ);\n    setLayout(layout);\n\n    // 2. \u4fe1\u53f7\u548c\u69fd\u51fd\u6570\u8fde\u63a5\n    // \u5de6\u53f3\u64cd\u4f5c\u6570\u6587\u672c\u6539\u53d8\u65f6\u53d1\u9001\u4fe1\u53f7 textChanged()\n    connect(m_editX, SIGNAL(textChanged(QString)), this, SLOT(enableButton()));\n    connect(m_editY, SIGNAL(textChanged(QString)), this, SLOT(enableButton()));\n    // \u70b9\u51fb\u6309\u94ae\u53d1\u9001\u4fe1\u53f7 clicked()\n    connect(m_button, SIGNAL(clicked()), this, SLOT(calc()));\n}\n\n// \u542f\u7528\u7b49\u53f7\u6309\u94ae\nvoid CalculatorDialog::enableButton() {\n    bool xOk;\n    bool yOk;\n    m_editX-&gt;text().toDouble(&amp;xOk);\n    m_editY-&gt;text().toDouble(&amp;yOk);\n    // \u5f53\u5de6\u53f3\u64cd\u4f5c\u6570\u90fd\u8f93\u5165\u4e86\u6709\u6548\u6570\u636e\uff0c\u5219\u4f7f\u80fd\u7b49\u53f7\u6309\u94ae\n    m_button-&gt;setEnabled(xOk &amp;&amp; yOk);\n}\n\n// \u8ba1\u7b97\u548c\u663e\u793a\u7ed3\u679c\nvoid CalculatorDialog::calc() {\n    double result = m_editX-&gt;text().toDouble() + m_editY-&gt;text().toDouble();\n    // \u663e\u793a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7ed3\u679c\n    QString str = QString::number(result);\n    m_editZ-&gt;setText(str);\n}\n</code></pre> </li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#maincpp","title":"<code>main.cpp</code>","text":"<pre><code>#include&lt;QApplication&gt;\n\n#include \"calculator_dialog.h\"\n\nint main(int argc, char** argv) {\n    QApplication app(argc, argv);\n\n    CalculatorDialog dialog;\n    dialog.show();\n\n    return QApplication::exec();\n}\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_7","title":"\u6548\u679c","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#322","title":"3.2.2 \u83b7\u53d6\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#timedialog","title":"<code>TimeDialog</code>","text":"<ul> <li> <p><code>time_dialog.h</code></p> <pre><code>#ifndef TIME_DIALOG_H\n#define TIME_DIALOG_H\n\n#include &lt;QDialog&gt;\n#include &lt;QLabel&gt;\n#include &lt;QPushButton&gt;\n#include &lt;QVBoxLayout&gt; // \u5782\u76f4\u5e03\u5c40\u5668\n#include &lt;QTime&gt;       // \u65f6\u95f4\n\nclass TimeDialog : public QDialog {\nQ_OBJECT // moc\n\npublic:\n    TimeDialog();\n\npublic slots:\n    void getTime();\n\nsignals:\n    // \u81ea\u5b9a\u4e49\u4fe1\u53f7(\u53ea\u9700\u7533\u660e\u4e0d\u80fd\u5b9a\u4e49)\n    void mySignal(const QString&amp;);\nprivate:\n    QLabel* m_label;\n    QPushButton* m_button;\n};\n\n#endif // TIME_DIALOG_H\n</code></pre> </li> <li> <p><code>time_dialog.cpp</code></p> <pre><code>#include &lt;QFont&gt;\n\n#include \"time_dialog.h\"\n\nTimeDialog::TimeDialog() {\n    // 1. \u521d\u59cb\u5316\u754c\u9762\n    // \u5b57\u4f53\n    QFont font;\n    font.setPointSize(20);\n    // \u6807\u7b7e\n    m_label = new QLabel(this);\n    m_label-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);     // \u8bbe\u7f6e\u8fb9\u6846\n    m_label-&gt;setAlignment(Qt::AlignHCenter | Qt::AlignVCenter); // \u8bbe\u7f6e\u6587\u672c\u5bf9\u9f50\n    m_label-&gt;setFont(font);                                     // \u8bbe\u7f6e\u5b57\u4f53\n    // \u6309\u94ae\n    m_button = new QPushButton(\"\u83b7\u53d6\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4\", this);\n    m_button-&gt;setFont(font);\n    // \u5782\u76f4\u5e03\u5c40\u5668\n    QVBoxLayout* layout = new QVBoxLayout(this);\n    layout-&gt;addWidget(m_label);\n    layout-&gt;addWidget(m_button);\n    setLayout(layout);\n\n    // 2. \u4fe1\u53f7\u548c\u69fd\u51fd\u6570\n    connect(m_button, SIGNAL(clicked()), this, SLOT(getTime()));\n    // \u901a\u8fc7\u81ea\u5b9a\u4e49\u4fe1\u53f7\u89e6\u53d1 Label \u7684 setText() \u69fd\u51fd\u6570\u6267\u884c\n    connect(this, SIGNAL(mySignal(const QString &amp;)), m_label, SLOT(setText(QString)));\n}\n\nvoid TimeDialog::getTime() {\n    qDebug(\"getTime()\");\n    qDebug() &lt;&lt; \"getTime()\";\n    // \u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\n    QTime time = QTime::currentTime();\n    // \u5c06\u65f6\u95f4\u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n    QString str = time.toString(\"hh:mm:ss\");\n    // \u53d1\u5c04\u4fe1\u53f7(emit \u662f Qt \u5173\u952e\u5b57\uff0c\u6807\u8bb0\u5f53\u524d\u662f\u53d1\u5c04\u4fe1\u53f7)\n    emit mySignal(str);\n}\n</code></pre> </li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#maincpp_1","title":"<code>main.cpp</code>","text":"<pre><code>#include &lt;QApplication&gt;\n\n#include \"time_dialog.h\"\n\nint main(int argc, char* argv[]) {\n    QApplication app(argc, argv);\n    TimeDialog time;\n    time.show();\n    return QApplication::exec();\n}\n</code></pre>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%88%B6%E7%AA%97%E5%8F%A3%E3%80%81%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#_8","title":"\u6548\u679c","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E8%81%8A%E5%A4%A9%E5%AE%A4/","title":"\u3010QT\u3011\u7f51\u7edc\u6a21\u5757\u6848\u4f8b\u2014\u2014\u804a\u5929\u5ba4","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E8%81%8A%E5%A4%A9%E5%AE%A4/#_1","title":"\u6848\u4f8b\u2014\u2014\u7f51\u7edc\u804a\u5929\u5ba4","text":""},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E8%81%8A%E5%A4%A9%E5%AE%A4/#_2","title":"\u670d\u52a1\u7aef","text":"<ul> <li> <p><code>chat-room-server.pro</code></p> <pre><code>QT       += core gui network\n\ngreaterThan(QT_MAJOR_VERSION, 4): QT += widgets\n\nCONFIG += c++11\n\nSOURCES += \\\n    main.cpp \\\n    dialog.cpp\n\nHEADERS += \\\n    dialog.h\n\nFORMS += \\\n    dialog.ui\n</code></pre> </li> <li> <p><code>dialog.ui</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;ui version=\"4.0\"&gt;\n &lt;class&gt;Dialog&lt;/class&gt;\n &lt;widget class=\"QDialog\" name=\"Dialog\"&gt;\n  &lt;property name=\"geometry\"&gt;\n   &lt;rect&gt;\n    &lt;x&gt;0&lt;/x&gt;\n    &lt;y&gt;0&lt;/y&gt;\n    &lt;width&gt;526&lt;/width&gt;\n    &lt;height&gt;372&lt;/height&gt;\n   &lt;/rect&gt;\n  &lt;/property&gt;\n  &lt;property name=\"font\"&gt;\n   &lt;font&gt;\n    &lt;family&gt;Inconsolata&lt;/family&gt;\n    &lt;pointsize&gt;16&lt;/pointsize&gt;\n   &lt;/font&gt;\n  &lt;/property&gt;\n  &lt;property name=\"windowTitle\"&gt;\n   &lt;string&gt;\u804a\u5929\u5ba4\u670d\u52a1\u7aef&lt;/string&gt;\n  &lt;/property&gt;\n  &lt;layout class=\"QVBoxLayout\" name=\"verticalLayout\"&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QHBoxLayout\" name=\"horizontalLayout\"&gt;\n     &lt;item&gt;\n      &lt;spacer name=\"horizontalSpacer\"&gt;\n       &lt;property name=\"orientation\"&gt;\n        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;\n       &lt;/property&gt;\n       &lt;property name=\"sizeHint\" stdset=\"0\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;40&lt;/width&gt;\n         &lt;height&gt;20&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/spacer&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QListWidget\" name=\"listWidget\"&gt;\n       &lt;property name=\"minimumSize\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;480&lt;/width&gt;\n         &lt;height&gt;270&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n       &lt;property name=\"maximumSize\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;480&lt;/width&gt;\n         &lt;height&gt;270&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;spacer name=\"horizontalSpacer_2\"&gt;\n       &lt;property name=\"orientation\"&gt;\n        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;\n       &lt;/property&gt;\n       &lt;property name=\"sizeHint\" stdset=\"0\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;40&lt;/width&gt;\n         &lt;height&gt;20&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/spacer&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QGridLayout\" name=\"gridLayout\"&gt;\n     &lt;item row=\"0\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"portLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt; \u670d\u52a1\u5668\u7aef\u53e3\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"0\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"portEdit\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;8080&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;widget class=\"QPushButton\" name=\"createButton\"&gt;\n     &lt;property name=\"text\"&gt;\n      &lt;string&gt;\u521b\u5efa\u670d\u52a1\u5668&lt;/string&gt;\n     &lt;/property&gt;\n    &lt;/widget&gt;\n   &lt;/item&gt;\n  &lt;/layout&gt;\n &lt;/widget&gt;\n &lt;resources/&gt;\n &lt;connections/&gt;\n&lt;/ui&gt;\n</code></pre> <p></p> </li> <li> <p><code>dialog.h</code></p> <pre><code>#ifndef DIALOG_H\n#define DIALOG_H\n\n#include &lt;QDialog&gt;\n#include &lt;QTcpServer&gt;\n#include &lt;QTcpSocket&gt;\n#include &lt;QTimer&gt;\n\nQT_BEGIN_NAMESPACE\nnamespace Ui { class Dialog; }\nQT_END_NAMESPACE\n\nclass Dialog : public QDialog {\nQ_OBJECT\npublic:\n    Dialog(QWidget* parent = nullptr);\n    ~Dialog();\nprivate slots:\n    // \u521b\u5efa\u670d\u52a1\u5668\u6309\u94ae\u70b9\u51fb\u69fd\u51fd\u6570\n    void on_createButton_clicked();\n    // \u54cd\u5e94\u5ba2\u6237\u7aef\u8fde\u63a5\u8bf7\u6c42\u69fd\u51fd\u6570\n    void onNewConnection();\n    // \u63a5\u6536\u6b27\u5ba2\u6237\u7aef\u6d88\u606f\u69fd\u51fd\u6570\n    void onReadyRead();\n    // \u901a\u4fe1\u65ad\u5f00\u68c0\u67e5\u69fd\u51fd\u6570\n    void onTimeout();\nprivate:\n    // \u8f6c\u53d1\u804a\u5929\u6d88\u606f\u5230\u5176\u5b83\u5ba2\u6237\u7aef\n    void sendMessage(const QByteArray&amp; buf);\nprivate:\n    Ui::Dialog* ui;\n    QTcpServer tcpServer;\n    quint16 port;\n    QList&lt;QTcpSocket*&gt; tcpClientList;\n    QTimer timer;\n};\n\n#endif // DIALOG_H\n</code></pre> </li> <li> <p><code>dialog.cpp</code></p> <pre><code>#include \"dialog.h\"\n#include \"ui_dialog.h\"\n\nDialog::Dialog(QWidget* parent) : QDialog(parent), ui(new Ui::Dialog) {\n    ui-&gt;setupUi(this);\n    connect(&amp;tcpServer, SIGNAL(newConnection()), this, SLOT(onNewConnection()));\n    connect(&amp;timer, SIGNAL(timeout()), SLOT(onTimeout()));\n}\n\nDialog::~Dialog() {\n    delete ui;\n}\n\n// \u521b\u5efa\u670d\u52a1\u5668\u6309\u94ae\u70b9\u51fb\u69fd\u51fd\u6570\nvoid Dialog::on_createButton_clicked() {\n    port = ui-&gt;portEdit-&gt;text().toShort();\n    if (tcpServer.listen(QHostAddress::Any, port)) {\n        qDebug() &lt;&lt; \"\u521b\u5efa\u670d\u52a1\u5668\u6210\u529f\";\n        ui-&gt;createButton-&gt;setEnabled(false);\n        ui-&gt;portEdit-&gt;setEnabled(false);\n        // \u5f00\u542f\u5b9a\u65f6\u5668\n        timer.start(3000);\n    } else {\n        qDebug() &lt;&lt; \"\u521b\u5efa\u670d\u52a1\u5668\u5931\u8d25\";\n    }\n}\n\n// \u54cd\u5e94\u5ba2\u6237\u7aef\u8fde\u63a5\u8bf7\u6c42\u69fd\u51fd\u6570\nvoid Dialog::onNewConnection() {\n    // \u540e\u53bb\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u7684\u5957\u63a5\u5b57\n    QTcpSocket* tcpSocket = tcpServer.nextPendingConnection();\n    // \u4fdd\u5b58\u5957\u63a5\u5b57\u5230\u5bb9\u5668\n    tcpClientList.append(tcpSocket);\n    // \u5f53\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u6d88\u606f\u65f6\u901a\u4fe1\u5957\u63a5\u5b57\u53d1\u9001 readyRead() \u4fe1\u53f7\n    connect(tcpSocket, SIGNAL(readyRead()), this, SLOT(onReadyRead()));\n\n}\n\n// \u63a5\u6536\u6b27\u5ba2\u6237\u7aef\u6d88\u606f\u69fd\u51fd\u6570\nvoid Dialog::onReadyRead() {\n    // \u904d\u5386\u5bb9\u5668\u83b7\u53d6\u54ea\u4e2a\u5ba2\u6237\u7aef\u7ed9\u670d\u52a1\u5668\u53d1\u9001\u4e86\u6d88\u606f\n    for (int i = 0; i &lt; tcpClientList.size(); i++) {\n        // \u8fd4\u56de 0 \u8868\u793a\u6ca1\u6709\u6d88\u606f\n        if (tcpClientList.at(i)-&gt;bytesAvailable() != 0) {\n            // \u8bfb\u53d6\u6d88\u606f\n            QByteArray buf = tcpClientList.at(i)-&gt;readAll();\n            // \u663e\u793a\u6d88\u606f\n            ui-&gt;listWidget-&gt;addItem(buf);\n            ui-&gt;listWidget-&gt;scrollToBottom();\n            // \u8f6c\u53d1\u6d88\u606f\u7ed9\u6240\u6709\u5728\u7ebf\u5ba2\u6237\u7aef\n            sendMessage(buf);\n        }\n    }\n}\n\n// \u901a\u4fe1\u65ad\u5f00\u68c0\u67e5\u69fd\u51fd\u6570\nvoid Dialog::onTimeout() {\n    // \u904d\u5386\u68c0\u67e5\u5bb9\u5668\u4e2d\u4fdd\u5b58\u7684\u901a\u4fe1\u5957\u63a5\u5b57\u662f\u5426\u5df2\u7ecf\u65ad\u5f00\u8fde\u63a5\uff0c\u5982\u679c\u662f\u5219\u5220\u9664\n    for (int i = 0; i &lt; tcpClientList.size(); i++) {\n        if (tcpClientList.at(i)-&gt;state() == QAbstractSocket::UnconnectedState) {\n            tcpClientList.removeAt(i);\n            i--;\n        }\n    }\n}\n\n// \u8f6c\u53d1\u804a\u5929\u6d88\u606f\u5230\u5176\u5b83\u5ba2\u6237\u7aef\nvoid Dialog::sendMessage(const QByteArray&amp; buf) {\n    for (int i = 0; i &lt; tcpClientList.size(); i++) {\n        tcpClientList.at(i)-&gt;write(buf);\n    }\n}\n</code></pre> </li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E8%81%8A%E5%A4%A9%E5%AE%A4/#_3","title":"\u5ba2\u6237\u7aef","text":"<ul> <li> <p><code>dialog.ui</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;ui version=\"4.0\"&gt;\n &lt;class&gt;Dialog&lt;/class&gt;\n &lt;widget class=\"QDialog\" name=\"Dialog\"&gt;\n  &lt;property name=\"geometry\"&gt;\n   &lt;rect&gt;\n    &lt;x&gt;0&lt;/x&gt;\n    &lt;y&gt;0&lt;/y&gt;\n    &lt;width&gt;526&lt;/width&gt;\n    &lt;height&gt;491&lt;/height&gt;\n   &lt;/rect&gt;\n  &lt;/property&gt;\n  &lt;property name=\"font\"&gt;\n   &lt;font&gt;\n    &lt;family&gt;Inconsolata&lt;/family&gt;\n    &lt;pointsize&gt;16&lt;/pointsize&gt;\n   &lt;/font&gt;\n  &lt;/property&gt;\n  &lt;property name=\"windowTitle\"&gt;\n   &lt;string&gt;\u804a\u5929\u5ba4\u5ba2\u6237\u7aef&lt;/string&gt;\n  &lt;/property&gt;\n  &lt;layout class=\"QVBoxLayout\" name=\"verticalLayout\"&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QHBoxLayout\" name=\"horizontalLayout\"&gt;\n     &lt;item&gt;\n      &lt;spacer name=\"horizontalSpacer\"&gt;\n       &lt;property name=\"orientation\"&gt;\n        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;\n       &lt;/property&gt;\n       &lt;property name=\"sizeHint\" stdset=\"0\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;40&lt;/width&gt;\n         &lt;height&gt;20&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/spacer&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QListWidget\" name=\"listWidget\"&gt;\n       &lt;property name=\"minimumSize\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;480&lt;/width&gt;\n         &lt;height&gt;270&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n       &lt;property name=\"maximumSize\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;480&lt;/width&gt;\n         &lt;height&gt;270&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;spacer name=\"horizontalSpacer_2\"&gt;\n       &lt;property name=\"orientation\"&gt;\n        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;\n       &lt;/property&gt;\n       &lt;property name=\"sizeHint\" stdset=\"0\"&gt;\n        &lt;size&gt;\n         &lt;width&gt;40&lt;/width&gt;\n         &lt;height&gt;20&lt;/height&gt;\n        &lt;/size&gt;\n       &lt;/property&gt;\n      &lt;/spacer&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QGridLayout\" name=\"gridLayout\"&gt;\n     &lt;item row=\"0\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"hostEdit\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;127.0.0.1&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"2\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"nicknameEdit\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string/&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"2\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"nicknameLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u804a\u5929\u5ba4\u6635\u79f0\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"0\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"hostLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u670d\u52a1\u5668\u5730\u5740\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"1\" column=\"0\"&gt;\n      &lt;widget class=\"QLabel\" name=\"portLabel\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u670d\u52a1\u5668\u7aef\u53e3\uff1a&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n     &lt;item row=\"1\" column=\"1\"&gt;\n      &lt;widget class=\"QLineEdit\" name=\"portEdit\"&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;8080&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;widget class=\"QPushButton\" name=\"connectButton\"&gt;\n     &lt;property name=\"text\"&gt;\n      &lt;string&gt;\u8fde\u63a5\u670d\u52a1\u5668&lt;/string&gt;\n     &lt;/property&gt;\n    &lt;/widget&gt;\n   &lt;/item&gt;\n   &lt;item&gt;\n    &lt;layout class=\"QHBoxLayout\" name=\"horizontalLayout_2\"&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QLineEdit\" name=\"messageEdit\"/&gt;\n     &lt;/item&gt;\n     &lt;item&gt;\n      &lt;widget class=\"QPushButton\" name=\"sendButton\"&gt;\n       &lt;property name=\"enabled\"&gt;\n        &lt;bool&gt;false&lt;/bool&gt;\n       &lt;/property&gt;\n       &lt;property name=\"text\"&gt;\n        &lt;string&gt;\u53d1\u9001&lt;/string&gt;\n       &lt;/property&gt;\n      &lt;/widget&gt;\n     &lt;/item&gt;\n    &lt;/layout&gt;\n   &lt;/item&gt;\n  &lt;/layout&gt;\n &lt;/widget&gt;\n &lt;resources/&gt;\n &lt;connections/&gt;\n&lt;/ui&gt;\n</code></pre> <p></p> </li> <li> <p><code>dialog.h</code></p> <pre><code>#ifndef DIALOG_H\n#define DIALOG_H\n\n#include &lt;QDialog&gt;\n#include &lt;QTcpSocket&gt;\n#include &lt;QHostAddress&gt;\n#include &lt;QMessageBox&gt;\n\nQT_BEGIN_NAMESPACE\nnamespace Ui { class Dialog; }\nQT_END_NAMESPACE\n\nclass Dialog : public QDialog {\nQ_OBJECT\npublic:\n    Dialog(QWidget* parent = nullptr);\n    ~Dialog();\nprivate slots:\n    void on_connectButton_clicked();\n    void on_sendButton_clicked();\n    void onConnected();\n    void onDisconnected();\n    void onReadyRead();\n    // \u7f51\u7edc\u5f02\u5e38\u69fd\u51fd\u6570\n    void onErrorOccurred(QAbstractSocket::SocketError);\nprivate:\n    Ui::Dialog* ui;\n    bool alive;\n    QTcpSocket tcpSocket;\n    QHostAddress host;\n    quint16 port;\n    QString nickname;\n};\n\n#endif // DIALOG_H\n</code></pre> </li> <li> <p><code>dialog.cpp</code></p> <pre><code>#include \"dialog.h\"\n#include \"ui_dialog.h\"\n\nDialog::Dialog(QWidget* parent) : QDialog(parent), ui(new Ui::Dialog) {\n    ui-&gt;setupUi(this);\n    alive = false;\n    connect(&amp;tcpSocket, SIGNAL(connected()), this, SLOT(onConnected()));\n    connect(&amp;tcpSocket, SIGNAL(disconnected()), this, SLOT(onDisconnected()));\n    connect(&amp;tcpSocket, SIGNAL(readyRead()), this, SLOT(onReadyRead()));\n    connect(&amp;tcpSocket, SIGNAL(errorOccurred(QAbstractSocket::SocketError)), this, SLOT(onErrorOccurred(QAbstractSocket::SocketError)));\n}\n\nDialog::~Dialog() {\n    delete ui;\n}\n\nvoid Dialog::on_connectButton_clicked() {\n    // \u5982\u679c\u5f53\u524d\u662f\u79bb\u7ebf\u72b6\u6001\uff0c\u5219\u5efa\u7acb\u548c\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5426\u5219\u7aef\u53e3\u548c\u670d\u52a1\u5668\u7684\u8fde\u63a5\n    if (!alive) {\n        host.setAddress(ui-&gt;hostEdit-&gt;text());\n        port = ui-&gt;portEdit-&gt;text().toShort();\n        nickname = ui-&gt;nicknameEdit-&gt;text();\n        tcpSocket.connectToHost(host, port);\n    } else {\n        QString message = \"\u7cfb\u7edf: \" + nickname + \"\u79bb\u5f00\u4e86\u804a\u5929\u5ba4\";\n        tcpSocket.write(message.toUtf8());\n        tcpSocket.disconnectFromHost();\n    }\n}\n\nvoid Dialog::on_sendButton_clicked() {\n    QString message = ui-&gt;messageEdit-&gt;text();\n    if (message == \"\") {\n        return;\n    }\n    message = nickname + \": \" + message;\n    tcpSocket.write(message.toUtf8());\n    ui-&gt;messageEdit-&gt;clear();\n}\n\nvoid Dialog::onConnected() {\n    alive = true;\n    ui-&gt;sendButton-&gt;setEnabled(true);\n    ui-&gt;hostEdit-&gt;setEnabled(false);\n    ui-&gt;portEdit-&gt;setEnabled(false);\n    ui-&gt;nicknameEdit-&gt;setEnabled(false);\n    ui-&gt;connectButton-&gt;setText(\"\u79bb\u5f00\u804a\u5929\u5ba4\");\n    // \u53d1\u9001\u7cfb\u7edf\u63d0\u793a\u6d88\u606f\n    QString message = \"\u7cfb\u7edf: \" + nickname + \"\u8fdb\u5165\u4e86\u804a\u5929\u5ba4\";\n    tcpSocket.write(message.toUtf8());\n}\n\nvoid Dialog::onDisconnected() {\n    alive = false;\n    ui-&gt;sendButton-&gt;setEnabled(false);\n    ui-&gt;hostEdit-&gt;setEnabled(true);\n    ui-&gt;portEdit-&gt;setEnabled(true);\n    ui-&gt;nicknameEdit-&gt;setEnabled(true);\n    ui-&gt;connectButton-&gt;setText(\"\u8fde\u63a5\u670d\u52a1\u5668\");\n}\n\nvoid Dialog::onReadyRead() {\n    if (tcpSocket.bytesAvailable() != 0) {\n        QByteArray buf = tcpSocket.readAll();\n        ui-&gt;listWidget-&gt;addItem(buf);\n        ui-&gt;listWidget-&gt;scrollToBottom();\n    }\n}\n\n// \u7f51\u7edc\u5f02\u5e38\u69fd\u51fd\u6570\nvoid Dialog::onErrorOccurred(QAbstractSocket::SocketError) {\n    QMessageBox::critical(this, \"Error\", tcpSocket.errorString());\n}\n</code></pre> </li> </ul>"},{"location":"frontend/qt/%E3%80%90QT%E3%80%91%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E8%81%8A%E5%A4%A9%E5%AE%A4/#_4","title":"\u6548\u679c","text":""},{"location":"frontend/qt/__demo__/ernie/","title":"Index","text":"<pre><code>export QT_HOME=/opt/qt/6.2.2/macos\nexport PATH=$PATH:$QT_HOME/bin:$QT_HOME/libexec\n</code></pre> <pre><code>uic dialog.ui -o ui_dialog.h\n</code></pre> <pre><code>qmake\n</code></pre>"},{"location":"frontend/qt/__demo__/ftp-client-5_15/","title":"Index","text":""},{"location":"frontend/qt/__demo__/ftp-client-5_15/#_1","title":"\u7248\u672c","text":"<ul> <li>qt-5.15.2</li> </ul>"},{"location":"frontend/qt/__demo__/ftp-client-5_15/#_2","title":"\u542f\u52a8","text":"<pre><code>uic dialog.ui -o ui_dialog.h\n</code></pre>"},{"location":"frontend/qt/__demo__/ftp-client-5_15/#vsftp","title":"VsFTP \u914d\u7f6e","text":"<ul> <li>https://wiki.ubuntu.org.cn/Vsftpd</li> </ul>"},{"location":"frontend/uniapp/","title":"uniapp","text":""},{"location":"frontend/uniapp/#_1","title":"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u767b\u5f55","text":"<pre><code>&lt;template&gt;\n  &lt;view&gt;\n    &lt;image :src=\"state.userInfo.avatarUrl\"&gt;&lt;/image&gt;\n  &lt;/view&gt;\n  &lt;view&gt; nickName = {{ state.userInfo.nickName }}&lt;/view&gt;\n  &lt;view&gt; openId = {{ state.userInfo.openId }}&lt;/view&gt;\n  &lt;view&gt; sessionKey = {{ state.userInfo.sessionKey }}&lt;/view&gt;\n  &lt;view&gt;\n    &lt;button @click=\"handleClick\"&gt;\u767b\u5f55&lt;/button&gt;\n  &lt;/view&gt;\n&lt;/template&gt;\n\n&lt;script lang=\"ts\" setup&gt;\nimport { reactive } from 'vue'\n\nconst state = reactive({ userInfo: { avatarUrl: '', nickName: '', openId: '', sessionKey: '' } })\n\nconst handleClick = () =&gt; {\n  uni.getUserProfile({\n    desc: '\u83b7\u53d6\u7528\u6237\u4fe1\u606f',\n    success: result =&gt; {\n      state.userInfo.avatarUrl = result.userInfo.avatarUrl\n      state.userInfo.nickName = result.userInfo.nickName\n      uni.login({\n        success: result =&gt; {\n          const appid = ''\n          const secret = ''\n          uni.request({\n            url: `https://api.weixin.qq.com/sns/jscode2session?appid=${appid}&amp;secret=${secret}&amp;js_code=${result.code}&amp;grant_type=authorization_code`,\n            method: 'GET',\n            success: result =&gt; {\n              state.userInfo.openId = (result.data as any).openid\n              state.userInfo.sessionKey = (result.data as any).session_key\n            }\n          })\n        }\n      })\n    }\n  })\n}\n&lt;/script&gt;\n</code></pre>"},{"location":"frontend/vue/","title":"Vue","text":""},{"location":"frontend/vue/#_1","title":"\u6536\u85cf","text":""},{"location":"frontend/vue/#vue_1","title":"Vue \u6838\u5fc3\u4e4b\u6570\u636e\u52ab\u6301","text":""},{"location":"hardware/","title":"\u786c\u4ef6","text":""},{"location":"hardware/ibmc/","title":"iBMC","text":""},{"location":"hardware/ibmc/#_1","title":"\u547d\u4ee4\u884c","text":""},{"location":"hardware/ibmc/#_2","title":"\u98ce\u6247\u547d\u4ee4","text":"<p>https://support.huawei.com/enterprise/zh/doc/EDOC1100048790/6e4f76ed</p> <pre><code># \u67e5\u8be2\u98ce\u6247\u5de5\u4f5c\u72b6\u6001\nipmcget -d faninfo\n\n# \u8bbe\u7f6e\u98ce\u6247\u8fd0\u884c\u6a21\u5f0f\nipmcset -d fanmode -v 1 0\n\n# \u8bbe\u7f6e\u98ce\u6247\u8fd0\u884c\u901f\u5ea6\nipmcset -d fanlevel -v 20\n</code></pre>"},{"location":"lang/","title":"Lang","text":""},{"location":"lang/cpp/","title":"C++","text":""},{"location":"lang/cpp/#_1","title":"\u6536\u85cf","text":""},{"location":"lang/cpp/#c-primer-plus","title":"C++ Primer Plus","text":""},{"location":"lang/cpp/#map-filter-reduce-explained-with-emoji","title":"<code>map</code> <code>filter</code> <code>reduce</code> explained with emoji","text":""},{"location":"lang/cpp/#clangformat","title":"ClangFormat \u914d\u7f6e\u5206\u4eab\uff08\u51e0\u4e4e\u8c03\u4e86\u6240\u6709\u9009\u9879\uff09","text":""},{"location":"lang/cpp/#c_1","title":"\u73b0\u4ee3C++\u51fd\u6570\u5f0f\u7f16\u7a0b","text":""},{"location":"lang/cpp/C%20%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E5%BF%85%E5%A4%87%E7%9A%84%2018%20%E4%B8%AA%E7%BB%8F%E5%85%B8%E7%A8%8B%E5%BA%8F/","title":"C \u8bed\u8a00\u5165\u95e8\u5fc5\u5907\u7684 18 \u4e2a\u7ecf\u5178\u7a0b\u5e8f","text":"<ol> <li> <p>\u8f93\u51fa 9*9 \u4e58\u6cd5\u53e3\u8bc0\u3002\u5171 9 \u884c 9 \u5217\uff0ci \u63a7\u5236\u884c\uff0cj \u63a7\u5236\u5217\u3002</p> <pre><code>#include \"stdio.h\"\nint main() {\n    for (int i = 1; i &lt; 10; i++) {\n        for (int j = 1; j &lt; 10; j++) {\n            printf(\"%d*%d=%-3d\", i, j, i * j);\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u53e4\u5178\u95ee\u9898\uff1a\u6709\u4e00\u5bf9\u5154\u5b50\uff0c\u4ece\u51fa\u751f\u540e\u7b2c 3 \u4e2a\u6708\u8d77\u6bcf\u4e2a\u6708\u90fd\u751f\u4e00\u5bf9\u5154\u5b50\uff0c\u5c0f\u5154\u5b50\u957f\u5230\u7b2c\u4e09\u4e2a\u6708\u540e\u6bcf\u4e2a\u6708\u53c8\u751f\u4e00\u5bf9\u5154\u5b50\uff0c\u5047\u5982\u5154\u5b50\u90fd\u4e0d\u6b7b\uff0c\u95ee\u6bcf\u4e2a\u6708\u5154\u5b50\u603b\u6570\u4e3a\u591a\u5c11\uff1f\u5154\u5b50\u7684\u89c4\u5f8b\u4e3a\u6570\u5217 <code>1,1,2,3,5,8,13,21...</code></p> <pre><code>#include \"stdio.h\"\nint main() {\n    long f1 = 1;\n    long f2 = 1;\n    for (int i = 1; i &lt;= 20; i++) {\n        printf(\"%12ld %12ld\", f1, f2);\n        if (i % 2 == 0) {\n            printf(\"\\n\");\n        }\n        f1 = f1 + f2;\n        f2 = f1 + f2;\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5224\u65ad 101-200 \u4e4b\u95f4\u6709\u591a\u5c11\u4e2a\u7d20\u6570\uff0c\u5e76\u8f93\u51fa\u6240\u6709\u7d20\u6570\u53ca\u7d20\u6570\u7684\u4e2a\u6570\u3002</p> <p>\u7a0b\u5e8f\u5206\u6790\uff1a\u5224\u8bfb\u7d20\u6570\u7684\u65b9\u6cd5\uff1a\u7528\u4e00\u4e2a\u6570\u5206\u522b\u53bb\u9664 2 \u5230\u8fd9\u4e2a\u6570\u7684\u7b97\u672f\u5e73\u65b9\u6839\uff0c\u5982\u679c\u80fd\u88ab\u6574\u9664\uff0c\u5219\u8bc1\u660e\u6b64\u6570\u4e0d\u662f\u7d20\u6570\uff0c\u53cd\u4e4b\u662f\u7d20\u6570\u3002</p> <pre><code>#include \"math.h\"\n#include \"stdio.h\"\nconst int MIN = 101;\nconst int MAX = 200;\nint main() {\n    int count = 0;\n    for (int i = MIN; i &lt;= MAX; i += 2) {\n        int j;\n        for (j = 2; j &lt;= sqrt(i); j++) {\n            if (i % j == 0) {\n                break;\n            }\n        }\n        if (j &gt; sqrt(i)) {\n            printf(\"%d \", i);\n            count++;\n        }\n    }\n    printf(\"\\ncount=%d\\n\", count);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u4e00\u4e2a\u6570\u5982\u679c\u6070\u597d\u7b49\u4e8e\u5b83\u7684\u56e0\u5b50\u4e4b\u548c\uff0c\u8fd9\u4e2a\u6570\u5c31\u79f0\u4e3a\u201c\u5b8c\u6570\u201d\u3002\u5047\u5982 6=1+2+3\u3002\u7f16\u7a0b\u627e\u51fa 1000 \u4ee5\u5185\u7684\u6240\u6709\u5b8c\u6570\u3002</p> <pre><code>#include \"stdio.h\"\nconst int MIN = 3;\nconst int MAX = 1000;\nint main() {\n    int a[1024];\n    for (int i = MIN; i &lt; MAX; i++) {\n        int sum = 0;\n        int j = 1;\n        int count = 0;\n        while (j &lt; i) {\n            if (i % j == 0) {\n                sum = sum + j;\n                a[count] = j;\n                count++;\n            }\n            j++;\n        }\n        if (sum == i) {\n            printf(\"%d=1\", i);\n            for (int k = 0; k &lt; count; k++) {\n                printf(\"+%d\", a[k]);\n            }\n            printf(\"\\n\");\n        }\n        count = 0;\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u4e0b\u9762\u7a0b\u5e8f\u7684\u529f\u80fd\u662f\u5c06\u4e00\u4e2a 4*4 \u7684\u6570\u7ec4\u8fdb\u884c\u9006\u65f6\u9488\u65cb\u8f6c 90 \u5ea6\u540e\u8f93\u51fa\uff0c\u8981\u6c42\u539f\u59cb\u6570\u7ec4\u7684\u6570\u636e\u968f\u673a\u8f93\u5165\uff0c\u65b0\u6570\u7ec4\u4ee5 4 \u884c 4 \u5217\u7684\u65b9\u5f0f\u8f93\u51fa\u3002</p> <pre><code>#include \"stdio.h\"\nconst int N = 4;\nint main() {\n    int src[N][N];\n    int dst[N][N];\n    printf(\"src:\\n\");\n    for (int i = 0; i &lt; N; i++) {\n        for (int j = 0; j &lt; N; j++) {\n            scanf(\"%d\", &amp;src[i][j]);\n            dst[N - 1 - j][i] = src[i][j];\n        }\n    }\n    printf(\"dst:\\n\");\n    for (int i = 0; i &lt; N; i++) {\n        for (int j = 0; j &lt; N; j++) {\n            printf(\"%6d\", dst[i][j]);\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u7f16\u7a0b\u6253\u5370\u76f4\u89d2\u6768\u8f89\u4e09\u89d2\u5f62</p> <pre><code>#include \"stdio.h\"\nconst int N = 6;\nint main() {\n    int a[N][N];\n    for (int i = 0; i &lt; N; i++) {\n        a[i][0] = 1;\n        a[i][i] = 1;\n    }\n    for (int i = 2; i &lt; N; i++) {\n        for (int j = 1; j &lt;= i - 1; j++) {\n            a[i][j] = a[i - 1][j] + a[i - 1][j - 1];\n        }\n    }\n    for (int i = 0; i &lt; N; i++) {\n        for (int j = 0; j &lt;= i; j++) {\n            printf(\"%4d\", a[i][j]);\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u901a\u8fc7\u952e\u76d8\u8f93\u5165 3 \u540d\u5b66\u751f 4 \u95e8\u8bfe\u7a0b\u7684\u6210\u7ee9\uff0c\u5206\u522b\u6c42\u6bcf\u4e2a\u5b66\u751f\u7684\u5e73\u5747\u6210\u7ee9\u548c\u6bcf\u95e8\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9\u3002</p> <p>\u8981\u6c42\u6240\u6709\u6210\u7ee9\u653e\u5165\u4e00\u4e2a 4 \u884c 5 \u5217\u7684\u6570\u7ec4\u4e2d\uff0c\u8f93\u5165\u65f6\u540c\u4e00\u4eba\u6570\u636e\u95f4\u7528\u7a7a\u683c\uff0c\u4e0d\u540c\u4eba\u7528\u56de\u8f66\uff0c\u5176\u4e2d\u6700\u540e\u4e00\u5217\u548c\u6700\u540e\u4e00\u884c\u5206\u522b\u653e\u6bcf\u4e2a\u5b66\u751f\u7684\u5e73\u5747\u6210\u7ee9\u3001\u6bcf\u95e8\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9\u53ca\u73ed\u7ea7\u603b\u5e73\u5747\u5206\u3002</p> <pre><code>#include \"stdio.h\"\nconst int STU_COUNT = 3;\nconst int COURSE_COUNT = 4;\nint main() {\n    float a[STU_COUNT + 1][COURSE_COUNT + 1];\n    for (int i = 0; i &lt; STU_COUNT; i++) {\n        for (int j = 0; j &lt; COURSE_COUNT; j++) {\n            scanf(\"%f\", &amp;a[i][j]);\n        }\n    }\n    for (int i = 0; i &lt; STU_COUNT; i++) {\n        float sum = 0;\n        for (int j = 0; j &lt; COURSE_COUNT; j++) {\n            sum += a[i][j];\n            a[i][COURSE_COUNT] = sum / COURSE_COUNT;\n        }\n    }\n    for (int j = 0; j &lt; COURSE_COUNT + 1; j++) {\n        float sum = 0;\n        for (int i = 0; i &lt; STU_COUNT; i++) {\n            sum += a[i][j];\n            a[STU_COUNT][j] = sum / STU_COUNT;\n        }\n    }\n    for (int i = 0; i &lt; STU_COUNT + 1; i++) {\n        for (int j = 0; j &lt; COURSE_COUNT + 1; j++) {\n            printf(\"%6.2f\", a[i][j]);\n        }\n        printf(\"\\n\");\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5b9e\u73b0\u5c06\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u53cd\u5e8f\u8f93\u51fa\uff0c\u5982\u8f93\u5165 <code>windows</code>\u00a0\u00a0\u00a0\u00a0 \u8f93\u51fa <code>swodniw</code>\u3002</p> <pre><code>#include \"stdio.h\"\n#include \"string.h\"\nint main() {\n    char s[1024];\n    scanf(\"%s\", s);\n    int len = strlen(s);\n    for (int i = 0, j = len - 1; i &lt; len / 2; i++, j--) {\n        char temp = s[i];\n        s[i] = s[j];\n        s[j] = temp;\n    }\n    printf(\"%s\\n\", s);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u4ece\u5b57\u7b26\u6570\u7ec4 <code>s</code> \u4e2d\u5220\u9664\u5b58\u653e\u5728 <code>c</code> \u4e2d\u7684\u5b57\u7b26\u3002</p> <pre><code>#include \"stdio.h\"\nint main() {\n    char s[1024];\n    printf(\"s=\");\n    gets(s);\n    printf(\"c=\");\n    char c = getchar();\n    int k = 0;\n    for (int i = 0; s[i] != '\\0'; i++) {\n        if (s[i] != c) {\n            s[k++] = s[i];\n        }\n    }\n    s[k] = '\\0';\n    printf(\"s=%s\\n\", s);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u7f16\u5199\u4e00\u4e2a <code>void sort(int *x, int n)</code> \u5b9e\u73b0\u5c06 <code>x</code> \u6570\u7ec4\u4e2d\u7684 <code>n</code> \u4e2a\u6570\u636e\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002</p> <p><code>n</code> \u53ca\u6570\u7ec4\u5143\u7d20\u5728\u4e3b\u51fd\u6570\u4e2d\u8f93\u5165\u3002\u5c06\u7ed3\u679c\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u5e76\u8f93\u51fa\u5230\u6587\u4ef6 <code>p9_1.out</code> \u4e2d\u3002</p> <pre><code>#include \"stdio.h\"\nvoid sort(int* x, int n) {\n    for (int i = 0; i &lt; n - 1; i++) {\n        int k = i;\n        for (int j = i + 1; j &lt; n; j++) {\n            if (x[j] &gt; x[k]) {\n                k = j;\n            }\n        }\n        if (k != i) {\n            int temp = x[i];\n            x[i] = x[k];\n            x[k] = temp;\n        }\n    }\n}\nconst int N = 10;\nint main() {\n    FILE* fp = fopen(\"pg_1.out\", \"w\");\n    int a[N];\n    for (int i = 0; i &lt; N; i++) {\n        scanf(\"%d\", &amp;a[i]);\n    }\n    sort(a, N);\n    for (int i = 0; i &lt; N; i++) {\n        printf(\"%d \", a[i]);\n        fprintf(fp, \"%d \", a[i]);\n    }\n    fclose(fp);\n    printf(\"\\n\");\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5df2\u77e5\u6570\u7ec4 <code>a</code> \u4e2d\u7684\u5143\u7d20\u5df2\u7ecf\u6309\u7531\u5c0f\u5230\u5927\u987a\u5e8f\u6392\u5217\uff0c\u4ee5\u4e0b\u7a0b\u5e8f\u7684\u529f\u80fd\u662f\u5c06\u8f93\u5165\u7684\u4e00\u4e2a\u6570\u63d2\u5165\u6570\u7ec4 <code>a</code> \u4e2d\uff0c\u63d2\u5165\u540e\uff0c\u6570\u7ec4 <code>a</code> \u7684\u5143\u7d20\u4ecd\u7136\u7531\u5c0f\u5230\u5927\u987a\u5e8f\u6392\u5217\u3002</p> <pre><code>#include \"stdio.h\"\nint main() {\n    int a[] = {0, 12, 17, 20, 25, 28, 30};\n    int len = sizeof(a) / sizeof(a[0]);\n    int x;\n    printf(\"x=\");\n    scanf(\"%d\", &amp;x);\n    a[0] = x;\n    int i = len - 1;\n    while (a[i] &gt; x) {\n        a[i + 1] = a[i];\n        i--;\n    }\n    a[i + 1] = x;\n    len++;\n    for (int j = 1; j &lt; len; j++) {\n        printf(\"%8d \", a[j]);\n    }\n    printf(\"\\n\");\n    return 0;\n}\n</code></pre> </li> <li> <p>\u7f16\u5199\u51fd\u6570 <code>replace(char* s, char c1, char c2)</code> \u5b9e\u73b0\u5c06 <code>s</code> \u6240\u6307\u7684\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u5b57\u7b26 <code>c1</code> \u00a0\u00a0 \u7528 \u00a0\u00a0<code>c2</code> \u66ff\u6362\u3002</p> <p>\u5b57\u7b26\u4e32\u3001\u5b57\u7b26 <code>c1</code> \u548c <code>c2</code> \u5747\u5728\u4e3b\u51fd\u6570\u4e2d\u8f93\u5165\uff0c\u5c06\u539f\u59cb\u5b57\u7b26\u4e32\u548c\u66ff\u6362\u540e\u7684\u5b57\u7b26\u4e32\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\uff0c\u5e76\u8f93\u51fa\u5230\u6587\u4ef6 <code>p10_2.out</code> \u4e2d\u3002</p> <pre><code>#include \"stdio.h\"\nvoid replace(char* s, char c1, char c2) {\n    while (*s != '\\0') {\n        if (*s == c1) {\n            *s = c2;\n        }\n        s++;\n    }\n}\nint main() {\n    char s[100];\n    char c1;\n    char c2;\n    scanf(\"%s %c %c\", s, &amp;c1, &amp;c2);\n    replace(s, c1, c2);\n    FILE* fp = fopen(\"p10_2.out\", \"w\");\n    printf(\"%s\\n\", s);\n    fprintf(fp, \"%s\\n\", s);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5728\u4e00\u4e2a\u5b57\u7b26 <code>s1</code> \u4e2d\u67e5\u627e\u4e00\u5b57\u4e32 <code>s2</code>\uff0c\u82e5\u5b58\u5728\u5219\u8fd4\u56de\u5b57\u4e32\u5728\u4e3b\u4e32\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de <code>-1</code>\u3002</p> <pre><code>#include \"stdio.h\"\n#include \"string.h\"\nint search(char s1[], char s2[]) {\n    int len = strlen(s2);\n    int i = 0;\n    while (s1[i] != '\\0') {\n        int j;\n        for (j = 0; j &lt; len; j++) {\n            if (s1[i + j] != s2[j]) {\n                break;\n            }\n        }\n        if (j &gt;= len) {\n            return i;\n        } else {\n            i++;\n        }\n    }\n    return -1;\n}\nint main() {\n    char s1[] = \"this is\";\n    char s2[] = \"is\";\n    printf(\"%d\\n\", search(s1, s2));\n    return 0;\n}\n</code></pre> </li> <li> <p>\u7528\u6307\u9488\u53d8\u91cf\u8f93\u51fa\u7ed3\u6784\u4f53\u6570\u7ec4\u5143\u7d20\u3002</p> <pre><code>#include \"stdio.h\"\nstruct student {\n    int num;\n    char* name;\n    char sex;\n    int age;\n};\nint main() {\n    struct student stu[] = {\n        {1001, \"lihua\",    'F', 18},\n        {1002, \"linxing\",  'M', 19},\n        {1003, \"huangke\",  'F', 19},\n        {1004, \"fengshou\", 'F', 19},\n        {1005, \"Wangming\", 'M', 18}\n    };\n    int len = sizeof(stu) / sizeof(stu[0]);\n    for (struct student* p = stu; p &lt; stu + len; p++) {\n        printf(\"%-10d %-10s %-10c %-10d\\n\", p-&gt;num, p-&gt;name, p-&gt;sex, p-&gt;age);\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5efa\u7acb\u4e00\u4e2a\u6709\u4e09\u4e2a\u8282\u70b9\u7684\u7b80\u5355\u94fe\u8868\u3002</p> <pre><code>#include \"stdio.h\"\nstruct student {\n    int num;\n    char* name;\n    char sex;\n    int age;\n    struct student* next;\n};\nint main() {\n    struct student a = {1001, \"lihua\",   'F', 18};\n    struct student b = {1002, \"linxing\", 'M', 19};\n    struct student c = {1003, \"huangke\", 'F', 19};\n    struct student* head = &amp;a;\n    a.next = &amp;b;\n    b.next = &amp;c;\n    c.next = NULL;\n    struct student* p = head;\n    while (p != NULL) {\n        printf(\"%-10d %-10s %-10c %-10d\\n\", p-&gt;num, p-&gt;name, p-&gt;sex, p-&gt;age);\n        p = p-&gt;next;\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u8f93\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5224\u65ad\u5176\u662f\u5426\u4e3a\u56de\u6587\u3002</p> <p>\u56de\u6587\u5b57\u7b26\u4e32\u662f\u6307\u4ece\u5de6\u5230\u53f3\u8bfb\u548c\u4ece\u53f3\u5230\u5de6\u8bfb\u5b8c\u5168\u76f8\u540c\u7684\u5b57\u7b26\u4e32\u3002</p> <pre><code>#include \"stdio.h\"\n#include \"string.h\"\nint main() {\n    char s[100];\n    scanf(\"%s\", s);\n    int len = strlen(s);\n    int i;\n    int j;\n    for (i = 0, j = len - 1; i &lt; j; i++, j--) {\n        if (s[i] != s[j]) {\n            break;\n        }\n    }\n    if (i &gt;= j) {\n        printf(\"true\\n\");\n    } else {\n        printf(\"false\\n\");\n    }\n    return 0;\n}\n</code></pre> </li> <li> <p>\u5192\u6ce1\u6392\u5e8f\uff0c\u4ece\u5c0f\u5230\u5927\uff0c\u6392\u5e8f\u540e\u7ed3\u679c\u8f93\u51fa\u5230\u5c4f\u5e55\u53ca\u6587\u4ef6 <code>myf2.out</code>\u3002</p> <pre><code>#include \"stdio.h\"\n#include \"string.h\"\nvoid sort(int a[], int n) {\n    for (int i = 0; i &lt; n; i++) {\n        for (int j = 0; j &lt; i; j++) {\n            if (a[j] &gt; a[j + 1]) {\n                int temp = a[j];\n                a[j] = a[j + 1];\n                a[j + 1] = temp;\n            }\n        }\n    }\n}\nint main() {\n    int a[] = {12, 45, 7, 8, 96, 4, 10, 48, 2, 46};\n    int len = sizeof(a) / sizeof(a[0]);\n    sort(a, len);\n    FILE* fp = fopen(\"myf2.out\", \"w\");\n    for (int i = 0; i &lt; len; i++) {\n        printf(\"%-4d\", a[i]);\n        fprintf(fp, \"%-4d\", a[i]);\n    }\n    printf(\"\\n\");\n    fclose(fp);\n    return 0;\n}\n</code></pre> </li> <li> <p>\u7f16\u5199\u51fd\u6570 <code>count_pi</code>\uff0c\u5229\u7528\u516c\u5f0f\u8ba1\u7b97 <code>pi</code> \u7684 \u8fd1\u4f3c\u503c\uff0c\u5f53\u67d0\u4e00\u9879\u7684\u503c\u5c0f\u4e8e 10<sup>-5</sup> \u65f6\uff0c\u8ba4\u4e3a\u8fbe\u5230\u7cbe\u5ea6\u8981\u6c42\u3002</p> <p>\u5c06\u7ed3\u679c\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u5e76\u8f93\u51fa\u5230\u6587\u4ef6 <code>p7_3.out</code> \u4e2d\u3002</p> <pre><code>#include \"stdio.h\"\n#include \"string.h\"\ndouble count_pi(double eps) {\n    int m = 1;\n    double temp = 1.0;\n    double s = 0;\n    while (temp &gt;= eps) {\n        s += temp;\n        temp = temp * m / (2 * m + 1);\n        m++;\n    }\n    return 2 * s;\n}\nint main() {\n    double pi = count_pi(1e-5);\n    FILE* fp = fopen(\"myf2.out\", \"w\");\n    printf(\"%lf\\n\", pi);\n    fprintf(fp, \"%lf\\n\", pi);\n    fclose(fp);\n    return 0;\n}\n</code></pre> </li> </ol>"},{"location":"lang/go/","title":"Go","text":""},{"location":"lang/go/#g","title":"\u7248\u672c\u7ba1\u7406\u5de5\u5177 <code>g</code>","text":"<p>https://github.com/voidint/g</p> <pre><code>export G_MIRROR=https://golang.google.cn/dl\ng update\ng ls-remote stable\ng install 1.20.2\ng use 1.20.2\n</code></pre>"},{"location":"lang/java/","title":"Java","text":""},{"location":"lang/java/#_1","title":"\u6536\u85cf","text":""},{"location":"lang/java/#g1-zgc","title":"\u5783\u573e\u6536\u96c6\u5668 G1 \u548c ZGC \u8be6\u89e3","text":""},{"location":"lang/java/#java-6-stream","title":"\u6055\u6211\u76f4\u8a00\u4f60\u53ef\u80fd\u771f\u7684\u4e0d\u4f1a java \u7b2c 6 \u7bc7\uff1aStream \u6027\u80fd\u5dee\uff1f\u4e0d\u8981\u4eba\u4e91\u4ea6\u4e91","text":""},{"location":"lang/java/#jvm-java","title":"JVM \u5b57\u8282\u7801\u6307\u4ee4\u624b\u518c - \u67e5\u770b Java \u5b57\u8282\u7801","text":""},{"location":"lang/java/#list","title":"List \u96c6\u5408\u5206\u9875\u5de5\u5177\u7c7b","text":""},{"location":"lang/java/#hashmap","title":"\u5e26\u4f60\u624b\u5199 HashMap","text":""},{"location":"lang/java/#hashmap_1","title":"\u5bf9 HashMap \u7684\u601d\u8003\u53ca\u624b\u5199\u5b9e\u73b0","text":""},{"location":"lang/java/#jni-jna-java","title":"JNI \u7684\u66ff\u4ee3\u8005\u2014\u4f7f\u7528 JNA \u8bbf\u95ee Java \u5916\u90e8\u529f\u80fd\u63a5\u53e3","text":""},{"location":"lang/java/EasyExcel%20%E5%AF%BC%E5%87%BA/","title":"EasyExcel \u5bfc\u51fa","text":""},{"location":"lang/java/EasyExcel%20%E5%AF%BC%E5%87%BA/#_1","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n    &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;\n    &lt;version&gt;3.2.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"lang/java/EasyExcel%20%E5%AF%BC%E5%87%BA/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code>import com.alibaba.excel.EasyExcel;\nimport com.alibaba.excel.ExcelWriter;\nimport com.alibaba.excel.annotation.ExcelProperty;\nimport com.alibaba.excel.write.metadata.WriteSheet;\nimport lombok.AllArgsConstructor;\nimport lombok.Cleanup;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport java.util.List;\n\npublic class App {\n    public static void main(String[] args) {\n        WriteSheet sheet1 = EasyExcel.writerSheet(\"sheet1\").head(User.class).build();\n        List&lt;User&gt; sheet1Data = List.of(\n            new User(\"a1\", \"b1\", \"c1\"),\n            new User(\"a2\", \"b2\", \"c2\"),\n            new User(\"a3\", \"b3\", \"c3\")\n        );\n\n        WriteSheet sheet2 = EasyExcel.writerSheet(\"sheet2\").head(Role.class).build();\n        List&lt;Role&gt; sheet2Data = List.of(\n            new Role(\"x1\", \"y1\"),\n            new Role(\"x2\", \"y2\"),\n            new Role(\"x3\", \"y3\")\n        );\n\n        @Cleanup ExcelWriter excelWriter = EasyExcel.write(\"a.xlsx\").build();\n        excelWriter\n            .write(() -&gt; sheet1Data, sheet1)\n            .write(() -&gt; sheet2Data, sheet2);\n    }\n\n    @Data\n    @NoArgsConstructor\n    @AllArgsConstructor\n    public static class User {\n        @ExcelProperty(value = \"\u5217\u4e00\")\n        private String col1;\n        @ExcelProperty(value = \"\u5217\u4e8c\")\n        private String col2;\n        @ExcelProperty(value = \"\u5217\u4e09\")\n        private String col3;\n    }\n\n    @Data\n    @NoArgsConstructor\n    @AllArgsConstructor\n    public static class Role {\n        @ExcelProperty(value = \"\u5b57\u6bb5\u4e00\")\n        private String field1;\n        @ExcelProperty(value = \"\u5b57\u6bb5\u4e8c\")\n        private String field2;\n    }\n}\n</code></pre>"},{"location":"lang/java/%E5%8A%A8%E6%80%81%E5%8E%BB%E9%87%8D/","title":"\u52a8\u6001\u53bb\u91cd","text":""},{"location":"lang/java/%E5%8A%A8%E6%80%81%E5%8E%BB%E9%87%8D/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code>import java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.stream.Collectors;\n\npublic class App {\n    public static void main(String[] args) {\n        // \u67e5\u8be2\u6240\u9700\u5217\n        List&lt;String&gt; fields = List.of(\"col_1\", \"col_2\");\n\n        // \u67e5\u8be2\u6240\u9700\u6570\u636e\n        List&lt;Map&lt;String, String&gt;&gt; records = List.of(\n            Map.of(\"col_1\", \"\u5f20\u4e09\", \"col_2\", \"\u7f57\u7fd4\", \"col_3\", \"1\", \"col_4\", \"A\"),\n            Map.of(\"col_1\", \"\u5f20\u4e09\", \"col_2\", \"\u7f57\u7fd4\", \"col_3\", \"2\", \"col_4\", \"B\"),\n            Map.of(\"col_1\", \"\u5f20\u4e09\", \"col_2\", \"\u7f57\u7fd4\", \"col_3\", \"3\", \"col_4\", \"C\")\n        );\n\n        // \u52a8\u6001\u53bb\u91cd\n        List&lt;Map&lt;String, String&gt;&gt; result = records.stream().map(record -&gt; {\n            Map&lt;String, String&gt; newRecord = new HashMap&lt;&gt;();\n            record.forEach((k, v) -&gt; {\n                if (fields.contains(k)) {\n                    newRecord.put(k, v);\n                }\n            });\n            return newRecord;\n        }).distinct().collect(Collectors.toList());\n\n        System.out.println(result);\n    }\n}\n</code></pre>"},{"location":"lang/java/%E5%8E%9F%E7%94%9F%20POI%20Excel%20%E5%A4%9A%20Sheet%20%E9%A1%B5%E5%AF%BC%E5%87%BA/","title":"\u539f\u751f POI Excel \u591a Sheet \u9875\u5bfc\u51fa","text":""},{"location":"lang/java/%E5%8E%9F%E7%94%9F%20POI%20Excel%20%E5%A4%9A%20Sheet%20%E9%A1%B5%E5%AF%BC%E5%87%BA/#_1","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;\n    &lt;artifactId&gt;poi&lt;/artifactId&gt;\n    &lt;version&gt;4.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;fr.opensagres.xdocreport&lt;/groupId&gt;\n    &lt;artifactId&gt;xdocreport&lt;/artifactId&gt;\n    &lt;version&gt;2.0.2&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;\n    &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;\n    &lt;version&gt;4.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;\n    &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;\n    &lt;version&gt;4.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;\n    &lt;artifactId&gt;ooxml-schemas&lt;/artifactId&gt;\n    &lt;version&gt;1.4&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"lang/java/%E5%8E%9F%E7%94%9F%20POI%20Excel%20%E5%A4%9A%20Sheet%20%E9%A1%B5%E5%AF%BC%E5%87%BA/#_2","title":"\u5de5\u5177\u7c7b","text":"<pre><code>@Target(value = {ElementType.FIELD})\n@Retention(value = RetentionPolicy.RUNTIME)\npublic @interface ExcelColumn {\n    String zh();\n}\n</code></pre> <pre><code>import groovy.lang.Tuple3;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.poi.ss.usermodel.Cell;\nimport org.apache.poi.ss.usermodel.CellStyle;\nimport org.apache.poi.ss.usermodel.CellType;\nimport org.apache.poi.ss.usermodel.Font;\nimport org.apache.poi.ss.usermodel.Row;\nimport org.apache.poi.ss.usermodel.Sheet;\nimport org.apache.poi.ss.usermodel.Workbook;\nimport org.apache.poi.xssf.streaming.SXSSFWorkbook;\nimport java.lang.reflect.Field;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n@Slf4j\npublic class ExcelUtil {\n    public static Workbook multiSheet(List&lt;Tuple3&lt;String, Class&lt;?&gt;, List&lt;?&gt;&gt;&gt; list) {\n        Workbook workbook = new SXSSFWorkbook();\n\n        Font font = workbook.createFont();\n        font.setBold(true);\n        CellStyle cellStyle = workbook.createCellStyle();\n        cellStyle.setFont(font);\n\n        for (Tuple3&lt;String, Class&lt;?&gt;, List&lt;?&gt;&gt; tuple3 : list) {\n            String sheetName = tuple3.getV1();\n            Class&lt;?&gt; sheetClass = tuple3.getV2();\n            List&lt;?&gt; sheetData = tuple3.getV3();\n\n            Sheet sheet = workbook.createSheet(sheetName);\n\n            List&lt;Field&gt; fields = Arrays.stream(sheetClass.getDeclaredFields()).filter(key -&gt; key.isAnnotationPresent(ExcelColumn.class)).peek(key -&gt; key.setAccessible(true)).collect(Collectors.toList());\n            // title\n            Row row = sheet.createRow(0);\n            for (int c = 0; c &lt; fields.size(); c++) {\n                String value = fields.get(c).getAnnotation(ExcelColumn.class).zh();\n                Cell cell = row.createCell(c, CellType.STRING);\n                cell.setCellStyle(cellStyle);\n                cell.setCellValue(value);\n            }\n            // value\n            for (int r = 0; r &lt; sheetData.size(); r++) {\n                Object obj = sheetData.get(r);\n                row = sheet.createRow(r + 1);\n                for (int c = 0; c &lt; fields.size(); c++) {\n                    Object value = null;\n                    try { value = fields.get(c).get(obj); } catch (IllegalAccessException ignored) { }\n                    Cell cell = row.createCell(c, CellType.STRING);\n                    cell.setCellValue(value == null ? \"\" : value.toString());\n                }\n            }\n        }\n\n        return workbook;\n    }\n}\n</code></pre>"},{"location":"lang/java/%E5%8E%9F%E7%94%9F%20POI%20Excel%20%E5%A4%9A%20Sheet%20%E9%A1%B5%E5%AF%BC%E5%87%BA/#_3","title":"\u4f7f\u7528","text":"<pre><code>try (\n    ServletOutputStream os = response.getOutputStream();\n    Workbook wb = ExcelUtil.multiSheet(Arrays.asList(\n        new Tuple3&lt;&gt;(\"Sheet1\", Sheet1DTO.class, sheet1Data),\n        new Tuple3&lt;&gt;(\"Sheet2\", Sheet2DTO.class, sheet2Data),\n        new Tuple3&lt;&gt;(\"Sheet3\", Sheet3DTO.class, sheet3Data)\n    ));\n) {\n    response.setHeader(\"Content-Disposition\", String.format(\"attachment;filename=%s.xlsx\", URLEncoder.encode(\"XXX\", \"UTF-8\")));\n    response.setContentType(\"application/octet-stream\");\n    wb.write(os);\n} catch (Exception ignored) {\n\n}\n</code></pre>"},{"location":"lang/java/__demo__/native-sql-builder/","title":"\u539f\u751f SQL \u6784\u5efa\u5668","text":""},{"location":"lang/java/__guide__/Java%20IO/","title":"Java IO","text":""},{"location":"lang/java/__guide__/Java%20IO/#java-io","title":"Java IO \u5206\u7c7b","text":""},{"location":"lang/java/__guide__/Java%20IO/#_1","title":"\u65e2\u7136\u6709\u4e86\u5b57\u8282\u6d41\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709\u5b57\u7b26\u6d41","text":"<p>\u4e0d\u7ba1\u662f\u6587\u4ef6\u8bfb\u53d6\u8fd8\u662f\u7f51\u7edc\u53d1\u9001\u63a5\u6536\uff0c\u4fe1\u606f\u7684\u6700\u5c0f\u5b58\u50a8\u5355\u4f4d\u90fd\u662f\u5b57\u8282\uff0c\u90a3\u4e3a\u4ec0\u4e48 IO \u6d41\u64cd\u4f5c\u8981\u5206\u4e3a\u5b57\u8282\u6d41\u64cd\u4f5c\u548c\u5b57\u7b26\u6d41\u64cd\u4f5c\u5462\uff1f</p> <p>\u5b57\u7b26\u6d41\u662f\u7531 Java \u865a\u62df\u673a\u5c06\u5b57\u8282\u8f6c\u6362\u5f97\u5230\u7684\uff0c\u95ee\u9898\u5c31\u51fa\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u8fd8\u7b97\u662f\u975e\u5e38\u8017\u65f6\uff0c\u5e76\u4e14\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u77e5\u9053\u7f16\u7801\u7c7b\u578b\u5c31\u5f88\u5bb9\u6613\u51fa\u73b0\u4e71\u7801\u95ee\u9898\u3002\u6240\u4ee5\uff0cIO \u6d41\u5c31\u5e72\u8106\u63d0\u4f9b\u4e86\u4e00\u4e2a\u76f4\u63a5\u64cd\u4f5c\u5b57\u7b26\u7684\u63a5\u53e3\uff0c\u65b9\u4fbf\u6211\u4eec\u5e73\u65f6\u5bf9\u5b57\u7b26\u8fdb\u884c\u6d41\u64cd\u4f5c\u3002\u5982\u679c\u662f\u97f3\u9891\u3001\u56fe\u7247\u7b49\u5a92\u4f53\u6587\u4ef6\u7528\u5b57\u8282\u6d41\u6bd4\u8f83\u597d\uff0c\u5982\u679c\u6d89\u53ca\u5230\u5b57\u7b26\u7684\u8bdd\u4f7f\u7528\u5b57\u7b26\u6d41\u6bd4\u8f83\u597d\u3002</p>"},{"location":"lang/java/__guide__/Java%20IO/#bionioaio","title":"BIO\u3001NIO\u3001AIO \u6709\u4ec0\u4e48\u533a\u522b","text":"<ul> <li> <p>BIO\uff08Blocking IO\uff09</p> <p>\u540c\u6b65\u963b\u585e IO \u6a21\u5f0f\uff0c\u6570\u636e\u7684\u8bfb\u53d6\u5199\u5165\u5fc5\u987b\u963b\u585e\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\u7b49\u5f85\u5176\u5b8c\u6210\u3002\u5728\u6d3b\u52a8\u8fde\u63a5\u6570\u4e0d\u662f\u7279\u522b\u9ad8\uff08\u5c0f\u4e8e\u5355\u673a 1000\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u6a21\u578b\u662f\u6bd4\u8f83\u4e0d\u9519\u7684\uff0c\u53ef\u4ee5\u8ba9\u6bcf\u4e00\u4e2a\u8fde\u63a5\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684 IO \u5e76\u4e14\u7f16\u7a0b\u6a21\u578b\u7b80\u5355\uff0c\u4e5f\u4e0d\u7528\u591a\u8003\u8651\u7cfb\u7edf\u7684\u8fc7\u8f7d\u3001\u9650\u6d41\u7b49\u95ee\u9898\u3002\u7ebf\u7a0b\u6c60\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u5929\u7136\u7684\u6f0f\u6597\uff0c\u53ef\u4ee5\u7f13\u51b2\u4e00\u4e9b\u7cfb\u7edf\u5904\u7406\u4e0d\u4e86\u7684\u8fde\u63a5\u6216\u8bf7\u6c42\u3002\u4f46\u662f\u5f53\u9762\u5bf9\u5341\u4e07\u751a\u81f3\u767e\u4e07\u7ea7\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u4f20\u7edf\u7684 BIO \u6a21\u578b\u662f\u65e0\u80fd\u4e3a\u529b\u7684\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u66f4\u9ad8\u6548\u7684 IO \u5904\u7406\u6a21\u578b\u6765\u5e94\u5bf9\u66f4\u9ad8\u7684\u5e76\u53d1\u91cf\u3002</p> </li> <li> <p>NIO\uff08Non-blocking IO\uff09</p> <p>NIO \u662f\u4e00\u79cd\u540c\u6b65\u975e\u963b\u585e\u7684 IO \u6a21\u578b\uff0c\u5728 Java 1.4 \u4e2d\u5f15\u5165\u6765 NIO \u6846\u67b6\uff0c\u5bf9\u5e94\u6765 <code>java.nio</code> \u5305\uff0c\u63d0\u4f9b\u4e86 <code>Channel</code>\u3001<code>Selector</code>\u3001<code>Buffer</code> \u7b49\u62bd\u8c61\u3002\u5b83\u652f\u6301\u9762\u5411\u7f13\u51b2\u7684\uff0c\u57fa\u4e8e\u901a\u9053\u7684 IO \u64cd\u4f5c\u65b9\u6cd5\u3002NIO \u63d0\u4f9b\u4e86\u4e0e\u4f20\u7edf BIO \u6a21\u578b\u4e2d\u7684 <code>Socket</code>\u548c <code>ServerSocket</code>\u76f8\u5bf9\u5e94\u7684 <code>SocketChannel</code> \u548c <code>ServerSocketChannel</code> \u4e24\u79cd\u4e0d\u901a\u8fc7\u7684\u5957\u63a5\u5b57\u901a\u9053\u5b9e\u73b0\uff0c\u4e24\u79cd\u901a\u9053\u90fd\u652f\u6301\u963b\u585e\u548c\u975e\u963b\u585e\u4e24\u79cd\u6a21\u5f0f\u3002\u963b\u585e\u6a21\u5f0f\u4f7f\u7528\u5c31\u50cf\u4f20\u7edf\u4e2d\u7684\u652f\u6301\u4e00\u6837\uff0c\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u662f\u6027\u80fd\u548c\u53ef\u9760\u6027\u90fd\u4e0d\u597d\uff1b\u975e\u963b\u585e\u6a21\u5f0f\u6b63\u597d\u4e0e\u4e4b\u76f8\u53cd\u3002\u5bf9\u4e8e\u4f4e\u8d1f\u8f7d\u3001\u4f4e\u5e76\u53d1\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u4f7f\u7528\u540c\u6b65\u963b\u585e IO \u6765\u63d0\u5347\u5f00\u53d1\u901f\u7387\u548c\u66f4\u597d\u7684\u7ef4\u62a4\u6027\uff1b\u5bf9\u4e8e\u9ad8\u8d1f\u8f7d\u3001\u9ad8\u5e76\u53d1\uff08\u7f51\u7edc\uff09\u5e94\u7528\uff0c\u5e94\u4f7f\u7528 NIO \u7684\u975e\u963b\u585e\u6a21\u5f0f\u6765\u5f00\u53d1\u3002</p> </li> <li> <p>AIO\uff08Asynchronous IO\uff09</p> <p>AIO \u4e5f\u5c31\u662f NIO2\u3002\u5728 Java7 \u4e2d\u5f15\u5165\u6765 NIO \u7684\u6539\u8fdb\u7248 NIO2\uff0c\u5b83\u662f\u5f02\u6b65\u975e\u963b\u585e\u7684 IO \u6a21\u578b\u3002\u5f02\u6b65 IO \u662f\u57fa\u4e8e\u4e8b\u4ef6\u548c\u56de\u8c03\u673a\u5236\u5b9e\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u5e94\u7528\u64cd\u4f5c\u4e4b\u540e\u4f1a\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u4f1a\u963b\u585e\u5728\u90a3\u91cc\uff0c\u5f53\u540e\u53f0\u5904\u7406\u5b8c\u6210\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u901a\u77e5\u76f8\u5e94\u7684\u7ebf\u7a0b\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u5bf9\u4e8e NIO \u6765\u8bf4\uff0c\u6211\u4eec\u7684\u4e1a\u52a1\u7ebf\u7a0b\u662f\u5728 IO \u64cd\u4f5c\u51c6\u5907\u597d\u65f6\uff0c\u5f97\u5230\u901a\u77e5\uff0c\u63a5\u7740\u5c31\u7531\u8fd9\u4e2a\u7ebf\u7a0b\u81ea\u884c\u8fdb\u884c IO \u64cd\u4f5c\uff0cIO \u64cd\u4f5c\u672c\u8eab\u662f\u540c\u6b65\u7684\u3002</p> <p>\u76ee\u524d AIO \u7684\u5e94\u7528\u8fd8\u4e0d\u662f\u5f88\u5e7f\u6cdb\uff0cNetty \u4e4b\u524d\u4e5f\u5c1d\u8bd5\u4f7f\u7528\u8fc7 AIO\uff0c\u4e0d\u8fc7\u53c8\u653e\u5f03\u4e86\u3002</p> </li> </ul>"},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/","title":"Java \u57fa\u7840","text":""},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/#java","title":"\u5728 Java \u4e2d\u5b9a\u4e49\u4e00\u4e2a\u4e0d\u505a\u4e8b\u4e14\u6ca1\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u7684\u4f5c\u7528","text":"<p>Java \u7a0b\u5e8f\u5728\u6267\u884c\u5b50\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u4e4b\u524d\uff0c\u5982\u679c\u6ca1\u6709\u7528 <code>super</code> \u6765\u8c03\u7528\u7236\u7c7b\u7279\u5b9a\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5219\u4f1a\u8c03\u7528\u7236\u7c7b\u4e2d\u201d\u6ca1\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u201c\u3002\u56e0\u6b64\uff0c\u5982\u679c\u7236\u7c7b\u4e2d\u5b9a\u4e49\u6765\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u800c\u5728\u5b50\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u53c8\u6ca1\u6709\u7528 <code>super</code> \u6765\u8c03\u7528\u7236\u7c7b\u4e2d\u7279\u5b9a\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u5219\u7f16\u8bd1\u65f6\u5c06\u53d1\u751f\u9519\u8bef\uff0c\u56e0\u4e3a Java \u7a0b\u5e8f\u627e\u4e0d\u5230\u6ca1\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u53ef\u4f9b\u6267\u884c\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u5728\u7236\u7c7b\u91cc\u52a0\u4e00\u4e2a\u4e0d\u505a\u4e8b\u4e14\u6ca1\u6709\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/#import-java-import-javax","title":"<code>import java</code> \u548c <code>import javax</code> \u6709\u4ec0\u4e48\u533a\u522b","text":"<p>\u521a\u5f00\u59cb\u7684\u65f6\u5019 Java API \u6240\u5fc5\u987b\u5305\u662f <code>java</code> \u5f00\u5934\u7684\u5305\uff0c<code>javax</code> \u5f53\u65f6\u53ea\u662f\u6269\u5c55 API \u6765 shying\uff0c\u7136\u800c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c<code>javax</code>\u9010\u6e10\u5730\u6269\u5c55\u6210\u4e3a Java API \u7684\u7ec4\u6210\u90e8\u5206\u3002\u4f46\u662f\uff0c\u5c06\u6269\u5c55\u4ece <code>javax</code> \u5305\u79fb\u52a8\u5230 <code>java</code>\u5305\u786e\u5b9e\u592a\u9ebb\u70e6\u6765\uff0c\u6700\u7ec8\u4f1a\u7834\u574f\u4e00\u5806\u73b0\u6709\u7684\u4ee3\u7801\u3002\u56e0\u6b64\u51b3\u5b9a <code>javax</code> \u5305\u6210\u4e3a\u6807\u51c6 API \u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/#equals-hashcode","title":"<code>equals()</code> \u548c <code>hashCode()</code>","text":"<p>\u6211\u4eec\u91cd\u5199\u4e86 <code>Person</code> \u7c7b\u7684 <code>equals()</code> \u65b9\u6cd5\u3002\u4f46\u662f\u5f88\u5947\u602a\u7684\u53d1\u73b0 <code>HashSet</code> \u4e2d\u4ecd\u7136\u6709\u91cd\u590d\u5143\u7d20\u3002\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a <code>p1</code> \u548c <code>p2</code> \u7684\u5185\u5bb9\u76f8\u7b49\uff0c\u4f46\u662f\u4ed6\u4eec\u7684 <code>hashCode()</code> \u4e0d\u7b49\uff0c\u6240\u4ee5 <code>HashSet</code> \u5728\u6dfb\u52a0 <code>p1</code> \u548c <code>p2</code> \u7684\u65f6\u5019\uff0c\u8ba4\u4e3a\u5b83\u4eec\u4e0d\u76f8\u7b49\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/#_1","title":"\u5f02\u5e38\u7c7b\u5c42\u6b21\u7ed3\u6784","text":""},{"location":"lang/java/__guide__/Java%20%E5%9F%BA%E7%A1%80/#throwable","title":"<code>Throwable</code> \u63a5\u53e3\u5e38\u7528\u65b9\u6cd5","text":"<code>public String getMessage()</code> \u8fd4\u56de\u5f02\u5e38\u53d1\u751f\u65f6\u7684\u7b80\u8981\u63cf\u8ff0 <code>public String toString()</code> \u8fd4\u56de\u5f02\u5e38\u53d1\u751f\u65f6\u7684\u8be6\u7ec6\u4fe1\u606f <code>public String getLocalizedMessage()</code> \u8fd4\u56de\u5f02\u5e38\u5bf9\u8c61\u7684\u672c\u5730\u5316\u4fe1\u606f\u3002\u4f7f\u7528 <code>Throwable</code> \u7684\u5b50\u7c7b\u8986\u76d6\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u751f\u6210\u672c\u5730\u5316\u4fe1\u606f\u3002\u5982\u679c\u5b50\u7c7b\u6ca1\u6709\u8986\u76d6\u8be5\u65b9\u6cd5\uff0c\u5219\u8be5\u65b9\u6cd5\u8fd4\u56de\u7684\u4fe1\u606f\u4e0e <code>getMessage()</code> \u8fd4\u56de\u7684\u7ed3\u679c\u76f8\u540c <code>public void printStackTrace()</code> \u5728\u63a7\u5236\u53f0\u4e0a\u6253\u5370 <code>Throwable</code> \u5bf9\u8c61\u5c01\u88c5\u7684\u5f02\u5e38\u4fe1\u606f <p>\u5728\u4ee5\u4e0b 3 \u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c<code>finally</code> \u5757\u4e0d\u4f1a\u88ab\u6267\u884c</p> <ol> <li>\u5728 <code>try</code> \u6216 <code>finally</code> \u5757\u4e2d\u7528\u4e86 <code>System.exit(int)</code> \u9000\u51fa\u7a0b\u5e8f\u3002\u4f46\u662f <code>System.exit(int)</code> \u5728\u5f02\u5e38\u8bed\u53e5\u4e4b\u540e\uff0c<code>finally</code> \u8fd8\u662f\u4f1a\u88ab\u6267\u884c\u3002</li> <li>\u7a0b\u5e8f\u6240\u5728\u7684\u7ebf\u7a0b\u6b7b\u4ea1\u3002</li> <li>\u5173\u95ed CPU\u3002</li> </ol> <p>\u5728 <code>try</code> \u8bed\u53e5\u548c <code>finally</code> \u8bed\u53e5\u4e2d\u90fd\u6709 <code>return</code> \u8bed\u53e5\u65f6\uff0c\u5728\u65b9\u6cd5\u8fd4\u56de\u4e4b\u524d\uff0c <code>finally</code> \u8bed\u53e5\u7684\u5185\u5bb9\u5c06\u88ab\u6267\u884c\uff0c\u5e76\u4e14 <code>finally</code> \u8bed\u53e5\u7684\u8fd4\u56de\u503c\u5c06\u4f1a\u8986\u76d6\u539f\u59cb\u7684\u8fd4\u56de\u503c\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/","title":"Java \u591a\u7ebf\u7a0b","text":""},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_1","title":"\u7b80\u8ff0\u7ebf\u7a0b\u3001\u7a0b\u5e8f\u3001\u8fdb\u7a0b\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4ec0\u4e48","text":"<p>\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u76f8\u4f3c\uff0c\u4f46\u7ebf\u7a0b\u662f\u4e00\u4e2a\u6bd4\u8fdb\u7a0b\u66f4\u5c0f\u7684\u6267\u884c\u5355\u4f4d\u3002\u4e00\u4e2a\u8fdb\u7a0b\u5728\u5176\u6267\u884c\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4ea7\u751f\u591a\u4e2a\u7ebf\u7a0b\u3002\u4e0e\u8fdb\u7a0b\u4e0d\u540c\u7684\u662f\u540c\u7c7b\u7684\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\u548c\u4e00\u7ec4\u7cfb\u7edf\u8d44\u6e90\uff0c\u6240\u4ee5\u7cfb\u7edf\u5728\u4ea7\u751f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6216\u662f\u5728\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u505a\u5207\u6362\u5de5\u4f5c\u65f6\uff0c\u8d1f\u62c5\u8981\u6bd4\u8fdb\u7a0b\u5c0f\u5f97\u591a\uff0c\u4e5f\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u7ebf\u7a0b\u4e5f\u522b\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u3002</p> <p>\u7a0b\u5e8f\u662f\u542b\u6709\u6307\u4ee4\u548c\u6570\u636e\u7684\u6587\u4ef6\uff0c\u88ab\u5b58\u50a8\u5728\u78c1\u76d8\u6216\u662f\u5176\u4ed6\u7684\u6570\u636e\u5b58\u50a8\u8bbe\u5907\u4e2d\u3002\u4e5f\u5c31\u662f\u8bf4\u7a0b\u5e8f\u662f\u9759\u6001\u7684\u4ee3\u7801\u3002</p> <p>\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u7684\u4e00\u6b21\u6267\u884c\u8fc7\u7a0b\uff0c\u662f\u7cfb\u7edf\u8fd0\u884c\u7a0b\u5e8f\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u56e0\u6b64\u8fdb\u7a0b\u662f\u52a8\u6001\u7684\u3002\u7cfb\u7edf\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\u5373\u662f\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u521b\u5efa\u3001\u8fd0\u884c\u5230\u6d88\u4ea1\u7684\u8fc7\u7a0b\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5c31\u662f\u4e00\u4e2a\u6267\u884c\u4e2d\u7684\u7a0b\u5e8f\uff0c\u5b83\u5728\u8ba1\u7b97\u673a\u4e2d\u4e00\u4e2a\u6307\u4ee4\u63a5\u7740\u4e00\u4e2a\u6307\u4ee4\u5730\u6267\u884c\u7740\uff0c\u540c\u65f6\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u8fd8\u5360\u6709\u7740\u67d0\u4e9b\u7cfb\u7edf\u8d44\u6e90\u5982 CPU \u65f6\u95f4\uff0c\u5185\u5b58\u7a7a\u95f4\uff0c\u6587\u4ef6\uff0c\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684\u4f7f\u7528\u6743\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5f53\u7a0b\u5e8f\u5728\u6267\u884c\u65f6\uff0c\u5c06\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8f7d\u5165\u5185\u5b58\u4e2d\u3002</p> <p>\u7ebf\u7a0b\u662f\u8fdb\u7a0b\u5212\u5206\u6210\u7684\u66f4\u5c0f\u7684\u8fd0\u884c\u5355\u4f4d\u3002\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6700\u5927\u7684\u4e0d\u540c\u5728\u4e8e\u57fa\u672c\u4e0a\u5404\u8fdb\u7a0b\u662f\u72ec\u7acb\u7684\uff0c\u800c\u5404\u7ebf\u7a0b\u5219\u4e0d\u4e00\u5b9a\uff0c\u56e0\u4e3a\u540c\u4e00\u8fdb\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u6781\u6709\u53ef\u80fd\u4f1a\u76f8\u4e92\u5f71\u54cd\u3002\u4ece\u53e6\u4e00\u89d2\u5ea6\u6765\u8bf4\uff0c\u8fdb\u7a0b\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u8303\u7574\uff0c\u4e3b\u8981\u662f\u540c\u4e00\u4e2a\u65f6\u95f4\u5185\uff0c\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7684\u7a0b\u5e8f\uff0c\u800c\u7ebf\u7a0b\u5219\u662f\u5728\u540c\u4e00\u7a0b\u5e8f\u5185\u51e0\u4e4e\u540c\u65f6\u6267\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7684\u7a0b\u5e8f\u6bb5\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_2","title":"\u7ebf\u7a0b\u6709\u54ea\u4e9b\u57fa\u672c\u72b6\u6001","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u9690\u85cf Java \u865a\u62df\u673a\u4e2d\u7684 READY \u548c RUNNING \u72b6\u6001\uff0c\u5b83\u53ea\u80fd\u770b\u5230 RUNNABLE \u72b6\u6001\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_3","title":"\u8bf7\u7b80\u8981\u63cf\u8ff0\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u7684\u5173\u7cfb\uff0c\u533a\u522b\u53ca\u4f18\u7f3a\u70b9","text":"<p>\u7ebf\u7a0b\u662f\u8fdb\u7a0b\u5212\u5206\u6210\u7684\u66f4\u5c0f\u7684\u8fd0\u884c\u5355\u4f4d\u3002\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u6700\u5927\u7684\u4e0d\u540c\u5728\u4e8e\u57fa\u672c\u4e0a\u5404\u8fdb\u7a0b\u662f\u72ec\u7acb\u7684\uff0c\u800c\u5404\u7ebf\u7a0b\u5219\u4e0d\u4e00\u5b9a\uff0c\u56e0\u4e3a\u540c\u4e00\u8fdb\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u6781\u6709\u53ef\u80fd\u4f1a\u76f8\u4e92\u5f71\u54cd\u3002\u7ebf\u5c42\u6267\u884c\u5f00\u9500\u5c0f\uff0c\u4f46\u4e0d\u5229\u4e8e\u8d44\u6e90\u7684\u7ba1\u7406\u548c\u4fdd\u62a4\uff0c\u800c\u8fdb\u7a0b\u6b63\u76f8\u53cd\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_4","title":"\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e3a\u4ec0\u4e48\u662f\u79c1\u6709\u7684","text":"<p>\u7a0b\u5e8f\u8ba1\u7b97\u5668\u4e3b\u8981\u6709\u4e0b\u9762\u4e24\u4e2a\u4f5c\u7528\uff1a</p> <ol> <li>\u5b57\u8282\u7801\u89e3\u91ca\u5668\u901a\u8fc7\u6539\u53d8\u7a0b\u5e8f\u8ba1\u6570\u5668\u6765\u4f9d\u6b21\u8bfb\u53d6\u6307\u4ee4\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee3\u7801\u7684\u6d41\u7a0b\u63a7\u5236\uff0c\u5982\u987a\u5e8f\u6267\u884c\u3001\u9009\u62e9\u3001\u5faa\u73af\u3001\u5f02\u5e38\u5904\u7406\u3002</li> <li>\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u7528\u4e8e\u8bb0\u5f55\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u5f53\u7ebf\u7a0b\u88ab\u5207\u6362\u56de\u6765\u7684\u65f6\u5019\u80fd\u591f\u77e5\u9053\u8be5\u7ebf\u5c42\u4e0a\u6b21\u8fd0\u884c\u5230\u54ea\u513f\u4e86\u3002</li> </ol> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6267\u884c\u7684\u662f Native \u65b9\u6cd5\uff0c\u90a3\u4e48\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u662f undefined \u5730\u5740\uff0c\u53ea\u6709\u6267\u884c\u7684\u662f Java \u4ee3\u7801\u65f6\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u7684\u624d\u662f\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002</p> <p>\u6240\u4ee5\u7a0b\u5e8f\u8ba1\u6570\u5668\u79c1\u6709\u4e3b\u8981\u662f\u4e3a\u4e86\u7ebf\u5c42\u5207\u6362\u540e\u80fd\u591f\u6062\u590d\u5230\u6b63\u786e\u7684\u6267\u884c\u4f4d\u7f6e\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_5","title":"\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\u4e3a\u4ec0\u4e48\u662f\u79c1\u6709\u7684","text":"<ul> <li> <p>\u865a\u62df\u673a\u6808</p> <p>\u6bcf\u4e2a Java \u65b9\u6cd5\u5728\u6267\u884c\u7684\u540c\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u8868\u3002\u64cd\u4f5c\u6570\u6808\u3001\u5e38\u91cf\u6c60\u5f15\u7528\u7b49\u4fe1\u606f\u3002\u4ece\u65b9\u6cd5\u8c03\u7528\u76f4\u81f3\u6267\u884c\u5b8c\u6210\u7684\u8fc7\u7a0b\uff0c\u5c31\u5bf9\u5e94\u7740\u4e00\u4e2a\u6808\u5e27\u5728 Java \u865a\u62df\u673a\u6808\u4e2d\u5165\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u6808</p> <p>\u548c\u865a\u62df\u673a\u6808\u6240\u53d1\u6325\u7684\u4f5c\u7528\u975e\u5e38\u76f8\u4f3c\uff0c\u533a\u522b\u662f\uff1a\u865a\u62df\u673a\u6808\u4e3a\u865a\u62df\u673a\u6267\u884c Java \u6309\u65b9\u6cd5\uff08\u4e5f\u5c31\u662f\u5b57\u8282\u7801\uff09\u670d\u52a1\uff0c\u800c\u672c\u5730\u65b9\u6cd5\u6808\u5219\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u5230\u7684 Native \u65b9\u6cd5\u670d\u52a1\u3002\u5728 HotSpot \u865a\u62df\u673a\u4e2d\u548c Java \u865a\u62df\u673a\u6808\u5408\u4e8c\u4e3a\u4e00\u3002</p> </li> </ul> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u4e2d\u7684\u5c40\u90e8\u53d8\u91cf\u4e0d\u88ab\u88ab\u989d\u7ebf\u7a0b\u8bbf\u95ee\u5230\uff0c\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u6808\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_6","title":"\u4e00\u53e5\u8bdd\u7b80\u5355\u4e86\u89e3\u5806\u548c\u65b9\u6cd5\u533a","text":"<p>\u5806\u548c\u65b9\u6cd5\u533a\u662f\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u5176\u4e2d\u5806\u662f\u8fdb\u7a0b\u4e2d\u6700\u5927\u7684\u4e00\u5757\u5185\u5b58\uff0c\u4e3b\u8981\u7528\u4e8e\u5b58\u653e\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\uff08\u6240\u6709\u5bf9\u8c61\u90fd\u5728\u8fd9\u91cc\u5206\u914d\u5185\u5b58\uff09\uff0c\u65b9\u6cd5\u533a\u4e3b\u8981\u7528\u4e8e\u5b58\u653e\u5df2\u88ab\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7b49\u6570\u636e\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_7","title":"\u4ec0\u4e48\u662f\u4e0a\u4e0b\u6587\u5207\u6362","text":"<p>\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u4e00\u822c\u7ebf\u7a0b\u7684\u4e2a\u6570\u90fd\u5927\u4e8e CPU \u6838\u5fc3\u7684\u4e2a\u6570\uff0c\u800c\u4e00\u4e2a CPU \u6838\u5fc3\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u4f7f\u7528\uff0c\u4e3a\u4e86\u8ba9\u8fd9\u4e9b\u7ebf\u7a0b\u90fd\u80fd\u5f97\u5230\u6709\u6548\u6267\u884c\uff0cCPU \u91c7\u53d6\u7684\u7b56\u7565\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u65f6\u95f4\u7247\u5e76\u8f6e\u8f6c\u7684\u5f62\u5f0f\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u7684\u65f6\u95f4\u7247\u7528\u5b8c\u7684\u65f6\u5019\u5c31\u4f1a\u91cd\u65b0\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u8ba9\u7ed9\u5176\u5b83\u7a0b\u5e8f\u4f7f\u7528\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u5c5e\u4e8e\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u6982\u62ec\u6765\u8bf4\u5c31\u662f\uff1a\u5f53\u524d\u4efb\u52a1\u5728\u6267\u884c\u5b8c CPU \u65f6\u95f4\u7247\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u4efb\u52a1\u4e4b\u524d\u4f1a\u5148\u4fdd\u5b58\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u518d\u5207\u6362\u56de\u8fd9\u4e2a\u4efb\u52a1\u65f6\uff0c\u53ef\u4ee5\u518d\u52a0\u8f7d\u8fd9\u4e2a\u4efb\u52a1\u7684\u72b6\u6001\u3002\u4efb\u52a1\u4ece\u4fdd\u5b58\u5230\u518d\u52a0\u8f7d\u7684\u8fc7\u7a0b\u5c31\u662f\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u901a\u5e38\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u9700\u8981\u76f8\u5f53\u53ef\u89c2\u7684\u5904\u7406\u5668\u65f6\u95f4\uff0c\u5728\u6bcf\u79d2\u51e0\u5341\u4e0a\u767e\u6b21\u7684\u5207\u6362\u4e2d\uff0c\u6bcf\u6b21\u5207\u6362\u90fd\u9700\u8981\u7eb3\u79d2\u91cf\u7ea7\u7684\u65f6\u95f4\u3002\u6240\u4ee5\uff0c\u4e0a\u4e0b\u6587\u5207\u6362\u5bf9\u7cfb\u7edf\u6765\u8bf4\u610f\u5473\u7740\u6d88\u8017\u5927\u91cf\u7684 CPU \u65f6\u95f4\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u53ef\u80fd\u662f\u64cd\u4f5c\u7cfb\u7edf\u65f6\u95f4\u6d88\u8017\u6700\u5927\u7684\u64cd\u4f5c\u3002</p> <p>Linux \u76f8\u6bd4\u5176\u5b83\u64cd\u4f5c\u7cfb\u7edf\uff08\u5305\u62ec\u5176\u5b83\u7c7b Unix \u7cfb\u7edf\uff09\u6709\u5f88\u591a\u7684\u4f18\u70b9\uff0c\u5176\u4e2d\u6709\u4e00\u9879\u5c31\u662f\uff0c\u5176\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u6a21\u5f0f\u5207\u6362\u7684\u65f6\u95f4\u6d88\u8017\u975e\u5e38\u5c11\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_8","title":"\u4ec0\u4e48\u662f\u7ebf\u7a0b\u6b7b\u9501\u3001\u5982\u4f55\u907f\u514d\u6b7b\u9501","text":"<ul> <li>\u7834\u574f\u4e92\u65a5\u6761\u4ef6\uff1a\u8fd9\u4e2a\u6761\u4ef6\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u7834\u574f\uff0c\u56e0\u4e3a\u6211\u4eec\u7528\u9501\u672c\u6765\u5c31\u662f\u8ba9\u5b83\u4eec\u4e92\u65a5\u7684\uff08\u4e34\u754c\u8d44\u6e90\u9700\u8981\u4e92\u65a5\u8bbf\u95ee\uff09\u3002</li> <li>\u7834\u574f\u8bf7\u6c42\u4e0e\u4fdd\u6301\u6761\u4ef6\uff1a\u4e00\u6b21\u6027\u7533\u8bf7\u6240\u6709\u7684\u8d44\u6e90\u3002</li> <li>\u7834\u574f\u4e0d\u5265\u593a\u6761\u4ef6\uff1a\u5360\u7528\u90e8\u5206\u8d44\u6e90\u7684\u7ebf\u7a0b\u8fdb\u4e00\u6b65\u7533\u8bf7\u5176\u5b83\u8d44\u6e90\u65f6\uff0c\u5982\u679c\u7533\u8bf7\u4e0d\u5230\uff0c\u53ef\u4ee5\u4e3b\u52a8\u91ca\u653e\u5b83\u5360\u6709\u7684\u8d44\u6e90\u3002</li> <li>\u7834\u574f\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\uff1a\u9760\u6309\u5e8f\u7533\u8bf7\u8d44\u6e90\u6765\u9884\u9632\u3002\u6309\u67d0\u4e00\u987a\u5e8f\u7533\u8bf7\u8d44\u6e90\uff0c\u91ca\u653e\u8d44\u6e90\u5219\u53cd\u5e8f\u91ca\u653e\u3002</li> </ul>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#sleep-wait","title":"\u8bf4\u8bf4 <code>sleep()</code> \u65b9\u6cd5\u548c <code>wait()</code> \u65b9\u6cd5\u533a\u522b\u548c\u5171\u540c\u70b9","text":"<ul> <li>\u4e24\u8005\u4e3b\u6700\u8981\u7684\u533a\u522b\u5728\u4e8e <code>sleep()</code> \u65b9\u6cd5\u6ca1\u6709\u91ca\u653e\u9501\uff0c\u800c <code>wait()</code> \u65b9\u6cd5\u91ca\u653e\u4e86\u9501\u3002</li> <li>\u4e24\u8005\u90fd\u53ef\u4ee5\u6682\u505c\u7ebf\u7a0b\u7684\u6267\u884c\u3002</li> <li><code>wait()</code>\u901a\u5e38\u88ab\u7528\u4e8e\u7ebf\u7a0b\u95f4\u4ea4\u4e92 / \u901a\u4fe1\uff0c<code>sleep()</code>\u901a\u5e38\u88ab\u7528\u4e8e\u6682\u505c\u6267\u884c\u3002</li> <li><code>wait()</code> \u65b9\u6cd5\u88ab\u8c03\u7528\u540e\uff0c\u7ebf\u7a0b\u4e0d\u4f1a\u81ea\u52a8\u82cf\u9192\uff0c\u9700\u8981\u522b\u7684\u7ebf\u7a0b\u8c03\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u7684 <code>notify()</code> \u6216\u8005 <code>notifyAll()</code> \u65b9\u6cd5\u3002<code>sleep()</code> \u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7ebf\u7a0b\u4f1a\u81ea\u52a8\u82cf\u9192\u3002\u6216\u8005\u53ef\u4ee5\u4f7f\u7528 <code>wait(timeout)</code> \u8d85\u65f6\u540e\u7ebf\u7a0b\u4f1a\u81ea\u52a8\u82cf\u9192\u3002</li> </ul>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#synchronized","title":"\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528 <code>synchronized</code> \u5173\u952e\u5b57\u4fee\u9970\u5417","text":"<p>\u6784\u9020\u65b9\u6cd5\u4e0d\u80fd\u4f7f\u7528 <code>syncronized</code> \u5173\u952e\u5b57\u4fee\u9970\u3002\u6784\u9020\u65b9\u6cd5\u672c\u8eab\u5c31\u5c5e\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4e0d\u5b58\u5728\u540c\u6b65\u7684\u6784\u9020\u65b9\u6cd5\u4e00\u8bf4\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E5%A4%9A%E7%BA%BF%E7%A8%8B/#syncronized","title":"\u8bb2\u4e00\u8bb2 <code>syncronized</code> \u5173\u952e\u5b57\u7684\u5e95\u5c42\u539f\u7406","text":"<ul> <li> <p><code>syncronized</code> \u540c\u6b65\u8bed\u53e5\u5757\u7684\u5b9e\u73b0\u4f7f\u7528\u7684 <code>monitorenter</code> \u548c <code>monitorexit</code> \u6307\u4ee4\uff0c\u5176\u4e2d <code>monitorenter</code> \u6307\u4ee4\u6307\u5411\u540c\u6b65\u4ee3\u7801\u5757\u7684\u5f00\u59cb\u4f4d\u7f6e\uff0c<code>monitorexit</code>\u6307\u4ee4\u5219\u6307\u660e\u540c\u6b65\u4ee3\u7801\u5757\u7684\u7ed3\u675f\u4f4d\u7f6e\u3002</p> </li> <li> <p><code>syncronized</code> \u4fee\u9970\u7684\u65b9\u6cd5\u5e76\u6ca1\u6709 <code>monitorenter</code> \u548c <code>monitorexit</code> \u6307\u4ee4\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f <code>ACC_SYNCRONIZED</code> \u6807\u8bc6\uff0c\u8be5\u6807\u8bc6\u6307\u660e\u4e86\u8be5\u65b9\u6cd5\u662f\u4e00\u4e2a\u540c\u6b65\u65b9\u6cd5\u3002</p> </li> </ul> <p>\u4e0d\u8fc7\u4e24\u8005\u7684\u672c\u8d28\u90fd\u662f\u5bf9\u5bf9\u8c61\u76d1\u89c6\u5668 <code>monitor</code> \u7684\u83b7\u53d6\u3002</p>"},{"location":"lang/java/__guide__/Java%20%E9%9B%86%E5%90%88/","title":"Java \u96c6\u5408","text":""},{"location":"lang/java/__guide__/Java%20%E9%9B%86%E5%90%88/#hashmap-2","title":"<code>HashMap</code> \u7684\u957f\u5ea6\u4e3a\u4ec0\u4e48\u662f 2 \u7684\u5e42\u6b21\u65b9","text":"<p>\u4e3a\u4e86\u80fd\u8ba9 <code>HashMap</code> \u5b58\u53d6\u9ad8\u6548\u3001\u5c3d\u91cf\u8f83\u5c11\u78b0\u649e\uff0c\u4e5f\u5c31\u662f\u5c3d\u91cf\u628a\u6570\u636e\u5206\u914d\u5747\u5300\u3002</p> <p>Hash \u503c\u7684\u8303\u56f4\u503c\u662f <code>[-2^32, 2^32)</code>, \u524d\u540e\u52a0\u8d77\u6765\u5927\u6982 40 \u4ebf\u7684\u6620\u5c04\u7a7a\u95f4\uff0c\u53ea\u8981\u54c8\u5e0c\u51fd\u6570\u6620\u5c04\u5f97\u6bd4\u8f83\u5747\u5300\u677e\u6563\uff0c\u4e00\u822c\u5e94\u7528\u662f\u5f88\u96be\u51fa\u73b0\u78b0\u649e\u7684\u3002\u4f46\u95ee\u9898\u662f\u4e00\u4e2a 40 \u4ebf\u957f\u5ea6\u7684\u6570\u7ec4\uff0c\u5185\u5b58\u662f\u653e\u4e0d\u4e0b\u7684\u3002\u6240\u4ee5\u8fd9\u4e2a\u6563\u5217\u503c\u662f\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u7528\u7684\u3002\u7528\u4e4b\u524d\u8fd8\u8981\u5148\u5bf9\u6570\u7ec4\u7684\u957f\u5ea6\u53d6\u6a21\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u4f59\u6570\u624d\u80fd\u7528\u6765\u8981\u5b58\u653e\u7684\u4f4d\u7f6e\u4e5f\u5c31\u662f\u5bf9\u5e94\u7684\u6570\u7ec4\u4e0b\u6807\u3002\u8fd9\u4e2a\u6570\u7ec4\u4e0b\u6807\u7684\u8ba1\u7b97\u65b9\u6cd5\u662f <code>hash&amp;(length-1)</code>\u3002</p> <p>\u53d6\u6a21\uff08<code>%</code>\uff09\u64cd\u4f5c\u4e2d\u5982\u679c\u9664\u6570\u662f 2 \u7684\u5e42\u6b21\u65b9\uff0c\u5219\u7b49\u4ef7\u4e8e\u5176\u9664\u6570\u53d6\u6a21\u64cd\u4f5c\uff08<code>&amp;</code>\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4 <code>hash%length == hash&amp;(length-1)</code> \u7684\u524d\u63d0\u662f <code>length</code> \u662f 2 \u7684\u5e42\u6b21\u65b9\u3002\u5e76\u4e14\u91c7\u7528\u4e8c\u8fdb\u5236\u4e0e\u64cd\u4f5c\uff08<code>&amp;</code>\uff09\u76f8\u5bf9\u4e8e\u53d6\u6a21\u64cd\u4f5c\uff08<code>%</code>\uff09 \u80fd\u591f\u63d0\u9ad8\u8fd0\u7b97\u6548\u7387\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86 <code>HashMap</code> \u7684\u957f\u5ea6\u4e3a\u4ec0\u4e48\u662f 2 \u7684\u5e42\u6b21\u65b9\u3002</p>"},{"location":"lang/java/__guide__/jvm/","title":"Jvm","text":""},{"location":"lang/java/__guide__/jvm/#_1","title":"\u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u552f\u4e00\u4e00\u4e2a\u4e0d\u4f1a\u51fa\u73b0 <code>OutOfMemoryError</code> \u7684\u5185\u5b58\u533a\u57df\uff0c\u5b83\u7684\u58f0\u660e\u5468\u671f\u968f\u7740\u7ebf\u5c42\u7684\u521b\u5efa\u800c\u521b\u5efa\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u7ed3\u675f\u800c\u6b7b\u4ea1\u3002</p>"},{"location":"lang/java/__guide__/jvm/#java","title":"Java \u865a\u62df\u673a\u6808","text":"<p>\u4e0e\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e00\u6837\uff0cJava \u865a\u62df\u673a\u6808\u4e5f\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u4e0e\u7ebf\u7a0b\u76f8\u540c\uff0c\u63cf\u8ff0\u7684 Java \u65b9\u6cd5\u6267\u884c\u7684\u5185\u5b58\u6a21\u578b\uff0c\u6bcf\u6b21\u65b9\u6cd5\u8c03\u7528\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7\u6808\u4f20\u9012\u7684\u3002</p> <p>Java \u5185\u5b58\u53ef\u4ee5\u7c97\u7cd9\u7684\u533a\u5206\u4e3a\u5806\u5185\u5b58\u548c\u6808\u5185\u5b58\uff0c\u5176\u4e2d\u6808\u5c31\u662f\u73b0\u5728\u8bf4\u7684\u865a\u62df\u673a\u6808\uff0c\u6216\u8005\u8bf4\u662f\u865a\u62df\u673a\u6808\u4e2d\u5c40\u90e8\u53d8\u91cf\u8868\u90e8\u5206\u3002\uff08\u5b9e\u9645\u4e0a\uff0cJava \u865a\u62df\u673a\u6808\u662f\u7531\u4e00\u4e2a\u4e2a\u6808\u5e27\u7ec4\u6210\uff0c\u800c\u6bcf\u4e2a\u6808\u5e27\u4e2d\u90fd\u62e5\u6709\uff1a\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\u4fe1\u606f\uff09</p> <p>\u5c40\u90e8\u53d8\u91cf\u8868\u4e3b\u8981\u5b58\u653e\u4e86\u7f16\u8bd1\u5668\u53ef\u77e5\u7684\u5404\u79cd\u6570\u636e\u7c7b\u578b\uff08<code>boolean</code>\u3001<code>byte</code>\u3001<code>char</code>\u3001<code>short</code>\u3001<code>int</code>\u3001<code>float</code>\u3001<code>long</code>\u3001<code>double</code>\uff09\u3001\u5bf9\u8c61\u5f15\u7528\uff08reference \u7c7b\u578b\uff0c\u5b83\u4e0d\u540c\u4e8e\u5bf9\u8c61\u672c\u8eab\uff0c\u53ef\u80fd\u662f\u4e00\u4e2a\u6307\u5411\u5bf9\u8c61\u8d77\u59cb\u5730\u5740\u7684\u5f15\u7528\u6307\u9488\uff0c\u4e5f\u53ef\u80fd\u662f\u6307\u5411\u4e00\u4e2a\u4ee3\u8868\u5bf9\u8c61\u7684\u53e5\u67c4\u6216\u5176\u5b83\u4e0e\u6b64\u5bf9\u8c61\u76f8\u5173\u7684\u4f4d\u7f6e\uff09</p> <p>Java \u865a\u62df\u673a\u6808\u4f1a\u51fa\u73b0\u4e24\u79cd\u9519\u8bef\uff1a<code>StackOverFlowError</code>\u3001<code>OutOfMemoryError</code>\u3002</p> <ul> <li><code>StackOverFlowError</code>\uff1a\u82e5 Java \u865a\u62df\u673a\u6808\u7684\u5185\u5b58\u5927\u5c0f\u4e0d\u5141\u8bb8\u52a8\u6001\u6269\u5c55\uff0c\u90a3\u4e48\u5f53\u7ebf\u7a0b\u8bf7\u6c42\u6808\u7684\u6df1\u5ea6\u8d85\u8fc7\u5f53\u524d Java \u865a\u62df\u673a\u6808\u7684\u6700\u5927\u6df1\u5ea6\u7684\u65f6\u5019\uff0c\u5c31\u629b\u51fa <code>OverOverFlowError</code> \u9519\u8bef\u3002</li> <li><code>OutOfMemoryError</code>\uff1a\u82e5 Java \u865a\u62df\u673a\u5806\u4e2d\u6ca1\u6709\u7a7a\u95f2\u5185\u5b58\uff0c\u5e76\u4e14\u5783\u573e\u56de\u6536\u5668\u4e5f\u65e0\u6cd5\u63d0\u4f9b\u66f4\u591a\u5185\u5b58\u7684\u8bdd\u3002\u5c31\u4f1a\u629b\u51fa <code>OutOfMemoryError</code>\u9519\u8bef\u3002</li> </ul> <p>Java \u865a\u62df\u673a\u6808\u4e5f\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u5404\u81ea\u7684 Java \u865a\u62df\u673a\u6808\uff0c\u800c\u4e14\u968f\u7740\u7ebf\u7a0b\u7684\u521b\u5efa\u800c\u521b\u5efa\uff0c\u968f\u7740\u7ebf\u7a0b\u7684\u6b7b\u4ea1\u800c\u6b7b\u4ea1\u3002</p>"},{"location":"lang/java/__guide__/jvm/#_2","title":"\u5806","text":"<p>Java \u865a\u62df\u673a\u6240\u7ba1\u7406\u7684\u5185\u5b58\u4e2d\uff0cJava \u5806\u662f\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u65f6\u521b\u5efa\u3002\u6b64\u5185\u5b58\u533a\u57df\u7684\u552f\u4e00\u76ee\u7684\u5c31\u662f\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5bf9\u8c61\u5b9e\u4f8b\u4ee5\u53ca\u6570\u7ec4\u90fd\u5728\u8fd9\u91cc\u5206\u914d\u5185\u5b58\u3002</p> <p>Java \u4e16\u754c\u4e2d\u201c\u51e0\u4e4e\u201d\u6240\u6709\u7684\u5bf9\u8c61\u90fd\u5728\u5806\u4e2d\u56fd\u5206\u914d\uff0c\u4f46\u662f\uff0c\u968f\u7740 JIT \u7f16\u8bd1\u671f\u7684\u53d1\u5c55\u4e0e\u9003\u9038\u5206\u6790\u6280\u672f\u9010\u6e10\u6210\u719f\uff0c\u6808\u4e0a\u5206\u914d\u3001\u6807\u91cf\u66ff\u6362\u4f18\u5316\u6280\u672f\u5c06\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5fae\u5999\u7684\u53d8\u5316\uff0c\u6240\u6709\u7684\u5bf9\u8c61\u90fd\u5206\u914d\u5230\u5806\u4e0a\u4e5f\u6e10\u6e10\u53d8\u5f97\u4e0d\u90a3\u4e48\u201c\u7edd\u5bf9\u201d\u4e86\u3002\u4ece JDK 1.7 \u5f00\u59cb\u5df2\u7ecf\u9ed8\u8ba4\u5f00\u542f\u9003\u9038\u5206\u6790\uff0c\u5982\u679c\u67d0\u4e9b\u65b9\u6cd5\u4e2d\u7684\u5bf9\u8c61\u5f15\u7528\u6ca1\u6709\u88ab\u8fd4\u56de\u6216\u8005\u672a\u88ab\u5916\u9762\u4f7f\u7528\uff08\u4e5f\u5c31\u662f\u672a\u9003\u9038\u51fa\u53bb\uff09\uff0c\u90a3\u4e48\u5bf9\u8c61\u53ef\u4ee5\u76f4\u63a5\u5728\u6808\u4e0a\u5206\u914d\u5185\u5b58\u3002</p> <p>Java \u5806\u662f\u5783\u573e\u6536\u96c6\u5668\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4e3a GC \u5806\uff08Garbage Collected Heap\uff09\u3002\u4ece\u5783\u573e\u56de\u6536\u7684\u89d2\u5ea6\uff0c\u7531\u4e8e\u73b0\u5728\u6536\u96c6\u5668\u57fa\u672c\u90fd\u91c7\u7528\u5206\u4ee3\u5783\u573e\u7b97\u6cd5\uff0c\u6240\u4ee5 Java \u5806\u8fd8\u53ef\u4ee5\u7ec6\u5206\u4e3a\uff1a\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u518d\u7ec6\u81f4\u4e00\u70b9\uff1aEden \u7a7a\u95f4\u3001From Survivor\u3001To Survivor \u7a7a\u95f4\u7b49\u3002\u8fdb\u4e00\u6b65\u5212\u5206\u7684\u76ee\u7684\u662f\u66f4\u597d\u7684\u56de\u6536\u5185\u5b58\uff0c\u6216\u8005\u66f4\u5feb\u5730\u5206\u914d\u5185\u5b58\u3002</p>"},{"location":"lang/java/jna/","title":"JNA","text":""},{"location":"lang/java/jna/#jni-jna","title":"JNI \u4e0e JNA","text":"<p>JNI \u7684\u66ff\u4ee3\u8005\u2014\u4f7f\u7528 JNA \u8bbf\u95ee Java \u5916\u90e8\u529f\u80fd\u63a5\u53e3</p>"},{"location":"lang/java/jna/#jni","title":"JNI \u8c03\u7528\u8fc7\u7a0b","text":"<p>\u5148\u8bf4 JNI(Java Native Interface)\u5427\uff0c\u6709\u8fc7\u4e0d\u901a\u8bed\u8a00\u95f4\u901a\u4fe1\u7ecf\u5386\u7684\u4e00\u822c\u90fd\u77e5\u9053\uff0c\u5b83\u5141\u8bb8 Java \u4ee3\u7801\u548c\u5176\u4ed6\u8bed\u8a00(\u5c24\u5176 C/C++)\u5199\u7684\u4ee3\u7801\u8fdb\u884c\u4ea4\u4e92\uff0c\u53ea\u8981\u9075\u5b88\u8c03\u7528\u7ea6\u5b9a\u5373\u53ef\u3002\u9996\u5148\u770b\u4e0b JNI \u8c03\u7528 C/C++ \u7684\u8fc7\u7a0b\uff0c\u6ce8\u610f\u5199\u7a0b\u5e8f\u65f6\u81ea\u4e0b\u800c\u4e0a\uff0c\u8c03\u7528\u65f6\u81ea\u4e0a\u800c\u4e0b\u3002</p> <p></p> <p>\u53ef\u89c1\u6b65\u9aa4\u975e\u5e38\u7684\u591a\uff0c\u5f88\u9ebb\u70e6\uff0c\u4f7f\u7528 JNI \u8c03\u7528 <code>.dll</code>/<code>.so</code> \u5171\u4eab\u5e93\u90fd\u80fd\u4f53\u4f1a\u5230\u8fd9\u4e2a\u75db\u82e6\u7684\u8fc7\u7a0b\u3002\u5982\u679c\u4e00\u4e2a\u7f16\u8bd1\u597d\u7684 <code>.dll</code>/<code>.so</code> \u6587\u4ef6\uff0c\u5982\u679c\u4f7f\u7528 JNI \u6280\u672f\u8c03\u7528\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u4f7f\u7528 C \u8bed\u8a00\u53e6\u5916\u5199\u4e00\u4e2a <code>.dll</code>/<code>.so</code> \u5171\u4eab\u5e93\uff0c\u4f7f\u7528 Sun \u89c4\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u66ff\u4ee3 C \u8bed\u8a00\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8c03\u7528\u5df2\u6709\u7684 <code>.dll</code>/<code>.so</code>\uff0c\u6700\u540e\u7f16\u5199 Java <code>native</code> \u51fd\u6570\u4f5c\u4e3a\u94fe\u63a5\u5e93\u4e2d\u51fd\u6570\u7684\u4ee3\u7406\u3002\u7ecf\u8fc7\u8fd9\u4e9b\u7e41\u7410\u7684\u6b65\u9aa4\u624d\u80fd\u5728 Java \u4e2d\u8c03\u7528\u672c\u5730\u4ee3\u7801\u3002\u56e0\u6b64\uff0c\u5f88\u5c11\u6709 Java \u7a0b\u5e8f\u5458\u613f\u610f\u7f16\u5199\u8c03\u7528 <code>.dll</code>/<code>.so</code> \u5e93\u4e2d\u539f\u751f\u51fd\u6570\u7684 Java \u7a0b\u5e8f\u3002\u8fd9\u4e5f\u4f7f Java \u8bed\u8a00\u5728\u5ba2\u6237\u7aef\u4e0a\u4e4f\u5584\u53ef\u9648\uff0c\u53ef\u4ee5\u8bf4 JNI \u662f Java \u7684\u4e00\u5927\u5f31\u70b9\uff01</p>"},{"location":"lang/java/jna/#jna_1","title":"JNA \u8c03\u7528\u8fc7\u7a0b","text":"<p>JNA(Java Native Access)\u662f\u4e00\u4e2a\u5f00\u6e90\u7684 Java \u6846\u67b6\uff0c\u7531 Sun \u516c\u53f8\u63a8\u51fa\u7684\u4e00\u79cd\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u7684\u6280\u672f\uff0c\u662f\u5efa\u7acb\u5728\u7ecf\u5178\u7684 JNI \u57fa\u7840\u4e4b\u4e0a\u7684\u4e00\u4e2a\u6846\u67b6\u3002\u4e4b\u6240\u4ee5\u8bf4\u5b83\u662f JNI \u7684\u66ff\u4ee3\u8005\uff0c\u662f\u56e0\u4e3a JNA \u5927\u5927\u7b80\u5316\u4e86\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u7684\u8fc7\u7a0b\uff0c\u4f7f\u7528\u5f88\u65b9\u4fbf\uff0c\u57fa\u672c\u4e0a\u4e0d\u9700\u8981\u8131\u79bb Java \u73af\u5883\u5c31\u53ef\u4ee5\u5b8c\u6210\u3002</p> <p>\u5982\u679c\u8981\u548c\u4e0a\u56fe\u505a\u4e2a\u6bd4\u8f83\uff0c\u90a3\u4e48 JNA \u8c03\u7528 C/C++ \u7684\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6b65\u9aa4\u51cf\u5c11\u4e86\u5f88\u591a\uff0c\u6700\u91cd\u8981\u7684\u662f\u6211\u4eec\u4e0d\u9700\u8981\u91cd\u5199\u6211\u4eec\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u6587\u4ef6\uff0c\u800c\u662f\u76f4\u63a5\u8c03\u7528\u7684 API\uff0c\u5927\u5927\u7b80\u5316\u4e86\u6211\u4eec\u7684\u5de5\u4f5c\u91cf\u3002</p>"},{"location":"lang/java/jna/#jna_2","title":"JNA \u6280\u672f\u539f\u7406","text":"<p>JNA \u4f7f\u7528\u4e00\u4e2a\u5c0f\u578b\u7684 JNI \u5e93\u63d2\u6869\u7a0b\u5e8f\u6765\u52a8\u6001\u8c03\u7528\u672c\u5730\u4ee3\u7801\u3002\u5f00\u53d1\u8005\u4f7f\u7528 Java \u63a5\u53e3\u63cf\u8ff0\u76ee\u6807\u672c\u5730\u5e93\u7684\u529f\u80fd\u548c\u7ed3\u6784\uff0c\u8fd9\u4f7f\u5f97\u5b83\u5f88\u5bb9\u6613\u5229\u7528\u672c\u673a\u5e73\u53f0\u7684\u529f\u80fd\uff0c\u800c\u4e0d\u4f1a\u4ea7\u751f\u591a\u5e73\u53f0\u914d\u7f6e\u548c\u751f\u6210 JNI \u4ee3\u7801\u7684\u9ad8\u5f00\u9500\u3002</p> <p>\u8fd9\u6837\u7684\u6027\u80fd\u3001\u51c6\u786e\u6027\u548c\u6613\u7528\u6027\u663e\u7136\u53d7\u5230\u5f88\u5927\u7684\u91cd\u89c6\u3002</p> <p>\u6b64\u5916\uff0cJNA \u5305\u62ec\u4e00\u4e2a\u5df2\u4e0e\u8bb8\u591a\u672c\u5730\u51fd\u6570\u6620\u5c04\u7684\u5e73\u53f0\u5e93\uff0c\u4ee5\u53ca\u4e00\u7ec4\u7b80\u5316\u672c\u5730\u8bbf\u95ee\u7684\u516c\u7528\u63a5\u53e3\u3002</p> <p>JNA \u662f\u5efa\u7acb\u5728 JNI \u6280\u672f\u57fa\u7840\u4e4b\u4e0a\u7684\u4e00\u4e2a Java \u7c7b\u5e93\uff0c\u5b83\u4f7f\u5f97\u4f60\u53ef\u4ee5\u65b9\u4fbf\u5730\u4f7f\u7528 Java \u76f4\u63a5\u8bbf\u95ee\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684\u51fd\u6570\u3002</p> <p>\u539f\u6765\u4f7f\u7528 JNI\uff0c\u4f60\u5fc5\u987b\u624b\u5de5\u5199\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5728 C \u8bed\u8a00\u4e2d\u6620\u5c04 Java \u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>JNA \u4e2d\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u52a8\u6001\u7684 C \u8bed\u8a00\u7f16\u5199\u7684\u8f6c\u53d1\u5668\uff0c\u53ef\u4ee5\u81ea\u52a8\u5b9e\u73b0 Java \u548c C \u6570\u636e\u7c7b\u578b\u6620\u5c04\uff0c\u4f60\u4e0d\u518d\u9700\u8981\u7f16\u5199 C \u52a8\u6001\u94fe\u63a5\u5e93\u3002</p> <p>\u4e5f\u8bb8\u8fd9\u610f\u5473\u7740\uff0c\u4f7f\u7528 JNA \u6280\u672f\u6bd4\u4f7f\u7528 JNI \u6280\u672f\u8c03\u7528\u52a8\u6001\u94fe\u63a5\u5e93\u4f1a\u6709\u4e9b\u5fae\u7684\u6027\u80fd\u635f\u5931\u3002\u4f46\u603b\u4f53\u5f71\u54cd\u4e0d\u5927\uff0c\u56e0\u4e3a JNA \u4e5f\u907f\u514d\u4e86 JNI \u7684\u4e00\u4e9b\u5e73\u53f0\u914d\u7f6e\u7684\u5f00\u9500\u3002</p>"},{"location":"lang/java/jna/#jna_3","title":"JNA \u6280\u672f\u96be\u70b9","text":"<p>\u6709\u8fc7\u8de8\u8bed\u8a00\u3001\u8de8\u5e73\u53f0\u5f00\u53d1\u7684\u7a0b\u5e8f\u5458\u90fd\u77e5\u9053\uff0c\u8de8\u8bed\u8a00\u3001\u8de8\u5e73\u53f0\u7684\u96be\u70b9\u5c31\u662f\u4e0d\u540c\u8bed\u8a00\u4e4b\u95f4\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4\u9020\u6210\u7684\u95ee\u9898\u3002\u7edd\u5927\u90e8\u5206\u8de8\u5e73\u53f0\u8c03\u7528\u7684\u5931\u8d25\u90fd\u662f\u8fd9\u4e2a\u95ee\u9898\u9020\u6210\u7684\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u65e0\u8bba\u4f55\u79cd\u8bed\u8a00\uff0c\u4f55\u79cd\u6280\u672f\u65b9\u6848\uff0c\u90fd\u65e0\u6cd5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002JNA \u4e5f\u4e0d\u4f8b\u5916\u3002</p> <p>\u4e0a\u9762\u8bf4\u5230\u63a5\u53e3\u4e2d\u4f7f\u7528\u7684\u51fd\u6570\u5fc5\u987b\u4e0e\u94fe\u63a5\u5e93\u4e2d\u7684\u51fd\u6570\u539f\u578b\u4fdd\u6301\u4e00\u81f4\uff0c\u8fd9\u662f JNA \u751a\u81f3\u6240\u6709\u8de8\u5e73\u53f0\u8c03\u7528\u7684\u96be\u70b9\uff0c\u56e0\u4e3a C/C++ \u7684\u7c7b\u578b\u4e0e Java \u7684\u7c7b\u578b\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6bd4\u5982 <code>printf</code> \u51fd\u6570\u5728 C \u4e2d\u7684\u539f\u578b\u4e3a\uff1a</p> <pre><code>void printf(const char* format[, arguments]);\n</code></pre> <p>\u4f60\u4e0d\u53ef\u80fd\u5728 Java \u4e2d\u4e5f\u8fd9\u4e48\u5199\uff0cJava \u4e2d\u662f\u6ca1\u6709 <code>char*</code> \u6307\u9488\u7c7b\u578b\u989d\uff0c\u56e0\u6b64 <code>const char*</code> \u8f6c\u5230 Java \u4e0b\u5c31\u662f String \u7c7b\u578b\u4e86\u3002 \u8fd9\u5c31\u662f\u7c7b\u578b\u6620\u5c04(Type Mappings)\uff0cJNA \u5b98\u65b9\u7ed9\u51fa\u7684\u9ed8\u8ba4\u7c7b\u578b\u6620\u5c04\u8868\u5982\u4e0b\uff1a</p> <p>(Default Type Mappings)[https://github.com/java-native-access/jna/blob/master/www/Mappings.md]</p> Native Type Size Java Type Common Windows Types <code>char</code> 8-bit integer <code>byte</code> <code>BYTE</code>, <code>TCHAR</code> <code>short</code> 16-bit integer <code>short</code> <code>WORD</code> <code>wchar_t</code> 16/32-bit character <code>char</code> <code>TCHAR</code> <code>int</code> 32-bit integer <code>int</code> <code>DWORD</code> <code>int</code> boolean value <code>boolean</code> <code>BOOL</code> <code>long</code> 32/64-bit integer <code>NativeLong</code> <code>LONG</code> <code>long long</code> 64-bit integer <code>long</code> <code>__int64</code> <code>float</code> 32-bit FP <code>float</code> <code>double</code> 64-bit FP <code>double</code> <code>char*</code> C string <code>String</code> <code>LPCSTR</code> <code>void*</code> pointer <code>Pointer</code> <code>LPVOID</code>, <code>HANDLE</code>, <code>LP*XXX*</code>"},{"location":"lang/java/jna/#jna-jni","title":"JNA \u80fd\u5b8c\u5168\u66ff\u4ee3 JNI \u5417","text":"<p>\u8fd9\u53ef\u80fd\u662f\u5927\u5bb6\u6bd4\u8f83\u5173\u5fc3\u7684\u95ee\u9898\uff0c\u4f46\u662f\u9057\u61be\u7684\u662f\uff0cJNA \u662f\u4e0d\u80fd\u5b8c\u5168\u66ff\u4ee3 JNI \u7684\uff0c\u56e0\u4e3a\u6709\u4e9b\u9700\u6c42\u8fd8\u662f\u5fc5\u987b\u6c42\u52a9\u4e8e JNI\u3002 \u4f7f\u7528 JNI \u6280\u672f\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5b9e\u73b0 Java \u8bbf\u95ee C \u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0 C \u8bed\u8a00\u8c03\u7528 Java \u4ee3\u7801\u3002 \u800c JNA \u53ea\u80fd\u5b9e\u73b0 Java \u8bbf\u95ee C \u51fd\u6570\uff0c\u4f5c\u4e3a\u4e00\u4e2a Java \u6846\u67b6\uff0c\u81ea\u7136\u4e0d\u80fd\u5b9e\u73b0 C \u8bed\u8a00\u8c03\u7528 Java \u4ee3\u7801\u3002\u6b64\u65f6\uff0c\u4f60\u8fd8\u662f\u9700\u8981\u4f7f\u7528 JNI \u6280\u672f\u3002</p> <p>JNI \u662f JNA \u7684\u57fa\u7840\uff0c\u662f Java \u548c C \u4e92\u64cd\u4f5c\u7684\u6280\u672f\u57fa\u7840\u3002\u6709\u65f6\u5019\uff0c\u4f60\u5fc5\u987b\u56de\u5f52\u5230\u57fa\u7840\u4e0a\u6765\u3002</p>"},{"location":"lang/java/jna/__demo__/everything-dll-jna/","title":"JAVA \u901a\u8fc7 JNA \u8c03\u7528 Everything \u52a8\u6001\u94fe\u63a5\u5e93","text":""},{"location":"lang/java/servlet/","title":"Servlet","text":""},{"location":"lang/java/servlet/#_1","title":"\u6536\u85cf","text":"<ul> <li>JavaEE-JSP \u57fa\u7840-EL \u8868\u8fbe\u5f0f\u548c JSTL \u6807\u7b7e\u5e93(Taglibs)</li> </ul>"},{"location":"lang/java/servlet/__demo__/mvc-demo/","title":"\u624b\u52a8\u5b9e\u73b0 Spring MVC \u57fa\u672c\u529f\u80fd","text":""},{"location":"lang/java/servlet/__demo__/servlet-demo/","title":"Index","text":""},{"location":"lang/java/servlet/__demo__/servlet-demo/#_1","title":"\u73af\u5883","text":"\u73af\u5883 \u7248\u672c \u5176\u5b83 JDK 11 MySQL 8.0.23 \u7528\u6237\u540d\uff08<code>root</code>\uff09\u5bc6\u7801\uff08<code>root</code>\uff09\u914d\u7f6e\uff08<code>lower_case_table_names=1</code>\uff09 Tomcat 9.0.38 \u53c2\u6570\uff08<code>-Dfile.encoding=UTF-8</code>\uff09"},{"location":"lang/java/servlet/__demo__/servlet-demo/#_2","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n    &lt;version&gt;4.0.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.taglibs&lt;/groupId&gt;\n    &lt;artifactId&gt;taglibs-standard-compat&lt;/artifactId&gt;\n    &lt;version&gt;1.2.5&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;mysql&lt;/groupId&gt;\n    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n    &lt;version&gt;8.0.23&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"lang/java/servlet/__demo__/servlet-demo/#_3","title":"\u76ee\u5f55","text":"<pre><code>test/\n|--pom.xml\n|--db\n   |--test.sql                                     # \u6570\u636e\u5e93\u521d\u59cb\u5316\u811a\u672c\n|--src/main/\n   |--java/\n      |--xyz.icefery.test.\n         |--entity\n            |--Customer                            # \u5ba2\u6237\u5b9e\u4f53\u7c7b\n         |--dao\n            |--CustomerDAO                         # \u5ba2\u6237\u521b\u5efa\u3001\u67e5\u8be2\u64cd\u4f5c\uff08\u9759\u6001\u65b9\u6cd5\uff09\n         |--filter\n            |--RequestCharacterEncodingFilter      # \u8bbe\u7f6e request \u7f16\u7801\u4e3a UTF-8\n         |--servlet\n            |--CusomerServlet                      # \u5ba2\u6237\u521b\u5efa\u3001\u67e5\u8be2\u63a7\u5236\u5668\uff08\u9759\u6001\u5185\u90e8\u7c7b\uff09\n               |--CreateServlet\n               |--ListServlet\n   |--webapp/                                      # WEB \u6839\u76ee\u5f55\n      |--WEB-INF/\n         |--web.xml\n         |--index.jsp                              # \u5c55\u793a\u9875\u9762\n</code></pre>"},{"location":"lang/java/servlet/__demo__/servlet-demo/#_4","title":"\u9884\u89c8","text":"<p>\u9996\u9875\uff08\u5217\u8868\u9875\uff09</p> <p></p> <p>\u6821\u9a8c\u5931\u8d25</p> <p></p> <p>\u6839\u636e\u51fa\u751f\u65e5\u671f\u67e5\u8be2</p> <p></p>"},{"location":"lang/javascript/","title":"JavaScript","text":""},{"location":"lang/javascript/#_1","title":"\u6536\u85cf","text":"<ul> <li> <p>npm &amp;&amp; \u4e32\u884c\u4efb\u52a1\u7684\u65f6\u5019 cross-env \u51fa\u73b0\u95ee\u9898</p> </li> <li> <p>\u524d\u7aef\u7ecf\u5178\u9762\u8bd5\u9898: \u4ece\u8f93\u5165 URL \u5230\u9875\u9762\u52a0\u8f7d\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> </li> <li> <p>\u53ef\u89c6\u5316\u5de5\u5177 D3 \u6559\u7a0b</p> </li> <li> <p>node-sass \u4e0b\u8f7d\u5931\u8d25 \u89e3\u51b3\u65b9\u6848 #24</p> </li> <li> <p>\u4e3a\u4ec0\u4e48 npm \u8981\u4e3a\u6bcf\u4e2a\u9879\u76ee\u5355\u72ec\u5b89\u88c5\u4e00\u904d node_modules\uff1f</p> </li> <li> <p>electron-vue \u8de8\u5e73\u53f0\u684c\u9762\u5e94\u7528\u5f00\u53d1\u5b9e\u6218\u6559\u7a0b\uff08\u4e03\uff09\u2014\u2014ffi \u8c03\u7528 C++\uff08Windows \u5e73\u53f0\uff09</p> </li> <li> <p>NodeJS VM \u548c VM2 \u6c99\u7bb1\u9003\u9038</p> </li> </ul>"},{"location":"lang/javascript/TypeScript%20%2B%20pkg/","title":"TypeScript + pkg","text":""},{"location":"lang/javascript/TypeScript%20%2B%20pkg/#typescript-pkg","title":"TypeScript + pkg","text":""},{"location":"lang/javascript/TypeScript%20%2B%20pkg/#_1","title":"\u914d\u7f6e","text":"<ul> <li> <p>package.json</p> <pre><code>{\n  \"name\": \"my-app\",\n  \"version\": \"0.0.1\",\n  \"scripts\": {\n    \"prettier\": \"prettier --write .\",\n    \"dev\": \"ts-node ./src/main.ts\",\n    \"clean\": \"rm -rf ./bin/* &amp;&amp; rm -rf ./dist/*\",\n    \"build\": \"tsc &amp;&amp; pkg .\"\n  },\n  \"bin\": \"./dist/main.js\",\n  \"pkg\": {\n    \"output\": \"my-app\",\n    \"outputPath\": \"./bin\",\n    \"targets\": [\"node18-win-x64\", \"node18-linux-x64\"]\n  },\n  \"devDependencies\": {\n    \"pkg\": \"^5.8.1\",\n    \"ts-node\": \"^10.9.1\",\n    \"typescript\": \"^5.3.2\"\n  }\n}\n</code></pre> </li> <li> <p>tsconfig.json</p> <pre><code>{\n  \"compilerOptions\": {\n    \"target\": \"esnext\",\n    \"module\": \"commonjs\",\n    \"outDir\": \"./dist\"\n  }\n}\n</code></pre> </li> </ul>"},{"location":"lang/javascript/fnm/","title":"fnm","text":""},{"location":"lang/javascript/fnm/#_1","title":"\u5b89\u88c5","text":"<pre><code>curl -L -O \"$(curl -s \"https://api.github.com/repos/Schniz/fnm/releases/latest\" | jq -r '.assets[] | select(.name | test(\"fnm-linux.zip$\")) | .browser_download_url')\"\n\nmkdir -p /opt/env/fnm\n\nunzip -d /opt/env/fnm fnm-linux.zip\n\nchmod +x /opt/env/fnm\n</code></pre> <pre><code>export FNM_DIR=\"/opt/env/fnm\"\nexport FNM_NODE_DIST_MIRROR=\"https://mirrors.tuna.tsinghua.edu.cn/nodejs-release\"\nexport PATH=\"${FNM_DIR}:$PATH\"\n\nif [[ $(command -v \"fnm\") ]]; then\n    eval \"$(fnm env --use-on-cd)\"\n    eval \"$(fnm completions --shell bash)\"\nfi\n</code></pre> <pre><code>fnm install --lts\n</code></pre>"},{"location":"lang/javascript/n/","title":"N","text":""},{"location":"lang/javascript/n/#_1","title":"\u5b89\u88c5","text":"<pre><code>curl -L https://bit.ly/n-install | bash\n</code></pre>"},{"location":"lang/javascript/n/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<ul> <li> <p>\u5207\u6362 LTS \u7248\u672c</p> <pre><code>  n lts\n</code></pre> </li> </ul>"},{"location":"lang/javascript/npm/","title":"Npm","text":""},{"location":"lang/javascript/npm/#_1","title":"\u6362\u6e90","text":"<pre><code>npm config set registry http://registry.npm.taobao.org\n\nnpm config get\n\n# npm config set registry https://registry.npmjs.org/\n</code></pre>"},{"location":"lang/javascript/npm/#_2","title":"\u5168\u5c40\u68c0\u67e5\u66f4\u65b0","text":"<pre><code>npm outdated -g --depth=0\n</code></pre>"},{"location":"lang/javascript/npm/#_3","title":"\u67e5\u770b\u5168\u5c40\u5305","text":"<pre><code>npm list -g --depth 0\n</code></pre>"},{"location":"lang/javascript/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"lang/javascript/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/#node-sass","title":"<code>node-sass</code> \u5b89\u88c5\u5931\u8d25","text":"<p>\u53c2\u8003\uff1ahttps://github.com/PanJiaChen/vue-element-admin/issues/24</p> <pre><code>npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass\n</code></pre>"},{"location":"lang/javascript/%E8%A1%A8%E6%A0%BC%E5%88%97%E5%90%8D%E8%BD%AC%E5%BA%8F%E5%8F%B7/","title":"\u8868\u683c\u5217\u540d\u8f6c\u5e8f\u53f7","text":"<pre><code>// 'AM' =&gt; '39'\nfunction codeToNum(code) {\n  const arr = code.toLowerCase().split('')\n  let num = 0\n  for (var i = 0; i &lt; arr.length; i++) {\n    num += (arr[i].charCodeAt(0) - 96) * Math.pow(26, arr.length - i - 1)\n  }\n  return num\n}\n\n// '39' =&gt; 'AM'\nfunction numToCode(num) {\n  const arr = []\n  const recurse = nnum =&gt; {\n    var num = nnum - 1\n    var a = parseInt(num / 26)\n    var b = num % 26\n    arr.push(String.fromCharCode(64 + parseInt(b + 1)))\n    if (a &gt; 0) {\n      recurse(a)\n    }\n  }\n  recurse(num)\n  return arr.reverse().join('')\n}\n</code></pre>"},{"location":"lang/javascript/%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE%E5%85%9C%E5%BA%95%E5%A4%84%E7%90%86/","title":"\u8868\u683c\u6570\u636e\u515c\u5e95\u5904\u7406","text":"<pre><code>const dataList = [\n  { f1: '', f2: null, f3: undefined },\n  { f1: '\u96f6', f2: '0', f3: 0 }\n]\n\nconst columnList = [\n  { index: 'f1', label: '\u5217\u4e00' },\n  { index: 'f2', label: '\u5217\u4e8c' },\n  { index: 'f3', label: '\u5217\u4e09' },\n  { index: 'f4', label: '\u5217\u56db' }\n]\n\ndataList.forEach(it =&gt; columnList.forEach(({ index: column }) =&gt; (it[column] = it[column] || '')))\n\nconsole.log(dataList)\n</code></pre>"},{"location":"lang/javascript/%E9%80%92%E5%BD%92%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6/","title":"\u9012\u5f52\u5904\u7406\u6587\u4ef6","text":"<pre><code>const fs = require('fs')\nconst path = require('path')\n\nfunction recurse(src, dst, filter, processor) {\n  if (filter(src, dst, filter)) {\n    const stats = fs.statSync(src)\n    if (stats.isDirectory()) {\n      fs.mkdirSync(dst, { recursive: true })\n      fs.readdirSync(src).forEach(sub =&gt; recursive(path.join(src, sub), path.join(dst, sub)), filter, processor)\n    } else if (stats.isFile()) {\n      processor(src, dst)\n    }\n  }\n}\n\nfunction copyTxt(src, dst) {\n  recurse(\n    src,\n    dst,\n    (src, dst) =&gt; path.extname(src) === '.txt',\n    (src, dst) =&gt; fs.createReadStream(src).pipe(fs.createWriteStream(dst))\n  )\n}\n\ncopyText('~/a', '~/b')\n</code></pre>"},{"location":"lang/javascript/__demo__/recurse-dir/","title":"Index","text":""},{"location":"lang/javascript/__demo__/recurse-dir/#modules","title":"Modules","text":"<ul> <li><code>recurse</code></li> <li><code>copy-txt</code></li> </ul>"},{"location":"lang/javascript/__demo__/xfyun-tts-iat-demo/","title":"Index","text":""},{"location":"lang/javascript/__demo__/xfyun-tts-iat-demo/#-","title":"\u8baf\u98de-\u5728\u7ebf\u8bed\u97f3\u5408\u6210","text":""},{"location":"lang/latex/","title":"LaTex","text":""},{"location":"lang/latex/#_1","title":"\u6536\u85cf","text":"<ul> <li>Latex \u8f93\u5165\u77e9\u9635\u7684\u51e0\u79cd\u65b9\u5f0f</li> </ul>"},{"location":"lang/python/","title":"Python","text":""},{"location":"lang/python/#minconda","title":"minconda","text":""},{"location":"lang/python/#_1","title":"\u5378\u8f7d","text":"<pre><code>conda init --reverse --all\n\nrm -rf ~/.condarc ~/.conda ~/.continuum\n\nrm -rf /opt/env/miniconda\n</code></pre>"},{"location":"lang/python/#_2","title":"\u5e38\u89c1\u95ee\u9898","text":"<ul> <li> <p>pip is being invoked by an old script wrapper. This will fail in a future version of pip</p> <p>https://blog.csdn.net/weixin_44110913/article/details/109533700</p> <ul> <li> <p>\u91cd\u88c5</p> <pre><code>python3 -m pip uninstall pip\n\npython3 -m pip install --upgrade pip\n</code></pre> </li> <li> <p>\u5237\u65b0\u73af\u5883\u53d8\u91cf</p> <p>\u89e3\u51b3 <code>which pip</code> \u5df2\u6b63\u786e\u5b89\u88c5\u5728 <code>/usr/local/bin</code> \u76ee\u5f55\u4e0b\uff0c\u4f46 <code>pip</code> \u547d\u4ee4\u4f9d\u7136\u4f7f\u7528 <code>/usr/bin</code> \u7684\u95ee\u9898</p> <pre><code>source /etc/profile\n</code></pre> </li> </ul> </li> </ul>"},{"location":"lang/python/#_3","title":"\u6536\u85cf","text":""},{"location":"lang/python/#python-c","title":"Python \u8c03\u7528 C \u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u5305\u62ec\u7ed3\u6784\u4f53\u53c2\u6570\u3001\u56de\u8c03\u51fd\u6570\u7b49","text":""},{"location":"lang/python/#python-python","title":"Python\uff1a\u5b9e\u4f8b\u8bb2\u89e3 Python \u4e2d\u7684\u9b54\u6cd5\u51fd\u6570\uff08\u9ad8\u7ea7\u8bed\u6cd5\uff09","text":""},{"location":"lang/python/#sqlalchemy20","title":"sqlalchemy2.0 \u4f7f\u7528\u8bb0\u5f55","text":""},{"location":"lang/python/#python_1","title":"\u4f60\u771f\u7684\u4e86\u89e3 python \u4e2d\u7684\u6362\u884c\u4ee5\u53ca\u8f6c\u4e49\u5417?","text":""},{"location":"lang/python/#3-pandas-fillna-dropdrop_duplicatesdropna","title":"3-Pandas \u6570\u636e\u521d\u63a2\u7d22\u4e4b\u7f3a\u5931\u503c\u5904\u7406\u4e0e\u4e22\u5f03\u6570\u636e\uff08\u586b\u5145 fillna()\u3001\u5220\u9664 drop()\u3001drop_duplicates()\u3001dropna()\uff09","text":""},{"location":"lang/python/#python-subprocesspopen-stdout-stderr-input","title":"Python \u5229\u7528\u591a\u7ebf\u7a0b\u5b9e\u65f6\u8bfb\u53d6 subprocess.Popen \u7684\u7a0b\u5e8f\u8f93\u51fa\u7684 stdout \u548c stderr\uff0c\u5e76\u4e14\u5411\u5176\u4e2d\u5b9e\u65f6\u4f20\u5165 input \u4fe1\u606f\u3002","text":""},{"location":"lang/python/mkdocs/","title":"MkDocs","text":""},{"location":"lang/python/mkdocs/#material-for-mkdocs","title":"Material for MkDocs","text":""},{"location":"lang/python/mkdocs/#_1","title":"\u914d\u7f6e","text":"<ol> <li> <p>A</p> <pre><code>tab1:\n  tab2:\n    tab3:\n</code></pre> </li> <li> <p><code>mkdocs.css</code></p> <pre><code>.md-grid {\n  max-width: 1680px;\n}\n</code></pre> </li> <li> <p><code>mkdocs.yaml</code></p> <pre><code>site_name: '\u5341\u4e8c\u7ffc\u5815\u843d\u5929\u4f7f'\nsite_url: https://demo.icefery.xyz\nsite_author: '\u6559\u4e3b'\n\nrepo_name: icefery/demo.icefery.xyz\nrepo_url: https://github.com/icefery/demo.icefery.xyz\n\ndocs_dir: root\nsite_dir: dist\n\ntheme:\n  name: material\n  features:\n    - announce.dismiss\n    # - content.action.edit\n    # - content.action.view\n    - content.code.annotate\n    - content.code.copy\n    # - content.code.select\n    # - content.footnote.tooltips\n    # - content.tabs.link\n    - content.tooltips\n    # - header.autohide\n    # - navigation.expand\n    # - navigation.footer\n    - navigation.indexes\n    - navigation.instant\n    - navigation.instant.prefetch\n    - navigation.instant.progress\n    # - navigation.prune\n    - navigation.sections\n    - navigation.tabs\n    - navigation.tabs.sticky\n    - navigation.top\n    - navigation.tracking\n    - search.highlight\n    - search.share\n    - search.suggest\n    - toc.follow\n    # - toc.integrate\n  palette:\n    - media: '(prefers-color-scheme: light)'\n      scheme: default\n      toggle:\n        icon: material/brightness-7\n    - media: '(prefers-color-scheme: dark)'\n      scheme: slate\n      toggle:\n        icon: material/brightness-4\n  font:\n    text: Roboto\n    code: Roboto Mono\n  favicon: https://avatars.githubusercontent.com/u/61737634\n  logo: https://avatars.githubusercontent.com/u/61737634\n  icon:\n    repo: fontawesome/brands/github\n\nplugins:\n  - search:\n\nmarkdown_extensions:\n  - abbr\n  - admonition\n  - attr_list\n  - def_list\n  - footnotes\n  - md_in_html\n  - toc:\n      permalink: true\n  - pymdownx.arithmatex:\n      generic: true\n  - pymdownx.betterem:\n      smart_enable: all\n  - pymdownx.caret\n  - pymdownx.details\n  - pymdownx.emoji:\n      emoji_generator: !!python/name:material.extensions.emoji.to_svg\n      emoji_index: !!python/name:material.extensions.emoji.twemoji\n  - pymdownx.highlight:\n      anchor_linenums: true\n      line_spans: __span\n      pygments_lang_class: true\n  - pymdownx.inlinehilite\n  - pymdownx.keys\n  - pymdownx.magiclink:\n      normalize_issue_symbols: true\n      repo_url_shorthand: true\n      user: squidfunk\n      repo: mkdocs-material\n  - pymdownx.mark\n  - pymdownx.smartsymbols\n  - pymdownx.snippets:\n  - pymdownx.superfences:\n      custom_fences:\n        - name: mermaid\n          class: mermaid\n          format: !!python/name:pymdownx.superfences.fence_code_format\n  - pymdownx.tabbed:\n      alternate_style: true\n      combine_header_slug: true\n      slugify: !!python/object/apply:pymdownx.slugs.slugify\n        kwds:\n          case: lower\n  - pymdownx.tasklist:\n      custom_checkbox: true\n  - pymdownx.tilde\n\nextra_css:\n  - __static__/css/mkdocs.css\n</code></pre> </li> </ol>"},{"location":"lang/python/pip/","title":"Pip","text":""},{"location":"lang/python/pip/#_1","title":"\u5b89\u88c5","text":"<pre><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py\n\npython get-pip.py\n</code></pre>"},{"location":"lang/python/pip/#pippipconf","title":"\u6362\u6e90 <code>~/.pip/pip.conf</code>","text":"<pre><code>[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple/\n</code></pre>"},{"location":"lang/python/pip/#_2","title":"\u6279\u91cf\u5b89\u88c5","text":"<pre><code>pip install -r requirements.txt\n</code></pre> <p>\u5176\u4e2d <code>requirements.txt</code>\u6587\u4ef6\u4e2d\u9884\u5148\u5199\u597d\u9700\u8981\u5b89\u88c5\u7684\u5e93\u540d\uff08\u6bcf\u884c\u4e00\u4e2a\u5e93\uff09</p>"},{"location":"lang/python/pip/#_3","title":"\u67e5\u770b\u914d\u7f6e","text":"<pre><code>pip3 config list -v\n</code></pre> <pre><code>  For variant 'global', will try loading '/Library/Application Support/pip/pip.conf'\n  For variant 'user', will try loading '/Users/icefery/.pip/pip.conf'\n  For variant 'user', will try loading '/Users/icefery/.config/pip/pip.conf'\n  For variant 'site', will try loading '/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/pip.conf'\n</code></pre>"},{"location":"lang/python/ubuntu22.04%20%E5%AE%89%E8%A3%85%20python2/","title":"Ubuntu22.04 \u5b89\u88c5 python2","text":""},{"location":"lang/python/ubuntu22.04%20%E5%AE%89%E8%A3%85%20python2/#python2","title":"\u5b89\u88c5 Python2","text":"<p>ubuntu22.04 \u9ed8\u8ba4\u5df2\u7ecf\u4e0d\u5e26 Python2 \u4e86\u3002</p> <pre><code>apt install python2\n</code></pre>"},{"location":"lang/python/ubuntu22.04%20%E5%AE%89%E8%A3%85%20python2/#python2-pip","title":"\u5b89\u88c5 Python2 \u7248\u672c\u7684 Pip","text":"<pre><code>curl https://bootstrap.pypa.io/2.7/get-pip.py -o get-pip.py\n\npython2 get-pip.py\n</code></pre>"},{"location":"lang/python/ubuntu22.04%20%E5%AE%89%E8%A3%85%20python2/#python2-pandas","title":"\u5b89\u88c5 Python2 \u7248\u672c\u7684 Pandas","text":"<p>\u4f7f\u7528 pip install pandas \u9ed8\u8ba4\u5b89\u88c5\u7684\u662f\u6700\u65b0\u7248\u7684 pandas\uff0c\u56e0\u4e3a pandas \u7248\u672c 0.24.0 \u4ee5\u540e\u7684\u7248\u672c\u4e0d\u518d\u652f\u6301 python2.7\uff0c\u56e0\u6b64\u6307\u5b9a pandas0.23.0 \u53ca\u4ee5\u524d\u7684\u7248\u672c\u5373\u53ef</p> <pre><code>pip install pandas==0.23.0\n</code></pre>"},{"location":"lang/python/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"lang/python/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/#pip-is-being-invoked-by-an-old-script-wrapper-this-will-fail-in-a-future-version-of-pip","title":"pip is being invoked by an old script wrapper. This will fail in a future version of pip","text":"<p>https://blog.csdn.net/weixin_44110913/article/details/109533700</p> <ul> <li> <p>\u91cd\u88c5</p> <pre><code>python3 -m pip uninstall pip\n\npython3 -m pip install --upgrade pip\n</code></pre> </li> <li> <p>\u5237\u65b0\u73af\u5883\u53d8\u91cf</p> <p>\u89e3\u51b3 <code>which pip</code> \u5df2\u6b63\u786e\u5b89\u88c5\u5728 <code>/usr/local/bin</code> \u76ee\u5f55\u4e0b\uff0c\u4f46 <code>pip</code> \u547d\u4ee4\u4f9d\u7136\u4f7f\u7528 <code>/usr/bin</code> \u7684\u95ee\u9898</p> <pre><code>source /etc/profile\n</code></pre> </li> </ul>"},{"location":"lang/python/%E8%A3%85%E9%A5%B0%E5%99%A8/","title":"\u88c5\u9970\u5668","text":"<pre><code>def proxy(func):\n    def around():\n        print(\"@Before\")\n        func()\n        print(\"@After\")\n    return around\n\ndef func():\n    print(\"func\")\n\nproxy(func)()\n</code></pre> <pre><code>def proxy(func):\n    def around():\n        print(\"@Before\")\n        func()\n        print(\"@After\")\n    return around\n\n@proxy\ndef func():\n    print(\"func\")\n\nfunc()\n</code></pre>"},{"location":"lang/regexp/","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"lang/regexp/#_2","title":"\u6536\u85cf","text":"<ul> <li>\u600e\u6837\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u53bb\u9664\u6587\u672c\u4e2d\u7684\u6807\u70b9\u7b26\u53f7</li> </ul>"},{"location":"lang/rust/","title":"Rust","text":""},{"location":"lang/rust/#_1","title":"\u5b89\u88c5","text":"<pre><code>export CARGO_HOME=/opt/env/cargo\nexport RUSTUP_HOME=/opt/env/rustup\nexport RUSTUP_DIST_SERVER=https://mirrors.tuna.tsinghua.edu.cn/rustup\nexport RUSTUP_UPDATE_ROOT=https://mirrors.tuna.tsinghua.edu.cn/rustup/rustup\nexport PATH=$CARGO_HOME/bin:$PATH\n\n[[ -x rustup ]] &amp;&amp; source &lt;(rustup completions bash)\n\nmkdir -pv ${CARGO_HOME}\n\ncat &lt;&lt;- 'EOF' | tee ${CARGO_HOME}/config.toml &gt; /dev/null\n[source.tuna]\nregistry = \"https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git\"\n\n[source.crates-io]\nreplace-with = \"tuna\"\nEOF\n</code></pre> <pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n</code></pre>"},{"location":"lang/rust/#_2","title":"\u6536\u85cf","text":""},{"location":"lang/rust/#rust_1","title":"\u5b66\u4e60 Rust \u4f60\u9700\u8981\u4e00\u4e2a\u8ba4\u77e5\u6846\u67b6","text":""},{"location":"lang/scala/","title":"Scala","text":""},{"location":"lang/scala/#_1","title":"\u6536\u85cf","text":"<ul> <li>scala \u4e2d\u4e3a\u4ec0\u4e48\u4e0d\u5efa\u8bae\u7528 return_u010256841 \u7684\u4e13\u680f-CSDN \u535a\u5ba2</li> </ul>"},{"location":"lang/typescript/","title":"TypeScript","text":""},{"location":"lang/typescript/#_1","title":"\u6536\u85cf","text":""},{"location":"lang/typescript/#optional","title":"\u5b9e\u73b0 Optional","text":"<pre><code>type Optional&lt;T, K extends keyof T&gt; = Omit&lt;T, K&gt; &amp; Partial&lt;Pick&lt;T, K&gt;&gt;\n\ninterface Article {\n  title: string\n  content: string\n  author: string\n  date: Date\n  readCount: number\n}\n\ntype CreateArticleOptions = Optional&lt;Article, 'author' | 'date' | 'readCount'&gt;\n\nfunction createArticle(options: CreateArticleOptions) {}\n</code></pre>"},{"location":"lang/typescript/#infer","title":"\u4f7f\u7528 infer \u5c01\u88c5\u901a\u7528\u7c7b\u578b\u5de5\u5177","text":"<pre><code>/**\n * \u63d0\u53d6 Promise \u4e2d\u7684\u7c7b\u578b\n */\ntype PromiseType&lt;T&gt; = T extends Promise&lt;infer K&gt; ? PromiseType&lt;K&gt; : T\n\ntype T1 = PromiseType&lt;Promise&lt;Promise&lt;string&gt;&gt;&gt; // string\n\n/**\n * \u63d0\u53d6\u51fd\u6570\u7b2c\u4e00\u4e2a\u53c2\u6570\u7c7b\u578b\n */\ntype FirstArgType&lt;T&gt; = T extends (first: infer F, ...args: any[]) =&gt; any ? F : T\n\ntype T2 = FirstArgType&lt;(name: string, age: number) =&gt; void&gt; // string\n\n/**\n * \u63d0\u53d6\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\n */\ntype MyReturnType&lt;T&gt; = T extends (...args: any[]) =&gt; infer R ? R : T\n\ntype Sum = (a: number, b: number) =&gt; number\n\ntype T3 = MyReturnType&lt;Sum&gt; // number\n</code></pre>"},{"location":"lang/yaml/REAEME/","title":"Yaml","text":""},{"location":"lang/yaml/REAEME/#_1","title":"\u591a\u884c\u5b57\u7b26\u4e32","text":""},{"location":"lang/yaml/REAEME/#_2","title":"<code>|</code> \u4fdd\u7559\u884c\u5c3e\u6362\u884c\u7b26","text":"<pre><code>text: |\n  hello\n  world\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello\\nworld\\n\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"lang/yaml/REAEME/#-","title":"<code>|-</code>","text":"<pre><code>text: |-\n  hello\n  world\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello\\nworld\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"lang/yaml/REAEME/#_3","title":"<code>|+</code>","text":"<pre><code>text: |+\n  hello\n  world\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello\\nworld\\n\\n\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"lang/yaml/REAEME/#_4","title":"<code>&gt;</code>","text":"<pre><code>text: &gt;\n  hello\n  world\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello world\\n\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"lang/yaml/REAEME/#-_1","title":"<code>&gt;-</code>","text":"<pre><code>text: &gt;-\n  hello\n  world\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello world\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"lang/yaml/REAEME/#_5","title":"<code>&gt;+</code>","text":"<pre><code>text: &gt;+\n  hello\n  world\n\n\nn: 1\n</code></pre> <pre><code>{\n  \"text\": \"hello world\\n\\n\\n\",\n  \"n\": 1\n}\n</code></pre>"},{"location":"load-balance/","title":"\u8d1f\u8f7d\u5747\u8861","text":""},{"location":"load-balance/nginx/","title":"Nginx","text":""},{"location":"load-balance/nginx/#_1","title":"\u6536\u85cf","text":"<ul> <li>nginx.conf \u6587\u4ef6\u5185\u5bb9\u8be6\u89e3</li> </ul>"},{"location":"load-balance/nginx/%E6%9C%80%E7%AE%80%E9%85%8D%E7%BD%AE/","title":"\u6700\u7b80\u914d\u7f6e","text":""},{"location":"load-balance/nginx/%E6%9C%80%E7%AE%80%E9%85%8D%E7%BD%AE/#_1","title":"\u524d\u63d0\u73af\u5883","text":"<pre><code>apt install nginx -y\n\nrm -r /etc/nginx/*\n</code></pre>"},{"location":"load-balance/nginx/%E6%9C%80%E7%AE%80%E9%85%8D%E7%BD%AE/#_2","title":"\u6700\u7b80\u53cd\u5411\u4ee3\u7406\u914d\u7f6e","text":"<pre><code>events {\n\n}\n\nhttp {\n    server {\n        listen 80;\n        location / {\n            proxy_pass https://www.baidu.com;\n        }\n    }\n}\n</code></pre>"},{"location":"load-balance/nginx/%E6%9C%80%E7%AE%80%E9%85%8D%E7%BD%AE/#_3","title":"\u6700\u7b80\u8d1f\u8f7d\u5747\u8861","text":"<pre><code>events {\n\n}\n\nhttp {\n    upstream cluster {\n        server ubuntu101:8080 weight=1;\n        server ubuntu102:8080 weight=1;\n        server ubuntu103:8080 weight=1;\n    }\n    location / {\n        proxy_pass http://cluster;\n    }\n}\n</code></pre>"},{"location":"middleware/","title":"\u4e2d\u95f4\u4ef6","text":""},{"location":"middleware/canal/","title":"Canal","text":""},{"location":"middleware/canal/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"middleware/canal/#_2","title":"\u5b89\u88c5","text":"<pre><code>wget https://github.com/alibaba/canal/releases/download/canal-1.1.6/canal.deployer-1.1.6.tar.gz\n\nmkdir -p /opt/env/canal\n\ntar -zxvf canal.deployer-1.1.6.tar.gz -C /opt/env/canal\n</code></pre>"},{"location":"middleware/canal/#_3","title":"\u914d\u7f6e","text":"<ul> <li> <p><code>conf/canal.properties</code></p> <pre><code># ...\ncanal.serverMode = kafka\nkafka.bootstrap.servers = 127.0.0.1:9092\n</code></pre> </li> <li> <p><code>conf/example/instance.properties</code></p> <pre><code># ...\ncanal.instance.master.address = 127.0.0.1:3306\ncanal.instance.dbUsername = root\ncanal.instance.dbPassword = root\ncanal.mq.topic = canal\n</code></pre> </li> </ul>"},{"location":"middleware/canal/#_4","title":"\u542f\u52a8","text":"<pre><code>rm -rf conf/example/h2.mv.db\n\nrm -rf conf/example/meta.dat\n\nbin/startup.sh\n</code></pre>"},{"location":"middleware/canal/#_5","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code>tail logs/canal/canal.log -f -n 1000\n\ntail logs/example/example.log -f -n 1000\n</code></pre>"},{"location":"middleware/canal/#_6","title":"\u6d88\u606f\u683c\u5f0f","text":"<ul> <li> <p><code>TRUNCATE</code></p> <pre><code>{\n  \"data\": null,\n  \"database\": \"demo\",\n  \"es\": 1672403650000,\n  \"id\": 1,\n  \"isDdl\": true,\n  \"mysqlType\": null,\n  \"old\": null,\n  \"pkNames\": null,\n  \"sql\": \"truncate table t_user\",\n  \"sqlType\": null,\n  \"table\": \"t_user\",\n  \"ts\": 1672403650485,\n  \"type\": \"TRUNCATE\"\n}\n</code></pre> </li> <li> <p><code>INSERT</code></p> <pre><code>{\n  \"data\": [{ \"id\": \"1\", \"username\": \"u1\", \"email\": \"u1@gmail.com\" }],\n  \"database\": \"demo\",\n  \"es\": 1672403822000,\n  \"id\": 2,\n  \"isDdl\": false,\n  \"mysqlType\": { \"id\": \"bigint\", \"username\": \"varchar(64)\", \"email\": \"varchar(64)\" },\n  \"old\": null,\n  \"pkNames\": [\"id\"],\n  \"sql\": \"\",\n  \"sqlType\": { \"id\": -5, \"username\": 12, \"email\": 12 },\n  \"table\": \"t_user\",\n  \"ts\": 1672403822125,\n  \"type\": \"INSERT\"\n}\n</code></pre> </li> <li> <p><code>UPDATE</code></p> <pre><code>{\n  \"data\": [{ \"id\": \"1\", \"username\": \"u1\", \"email\": \"icefery@163.com\" }],\n  \"database\": \"demo\",\n  \"es\": 1672403904000,\n  \"id\": 3,\n  \"isDdl\": false,\n  \"mysqlType\": { \"id\": \"bigint\", \"username\": \"varchar(64)\", \"email\": \"varchar(64)\" },\n  \"old\": [{ \"email\": \"u1@gmail.com\" }],\n  \"pkNames\": [\"id\"],\n  \"sql\": \"\",\n  \"sqlType\": { \"id\": -5, \"username\": 12, \"email\": 12 },\n  \"table\": \"t_user\",\n  \"ts\": 1672403904314,\n  \"type\": \"UPDATE\"\n}\n</code></pre> </li> <li> <p><code>DELETE</code></p> <pre><code>{\n  \"data\": [{ \"id\": \"1\", \"username\": \"u1\", \"email\": \"icefery@163.com\" }],\n  \"database\": \"demo\",\n  \"es\": 1672403941000,\n  \"id\": 4,\n  \"isDdl\": false,\n  \"mysqlType\": { \"id\": \"bigint\", \"username\": \"varchar(64)\", \"email\": \"varchar(64)\" },\n  \"old\": null,\n  \"pkNames\": [\"id\"],\n  \"sql\": \"\",\n  \"sqlType\": { \"id\": -5, \"username\": 12, \"email\": 12 },\n  \"table\": \"t_user\",\n  \"ts\": 1672403941524,\n  \"type\": \"DELETE\"\n}\n</code></pre> </li> </ul>"},{"location":"middleware/kafka/","title":"Kafka","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/","title":"Kafka \u7b14\u8bb0","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#mq","title":"\u4ec0\u4e48\u662f MQ","text":"<p>\u5f88\u591a\u4eba\u90fd\u8bf4\uff1aMQ \u901a\u8fc7\u8bb2\u6d88\u606f\u7684\u53d1\u9001\u548c\u63a5\u6536\u5206\u79bb\u6765\u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u5f02\u6b65\u548c\u89e3\u8026\uff0c\u8fd9\u4e2a\u7ed9\u4eba\u7684\u76f4\u89c9\u662f\u2014\u2014MQ \u5c31\u662f\u5f02\u6b65\u7684\uff0c\u662f\u7528\u6765\u89e3\u8026\u7684\uff0c\u4f46\u8fd9\u4e2a\u53ea\u662f MQ \u7684\u6548\u679c\u800c\u4e0d\u662f\u76ee\u7684\u3002MQ \u771f\u6b63\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u901a\u8baf\uff0c\u5c4f\u853d\u5e95\u5c42\u590d\u6742\u7684\u901a\u8baf\u534f\u8bae\uff0c\u5b9a\u4e49\u4e86\u4e00\u5957\u5e94\u7528\u5c42\u7684\u66f4\u52a0\u7b80\u5355\u7684\u901a\u8baf\u534f\u8bae\u3002</p> <p>\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u4e24\u4e2a\u6a21\u5757\u4e4b\u95f4\u901a\u8baf\u8981\u4e48\u662f HTTP\uff0c\u8981\u4e48\u662f\u81ea\u5df1\u5f00\u53d1\u7684 TCP\uff0c\u4f46\u662f\u8fd9\u4e24\u79cd\u534f\u8bae\u5176\u5b9e\u90fd\u662f\u539f\u59cb\u7684\u534f\u8bae\u3002HTTP \u534f\u8bae\u5f88\u96be\u5b9e\u73b0\u4e24\u7aef\u901a\u8baf\u2014\u2014\u6a21\u5757 A \u53ef\u4ee5\u8c03\u7528 B\uff0cB \u4e5f\u53ef\u4ee5\u4e3b\u52a8\u8c03\u7528 A\uff0c\u5982\u679c\u8981\u505a\u5230\u8fd9\u4e2a\uff0c\u4e24\u7aef\u90fd\u8981\u80cc\u4e0a WebServer\uff0c\u800c\u4e14\u8fd8\u4e0d\u957f\u8fde\u63a5\uff08HTTP 2.0 \u7684\u5e93\u6839\u672c\u627e\u4e0d\u5230\uff09\u3002TCP \u5c31\u66f4\u52a0\u539f\u59cb\u4e86\uff0c\u7c98\u5305\u3001\u5fc3\u8df3\u3001\u79c1\u6709\u7684\u534f\u8bae\uff0c\u60f3\u4e00\u60f3\u5c31\u5934\u76ae\u53d1\u9ebb\u3002</p> <p>MQ \u6240\u8981\u505a\u7684\u5c31\u662f\u5728\u8fd9\u4e9b\u534f\u8bae\u4e4b\u4e0a\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u201c\u534f\u8bae\u201d\u2014\u2014\u751f\u4ea7\u8005 / \u6d88\u8d39\u8005\u6a21\u578b\u3002MQ \u5e26\u7ed9\u6211\u4eec\u7684\u201c\u534f\u8bae\u201d\u4e0d\u662f\u5177\u4f53\u7684\u901a\u8baf\u534f\u8bae\uff0c\u800c\u662f\u66f4\u9ad8\u5c42\u6b21\u7684\u901a\u8baf\u6a21\u578b\u3002</p> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_1","title":"\u6d88\u606f\u961f\u5217\u7684\u6d41\u6d3e","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#broker-mq","title":"\u6709 Broker \u7684 MQ","text":"<p>\u8fd9\u4e2a\u6d41\u6d3e\u901a\u5e38\u6709\u4e00\u53f0\u670d\u52a1\u5668\u4f5c\u4e3a Broker\uff0c\u6240\u6709\u7684\u6d88\u606f\u90fd\u901a\u8fc7\u5b83\u4e2d\u8f6c\u3002\u751f\u4ea7\u8005\u628a\u6d88\u606f\u53d1\u9001\u7ed9\u5b83\u5c31\u7ed3\u675f\u81ea\u5df1\u7684\u4efb\u52a1\u4e86\uff0cBroker \u5219\u628a\u6d88\u606f\u4e3b\u52a8\u63a8\u7ed9\u6d88\u8d39\u8005\uff08\u6216\u8005\u6d88\u8d39\u8005\u4e3b\u52a8\u8f6e\u8be2\uff09</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#topic-kafkaactivemqjms","title":"\u91cd Topic \uff08Kafka\u3001ActiveMQ\u3001JMS\uff09","text":"<p>\u751f\u4ea7\u8005\u4f1a\u53d1\u9001 Key \u548c\u6570\u636e\u5230 Broker\uff0c\u7531 Broker \u6bd4\u8f83 Key \u4e4b\u540e\u51b3\u5b9a\u7ed9\u54ea\u4e2a\u6d88\u8d39\u8005\u3002\u8fd9\u79cd\u6a21\u5f0f\u662f\u6211\u4eec\u6700\u5e38\u89c1\u7684\u6a21\u5f0f\uff0c\u662f\u6211\u4eec\u5bf9 MQ \u6700\u591a\u7684\u5370\u8c61\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u4e00\u4e2a Topic \u5f80\u5f80\u662f\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u6982\u5ff5\uff0c\u751a\u81f3\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u5c31\u53ef\u80fd\u53ea\u6709\u4e00\u4e2a Topic\uff0cTopic \u67d0\u79cd\u610f\u4e49\u4e0a\u5c31\u662f Queue\uff0c\u751f\u4ea7\u8005\u53d1\u9001 Key \u76f8\u5f53\u4e8e\u8bf4\uff1a\u201cHi\uff0c\u628a\u6570\u636e\u653e\u5230 Key \u7684\u961f\u5217\u4e2d\u201d\u3002</p> <p>\u867d\u7136\u67b6\u6784\u4e00\u6837\u4f46\u662f Kafka \u7684\u6027\u80fd\u8981\u6bd4 JMS \u7684\u6027\u80fd\u4e0d\u77e5\u9053\u9ad8\u591a\u5c11\u500d\uff0c\u6240\u4ee5\u57fa\u672c\u4e0a\u8fd9\u79cd\u7c7b\u578b\u7684 MQ \u53ea\u6709 Kafka \u4e00\u79cd\u5907\u9009\u65b9\u6848\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#topicrabbitmq-amqp","title":"\u8f7b Topic\uff08RabbitMQ \u6216\u8005 AMQP \u534f\u8bae\uff09","text":"<p>\u751f\u4ea7\u8005\u53d1\u9001 Key \u548c\u6570\u636e\uff0c\u6d88\u8d39\u8005\u5b9a\u4e49\u8ba2\u9605\u7684\u961f\u5217\uff0cBroker \u6536\u5230\u6570\u636e\u4e4b\u540e\u4f1a\u901a\u8fc7\u4e00\u5b9a\u7684\u903b\u8f91\u8ba1\u7b97\u51fa Key \u5bf9\u5e94\u7684\u961f\u5217\uff0c\u7136\u540e\u628a\u6570\u636e\u4ea4\u7ed9\u961f\u5217\u3002</p> <p>\u8fd9\u79cd\u6a21\u5f0f\u4e0b\u89e3\u8026\u4e86 Key \u548c Queue\uff0c\u5728\u8fd9\u79cd\u67b6\u6784\u4e2d Queue \u662f\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\uff08\u5728 RabbitMQ \u4e2d\u5b83\u7684\u4e0a\u9650\u53d6\u51b3\u4e8e\u4f60\u7684\u5185\u5b58\uff09\uff0c\u6d88\u8d39\u8005\u5173\u5fc3\u7684\u77e5\u8bc6\u81ea\u5df1\u7684 Queue\uff0c\u751f\u4ea7\u8005\u4e0d\u5fc5\u5173\u5fc3\u6570\u636e\u6700\u7ec8\u7ed9\u8c01\uff0c\u53ea\u8981\u6307\u5b9a Key \u5c31\u884c\u4e86\uff0c\u4e2d\u95f4\u7684\u90a3\u5c42\u6620\u5c04\u5728 AMQP \u4e2d\u53eb\u505a Exchange\u3002</p> <p>AMQP \u4e2d\u6709\u56db\u79cd Exchange\uff1a</p> Direct Exchange Key \u5c31\u7b49\u4e8e Queue Fanout Exchange \u65e0\u89c6 Key\uff0c\u7ed9\u6240\u6709\u7684 Queue \u90fd\u6765\u4e00\u4efd Topic Exchange Key \u53ef\u4ee5\u7528\u201c\u5bbd\u5b57\u7b26\u201d\u6a21\u7cca\u5339\u914d Queue Header Exchange \u65e0\u89c6 Key\uff0c\u901a\u8fc7\u67e5\u770b\u6d88\u606f\u7684\u5934\u90e8\u5143\u6570\u636e\u6765\u51b3\u5b9a\u53d1\u7ed9\u54ea\u4e2a Queue\uff08AMQP \u5934\u90e8\u5143\u6570\u636e\u975e\u5e38\u4e30\u5bcc\u5e76\u4e14\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff09 <p>\u8fd9\u79cd\u7ed3\u6784\u7684\u67b6\u6784\u7ed9\u901a\u8baf\u5e26\u6765\u4e86\u5f88\u5927\u7684\u7075\u6d3b\u6027\uff0c\u6211\u4eec\u80fd\u60f3\u5230\u7684\u901a\u8baf\u65b9\u5f0f\u90fd\u53ef\u4ee5\u7528\u8fd9\u56db\u79cd Exchange \u8868\u8fbe\u51fa\u6765\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#broker-mq_1","title":"\u65e0 Broker \u7684 MQ","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#zeromq","title":"ZeroMQ","text":"<p>\u65e0 Broker \u7684 MQ \u7684\u4ee3\u8868\u662f ZeroMQ\u3002\u8be5\u4f5c\u8005\u975e\u5e38\u777f\u667a\uff0c\u4ed6\u975e\u5e38\u654f\u9510\u7684\u610f\u8bc6\u5230\u2014\u2014MQ \u662f\u66f4\u9ad8\u7ea7\u7684 Socket\uff0c\u5b83\u662f\u89e3\u51b3\u901a\u8baf\u95ee\u9898\u7684\uff0c\u6240\u4ee5 ZeroMQ \u88ab\u8bbe\u8ba1\u6210\u4e86\u4e00\u4e2a\u201c\u5e93\u201d\u800c\u4e0d\u662f\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002</p> <p>\u8282\u70b9\u4e4b\u95f4\u901a\u8baf\u7684\u6d88\u606f\u90fd\u662f\u53d1\u9001\u5230\u5f7c\u6b64\u7684\u961f\u5217\u4e2d\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u65e2\u662f\u751f\u4ea7\u8005\u53c8\u662f\u6d88\u8d39\u8005\u3002ZeroMQ \u505a\u7684\u4e8b\u60c5\u5c31\u662f\u5c01\u88c5\u51fa\u4e00\u5957\u7c7b\u4f3c\u4e8e Socket \u7684 API\uff0c\u53ef\u4ee5\u5b8c\u6210\u53d1\u9001\u6570\u636e\u3001\u8bfb\u53d6\u6570\u636e\u3002</p> <p>ZeroMQ \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u8de8\u8bed\u8a00\u7684\u3001\u91cd\u91cf\u7ea7\u7684 Actor \u6a21\u578b\u90ae\u7bb1\u5e93\u3002\u4f60\u53ef\u4ee5\u628a\u81ea\u5df1\u7684\u7a0b\u5e8f\u60f3\u8c61\u6210\u4e00\u4e2a Actor\uff0cZeroMQ \u5c31\u662f\u63d0\u4f9b\u90ae\u7bb1\u529f\u80fd\u7684\u5e93\u3002ZeroMQ \u53ef\u4ee5\u5b9e\u73b0\u540c\u4e00\u53f0\u673a\u5668\u7684 RPC \u901a\u8baf\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u673a\u5668\u4e0a\u7684 TCP\u3001UDP \u901a\u8baf\u3002</p> <p>\u5982\u679c\u4f60\u9700\u8981\u4e00\u4e2a\u5f3a\u5927\u7684\u3001\u7075\u6d3b\u3001\u91ce\u86ee\u7684\u901a\u8baf\u80fd\u529b\uff0c\u522b\u72b9\u8c6b ZeroMQ\u3002</p> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka","title":"Kafka \u4ecb\u7ecd","text":"<p>Kafka \u6700\u521d\u7531 LinkedIn \u516c\u53f8\u5f00\u53d1\uff0c\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u3001\u652f\u6301\u5206\u533a\u7684\uff08Partition\uff09\u3001\u591a\u526f\u672c\u7684\uff08Replica\uff09\u3001\u57fa\u4e8e Zookeeper \u534f\u8c03\u7684\u6d88\u606f\u7cfb\u7edf\uff0c\u5b83\u6700\u5927\u7684\u7279\u6027\u5c31\u662f\u53ef\u4ee5\u5b9e\u65f6\u7684\u5904\u7406\u5927\u91cf\u6570\u636e\u4ee5\u6ee1\u8db3\u5404\u79cd\u9700\u6c42\u573a\u666f\u3002\u7531 Scala \u8bed\u8a00\u7f16\u5199\uff0cLinkedIn \u4e0e 2010 \u5e74\u8d21\u732e\u7ed9\u4e86 Apache \u57fa\u91d1\u4f1a\u5e76\u6210\u4e3a\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_1","title":"Kafka \u7684\u4f7f\u7528\u573a\u666f","text":"<ul> <li> <p>\u65e5\u5fd7\u6536\u96c6</p> <p>\u4e00\u4e2a\u516c\u53f8\u53ef\u4ee5\u7528 Kafka \u6536\u96c6\u5404\u79cd\u670d\u52a1\u7684 Log\uff0c\u901a\u8fc7 Kafka \u4ee5\u7edf\u4e00\u63a5\u53e3\u670d\u52a1\u7684\u65b9\u5f0f\u5f00\u653e\u7ed9\u5404\u79cd Consumer\uff0c\u4f8b\u5982 Hadoop\u3001HBase\u3001Solr \u7b49\u3002</p> </li> <li> <p>\u6d88\u606f\u7cfb\u7edf\uff1a</p> <p>\u89e3\u8026\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u3001\u7f13\u5b58\u6d88\u606f\u7b49\u3002</p> </li> <li> <p>\u7528\u6237\u6d3b\u52a8\u8ddf\u8e2a</p> <p>Kafka \u7ecf\u5e38\u88ab\u7528\u6765\u8bb0\u5f55 Web \u7528\u6237\u6216\u8005 app \u7528\u6237\u7684\u5404\u79cd\u6d3b\u52a8\uff0c\u5982\u6d4f\u89c8\u7f51\u9875\u3001\u641c\u7d22\u3001\u70b9\u51fb\u7b49\u6d3b\u52a8\uff0c\u8fd9\u4e9b\u6d3b\u52a8\u4fe1\u606f\u88ab\u5404\u4e2a\u670d\u52a1\u5668\u53d1\u5427\u5230 Kafka \u7684 Topic \u4e2d\uff0c\u7136\u540e\u8ba2\u9605\u8005\u901a\u8fc7\u8ba2\u9605\u8fd9\u4e9b Topic \u6765\u505a\u5b9e\u65f6\u7684\u76d1\u63a7\u5206\u6790\uff0c\u540e\u8005\u88c5\u8f7d\u5230 Hadoop\u3001\u6570\u636e\u4ed3\u5e93\u4e2d\u505a\u79bb\u7ebf\u5206\u6790\u548c\u6316\u6398\u3002</p> </li> <li> <p>\u8fd0\u8425\u6307\u6807</p> <p>Kafka \u4e5f\u7ecf\u5e38\u88ab\u7528\u6765\u8bb0\u5f55\u8fd0\u8425\u76d1\u63a7\u6570\u636e\uff0c\u5305\u62ec\u6536\u96c6\u5404\u79cd\u5206\u5e03\u5f0f\u5e94\u7528\u7684\u6570\u636e\uff0c\u751f\u4ea7\u5404\u79cd\u64cd\u4f5c\u7684\u96c6\u4e2d\u53cd\u9988\uff0c\u6bd4\u5982\u62a5\u8b66\u548c\u62a5\u544a\u3002</p> </li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_2","title":"Kafka \u7684\u57fa\u672c\u6982\u5ff5","text":"<p>Kafka \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\uff0c\u5206\u533a\u7684\u6d88\u606f\u670d\u52a1\uff08\u5b98\u65b9\u79f0\u4e4b\u4e3a Commit Log\uff09\uff0c\u5b83\u63d0\u4f9b\u4e00\u4e2a\u6d88\u606f\u7cfb\u7edf\u5e94\u8be5\u5177\u5907\u7684\u529f\u80fd\uff0c\u4f46\u662f\u5374\u6709\u7740\u72ec\u7279\u7684\u8bbe\u8ba1\u3002</p> <p>\u53ef\u4ee5\u8fd9\u6837\u6765\u8bf4\uff0cKafka \u501f\u9274\u4e86 JMS \u89c4\u8303\u7684\u601d\u60f3\uff0c\u4f46\u662f\u786e\u5e76\u6ca1\u6709\u5b8c\u5168\u9075\u5faa JMS \u89c4\u8303\u3002</p> <p>\u57fa\u7840\u7684\u6d88\u606f\u76f8\u5173\u672f\u8bed\uff1a</p> Broker \u6d88\u606f\u4e2d\u95f4\u4ef6\u5904\u7406\u8282\u70b9\uff0c\u4e00\u4e2a Kafka \u8282\u70b9\u5c31\u662f\u4e00\u4e2a Broker\uff0c\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Broker \u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a Kafka \u96c6\u7fa4 Topic Kafka \u6839\u636e Topic \u5bf9\u6d88\u606f\u8fdb\u884c\u5f52\u7c7b\uff0c\u53d1\u5e03\u5230 Kafka \u96c6\u7fa4\u7684\u6bcf\u6761\u6d88\u606f\u90fd\u9700\u8981\u6307\u5b9a\u4e00\u4e2a Topic Producer \u6d88\u606f\u751f\u4ea7\u8005\uff0c\u5411 Broker \u53d1\u9001\u6d88\u606f\u7684\u5ba2\u6237\u7aef Consumer \u6d88\u606f\u6d88\u8d39\u8005\uff0c\u4ece Broker \u8bfb\u53d6\u6d88\u606f\u7684\u5ba2\u6237\u7aef Consumer Group \u6bcf\u4e2a Consumer \u5c5e\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684 Consumer Group\uff0c\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e0d\u540c\u7684 Consumer Group \u6d88\u8d39\uff0c\u4f46\u662f\u4e00\u4e2a Consumer Group \u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a Consumer \u80fd\u591f\u6d88\u8d39\u8be5\u6d88\u606f Partition \u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u4e00\u4e2a Topic \u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a Partition\uff0c\u6bcf\u4e2a Partition \u5185\u90e8\u6d88\u606f\u662f\u6709\u5e8f\u7684 <p>\u670d\u52a1\u7aef\uff08Broker\uff09\u548c\u5ba2\u6237\u7aef\uff08Producer\u3001Consumer\uff09\u4e4b\u95f4\u901a\u4fe1\u901a\u8fc7 TCP \u534f\u8bae\u6765\u5b8c\u6210\u3002</p> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_3","title":"Kafka \u5b89\u88c5","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_2","title":"\u73af\u5883\u51c6\u5907","text":"<ul> <li>jdk</li> <li>zookeeper</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_3","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>config/server.properties</code></p> <pre><code># The id of the broker. This must be set to a unique integer for each broker.\nbroker.id=6\n\n# Hostname and port the broker will advertise to producers and consumers.\nadvertised.listeners=PLAINTEXT://192.192.192.6:9092\n\n# A comma separated list of directories under which to store log files.\nlog.dirs=/opt/kafka/data\n\n# Zookeeperi connection string.\nzookeeper.connect=192.192.192.6:2181\n</code></pre> </li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_4","title":"\u542f\u52a8 Kafka \u670d\u52a1\u5668","text":"<ul> <li>\u542f\u52a8 Zookeeper     <pre><code>cd /opt/zookeeper\nbin/zkServer.sh start\n</code></pre></li> <li>\u542f\u52a8 Kafka     <pre><code>cd /opt/kafka\nbin/kafka-server-start.sh -daemon config/server.properties\n</code></pre></li> <li>\u9a8c\u8bc1\u662f\u5426\u542f\u52a8\u6210\u529f\uff08\u8fdb\u5165 ZK \u67e5\u770b\u6307\u5b9a ID \u7684 Broker \u662f\u5426\u5b58\u5728\uff09     <pre><code>cd /opt/zookeeper\nbin/zkCli.sh\n</code></pre> <pre><code>ls /brokers/ids\n</code></pre></li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_4","title":"\u521b\u5efa\u4e3b\u9898\u3001\u53d1\u9001\u6d88\u606f\u3001\u6d88\u8d39\u6d88\u606f","text":"<pre><code># \u521b\u5efa\u4e3b\u9898\nbin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test\n\n# \u67e5\u770b Kafka \u6709\u54ea\u4e9b Topic\nbin/kafka-topics.sh --list --bootstrap-server localhost:9092\n\n# \u53d1\u9001\u6d88\u606f\nbin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic test\n\n# \u6d88\u8d39\u6700\u65b0\u6d88\u606f\nbin/kafka-console-consumer.sh --bootstrap-server localhost:9092\n\n# \u4ece\u5934\u5f00\u59cb\u6d88\u8d39\nbin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_5","title":"\u5173\u4e8e\u6d88\u606f\u7684\u7ec6\u8282","text":"<ul> <li>\u751f\u4ea7\u8005\u5c06\u6d88\u606f\u53d1\u9001\u7ed9 Broker\uff0cBroker \u4f1a\u5c06\u6d88\u606f\u4fdd\u5b58\u5728\u672c\u5730\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d     <pre><code>/opt/kafka/data/&lt;\u4e3b\u9898&gt;-&lt;\u5206\u533a&gt;/00000000000000000000.log\n</code></pre></li> <li>\u6d88\u606f\u7684\u4fdd\u5b58\u662f\u6709\u5e8f\u7684\uff0c\u901a\u8fc7 Offset \u504f\u79fb\u91cf\u6765\u63cf\u8ff0\u6d88\u606f\u7684\u6709\u5e8f\u6027</li> <li>\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u65f6\u4e5f\u662f\u901a\u8fc7 Offset \u6765\u63cf\u8ff0\u5f53\u524d\u8981\u6d88\u8d39\u7684\u90a3\u6761\u6d88\u606f\u7684\u4f4d\u7f6e</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_6","title":"\u5355\u64ad\u6d88\u606f\u548c\u591a\u64ad\u6d88\u606f","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_7","title":"\u5355\u64ad\u6d88\u606f","text":"<p>\u5728\u4e00\u4e2a Kafka \u7684 Topic \u4e2d\uff0c\u542f\u52a8\u4e24\u4e2a\u6d88\u8d39\u8005\u548c\u4e00\u4e2a\u751f\u4ea7\u8005\uff0c\u95ee\uff1a\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\uff0c\u8fd9\u6761\u6d88\u606f\u662f\u5426\u540c\u65f6\u4f1a\u88ab\u4e24\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff1f</p> <p>\u5982\u679c\u4e24\u4e2a\u6d88\u8d39\u8005\u5728\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\uff0c\u90a3\u4e48\u53ea\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u6536\u5230\u8ba2\u9605\u7684 Topic \u4e2d\u7684\u6d88\u606f\u3002</p> <p>\u6362\u8a00\u4e4b\uff0c\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u6536\u5230\u4e00\u4e2a Topic \u4e2d\u7684\u6d88\u606f\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --consumer-property group.id=test-group\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_8","title":"\u591a\u64ad\u6d88\u606f","text":"<p>\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\u8ba2\u9605\u540c\u4e00\u4e2a Topic\uff0c\u90a3\u4e48\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\u4e2d\u53ea\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u80fd\u6536\u5230\u6d88\u606f\u3002</p> <p>\u5b9e\u9645\u4e0a\u4e5f\u662f\u591a\u4e2a\u6d88\u8d39\u7ec4\u4e2d\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u6536\u5230\u4e86\u540c\u4e00\u4e2a\u6d88\u606f\u3002</p> <pre><code>bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --consumer-property group.id=test-group-1\n\nbin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --consumer-property group.id=test-group-2\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_9","title":"\u67e5\u770b\u6d88\u8d39\u7ec4\u7684\u8be6\u7ec6\u4fe1\u606f","text":"<pre><code>bin/kafka-consumer-groups.sh --describe --bootstrap-server localhost:9092 --group test-group\n</code></pre> <p>\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u51e0\u4e2a\u4fe1\u606f\uff1a</p> CURRENT-OFFSET \u6700\u540e\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u7684\u504f\u79fb\u91cf LOG-END-OFFSET \u6700\u540e\u4e00\u6761\u6d88\u606f\u7684\u504f\u79fb\u91cf\uff08\u6d88\u606f\u603b\u91cf\uff09 LAG \u79ef\u538b\u4e86\u591a\u5c11\u6761\u6d88\u606f <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_5","title":"Kafka \u4e2d\u4e3b\u9898\u548c\u5206\u533a\u7684\u6982\u5ff5","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_10","title":"\u4e3b\u9898","text":"<p>Topic \u5728 Kafka \u4e2d\u662f\u4e00\u4e2a\u903b\u8f91\u7684\u6982\u5ff5\uff0cKafka \u901a\u8fc7 Topic \u5c06\u6d88\u606f\u8fdb\u884c\u5206\u7c7b\uff0c\u4e0d\u540c\u7684 Topic \u4f1a\u88ab\u8ba2\u9605\u8be5 Topic \u7684\u6d88\u8d39\u8005\u6d88\u8d39\u3002</p> <p>\u4f46\u662f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u8bf4\u8fd9\u4e2a Topic \u4e2d\u7684\u6d88\u606f\u975e\u5e38\u975e\u5e38\u591a\uff0c\u56e0\u4e3a\u6d88\u606f\u662f\u4f1a\u88ab\u4fdd\u5b58\u5230 Log \u65e5\u5fd7\u6587\u4ef6\u4e2d\u7684\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u6587\u4ef6\u8fc7\u5927\u7684\u95ee\u9898\uff0c Kafka \u63d0\u51fa\u4e86 Partition \u7684\u6982\u5ff5\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_11","title":"\u5206\u533a","text":"<p>\u901a\u8fc7 Partition \u5c06\u4e00\u4e2a Topic \u4e2d\u7684\u6d88\u606f\u5206\u533a\u6765\u5b58\u50a8\u3002\u8fd9\u6837\u7684\u597d\u5904\u6709\u591a\u4e2a\uff1a</p> <ul> <li>\u5206\u533a\u5b58\u50a8\uff0c\u53ef\u4ee5\u89e3\u51b3\u5b58\u50a8\u6587\u4ef6\u8fc7\u5927\u7684\u95ee\u9898</li> <li>\u63d0\u4f9b\u4e86\u8bfb\u5199\u7684\u541e\u5410\u91cf\uff0c\u8bfb\u548c\u5199\u53ef\u4ee5\u540c\u65f6\u5728\u591a\u4e2a\u5206\u533a\u4e2d\u8fdb\u884c</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_6","title":"Kafka \u4e2d\u6d88\u606f\u65e5\u5fd7\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684\u5185\u5bb9","text":"<ul> <li> <p><code>00000000000000000000.log</code></p> <p>\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684\u5c31\u662f\u6d88\u606f\u3002\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684\u6d88\u606f\uff0c\u9ed8\u8ba4\u4fdd\u5b58 7 \u5929\uff0c7 \u5929\u540e\u6d88\u606f\u4f1a\u88ab\u5220\u9664\u3002</p> </li> <li> <p><code>__consumer_offsets-49</code></p> <p>Kafka \u5185\u90e8\u521b\u5efa\u4e86<code>__consumer_offsets</code> \u4e3b\u9898\uff0c\u5305\u542b\u4e86 50 \u4e2a\u5206\u533a\uff0c\u8fd9\u4e2a\u4e3b\u9898\u7528\u6765\u5b58\u653e\u6d88\u8d39\u8005\u6d88\u8d39\u67d0\u4e2a\u4e3b\u9898\u7684\u504f\u79fb\u91cf\u3002\u6bcf\u4e2a\u6d88\u8d39\u8005\u4f1a\u628a\u6d88\u8d39\u7684\u4e3b\u9898\u7684\u504f\u79fb\u91cf\u81ea\u4e3b\u4e0a\u62a5\u7ed9 Kafka \u7684\u9ed8\u8ba4\u4e3b\u9898 <code>__consumer_offsets</code>\uff0c\u56e0\u6b64 Kafka \u4e3a\u4e86\u63d0\u5347\u8fd9\u4e2a\u4e3b\u9898\u7684\u5e76\u53d1\u6027\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u4e86 50 \u4e2a\u5206\u533a\u3002</p> <ul> <li> <p>\u63d0\u4ea4\u5230\u54ea\u4e2a\u5206\u533a</p> <p>\u901a\u8fc7 Hash \u51fd\u6570 <code>hash(&lt;Consumer Group ID&gt;) % &lt;__consumer_offsets \u4e3b\u9898\u7684\u5206\u533a\u6570&gt;</code></p> </li> <li> <p>\u63d0\u4ea4\u5230\u8be5\u4e3b\u9898\u7684\u5185\u5bb9</p> <p>Key \u4e3a <code>&lt;Consumer Group ID&gt;</code> + <code>&lt;Topic&gt;</code> + <code>&lt;\u5206\u533a\u53f7&gt;</code>\uff0cValue \u5c31\u662f\u5f53\u524d Offset \u7684\u503c</p> </li> </ul> </li> </ul> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_7","title":"Kafka \u96c6\u7fa4\u64cd\u4f5c","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_12","title":"\u526f\u672c\u7684\u6982\u5ff5","text":"<p>\u526f\u672c\u662f\u4e3a\u4e86\u4e3b\u9898\u4e2d\u7684\u5206\u533a\u521b\u5efa\u591a\u4e2a\u5907\u4efd\uff0c\u5728 Kafka \u96c6\u7fa4\u7684\u591a\u4e2a Broker \u4e2d\uff0c\u4f1a\u6709\u4e00\u4e2a\u526f\u672c\u4f5c\u4e3a Leader\uff0c\u5176\u5b83\u662f Follower\u3002</p> <p>\u67e5\u770b Topic \u60c5\u51b5\uff1a</p> <pre><code>bin/kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic my-replicated-topic\n</code></pre> Leader Kafka \u7684\u5199\u548c\u8bfb\u7684\u64cd\u4f5c\uff0c\u90fd\u53d1\u751f\u5728 Leader \u4e0a\u3002Leader \u8d1f\u8d23\u628a\u6570\u636e\u540c\u6b65\u7ed9 Follower\u3002\u5f53 Leader \u6302\u4e86\uff0c\u7ecf\u8fc7\u4e3b\u4ece\u9009\u4e3e\uff0c\u4ece\u591a\u4e2a Follower \u4e2d\u9009\u4e3e\u4e00\u4e2a\u65b0\u7684 Leader Follower \u63a5\u6536 Leader \u7684\u540c\u6b65\u7684\u6570\u636e Isr \u53ef\u4ee5\u540c\u6b65\u548c\u5df2\u540c\u6b65\u7684\u8282\u70b9\u4f1a\u88ab\u653e\u5165\u5230 Isr \u96c6\u7fa4\u3002\u5982\u679c Isr \u4e2d\u7684\u8282\u70b9\u6027\u80fd\u8f83\u5dee\uff0c\u4f1a\u88ab\u8e22\u51fa Isr \u96c6\u5408 <p>\u96c6\u7fa4\u4e2d\u6709\u591a\u4e2a Broker\uff0c\u521b\u5efa\u4e3b\u9898\u65f6\u53ef\u4ee5\u6307\u660e\u4e3b\u9898\u6709\u591a\u5c11\u4e2a\u5206\u533a\uff08\u628a\u6d88\u606f\u62c6\u5206\u5230\u4e0d\u540c\u7684\u5206\u533a\u4e2d\u5b58\u50a8\uff09\uff0c\u53ef\u4ee5\u4e3a\u5206\u533a\u521b\u5efa\u591a\u4e2a\u526f\u672c\uff0c\u4e0d\u540c\u7684\u526f\u672c\u5b58\u653e\u5728\u4e0d\u540c\u7684 Broker \u91cc\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_13","title":"\u96c6\u7fa4\u6d88\u8d39\u4e2d\u5206\u533a\u5206\u6d88\u8d39\u7ec4\u7684\u7ec6\u8282","text":"<ul> <li>\u4e00\u4e2a Parittion \u53ea\u80fd\u88ab\u4e00\u4e2a\u6d88\u8d39\u7ec4\u4e2d\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6027\uff0c\u4f46\u662f\u591a\u4e2a Partition \u7684\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u7684\u603b\u987a\u5e8f\u662f\u5f97\u4e0d\u5230\u4fdd\u8bc1\u7684\u3002</li> <li>Partition \u7684\u6570\u91cf\u51b3\u5b9a\u4e86\u6d88\u8d39\u7ec4\u4e2d\u6d88\u8d39\u8005\u7684\u6570\u91cf\uff0c\u5efa\u8bae\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7684\u6570\u91cf\u4e0d\u8981\u8d85\u8fc7 Partition \u7684\u6570\u91cf\uff0c\u5426\u5219\u591a\u7684\u6d88\u8d39\u8005\u6d88\u8d39\u4e0d\u5230\u6d88\u606f\u3002</li> <li>\u5982\u679c\u6d88\u8d39\u8005\u6302\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 Rebalance \u673a\u5236\uff0c\u4f1a\u8ba9\u5176\u5b83\u6d88\u8d39\u8005\u6765\u6d88\u8d39\u8be5\u5206\u533a\u3002</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#api","title":"\u5ba2\u6237\u7aef API","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_14","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;\n    &lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_15","title":"\u751f\u4ea7\u8005","text":"<pre><code>public class MyProducer {\n    public static void main(String[] args) throws Exception {\n        // \u8bbe\u7f6e\u53c2\u6570\n        Properties props = new Properties();\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"192.192.192.6:9092\");\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        // \u521b\u5efa\u751f\u4ea7\u8005\n        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);\n        // \u521b\u5efa\u6d88\u606f\n        ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\"my-topic\", \"my-key\", \"my-value\");\n        // \u53d1\u9001\u6d88\u606f\n        Future&lt;RecordMetadata&gt; future = producer.send(record);\n        // \u83b7\u53d6\u6d88\u606f\u53d1\u9001\u7684\u5143\u6570\u636e\n        RecordMetadata metadata = future.get();\n        System.out.printf(\"topic=%s partition=%d offset=%d\\n\", metadata.topic(), metadata.partition(), metadata.offset());\n    }\n}\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_16","title":"\u751f\u4ea7\u8005\u7684\u540c\u6b65\u53d1\u9001\u6d88\u606f","text":"<p>\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u6ca1\u6709\u6536\u5230 Ack\uff0c\u751f\u4ea7\u8005\u4f1a\u963b\u585e\uff0c\u963b\u585e\u5230 3s \u7684\u65f6\u95f4\uff0c\u5982\u679c\u8fd8\u6ca1\u6709\u6536\u5230\u6d88\u606f\uff0c\u4f1a\u8fdb\u884c\u91cd\u8bd5\uff0c\u91cd\u8bd5\u7684\u6b21\u6570\u4e3a 3 \u6b21\u3002</p> <pre><code>Future&lt;RecordMetadata&gt; future = producer.send(record);\nRecordMetadata metadata = future.get();\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_17","title":"\u751f\u4ea7\u8005\u7684\u5f02\u6b65\u53d1\u9001\u6d88\u606f","text":"<p>\u5f02\u6b65\u53d1\u9001\uff0c\u751f\u4ea7\u8005\u53d1\u9001\u5b8c\u6d88\u606f\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u4e4b\u540e\u7684\u4e1a\u52a1\uff0cBroker \u5728\u6536\u5230 \u6d88\u606f\u540e\u5f02\u6b65\u8c03\u7528\u751f\u4ea7\u8005\u63d0\u4f9b\u7684 Callback \u56de\u8c03\u65b9\u6cd5\u3002</p> <pre><code>producer.send(record, (RecordMetadata metadata, Exception e) -&gt; {\n    if (e != null) {\n        System.out.println(\"\u6d88\u606f\u53d1\u9001\u5931\u8d25\");\n    }\n});\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#ack","title":"\u751f\u4ea7\u8005\u4e2d Ack \u914d\u7f6e","text":"<p>\u5728\u540c\u6b65\u53d1\u9001\u7684\u524d\u63d0\u4e0b\uff0c\u751f\u4ea7\u8005\u5728\u83b7\u5f97\u96c6\u7fa4\u8fd4\u56de\u7684 Ack \u4e4b\u524d\u4f1a\u4e00\u76f4\u963b\u585e\uff0c\u90a3\u4e48\u96c6\u7fa4\u4ec0\u4e48\u65f6\u5019\u8fd4\u56de Ack \u5462\uff1f\u6b64\u65f6 Ack \u6709 3 \u4e2a\u914d\u7f6e\uff1a</p> <ul> <li> <p><code>ack=0</code></p> <p>Kafka \u96c6\u7fa4\u4e0d\u9700\u8981\u4efb\u4f55\u7684 Broker \u6536\u5230\u6d88\u606f\uff0c\u5c31\u7acb\u523b\u8fd4\u56de Ack \u7ed9\u751f\u4ea7\u8005\u3002\u6700\u5bb9\u6613\u4e22\u6d88\u606f\uff0c\u6548\u7387\u6700\u9ad8\u3002</p> </li> <li> <p><code>ack=1</code>\uff08\u9ed8\u8ba4\uff09</p> <p>\u591a\u526f\u672c\u4e4b\u95f4\u7684 Leader \u5df2\u7ecf\u6536\u5230\u6d88\u606f\uff0c\u5e76\u628a\u6d88\u606f\u5199\u5165\u5230\u672c\u5730\u7684 Log \u4e2d\uff0c\u624d\u4f1a\u8fd4\u56de Ack \u7ed9\u751f\u4ea7\u8005\u3002\u6027\u80fd\u548c\u5b89\u5168\u6027\u662f\u6700\u5747\u8861\u7684\u3002</p> </li> <li> <p><code>ack=-1</code> / <code>ack=all</code></p> <p>\u6709\u914d\u7f6e <code>min.insync.replicas=2</code>\uff08\u9ed8\u8ba4\u4e3a 1\uff0c\u63a8\u8350\u914d\u7f6e\u5927\u4e8e\u7b49\u4e8e 2\uff09\uff0c\u6b64\u65f6\u5c31\u9700\u8981 Leader \u548c\u4e00\u4e2a Follower \u540c\u6b65\u5b8c\u540e\uff0c\u624d\u4f1a\u8fd4\u56de Ack \u7ed9\u751f\u4ea7\u8005\uff0c\u6b64\u65f6\u96c6\u7fa4\u4e2d\u6709 2 \u4e2a Broker \u5df2\u5b8c\u6210\u6570\u636e\u7684\u63a5\u6536\u3002\u8fd9\u79cd\u65b9\u5f0f\u6700\u5b89\u5168\uff0c\u4f46\u6027\u80fd\u6700\u5dee\u3002</p> </li> </ul> <p>\u4e0b\u9762\u662f\u5173\u4e8e Ack \u548c\u91cd\u8bd5\u7684\u914d\u7f6e\uff08\u5982\u679c\u6ca1\u6709\u6536\u5230 Ack \u5c31\u5f00\u542f\u91cd\u8bd5\uff09\uff1a</p> <pre><code>props.put(ProducerConfig.ACKS_CONFIG, \"1\");\nprops.put(ProducerConfig.RETRIES_CONFIG, 3);\n// \u91cd\u8bd5\u95f4\u9694\u8bbe\u7f6e\uff08\u53d1\u9001\u5931\u8d25\u4f1a\u91cd\u8bd5\uff0c\u9ed8\u8ba4\u95f4\u9694 100ms\uff0c\u91cd\u8bd5\u80fd\u4fdd\u8bc1\u6d88\u606f\u53d1\u9001\u7684\u53ef\u9760\u6027\uff0c\u4f46\u662f\u4e5f\u53ef\u80fd\u9020\u6210\u6d88\u606f\u91cd\u590d\u53d1\u9001\uff0c\u6bd4\u5982\u7f51\u7edc\u6296\u52a8\uff0c\u6240\u4ee5\u9700\u8981\u518d\u63a5\u6536\u8005\u90a3\u8fb9\u505a\u597d\u6d88\u606f\u63a5\u6536\u7684\u5e42\u7b49\u6027\u5904\u7406\uff09\nprops.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, 100);\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_18","title":"\u5173\u4e8e\u6d88\u606f\u53d1\u9001\u7684\u7f13\u51b2\u533a","text":"<ul> <li>Kafka \u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u7f13\u51b2\u533a\uff0c\u7528\u6765\u5b58\u653e\u8981\u53d1\u9001\u7684\u6d88\u606f\uff0c\u7f13\u51b2\u533a\u662f 32m     <pre><code>props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);\n</code></pre></li> <li>Kafka \u672c\u5730\u7ebf\u7a0b\u4f1a\u53bb\u7f13\u51b2\u533a\u4e2d\u4e00\u6b21\u62c9 16k \u7684\u6570\u636e\u53d1\u9001\u7ed9 Broker     <pre><code>props.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);\n</code></pre></li> <li>\u5982\u679c\u7ebf\u7a0b\u62c9\u4e0d\u5230 16k \u7684\u6570\u636e\uff0c\u95f4\u9694 10ms \u4e5f\u4f1a\u5c06\u5df2\u62c9\u5230\u7684\u6570\u636e\u53d1\u9001\u7ed9 Broker     <pre><code>props.put(ProducerConfig.LINGER_MS_CONFIG, 10);\n</code></pre></li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_19","title":"\u6d88\u8d39\u8005","text":"<pre><code>public class MyConsumer {\n    public static void main(String[] args) {\n        // \u8bbe\u7f6e\u53c2\u6570\n        Properties props = new Properties();\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"192.192.192.6:9092\");\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        // \u6d88\u8d39\u7ec4\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, \"test-group\");\n\n        // \u521b\u5efa\u6d88\u8d39\u8005\u5ba2\u6237\u7aef\n        KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\n        // \u6d88\u8d39\u8005\u8ba2\u9605\u4e3b\u9898\u5217\u8868\n        consumer.subscribe(List.of(\"test\"));\n\n        while (true) {\n            // poll() \u662f\u62c9\u53d6\u6d88\u606f\u7684\u957f\u8f6e\u8be2\n            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000));\n            for (ConsumerRecord&lt;String, String&gt; record : records) {\n                System.out.printf(\"partitoin=%d offset=%d key=%s value=%s\\n\", record.partition(), record.offset(), record.key(), record.value());\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#offset","title":"\u5173\u4e8e\u6d88\u8d39\u8005\u81ea\u52a8\u63d0\u4ea4\u548c\u624b\u52a8\u63d0\u4ea4 Offset","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_20","title":"\u63d0\u4ea4\u7684\u5185\u5bb9","text":"<p>\u6d88\u8d39\u8005\u65e0\u8bba\u662f\u81ea\u52a8\u63d0\u4ea4\u8fd8\u662f\u624b\u52a8\u63d0\u4ea4\uff0c\u90fd\u9700\u8981\u628a\u6240\u5c5e\u7684\u6d88\u8d39\u7ec4 + \u6d88\u8d39\u7684\u4e3b\u9898 + \u6d88\u8d39\u7684\u5206\u533a + \u6d88\u8d39\u7684\u504f\u79fb\u91cf\u8fd9\u6837\u7684\u4fe1\u606f\u63d0\u4ea4\u5230\u96c6\u7fa4\u7684 <code>__consumer_offsets</code> \u4e3b\u9898\u91cc\u9762\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_21","title":"\u81ea\u52a8\u63d0\u4ea4","text":"<p>\u6d88\u8d39\u8005 <code>poll</code> \u6d88\u606f\u4e0b\u6765\u540e\u5c31\u4f1a\u81ea\u52a8\u63d0\u4ea4 Offset\u3002\u81ea\u52a8\u63d0\u4ea4\u4f1a\u4e22\u6d88\u606f\uff0c\u56e0\u4e3a\u6d88\u8d39\u8005\u5728\u6d88\u8d39\u524d\u63d0\u4ea4 Offset\uff0c\u6709\u53ef\u80fd\u63d0\u4ea4\u5b8c\u540e\u8fd8\u6ca1\u6d88\u8d39\u5c31\u6302\u4e86\u3002</p> <pre><code>// \u662f\u5426\u81ea\u52a8\u63d0\u4ea4 Offset\uff08\u9ed8\u8ba4\u4e3a true\uff09\nprops.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"true\");\n// \u81ea\u52a8\u63d0\u4ea4 Offset \u7684\u95f4\u9694\u65f6\u95f4\nprops.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, \"1000\");\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_22","title":"\u624b\u52a8\u63d0\u4ea4","text":"<pre><code>props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"false\");\n</code></pre> <p>\u624b\u52a8\u63d0\u4ea4\u53c8\u5206\u6210\u4e86\u4e24\u79cd\uff1a</p> <ul> <li>\u624b\u52a8\u540c\u6b65\u63d0\u4ea4     &gt; \u5728\u6d88\u8d39\u5b8c\u6d88\u606f\u540e\u8c03\u7528\u540c\u6b65\u63d0\u4ea4\u7684\u65b9\u6cd5\uff0c\u5f53\u96c6\u7fa4\u8fd4\u56de Ack \u524d\u4e00\u76f4\u963b\u585e\uff0c\u8fd4\u56de Ack \u540e\u8868\u793a\u63d0\u4ea4\u6210\u529f\uff0c\u6267\u884c\u4e4b\u540e\u7684\u903b\u8f91\u3002     <pre><code>while (true) {\n    ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000));\n    for (ConsumerRecord&lt;String, String&gt; record : records) {\n        System.out.printf(\"partitoin=%d offset=%d key=%s value=%s\\n\", record.partition(), record.offset(), record.key(), record.value());\n    }\n    if (records.count() &gt; 0) {\n        // \u624b\u52a8\u540c\u6b65\u63d0\u4ea4 Offset\uff0c\u5f53\u524d\u7ebf\u7a0b\u4f1a\u963b\u585e\uff0c\u76f4\u5230 Offset \u63d0\u4ea4\u6210\u529f\n        consumer.commitAsync();\n    }\n}\n</code></pre></li> <li>\u624b\u52a8\u5f02\u6b65\u63d0\u4ea4     &gt; \u5728\u6d88\u606f\u6d88\u8d39\u5b8c\u540e\u63d0\u4ea4\uff0c\u4e0d\u9700\u8981\u7b49\u96c6\u7fa4 Ack\uff0c\u76f4\u63a5\u6267\u884c\u4e4b\u540e\u7684\u903b\u8f91\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u56de\u8c03\u65b9\u6cd5\u4f9b\u96c6\u7fa4\u8c03\u7528\u3002     <pre><code>while (true) {\n    ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000));\n    for (ConsumerRecord&lt;String, String&gt; record : records) {\n        System.out.printf(\"partitoin=%d offset=%d key=%s value=%s\\n\", record.partition(), record.offset(), record.key(), record.value());\n    }\n    consumer.commitAsync((Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, Exception e) -&gt; {\n        if (e != null) {\n            System.out.println(\"\u63d0\u4ea4\u5931\u8d25\");\n        }\n    });\n}\n</code></pre></li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#poll","title":"\u957f\u8f6e\u8be2 <code>poll</code> \u6d88\u606f","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u4e00\u6b21\u4f1a <code>poll</code> 500 \u6761\u6d88\u606f\u3002\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u4e86\u957f\u8f6e\u8be2\u7684\u65f6\u95f4\u4e3a 1000 \u6beb\u79d2\uff0c\u610f\u5473\u7740\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u6b21 <code>poll</code> \u5230 500 \u6761\uff0c\u5c31\u76f4\u63a5\u6267\u884c <code>for</code> \u5faa\u73af</li> <li>\u5982\u679c\u8fd9\u4e00\u6b21\u6ca1\u6709 <code>poll</code> \u5230 500 \u6761\uff0c\u4e14\u65f6\u95f4\u5728 1 \u79d2\u5185\uff0c\u90a3\u4e48\u957f\u8f6e\u8be2\u7ee7\u7eed <code>poll</code>\uff0c\u8981\u4e48\u5230 500 \u6761\uff0c\u8981\u4e48\u5230 1 \u79d2</li> <li>\u5982\u679c\u4e24\u6b21 <code>poll</code> \u90fd\u6ca1\u5230 500 \u6761\uff0c\u4e14 1 \u79d2\u65f6\u95f4\u5230\u4e86\uff0c\u90a3\u4e48\u76f4\u63a5\u6267\u884c <code>for</code> \u5faa\u73af</li> </ul> <p>\u5982\u679c\u4e24\u6b21 <code>poll</code> \u7684\u95f4\u9694\u8d85\u8fc7 30 \u79d2\uff0c\u96c6\u7fa4\u4f1a\u8ba4\u4e3a\u8be5\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u80fd\u529b\u8fc7\u5f31\uff0c\u8be5\u6d88\u8d39\u8005\u4f1a\u88ab\u8e22\u51fa\u6d88\u8d39\u7ec4\uff0c\u89e6\u53d1 Rebalance \u673a\u5236\uff0cRebalance \u673a\u5236\u4f1a\u9020\u6210\u6027\u80fd\u5f00\u9500\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u8fd9\u4e2a\u53c2\u6570\uff0c\u8ba9\u4e00\u6b21 <code>poll</code> \u7684\u6d88\u606f\u5c11\u4e00\u70b9\uff1a</p> <pre><code>props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 500);\nprops.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, 30 * 1000);\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_23","title":"\u6d88\u8d39\u8005\u7684\u5065\u5eb7\u72b6\u6001\u68c0\u67e5","text":"<p>\u6d88\u8d39\u8005\u6bcf\u9694 1 \u79d2\u5411 Kafka \u96c6\u7fa4\u53d1\u9001\u5fc3\u8df3\uff0c\u96c6\u7fa4\u53d1\u73b0\u5982\u679c\u6709\u8d85\u8fc7 10 \u79d2\u6ca1\u6709\u7eed\u7ea6\u7684\u6d88\u8d39\u8005\uff0c\u5c06\u8e22\u51fa\u6d88\u8d39\u7ec4\uff0c\u89e6\u53d1\u8be5\u6d88\u8d39\u7ec4\u7684 Rebalance \u673a\u5236\uff0c\u5c06\u5206\u533a\u4ea4\u7ed9\u6d88\u8d39\u7ec4\u91cc\u7684\u5176\u5b83\u6d88\u8d39\u8005\u8fdb\u884c\u6d88\u8d39\u3002</p> <pre><code>props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 1000);\nprops.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 10 * 1000);\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_24","title":"\u6307\u5b9a\u5206\u533a\u3001\u504f\u79fb\u91cf\u3001\u65f6\u95f4\u6d88\u8d39","text":"<ul> <li>\u6307\u5b9a\u5206\u533a\u6d88\u8d39     <pre><code>consumer.assign(List.of(new TopicPartition(\"test\", 0)));\n</code></pre></li> <li>\u6307\u5b9a Offset \u6d88\u8d39     <pre><code>// \u4ece\u5934\u6d88\u8d39\nconsumer.seekToBeginning(List.of(new TopicPartition(\"test\", 0)));\n// \u6307\u5b9a Offset \u6d88\u8d39\nconsumer.seek(new TopicPartition(\"test\", 0), 10);\n</code></pre></li> <li>\u6307\u5b9a\u65f6\u95f4\u6d88\u8d39     &gt; \u6839\u636e\u65f6\u95f4\uff0c\u53bb\u6240\u6709\u7684 Partition \u4e2d\u786e\u5b9a\u8be5\u65f6\u95f4\u5bf9\u5e94\u7684 Offset\uff0c\u7136\u540e\u53bb\u6240\u6709\u7684 Partition \u4e2d\u627e\u5230\u8be5 Offset \u4e4b\u540e\u7684\u6d88\u606f\u5f00\u59cb\u6d88\u8d39\u3002     <pre><code>// long timestamp = new Date().getTime() - 1000 * 60 * 60;\nlong timestamp = LocalDateTime.now().plusHours(-1).atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();\nMap&lt;TopicPartition, Long&gt; timestampsToSearch = consumer\n    .partitionsFor(topic)\n    .stream()\n    .collect(Collectors.toMap(\n        (PartitionInfo it) -&gt; new TopicPartition(topic, it.partition()),\n        (PartitionInfo it) -&gt; timestamp,\n        (v1, v2) -&gt; v2\n    ));\nconsumer\n    .offsetsForTimes(timestampsToSearch)\n    .forEach((TopicPartition key, OffsetAndTimestamp value) -&gt; {\n        // \u5982\u679c\u67e5\u8be2\u504f\u79fb\u91cf\u7684\u65f6\u95f4\u70b9\u5927\u4e8e\u6700\u5927\u7684\u7d22\u5f15\u8bb0\u5f55\u65f6\u95f4\u90a3\u4e48 value \u5c31\u4f1a\u4e3a\u7a7a\n        if (value != null) {\n            // \u6839\u636e timestamp \u786e\u5b9a offset\n            long offset = value.offset();\n            consumer.assign(List.of(key));\n            consumer.seek(key, offset);\n        }\n    });\n</code></pre></li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#offset_1","title":"\u65b0\u6d88\u8d39\u7ec4\u7684\u6d88\u8d39 Offset \u89c4\u5219","text":"<p>\u65b0\u6d88\u8d39\u7ec4\u4e2d\u7684\u6d88\u8d39\u8005\u5728\u542f\u52a8\u4ee5\u540e\uff0c\u9ed8\u8ba4\u4f1a\u4ece\u5f53\u524d\u5206\u533a\u7684\u6700\u540e\u4e00\u6761\u6d88\u606f\u7684 <code>offset + 1</code> \u5f00\u59cb\u6d88\u8d39\uff08\u6d88\u8d39\u65b0\u6d88\u606f\uff09\u3002\u901a\u8fc7\u4ee5\u4e0b\u7684\u8bbe\u7f6e\uff0c\u8ba9\u65b0\u7684\u6d88\u8d39\u8005\u7b2c\u4e00\u6b21\u4ece\u5934\u5f00\u59cb\u6d88\u8d39\uff0c\u4e4b\u540e\u5f00\u59cb\u6d88\u8d39\u65b0\u6d88\u606f\u3002</p> <ul> <li> <p><code>latest</code>\uff08\u9ed8\u8ba4\uff09</p> <p>\u6d88\u8d39\u65b0\u6d88\u606f\u3002</p> </li> <li> <p><code>earliest</code></p> <p>\u7b2c\u4e00\u6b21\u4ece\u5934\u5f00\u59cb\u6d88\u8d39\uff0c\u4e4b\u540e\u5f00\u59cb\u6d88\u8d39\u65b0\u6d88\u606f\u3002\u8fd9\u4e2a\u9700\u8981\u533a\u522b\u4e8e <code>consumer.seekToBeginning()</code>\uff08\u6bcf\u6b21\u90fd\u4ece\u5934\u5f00\u59cb\u6d88\u8d39\uff09\u3002</p> </li> </ul> <pre><code>props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, \"earliest\");\n</code></pre> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#spring-boot-kafka","title":"Spring Boot \u4e2d\u4f7f\u7528 Kafka","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_25","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;\n    &lt;version&gt;2.8.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_26","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>application.properties</code></p> <pre><code>spring.kafka.bootstrap-servers=192.192.192.6:9092\n\nspring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer\nspring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer\nspring.kafka.producer.acks=1\n\nspring.kafka.consumer.group-id=test-group\nspring.kafka.consumer.enable-auto-commit=false\nspring.kafka.consumer.auto-offset-reset=earliest\n\nspring.kafka.listener.ack-mode=MANUAL_IMMEDIATE\n</code></pre> <code>RECORD</code> \u5f53\u6bcf\u4e00\u6761\u8bb0\u5f55\u88ab\u6d88\u8d39\u8005\u76d1\u542c\u5668\u5904\u7406\u4e4b\u540e\u63d0\u4ea4 <code>BATCH</code> \u5f53\u6bcf\u4e00\u6279 <code>poll</code> \u7684\u6570\u636e\u88ab\u6d88\u8d39\u8005\u76d1\u542c\u5668\u5904\u7406\u4e4b\u540e\u63d0\u4ea4 <code>TIME</code> \u5f53\u6bcf\u4e00\u6279 <code>poll</code> \u7684\u6570\u636e\u88ab\u6d88\u8d39\u8005\u76d1\u542c\u5668\u5904\u7406\u4e4b\u540e\uff0c\u8ddd\u79bb\u4e0a\u6b21\u63d0\u4ea4\u65f6\u95f4\u5927\u4e8e <code>ack-time</code>\u65f6\u63d0\u4ea4 <code>COUNT</code> \u5f53\u6bcf\u4e00\u6279 <code>poll</code> \u7684\u6570\u636e\u88ab\u6d88\u8d39\u8005\u76d1\u542c\u5668\u5904\u7406\u4e4b\u540e\uff0c\u88ab\u5904\u7406\u7684 Record \u6570\u91cf\u5927\u4e8e\u7b49\u4e8e <code>ack-count</code> \u65f6\u63d0\u4ea4 <code>COUNT_TIME</code> <code>TIME</code> \u548c <code>COUNT</code> \u6709\u4e00\u4e2a\u6761\u4ef6\u6ee1\u8db3\u65f6\u63d0\u4ea4 <code>MANUAL</code> \u5f53\u6bcf\u4e00\u6279 <code>poll</code> \u7684\u6570\u636e\u88ab\u6d88\u8d39\u8005\u76d1\u542c\u5668\u5904\u7406\u4e4b\u540e\uff0c\u624b\u52a8\u8c03\u7528 <code>Acknowledgment.acknowledge()</code> \u540e\u63d0\u4ea4 <code>MANUAL_IMMEDIATE</code> \u624b\u52a8\u8c03\u7528 <code>Acknowledgment.acknowledge()</code> \u540e\u7acb\u5373\u63d0\u4ea4 </li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_27","title":"\u751f\u4ea7\u8005","text":"<pre><code>@RestController\npublic class MyKafkaController {\n    @Autowired\n    private KafkaTemplate&lt;String, String&gt; kafkaTemplate;\n\n    @GetMapping(\"/send\")\n    public void send() {\n        ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; future = kafkaTemplate.send(\"test\", 0, \"key\", \"\u6d88\u606f\");\n    }\n}\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_28","title":"\u6d88\u8d39\u8005","text":"<pre><code>@Component\npublic class MyConsumer {\n    @KafkaListener(topics = {\"test\"}, groupId = \"test-group\")\n    public void listen(ConsumerRecord&lt;String, String&gt; record, Acknowledgment ack) {\n        System.out.println(record);\n        // \u624b\u52a8\u63d0\u4ea4 Offset\n        ack.acknowledge();\n    }\n}\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_29","title":"\u6d88\u8d39\u8005\u4e2d\u914d\u7f6e\u4e3b\u9898\u3001\u5206\u533a\u3001\u504f\u79fb\u91cf","text":"<pre><code>@KafkaListener(\n    groupId = \"test-group\",\n    topicPartitions = {\n        @TopicPartition(\n            topic = \"topic-1\",\n            partitions = {\"0\", \"1\"},\n            partitionOffsets = {@PartitionOffset(partition = \"1\", initialOffset = \"100\")}\n        ),\n        @TopicPartition(topic = \"topic-2\")\n    },\n    // \u540c\u7ec4\u4e0b\u7684\u6d88\u8d39\u8005\u4e2a\u6570\uff0c\u5373\u5e76\u53d1\u6d88\u8d39\u6570\uff0c\u5efa\u8bae\u5c0f\u4e8e\u7b49\u4e8e\u5206\u533a\u603b\u6570\n    concurrency = \"3\"\n)\npublic void listen(ConsumerRecord&lt;String, String&gt; record, Acknowledgment ack) {\n    System.out.println(record);\n    // \u624b\u52a8\u63d0\u4ea4 Offset\n    ack.acknowledge();\n}\n</code></pre>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka-controllerrebalancehw","title":"Kafka \u96c6\u7fa4\u4e2d\u7684 Controller\u3001Rebalance\u3001HW","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#controller","title":"Controller","text":"<p>\u6bcf\u4e2a Broker \u542f\u4e1c\u65f6\u4f1a\u5411 ZK \u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u5e8f\u53f7\u8282\u70b9\uff0c\u83b7\u5f97\u7684\u5e8f\u53f7\u6700\u5c0f\u7684\u90a3\u4e2a Broker \u5c06\u4f1a\u4f5c\u4e3a\u96c6\u7fa4\u4e2d\u7684 Controller\uff0c\u8d1f\u8d23\uff1a</p> <ul> <li>\u5f53\u96c6\u7fa4\u4e2d\u6709\u4e00\u4e2a\u526f\u672c\u7684 Leader \u6302\u6389\uff0c\u9700\u8981\u5728\u96c6\u7fa4\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684 Leader\uff0c\u9009\u4e3e\u7684\u89c4\u5219\u662f\u4ece Isr \u96c6\u5408\u4e2d\u6700\u5de6\u8fb9\u83b7\u5f97\u3002</li> <li>\u5f53\u96c6\u7fa4\u4e2d\u6709 Broker \u65b0\u589e\u6216\u51cf\u5c11\uff0cController \u4f1a\u540c\u6b65\u4fe1\u606f\u7ed9\u5176\u5b83 Broker\u3002</li> <li>\u5f53\u96c6\u7fa4\u4e2d\u6709\u5206\u533a\u65b0\u589e\u6216\u51cf\u5c11\uff0cController \u4f1a\u540c\u6b65\u4fe1\u606f\u7ed9\u5176\u5b83 Broker\u3002</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#rebalance","title":"Rebalance \u673a\u5236","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_30","title":"\u524d\u63d0","text":"<p>\u6d88\u8d39\u7ec4\u4e2d\u7684\u6d88\u8d39\u8005\u6ca1\u6709\u6307\u660e\u5206\u533a\u6765\u6d88\u8d39</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_31","title":"\u89e6\u53d1\u7684\u6761\u4ef6","text":"<p>\u5f53\u6d88\u8d39\u7ec4\u4e2d\u7684\u6d88\u8d39\u8005\u548c\u5206\u533a\u7684\u5173\u7cfb\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_32","title":"\u5206\u533a\u5206\u914d\u7684\u7b56\u7565","text":"<ul> <li> <p>Range</p> <p>\u6839\u636e\u516c\u53f8\u8ba1\u7b97\u5f97\u5230\u6bcf\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u54ea\u51e0\u4e2a\u5206\u533a\u3002\u524d\u9762\u7684\u6d88\u8d39\u8005\u662f <code>&lt;\u5206\u533a\u603b\u6570&gt; / (&lt;\u6d88\u8d39\u8005\u6570\u91cf&gt; + 1)</code>\uff0c\u4e4b\u540e\u7684\u6d88\u8d39\u8005\u662f <code>&lt;\u5206\u533a\u603b\u6570&gt; / &lt;\u6d88\u8d39\u8005\u6570\u91cf&gt;</code>\u3002</p> </li> <li> <p>\u8f6e\u8be2</p> </li> <li> <p>Sticky</p> <p>\u7c98\u5408\u7b56\u7565\uff0c\u5982\u679c\u9700\u8981 Rebalance\uff0c\u4f1a\u5728\u4e4b\u524d\u5df2\u5206\u914d\u7684\u57fa\u7840\u4e0a\u8c03\u81f3\uff0c\u4e0d\u4f1a\u6539\u53d8\u4e4b\u524d\u7684\u5206\u914d\u60c5\u51b5\u3002\u5982\u679c\u8fd9\u4e2a\u6ca1\u6709\u7b56\u7565\u6ca1\u6709\u5f00\u542f\uff0c\u90a3\u4e48\u5c31\u8981\u8fdb\u884c\u5168\u90e8\u91cd\u65b0\u5206\u914d\u3002\u5efa\u8bae\u5f00\u542f\u3002</p> </li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#hw-leo","title":"HW \u548c LEO","text":"<p>HW\uff08High Watermark\uff09\u4fd7\u79f0\u9ad8\u6c34\u4f4d\uff0c\u53d6\u4e00\u4e2a Partition \u5bf9\u5e94\u7684 Isr \u96c6\u5408\u4e2d\u6700\u5c0f\u7684 LEO\uff08LOG-END-OFFSET\uff09\u4f5c\u4e3a HW\uff0cConsumer \u6700\u591a\u53ea\u80fd\u6d88\u8d39\u5230 HW \u6240\u5728\u7684\u4f4d\u7f6e\u3002\u53e6\u5916\u6bcf\u4e2a Replica \u90fd\u6709 HW\uff0cLeader \u548c Follower \u5404\u81ea\u8d1f\u8d23\u66f4\u65b0\u81ea\u5df1\u7684 HW \u72b6\u6001\u3002</p> <p>\u5bf9\u4e8e Leader \u65b0\u5199\u5165\u7684\u6d88\u606f\uff0cConsumer \u4e0d\u80fd\u7acb\u523b\u6d88\u8d39\uff0cLeader \u4f1a\u7b49\u5f85\u8be5\u6d88\u606f\u88ab\u6240\u6709 Isr \u96c6\u5408\u4e2d\u7684 Reolicas \u540c\u6b65\u540e\u66f4\u65b0 HW\uff0c\u6b64\u65f6\u6d88\u606f\u624d\u80fd\u88ab Consumer \u6d88\u8d39\u3002</p> <p>\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5982\u679c Leader \u6240\u5728\u7684 Broker \u5931\u6548\uff0c\u4f46\u8be5\u6d88\u606f\u4ecd\u7136\u53ef\u4ee5\u4ece\u65b0\u9009\u4e3e\u7684 Leader \u4e2d\u83b7\u53d6\uff0c\u8fd9\u6837\u7684\u76ee\u7684\u662f\u9632\u6b62\u6d88\u606f\u7684\u4e22\u5931\u3002</p> <p></p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#kafka_8","title":"Kafka \u7684\u4f18\u5316\u95ee\u9898","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_33","title":"\u5982\u4f55\u9632\u6b62\u6d88\u606f\u4e22\u5931","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_34","title":"\u751f\u4ea7\u8005","text":"<ol> <li>\u4f7f\u7528\u540c\u6b65\u53d1\u9001\u3002</li> <li>\u628a Ack \u8bbe\u4e3a <code>1</code> \u6216\u8005 <code>all</code>\uff0c\u5e76\u4e14\u8bbe\u7f6e\u540c\u6b65\u7684\u5206\u533a\u6570\uff08<code>min.insync.replicas</code>\uff09\u4e3a\u5206\u533a\u5907\u4efd\u6570\u3002</li> </ol>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_35","title":"\u6d88\u8d39\u8005","text":"<ol> <li>\u628a\u81ea\u52a8\u63d0\u4ea4\u6539\u6210\u624b\u52a8\u63d0\u4ea4</li> </ol>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_36","title":"\u5982\u4f55\u9632\u6b62\u91cd\u590d\u6d88\u8d39","text":"<p>\u5728\u9632\u6b62\u6d88\u606f\u7684\u65b9\u6848\u4e2d\uff0c\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u5b8c\u6d88\u606f\u540e\uff0c\u56e0\u4e3a\u7f51\u7edc\u6296\u52a8\uff0c\u6ca1\u6709\u6536\u5230 Ack\uff0c\u4f46\u5b9e\u9645\u4e0a Broker \u5df2\u7ecf\u6536\u5230\u6d88\u606f\u4e86\uff0c\u6b64\u65f6\u751f\u4ea7\u8005\u5c31\u4f1a\u91cd\u8bd5\uff0c\u4e8e\u662f Broker \u5c31\u4f1a\u6536\u5230\u591a\u6761\u76f8\u540c\u7684\u6d88\u606f\uff0c\u800c\u9020\u6210\u6d88\u8d39\u8005\u7684\u91cd\u590d\u6d88\u8d39\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_37","title":"\u89e3\u51b3\u65b9\u6848","text":"<ul> <li> <p>\u751f\u4ea7\u8005\u5173\u95ed\u91cd\u8bd5</p> <p>\u4f1a\u9020\u6210\u6d88\u606f\u4e22\u5931\uff0c\u4e0d\u5efa\u8bae\u3002</p> </li> <li> <p>\u6d88\u8d39\u8005\u89e3\u51b3\u975e\u5e42\u7b49\u6027\u6d88\u8d39\u95ee\u9898</p> <p>\u4e1a\u52a1 ID \u552f\u4e00\u6216\u5206\u5e03\u5f0f\u9501\u3002</p> </li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_38","title":"\u5982\u4f55\u505a\u5230\u6d88\u606f\u7684\u987a\u5e8f\u6d88\u8d39","text":"<ol> <li>\u751f\u4ea7\u8005\u4fdd\u8bc1\u6d88\u606f\u6309\u987a\u5e8f\u6d88\u8d39\uff0c\u4e14\u6d88\u606f\u4e0d\u4e22\u5931\uff0c\u4f7f\u7528\u540c\u6b65\u53d1\u9001\uff0cAck \u8bbe\u7f6e\u6210\u975e 0 \u7684\u503c\u3002</li> <li>\u4e3b\u9898\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u5206\u533a\uff0c\u6d88\u8d39\u7ec4\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u3002</li> </ol>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_39","title":"\u5982\u4f55\u89e3\u51b3\u6d88\u606f\u79ef\u538b\u95ee\u9898","text":"<p>\u6d88\u606f\u7684\u6d88\u8d39\u901f\u5ea6\u8fdc\u8d76\u4e0d\u4e0a\u751f\u4ea7\u901f\u5ea6\uff0c\u5bfc\u81f4 Kafka \u4e2d\u6709\u5927\u91cf\u7684\u6570\u636e\u6ca1\u6709\u88ab\u6d88\u8d39\u3002\u968f\u7740\u6ca1\u6709\u6d88\u8d39\u7684\u6570\u636e\u5806\u79ef\u8d8a\u591a\uff0c\u6d88\u8d39\u8005\u7684\u5bfb\u5740\u6027\u80fd\u4f1a\u8d8a\u6765\u8d8a\u5dee\uff0c\u6700\u540e\u5bfc\u81f4\u6574\u4e2a Kafka \u5bf9\u5916\u63d0\u4f9b\u7684\u670d\u52a1\u7684\u6027\u80fd\u5f88\u5dee\uff0c\u4ece\u800c\u5bfc\u81f4\u5176\u5b83\u670d\u52a1\u4e5f\u8bbf\u95ee\u901f\u5ea6\u53d8\u6162\uff0c\u9020\u6210\u670d\u52a1\u96ea\u5d29\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_40","title":"\u89e3\u51b3\u65b9\u6848","text":"<ul> <li>\u5728\u8fd9\u4e2a\u6d88\u8d39\u8005\u4e2d\uff0c\u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u5145\u5206\u5229\u7528\u673a\u5668\u7684\u6027\u80fd\u8fdb\u884c\u6d88\u8d39\u6d88\u606f\u3002</li> <li>\u901a\u8fc7\u4e1a\u52a1\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u63d0\u9ad8\u4e1a\u52a1\u5c42\u9762\u6d88\u8d39\u7684\u6027\u80fd\u3002</li> <li>\u521b\u5efa\u591a\u4e2a\u6d88\u8d39\u7ec4\uff0c\u591a\u4e2a\u6d88\u8d39\u8005\uff0c\u90e8\u7f72\u5230\u5176\u5b83\u673a\u5668\u4e0a\uff0c\u4e00\u8d77\u6d88\u8d39\uff0c\u63d0\u9ad8\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u901f\u5ea6</li> <li>\u521b\u5efa\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u8be5\u6d88\u8d39\u8005\u5728 Kafka \u53e6\u5efa\u4e00\u4e2a\u4e3b\u9898\uff0c\u914d\u4e0a\u591a\u4e2a\u5206\u533a\uff0c\u518d\u914d\u4e0a\u591a\u4e2a\u6d88\u8d39\u8005\u3002\u8be5\u6d88\u8d39\u8005\u5c06 <code>poll</code> \u4e0b\u6765\u7684\u6d88\u606f\uff0c\u4e0d\u8fdb\u884c\u6d88\u8d39\uff0c\u76f4\u63a5\u8f6c\u53d1\u5230\u65b0\u5efa\u7684\u4e3b\u9898\u4e0a\u3002\u6b64\u65f6\uff0c\u65b0\u7684\u4e3b\u9898\u7684\u591a\u4e2a\u5206\u533a\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5c31\u5f00\u59cb\u4e00\u8d77\u6d88\u8d39\u4e86\u3002</li> </ul>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_41","title":"\u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u961f\u5217","text":""},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_42","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u8ba2\u5355\u521b\u5efa\u540e\uff0c\u8d85\u8fc7 30 \u5206\u949f\u6ca1\u6709\u652f\u4ed8\uff0c\u5219\u9700\u8981\u53d6\u6d88\u8ba2\u5355\uff0c\u8fd9\u79cd\u573a\u666f\u53ef\u4ee5\u901a\u8fc7\u5ef6\u65f6\u961f\u5217\u6765\u5b9e\u73b0\u3002</p>"},{"location":"middleware/kafka/Kafka%20%E7%AC%94%E8%AE%B0/#_43","title":"\u89e3\u51b3\u65b9\u6848","text":"<ol> <li>Kafka \u4e2d\u521b\u5efa\u591a\u4e2a Topic\uff0c\u6bcf\u4e2a Topic \u8868\u793a\u5ef6\u65f6\u7684\u95f4\u9694\uff0c\u5982 <code>topic_30m</code>\u3002</li> <li>\u6d88\u606f\u53d1\u9001\u8005\u53d1\u9001\u6d88\u606f\u5230\u76f8\u5e94\u7684 Topic\uff0c\u5e76\u5e26\u4e0a\u6d88\u606f\u7684\u53d1\u9001\u65f6\u95f4\u3002</li> <li>\u6d88\u8d39\u8005\u8ba2\u9605\u76f8\u5e94\u7684 Topic\uff0c\u6d88\u8d39\u65f6\u957f\u8f6e\u8be2\u6d88\u8d39\u6574\u4e2a Topic \u4e2d\u7684\u6d88\u606f\u3002<ul> <li>\u5224\u65ad\u6d88\u8d39\u7684\u53d1\u9001\u65f6\u95f4\u548c\u5f53\u524d\u6bd4\u8f83\u5f53\u524d\u65f6\u95f4\u662f\u5426\u8d85\u8fc7\u9884\u8bbe\u7684\u503c\uff0c\u5982 30 \u5206\u949f\u3002</li> <li>\u5982\u679c\u8d85\u8fc7\uff0c\u53bb\u6570\u636e\u5e93\u4e2d\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u4e3a\u5df2\u53d6\u6d88\u3002</li> <li>\u5982\u679c\u672a\u8d85\u8fc7\uff0c\u8bb0\u5f55\u5f53\u524d\u6d88\u606f\u7684 Offset \u5e76\u4e0d\u518d\u7ee7\u7eed\u6d88\u8d39\u4e4b\u540e\u7684\u6d88\u606f\uff0c\u4e0b\u6b21\u6d88\u8d39 Offset \u4e4b\u540e\u7684\u6d88\u606f\u7ee7\u7eed\u8fdb\u884c\u5224\u65ad\u3002</li> </ul> </li> </ol>"},{"location":"middleware/kafka/kafka-3%20kraft%20%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/","title":"Kafka 3 kraft \u6a21\u5f0f\u5b89\u88c5","text":""},{"location":"middleware/kafka/kafka-3%20kraft%20%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/#_1","title":"\u5b89\u88c5","text":"<ul> <li>https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/3.0.0/</li> <li>https://kafka.apache.org/quickstart</li> </ul>"},{"location":"middleware/kafka/kafka-3%20kraft%20%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/#kraft","title":"KRaft \u914d\u7f6e","text":"<ul> <li> <p><code>config/kraft/README.md</code></p> <p></p> </li> <li> <p><code>config/kraft/server.properties</code></p> <p></p> </li> <li> <p>\u751f\u6210\u96c6\u7fa4 ID</p> <pre><code>bin/kafka-storage.sh random-uuid &gt; uuid\n</code></pre> <p></p> </li> <li> <p>\u683c\u5f0f\u5316\u5b58\u50a8\u76ee\u5f55</p> <pre><code>bin/kafka-storage.sh format -t `cat uuid` -c config/kraft/server.properties\n</code></pre> </li> </ul>"},{"location":"middleware/kafka/kafka-3%20kraft%20%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85/#_2","title":"\u542f\u52a8","text":"<ul> <li> <p>\u542f\u52a8</p> <pre><code>bin/kafka-server-start.sh -daemon config/kraft/server.properties\n</code></pre> </li> <li> <p>\u521b\u5efa\u4e3b\u9898</p> <pre><code>bin/kafka-topics.sh --create --topic foo --partitions 1 --replication-factor 1 --bootstrap-server localhost:9092\n</code></pre> </li> </ul>"},{"location":"middleware/mycat2/","title":"MyCAT2","text":""},{"location":"middleware/mycat2/#_1","title":"\u5b89\u88c5","text":"<pre><code>wget http://dl.mycat.org.cn/2.0/install-template/mycat2-install-template-1.21.zip\nwget http://dl.mycat.org.cn/2.0/1.22-release/mycat2-1.22-release-jar-with-dependencies-2022-10-13.jar\nwget http://dl.mycat.org.cn/2.0/install-template/wrapper-linux-aarch64-64\n\nunzip -d /opt/env mycat2-install-template-1.21.zip\ncp mycat2-1.22-release-jar-with-dependencies-2022-10-13.jar /opt/env/mycat/lib\ncp wrapper-linux-aarch64-64 /opt/env/mycat/bin\n\nchmod +x -R /opt/env/mycat/bin\n</code></pre>"},{"location":"middleware/mycat2/#_2","title":"\u542f\u52a8","text":"<ol> <li> <p>\u4fee\u6539 <code>prototype</code> \u6570\u636e\u6e90\u8fde\u63a5\u4fe1\u606f</p> <pre><code>vim conf/datasources/prototypeDs.datasource.json\n</code></pre> </li> <li> <p>\u542f\u52a8</p> <pre><code>cd /opt/env/mycat\n\nbin/mycat start\n</code></pre> </li> <li> <p>\u8fde\u63a5</p> <pre><code>mysql -h192.192.192.101 -P8066 -uroot -p123456\n</code></pre> </li> <li> <p>\u91cd\u7f6e\u914d\u7f6e</p> <p>\u76f4\u63a5\u5728 MyCAT \u7684\u5ba2\u6237\u7aef\u6267\u884c\u3002</p> <pre><code>/*+ mycat:resetConfig{} */;\n</code></pre> </li> </ol>"},{"location":"middleware/mycat2/#_3","title":"\u8bfb\u5199\u5206\u79bb\u914d\u7f6e","text":"<ol> <li> <p>\u6dfb\u52a0\u6570\u636e\u6e90</p> <pre><code>/*+ mycat:createDataSource{ \"name\":\"ds0\", \"url\":\"jdbc:mysql://192.192.192.101:3306/demo\", \"user\":\"root\", \"password\":\"root\" } */;\n/*+ mycat:createDataSource{ \"name\":\"ds1\", \"url\":\"jdbc:mysql://192.192.192.101:3307/demo\", \"user\":\"root\", \"password\":\"root\" } */;\n/*+ mycat:createDataSource{ \"name\":\"ds2\", \"url\":\"jdbc:mysql://192.192.192.101:3308/demo\", \"user\":\"root\", \"password\":\"root\" } */;\n/*+ mycat:showDataSources{} */;\n</code></pre> </li> <li> <p>\u6dfb\u52a0\u96c6\u7fa4</p> <pre><code>/*! mycat:createCluster{\"name\":\"prototype\",\"masters\":[\"ds0\"],\"replicas\":[\"ds1\", \"ds2\"]} */;\n/*+ mycat:showClusters{} */;\n</code></pre> </li> <li> <p>\u521b\u5efa\u865a\u62df\u5e93\u548c\u865a\u62df\u8868</p> <p>MyCAT \u5efa\u8868\u65f6\u4f7f\u7528 <code>auto_increment</code> \u9ed8\u8ba4\u4f7f\u7528 MyCAT \u7684\u96ea\u82b1\u7b97\u6cd5\u751f\u6210\u5168\u5c40\u5e8f\u5217\u53f7\u3002</p> <pre><code>create database demo;\n\nuse demo;\n\ncreate table t_user (\n  id       bigint      not null auto_increment,\n  username varchar(64) not null,\n  primary key(id)\n);\n</code></pre> </li> </ol>"},{"location":"middleware/mycat2/#_4","title":"\u5206\u5e93\u5206\u8868\u914d\u7f6e","text":""},{"location":"middleware/mycat2/#_5","title":"\u6570\u636e\u6e90\u914d\u7f6e","text":"<pre><code>/*+ mycat:createDataSource{ \"name\":\"ds0\", \"url\":\"jdbc:mysql://192.192.192.101:3306\", \"user\":\"root\", \"password\":\"root\" } */;\n/*+ mycat:createDataSource{ \"name\":\"ds1\", \"url\":\"jdbc:mysql://192.192.192.101:3307\", \"user\":\"root\", \"password\":\"root\" } */;\n\n/*! mycat:createCluster{\"name\":\"c0\",\"masters\":[\"ds0\"],\"replicas\":[]} */;\n/*! mycat:createCluster{\"name\":\"c1\",\"masters\":[\"ds1\"],\"replicas\":[]} */;\n\n/*+ mycat:showDataSources{} */;\n/*+ mycat:showClusters{} */;\n</code></pre>"},{"location":"middleware/mycat2/#_6","title":"\u5e7f\u64ad\u8868","text":"<pre><code>create table t_dict (\n    id         bigint      not null auto_increment,\n    dict_key   varchar(64) not null,\n    dict_value varchar(64) not null,\n    primary key(id)\n) broadcast;\n</code></pre>"},{"location":"middleware/mycat2/#_7","title":"\u5206\u7247\u8868","text":"<pre><code>create table t_order (\n   id         bigint      not null auto_increment,\n   order_code varchar(64) not null,\n   primary key(id)\n)\ndbpartition by mod_hash(order_code) dbpartitions 2\ntbpartition by mod_hash(id)         tbpartitions 3;\n</code></pre> <pre><code>create table t_order_item (\n    id            bigint        not null,\n    order_code    varchar(64)   not null,\n    product_price decimal(10,2) not null,\n    product_count bigint        not null,\n    primary key(id)\n)\ndbpartition by mod_hash(order_code) dbpartitions 2\ntbpartition by mod_hash(id)         tbpartitions 3;\n</code></pre>"},{"location":"middleware/mycat2/#er","title":"ER \u5173\u7cfb","text":"<pre><code>/*+ mycat:showErGroup{} */;\n</code></pre>"},{"location":"middleware/mycat2/#_8","title":"\u5206\u7247\u89c4\u5219","text":""},{"location":"middleware/mycat2/#mod_hash","title":"<code>MOD_HASH</code>","text":"<p>\u5982\u679c\u5206\u7247\u503c\u662f\u5b57\u7b26\u4e32\u5219\u5148\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c hash \u8f6c\u6362\u4e3a\u6570\u503c\u7c7b\u578b\u3002</p> <ul> <li> <p>\u5206\u5e93\u952e\u548c\u5206\u8868\u952e\u662f\u540c\u952e</p> <pre><code>\u5206\u8868\u4e0b\u6807 = \u5206\u7247\u503c % (\u5206\u5e93\u6570\u91cf * \u5206\u8868\u6570\u91cf)\n\u5206\u5e93\u4e0b\u6807 = \u5206\u8868\u4e0b\u6807 / \u5206\u8868\u6570\u91cf\n</code></pre> </li> <li> <p>\u5206\u5e93\u952e\u548c\u5206\u8868\u952e\u662f\u4e0d\u540c\u952e</p> <pre><code>\u5206\u8868\u4e0b\u6807 = \u5206\u7247\u503c % \u5206\u8868\u6570\u91cf\n\u5206\u5e93\u4e0b\u6807 = \u5206\u7247\u503c % \u5206\u5e93\u6570\u91cf\n</code></pre> </li> </ul>"},{"location":"middleware/rabbitmq/","title":"RabbitMQ","text":""},{"location":"middleware/rabbitmq/#_1","title":"\u6536\u85cf","text":""},{"location":"middleware/rabbitmq/#rabbitmq-29","title":"RabbitMQ \u9762\u8bd5\u9898\u5fc5\u77e5\u5fc5\u4f1a 29 \u9053\uff08\u9644\u7b54\u6848\uff09","text":""},{"location":"middleware/rabbitmq/#httpswwwiocodercnspring-bootrabbitmq","title":"https://www.iocoder.cn/Spring-Boot/RabbitMQ/","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/","title":"RabbitMQ \u7b14\u8bb0","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_1","title":"\u4e00\u3001\u4ecb\u7ecd","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#11","title":"1.1 \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#broker","title":"Broker","text":"<p>\u63a5\u6536\u548c\u5206\u53d1\u6d88\u606f\u7684\u5e94\u7528\uff0cRabbitMQ Server \u5c31\u662f Message Broker\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#virtual-host","title":"Virtual Host","text":"<p>\u51fa\u4e8e\u591a\u79df\u6237\u548c\u5b89\u5168\u56e0\u7d20\u800c\u8bbe\u8ba1\uff0c\u628a AMQP \u7684\u57fa\u672c\u7ec4\u4ef6\u5212\u5206\u5230\u4e00\u4e2a\u865a\u62df\u7684\u5206\u7ec4\u4e2d\uff0c\u7c7b\u4f3c\u4e8e\u7f51\u7edc\u4e2d\u7684 Namespace \u6982\u5ff5\u3002\u5f53\u591a\u4e2a\u4e0d\u540c\u7684\u7528\u6237\u4f7f\u7528\u540c\u4e00\u4e2a RabbitMQ Server \u63d0\u4f9b\u7684\u670d\u52a1\u65f6\uff0c\u53ef\u4ee5\u5212\u5206\u51fa\u591a\u4e2a VHost\uff0c\u6bcf\u4e2a\u7528\u6237\u5728\u81ea\u5df1\u7684 VHost \u521b\u5efa Exchange / Queue \u7b49\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#connection","title":"Connection","text":"<p>Producer / Consumer \u548c Broker \u4e4b\u95f4\u7684 TCP \u8fde\u63a5\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#channel","title":"Channel","text":"<p>\u5982\u679c\u6bcf\u4e00\u6b21\u8bbf\u95ee RabbitMQ \u90fd\u5efa\u7acb\u4e00\u4e2a Connection\uff0c\u5728\u6d88\u606f\u91cf\u5927\u7684\u65f6\u5019\u5efa\u7acb TCP Connection \u9053\u5fb7\u5f00\u9500\u5c06\u662f\u5de8\u5927\u7684\uff0c\u6548\u7387\u4e5f\u8f83\u4f4e\u3002Channel \u662f\u5728 Connection \u5185\u90e8\u5efa\u7acb\u7684\u903b\u8f91\u8fde\u63a5\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u652f\u6301\u591a\u7ebf\u7a0b\uff0c\u901a\u5e38\u6bcf\u4e2a Thread \u521b\u5efa\u5355\u72ec\u7684 Channel \u8fdb\u884c\u901a\u8baf\uff0cAMQP \u65b9\u6cd5\u5305\u542b\u4e86 Channel ID \u5e2e\u52a9\u5ba2\u6237\u7aef\u548c Message Broker \u8bc6\u522b Channel\uff0c\u6240\u4ee5 Channel \u4e4b\u95f4\u662f\u5b8c\u5168\u9694\u79bb\u7684\u3002Channel \u4f5c\u4e3a\u8f7b\u91cf\u7ea7\u7684 Connection \u6781\u5927\u51cf\u5c11\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5efa\u7acb TCP Connection \u7684\u5f00\u9500\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#exchange","title":"Exchange","text":"<p>Message \u5230\u8fbe Broker \u7684\u7b2c\u4e00\u7ad9\uff0c\u6839\u636e\u5206\u53d1\u89c4\u5219\u5339\u914d Routing Key \u5206\u53d1\u6d88\u606f\u5230 Queue \u4e2d\u53bb\u3002</p> <p>\u4ea4\u6362\u673a\u662f RabbitMQ \u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u90e8\u4ef6\uff0c\u4e00\u65b9\u9762\u5b83\u63a5\u6536\u6765\u81ea\u751f\u4ea7\u8005\u7684\u6d88\u606f\uff0c\u53e6\u4e00\u65b9\u9762\u5b83\u5c06\u6d88\u606f\u63a8\u9001\u5230\u961f\u5217\u4e2d\u3002\u4ea4\u6362\u673a\u5fc5\u987b\u786e\u5207\u77e5\u9053\u5982\u4f55\u5904\u7406\u5b83\u63a5\u6536\u5230\u7684\u6d88\u606f\uff0c\u662f\u5c06\u8fd9\u4e9b\u6d88\u606f\u63a8\u9001\u5230\u7279\u5b9a\u961f\u5217\u8fd8\u662f\u63a8\u9001\u5230\u591a\u4e2a\u961f\u5217\uff0c\u4ea6\u6216\u8005\u662f\u628a\u6d88\u606f\u4e22\u5f03\uff0c\u8fd9\u4e2a\u90fd\u6709\u4ea4\u6362\u673a\u7c7b\u578b\u51b3\u5b9a\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#queue","title":"Queue","text":"<p>\u961f\u5217\u662f RabbitMQ \u5185\u90e8\u4f7f\u7528\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5c3d\u7ba1\u6d88\u606f\u6d41\u7ecf RabbitMQ \u548c\u5e94\u7528\u7a0b\u5e8f\uff0c\u4f46\u5b83\u4eec\u53ea\u80fd\u5b58\u50a8\u5728\u961f\u5217\u4e2d\u3002\u961f\u5217\u4ec5\u53d7\u4e3b\u673a\u7684\u5185\u5b58\u548c\u78c1\u76d8\u9650\u5236\u7684\u7ea6\u675f\uff0c\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5927\u7684\u6d88\u606f\u7f13\u51b2\u533a\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#binding","title":"Binding","text":"<p>Exchange \u548c Queue \u4e4b\u95f4\u7684\u865a\u62df\u8fde\u63a5\uff0cBinding \u4e2d\u53ef\u4ee5\u5305\u542b Routing Key\uff0cBinding \u4fe1\u606f\u88ab\u4fdd\u5b58\u5728 Exchange \u4e2d\u7684\u67e5\u8be2\u8868\u4e2d\uff0c\u4f5c\u4e3a Message \u7684\u5206\u53d1\u4f9d\u636e\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_2","title":"\u4e8c\u3001\u5b89\u88c5","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#21","title":"2.1 \u901a\u8fc7\u5305\u7ba1\u7406\u5668\u5b89\u88c5","text":"<p>\u901a\u8fc7 <code>--fix-missing</code> \u9009\u9879\u81ea\u52a8\u89e3\u51b3\u9700\u8981\u7684\u4f9d\u8d56\uff08\u5982 <code>erlang</code> \u548c <code>socat</code> \u7b49\uff09\u3002\u6700\u65b0\u7248\u672c\u5b89\u88c5\u53c2\u8003\uff1ahttps://www.rabbitmq.com/install-debian.html\u3002</p> <pre><code>apt install rabbitmq-server -y --fix-missing\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#22-web","title":"2.2 \u5f00\u542f Web \u7ba1\u7406\u63d2\u4ef6","text":"<pre><code>rabbitmq-plugins enable rabbitmq_management\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#23","title":"2.3 \u7528\u6237\u548c\u6388\u6743","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_3","title":"\u9ed8\u8ba4\u7528\u6237","text":"<p>RabbitMQ \u9ed8\u8ba4\u7528\u6237\u548c\u5bc6\u7801\u90fd\u4e3a <code>guest</code>\uff0c\u4f46\u53ea\u80fd\u672c\u5730 <code>localhost</code> \u8bbf\u95ee\u3002\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e <code>loopback_users = none</code> \u89e3\u9664\u9650\u5236\uff0c\u6bd4\u5982 RabbitMQ \u7684\u5b98\u65b9\u955c\u50cf\u5bb9\u5668\u7684\u9ed8\u8ba4\u914d\u7f6e\uff1a</p> <ul> <li> <p><code>/etc/rabbitmq/conf.d/10-default-guest-user.conf</code></p> <pre><code>## DEFAULT SETTINGS ARE NOT MEANT TO BE TAKEN STRAIGHT INTO PRODUCTION\n## see https://www.rabbitmq.com/configure.html for further information\n## on configuring RabbitMQ\n\n## allow access to the guest user from anywhere on the network\n## https://www.rabbitmq.com/access-control.html#loopback-users\n## https://www.rabbitmq.com/production-checklist.html#users\nloopback_users.guest = false\n</code></pre> </li> </ul> <p>\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u521b\u5efa\u65b0\u7684\u7ba1\u7406\u7528\u6237\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_4","title":"\u521b\u5efa\u7ba1\u7406\u7528\u6237","text":"<pre><code>rabbitmqctl add_user admin admin\n\nrabbitmqctl set_user_tags admin administrator\n\nrabbitmqctl set_permissions -p / admin \".*\" \".*\" \".*\"\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_5","title":"\u89d2\u8272\u5206\u7c7b","text":"<ul> <li>None<ul> <li>\u4e0d\u80fd\u8bbf\u95ee Managment \u63d2\u4ef6</li> </ul> </li> <li>Management<ul> <li>\u5217\u51fa\u81ea\u5df1\u53ef\u4ee5\u901a\u8fc7 AMQP \u767b\u5165\u7684 VHost</li> <li>\u67e5\u770b\u81ea\u5df1\u7684 VHost \u8282\u70b9\u7684 Queue\u3001Exchange\u3001Binding \u4fe1\u606f</li> <li>\u67e5\u770b\u548c\u5173\u95ed\u81ea\u5df1 Channel \u548c Connection</li> <li>\u67e5\u770b\u6709\u5173\u81ea\u5df1\u7684 VHost \u7edf\u8ba1\u4fe1\u606f\uff0c\u5305\u62ec\u5176\u5b83\u7528\u6237\u5728\u8fd9\u4e2a VHost \u4e2d\u7684\u6d3b\u52a8\u4fe1\u606f</li> </ul> </li> <li>Poclicymaker<ul> <li>\u5305\u542b Management \u6240\u6709\u6743\u9650</li> <li>\u67e5\u770b\u548c\u5220\u9664\u81ea\u5df1\u7684 VHost \u6240\u5c5e\u7684 Policy \u548c Parameter \u4fe1\u606f</li> </ul> </li> <li>Monitoring<ul> <li>\u5305\u542b Management \u6240\u6709\u6743\u9650</li> <li>\u5217\u51fa\u6240\u6709\u7684 VHost\uff0c\u5305\u62ec\u4e0d\u80fd\u767b\u5f55\u7684 VHost</li> <li>\u67e5\u770b\u5176\u5b83\u7528\u6237\u7684 Connection \u548c Channel \u4fe1\u606f</li> <li>\u67e5\u770b\u8282\u70b9\u7ea7\u522b\u7684\u6570\u636e\uff0c\u5982 Clustering \u548c Memory \u4f7f\u7528\u60c5\u51b5</li> <li>\u67e5\u770b\u6240\u6709\u7684 VHost \u7684\u5168\u5c40\u7edf\u8ba1\u4fe1\u606f</li> </ul> </li> <li>Administrator<ul> <li>\u6700\u9ad8\u6743\u9650</li> <li>\u53ef\u4ee5\u521b\u5efa\u548c\u5220\u9664 VHost</li> <li>\u53ef\u4ee5\u521b\u5efa\u548c\u5220\u9664 User</li> <li>\u53ef\u4ee5\u521b\u5efa Permission</li> <li>\u53ef\u4ee5\u5173\u95ed\u6240\u6709\u7528\u6237\u7684 Connection</li> </ul> </li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#java","title":"\u4e09\u3001Java \u5ba2\u6237\u7aef","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#31","title":"3.1 \u4f9d\u8d56","text":"<p>\u5ba2\u6237\u7aef\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;\n    &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;\n    &lt;version&gt;5.14.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u65e5\u5fd7\u4f9d\u8d56\uff1a</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n    &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;\n    &lt;version&gt;1.7.32&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#32","title":"3.2 \u793a\u4f8b","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#321","title":"3.2.1 \u7b80\u5355\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_6","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u7b80\u5355\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    public static void main(String[] args) {\n        // 1. \u521b\u5efa\u8fde\u63a5\u5de5\u5382\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"192.192.192.6\");\n        factory.setPort(5672);\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"admin\");\n\n        // \u4f7f\u7528 try-with-resources \u8bed\u6cd5(\u53d1\u9001\u5b8c\u6d88\u606f\u540e\u8fde\u63a5\u81ea\u52a8\u91ca\u653e)\n        String connectionName = MyProducer.class.getSimpleName();\n        try (\n            // 2. \u521b\u5efa\u8fde\u63a5\n            Connection connection = factory.newConnection(connectionName);\n\n            // 3. \u521b\u5efa\u901a\u9053\n            Channel channel = connection.createChannel()\n        ) {\n            // 4. \u58f0\u660e\u961f\u5217(\u58f0\u660e\u4e00\u4e2a\u961f\u5217\u662f\u5e42\u7b49\u7684\uff0c\u53ea\u6709\u5f53\u5b83\u4e0d\u5b58\u5728\u65f6\u624d\u4f1a\u521b\u5efa)\n            String queue = \"q.tutorial_one\";      // \u961f\u5217\u540d\n            boolean durable = false;              // \u662f\u5426\u6301\u4e45\u5316(\u91cd\u542f\u540e\u961f\u5217\u662f\u5426\u8fd8\u5b58\u5728)\n            boolean exclusive = false;            // \u662f\u5426\u72ec\u5360\n            boolean autoDelete = false;           // \u662f\u5426\u81ea\u52a8\u5220\u9664\n            Map&lt;String, Object&gt; arguments = null; // \u5176\u5b83\u53c2\u6570\n            channel.queueDeclare(queue, durable, exclusive, autoDelete, arguments);\n\n            // 5. \u53d1\u9001\u6d88\u606f\n            String exchange = \"\";                 // \u4ea4\u6362\u673a\u540d(\u9ed8\u8ba4\u4ea4\u4e92\u673a\u540d\u79f0\u4e3a `AMQP default` \u7c7b\u578b\u4e3a `direct`)\n            String routingKey = queue;            // \u8def\u7531\u952e(\u9ed8\u8ba4\u4ea4\u6362\u673a\u4f7f\u7528\u961f\u5217\u540d\u5339\u914d\u961f\u5217)\n            AMQP.BasicProperties headers = null;  // \u6d88\u606f\u5934\n            String body = \"This is a message\";    // \u6d88\u606f\u4f53\n            channel.basicPublish(exchange, routingKey, headers, body.getBytes());\n            System.out.printf(\"Sent message='%s'\\n\", body);\n\n            // 5. \u5faa\u73af\u53d1\u9001\u6d88\u606f\n            // Scanner sc = new Scanner(System.in);\n            // while (sc.hasNextLine()) {\n            //     String body = sc.nextLine();\n            //     channel.basicPublish(exchange, routingKey, null, body.getBytes());\n            //     System.out.printf(\"Sent message='%s'\\n\", body);\n            // }\n        } catch (IOException | TimeoutException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_7","title":"\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u7b80\u5355\u6a21\u5f0f-\u6d88\u8d39\u8005\n */\npublic class MyConsumer {\n    public static void main(String[] args) {\n        // 1. \u521b\u5efa\u8fde\u63a5\u5de5\u5382\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"192.192.192.6\");\n        factory.setPort(5672);\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"admin\");\n\n        // \u4e0d\u4f7f\u7528 try-with-resources \u8bed\u6cd5(\u907f\u514d\u6d88\u8d39\u5b8c\u6d88\u606f\u540e\u8fde\u63a5\u81ea\u52a8\u91ca\u653e)\n        try {\n            // 2. \u521b\u5efa\u8fde\u63a5\n            Connection connection = factory.newConnection(MyConsumer.class.getSimpleName());\n\n            // 3. \u521b\u5efa\u901a\u9053\n            Channel channel = connection.createChannel();\n\n            String queue = \"q.tutorial_one\";\n\n            // 4. \u58f0\u660e\u961f\u5217(\u58f0\u660e\u4e00\u4e2a\u961f\u5217\u662f\u5e42\u7b49\u7684\uff0c\u53ea\u6709\u5f53\u5b83\u4e0d\u5b58\u5728\u65f6\u624d\u4f1a\u521b\u5efa)\n            channel.queueDeclare(queue, false, false, false, null);\n\n            // 5. \u6d88\u8d39\u6d88\u606f\n            boolean autoAck = true;                                        // \u662f\u5426\u81ea\u52a8\u5e94\u7b54\uff08\u9ed8\u8ba4\u4e3a false\uff09\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; { // \u6d88\u8d39\u56de\u8c03\n                String body = new String(delivery.getBody());\n                System.out.printf(\"Received message='%s'\\n\", body);\n            };\n            CancelCallback cancelCallback = consumerTag -&gt; {               // \u53d6\u6d88\u6d88\u8d39\u56de\u8c03(\u5982\u5728\u6d88\u8d39\u65f6\u961f\u5217\u88ab\u5220\u9664)\n                System.err.println(\"Consuming was interrupted\");\n            };\n            channel.basicConsume(queue, autoAck, deliverCallback, cancelCallback);\n        } catch (IOException | TimeoutException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_8","title":"\u5de5\u5177\u7c7b","text":"<p>\u53ef\u4ee5\u53d1\u73b0\u751f\u4ea7\u6d88\u606f\u548c\u6d88\u8d39\u6d88\u606f\u7684\u6574\u4f53\u6d41\u7a0b\u662f\u4e00\u81f4\u7684\uff1a</p> <ol> <li>\u521b\u5efa\u8fde\u63a5\u5de5\u5382</li> <li>\u521b\u5efa\u901a\u9053</li> <li>\u64cd\u4f5c Channel</li> </ol> <p>\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c01\u88c5\u4e00\u4e2a\u53ef\u4ee5\u76f4\u63a5\u63d0\u4f9b Channel \u7684\u5de5\u5177\u65b9\u6cd5\uff1a</p> <pre><code>public class MyRabbitMQ {\n    private static final ConnectionFactory CONNECTION_FACTORY = new ConnectionFactory();\n\n    static {\n        CONNECTION_FACTORY.setHost(\"192.192.192.6\");\n        CONNECTION_FACTORY.setPort(5672);\n        CONNECTION_FACTORY.setUsername(\"admin\");\n        CONNECTION_FACTORY.setPassword(\"admin\");\n    }\n\n    public static void start(String connectionName, boolean autoClose, ThrowableConsumer&lt;Channel, Exception&gt; throwableConsumer) {\n        if (autoClose) {\n            try (\n                Connection connection = CONNECTION_FACTORY.newConnection(connectionName);\n                Channel channel = connection.createChannel()\n            ) {\n                throwableConsumer.accept(channel);\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        } else {\n            try {\n                Connection connection = CONNECTION_FACTORY.newConnection(connectionName);\n                Channel channel = connection.createChannel();\n                throwableConsumer.accept(channel);\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    public static interface ThrowableConsumer&lt;T, E extends Throwable&gt; {\n        void accept(T t) throws E;\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#322","title":"3.2.2 \u5de5\u4f5c\u961f\u5217\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_9","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u5de5\u4f5c\u961f\u5217\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = \"\";            // \u9ed8\u8ba4\u4ea4\u6362\u673a\n    static final String QUEUE = MyConsumer.QUEUE; // \u961f\u5217\u4e00\u822c\u5728\u6d88\u8d39\u8005\u7aef\u58f0\u660e\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            for (int i = 1; i &lt;= 20; i++) {\n                String body = \"This is the \" + i + \"-th message\";\n                channel.basicPublish(EXCHANGE, QUEUE, null, body.getBytes());\n                System.out.printf(\"Sent message='%s'\\n\", body);\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_10","title":"\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u5de5\u4f5c\u961f\u5217\u6a21\u5f0f-\u6d88\u8d39\u8005\n */\npublic class MyConsumer {\n    static final String QUEUE = \"q.tutorial_two\";\n\n    public static void main(String[] args) {\n        String connectionName1 = MyConsumer.class.getSimpleName() + \"1\";\n        String connectionName2 = MyConsumer.class.getSimpleName() + \"2\";\n        long cost1 = 500L;\n        long cost2 = 1500L;\n\n        new Thread(() -&gt; roundRobinDispatch(connectionName1, cost1)).start();\n        new Thread(() -&gt; roundRobinDispatch(connectionName2, cost2)).start();\n\n        // new Thread(() -&gt; fairDispatch(connectionName1, cost1)).start();\n        // new Thread(() -&gt; fairDispatch(connectionName2, cost2)).start();\n\n        while (true) { }\n    }\n\n    /**\n     * \u5de5\u4f5c\u961f\u5217\u6a21\u5f0f-\u8f6e\u8be2\u5206\u53d1\n     */\n    static void roundRobinDispatch(String connectionName, long cost) {\n        MyRabbitMQ.start(connectionName, false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                // 1. \u6536\u5230\u6d88\u606f\n                System.out.printf(\"Received consumer='%s' message='%s'\\n\", connectionName, new String(delivery.getBody()));\n                // 2. \u5904\u7406\u6d88\u606f\n                try { TimeUnit.MILLISECONDS.sleep(cost); } catch (Exception ignored) { }\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n\n    /**\n     * \u5de5\u4f5c\u961f\u5217\u6a21\u5f0f-\u516c\u5e73\u5206\u53d1\n     */\n    static void fairDispatch(String connectionName, long cost) {\n        MyRabbitMQ.start(connectionName, false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            channel.basicQos(1); // \u9650\u5236\u672a\u786e\u8ba4\u6d88\u606f\u7f13\u51b2\u533a\u5927\u5c0f(\u4e00\u6b21\u53ea\u63a5\u6536\u4e00\u6761\u672a\u786e\u8ba4\u7684\u6d88\u606f)\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                // 1. \u6536\u5230\u6d88\u606f\n                System.out.printf(\"Received consumer='%s' message='%s'\\n\", connectionName, new String(delivery.getBody()));\n\n                // 2. \u5904\u7406\u6d88\u606f\n                try { TimeUnit.MILLISECONDS.sleep(cost); } catch (Exception ignored) { }\n\n                long deliveryTag = delivery.getEnvelope().getDeliveryTag(); // \u6d88\u606f ID(\u670d\u52a1\u5668\u7aef\u5411\u6d88\u8d39\u8005\u63a8\u9001\u6d88\u606f\uff0c\u6d88\u606f\u4f1a\u643a\u5e26\u4e00\u4e2a `deliveryTag` \u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u79f0\u6b64\u53c2\u6570\u4e3a\u6d88\u606f\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u662f\u4e00\u4e2a\u9012\u589e\u7684\u6b63\u6574\u6570)\n                boolean multiple = false;                                   // \u662f\u5426\u6279\u91cf\u5e94\u7b54(\u5982\u5f53\u524d tag=8\uff0c\u5e76\u4e14\u901a\u9053\u4e0a tag \u5728 5-8 \u7684\u6d88\u606f\u8fd8\u672a\u5e94\u7b54\uff0c\u662f\u5426\u4e00\u6b21\u6027\u5e94\u7b54\u5f53\u524d tag \u53ca\u5176\u4e4b\u524d\u6240\u6709\u5c1a\u672a\u5e94\u7b54\u7684\u6d88\u606f)\n                boolean requeue = false;                                    // \u662f\u5426\u91cd\u65b0\u5165\u961f\n\n                // 3. \u624b\u52a8\u5e94\u7b54(\u80af\u5b9a\u786e\u8ba4)(\u544a\u77e5 RabbitMQ \u8be5\u6d88\u606f\u88ab\u6210\u529f\u5904\u7406\u4e86)\n                channel.basicAck(deliveryTag, multiple);\n\n                // // 3. \u624b\u52a8\u5e94\u7b54(\u5426\u5b9a\u786e\u8ba4)(\u4e0d\u5904\u7406\u8be5\u6d88\u606f\u76f4\u63a5\u62d2\u7edd)\n                // channel.basicNack(deliveryTag, multiple, requeue);\n            };\n            channel.basicConsume(QUEUE, false, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_11","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#323","title":"3.2.3 \u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_12","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = \"x.tutorial_three.fanout\";\n    static final String QUEUE1 = MyConsumer1.QUEUE;\n    static final String QUEUE2 = MyConsumer2.QUEUE;\n    static final String ROUTING_KEY = \"\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            // 1. \u58f0\u660e\u4ea4\u6362\u673a\n            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.FANOUT, false);\n            // 2. \u58f0\u660e\u961f\u5217\n            channel.queueDeclare(QUEUE1, false, false, false, null);\n            channel.queueDeclare(QUEUE2, false, false, false, null);\n            // 3. \u7ed1\u5b9a\u4ea4\u6362\u673a\u548c\u961f\u5217\n            channel.queueBind(QUEUE1, EXCHANGE, ROUTING_KEY);\n            channel.queueBind(QUEUE2, EXCHANGE, ROUTING_KEY);\n            // 4. \u53d1\u9001\u6d88\u606f\n            String body = \"This is a broadcast message\";\n            channel.basicPublish(EXCHANGE, ROUTING_KEY, null, body.getBytes());\n            System.out.printf(\"Sent message='%s'\\n\", body);\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_13","title":"\u6d88\u8d39\u8005\u4e00","text":"<pre><code>/**\n * \u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f-\u6d88\u8d39\u8005-1\n */\npublic class MyConsumer1 {\n    static final String QUEUE = \"q.tutorial_three.queue1\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyConsumer1.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_14","title":"\u6d88\u8d39\u8005\u4e8c","text":"<pre><code>/**\n * \u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f-\u6d88\u8d39\u8005-2\n */\npublic class MyConsumer2 {\n    static final String QUEUE = \"q.tutorial_three.queue2\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyConsumer2.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_15","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#324","title":"3.2.4 \u8def\u7531\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_16","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u8def\u7531\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = \"x.tutorial_four.log.direct\";\n    static final String QUEUE_LOG = LogConsumer.QUEUE;\n    static final String QUEUE_ERROR_LOG = ErrorLogConsumer.QUEUE;\n    static final String ROUTING_KEY_INFO = \"info\";\n    static final String ROUTING_KEY_WARN = \"warn\";\n    static final String ROUTING_KEY_ERROR = \"error\";\n\n    static final List&lt;String&gt; MESSAGE_LIST = List.of(\n        \"[2022-01-01 00:00:00.100][main      ][info ] This is an info log.\",\n        \"[2022-01-01 00:00:00.200][main      ][warn ] This is a warn log.\",\n        \"[2022-01-01 00:00:00.300][main      ][error] This is a error log.\"\n    );\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            // 1. \u58f0\u660e\u4ea4\u6362\u673a\n            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.DIRECT, false);\n            // 2. \u58f0\u660e\u961f\u5217\n            channel.queueDeclare(QUEUE_LOG, false, false, false, null);\n            channel.queueDeclare(QUEUE_ERROR_LOG, false, false, false, null);\n            // 3. \u7ed1\u5b9a\u4ea4\u6362\u673a\u548c\u961f\u5217\n            channel.queueBind(QUEUE_LOG, EXCHANGE, ROUTING_KEY_INFO);\n            channel.queueBind(QUEUE_LOG, EXCHANGE, ROUTING_KEY_WARN);\n            channel.queueBind(QUEUE_LOG, EXCHANGE, ROUTING_KEY_ERROR);\n            channel.queueBind(QUEUE_ERROR_LOG, EXCHANGE, ROUTING_KEY_ERROR);\n            // 4. \u53d1\u9001\u6d88\u606f\n            for (String body : MESSAGE_LIST) {\n                String routingKey = body.substring(38, 43).trim();\n                channel.basicPublish(EXCHANGE, routingKey, null, body.getBytes());\n                System.out.printf(\"Sent routingKey='%s' message='%s'\\n\", routingKey, body);\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_17","title":"\u6536\u96c6\u6240\u6709\u65e5\u5fd7\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u8def\u7531\u6a21\u5f0f-\u6536\u96c6\u6240\u6709\u65e5\u5fd7\u6d88\u8d39\u8005\n */\npublic class LogConsumer {\n    static final String QUEUE = \"q.tutorial_four.log\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(LogConsumer.QUEUE, false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_18","title":"\u6536\u96c6\u9519\u8bef\u65e5\u5fd7\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u8def\u7531\u6a21\u5f0f-\u6536\u96c6\u9519\u8bef\u65e5\u5fd7\u6d88\u8d39\u8005\n */\npublic class ErrorLogConsumer {\n    static final String QUEUE = \"q.tutorial_four.error\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(ErrorLogConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                // 1. \u6536\u5230\u6d88\u606f\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n                // 2. \u5904\u7406\u6d88\u606f\uff08\u544a\u8b66\uff09\n                try { TimeUnit.MILLISECONDS.sleep(500L); } catch (InterruptedException ignored) { }\n                // 3. \u624b\u52a8\u5e94\u7b54\n                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n            };\n            channel.basicConsume(QUEUE, false, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_19","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#325","title":"3.2.5 \u4e3b\u9898\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_20","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u4e3b\u9898\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = \"x.tutorial_five.topic\";\n    static final String QUEUE_ORDER_LOG = OrderLogConsumer.QUEUE;\n    static final String QUEUE_STOCK_LOG = StockLogConsumer.QUEUE;\n    // \u4e3b\u9898(\u4e3b\u9898\u662f\u7531\u591a\u4e2a\u5355\u8bcd\u4ee5 `.` \u9694\u5f00\u7684\u8def\u7531\u952e\uff0c`*` \u8868\u793a\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u5355\u8bcd\uff0c`#` \u8868\u793a\u6709\u4efb\u610f\u4e2a\u5355\u8bcd)\n    static final String TOPIC_ORDER = \"order.#.log.*\";\n    static final String TOPIC_STOCK = \"stock.#.log.*\";\n\n    static final List&lt;String&gt; MESSAGE_LIST = List.of(\n        \"-rw-r--r-- 1 root root 1M 2022-01-01 00:00 order.info.log.2022-01-01\",  // \u5339\u914d\u8ba2\u5355\u4e3b\u9898\n        \"-rw-r--r-- 1 root root 1K 2022-01-01 00:00 order.warn.log.2022-01-01\",  // \u5339\u914d\u8ba2\u5355\u4e3b\u9898\n        \"-rw-r--r-- 1 root root 10 2022-01-01 00:00 order.error.log.2022-01-01\", // \u5339\u914d\u8ba2\u5355\u4e3b\u9898\n        \"-rw-r--r-- 1 root root  0 2022-01-01 00:00 stock.log\",\n        \"-rw-r--r-- 1 root root 1M 2022-01-01 00:00 stock.log.2022-01-01\"        // \u5339\u914d\u5e93\u5b58\u4e3b\u9898\n    );\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.TOPIC, false);\n            channel.queueDeclare(QUEUE_ORDER_LOG, false, false, false, null);\n            channel.queueDeclare(QUEUE_STOCK_LOG, false, false, false, null);\n            channel.queueBind(QUEUE_ORDER_LOG, EXCHANGE, TOPIC_ORDER);\n            channel.queueBind(QUEUE_STOCK_LOG, EXCHANGE, TOPIC_STOCK);\n            for (String body : MESSAGE_LIST) {\n                // ls -AFlh --time-style=long-iso | awk '{ print $8 }'\n                String[] split = body.split(\" \");\n                if (split.length == 8) {\n                    String routingKey = split[7];\n                    channel.basicPublish(EXCHANGE, routingKey, null, body.getBytes());\n                    System.out.printf(\"sent routingKey='%s' message='%s'\\n\", routingKey, body);\n                }\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_21","title":"\u6536\u96c6\u8ba2\u5355\u670d\u52a1\u65e5\u5fd7\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u4e3b\u9898\u6a21\u5f0f-\u6536\u96c6\u8ba2\u5355\u670d\u52a1\u65e5\u5fd7\u6d88\u8d39\u8005\n */\npublic class OrderLogConsumer {\n    static final String QUEUE = \"q.tutorial_five.order.log\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(OrderLogConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_22","title":"\u6536\u96c6\u5e93\u5b58\u670d\u52a1\u65e5\u5fd7\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u4e3b\u9898\u6a21\u5f0f-\u6536\u96c6\u5e93\u5b58\u670d\u52a1\u65e5\u5fd7\u6d88\u8d39\u8005\n */\npublic class StockLogConsumer {\n    static final String QUEUE = \"q.tutorial_five.stock.log\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(StockLogConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(QUEUE, false, false, false, null);\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                System.out.printf(\"Received message='%s'\\n\", new String(delivery.getBody()));\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_23","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#326","title":"3.2.6 \u8fdc\u7a0b\u8c03\u7528\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_24","title":"\u670d\u52a1\u7aef","text":"<pre><code>/**\n * \u8fdc\u7a0b\u8c03\u7528\u6a21\u5f0f-\u670d\u52a1\u7aef\n */\npublic class MyServer {\n    static final String REQUEST_EXCHANGE = \"\";                          // \u8bf7\u6c42\u4ea4\u6362\u673a\n    static final String REQUEST_QUEUE = \"q.tutorial_six.request\";       // \u8bf7\u6c42\u961f\u5217\n    static final String RESPONSE_EXCHANGE = MyClient.RESPONSE_EXCHANGE; // \u54cd\u5e94\u4ea4\u6362\u673a\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyServer.class.getSimpleName(), false, channel -&gt; {\n            channel.queueDeclare(REQUEST_QUEUE, false, false, false, null);\n\n            channel.basicQos(1); // \u9650\u5236\u672a\u54cd\u5e94\u8bf7\u6c42\u7f13\u51b2\u533a\u5927\u5c0f(\u4e00\u6b21\u53ea\u5904\u7406\u4e00\u6761\u8bf7\u6c42)\n\n            DeliverCallback handler = (consumerTag, delivery) -&gt; {\n                // 1. \u8bf7\u6c42\u5934\n                AMQP.BasicProperties requestHeaders = delivery.getProperties();\n                String requestId = requestHeaders.getCorrelationId();\n                String responseRoutingKey = requestHeaders.getReplyTo();\n\n                // 2. \u8bf7\u6c42\u4f53\n                String requestBody = new String(delivery.getBody());\n                System.out.printf(\"Received requestId='%s' requestBody='%s' responseRoutingKey='%s'\\n\", requestId, requestBody, responseRoutingKey);\n\n                // 3. \u54cd\u5e94\u5934\n                AMQP.BasicProperties responseHeaders = new AMQP.BasicProperties\n                    .Builder()\n                    .correlationId(requestId)\n                    .build();\n\n                // 4. \u54cd\u5e94\u4f53\n                String responseBody = Integer.toString(f(Integer.parseInt(requestBody)));\n\n                channel.basicPublish(RESPONSE_EXCHANGE, responseRoutingKey, responseHeaders, responseBody.getBytes());\n                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n                System.out.printf(\"Responded requestId='%s' requestBody='%s' responseRoutingKey='%s' responseBody='%s'\\n\", requestId, requestBody, responseRoutingKey, responseBody);\n            };\n            channel.basicConsume(REQUEST_QUEUE, false, handler, consumerTag -&gt; { });\n        });\n    }\n\n    private static int f(int n) {\n        if (n == 0) {\n            return 0;\n        } else if (n == 1) {\n            return 1;\n        } else {\n            return f(n - 1) + f(n - 2);\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_25","title":"\u5ba2\u6237\u7aef","text":"<pre><code>/**\n * \u8fdc\u7a0b\u8c03\u7528\u6a21\u5f0f-\u5ba2\u6237\u7aef\n */\npublic class MyClient {\n    static final String REQUEST_EXCHANGE = MyServer.REQUEST_EXCHANGE; // \u8bf7\u6c42\u4ea4\u6362\u673a\n    static final String REQUEST_ROUTING_KEY = MyServer.REQUEST_QUEUE; // \u8bf7\u6c42\u8def\u7531\u952e\n    static final String RESPONSE_EXCHANGE = \"\";                       // \u54cd\u5e94\u4ea4\u6362\u673a\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyClient.class.getSimpleName(), true, channel -&gt; {\n            for (int i = 0; i &lt; 10; i++) {\n                int f = f(channel, i);\n                System.out.printf(\"f(%d) = %d\\n\", i, f);\n            }\n        });\n    }\n\n    private static int f(Channel channel, int n) throws Exception {\n        // 1. \u8bf7\u6c42\u5934\n        String requestId = UUID.randomUUID().toString();          // \u8bf7\u6c42 ID(\u670d\u52a1\u7aef\u54cd\u5e94\u65f6\u643a\u5e26\u8bf7\u6c42 ID\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u54cd\u5e94\u540e\u6839\u636e\u5224\u65ad\u8bf7\u6c42 ID \u662f\u5426\u4e00\u81f4\uff0c\u4e0d\u4e00\u81f4\u53ef\u8fdb\u884c\u4e22\u5f03)\n        String responseQueue = channel.queueDeclare().getQueue(); // \u54cd\u5e94\u961f\u5217(\u6bcf\u4e2a\u8bf7\u6c42\u5355\u72ec\u521b\u5efa\u4e34\u65f6\u961f\u5217\uff0c\u670d\u52a1\u7aef\u5c06\u54cd\u5e94\u6d88\u606f\u53d1\u9001\u81f3\u8be5\u961f\u5217\u4e2d)\n        AMQP.BasicProperties requestHeaders = new AMQP.BasicProperties\n            .Builder()\n            .correlationId(requestId)\n            .replyTo(responseQueue)\n            .build();\n\n        // 2. \u8bf7\u6c42\u4f53\n        String requestBody = Integer.toString(n);\n\n        channel.basicPublish(REQUEST_EXCHANGE, REQUEST_ROUTING_KEY, requestHeaders, requestBody.getBytes());\n        System.out.printf(\"Requested requestId='%s' requestBody='%s' responseQueue='%s'\\n\", requestId, requestBody, responseQueue);\n\n        BlockingQueue&lt;String&gt; response = new ArrayBlockingQueue&lt;&gt;(1); // \u54cd\u5e94\u7ed3\u679c\u963b\u585e\u961f\u5217(\u4e00\u6b21\u53ea\u53d1\u8d77\u4e00\u6761\u8bf7\u6c42\u5e76\u7b49\u5f85\u8bf7\u6c42\u54cd\u5e94)\n\n        DeliverCallback responseCallback = (consumerTag, delivery) -&gt; {\n            // 3. \u54cd\u5e94\u5934\n            AMQP.BasicProperties responseHeaders = delivery.getProperties();\n            if (Objects.equals(responseHeaders.getCorrelationId(), requestId)) {\n                // 4. \u54cd\u5e94\u4f53\n                String responseBody = new String(delivery.getBody());\n                System.out.printf(\"Received requestId='%s' requestBody='%s' responseQueue='%s' responseBody='%s' \\n\", requestId, requestBody, responseQueue, responseBody);\n                response.offer(responseBody);\n            }\n        };\n\n        String cTag = channel.basicConsume(responseQueue, true, responseCallback, consumerTag -&gt; { });\n        String responseBody = response.take(); // \u7b49\u5f85\u54cd\u5e94\u7ed3\u679c\n        channel.basicCancel(cTag);             // \u53d6\u6d88\u5bf9\u54cd\u5e94\u961f\u5217\u7684\u8ba2\u9605\n\n        return Integer.parseInt(responseBody);\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_26","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#327","title":"3.2.7 \u53d1\u5e03\u786e\u8ba4\u6a21\u5f0f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_27","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u53d1\u5e03\u786e\u8ba4\u6a21\u5f0f-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = \"\";\n\n    static final List&lt;String&gt; MESSAGE_LIST = new ArrayList&lt;&gt;();\n\n    static {\n        for (int i = 1; i &lt;= 5000; i++) {\n            MESSAGE_LIST.add(\"msg\" + i);\n        }\n    }\n\n    public static void main(String[] args) {\n        noConfirm();\n        confirmIndividuallySync();\n        confirmBatchSync();\n        confirmAsync();\n    }\n\n    /**\n     * \u65e0\u786e\u8ba4\n     */\n    private static void noConfirm() {\n        String mode = \"\u65e0\u786e\u8ba4\";\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            String queue = channel.queueDeclare().getQueue(); // \u521b\u5efa\u4e34\u65f6\u961f\u5217(\u4e3b\u52a8\u58f0\u660e\u4e00\u4e2a\u7531\u670d\u52a1\u7aef\u547d\u540d\u7684\u3001\u6392\u5b83\u7684\u3001\u81ea\u52a8\u5220\u9664\u7684\u3001\u975e\u6301\u4e45\u5316\u7684\u961f\u5217)\n            long start = System.currentTimeMillis();\n            for (String body : MESSAGE_LIST) {\n                channel.basicPublish(EXCHANGE, queue, null, body.getBytes());\n            }\n            long end = System.currentTimeMillis();\n            System.out.printf(\"[%-20s] Sent %d messages for %d ms\\n\", mode, MESSAGE_LIST.size(), end - start);\n        });\n    }\n\n    /**\n     * \u5355\u72ec\u540c\u6b65\u786e\u8ba4\n     */\n    private static void confirmIndividuallySync() {\n        String mode = \"\u5355\u72ec\u540c\u6b65\u786e\u8ba4\";\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            String queue = channel.queueDeclare().getQueue();\n            channel.confirmSelect(); // \u542f\u7528\u53d1\u5e03\u786e\u8ba4\n            long start = System.currentTimeMillis();\n            for (String body : MESSAGE_LIST) {\n                channel.basicPublish(EXCHANGE, queue, null, body.getBytes());\n                channel.waitForConfirmsOrDie(1000L); // \u7b49\u5f85\u786e\u8ba4\n            }\n            long end = System.currentTimeMillis();\n            System.out.printf(\"[%-20s] Sent %d messages for %d ms\\n\", mode, MESSAGE_LIST.size(), end - start);\n        });\n    }\n\n    /**\n     * \u6279\u91cf\u540c\u6b65\u786e\u8ba4\n     */\n    private static void confirmBatchSync() {\n        String mode = \"\u6279\u91cf\u540c\u6b65\u786e\u8ba4\";\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            String queue = channel.queueDeclare().getQueue();\n            channel.confirmSelect();           // \u542f\u7528\u53d1\u5e03\u786e\u8ba4\n            long batchSize = 100L;             // \u6279\u6b21\u5927\u5c0f\n            long outstandingMessageCount = 0L; // \u672a\u786e\u8ba4\u7684\u6d88\u606f\u6570\n            long start = System.currentTimeMillis();\n            for (String body : MESSAGE_LIST) {\n                channel.basicPublish(EXCHANGE, queue, null, body.getBytes());\n                outstandingMessageCount++;\n                if (outstandingMessageCount == batchSize) { // \u6279\u91cf\u7b49\u5f85\u786e\u8ba4(\u5f53\u672a\u786e\u8ba4\u7684\u6d88\u606f\u6570\u5230\u8fbe\u6279\u6b21\u5927\u5c0f\u65f6\u518d\u7b49\u5f85\u786e\u8ba4)\n                    channel.waitForConfirmsOrDie(1000L);\n                    outstandingMessageCount = 0L;\n                }\n            }\n            if (outstandingMessageCount &gt; 0) {              // \u6279\u91cf\u7b49\u5f85\u786e\u8ba4(\u6d88\u606f\u5168\u90e8\u53d1\u9001\u540e\u53ef\u80fd\u4ecd\u6709\u672a\u786e\u8ba4\u7684\u6d88\u606f)\n                channel.waitForConfirmsOrDie(1000L);\n                outstandingMessageCount = 0L;\n            }\n            long end = System.currentTimeMillis();\n            System.out.printf(\"[%-20s] Sent %d messages for %d ms\\n\", mode, MESSAGE_LIST.size(), end - start);\n        });\n    }\n\n\n    /**\n     * \u5f02\u6b65\u786e\u8ba4\n     */\n    private static void confirmAsync() {\n        String mode = \"\u5f02\u6b65\u786e\u8ba4\";\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            String queue = channel.queueDeclare().getQueue();\n            channel.confirmSelect(); // \u542f\u7528\u53d1\u5e03\u786e\u8ba4\n            channel.addConfirmListener(new ConfirmListener() { // \u786e\u8ba4\u56de\u8c03\n                @Override\n                public void handleAck(long deliveryTag, boolean multiple) throws IOException {\n\n                }\n                @Override\n                public void handleNack(long deliveryTag, boolean multiple) throws IOException {\n                    System.out.println(\"Publishing failed\");\n                }\n            });\n            long start = System.currentTimeMillis();\n            for (String body : MESSAGE_LIST) {\n                channel.basicPublish(EXCHANGE, queue, null, body.getBytes());\n            }\n            long end = System.currentTimeMillis();\n            System.out.printf(\"[%-20s] Sent %d messages for %d ms\\n\", mode, MESSAGE_LIST.size(), end - start);\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_28","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#33","title":"3.3 \u603b\u7ed3","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_29","title":"\u5b98\u65b9\u793a\u4f8b\u603b\u7ed3","text":"<p>\u5728\u5b98\u65b9\u7684\u4e03\u4e2a\u793a\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u6982\u62ec\u5982\u4e0b\uff1a</p> <ol> <li>\u7b80\u5355\u6a21\u5f0f\uff1a\u9ed8\u8ba4 <code>direct</code> \u7c7b\u578b\u4ea4\u6362\u673a\uff0c\u961f\u5217\u540d\u5145\u5f53\u8def\u7531\u952e\u3002</li> <li>\u5de5\u4f5c\u961f\u5217\u6a21\u5f0f\uff1a\u540c\u4e00\u961f\u5217\u4e0d\u540c\u6d88\u8d39\u8005\u7684\u6d88\u606f\u5206\u53d1\u673a\u5236\u3002</li> <li>\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff1a\u540c\u4e00\u4e2a\u4ea4\u6362\u673a\u7ed1\u5b9a\u591a\u4e2a\u961f\u5217\uff0c\u5b9e\u73b0\u5e7f\u64ad\u6d88\u606f\u3002</li> <li>\u8def\u7531\u6a21\u5f0f\uff1a\u4ea4\u6362\u673a\u6839\u636e\u5206\u53d1\u89c4\u5219\u5c06\u6d88\u606f\u5206\u53d1\u5230\u4e0d\u540c\u7684\u961f\u5217\u3002</li> <li>\u4e3b\u9898\u6a21\u5f0f\uff1a\u4ea4\u6362\u673a\u53ef\u4ee5\u6839\u636e\u6a21\u7cca\u7684\u5206\u53d1\u89c4\u5219\u5c06\u6d88\u606f\u5206\u53d1\u5230\u4e0d\u540c\u7684\u961f\u5217\u3002</li> <li>\u8fdc\u7a0b\u8c03\u7528\u6a21\u5f0f\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u5230\u8bf7\u6c42\u961f\u5217\uff0c\u5e76\u8bbe\u7f6e\u4e34\u65f6\u7684\u54cd\u5e94\u961f\u5217\uff0c\u670d\u52a1\u7aef\u8ba2\u9605\u8bf7\u6c42\u961f\u5217\uff0c\u5e76\u53d1\u9001\u54cd\u5e94\u5230\u4e34\u65f6\u7684\u54cd\u5e94\u961f\u5217\u3002</li> <li>\u53d1\u5e03\u786e\u8ba4\u6a21\u5f0f\uff1a\u6d88\u606f\u53ef\u9760\u53d1\u9001\u3002</li> </ol>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_30","title":"\u4ea4\u6362\u673a\u7c7b\u578b\u603b\u7ed3","text":"<ul> <li><code>fanout</code> \u76f4\u8fde\u4ea4\u6362\u673a\uff1a\u4ea4\u6362\u673a\u5ffd\u7565\u8def\u7531\u952e\uff0c\u76f4\u63a5\u5c06\u6d88\u606f\u5206\u53d1\u5230\u961f\u5217\u4e2d\u3002</li> <li><code>direct</code> \u8def\u7531\u4ea4\u6362\u673a\uff1a\u4ea4\u6362\u673a\u901a\u8fc7\u8def\u7531\u952e\uff0c\u5c06\u6d88\u606f\u5206\u53d1\u5230\u4e0d\u540c\u7684\u961f\u5217\u4e2d\u3002\uff08\u9ed8\u8ba4\u4ea4\u4e92\u673a\u4f7f\u7528\u961f\u5217\u540d\u4f5c\u4e3a\u8def\u7531\u952e\uff09</li> <li><code>topic</code> \u4e3b\u9898\u4ea4\u6362\u673a\uff1a\u4ea4\u6362\u673a\u53ef\u4ee5\u548c\u961f\u5217\u7ed1\u5b9a\u6a21\u7cca\u7684\u5206\u53d1\u89c4\u5219\uff0c\u4ee5\u5339\u914d\u4e0d\u540c\u7684\u8def\u7531\u952e\u3002</li> <li><code>headers</code> \u5934\u90e8\u4ea4\u6362\u673a\uff1a\u4e0d\u4f9d\u8d56\u4e8e\u8def\u7531\u952e\uff0c\u800c\u662f\u7ed1\u5b9a\u65f6\u6307\u5b9a\u4e00\u7ec4\u952e\u503c\u5bf9\uff0c\u5e76\u63d0\u53d6\u6d88\u606f\u7684\u952e\u503c\u5bf9\u662f\u5426\u5b8c\u5168\u5339\u914d\u7ed1\u5b9a\u7684\u952e\u503c\u5bf9\uff0c\u5982\u679c\u5b8c\u5168\u5339\u914d\u5219\u4f1a\u628a\u6d88\u606f\u8def\u7531\u5230\u8be5\u961f\u5217\u4e2d\u3002</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#spring-amqp","title":"\u56db\u3001Spring AMQP","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#41","title":"4.1 \u4ecb\u7ecd","text":"<p>\u5728 Spring \u751f\u6001\u4e2d\u63d0\u4f9b\u4e86 Spring AMQP \u9879\u76ee\uff0c\u8ba9\u6211\u4eec\u66f4\u7b80\u4fbf\u7684\u4f7f\u7528 AMQP\uff0c\u5176\u5b98\u7f51\u4ecb\u7ecd\u5982\u4e0b\uff1a</p> <ul> <li>\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a \"\u6a21\u677f\" \u4f5c\u4e3a\u53d1\u9001\u6d88\u606f\u7684\u9ad8\u7ea7\u62bd\u8c61\u3002</li> <li>\u5b83\u8fd8\u901a\u8fc7 \"\u76d1\u542c\u5668\u5bb9\u5668\" \u4e3a\u6d88\u606f\u9a71\u52a8\u7684 POJO \u63d0\u4f9b\u652f\u6301\u3002</li> <li>\u8fd9\u4e9b\u5e93\u4fc3\u8fdb AMQP \u8d44\u6e90\u7684\u7ba1\u7406\uff0c\u540c\u65f6\u4fc3\u8fdb\u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165\u548c\u7533\u660e\u5f0f\u914d\u7f6e\u3002</li> <li>\u5728\u6240\u6709\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u5c06\u770b\u5230\u4e0e Spring \u6846\u67b6\u4e2d\u7684 JMS \u652f\u6301\u7684\u76f8\u4f3c\u4e4b\u5904\u3002</li> </ul> <p>\u8be5\u9879\u76ee\u5305\u62ec\u4e24\u4e2a\u90e8\u5206\uff1a</p> <ul> <li><code>spring-amqp</code> \u662f AMQP \u7684\u57fa\u7840\u62bd\u8c61</li> <li><code>spring-rabbit</code> \u662f\u57fa\u4e8e RabbitMQ \u5bf9 AMQP \u7684\u5177\u4f53\u5b9e\u73b0</li> </ul> <p>\u529f\u80fd\u7279\u6027\uff1a</p> <ul> <li>\u76d1\u542c\u5668\u5bb9\u5668\uff1a\u5f02\u6b65\u5904\u7406\u63a5\u6536\u5230\u7684\u6d88\u606f</li> <li><code>RabbitTemplate</code>\uff1a\u53d1\u9001\u548c\u63a5\u6536\u6d88\u606f</li> <li><code>RabbitAdmin</code>\uff1a\u81ea\u52a8\u521b\u5efa\u961f\u5217\u3001\u4ea4\u6362\u673a\u3001\u7ed1\u5b9a\u5173\u7cfb</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#42","title":"4.2 \u57fa\u672c\u4f7f\u7528","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_31","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_32","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>spring.rabbitmq.addresses=192.192.192.6:5672\nspring.rabbitmq.username=admin\nspring.rabbitmq.password=admin\nspring.rabbitmq.virtual-host=/\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_33","title":"\u914d\u7f6e\u7c7b","text":"<pre><code>@Configuration\npublic class RabbitMQConfig {\n    public static final String EXCHANGE = \"x.spring_boot.direct\";\n    public static final String QUEUE = \"q.spring_boot\";\n    public static final String ROUTING_KEY = \"\";\n\n    @Bean\n    public Queue springBootQueue() {\n        // boolean durable = false;\n        // boolean exclusive = false;\n        // boolean autoDelete = false;\n        // Map&lt;String, Object&gt; arguments = null;\n        // Queue queue = new Queue(QUEUE, durable, exclusive, autoDelete, arguments);\n        return QueueBuilder\n            .nonDurable(QUEUE)\n            .build();\n    }\n\n    @Bean\n    public Exchange springBootExchange() {\n        // boolean durable = false;\n        // boolean autoDelete = false;\n        // Map&lt;String, Object&gt; arguments = null;\n        // DirectExchange exchange = new DirectExchange(EXCHANGE, durable, autoDelete, arguments);\n        return ExchangeBuilder\n            .directExchange(EXCHANGE)\n            .build();\n    }\n\n    @Bean\n    public Binding binding1(@Qualifier(\"springBootQueue\") Queue queue, @Qualifier(\"springBootExchange\") Exchange exchange) {\n        // Map&lt;String, Object&gt; arguments = null;\n        // Binding binding = new Binding(QUEUE, Binding.DestinationType.QUEUE, EXCHANGE, ROUTING_KEY, arguments);\n        return BindingBuilder\n            .bind(queue)\n            .to(exchange)\n            .with(ROUTING_KEY)\n            .noargs();\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_34","title":"\u751f\u4ea7\u8005","text":"<pre><code>@Component\npublic class MyProducer {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendRaw(String raw) {\n        MessageProperties properties = MessagePropertiesBuilder\n            .newInstance()\n            .setContentType(MessageProperties.CONTENT_TYPE_TEXT_PLAIN)\n            .build();\n        Message message = MessageBuilder\n            .withBody(raw.getBytes())\n            .andProperties(properties)\n            .build();\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE, RabbitMQConfig.ROUTING_KEY, message);\n    }\n}\n</code></pre> <pre><code>@SpringBootTest(classes = { App.class })\nclass AppTest {\n    @Autowired\n    MyProducer producer;\n\n    @Test\n    void test1() {\n        String raw = \"{\\\"data\\\": \\\"This is a raw message\\\"}\";\n        producer.sendRaw(raw);\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_35","title":"\u6d88\u8d39\u8005","text":"<pre><code>@Component\npublic class MyConsumer {\n    @RabbitListener(queues = { RabbitMQConfig.QUEUE })\n    public void onMessage(Message message, Channel channel) {\n        String raw = new String(message.getBody());\n        System.out.printf(\"Received message='%s'\\n\", raw);\n    }\n}\n</code></pre> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ul> <li>https://docs.spring.io/spring-amqp/docs/current/reference/html/#async-consumer</li> </ul> <p>\u53c2\u8003\u7c7b\uff1a</p> <ul> <li> <p><code>org.springframework.amqp.core.MessageListener</code></p> <pre><code>public interface MessageListener {\n    void onMessage(Message message);\n}\n</code></pre> </li> <li> <p><code>org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener</code></p> <pre><code>public interface ChannelAwareMessageListener {\n    void onMessage(Message message, Channel channel) throws Exception;\n}\n</code></pre> </li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#43","title":"4.3 \u81ea\u5b9a\u4e49\u6d88\u606f\u7c7b","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_36","title":"\u6d88\u606f\u7c7b","text":"<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class MyMessage implements Serializable {\n    private String data;\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_37","title":"\u751f\u4ea7\u8005","text":"<pre><code>@Component\npublic class MyProducer {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendObject(MyMessage object) {\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE, RabbitMQConfig.ROUTING_KEY, object);\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_38","title":"\u6d88\u8d39\u8005","text":"<pre><code>@Component\npublic class MyConsumer {\n    @RabbitListener(queues = { RabbitMQConfig.QUEUE })\n    public void handMessage(MyMessage object, Channel channel, Message message) {\n        System.out.printf(\"Received object='%s' raw='%s'\\n\", object, new String(message.getBody()));\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#json","title":"JSON \u5e8f\u5217\u5316","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>RabbitTempate</code> \u6d88\u606f\u8f6c\u6362\u5668\u4e3a <code>SimpleMessageConverter</code>\uff0c\u4f7f\u7528 Java \u7684\u5e8f\u5217\u5316\u3002Spring Boot \u4e5f\u63d0\u4f9b\u4e86 JSON \u5e8f\u5217\u5316\u7684\u6d88\u606f\u8f6c\u6362\u5668\uff1a</p> <pre><code>@Configuration\npublic class RabbitMQConfig {\n    // ...\n\n    @Bean\n    public MessageConverter jsonMessageConverter() {\n        return new Jackson2JsonMessageConverter();\n    }\n}\n</code></pre> <p></p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#44","title":"4.4 \u6279\u91cf\u6d88\u606f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#441","title":"4.4.1 \u6279\u91cf\u53d1\u9001","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_39","title":"\u4ecb\u7ecd","text":"<p>Spring AMQP \u63d0\u4f9b\u4e00\u4e2a <code>MessageBatch</code> \u6d88\u606f\u6536\u96c6\u5668\uff0c\u5c06\u53d1\u9001\u7ed9\u76f8\u540c Exchange \u548c Routing Key \u7684\u6d88\u606f\uff0c\"\u6084\u6084\" \u6536\u96c6\u5728\u4e00\u8d77\uff0c\u5f53\u6ee1\u8db3\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u4e00\u6b21\u6027\u6279\u91cf\u53d1\u9001\u63d0\u4ea4\u7ed9 RabbitMQ Broker\u3002</p> <p>Spring AMQP \u901a\u8fc7 <code>BatchingRabbitTemplate</code> \u63d0\u4f9b\u6279\u91cf\u53d1\u9001\u7684\u529f\u80fd\u3002\u5982\u4e0b\u662f\u4e09\u4e2a\u6761\u4ef6\uff0c\u6ee1\u8db3\u4efb\u4e00\u5373\u4f1a\u6279\u91cf\u53d1\u9001\uff1a</p> <ul> <li>\u6570\u91cf\uff08<code>batchSize</code>\uff09\uff1a\u8d85\u8fc7\u6536\u96c6\u7684\u6d88\u606f\u6700\u5927\u6761\u6570\u3002</li> <li>\u7a7a\u95f4\uff08<code>bufferLimit</code>\uff09\uff1a\u8d85\u8fc7\u6536\u96c6\u7684\u6d88\u606f\u5360\u7528\u7684\u6700\u5927\u5185\u5b58\u3002</li> <li>\u65f6\u95f4\uff08<code>timeout</code>\uff09\uff1a\u8d85\u8fc7\u6536\u96c6\u7684\u5b9e\u9645\u7684\u6700\u5927\u7b49\u5f85\u65f6\u957f\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u3002\u4e0d\u8fc7\u8981\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u8d85\u65f6\u5f00\u59cb\u8ba1\u65f6\u7684\u5b9e\u9645\uff0c\u662f\u4ee5\u6700\u540e\u4e00\u6b21\u53d1\u9001\u65f6\u95f4\u4e3a\u8d77\u70b9\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u8c03\u7528\u4e00\u6b21\u53d1\u9001\u6d88\u606f\uff0c\u90fd\u4ee5\u5f53\u524d\u65f6\u523b\u5f00\u59cb\u8ba1\u65f6\uff0c\u91cd\u65b0\u8fbe\u5230 <code>timeout</code> \u624d\u7b97\u8d85\u65f6\u3002</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_40","title":"\u914d\u7f6e\u7c7b","text":"<pre><code>@Configuration\npublic class RabbitMQConfig {\n    // ...\n\n    @Bean\n    public BatchingRabbitTemplate batchingRabbitTemplate(ConnectionFactory connectionFactory) {\n        // \u6279\u91cf\u7b56\u7565\n        int batchSize = 100;                // \u6279\u91cf\u6536\u96c6\u6700\u5927\u6d88\u606f\u6761\u6570\n        int bufferLimit = 16 * 1024 * 1024; // \u6279\u91cf\u53d1\u9001\u6700\u5927\u5185\u5b58\n        long timeout = 60 * 1000L;          // \u6279\u91cf\u6536\u96c6\u6700\u957f\u7b49\u5f85\u65f6\u95f4\n        SimpleBatchingStrategy batchingStrategy = new SimpleBatchingStrategy(batchSize, bufferLimit, timeout);\n        // \u8d85\u65f6\u53d1\u9001\u5b9a\u65f6\u5668\n        TaskScheduler taskScheduler = new ConcurrentTaskScheduler();\n\n        BatchingRabbitTemplate batchingRabbitTemplate = new BatchingRabbitTemplate(connectionFactory, batchingStrategy, taskScheduler);\n        batchingRabbitTemplate.setMessageConverter(jsonMessageConverter());\n        return batchingRabbitTemplate;\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_41","title":"\u751f\u4ea7\u8005","text":"<p>Spring AMQP \u4f1a\u9759\u9ed8\u6536\u96c6\u6d88\u606f\u6765\u5b9e\u73b0\u6279\u91cf\u53d1\u9001\uff0c\u6240\u4ee5 <code>BatchingRabbitTemplate</code> \u548c <code>RabbitTemplate</code> \u7684\u4f7f\u7528\u65b9\u6cd5\u8fd8\u662f\u4e00\u81f4\u7684\u3002</p> <pre><code>@Component\npublic class MyProducer {\n    @Autowired\n    private BatchingRabbitTemplate batchingRabbitTemplate;\n\n    public void batchingSendRaw(String raw) {\n        Message message = MessageBuilder.withBody(raw.getBytes()).build();\n        batchingRabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE, RabbitMQConfig.ROUTING_KEY, message);\n    }\n}\n</code></pre> <pre><code>@SpringBootTest(classes = { App.class })\nclass AppTest {\n    @Autowired\n    MyProducer producer;\n\n    @Test\n    void test3() {\n        for (int i = 1; i &lt; 101; i++) {\n            String raw = String.format(\"{\\\"data\\\": \\\"%s\\\"}\", \"This is the \" + i + \"-th message\");\n            producer.batchingSendRaw(raw);\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#442","title":"4.4.2 \u6279\u91cf\u6d88\u8d39","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_42","title":"\u4ecb\u7ecd","text":"<p>\u5728\u3010\u6279\u91cf\u53d1\u9001\u3011\u7ae0\u8282\u4e2d\u5df2\u7ecf\u5b9e\u73b0\u4e86\u6279\u91cf\u53d1\u9001\u6d88\u606f\u5230 RabbitMQ \u4e2d\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff0c\u8fd9\u6279\u6d88\u606f\u5728 RabbitMQ \u5230\u5e95\u5b58\u50a8\u4e00\u6761\u6d88\u606f\uff0c\u8fd8\u662f\u591a\u6761\u6d88\u606f\uff1f</p> <p>\u5b9e\u9645\u4e0a\uff0cRabbitMQ Broker \u5b58\u50a8\u7684\u662f\u4e00\u6761\u6d88\u606f\uff0c\u53c8\u6216\u8005\u8bf4\uff0cRabbitMQ \u5e76\u6ca1\u6709\u63d0\u4f9b\u6279\u91cf\u63a5\u6536\u6d88\u606f\u7684 API\uff0c\"\u6279\u91cf\u53d1\u9001\" \u662f Spring AMQP \u7684 <code>SimpleBatchingStrategy</code> \u6240\u5c01\u88c5\u63d0\u4f9b\u7684\uff1a</p> <ul> <li>\u5728 Producer \u6700\u7ec8\u6279\u91cf\u53d1\u9001\u6d88\u606f\u65f6\uff0c<code>SimpleBatchingStrategy</code> \u4f1a\u901a\u8fc7 <code>assembleMessage()</code> \u65b9\u6cd5\uff0c\u5c06\u6279\u91cf\u53d1\u9001\u7684\u591a\u6761\u6d88\u606f\u7ec4\u88c5\u6210\u4e00\u6761 \"\u6279\u91cf\" \u6d88\u606f\uff0c\u7136\u540e\u8fdb\u884c\u53d1\u9001\u3002</li> <li>\u5728 Consumer \u62c9\u53d6\u5230\u6d88\u606f\u65f6\uff0c \u4f1a\u6839\u636e <code>canDebatch()</code> \u65b9\u6cd5\uff0c\u5224\u65ad\u8be5\u6d88\u606f\u662f\u5426\u4e3a\u4e00\u6761 \"\u6279\u91cf\" \u6d88\u606f\uff0c\u5982\u679c\u662f\uff0c\u5219\u8c03\u7528 <code>deBatch()</code> \u65b9\u6cd5\uff0c\u5c06\u4e00\u6761 \"\u6279\u91cf\" \u6d88\u606f\u62c6\u5f00\uff0c\u53d8\u6210\u591a\u6761\u6d88\u606f\u3002</li> </ul> <p></p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_43","title":"\u914d\u7f6e\u7c7b","text":"<pre><code>@Configuration\npublic class RabbitMQConfig {\n    // ...\n    @Bean\n    public SimpleRabbitListenerContainerFactory batchingConsumeContainerFactory(SimpleRabbitListenerContainerFactoryConfigurer configurer, ConnectionFactory connectionFactory) {\n        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n        configurer.configure(factory, connectionFactory);\n\n        factory.setMessageConverter(jsonMessageConverter());\n        // \u542f\u7528\u6279\u91cf\u6d88\u8d39\n        factory.setBatchListener(true);\n        factory.setConsumerBatchEnabled(true);\n        // \u963b\u585e\u7b49\u5f85\u6700\u591a receiveTimeout \u6beb\u79d2 \u62c9\u53d6 batchSize \u6761\u6d88\u606f\u8fdb\u884c\u6d88\u8d39\n        factory.setBatchSize(100);\n        factory.setReceiveTimeout(60 * 1000L);\n        return factory;\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_44","title":"\u6d88\u8d39\u8005","text":"<pre><code>@Component\npublic class BatchingConsumer {\n    @RabbitListener(queues = { RabbitMQConfig.QUEUE }, containerFactory = \"batchingConsumeContainerFactory\")\n    public void onMessage(List&lt;Message&gt; messages, Channel channel) {\n        for (Message message : messages) {\n            System.out.printf(\"Received raw='%s'\\n\", new String(message.getBody()));\n        }\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#45","title":"4.5 \u6d88\u8d39\u91cd\u8bd5","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_45","title":"\u4ecb\u7ecd","text":"<p>\u5728\u6d88\u606f\u6d88\u8d39\u5931\u8d25\u7684\u65f6\u5019\uff0cSpring AMQP \u4f1a\u901a\u8fc7\u6d88\u8d39\u91cd\u8bd5\u673a\u5236\uff0c\u91cd\u65b0\u6295\u9012\u7ed9 Consumer\uff0c\u8ba9 Consumer \u6709\u673a\u4f1a\u91cd\u65b0\u6d88\u8d39\u6d88\u606f\uff0c\u5b9e\u73b0\u6d88\u8d39\u6210\u529f\u3002</p> <p>\u5f53\u7136\uff0cSpring AMQP \u5e76\u4e0d\u4f1a\u65e0\u9650\u91cd\u65b0\u6295\u9012\u6d88\u606f\u7ed9 Consumer \u91cd\u65b0\u6d88\u8d39\uff0c\u800c\u662f\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fbe\u5230 N \u6b21\u91cd\u8bd5\u6b21\u6570\u65f6\uff0cConsumer \u8fd8\u662f\u4f1a\u6d88\u8d39\u5931\u8d25\u65f6\uff0c\u8be5\u6d88\u606f\u5c31\u4f1a\u8fdb\u5165\u6b7b\u4fe1\u961f\u5217\u3002</p> <p>\u90a3\u4e48\u6d88\u8d39\u5931\u8d25\u8fbe\u5230\u6700\u5927\u6b21\u6570\u7684\u6d88\u606f\uff0c\u662f\u600e\u4e48\u8fdb\u5165\u5230\u6b7b\u4fe1\u961f\u5217\u7684\u5462\uff1fSpring AMQP \u5728\u6d88\u606f\u5230\u8fbe\u6700\u5927\u6d88\u8d39\u6b21\u6570\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u8be5\u6d88\u606f\u8fdb\u884c\u5426\u5b9a\uff08<code>basicNack()</code>\uff09\uff0c\u5e76\u4e14 <code>requeue=false</code>\uff0c\u8fd9\u6837\u540e\u7eed\u5c31\u53ef\u4ee5\u5229\u7528 RabbitMQ \u7684\u6b7b\u4fe1\u961f\u5217\u673a\u5236\uff0c\u5c06\u8be5\u6d88\u606f\u8f6c\u53d1\u5230\u6b7b\u4fe1\u961f\u5217\u3002</p> <p>\u5728 Spring AMQP \u7684\u6d88\u8d39\u91cd\u8bd5\u673a\u5236\u4e2d\uff0c\u5728\u6d88\u8d39\u5931\u8d25\u5230\u8fbe\u6700\u5927\u6b21\u6570\u540e\uff0c\u4f1a\u81ea\u52a8\u629b\u51fa <code>AmqpRejectAndDontRequeueException</code> \u5f02\u5e38\uff0c\u4ece\u800c\u7ed3\u675f\u8be5\u6d88\u606f\u7684\u6d88\u8d39\u91cd\u8bd5\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u6211\u4eec\u5728\u6d88\u8d39\u6d88\u606f\u7684\u903b\u8f91\u4e2d\uff0c\u4e3b\u52a8\u629b\u51fa\u8be5\u5f02\u5e38\uff0c\u4e5f\u80fd\u7ed3\u675f\u8be5\u6d88\u606f\u7684\u6d88\u606f\u91cd\u8bd5\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#spring-amqp_1","title":"Spring AMQP \u662f\u600e\u4e48\u63d0\u4f9b\u6d88\u8d39\u91cd\u8bd5\u529f\u80fd\u7684","text":"<ul> <li>Spring AMQP \u57fa\u4e8e <code>spring-retry</code> \u9879\u76ee\u63d0\u4f9b\u7684 <code>RetryTemplate</code> \u5b9e\u73b0\u91cd\u8bd5\u529f\u80fd\u3002\u800c Spring AMQP \u5728\u83b7\u53d6\u5230\u6d88\u606f\u65f6\uff0c\u4f1a\u4ea4\u7ed9 RetryTemplate \u6765\u8c03\u7528\u6d88\u8d39\u8005\u7684\u76d1\u542c\u5668\uff0c\u5b9e\u73b0\u8be5\u6d88\u606f\u7684\u6d88\u8d39\u91cd\u8bd5\u3002</li> <li>\u5728\u8be5\u6d88\u606f\u7684\u6bcf\u6b21\u6d88\u8d39\u5931\u8d25\u540e\uff0c<code>RetryTemplate</code> \u4f1a\u901a\u8fc7 <code>BackOffPolicy</code> \u6765\u8fdb\u884c\u8ba1\u7b97\u8be5\u6d88\u606f\u7684\u4e0b\u4e00\u6b21\u91cd\u65b0\u6d88\u8d39\u7684\u65f6\u5019\uff0c\u901a\u8fc7 <code>Thread.sleep()</code> \u65b9\u6cd5\u5b9e\u73b0\u91cd\u65b0\u6d88\u8d39\u7684\u65f6\u95f4\u95f4\u9694\u3002\u5230\u8fbe\u65f6\u95f4\u95f4\u9694\u540e\uff0c<code>RetryTemplate</code>\u53c8\u4f1a\u8c03\u7528\u6d88\u8d39\u8005\u76d1\u542c\u5668\u6765\u6d88\u8d39\u8be5\u6d88\u606f\u3002</li> <li>\u5f53\u8be5\u6d88\u606f\u7684\u91cd\u8bd5\u6d88\u8d39\u8fbe\u5230\u4e0a\u9650\u540e\uff0c<code>RetryTemplate</code> \u4f1a\u8c03\u7528 <code>MethodInvocationRecoverer</code> \u56de\u8c03\u6765\u5b9e\u73b0\u6062\u590d\u3002\u800c Spring AMQP \u81ea\u5b9a\u4e49\u5b9e\u73b0\u4e86 <code>RejectAndDontRequeueRecoverer</code> \u6765\u81ea\u52a8\u629b\u51fa <code>AmqpRejectAndDontRequeueException</code> \u5f02\u5e38\uff0c\u4ece\u800c\u7ed3\u675f\u8be5\u6d88\u606f\u7684\u6d88\u8d39\u91cd\u8bd5\u3002</li> <li>\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0cSpring AMQP \u63d0\u4f9b\u7684\u6d88\u8d39\u91cd\u8bd5\u7684\u8ba1\u6570\u662f\u5728\u5ba2\u6237\u7aef\u7ea7\u522b\u7684\uff0c\u91cd\u542f JVM \u5e94\u7528\u540e\uff0c\u8ba1\u6570\u662f\u4f1a\u4e22\u5931\u7684\u3002</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#applicationyml","title":"\u914d\u7f6e\uff08<code>application.yml</code>\uff09","text":"<pre><code>spring:\n  rabbitmq:\n    listener:\n      simple:\n        retry: # \u6d88\u8d39\u91cd\u8bd5\n          enabled: true            # \u5f00\u542f\u6d88\u8d39\u91cd\u8bd5\u673a\u5236\n          max-attempts: 3          # \u6700\u5927\u91cd\u8bd5\u6b21\u6570\n          initial-interval: 1000ms # \u91cd\u8bd5\u95f4\u9694\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#46","title":"4.6 \u5e76\u53d1\u6d88\u8d39","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_46","title":"\u4ecb\u7ecd","text":"<p>\u5728\u4e0a\u8ff0\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u914d\u7f6e\u7684\u6bcf\u4e00\u4e2a Spring AMQP \u7684 <code>@RabbitListener</code> \u90fd\u662f\u4e32\u884c\u6d88\u8d39\u7684\u3002\u663e\u7136\uff0c\u8fd9\u5728\u76d1\u542c\u7684 Queue \u6bcf\u79d2\u6d88\u606f\u91cf\u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u4f1a\u5bfc\u81f4\u6d88\u8d39\u4e0d\u53ca\u65f6\uff0c\u5bfc\u81f4\u6d88\u606f\u79ef\u538b\u95ee\u9898\u3002</p> <p>\u867d\u7136\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u542f\u52a8\u591a\u4e2a JVM \u8fdb\u7a0b\uff0c\u5b9e\u73b0\u591a\u8fdb\u7a0b\u7684\u5e76\u53d1\u6d88\u8d39\uff0c\u4ece\u800c\u52a0\u901f\u6d88\u8d39\u7684\u901f\u5ea6\u3002\u4f46\u662f\u600e\u4e48\u5b9e\u73b0\u591a\u7ebf\u7a0b\u7684\u5e76\u53d1\u6d88\u8d39\u5462\uff1f</p> <p>\u5728 <code>@RabbitListener</code> \u6ce8\u89e3\u4e2d\uff0c\u6709 <code>concurrency</code> \u5c5e\u6027\uff0c\u5b83\u53ef\u4ee5\u6307\u5b9a\u5e76\u53d1\u6d88\u8d39\u7684\u7ebf\u7a0b\u3002\u4f8b\u5982\uff0cSpring AMQP \u4f1a\u6839\u636e <code>@RabbitListener(concurrency = 2)</code> \u6ce8\u89e3\u914d\u7f6e\uff0c\u521b\u5efa\u4e24\u4e2a Consumer\uff0c\u540e\u7eed\uff0c\u6bcf\u4e2a Consumer \u4f1a\u88ab\u5355\u72ec\u5206\u914d\u5230\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u8fdb\u884c\u62c9\u53d6\u6d88\u606f\uff0c\u6d88\u8d39\u6d88\u606f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#spring-amqp-containertype","title":"Spring AMQP \u7684\u5bb9\u5668\u7c7b\u578b\uff08<code>ContainerType</code>\uff09","text":"<p>\u7b2c\u4e00\u79cd\u7c7b\u578b <code>SIMPLE</code> \u5bf9\u5e94 <code>SimpleMessageListenerContainer</code> \u6d88\u606f\u76d1\u542c\u5668\u5bb9\u5668\uff0c\u5b83\u4e00\u5171\u6709\u4e24\u7c7b\u7ebf\u7a0b\uff1a</p> <ul> <li>Consumer \u7ebf\u7a0b\uff1a\u8d1f\u8d23\u4ece RabbitMQ Broker \u83b7\u53d6 Queue \u4e2d\u7684\u6d88\u606f\uff0c\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u7684 <code>BlockingQueue</code> \u963b\u585e\u961f\u5217\u4e2d\u3002</li> <li>Listener \u7ebf\u7a0b\uff0c\u8d1f\u8d23\u4ece\u5185\u5b58\u4e2d\u7684 <code>BlockingQueue</code> \u4e2d\u83b7\u53d6\u6d88\u606f\uff0c\u8fdb\u884c\u6d88\u8d39\u903b\u8f91\u3002</li> </ul> <p>\u6ce8\u610f\uff0c\u6bcf\u4e00\u4e2a Consumer \u7ebf\u7a0b\uff0c\u5bf9\u5e94\u4e00\u4e2a RabbitMQ Consumer\uff0c\u5bf9\u5e94\u4e00\u4e2a Listener \u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u4e09\u8d23\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002</p> <p>\u7b2c\u4e8c\u79cd\u7c7b\u578b <code>DIRECT</code> \u5bf9\u5e94 <code>DirectMessageListenerContainer</code> \u6d88\u606f\u76d1\u542c\u5668\u5bb9\u5668\u3002\u5b83\u53ea\u6709\u4e00\u7c7b\u7ebf\u7a0b\uff0c\u65e2\u505a <code>SIMPLE</code> \u7684 Consumer \u7ebf\u7a0b\u7684\u5de5\u4f5c\uff0c\u4e5f\u505a <code>SIMPLE</code> \u7684 Listener \u7ebf\u7a0b\u5de5\u4f5c\u3002</p> <p>\u6ce8\u610f\u56e0\u4e3a\u53ea\u6709\u4e00\u7c7b\u7ebf\u7a0b\uff0c\u6240\u6709\u5b83\u8981\u4e48\u6b63\u5728\u83b7\u53d6\u6d88\u606f\uff0c\u8981\u4e48\u6b63\u5728\u6d88\u8d39\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u83b7\u53d6\u6d88\u606f\u548c\u6d88\u8d39\u6d88\u606f\u662f\u4e32\u884c\u7684\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSpring AMQP \u9009\u62e9\u7b2c\u4e00\u79cd\u7c7b\u578b\uff0c\u5373 <code>SIMPLE</code> \u5bb9\u5668\u7c7b\u578b\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#applicationyml_1","title":"\u914d\u7f6e\uff08<code>application.yml</code>\uff09","text":"<pre><code>spring:\n  rabbitmq:\n    listener:\n      type: simple\n      simple:\n        concurrency: 2\n        max-concurrency: 10\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_47","title":"\u6d88\u8d39\u8005","text":"<pre><code>@Component\npublic class ConcurrencyConsumer {\n    @RabbitListener(queues = { RabbitMQConfig.QUEUE }, concurrency = \"2\")\n    public void onMessage(Message message, Channel channel) {\n        long thread = Thread.currentThread().getId();\n        System.out.printf(\"Received thread='%d' raw='%s'\\n\", thread, new String(message.getBody()));\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#47","title":"4.7 \u4e8b\u52a1\u6d88\u606f","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_48","title":"\u914d\u7f6e","text":"<pre><code>@EnableTransactionManagement\n@Configuration\npublic class RabbitMQConfig {\n    // ...\n    @Bean\n    public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory, RabbitTemplate rabbitTemplate) {\n        rabbitTemplate.setChannelTransacted(true);\n        return new RabbitTransactionManager(connectionFactory);\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#48","title":"4.8 \u6d88\u606f\u5f02\u5e38\u5904\u7406\u5668","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_49","title":"\u4ecb\u7ecd","text":"<p>Spring AMQP \u9664\u4e86\u63d0\u4f9b\u6d88\u606f\u91cd\u8bd5\u673a\u5236\u5916\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6d88\u8d39\u5f02\u5e38\u65f6\u7684\u5904\u7406\u5668\uff0c\u76ee\u524d\u6709\u4e24\u4e2a\u63a5\u53e3\uff1a</p> <ul> <li><code>org.springframework.amqp.rabbit.listener.api.RabbitListenerErrorHandler</code></li> <li><code>org.springframework.util.ErrorHandler</code></li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#rabbitlistenererrorhandler","title":"<code>RabbitListenerErrorHandler</code>\u914d\u7f6e","text":"<pre><code>@Slf4j\n@Component\npublic class MyRabbitListenerErrorHandler implements RabbitListenerErrorHandler {\n    @Override\n    public Object handleError(\n        org.springframework.amqp.core.Message amqpMessage,\n        org.springframework.messaging.Message&lt;?&gt; message,\n        ListenerExecutionFailedException exception\n    ) throws Exception {\n        log.error(\"[handleError] amqpMessage='{}' message='{}'\", amqpMessage, message);\n        return null;\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#errorhandler","title":"<code>ErrorHandler</code> \u914d\u7f6e","text":"<pre><code>@Slf4j\n@Component\npublic class MyRabbitListenerErrorHandler implements ErrorHandler {\n    public MyErrorHandler(SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory) {\n        rabbitListenerContainerFactory.setErrorHandler(this);\n    }\n    @Override\n    public void handleError(Throwable t) {\n        log.error(\"[handleError] {}\", t.getMessage());\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_50","title":"\u4e94\u3001\u6d88\u606f\u5e94\u7b54","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#51","title":"5.1 \u6982\u5ff5","text":"<p>\u6d88\u8d39\u8005\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u53ef\u80fd\u9700\u8981\u4e00\u6bb5\u65f6\u95f4\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2a\u6d88\u8d39\u8005\u5904\u7406\u4e00\u4e2a\u957f\u7684\u4efb\u52a1\u4f46\u662f\u53ea\u5b8c\u6210\u4e86\u90e8\u5206\u7a81\u7136\u6302\u6389\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u60c5\u51b5\uff1f</p> <p>RabbitMQ \u4e00\u65e6\u5411\u6d88\u8d39\u8005\u4f20\u9012\u4e86\u4e00\u6761\u6d88\u606f\uff0c\u4fbf\u7acb\u5373\u5c06\u8be5\u6d88\u606f\u6807\u8bb0\u4e3a\u5220\u9664\u3002\u8fd9\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7a81\u7136\u6709\u4e2a\u6d88\u8d39\u8005\u6302\u6389\u4e86\uff0c\u6211\u4eec\u5c06\u4e22\u5931\u6b63\u5728\u5904\u7406\u7684\u6d88\u606f\uff0c\u4ee5\u53ca\u540e\u7eed\u53d1\u9001\u7ed9\u8be5\u6d88\u8d39\u8005\u7684\u6d88\u606f\uff0c\u56e0\u4e3a\u8be5\u6d88\u8d39\u8005\u65e0\u6cd5\u63a5\u6536\u5230\u3002</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u5728\u53d1\u9001\u8fc7\u7a0b\u4e2d\u4e0d\u4e22\u5931\uff0cRabbitMQ \u5f15\u5165\u6d88\u606f\u5e94\u7b54\u673a\u5236\uff1a\u6d88\u8d39\u8005\u5728\u63a5\u6536\u5230\u6d88\u606f\u5e76\u4e14\u5904\u7406\u6389\u6d88\u606f\u4e4b\u540e\uff0c\u544a\u8bc9 RabbitMQ \u5b83\u5df2\u7ecf\u5904\u7406\u4e86\uff0cRabbitMQ \u53ef\u4ee5\u628a\u8be5\u6d88\u606f\u5220\u9664\u4e86\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#52","title":"5.2 \u81ea\u52a8\u5e94\u7b54","text":"<p>\u6d88\u606f\u53d1\u9001\u540e\u7acb\u5373\u88ab\u8ba4\u4e3a\u5df2\u7ecf\u4f20\u9001\u6210\u529f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u9700\u8981\u5728\u9ad8\u541e\u5410\u91cf\u548c\u6570\u636e\u4f20\u8f93\u5b89\u5168\u6027\u65b9\u9762\u505a\u6743\u8861\uff0c\u56e0\u4e3a\u8fd9\u79cd\u6a21\u5f0f\u5982\u679c\u6d88\u606f\u5728\u63a5\u6536\u5230\u4e4b\u524d\uff0c\u6d88\u8d39\u8005\u90a3\u8fb9\u51fa\u73b0 Connection \u6216 Channel \u5173\u95ed\uff0c\u90a3\u4e48\u6d88\u606f\u5c31\u4e22\u5931\u4e86\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\u8fd9\u79cd\u6a21\u5f0f\u6d88\u8d39\u8005\u90a3\u8fb9\u53ef\u4ee5\u4f20\u9012\u8fc7\u8f7d\u7684\u6d88\u606f\uff0c\u6ca1\u6709\u5bf9\u4f20\u9012\u7684\u6d88\u606f\u6570\u91cf\u8fdb\u884c\u6d88\u606f\uff0c\u8fd9\u6837\u6709\u53ef\u80fd\u4f7f\u5f97\u6d88\u8d39\u8005\u8fd9\u8fb9\u7531\u4e8e\u63a5\u6536\u592a\u591a\u8fd8\u6765\u4e0d\u53ca\u5904\u7406\u7684\u6d88\u606f\uff0c\u5bfc\u81f4\u8fd9\u4e9b\u6d88\u606f\u7684\u79ef\u538b\uff0c\u6700\u7ec8\u4f7f\u5f97\u5185\u5b58\u8017\u5c3d\uff0c\u6700\u7ec8\u8fd9\u4e9b\u6d88\u8d39\u8005\u7ebf\u7a0b\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6740\u6b7b\u3002</p> <p>\u6240\u4ee5\u8fd9\u79cd\u6a21\u5f0f\u4ec5\u9002\u7528\u5728\u6d88\u8d39\u8005\u53ef\u4ee5\u9ad8\u6548\u5e76\u4ee5\u67d0\u79cd\u901f\u7387\u80fd\u591f\u5904\u7406\u8fd9\u4e9b\u6d88\u606f\u7684\u60c5\u51b5\u4e0b\u9002\u7528\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#53","title":"5.3 \u624b\u52a8\u5e94\u7b54","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_51","title":"\u6d88\u606f\u5e94\u7b54\u65b9\u6cd5","text":"<ul> <li><code>Channel.basicAck()</code> \uff1a\u80af\u5b9a\u786e\u8ba4\uff08\u652f\u6301\u6279\u91cf\uff09</li> <li><code>Channel.basicNack()</code>\uff1a\u5426\u5b9a\u786e\u8ba4</li> <li><code>Channel.basicReject()</code>\uff1a\u5426\u5b9a\u786e\u8ba4\uff08\u652f\u6301\u6279\u91cf\uff09</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_52","title":"\u6279\u91cf\u5e94\u7b54","text":"<p>\u624b\u52a8\u5e94\u7b54\u7684\u597d\u5904\u662f\u53ef\u4ee5\u6279\u91cf\u5e94\u7b54\u5e76\u4e14\u51cf\u5c11\u7f51\u7edc\u62e5\u5835\u3002<code>multiple</code> \u8868\u793a\u662f\u5426\u4e00\u6b21\u6027\u5e94\u7b54\u5f53\u524d Tag \u53ca\u5176\u4e4b\u524d\u6240\u6709\u5c1a\u672a\u5e94\u7b54\u7684\u6d88\u606f\u3002</p> <p>\u6bd4\u5982 Channel \u4e0a\u7684\u6d88\u606f\u7684 Tag \u5206\u522b\u4e3a 5\u30016\u30017\u30018\uff0c\u5f53\u524d Tag \u4e3a 8\uff0c\u90a3\u4e48 <code>multiple = true</code> \u8868\u793a\u6b64\u65f6 Tag \u4e3a 5 \u5230 8 \u7684\u8fd9\u4e9b\u8fd8\u672a\u5e94\u7b54\u7684\u6d88\u606f\u90fd\u4f1a\u88ab\u786e\u8ba4\u5e94\u7b54\uff1b<code>multiple = false</code> \u5219\u8868\u793a\u4ec5 Tag \u4e3a 8 \u7684\u6d88\u606f\u4f1a\u88ab\u786e\u8ba4\u5e94\u7b54\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_53","title":"\u6d88\u606f\u81ea\u52a8\u91cd\u65b0\u5165\u961f","text":"<p>\u5982\u679c\u6d88\u8d39\u8005\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u5931\u53bb\u8fde\u63a5\uff08\u901a\u8fc7\u5173\u95ed\u3001\u8fde\u63a5\u5173\u95ed\u7b49\uff09\uff0c\u5bfc\u81f4\u6d88\u606f\u4e3a\u53d1\u9001 ACK \u786e\u8ba4\uff0cRabbitMQ \u5c06\u4e86\u89e3\u5230\u6d88\u606f\u672a\u5b8c\u6210\u5904\u7406\uff0c\u5e76\u5c06\u5176\u91cd\u65b0\u6392\u961f\u3002\u5982\u679c\u6b64\u65f6\u5176\u5b83\u6d88\u8d39\u8005\u53ef\u4ee5\u5904\u7406\uff0c\u5b83\u5c06\u5f88\u5feb\u5c06\u5176\u5206\u53d1\u7ed9\u53e6\u4e00\u4e2a\u6d88\u8d39\u8005\u3002\u8fd9\u6837\u5373\u4f7f\u6d88\u8d39\u8005\u5076\u5c14\u6b7b\u4ea1\uff0c\u4e5f\u53ef\u4ee5\u786e\u8ba4\u4e0d\u4f1a\u4e22\u5931\u4efb\u4f55\u6d88\u606f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_54","title":"\u516d\u3001\u5de5\u4f5c\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#61","title":"6.1 \u6982\u5ff5","text":"<p>\u5f53\u6709\u591a\u4e2a\u6d88\u8d39\u8005\u65f6\uff0c\u6211\u4eec\u7684\u6d88\u606f\u4f1a\u88ab\u54ea\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u5462\uff1f\u6211\u4eec\u53c8\u8be5\u5982\u4f55\u5747\u8861\u6d88\u8d39\u8005\u6d88\u606f\u7684\u591a\u5c11\u5462\uff1f</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#62","title":"6.2 \u8f6e\u8be2\u5206\u53d1","text":"<p>\u4e00\u4e2a\u6d88\u8d39\u8005\u4e00\u6761\uff0c\u6309\u5747\u5206\u53d1\u3002</p> <p>\u8f6e\u8be2\u5206\u53d1\u7b56\u7565\u5728\u67d0\u79cd\u573a\u666f\u4e0b\u5e76\u4e0d\u662f\u5f88\u597d\uff0c\u6bd4\u5982\u6709\u4e24\u4e2a\u6d88\u8d39\u8005\u5728\u5904\u7406\u4efb\u52a1\uff0c\u5176\u4e2d\u6709\u4e2a\u6d88\u8d39\u8005\u5904\u7406\u4efb\u52a1\u7684\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u800c\u53e6\u5916\u4e00\u4e2a\u6d88\u8d39\u8005\u5904\u7406\u901f\u5ea6\u5374\u5f88\u6162\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u8fd8\u91c7\u7528\u8f6e\u8be2\u5206\u53d1\u7b56\u7565\uff0c\u90a3\u4e48\u5c31\u4f1a\u9020\u6210\u5904\u7406\u901f\u5ea6\u5feb\u7684\u6d88\u8d39\u8005\u5f88\u5927\u4e00\u90e8\u5206\u65f6\u95f4\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u800c\u5904\u7406\u6162\u7684\u90a3\u4e2a\u6d88\u8d39\u8005\u4e00\u76f4\u5728\u5e72\u6d3b\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#63","title":"6.3 \u516c\u5e73\u5206\u53d1","text":"<p>\u6839\u636e\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u80fd\u529b\u8fdb\u884c\u5206\u53d1\uff0c\u5904\u7406\u5feb\u7684\u5904\u7406\u7684\u591a\uff0c\u5904\u7406\u6162\u7684\u5904\u7406\u7684\u5c11\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#64","title":"6.4 \u9884\u53d6\u6570","text":"<p>\u672c\u8eab\u6d88\u606f\u7684\u53d1\u9001\u5c31\u662f\u5f02\u6b65\u53d1\u9001\u7684\uff0c\u6240\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\uff0cChannel \u4e0a\u80af\u5b9a\u4e0d\u6b62\u53ea\u6709\u4e00\u4e2a\u6d88\u606f\uff0c\u53e6\u5916\u6d88\u8d39\u8005\u7684\u624b\u52a8\u5e94\u7b54\u672c\u8d28\u4e0a\u4e5f\u662f\u5f02\u6b65\u7684\uff0c\u56e0\u6b64\u8fd9\u91cc\u5c31\u5b58\u5728\u4e00\u4e2a\u672a\u786e\u8ba4\u7684\u7f13\u51b2\u533a\uff0c\u56e0\u6b64\u9700\u8981\u9650\u5236\u6b64\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u4ee5\u907f\u514d\u7f13\u51b2\u533a\u91cc\u9762\u65e0\u9650\u5236\u7684\u672a\u786e\u8ba4\u6d88\u606f\u95ee\u9898\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7 <code>Channel.basicQos()</code> \u65b9\u6cd5\u8bbe\u7f6e \u201c\u9884\u53d6\u6570\u201d\uff0c\u8be5\u503c\u5b9a\u4e49\u901a\u9053\u4e0a\u5141\u8bb8\u7684\u672a\u5904\u7406\u7684\u6d88\u606f\u6700\u5927\u6570\u91cf\u3002\u4e00\u65e6\u8fbe\u5230\u4e0e\u914d\u7f6e\u7684\u6570\u91cf\uff0cRabbitMQ \u5c06\u505c\u6b62\u5728\u901a\u9053\u4e0a\u4f20\u9012\u66f4\u591a\u6d88\u606f\uff0c\u9664\u975e\u81f3\u5c11\u6709\u4e00\u4e2a\u672a\u5904\u7406\u7684\u6d88\u606f\u88ab\u786e\u8ba4\u3002</p> <p>\u6d88\u606f\u5e94\u7b54\u548c QoS \u9884\u53d6\u6570\u5bf9\u7528\u6237\u541e\u5410\u91cf\u6709\u91cd\u5927\u5f71\u54cd\u3002\u901a\u5e38\u589e\u52a0\u9884\u53d6\u6570\u5c06\u63d0\u9ad8\u5411\u6d88\u8d39\u8005\u4f20\u9012\u6d88\u606f\u7684\u901f\u5ea6\u3002\u867d\u7136\u81ea\u52a8\u5e94\u7b54\u4f20\u8f93\u6d88\u606f\u901f\u5ea6\u662f\u6700\u4f73\u7684\uff0c\u4f46\u662f\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5df2\u4f20\u9012\u4f46\u5c1a\u672a\u5904\u7406\u7684\u6d88\u606f\u7684\u6570\u91cf\u4e5f\u4f1a\u589e\u52a0\uff0c\u4ece\u800c\u589e\u52a0\u4e86\u6d88\u8d39\u8005\u7684\u5185\u5b58\u6d88\u8017\uff08\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668\uff09\u3002</p> <p></p> <pre><code>int prefetchCount = 1;\nchannel.basicQos(prefetchCount);\n</code></pre> <p>\u8868\u793a\u5982\u679c\u8fd9\u4e2a\u4efb\u52a1\u6211\u8fd8\u6ca1\u6709\u5904\u7406\u5b8c\u6216\u8005\u6211\u6ca1\u6ca1\u6709\u5e94\u7b54\u4f60\uff0c\u4f60\u5148\u522b\u5206\u914d\u7ed9\u6211\uff0c\u6211\u76ee\u524d\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u4efb\u52a1\uff0c\u7136\u540e RabbitMQ \u5c31\u4f1a\u628a\u4efb\u52a1\u5206\u914d\u7ed9\u6ca1\u6709\u90a3\u4e48\u5fd9\u7684\u7a7a\u95f2\u6d88\u8d39\u8005\u3002\u5f53\u7136\u5982\u679c\u6240\u6709\u7684\u6d88\u8d39\u8005\u90fd\u6ca1\u6709\u5b8c\u6210\u624b\u4e0a\u4efb\u52a1\uff0c\u961f\u5217\u8fd8\u5728\u4e0d\u505c\u7684\u6dfb\u52a0\u65b0\u4efb\u52a1\uff0c\u961f\u5217\u6709\u53ef\u80fd\u4f1a\u9047\u5230\u88ab\u6491\u6ee1\u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ea\u80fd\u6dfb\u52a0\u65b0\u7684\u6d88\u8d39\u8005\u6216\u8005\u6539\u53d8\u5176\u5b58\u50a8\u4efb\u52a1\u7684\u7b56\u7565\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#rabbitmq","title":"\u4e03\u3001RabbitMQ \u6301\u4e45\u5316","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#71","title":"7.1 \u6982\u5ff5","text":"<p>\u6211\u4eec\u5728 \u3010\u6d88\u606f\u5e94\u7b54\u673a\u5236\u3011\u4e2d\u4e86\u89e3\u4e86\u5982\u4f55\u5904\u7406\u4efb\u52a1\u4e0d\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u5982\u679c\u62a5\u8d26\u5f53 RabbitMQ \u670d\u52a1\u505c\u6389\u4ee5\u540e\u6d88\u606f\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u4e0d\u4e22\u5931\uff1f</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b RabbitMQ \u9000\u51fa\u6216\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5d29\u6e83\u65f6\uff0c\u5b83\u5c06\u5ffd\u89c6\u961f\u5217\u548c\u6d88\u606f\uff0c\u9664\u975e\u544a\u77e5\u5b83\u4e0d\u8981\u8fd9\u6837\u505a\u3002\u786e\u4fdd\u6d88\u606f\u4e0d\u4f1a\u4e22\u5931\u9700\u8981\u5c06\u961f\u5217\u548c\u6d88\u606f\u90fd\u6807\u8bb0\u4e3a\u6301\u4e45\u5316\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#72","title":"7.2 \u961f\u5217\u6301\u4e45\u5316","text":"<p>\u975e\u6301\u4e45\u5316\u7684\u961f\u5217\u5728 RabbitMQ \u91cd\u542f\u540e\u4f1a\u88ab\u81ea\u52a8\u5220\u9664\u6389\uff0c\u5982\u679c\u8981\u961f\u5217\u6301\u4e45\u5316\uff0c\u9700\u8981\u5728\u58f0\u660e\u961f\u5217\u7684\u65f6\u5019\u628a <code>durable</code> \u53c2\u6570\u8bbe\u4e3a <code>true</code>\u3002</p> <pre><code>channel.queueDeclare(queue, true, exclusive, autoDelete, arguments);\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u5c31\u662f\u5982\u679c\u4e4b\u524d\u58f0\u660e\u7684\u961f\u5217\u4e0d\u662f\u6301\u4e45\u5316\u7684\uff0c\u9700\u8981\u628a\u539f\u5148\u961f\u5217\u5148\u5220\u9664\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#73","title":"7.3 \u6d88\u606f\u6301\u4e45\u5316","text":"<pre><code>channel.basicPublish(exchange, routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, body.getBytes());\n</code></pre> <p>\u5c06\u6d88\u606f\u6807\u8bb0\u4e3a\u6301\u4e45\u5316\u5e76\u4e0d\u80fd\u5b8c\u5168\u62a5\u8d26\u4e0d\u4f1a\u4e22\u5931\u6d88\u606f\u3002\u5c3d\u7ba1\u5b83\u544a\u8bc9 RabbitMQ \u5c06\u6d88\u606f\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u4f46\u662f\u8fd9\u91cc\u4f9d\u7136\u5b58\u5728\u5f53\u6d88\u606f\u521a\u51c6\u5907\u5b58\u50a8\u5728\u78c1\u76d8\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u5b58\u50a8\u5b8c\u7684\u65f6\u5019\uff0c\u6d88\u606f\u8fd8\u5728\u7f13\u5b58\u7684\u4e00\u4e2a\u95f4\u9694\u70b9\u3002\u6b64\u65f6\u5e76\u6ca1\u6709\u771f\u6b63\u5199\u5165\u78c1\u76d8\u3002\u6301\u4e45\u5316\u4fdd\u8bc1\u5e76\u4e0d\u5f3a\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b80\u5355\u7684\u4efb\u52a1\u961f\u5217\u800c\u8a00\uff0c\u8fd9\u5df2\u7ecf\u7ef0\u7ef0\u6709\u4f59\u4e86\u3002</p> <p>\u5bf9\u4e8e\u66f4\u5f3a\u6709\u529b\u7684\u6301\u4e45\u5316\u7b56\u7565\uff0c\u4f1a\u5728\u3010\u53d1\u5e03\u786e\u8ba4\u3011\u7ae0\u8282\u8bf4\u660e\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_55","title":"\u516b\u3001\u4e8b\u52a1\u673a\u5236","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#81","title":"8.1 \u6982\u5ff5","text":"<p>\u5728\u4f7f\u7528 RabbitMQ \u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6d88\u606f\u6301\u4e45\u5316\u64cd\u4f5c\u6765\u89e3\u51b3\u56e0\u4e3a\u670d\u52a1\u5668\u7684\u5f02\u5e38\u5954\u6e83\u5bfc\u81f4\u7684\u6d88\u606f\u4e22\u5931\uff0c\u9664\u6b64\u4e4b\u5916\u6211\u4eec\u8fd8\u4f1a\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53\u6d88\u606f\u7684\u53d1\u5e03\u8005\u5728\u5c06\u6d88\u606f\u53d1\u9001\u51fa\u53bb\u4e4b\u540e\uff0c\u6d88\u606f\u5230\u5e95\u6709\u6ca1\u6709\u6b63\u786e\u5230\u8fbe Broker \u670d\u52a1\u5668\u5462\uff1f</p> <p>\u5982\u679c\u4e0d\u8fdb\u884c\u7279\u6b8a\u914d\u7f6e\u7684\u8bdd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53d1\u5e03\u64cd\u4f5c\u662f\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u6d88\u606f\u7ed9\u751f\u4ea7\u8005\u7684\uff0c\u4e5f\u5c31\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6211\u4eec\u7684\u751f\u4ea7\u8005\u662f\u4e0d\u77e5\u9053\u6d88\u606f\u6709\u6ca1\u6709\u6b63\u786e\u5230\u8fbe Broker \u7684\uff0c\u5982\u679c\u6d88\u606f\u5230\u8fbe Broker \u4e4b\u524d\u5df2\u7ecf\u4e22\u5931\u7684\u8bdd\uff0c\u6301\u4e45\u5316\u64cd\u4f5c\u4e5f\u89e3\u51b3\u4e0d\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u6d88\u606f\u6839\u672c\u6ca1\u5230\u8fbe Broker\u3002</p> <p>RabbitMQ \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u901a\u8fc7 AMQP \u4e8b\u52a1\u673a\u5236\u5b9e\u73b0\uff0c\u8fd9\u4e5f\u662f AMQP \u534f\u8bae\u5c42\u9762\u63d0\u4f9b\u7684\u89e3\u51b3\u65b9\u6848\uff1b</li> <li>\u901a\u8fc7\u8bb2\u53d1\u5e03\u786e\u8ba4\u673a\u5236\u6765\u5b9e\u4e60\uff1b</li> </ol>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#82","title":"8.2 \u4ecb\u7ecd","text":"<p>RabbitMQ \u5185\u7f6e\u63d0\u4f9b\u4e8b\u52a1\u6d88\u606f\u7684\u652f\u6301\uff0c\u4e0d\u8fc7 RabbitMQ \u63d0\u4f9b\u7684\u5e76\u4e0d\u662f\u5b8c\u6574\u7684\u4e8b\u52a1\u6d88\u606f\u7684\u652f\u6301\uff0c\u7f3a\u5c11\u4e86\u56de\u67e5\u673a\u5236\u3002</p> <p>RabbitMQ \u4e2d\u4e0e\u4e8b\u52a1\u673a\u5236\u6709\u5173\u7684\u65b9\u6cd5\u6709\u4e09\u4e2a\uff1a</p> <ul> <li><code>channel.txSelect()</code>\uff1a\u7528\u4e8e\u5c06\u5f53\u524d Channel \u8bbe\u7f6e\u6210 Transaction \u6a21\u5f0f\u3002</li> <li><code>channel.txCommit()</code>\uff1a\u7528\u4e8e\u63d0\u4ea4\u4e8b\u52a1\u3002</li> <li><code>channel.txRollback()</code>\uff1a\u7528\u4e8e\u56de\u6eda\u4e8b\u52a1\u3002</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#82_1","title":"8.2 \u5173\u952e\u4ee3\u7801","text":"<pre><code>channel.txSelect();\nchannel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());\nchannel.txCommit();\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#83","title":"8.3 \u95ee\u9898","text":"<p>\u4e8b\u52a1\u786e\u5b9e\u80fd\u591f\u89e3\u51b3 Producer \u548c Broker \u4e4b\u95f4\u6d88\u606f\u786e\u8ba4\u7684\u95ee\u9898\uff0c\u53ea\u6709\u6d88\u606f\u6210\u529f\u88ab Broker \u63a5\u6536\uff0c\u4e8b\u52a1\u63d0\u4ea4\u624d\u80fd\u6210\u529f\uff0c\u5426\u5219\u6211\u4eec\u4fbf\u53ef\u4ee5\u5728\u6355\u83b7\u5f02\u5e38\u5f02\u5e38\u8fdb\u884c\u4e8b\u52a1\u56de\u6eda\uff0c\u540c\u65f6\u8fdb\u884c\u6d88\u606f\u91cd\u53d1\u3002</p> <p>\u4f46\u662f\u4f7f\u7528\u4e8b\u52a1\u673a\u5236\u7684\u8bdd\u4f1a\u964d\u4f4e RabbitMQ \u7684\u6027\u80fd\uff0c\u90a3\u4e48\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u65e2\u80fd\u4fdd\u969c Producer \u77e5\u9053\u6d88\u606f\u5df2\u7ecf\u6b63\u786e\u53d1\u9001\u5230 Broker\uff0c\u53c8\u80fd\u57fa\u672c\u4e0a\u4e0d\u5e26\u6765\u6027\u80fd\u4e0a\u7684\u635f\u5931\u5462\uff1f</p> <p>\u4ece AMQP \u534f\u8bae\u7684\u5c42\u9762\u770b\u662f\u6ca1\u6709\u66f4\u597d\u7684\u529e\u6cd5\uff0c\u4f46\u662f RabbitMQ \u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u597d\u7684\u65b9\u6848\uff0c\u5373\u5c06 Channel \u8bbe\u7f6e\u4e3a \u53d1\u5e03\u786e\u8ba4\u6a21\u5f0f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_56","title":"\u4e5d\u3001\u53d1\u5e03\u786e\u8ba4\u673a\u5236","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#91","title":"9.1 \u6982\u5ff5","text":"<p>\u751f\u4ea7\u8005\u5c06\u901a\u9053\u8bbe\u4e3a Confirm \u6a21\u5f0f\uff0c\u6240\u6709\u5728\u8be5\u901a\u9053\u4e0a\u53d1\u5e03\u7684\u6d88\u606f\u90fd\u4f1a\u88ab\u6307\u6d3e\u4e00\u4e2a\u552f\u4e00\u7684 ID\uff0c\u6d88\u606f\u88ab\u6295\u9012\u5230\u6240\u6709\u5339\u914d\u7684\u961f\u5217\u4e4b\u540e\uff0cBroker \u5c31\u4f1a\u53d1\u9001\u4e00\u4e2a\u786e\u8ba4\u7ed9\u751f\u4ea7\u8005\uff08\u5305\u542b\u6d88\u606f\u7684\u552f\u4e00 ID\uff09\u3002</p> <p>\u8fd9\u5c31\u4f7f\u5f97\u751f\u4ea7\u8005\u77e5\u9053\u6d88\u606f\u5df2\u7ecf\u6b63\u786e\u5230\u8fbe\u76ee\u7684\u961f\u5217\u4e86\uff0c\u5982\u679c\u6d88\u606f\u548c\u961f\u5217\u662f\u6301\u4e45\u5316\u7684\uff0c\u90a3\u4e48\u786e\u8ba4\u6d88\u606f\u4f1a\u5728\u6d88\u606f\u5199\u5165\u78c1\u76d8\u4e4b\u540e\u53d1\u51fa\uff0cBroker \u56de\u4f20\u7ed9\u751f\u4ea7\u8005\u7684\u786e\u8ba4\u6d88\u606f\u4e2d\u7684 <code>deliveryTag</code> \u5305\u542b\u4e86\u786e\u8ba4\u6d88\u606f\u7684\u5e8f\u5217\u53f7\uff0c\u6b64\u5916 Broker \u4e5f\u53ef\u4ee5\u8bbe\u7f6e <code>multiple</code> \u8868\u793a\u5230\u8fd9\u4e2a\u5e8f\u5217\u53f7\u4e4b\u524d\u7684\u6240\u6709\u6d88\u606f\u90fd\u5df2\u7ecf\u5f97\u5230\u4e86\u5904\u7406\u3002</p> <p>Confirm \u6a21\u5f0f\u6700\u5927\u7684\u597d\u5904\u5728\u4e8e\u5b83\u662f\u5f02\u6b65\u7684\uff0c\u4e00\u65e6\u53d1\u5e03\u4e00\u6761\u6d88\u606f\uff0c\u751f\u4ea7\u8005\u5e94\u7528\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u5728\u7b49\u5f85\u901a\u9053\u8fd4\u56de\u786e\u8ba4\u7684\u540c\u65f6\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\uff0c\u5f53\u6d88\u606f\u6700\u7ec8\u5f97\u5230\u786e\u8ba4\u4e4b\u540e\uff0c\u751f\u4ea7\u8005\u5e94\u7528\u7a0b\u5e8f\u4fbf\u53ef\u4ee5\u901a\u8fc7\u56de\u8c03\u65b9\u6cd5\u6765\u5904\u7406\u8be5\u786e\u8ba4\u6d88\u606f\uff0c\u5982\u679c RabbitMQ \u56e0\u4e3a\u81ea\u8eab\u5185\u90e8\u9519\u8bef\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\uff0c\u4e5f\u4f1a\u53d1\u9001\u4e00\u6761 Nack \u6d88\u606f\uff0c\u751f\u4ea7\u8005\u5e94\u7528\u7a0b\u5e8f\u540c\u6837\u53ef\u4ee5\u5728\u56de\u8c03\u65b9\u6cd5\u4e2d\u5904\u7406\u8be5 Nack \u6d88\u606f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#92-mandatory","title":"9.2 <code>mandatory</code> \u53c2\u6570","text":"<p>\u5728\u4ec5\u5f00\u542f\u4e86\u751f\u4ea7\u8005\u786e\u8ba4\u673a\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u4ea4\u6362\u673a\u6536\u5230\u6d88\u606f\u540e\uff0c\u4f1a\u76f4\u63a5\u7ed9\u6d88\u606f\u751f\u4ea7\u8005\u53d1\u9001\u786e\u8ba4\u6d88\u606f\uff0c\u5982\u679c\u53d1\u73b0\u8be5\u6d88\u606f\u4e0d\u53ef\u8def\u7531\uff0c\u90a3\u4e48\u6d88\u606f\u4f1a\u88ab\u76f4\u63a5\u4e22\u5f03\uff0c\u6b64\u65f6\u751f\u4ea7\u8005\u662f\u4e0d\u77e5\u9053\u6d88\u606f\u88ab\u4e22\u5f03\u8fd9\u4e2a\u4e8b\u4ef6\u7684\u3002\u90a3\u4e48\u5982\u679c\u8ba9\u751f\u4ea7\u8005\u77e5\u9053\u65e0\u6cd5\u88ab\u8def\u7531\u7684\u6d88\u606f\u5462\uff1f</p> <p>\u901a\u8fc7\u8bbe\u7f6e <code>mandatory</code> \u53c2\u6570\u53ef\u4ee5\u5728\u5f53\u6d88\u606f\u4f20\u9012\u8fc7\u7a0b\u4e2d\u4e0d\u53ef\u8fbe\u5230\u76ee\u7684\u5730\u65f6\u5c06\u6d88\u606f\u8fd4\u56de\u7ed9\u751f\u4ea7\u8005\u3002</p> <pre><code>boolean mandatory = true;\nchannel.basicPublish(EXCHANGE, ROUTING_KEY, mandatory, null, \"Hello World\".getBytes());\nchannel.addReturnListener(returnMessage -&gt; {\n    String replyText = returnMessage.getReplyText();\n    String exchange = returnMessage.getExchange();\n    String routingKey = returnMessage.getRoutingKey();\n    AMQP.BasicProperties properties = returnMessage.getProperties();\n    String body = new String(returnMessage.getBody());\n});\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#93","title":"9.3 \u5907\u4efd\u4ea4\u6362\u673a","text":"<p>\u6709\u4e86 <code>mandatory</code> \u53c2\u6570\u548c\u6d88\u606f\u56de\u9000\uff0c\u6211\u4eec\u83b7\u5f97\u4e86\u5bf9\u65e0\u6cd5\u6295\u9012\u6d88\u606f\u7684\u611f\u77e5\u80fd\u529b\uff0c\u6709\u673a\u4f1a\u5728\u751f\u4ea7\u8005\u65e0\u6cd5\u88ab\u6295\u9012\u65f6\u53d1\u73b0\u5e76\u5904\u7406\u3002\u4f46\u6709\u65f6\u5019\uff0c\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f\uff0c\u6700\u591a\u6253\u4e2a\u65e5\u5fd7\uff0c\u7136\u540e\u89e6\u53d1\u8b66\u544a\uff0c\u518d\u6765\u624b\u52a8\u5904\u7406\u3002</p> <p>\u901a\u8fc7\u65e5\u5fd7\u5904\u7406\u8fd9\u4e9b\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f\u662f\u5f88\u4e0d\u4f18\u96c5\u7684\u505a\u6cd5\uff0c\u7279\u522b\u662f\u5f53\u751f\u4ea7\u8005\u6240\u5728\u7684\u670d\u52a1\u6709\u591a\u53f0\u673a\u5668\u7684\u65f6\u5019\uff0c\u624b\u52a8\u590d\u5236\u65e5\u5fd7\u4f1a\u66f4\u52a0\u9ebb\u70e6\u800c\u4e14\u66f4\u5bb9\u6613\u51fa\u9519\u3002\u800c\u4e14\u8bbe\u7f6e <code>mandatory</code> \u53c2\u6570\u4f1a\u589e\u52a0\u751f\u4ea7\u8005\u7684\u590d\u6742\u6027\uff0c\u9700\u8981\u6dfb\u52a0\u5904\u7406\u8fd9\u4e9b\u88ab\u56de\u9000\u6d88\u606f\u7684\u903b\u8f91\u3002</p> <p>\u5982\u679c\u65e2\u4e0d\u60f3\u589e\u52a0\u751f\u4ea7\u8005\u7684\u590d\u6742\u6027\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f</p> <p>\u5728\u3010\u6b7b\u4fe1\u961f\u5217\u3011\u7ae0\u8282\u4e2d\u4f1a\u63d0\u5230\u53ef\u4ee5\u4e3a\u961f\u5217\u8bbe\u7f6e\u6b7b\u4fe1\u4ea4\u6362\u673a\u6765\u5b58\u50a8\u90a3\u4e9b\u5904\u7406\u5931\u8d25\u7684\u6d88\u606f\uff0c\u53ef\u662f\u8fd9\u4e9b\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f\u6839\u672c\u6ca1\u6709\u673a\u4f1a\u8fdb\u5165\u5230\u961f\u5217\uff0c\u56e0\u6b64\u65e0\u6cd5\u4f7f\u7528\u6b7b\u4fe1\u961f\u5217\u4fdd\u5b58\u6d88\u606f\u3002</p> <p>\u5728 RabbitMQ \u4e2d\u6709\u4e00\u79cd\u5907\u4efd\u4ea4\u6362\u673a\u673a\u5236\u5b58\u5728\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\u3002\u5f53\u4ea4\u6362\u673a\u6536\u5230\u4e00\u6761\u4e0d\u53ef\u8def\u7531\u6d88\u606f\u65f6\uff0c\u5c31\u4f1a\u628a\u8fd9\u6761\u6d88\u606f\u8f6c\u53d1\u5230\u5907\u4efd\u4ea4\u6362\u673a\u4e2d\uff0c\u7531\u5907\u4efd\u4ea4\u6362\u673a\u6765\u8fdb\u884c\u8f6c\u53d1\u548c\u5904\u7406\u3002</p> <p>\u901a\u5e38\u8bbe\u7f6e\u5907\u4efd\u4ea4\u6362\u673a\u7684\u7c7b\u578b\u4e3a <code>fanout</code>\uff0c\u8fd9\u6837\u5c31\u80fd\u628a\u6240\u6709\u6d88\u606f\u6295\u9012\u5230\u4e0e\u5176\u7ed1\u5b9a\u7684\u961f\u5217\u4e2d\u3002\u5f53\u7136\u6211\u4eec\u8fd8\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u62a5\u8b66\u961f\u5217\uff0c\u7528\u961f\u5217\u7684\u6d88\u8d39\u8005\u6765\u8fdb\u884c\u76d1\u6d4b\u548c\u62a5\u8b66\u3002</p> <pre><code>static final String NORMAL_EXCHANGE = \"x.normal.direct\";\nstatic final String BACKUP_EXCHANGE = \"x.backup.fanout\";\n\n// ...\n\nMap&lt;String, Object&gt; arguments = Map.of(\"alternate-exchange\", BACKUP_EXCHANGE);\nboolean durable = true;\nboolean autoDelete = false;\nchannel.exchangeDeclare(BACKUP_EXCHANGE, BuiltinExchangeType.FANOUT, durable, autoDelete, null);\nchannel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT, durable, autoDelete, arguments);\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_57","title":"\u5341\u3001\u6b7b\u4fe1\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#101","title":"10.1 \u6982\u5ff5","text":"<p>\u6b63\u5e38\u60c5\u51b5\u4e0b\u6d88\u8d39\u8005\u4ece Queue \u4e2d\u53d6\u51fa\u6d88\u606f\u8fdb\u884c\u6d88\u8d39\uff0c\u4f46\u67d0\u4e9b\u65f6\u5019\u7531\u4e8e\u7279\u5b9a\u7684\u539f\u56e0\u5bfc\u81f4 Queue \u4e2d\u7684\u67d0\u4e9b\u6d88\u606f\u65e0\u6cd5\u88ab\u6d88\u8d39\uff0c\u8fd9\u6837\u7684\u6d88\u606f\u5982\u679c\u6ca1\u6709\u540e\u7eed\u7684\u5904\u7406\uff0c\u5c31\u53d8\u6210\u4e86\u6b7b\u4fe1\u3002</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u4e1a\u52a1\u7684\u6d88\u606f\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u5f53\u6d88\u606f\u6d88\u8d39\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u5c06\u6d88\u606f\u6295\u5165\u6b7b\u4fe1\u961f\u5217\u4e2d\u4ee5\u8fdb\u884c\u540e\u7eed\u5904\u7406\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#102","title":"10.2 \u6b7b\u4fe1\u7684\u6765\u6e90","text":"<ul> <li>\u6d88\u606f TTL \u8fc7\u671f</li> <li>\u961f\u5217\u8fbe\u5230\u6700\u5927\u957f\u5ea6</li> <li>\u6d88\u606f\u88ab\u62d2\u7edd\u5e76\u4e14 <code>requeue = false</code></li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#103","title":"10.3 \u793a\u4f8b","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_58","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u6b7b\u4fe1\u961f\u5217-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String NORMAL_EXCHANGE = NormalConsumer.EXCHANGE;\n    static final String NORMAL_ROUTING_KEY = NormalConsumer.ROUTING_KEY;\n\n    static List&lt;String&gt; MESSAGE_LIST = new ArrayList&lt;&gt;();\n\n    static {\n        for (int i = 0; i &lt; 10; i++) {\n            MESSAGE_LIST.add(i + \"\");\n        }\n        for (int i = 0; i &lt; 10; i++) {\n            MESSAGE_LIST.add((char) (i + 65) + \"\");\n        }\n        Collections.shuffle(MESSAGE_LIST);\n    }\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            for (String message : MESSAGE_LIST) {\n                String body = message + \" \" + LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"));\n                channel.basicPublish(NORMAL_EXCHANGE, NORMAL_ROUTING_KEY, null, body.getBytes());\n                System.out.printf(\"Sent message='%s'\\n\", body);\n                TimeUnit.MILLISECONDS.sleep(1000);\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_59","title":"\u666e\u901a\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u6b7b\u4fe1\u961f\u5217-\u6b63\u5e38\u6d88\u8d39\u8005\n */\npublic class NormalConsumer {\n    static final String EXCHANGE = \"x.normal.direct\";\n    static final String QUEUE = \"q.normal\";\n    static final String ROUTING_KEY = \"\";\n\n    static final String DEAD_LETTER_EXCHANGE = DeadLetterConsumer.EXCHANGE;\n    static final String DEAD_LETTER_ROUTING_KEY = DeadLetterConsumer.ROUTING_KEY;\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(NormalConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.exchangeDelete(EXCHANGE);\n            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.DIRECT);\n\n            channel.queueDelete(QUEUE);\n            // \u6b63\u5e38\u961f\u5217\u7ed1\u5b9a\u6b7b\u4fe1\u4ea4\u6362\u673a\n            Map&lt;String, Object&gt; arguments = Map.of(\n                \"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE,       // \u8bbe\u7f6e\u6b7b\u4fe1\u4ea4\u6362\u673a\n                \"x-dead-letter-routing-key\", DEAD_LETTER_ROUTING_KEY, // \u8bbe\u7f6e\u6b7b\u4fe1\u8def\u7531\u952e\n                \"x-message-ttl\", 1000 * 60,                           // \u8bbe\u7f6e\u961f\u5217\u6d88\u606f\u5b58\u6d3b\u65f6\u95f4\n                \"x-max-length\", 10                                    // \u8bbe\u7f6e\u961f\u5217\u6d88\u606f\u6700\u5927\u5bb9\u91cf(\u5148\u5165\u961f\u5217\u7684\u4f1a\u5148\u8fdb\u5165\u6b7b\u4fe1\u961f\u5217)\n            );\n            channel.queueDeclare(QUEUE, false, false, false, arguments);\n\n            channel.queueBind(QUEUE, EXCHANGE, ROUTING_KEY);\n\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                long deliveryTag = delivery.getEnvelope().getDeliveryTag();\n                String body = new String(delivery.getBody());\n                String status;\n                try {\n                    Integer.parseInt(body.split(\" \")[0]);\n                    channel.basicAck(deliveryTag, false);\n                    status = \"ack\";\n                } catch (NumberFormatException | ArrayIndexOutOfBoundsException e) {\n                    // \u6d88\u606f\u88ab\u62d2\n                    channel.basicNack(deliveryTag, false, false);\n                    status = \"nack\";\n                }\n                System.out.printf(\"Received message='%s' status='%s'\\n\", body, status);\n            };\n            channel.basicConsume(QUEUE, false, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_60","title":"\u6b7b\u4fe1\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u6b7b\u4fe1\u961f\u5217-\u6b7b\u4fe1\u6d88\u8d39\u8005\n */\npublic class DeadLetterConsumer {\n    static final String EXCHANGE = \"x.dead_letter.direct\";\n    static final String QUEUE = \"q.dead_letter\";\n    static final String ROUTING_KEY = \"\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(DeadLetterConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.exchangeDelete(EXCHANGE);\n            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.DIRECT);\n\n            channel.queueDelete(QUEUE);\n            channel.queueDeclare(QUEUE, false, false, false, null);\n\n            channel.queueBind(QUEUE, EXCHANGE, ROUTING_KEY);\n\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                String body = new String(delivery.getBody());\n                String at = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"));\n                System.out.printf(\"Received message='%s' at='%s'\\n\", body, at);\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_61","title":"\u5341\u4e00\u3001\u5ef6\u8fdf\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#111","title":"11.1 \u6982\u5ff5","text":"<p>\u5ef6\u8fdf\u961f\u5217\u5185\u90e8\u662f\u6709\u5e8f\u7684\uff0c\u6700\u91cd\u8981\u7684\u7279\u6027\u5c31\u4f53\u73b0\u5728\u5b83\u7684\u5ef6\u65f6\u5c5e\u6027\u4e0a\uff0c\u5ef6\u8fdf\u961f\u5217\u4e2d\u7684\u5143\u7d20\u662f\u5e0c\u671b\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u53d6\u51fa\u5904\u7406\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#112","title":"11.2 \u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u8ba2\u5355\u5728\u5341\u5206\u949f\u4e4b\u5185\u672a\u652f\u4ed8\u5219\u81ea\u52a8\u53d6\u6d88</li> <li>\u65b0\u521b\u5efa\u7684\u5e97\u94fa\uff0c\u5982\u679c\u5728\u5341\u5929\u5185\u90fd\u6ca1\u6709\u4e0a\u4f20\u8fc7\u5546\u54c1\uff0c\u5219\u81ea\u52a8\u53d1\u9001\u6d88\u606f\u63d0\u9192</li> <li>\u7528\u6237\u6ce8\u518c\u540e\uff0c\u5982\u679c\u4e09\u5929\u5185\u6ca1\u6709\u767b\u5f55\u5219\u8fdb\u884c\u77ed\u4fe1\u63d0\u9192</li> <li>\u7528\u6237\u53d1\u8d77\u9000\u6b3e\u540e\uff0c\u5982\u679c\u4e09\u5929\u5185\u6ca1\u6709\u5f97\u5230\u5904\u7406\u5219\u901a\u77e5\u76f8\u5173\u8fd0\u8425\u4eba\u5458</li> <li>\u9884\u5b9a\u4f1a\u8bae\u540e\uff0c\u9700\u8981\u5728\u524d\u5341\u5206\u949f\u901a\u77e5\u5404\u4e2a\u4e0e\u4f1a\u4eba\u5458\u53c2\u52a0\u4f1a\u8bae</li> </ul>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#113-rabbitmq-ttl","title":"11.3 RabbitMQ \u4e2d\u7684 TTL","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_62","title":"\u6982\u5ff5","text":"<p>\u5982\u679c\u4e00\u6761\u6d88\u606f\u8bbe\u7f6e\u4e86 TTL \u5c5e\u6027\u6216\u8005\u8fdb\u5165\u4e86\u8bbe\u7f6e TTL \u5c5e\u6027\u7684\u961f\u5217\uff0c\u90a3\u4e48\u8fd9\u6761\u6d88\u606f\u5982\u679c\u5728 TTL \u8bbe\u7f6e\u7684\u65f6\u95f4\u5185\u6ca1\u6709\u88ab\u6d88\u8d39\u5c31\u4f1a\u6210\u4e3a\u6b7b\u4fe1\u3002\u5982\u679c\u540c\u65f6\u914d\u7f6e\u4e86\u961f\u5217\u7684 TTL \u548c\u6d88\u606f\u7684 TTL\uff0c\u90a3\u4e48\u8f83\u5c0f\u7684\u90a3\u4e2a\u503c\u5c06\u4f1a\u88ab\u4f7f\u7528\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_63","title":"\u4e24\u8005\u533a\u522b","text":"<p>\u5982\u679c\u8bbe\u7f6e\u4e86\u961f\u5217\u7684 TTL \u5c5e\u6027\uff0c\u90a3\u4e48\u4e00\u65e6\u6d88\u606f\u8fc7\u671f\uff0c\u5c31\u4f1a\u88ab\u961f\u5217\u4e22\u5f03\uff08\u5982\u679c\u914d\u7f6e\u4e86\u6b7b\u4fe1\u961f\u5217\u5219\u4f1a\u88ab\u4e22\u5230\u6b7b\u4fe1\u961f\u5217\uff09\u3002</p> <p>\u800c\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0c\u5373\u4f7f\u6d88\u606f\u8fc7\u671f\uff0c\u4e5f\u4e0d\u4e00\u5b9a\u4f1a\u88ab\u9a6c\u4e0a\u4e22\u5f03\uff0c\u56e0\u4e3a\u6d88\u606f\u662f\u5426\u8fc7\u671f\u662f\u5728\u5373\u5c06\u6295\u9012\u5230\u6d88\u8d39\u8005\u4e4b\u524d\u5224\u5b9a\u7684\uff0c\u5982\u679c\u5f53\u524d\u961f\u5217\u6709\u4e25\u91cd\u7684\u6d88\u606f\u79ef\u538b\u60c5\u51b5\uff0c\u5219\u5df2\u8fc7\u671f\u7684\u6d88\u606f\u4e5f\u8bb8\u8fd8\u80fd\u5b58\u6d3b\u8f83\u957f\u65f6\u95f4\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#114","title":"11.4 \u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_64","title":"\u5b89\u88c5\u63d2\u4ef6","text":"<ul> <li>https://www.rabbitmq.com/community-plugins.html</li> <li>https://github.com/rabbitmq/rabbitmq-delayed-message-exchange</li> </ul> <pre><code># \u67e5\u770b\u63d2\u4ef6\u76ee\u5f55\nrabbitmq-plugins directories\n\n# \u4e0b\u8f7d\u63d2\u4ef6\ncd /usr/lib/rabbitmq/lib/rabbitmq_server-3.9.13/plugins\nwget https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/download/3.9.0/rabbitmq_delayed_message_exchange-3.9.0.ez\n\n# \u542f\u7528\u63d2\u4ef6\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_65","title":"\u751f\u4ea7\u8005","text":"<pre><code>/**\n * \u5ef6\u8fdf\u961f\u5217-\u751f\u4ea7\u8005\n */\npublic class MyProducer {\n    static final String EXCHANGE = MyConsumer.EXCHANGE;\n    static final String ROUTING_KEY = MyConsumer.ROUTING_KEY;\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyProducer.class.getSimpleName(), true, channel -&gt; {\n            for (int i = 1; i &lt;= 10; i++) {\n                AMQP.BasicProperties headers = new AMQP.BasicProperties\n                    .Builder()\n                    .headers(Map.of(\"x-delay\", Long.toString(i * 1000L)))\n                    .build();\n                String body = i + \" \" + LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"));\n                channel.basicPublish(EXCHANGE, ROUTING_KEY, headers, body.getBytes());\n                System.out.printf(\"Sent message='%s'\\n\", body);\n                TimeUnit.MILLISECONDS.sleep(1000);\n            }\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_66","title":"\u6d88\u8d39\u8005","text":"<pre><code>/**\n * \u5ef6\u8fdf\u961f\u5217-\u6d88\u8d39\u8005\n */\npublic class MyConsumer {\n    static final String EXCHANGE = \"x.delayed.x-delayed-message\";\n    static final String QUEUE = \"q.delayed\";\n    static final String ROUTING_KEY = \"\";\n\n    public static void main(String[] args) {\n        MyRabbitMQ.start(MyConsumer.class.getSimpleName(), false, channel -&gt; {\n            channel.exchangeDelete(EXCHANGE);\n            Map&lt;String, Object&gt; arguments = Map.of(\"x-delayed-type\", \"direct\");\n            channel.exchangeDeclare(EXCHANGE, \"x-delayed-message\", false, false, arguments);\n\n            channel.queueDelete(QUEUE);\n            channel.queueDeclare(QUEUE, false, false, false, null);\n\n            channel.queueBind(QUEUE, EXCHANGE, ROUTING_KEY);\n\n            DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; {\n                String body = new String(delivery.getBody());\n                String at = LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"));\n                System.out.printf(\"Received message='%s' at='%s'\\n\", body, at);\n            };\n            channel.basicConsume(QUEUE, true, deliverCallback, consumerTag -&gt; { });\n        });\n    }\n}\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_67","title":"\u5341\u4e8c\u3001\u5e42\u7b49\u6027","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#121","title":"12.1 \u6982\u5ff5","text":"<p>\u7528\u6237\u5bf9\u4e8e\u540c\u4e00\u64cd\u4f5c\u53d1\u8d77\u7684\u4e00\u6b21\u8bf7\u6c42\u6216\u8005\u591a\u6b21\u8bf7\u6c42\u7684\u7ed3\u679c\u662f\u4e00\u81f4\u7684\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u591a\u6b21\u70b9\u51fb\u800c\u4ea7\u751f\u4e86\u526f\u4f5c\u7528\u3002</p> <p>\u4e3e\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u90a3\u5c31\u662f\u652f\u4ed8\uff0c\u7528\u6237\u8d2d\u4e70\u5546\u54c1\u540e\u652f\u4ed8\uff0c\u652f\u4ed8\u6263\u6b3e\u6210\u529f\uff0c\u4f46\u662f\u8fd4\u56de\u7ed3\u679c\u7684\u65f6\u5019\u7f51\u7edc\u5f02\u5e38\uff0c\u6b64\u65f6\u94b1\u5df2\u7ecf\u6263\u4e86\uff0c\u7528\u6237\u518d\u6b21\u70b9\u51fb\u6309\u94ae\uff0c\u6b64\u65f6\u4f1a\u8fdb\u884c\u7b2c\u4e8c\u6b21\u6263\u6b3e\uff0c\u8fd4\u56de\u7ed3\u679c\u6210\u529f\uff0c\u7528\u6237\u67e5\u8be2\u4f59\u989d\u53d1\u73b0\u591a\u6263\u94b1\u4e86\uff0c\u6d41\u6c34\u8bb0\u5f55\u4e5f\u53d8\u6210\u4e86\u4e24\u6761\u3002</p> <p>\u5728\u4ee5\u524d\u7684\u5355\u5e94\u7528\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a\u6570\u636e\u64cd\u4f5c\u653e\u5165\u4e8b\u7269\u4e2d\u5373\u53ef\uff0c\u53d1\u9001\u9519\u8bef\u7acb\u5373\u56de\u6eda\uff0c\u4f46\u662f\u518d\u54cd\u5e94\u5ba2\u6237\u7aef\u7684\u65f6\u5019\u4e5f\u6709\u53ef\u80fd\u51fa\u73b0\u7f51\u7edc\u7ec8\u7aef\u6216\u8005\u5f02\u5e38\u7b49\u7b49\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#122","title":"12.2 \u6d88\u606f\u91cd\u590d\u6d88\u8d39","text":"<p>\u6d88\u8d39\u8005\u5728\u6d88\u8d39 MQ \u4e2d\u7684\u6d88\u606f\u65f6\uff0cMQ \u5df2\u628a\u6d88\u606f\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\uff0c\u6d88\u8d39\u8005\u5728\u7ed9 MQ \u8fd4\u56de ACK \u65f6\u7f51\u7edc\u4e2d\u65ad\uff0c\u6545 MQ \u672a\u6536\u5230\u786e\u8ba4\u6d88\u606f\uff0c\u8be5\u6761\u6d88\u606f\u4f1a\u91cd\u65b0\u53d1\u7ed9\u5176\u5b83\u7684\u6d88\u8d39\u8005\uff0c\u6216\u8005\u5728\u7f51\u7edc\u91cd\u8fde\u540e\u518d\u6b21\u53d1\u9001\u7ed9\u8be5\u6d88\u8d39\u8005\uff0c\u4f46\u5b9e\u9645\u4e0a\u8be5\u6d88\u8d39\u8005\u5df2\u6210\u529f\u6d88\u8d39\u4e86\u8be5\u6761\u6d88\u606f\uff0c\u9020\u6210\u6d88\u8d39\u8005\u6d88\u8d39\u4e86\u91cd\u590d\u7684\u6d88\u606f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#123","title":"12.3 \u89e3\u51b3\u601d\u8def","text":"<p>MQ \u6d88\u8d39\u8005\u7684\u5e42\u7b49\u6027\u7684\u89e3\u51b3\u4e00\u822c\u4f7f\u7528\u5168\u5c40 ID \u6216\u8005\u5199\u4e2a\u552f\u4e00\u6807\u8bc6\u6bd4\u5982\u65f6\u95f4\u6233\u6216\u8005 UUID\uff0c\u6bcf\u6b21\u6d88\u8d39\u6d88\u606f\u65f6\u5148\u5224\u65ad\u8be5\u6d88\u606f\u662f\u5426\u5df2\u6d88\u8d39\u8fc7\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#124","title":"12.4 \u6d88\u8d39\u7aef\u7684\u5e42\u7b49\u6027\u4fdd\u969c","text":"<p>\u5728\u6d77\u91cf\u8ba2\u5355\u751f\u6210\u7684\u4e1a\u52a1\u9ad8\u5cf0\u671f\uff0c\u751f\u4ea7\u7aef\u6709\u53ef\u80fd\u5c31\u4f1a\u91cd\u590d\u53d1\u751f\u4e86\u6d88\u606f\uff0c\u8fd9\u65f6\u5019\u6d88\u8d39\u7aef\u5c31\u8981\u5b9e\u73b0\u5e42\u7b49\u6027\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u6211\u4eec\u7684\u6d88\u606f\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u6d88\u8d39\u591a\u6b21\u3002\u4e3b\u6d41\u7684\u5e42\u7b49\u6027\u64cd\u4f5c\u6709\u4e24\u79cd\uff1a</p> <ol> <li>\u552f\u4e00 ID + \u6307\u7eb9\u7801\u673a\u5236\uff1a\u4e1a\u52a1\u89c4\u5219\u62fc\u63a5\u552f\u4e00\u6807\u8bc6\uff0c\u5229\u7528\u6570\u636e\u5e93\u53bb\u91cd\uff1b</li> <li>Redis \u539f\u5b50\u6027\uff1a\u5229\u7528 Redis \u6267\u884c <code>SETNX</code> \u547d\u4ee4\uff1b</li> </ol>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_68","title":"\u5341\u4e09\u3001\u4f18\u5148\u7ea7\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#131","title":"13.1 \u6dfb\u52a0\u4f18\u5148\u7ea7","text":"<pre><code>Map&lt;String, Object&gt; arguments = Map.of(\"x-max-priority\", 10);\nchannel.queueDeclare(queue, durable, exclusive, autoDelete, arguments);\n\n// ...\n\nAMQP.BasicProperties props = new AMQP.BasicProperties\n    .Builder()\n    .priority(5)\n    .build();\nchannel.basicPublish(exchange, routingKey, props, body.getBytes());\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_69","title":"\u5341\u56db\u3001\u60f0\u6027\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#141","title":"14.1 \u4f7f\u7528\u573a\u666f","text":"<p>RabbitMQ \u4ece 3.6.0 \u7248\u672c\u5f00\u59cb\u5f15\u5165\u4e86\u60f0\u6027\u961f\u5217\u7684\u6982\u5ff5\uff0c\u60f0\u6027\u961f\u5217\u4f1a\u5c3d\u53ef\u80fd\u7684\u5c06\u6d88\u606f\u5b58\u5165\u78c1\u76d8\uff0c\u800c\u5728\u6d88\u8d39\u5230\u76f8\u5e94\u7684\u6d88\u606f\u65f6\u624d\u4f1a\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5b83\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u80fd\u591f\u652f\u6301\u66f4\u957f\u7684\u961f\u5217\uff0c\u5373\u652f\u6301\u66f4\u591a\u7684\u6d88\u606f\u5b58\u50a8\u3002\u5f53\u6d88\u8d39\u8005\u7531\u4e8e\u5404\u79cd\u5404\u6837\u7684\u539f\u56e0\uff08\u6bd4\u5982\u6d88\u8d39\u8005\u4e0b\u7ebf\uff0c\u5b95\u673a\uff0c\u4ea6\u6216\u8005\u662f\u7531\u4e8e\u7ef4\u62a4\u800c\u5173\u95ed\u7b49\uff09\u800c\u81f4\u4f7f\u957f\u65f6\u95f4\u5185\u4e0d\u80fd\u6d88\u8d39\u6d88\u606f\u9020\u6210\u5806\u79ef\u65f6\uff0c\u60f0\u6027\u961f\u5217\u5c31\u5f88\u6709\u5fc5\u8981\u4e86\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u751f\u4ea7\u8005\u5c06\u6d88\u606f\u53d1\u9001\u5230 RabbitMQ \u7684\u65f6\u5019\uff0c\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4f1a\u5c3d\u53ef\u80fd\u7684\u5b58\u50a8\u5728\u5185\u5b58\u4e4b\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u52a0\u5feb\u901f\u7684\u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\u3002\u5373\u4f7f\u662f\u6301\u4e45\u5316\u7684\u6d88\u606f\uff0c\u5728\u88ab\u5199\u5165\u78c1\u76d8\u7684\u540c\u65f6\u4e5f\u4f1a\u5728\u5185\u5b58\u4e2d\u9a7b\u7559\u4e00\u4efd\u5907\u4efd\u3002\u5f53 RabbitMQ \u9700\u8981\u91ca\u653e\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u5185\u5b58\u4e2d\u7684\u6d88\u606f\u6362\u9875\u81f3\u78c1\u76d8\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u8017\u8d39\u8f83\u957f\u7684\u5b9e\u9645\uff0c\u4e5f\u4f1a\u963b\u585e\u961f\u5217\u7684\u64cd\u4f5c\uff0c\u8fdb\u800c\u65e0\u6cd5\u63a5\u6536\u65b0\u7684\u6d88\u606f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#142","title":"14.2 \u8bbe\u7f6e\u60f0\u6027\u961f\u5217","text":"<pre><code>Map&lt;String, Object&gt; arguments = Map.of(\"x-queue-mode\", \"lazy\");\nchannel.queueDeclare(queue, durable, exclusive, autoDelete, arguments);\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_70","title":"\u5341\u4e94\u3001\u96c6\u7fa4","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#151-clustering","title":"15.1 Clustering","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_71","title":"\u4e09\u4e2a\u8282\u70b9","text":"<pre><code>192.192.192.101 ubuntu101\n192.192.192.102 ubuntu102\n192.192.192.103 ubuntu103\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_72","title":"\u5404\u8282\u70b9\u6b63\u5e38\u5b89\u88c5","text":"<pre><code>apt install rabbitmq-server -y --fix-missing\n</code></pre> <pre><code>rabbitmq-plugins enable rabbitmq_management\n\nrabbitmqctl add_user admin admin\n\nrabbitmqctl set_user_tags admin administrator\n\nrabbitmqctl set_permissions -p / admin \".*\" \".*\" \".*\"\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#erlangcookie","title":"\u786e\u4fdd\u5404\u51e0\u70b9\u7684<code>.erlang.cookie</code> \u76f8\u540c","text":"<p>\u6e05\u9664\u5404\u8282\u70b9\u7528\u6237\u7ea7\u7684 <code>.erlang.cookie</code>\uff1a</p> <pre><code>rm -rf ~/.erlang.cookie\n</code></pre> <p>\u540c\u6b65\u5404\u51e0\u70b9 RabbitMQ \u7684 <code>.erlang.cookie</code>\uff1a</p> <pre><code>scp /var/lib/rabbitmq/.erlang.cookie root@ubuntu102:/var/lib/rabbitmq/.erlang.cookie\n\nscp /var/lib/rabbitmq/.erlang.cookie root@ubuntu103:/var/lib/rabbitmq/.erlang.cookie\n</code></pre> <p>\u91cd\u542f\u670d\u52a1\uff1a</p> <pre><code>systemctl restart rabbitmq-server\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#ubuntu102ubuntu103","title":"\u52a0\u5165\u96c6\u7fa4\uff08<code>ubuntu102</code>\u3001<code>ubuntu103</code>\uff09","text":"<pre><code>rabbitmqctl stop_app\n\nrabbitmqctl reset\n\nrabbitmqctl join_cluster rabbit@ubuntu101\n\nrabbitmqctl start_app\n\nrabbitmqctl cluster_status\n</code></pre>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#152","title":"15.2 \u955c\u50cf\u961f\u5217","text":""},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_73","title":"\u539f\u56e0","text":"<p>\u5982\u679c RabbitMQ \u96c6\u7fa4\u53ea\u6709\u4e00\u4e2a Broker \u8282\u70b9\uff0c\u90a3\u4e48\u8be5\u8282\u70b9\u7684\u5931\u6548\u5c06\u5bfc\u81f4\u6574\u4f53\u670d\u52a1\u7684\u4e34\u65f6\u6027\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u4e5f\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u7684\u4e22\u5931\u3002</p> <p>\u53ef\u4ee5\u5c06\u6240\u6709\u6d88\u606f\u90fd\u8bbe\u7f6e\u4e3a\u6301\u4e45\u5316\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5bf9\u5e94\u961f\u5217\u7684\u6301\u4e45\u5316\uff0c\u4f46\u662f\u8fd9\u6837\u4ecd\u7136\u65e0\u6cd5\u907f\u514d\u7531\u4e8e\u7f13\u5b58\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6d88\u606f\u5728\u53d1\u9001\u4e4b\u540e\u548c\u88ab\u5199\u5165\u78c1\u76d8\u5e76\u6267\u884c\u5237\u76d8\u52a8\u4f5c\u4e4b\u95f4\u5b58\u5728\u4e00\u4e2a\u77ed\u6682\u4f46\u4f1a\u4ea7\u751f\u95ee\u9898\u7684\u65f6\u95f4\u7a97\u3002</p> <p>\u901a\u8fc7\u53d1\u5e03\u786e\u8ba4\u673a\u5236\u80fd\u591f\u786e\u8ba4\u5ba2\u6237\u7aef\u77e5\u9053\u54ea\u4e9b\u6d88\u606f\u5df2\u7ecf\u5b58\u5165\u78c1\u76d8\uff0c\u5c3d\u7ba1\u5982\u6b64\uff0c\u4e00\u822c\u4e0d\u5e0c\u671b\u9047\u5230\u56e0\u5355\u8282\u70b9\u6545\u969c\u5bfc\u81f4\u7684\u670d\u52a1\u4e0d\u53ef\u7528\u3002</p> <p>\u5f15\u5165\u955c\u50cf\u961f\u5217\u7684\u673a\u5236\uff0c\u53ef\u4ee5\u5c06\u961f\u5217\u955c\u50cf\u5230\u96c6\u7fa4\u4e2d\u7684\u5176\u5b83 Broker \u8282\u70b9\u4e4b\u4e0a\uff0c\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u5931\u6548\u4e86\uff0c\u961f\u5217\u80fd\u81ea\u52a8\u5207\u6362\u5230\u955c\u50cf\u4e2d\u7684\u53e6\u4e00\u4e2a\u8282\u70b9\u4ee5\u4fdd\u8bc1\u670d\u52a1\u7684\u53ef\u7528\u6027\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_74","title":"\u642d\u5efa\u6b65\u9aa4","text":"<p>\u5176\u4e2d <code>Pattern</code> \u662f\u5339\u914d\u961f\u5217\u540d\u79f0\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"middleware/rabbitmq/RabbitMQ%20%E7%AC%94%E8%AE%B0/#_75","title":"\u6548\u679c","text":""},{"location":"middleware/rabbitmq/__demo__/spring-boot-rabbitmq-demo/","title":"Spring Boot \u6574\u5408 RabbitMQ","text":""},{"location":"middleware/shardingsphere/","title":"ShardingSphere","text":""},{"location":"middleware/shardingsphere/__demo__/shardingsphere-demo/shardingshpere-jdbc-demo-01/","title":"Index","text":""},{"location":"middleware/shardingsphere/__demo__/shardingsphere-demo/shardingshpere-jdbc-demo-01/#shardingsphere-jdbc","title":"ShardingSphere JDBC \u8bfb\u5199\u5206\u79bb","text":""},{"location":"middleware/shardingsphere/__demo__/shardingsphere-demo/shardingshpere-jdbc-demo-01/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"middleware/shardingsphere/__demo__/shardingsphere-demo/shardingshpere-jdbc-demo-01/#springboot-with-jpa-readwrite-splitting-always-on-write-ds-15629","title":"Springboot with JPA, readwrite-splitting always on write-ds #15629","text":"<p>\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u6e90\u662f Spring Data JPA \u9ed8\u8ba4\u6240\u6709\u65b9\u6cd5\u90fd\u4f7f\u7528\u4e86\u4e8b\u52a1\uff0c\u5f53\u7136\u67e5\u8be2\u662f\u53ea\u8bfb\u4e8b\u52a1\uff0c\u800c ShardingSphere \u5224\u65ad\u4f7f\u7528\u4e86\u4e8b\u52a1\u5c31\u8d70\u4e3b\u5e93\u3002</p>"},{"location":"monitoring/","title":"Monitoring","text":""},{"location":"monitoring/#telegraf","title":"Telegraf","text":""},{"location":"monitoring/#telegraf-prometheus","title":"\u5c06 Telegraf \u66b4\u9732\u4e3a Prometheus \u6570\u636e\u683c\u5f0f","text":"<ul> <li> <p><code>telegraf.conf</code></p> <pre><code>[[inputs.cpu]]\n  percpu = true\n  totalcpu = true\n  collect_cpu_time = false\n  report_active = false\n  core_tags = false\n\n[[outputs.file]]\n  files = [\"stdout\"]\n\n[[outputs.prometheus_client]]\n  listen = \":9273\"\n</code></pre> </li> <li> <p><code>telegraf --config telegraf.conf</code></p> </li> <li><code>curl http://localhost:9273/metrics</code></li> </ul>"},{"location":"monitoring/#prometheus-influxdb","title":"Prometheus \u8fdc\u7aef\u5b58\u50a8\u5230 InfluxDB","text":"<ul> <li> <p><code>telegraf.conf</code></p> <pre><code>[[inputs.http_listener_v2]]\n  service_address = \":1234\"\n  paths = [\"/receive\"]\n  data_format = \"prometheusremotewrite\"\n\n[[outputs.influxdb_v2]]\n  urls = [\"http://192.192.192.6:8086\"]\n  token = \"cL3fFaCMjyEuzU7Bs0uXDApAovt934Y5oE22keyVFHQS1_ELriSLQ6Jneg-bJTVPpHXPddmGENbS6YwwuV9lrw==\"\n  organization = \"admin\"\n  bucket = \"prometheus\"\n</code></pre> </li> <li> <p><code>prometheus.yml</code></p> <pre><code>global:\n  scrape_timeout: 10s\n  scrape_interval: 10s\n  evaluation_interval: 10s\n\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['192.192.192.6:9090']\n  - job_name: 'pushgateway'\n    static_configs:\n      - targets: ['192.192.192.6:9091']\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['192.192.192.6:9100']\n  - job_name: 'cadvisor'\n    static_configs:\n      - targets: ['192.192.192.6:8080']\n\nremote_write:\n  - url: 'http://192.192.192.6:1234/receive'\n</code></pre> </li> </ul>"},{"location":"monitoring/Telegraf/","title":"Telegraf","text":""},{"location":"monitoring/Telegraf/#telegraf_1","title":"\u4e00\u3001\u8ba4\u8bc6 Telegraf","text":"<p>Telegraf \u662f\u4e00\u4e2a\u57fa\u4e8e\u63d2\u4ef6\u7684\u5f00\u6e90\u6307\u6807\u91c7\u96c6\u5de5\u5177\u3002\u672c\u8eab\u662f\u4e3a InfluxDB\uff08\u4e00\u6b3e\u65f6\u5e8f\u6570\u636e\u5e93\uff09\u91cf\u8eab\u6253\u9020\u7684\u6570\u636e\u6536\u96c6\u5668\uff0c\u4f46\u662f\u5b83\u8fc7\u4e8e\u4f18\u79c0\uff0c\u80fd\u591f\u5c06\u6293\u53d6\u7684\u6570\u636e\u5199\u5230\u5f88\u591a\u5730\u65b9\uff0c\u5c24\u5176\u5728\u65f6\u5e8f\u6570\u636e\u5e93\u9886\u57df\uff0c\u5f88\u591a\u65f6\u5e8f\u6570\u636e\u5e93\u90fd\u80fd\u591f\u4e0e\u5b83\u914d\u5408\u4f7f\u7528\u3002\u901a\u5e38\uff0c\u5b83\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u6293\u53d6\u4e00\u6279\u6307\u6807\u6570\u636e\uff08\u6bd4\u5982\u673a\u5668\u7684 CPU \u4f7f\u7528\u60c5\u51b5\uff0c\u78c1\u76d8\u7684 IO\uff0c\u7f51\u7edc\u60c5\u51b5\uff0cMySQL \u670d\u52a1\u7aef\u7684\u4f1a\u8bdd\u6570\u7b49\u7b49\uff09\u5e76\u5c06\u4ed6\u4eec\u53d1\u9001\u5230\u65f6\u5e8f\u6570\u636e\u5e93\u3001\u6d88\u606f\u961f\u5217\u6216\u8005\u81ea\u5b9a\u4e49\u5bfc\u51fa\u5230\u67d0\u4e2a\u5730\u65b9\uff0c\u4f9b\u4e0b\u6e38\u7684\u5e94\u7528\u5904\u7406\uff08\u6bd4\u5982\u62a5\u8b66\uff09\u3002Telegraf \u4e5f\u80fd\u591f\u5bf9\u5916\u63d0\u4f9b\u4e00\u4e2a\u670d\u52a1\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u63a8\u9001\u6570\u636e\u3002</p> <p>\u5b83\u4e0e Logstash \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7 Logstash \u662f\u6536\u96c6\u65e5\u5fd7\u7684\uff0cTelegraf \u662f\u6536\u96c6\u6307\u6807\u7684\u3002</p> <p> </p>"},{"location":"monitoring/Telegraf/#telegraf_2","title":"\u4e8c\u3001\u5b89\u88c5\u90e8\u7f72 Telegraf","text":"<p>https://portal.influxdata.com/downloads/</p> <pre><code>wget https://dl.influxdata.com/telegraf/releases/telegraf-1.26.0_linux_arm64.tar.gz\ntar xf telegraf-1.26.0_linux_arm64.tar.gz\nmv telegraf-1.26.0 telegraf\n</code></pre> <pre><code>cd telegraf\ntree -F\n</code></pre> <pre><code>./\n\u251c\u2500\u2500 etc/\n\u2502   \u251c\u2500\u2500 logrotate.d/\n\u2502   \u2502   \u2514\u2500\u2500 telegraf\n\u2502   \u2514\u2500\u2500 telegraf/\n\u2502       \u251c\u2500\u2500 telegraf.conf\n\u2502       \u2514\u2500\u2500 telegraf.d/\n\u251c\u2500\u2500 usr/\n\u2502   \u251c\u2500\u2500 bin/\n\u2502   \u2502   \u2514\u2500\u2500 telegraf*\n\u2502   \u2514\u2500\u2500 lib/\n\u2502       \u2514\u2500\u2500 telegraf/\n\u2502           \u2514\u2500\u2500 scripts/\n\u2502               \u251c\u2500\u2500 init.sh*\n\u2502               \u2514\u2500\u2500 telegraf.service\n\u2514\u2500\u2500 var/\n    \u2514\u2500\u2500 log/\n        \u2514\u2500\u2500 telegraf/\n</code></pre> <p> </p>"},{"location":"monitoring/Telegraf/#telegraf_3","title":"\u4e09\u3001\u5feb\u901f\u5165\u95e8 Telegraf","text":""},{"location":"monitoring/Telegraf/#31","title":"3.1 \u5355\u8f93\u5165\u8f93\u51fa\u5de5\u4f5c\u6d41","text":"<ul> <li> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vim etc/telegraf/telegraf.d/example01.conf\n</code></pre> <pre><code>[agent]\n  interval = \"3s\"\n\n[[inputs.cpu]]\n  percpu = true\n  totalcpu = true\n  collect_cpu_time = false\n  report_active = false\n  core_tags = false\n\n[[outputs.file]]\n  files = [\"stdout\"]\n</code></pre> </li> <li> <p>\u8fd0\u884c Telegraf</p> <pre><code>usr/bin/telegraf --config etc/telegraf/telegraf.d/example01.conf\n</code></pre> <p></p> </li> </ul>"},{"location":"monitoring/Telegraf/#32","title":"3.2 \u914d\u7f6e\u6587\u4ef6\u542b\u4e49","text":"<p><code>example01.conf</code> \u914d\u7f6e\u6587\u4ef6\u6d89\u53ca\u5230 3 \u4e2a\u914d\u7f6e\u5757\u3002</p> <ul> <li><code>[agent]</code> \u8fd9\u91cc\u9762\u662f\u4e00\u4e9b\u6d89\u53ca\u5168\u5c40\u7684\u914d\u7f6e\u3002\u6b64\u5904\u6211\u4eec\u8bbe\u7f6e <code>interval=\"3s\"</code>\u610f\u601d\u662f\u8ba9\u914d\u7f6e\u6587\u4ef6\u4e2d\u6240\u6709 input \u63d2\u4ef6\u6bcf\u9694 3 \u79d2\u53bb\u91c7\u96c6\u4e00\u6b21\u6307\u6807\u3002<code>interval</code> \u7684\u9ed8\u8ba4\u503c\u662f 10 \u79d2\u3002</li> <li><code>[[inputs.cpu]]</code> \u8fd9\u662f\u4e00\u4e2a input \u8f93\u5165\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u7684\u914d\u7f6e\u662f\u8bf4\u6211\u4eec\u5bfc\u51fa\u7684\u6307\u6807\u4f1a\u5305\u542b\u6bcf\u4e00\u4e2a CPU \u6838\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u800c\u4e14\u8fd8\u5305\u542b\u6240\u6709 CPU \u603b\u7684\u4f7f\u7528\u60c5\u51b5\u3002</li> <li><code>[[outputs.file]]</code> \u8fd9\u662f\u4e00\u4e2a output \u8f93\u51fa\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u7528\u4e86\u4e00\u4e2a\u540d\u4e3a <code>file</code> \u7684\u8f93\u51fa\u7ec4\u4ef6\uff0c\u4e0d\u8fc7 <code>files</code> \u53c2\u6570\u8bbe\u4e3a\u4e86 <code>stdout</code>\uff08\u6807\u51c6\u8f93\u51fa\uff09\u4e5f\u5c31\u662f\u63a7\u5236\u53f0\uff0c\u8fd9\u6837\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u6211\u4eec\u5e94\u8be5\u53ef\u4ee5\u770b\u5230\u6570\u636e\u6253\u5370\u5728\u63a7\u5236\u53f0\u4e0a\u3002</li> </ul> <p></p>"},{"location":"monitoring/Telegraf/#33","title":"3.3 \u6570\u636e\u8f93\u51fa","text":"<ul> <li> <p>InfluxDB \u884c\u534f\u8bae</p> <pre><code>cpu,cpu=cpu0,host=vm006 usage_system=1.0033444816036312,usage_idle=97.65886287602467,usage_softirq=0,usage_steal=0,usage_guest_nice=0,usage_user=1.3377926421388087,usage_iowait=0,usage_irq=0,usage_guest=0,usage_nice=0 1680181074000000000\ncpu,cpu=cpu1,host=vm006 usage_system=0.6711409395992614,usage_steal=0,usage_guest=0,usage_guest_nice=0,usage_user=0.3355704697996307,usage_idle=98.65771812101512,usage_nice=0,usage_iowait=0,usage_irq=0,usage_softirq=0.3355704697999287 1680181074000000000\ncpu,cpu=cpu-total,host=vm006 usage_idle=98.16053511704587,usage_iowait=0,usage_softirq=0,usage_guest_nice=0,usage_user=1.0033444816070234,usage_nice=0,usage_irq=0,usage_steal=0,usage_guest=0,usage_system=0.8361204013385525 1680181074000000000\ncpu,cpu=cpu0,host=vm006 usage_system=1.0101010101006525,usage_nice=0,usage_iowait=0,usage_softirq=0,usage_guest=0,usage_guest_nice=0,usage_user=1.346801346799594,usage_idle=97.64309764310836,usage_irq=0,usage_steal=0 1680181077000000000\ncpu,cpu=cpu1,host=vm006 usage_user=2.6936026936030157,usage_system=1.0101010101016095,usage_nice=0,usage_iowait=0,usage_guest=0,usage_guest_nice=0,usage_idle=96.29629629627814,usage_irq=0,usage_softirq=0,usage_steal=0 1680181077000000000\ncpu,cpu=cpu-total,host=vm006 usage_user=2.0168067226901387,usage_steal=0,usage_guest_nice=0,usage_iowait=0.16806722689086478,usage_irq=0,usage_softirq=0,usage_guest=0,usage_system=1.176470588235755,usage_idle=96.63865546223214,usage_nice=0 1680181077000000000\n</code></pre> </li> </ul> <p> </p>"},{"location":"monitoring/Telegraf/#telegraf_4","title":"\u56db\u3001Telegraf \u5185\u90e8\u6570\u636e\u7ed3\u6784","text":"<p>Telegraf \u7684\u672c\u8eab\u662f InfluxData \u516c\u53f8\u4e13\u95e8\u4e3a InfluxDB \u5f00\u53d1\u7684\u6570\u636e\u91c7\u96c6\u5668\u3002\u4e0a\u9762\u8fd9\u79cd\u6570\u636e\u683c\u5f0f\u5e08 InfluxDB \u6570\u636e\u5e93\u4f7f\u7528\u7684\uff0c\u53ea\u8981\u6570\u636e\u7b26\u5408\u4e0a\u9762\u8fd9\u79cd\u683c\u5f0f\uff0c\u5c31\u80fd\u901a\u8fc7 InfluxDB \u7684 API \u5c06\u6570\u636e\u5bfc\u5165\u6570\u636e\u5e93\u3002</p>"},{"location":"monitoring/Telegraf/#41-influxdb","title":"4.1 InfluxDB \u884c\u534f\u8bae","text":"<ol> <li> <p>Measurement\uff08\u6d4b\u91cf\u540d\u79f0\uff09\uff08\u5fc5\u987b\uff09</p> </li> <li> <p>Tag Set\uff08\u6807\u7b7e\u96c6\uff09\uff08\u53ef\u9009\uff09</p> <p>\u6807\u7b7e\u5e94\u8be5\u7528\u5728\u4e00\u4e9b\u503c\u8303\u56f4\u6709\u9650\uff0c\u4e0d\u592a\u4f1a\u53d8\u52a8\u7684\u5c5e\u6027\u4e0a\u3002\u6bd4\u5982\u4f20\u611f\u5668\u7684\u7c7b\u578b\u548c ID \u7b49\u7b49\u3002\u5728 InfluxDB \u4e2d\u4e00\u4e2a Tag \u76f8\u5f53\u4e8e\u4e00\u4e2a\u7d22\u5f15\uff0c\u7ed9\u6570\u636e\u70b9\u52a0\u4e0a Tag \u6709\u5229\u4e8e\u5c06\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u7d22\uff0c\u4f46\u662f\u5982\u679c\u7d22\u5f15\u592a\u591a\u4e86\u5c31\u4f1a\u51cf\u6162\u6570\u636e\u7684\u63d2\u5165\u901f\u5ea6\u3002</p> </li> <li> <p>Field Set\uff08\u5b57\u6bb5\u96c6\uff09\uff08\u5fc5\u987b\uff09</p> </li> <li> <p>Timestamp\uff08\u65f6\u95f4\u6233\uff09\uff08\u53ef\u9009\uff09</p> <p>\u5982\u679c\u65f6\u95f4\u6233\u6ca1\u6709\u6307\u5b9a\uff0c\u90a3\u4e48 InfluxDB \u5c31\u4f7f\u7528\u5f53\u524d\u7cfb\u7edf\u7684\u65f6\u95f4\u6233\u3002\u5982\u679c\u6570\u636e\u91cc\u7684\u65f6\u95f4\u6233\u4e0d\u662f\u4ee5\u7eb3\u79d2\u4e3a\u5355\u4f4d\u989d\uff0c\u90a3\u4e48\u9700\u8981\u518d\u6570\u636e\u5199\u5165\u65f6\u6307\u5b9a\u65f6\u95f4\u6233\u7684\u7cbe\u5ea6\u3002</p> </li> </ol> <p></p>"},{"location":"monitoring/Telegraf/#42","title":"4.2 \u534f\u8bae\u4e2d\u7684\u6570\u636e\u7c7b\u578b\u53ca\u5176\u683c\u5f0f","text":"<ol> <li> <p>\u6d6e\u70b9\u6570</p> <p>IEEE-754 \u6807\u51c6\u7684 64 \u4f4d\u6d6e\u70b9\u6570\uff0c\u8fd9\u662f\u9ed8\u8ba4\u7684\u6570\u636e\u7c7b\u578b\u3002</p> </li> <li> <p>\u6709\u7b26\u53f7\u6574\u6570</p> <p>\u6709\u7b26\u53f7 64 \u4f4d\u6574\u6570\uff0c\u9700\u8981\u518d\u6570\u5b57\u7684\u5c3e\u90e8\u52a0\u4e0a\u4e00\u4e2a\u5c0f\u5199 <code>i</code>\u3002</p> </li> <li> <p>\u65e0\u7b26\u53f7\u6574\u6570</p> <p>\u65e0\u7b26\u53f7\u7684 64 \u4f4d\u6574\u6570\uff0c\u9700\u8981\u5728\u6570\u5b57\u7684\u5c3e\u90e8\u52a0\u4e0a\u4e00\u4e2a\u5c0f\u5199 <code>u</code>\u3002</p> </li> <li> <p>\u5b57\u7b26\u4e32</p> <p>\u666e\u901a\u6587\u672c\u5b57\u7b26\u4e32\uff0c\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7 64 KB\u3002</p> </li> <li> <p>\u5e03\u5c14\u503c</p> </li> <li> <p>\u65f6\u95f4\u6233</p> </li> <li> <p>\u6ce8\u91ca</p> <p>\u4ee5 <code>#</code> \u5f00\u5934\u7684\u4e00\u884c\u4f1a\u88ab\u5f53\u505a\u6ce8\u91ca\u3002</p> </li> </ol> <p> </p>"},{"location":"monitoring/Telegraf/#telegraf_5","title":"\u4e94\u3001Telegraf \u67b6\u6784","text":""},{"location":"monitoring/Telegraf/#51","title":"5.1 \u8d23\u4efb\u94fe\u8bbe\u8ba1\u6a21\u5f0f","text":"<p>Telegraf \u662f\u5178\u578b\u7684 Pipeline\uff08\u6d41\u6c34\u7ebf\u6216\u7ba1\u9053\uff09\u67b6\u6784\uff0c\u8fd9\u79cd\u67b6\u6784\u4f7f\u7528\u4e86\u8d23\u4efb\u94fe\u8bbe\u8ba1\u6a21\u5f0f\u7684\u601d\u60f3\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u7684\u5173\u952e\u70b9\u5c31\u5728\u201d\u94fe\u201c\u8fd9\u4e2a\u5b57\u4e0a\uff0c\u4ee3\u7801\u7684\u529f\u80fd\u88ab\u62c6\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u72ec\u7acb\u7684\u7ec4\u4ef6\uff0c\u800c\u4e14\u80fd\u591f\u6839\u636e\u9700\u6c42\uff0c\u7075\u6d3b\u7684\u7ec4\u5408\u3002</p> <p></p>"},{"location":"monitoring/Telegraf/#52-pipeline","title":"5.2 Pipeline \u67b6\u6784","text":"<p>Telegraf \u5c06\u8f93\u51fa\u7684\u5904\u7406\u6d41\u7a0b\u62bd\u8c61\u4e3a\u7531\u591a\u4e2a\u63d2\u4ef6\u7ec4\u6210\u7684\u6d41\u6c34\u7ebf\uff0c\u63d2\u4ef6\u548c\u63d2\u4ef6\u4e4b\u95f4\u7528\u7ba1\u9053\u76f8\u8fde\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5148\u8fdb\u5148\u51fa\u7684\u961f\u5217\uff09\uff0c\u8fd9\u79cd\u67b6\u6784\u81f3\u5c11\u80fd\u4f53\u73b0\u51fa\u4e24\u79cd\u4f18\u52bf\uff1a</p> <ul> <li>\u63d2\u4ef6\u548c\u63d2\u4ef6\u4e4b\u95f4\u5b9e\u73b0\u4e86\u677e\u8026\u5408\uff0c\u4e0b\u4e00\u4e2a\u63d2\u4ef6\u53ef\u4ee5\u4e0d\u7528\u7ba1\u4e0a\u4e00\u4e2a\u63d2\u4ef6\u7684\u5185\u90e8\u903b\u8f91\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u53ea\u8981\u6309\u7167\u7ea6\u5b9a\u597d\u7684\u683c\u5f0f\u4f20\u9012\u6570\u636e\u5c31\u884c\u3002</li> <li>\u6d41\u7a0b\u914d\u7f6e\u5316\uff0c\u8c01\u548c\u8c01\u7ec4\u5408\u7684\u51b3\u5b9a\u53ef\u4ee5\u63a8\u8fdf\u5230\u8fd0\u884c\u65f6\u51b3\u5b9a\uff0c\u800c\u4e0d\u662f\u5f00\u53d1\u4eba\u5458\u5fc5\u987b\u5728\u5f00\u53d1\u65f6\u5c31\u628a\u5404\u79cd\u5904\u7406\u6d41\u7a0b\u5199\u6b7b\uff0c\u76f8\u5f53\u4e8e\u4ea4\u7ed9\u4e86\u7528\u6237\u4e00\u5806\u79ef\u6728\u3002</li> </ul> <p>\u901a\u5e38\u7684 Pipeline \u67b6\u6784\uff0c\u9664\u4e86\u8981\u914d\u7f6e\u63d2\u4ef6\u548c\u7ec4\u5408\u987a\u5e8f\u5916\uff0c\u8fd8\u4f1a\u5305\u62ec\u4e00\u5c42\u4e0a\u4e0b\u6587\u914d\u7f6e\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u5e38\u89c1 Pipeline \u67b6\u6784\u662f\u5982\u4e0b\u56fe\u6240\u793a\u7684\u3002</p> <p></p> <p></p>"},{"location":"monitoring/Telegraf/#53-telegraf","title":"5.3 Telegraf \u5b9e\u73b0","text":""},{"location":"monitoring/Telegraf/#531","title":"5.3.1 \u67b6\u6784\u89d2\u5ea6","text":"<p>Telegraf \u5185\u90e8\u8bbe\u8ba1\u4e86 4 \u79cd\u7c7b\u578b\u7684\u63d2\u4ef6\uff0c\u5b83\u4eec\u5fc5\u987b\u6309\u7167\u7279\u5b9a\u7684\u987a\u5e8f\u8fdb\u884c\u7ec4\u5408\uff1a</p> <ol> <li> <p>\u8f93\u5165\u63d2\u4ef6</p> </li> <li> <p>\u5904\u7406\u63d2\u4ef6</p> </li> <li> <p>\u805a\u5408\u63d2\u4ef6</p> </li> <li> <p>\u8f93\u51fa\u63d2\u4ef6</p> </li> </ol> <p>\u5e76\u4e14\u63d2\u4ef6\u4e4b\u95f4\u6846\u67b6\u662f\u5982\u4f55\u63a7\u5236\u5b83\u4eec\u4f20\u503c\u7684\uff0c\u8fd9\u4e00\u70b9\u4e5f\u6709\u7279\u522b\u7684\u7ea6\u5b9a\uff1a</p> <ul> <li>\u6240\u6709\u7684 input \u63d2\u4ef6\u4f1a\u5c06\u6570\u636e\u653e\u5165\u540c\u4e00\u4e2a\u7ba1\u9053\uff1b</li> <li>\u6240\u6709\u7684 processor \u63d2\u4ef6\u4f1a\u6309\u5148\u540e\u987a\u5e8f\u4f20\u9012\u6570\u636e\uff08\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5fc5\u987b\u663e\u5f0f\u5730\u6307\u5b9a\u987a\u5e8f\uff0c\u5426\u5219 processor \u4e4b\u95f4\u4f1a\u4ee5\u968f\u673a\u987a\u5e8f\u7ec4\u5408\uff09\uff1b</li> <li>aggregator \u524d\u7684\u7ba1\u9053\u4f1a\u628a\u6570\u636e\u590d\u5236\u7ed9\u6240\u6709\u7684 aggregator \u63d2\u4ef6\uff0c\u4e0d\u8fc7 Telegraf \u8fd8\u4e3a\u63d2\u4ef6\u4eec\u8bbe\u8ba1\u4e86\u6307\u6807\u8fc7\u6ee4\u5668\uff0c\u63d2\u4ef6\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u63a5\u6536\u90e8\u5206\u6570\u636e\uff1b</li> <li>output \u524d\u7684\u7ba1\u9053\u4e5f\u4f1a\u5c06\u6570\u636e\u590d\u5236\u7ed9\u6240\u6709\u7684 output \u7ec4\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fc7\u6ee4\u5668\u7ec4\u4ef6\u9009\u62e9\u6027\u5730\u63a5\u6536\u3002</li> </ul>"},{"location":"monitoring/Telegraf/#532","title":"5.3.2 \u6027\u80fd\u89d2\u5ea6","text":"<p>Telegraf \u4f7f\u7528 Go \u8bed\u8a00\u5f00\u53d1\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u90fd\u662f\u5185\u90e8\u7ec4\u4ef6\uff0c\u90a3\u4e48\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7684 goroutine\u3002</p>"},{"location":"network/","title":"\u8ba1\u7b97\u673a\u7f51\u7edc","text":""},{"location":"network/#_2","title":"\u6536\u85cf","text":""},{"location":"network/#-tcp","title":"\u4e24\u5f20\u52a8\u56fe-\u5f7b\u5e95\u660e\u767d TCP \u7684\u4e09\u6b21\u63e1\u624b\u4e0e\u56db\u6b21\u6325\u624b","text":""},{"location":"network/#kdevtmpfsi","title":"\u8bb0\u4e00\u6b21\u670d\u52a1\u5668\u88ab kdevtmpfsi \u53d8\u77ff\u673a","text":""},{"location":"os/","title":"\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"os/android/","title":"Android","text":""},{"location":"os/android/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/","title":"\u73af\u5883\u914d\u7f6e","text":""},{"location":"os/android/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/#gradle","title":"Gradle","text":""},{"location":"os/android/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/#_1","title":"\u73af\u5883\u53d8\u91cf","text":"<pre><code># export M2_HOME=/d/env/maven-3.6.3\n\nexport GRADLE_USER_HOME=/d/env/repository\n</code></pre> <p><code>mavenLocal()</code> \u67e5\u627e\u987a\u5e8f\uff1a<code>${USER_HOME}/.m2/settings.xml</code>\u3001<code>${M2_HOME}/conf/settings.xml</code>\u3001<code>${USER_HOME}/.m2/repository</code></p>"},{"location":"os/android/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/#_2","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li> <p><code>${GRADLE_USER_HOME}/init.gradle</code></p> <p>\u9879\u76ee\u4e2d\u4e0d\u914d\u7f6e <code>repositories</code> \u65f6\u7684\u9ed8\u8ba4\u6e90</p> <pre><code>initscript {\n    repositories {\n        mavenLocal()\n        maven { url(\"https://maven.aliyun.com/repository/public\") }\n        maven { url(\"https://maven.aliyun.com/repository/google\") }\n        maven { url(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring-plugin\") }\n    }\n}\n\nbuildscript {\n    repositories {\n        mavenLocal()\n        maven { url(\"https://maven.aliyun.com/repository/public\") }\n        maven { url(\"https://maven.aliyun.com/repository/google\") }\n        maven { url(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring-plugin\") }\n    }\n}\nallprojects {\n    repositories {\n        mavenLocal()\n        maven { url(\"https://maven.aliyun.com/repository/public\") }\n        maven { url(\"https://maven.aliyun.com/repository/google\") }\n        maven { url(\"https://maven.aliyun.com/repository/gradle-plugin\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring\") }\n        maven { url(\"https://maven.aliyun.com/repository/spring-plugin\") }\n    }\n}\n</code></pre> </li> <li> <p><code>gradle/wrapper/gradle-wrapper.properties</code></p> <pre><code>distributionBase=GRADLE_USER_HOME\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-6.7.1-bin.zip\ndistributionPath=wrapper/dists\nzipStorePath=wrapper/dists\nzipStoreBase=GRADLE_USER_HOME\n</code></pre> </li> </ul>"},{"location":"os/android/__homework__/homework-third-questionnaire/questionnaire/","title":"Index","text":""},{"location":"os/android/__homework__/homework-third-questionnaire/questionnaire/#db","title":"DB","text":"<pre><code>docker-compose -f ./db/docker/docker-compose.yml up -d\n</code></pre>"},{"location":"os/android/__homework__/homework-third-questionnaire/questionnaire/#swagger","title":"Swagger","text":"<pre><code>http://localhost:9000/doc.html\n</code></pre>"},{"location":"os/android/__homework__/homework-third-questionnaire/questionnaire/#types","title":"Types","text":"<p><code>src/main/resources/fontend/types.ts</code></p>"},{"location":"os/ftp/","title":"FTP","text":""},{"location":"os/ftp/#_1","title":"\u6536\u85cf","text":""},{"location":"os/ftp/#ftp-port-pasv","title":"FTP \u7684 PORT\uff08\u4e3b\u52a8\u6a21\u5f0f\uff09\u548c PASV\uff08\u88ab\u52a8\u6a21\u5f0f\uff09","text":""},{"location":"os/linux/","title":"Linux","text":""},{"location":"os/linux/#_1","title":"\u955c\u50cf\u6e90","text":""},{"location":"os/linux/#_2","title":"\u4e2d\u79d1\u5927","text":"<p>\u914d\u7f6e\u751f\u6210\u5668</p>"},{"location":"os/linux/#_3","title":"\u6536\u85cf","text":"<ul> <li> <p>\u5c06\u76f8\u5bf9\u8def\u5f84\u5b58\u5165\u53d8\u91cf</p> <pre><code>export SAME_IMAGE=$(cd ../../same-image &amp;&amp; pwd)\n</code></pre> </li> <li> <p>\u67e5\u770b\u7aef\u53e3\u5360\u7528\u53ca\u8fdb\u7a0b</p> <pre><code>netstat -tulnep\n</code></pre> </li> <li> <p>\u521b\u5efa\u4ea4\u6362\u5206\u533a</p> <pre><code>sudo fallocate --length 8G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\necho '/swapfile swap swap defaults 0 0' | sudo tee -a /etc/fstab\n</code></pre> </li> </ul>"},{"location":"os/linux/#systemv-systemd","title":"systemV \u548c systemd \u7684\u7406\u89e3","text":""},{"location":"os/linux/#linux-xfs","title":"Linux \u6587\u4ef6\u7cfb\u7edf-XFS \u6536\u7f29\u4e0e\u6269\u5c55","text":""},{"location":"os/linux/#ext4-xfs","title":"ext4 \u548c xfs \u6587\u4ef6\u7cfb\u7edf\u7684\u6269\u5bb9\u548c\u6536\u7f29","text":""},{"location":"os/linux/#sed-_linux-sed","title":"sed \u5220\u9664\u67d0\u4e00\u884c_linux -- sed \u547d\u4ee4","text":""},{"location":"os/linux/#shell-getopt","title":"\u8bbe\u8ba1 shell \u811a\u672c\u9009\u9879\uff1agetopt\uff08\u8f6c\uff09","text":""},{"location":"os/linux/#kernelnmi-watchdog-bug-soft-lockup-cpu0-stuck-for-26s","title":"\u62a5\u9519 kernel:NMI watchdog: BUG: soft lockup - CPU#0 stuck for 26s","text":""},{"location":"os/linux/#linux-3","title":"Linux \u4e0b 3 \u79cd\u5e38\u7528\u7684\u7f51\u7edc\u6d4b\u901f\u5de5\u5177","text":""},{"location":"os/linux/#linux_1","title":"linux \u7f51\u72b6\u4e92\u4fe1\u7684\u5904\u7406\u65b9\u6cd5","text":""},{"location":"os/linux/#bash-joinmap-filter","title":"Bash \u7248\u7684 join,map \u548c filter","text":""},{"location":"os/linux/#linux_2","title":"Linux \u78c1\u76d8\u7a7a\u95f4\u5360\u6ee1\uff0c\u4f46\u641c\u4e0d\u5230\u5927\u6587\u4ef6","text":""},{"location":"os/linux/#ssh","title":"ssh \u6279\u91cf\u514d\u5bc6\u767b\u5f55","text":""},{"location":"os/linux/Bash%20%E8%8E%B7%E5%8F%96%20GitHub%20%E6%9C%80%E6%96%B0%20Release%20%E7%89%88%E6%9C%AC%E5%8F%B7/","title":"Bash \u83b7\u53d6 GitHub \u6700\u65b0 Release \u7248\u672c\u53f7","text":""},{"location":"os/linux/Bash%20%E8%8E%B7%E5%8F%96%20GitHub%20%E6%9C%80%E6%96%B0%20Release%20%E7%89%88%E6%9C%AC%E5%8F%B7/#nerdctl","title":"\u4e0b\u8f7d\u6700\u65b0\u7248 nerdctl","text":"<pre><code>REPO=\"containerd/nerdctl\"\nTAG=$(curl -fsSL \"https://api.github.com/repos/${REPO}/releases/latest\" | jq -r \".tag_name\")\nASSET=\"nerdctl-full-${TAG//v/}-linux-$(dpkg --print-architecture).tar.gz\"\n\nwget \"https://github.com/${REPO}/releases/download/${TAG}/${ASSET}\" -O \"${ASSET}\"\n\ntar Cxzvvf /usr/local \"${ASSET}\"\n\nsystemctl enable --now containerd\n\nsystemctl enable --now buildkit\n\nnerdctl completion bash &gt; /etc/bash_completion.d/nerdctl\n\nsource /etc/profile\n</code></pre>"},{"location":"os/linux/ClamAV/","title":"ClamAV","text":""},{"location":"os/linux/ClamAV/#_1","title":"\u5b89\u88c5","text":"<pre><code>apt-get install clamav clamav-daemon\n</code></pre>"},{"location":"os/linux/ClamAV/#_2","title":"\u5347\u7ea7\u75c5\u6bd2\u5e93","text":"<pre><code>systemctl stop clamav-freshclam\n\nfreshclam\n\nsystemctl start clamav-freshclam\n</code></pre>"},{"location":"os/linux/ClamAV/#_3","title":"\u626b\u63cf","text":"<pre><code>clamscan --infected  \u2013-recursive --remove /\n</code></pre>"},{"location":"os/linux/Linux%20%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E5%91%BD%E4%BB%A4%20ps%20aux%20%E5%92%8C%20ps%20-ef/","title":"Linux \u67e5\u770b\u8fdb\u7a0b\u547d\u4ee4 ps aux \u548c ps  ef","text":""},{"location":"os/linux/Linux%20%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E5%91%BD%E4%BB%A4%20ps%20aux%20%E5%92%8C%20ps%20-ef/#ps-aux-ps-ef","title":"<code>ps aux</code> \u548c <code>ps -ef</code> \u7684\u533a\u522b","text":"<p>\u8ba8\u8bba\u8fd9\u4e2a\u95ee\u9898\uff0c\u8981\u8ffd\u6eaf\u5230 Unix \u7cfb\u7edf\u4e2d\u7684\u4e24\u79cd\u98ce\u683c\uff0cSystem V \u98ce\u683c\u548c BSD \u98ce\u683c\uff0c<code>ps aux</code> \u6700\u521d\u7528\u5230 Unix Style \u4e2d\uff0c\u800c <code>ps -ef</code>\u88ab\u7528\u5728 System V Style \u4e2d\uff0c\u4e24\u8005\u8f93\u51fa\u7565\u663e\u4e0d\u540c\u3002\u73b0\u5728\u5927\u90e8\u5206 Linux \u7cfb\u7edf\u90fd\u662f\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u3002</p> <ol> <li> <p><code>ps -ef</code> \u662f\u7528\u6807\u51c6\u7684\u683c\u5f0f\u663e\u793a\u8fdb\u7a0b\u7684\uff0c\u5176\u683c\u5f0f\u5982\u4e0b    </p> \u5217\u540d \u542b\u4e49 <code>UID</code> \u7528\u6237 ID\uff0c\u4f46\u8f93\u51fa\u7684\u662f\u7528\u6237\u540d <code>PID</code> \u8fdb\u7a0b ID <code>PPID</code> \u7236\u8fdb\u7a0b ID <code>C</code> \u8fdb\u7a0b\u5360\u7528 CPU \u7684\u767e\u5206\u6bd4 <code>STIME</code> \u8fdb\u7a0b\u542f\u52a8\u5230\u73b0\u5728\u7684\u65f6\u95f4 <code>TTY</code> \u8be5\u8fdb\u7a0b\u5728\u54ea\u4e2a\u7ec8\u7aef\u4e0a\u8fd0\u884c\uff0c\u82e5\u4e0e\u7ec8\u7aef\u65e0\u5173\uff0c\u5219\u663e\u793a <code>?</code>\uff0c\u82e5\u4e3a <code>pts/0</code> \u7b49\uff0c\u5219\u8868\u793a\u7531\u7f51\u7edc\u8fde\u63a5\u4e3b\u673a\u8fdb\u7a0b <code>CMD</code> \u547d\u4ee4\u7684\u540d\u79f0\u548c\u53c2\u6570 </li> <li> <p><code>ps aux</code> \u662f\u7528 BSD \u7684\u683c\u5f0f\u6765\u663e\u793a\u8fdb\u7a0b\u7684\uff0c\u5176\u683c\u5f0f\u5982\u4e0b    </p> \u5217\u540d \u542b\u4e49 <code>USER</code> \u7528\u6237\u540d <code>PID</code> \u8fdb\u7a0b ID <code>%CPU</code> \u8fdb\u7a0b\u5360\u7528 CPU \u7684\u767e\u5206\u6bd4 <code>%MEM</code> \u8fdb\u7a0b\u5360\u7528\u5185\u5b58\u7684\u767e\u5206\u6bd4 <code>VSZ</code> \u8fdb\u7a0b\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u91cf\uff08KB\uff09 <code>RSS</code> \u8be5\u8fdb\u7a0b\u5360\u7528\u7684\u56fa\u5b9a\u5185\u5b58\u91cf\uff08KB\uff09 <code>TTY</code> \u8be5\u8fdb\u7a0b\u5728\u54ea\u4e2a\u7ec8\u7aef\u4e0a\u8fd0\u884c\uff0c\u82e5\u4e0e\u7ec8\u7aef\u65e0\u5173\uff0c\u5219\u663e\u793a <code>?</code>\uff0c\u82e5\u4e3a <code>pts/0</code> \u7b49\uff0c\u5219\u8868\u793a\u7531\u7f51\u7edc\u8fde\u63a5\u4e3b\u673a\u8fdb\u7a0b <code>STAT</code> \u8fdb\u7a0b\u72b6\u6001 <code>START</code> \u8fdb\u7a0b\u88ab\u89e6\u53d1\u542f\u52a8\u65f6\u95f4 <code>TIME</code> \u8be5\u8fdb\u7a0b\u5b9e\u9645\u4f7f\u7528 CPU \u8fd0\u884c\u7684\u65f6\u95f4 <p>\u5176\u4e2d <code>STAT</code> \u72b6\u6001\u4f4d\u5e38\u89c1\u7684\u72b6\u6001\u5b57\u7b26\u6709</p> <ul> <li><code>D</code> \u65e0\u6cd5\u4e2d\u65ad\u7684\u4f11\u7720\u72b6\u6001\uff08\u901a\u5e38 IO \u7684\u8fdb\u7a0b\uff09</li> <li><code>R</code></li> <li><code>S</code> \u5904\u4e8e\u4f11\u7720\u72b6\u6001</li> <li><code>T</code> \u505c\u6b62\u6216\u88ab\u8ffd\u8e2a</li> <li><code>W</code> \u8fdb\u5165\u5185\u5b58\u4ea4\u6362\uff08\u4ece\u5185\u6838 2.6 \u5f00\u59cb\u65e0\u6548\uff09</li> <li><code>X</code> \u6b7b\u6389\u7684\u8fdb\u7a0b\uff08\u57fa\u672c\u5f88\u5c11\u89c1\uff09</li> <li><code>Z</code> \u50f5\u5c38\u8fdb\u7a0b</li> <li><code>&lt;</code> \u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b</li> <li><code>N</code> \u4f18\u5148\u7ea7\u4f4e\u7684\u8fdb\u7a0b</li> <li><code>L</code> \u6709\u4e9b\u9875\u88ab\u9501\u8fdb\u5185\u5b58</li> <li><code>s</code> \u8fdb\u7a0b\u7684\u9886\u5bfc\u8005\uff08\u5728\u5b83\u4e4b\u4e0b\u6709\u5b50\u8fdb\u7a0b\uff09</li> <li><code>l</code> \u591a\u7ebf\u7a0b\uff0c\u514b\u9686\u7ebf\u7a0b\uff08\u4f7f\u7528 CLONE_THREAD\uff0c\u7c7b\u4f3c NPTL phtreads\uff09</li> <li><code>+</code> \u4f4d\u4e8e\u540e\u53f0\u7684\u8fdb\u7a0b\u7ec4</li> </ul> </li> </ol>"},{"location":"os/linux/Linux%20%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E5%91%BD%E4%BB%A4%20ps%20aux%20%E5%92%8C%20ps%20-ef/#_1","title":"\u6536\u85cf","text":"<ul> <li>top\u3001ps -ef\u3001ps aux \u7684\u533a\u522b\u53ca\u5185\u5bb9\u8be6\u89e3</li> </ul>"},{"location":"os/linux/SSH/","title":"SSH","text":""},{"location":"os/linux/SSH/#_1","title":"\u514d\u5bc6\u767b\u5f55","text":"<p>\u5c06 <code>id_rsa.pub</code> \u8ffd\u52a0\u5230 <code>authorized_keys</code> \u4e2d</p> <pre><code>ssh-keygen -t rsa -q -N \"\" -f ~/.ssh/id_rsa\n\nssh-copy-id node6.icefery.xyz\n</code></pre>"},{"location":"os/linux/SSH/#ssh-key","title":"\u975e\u4ea4\u4e92\u5f0f\u751f\u6210 SSH-KEY","text":"<pre><code>ssh-keygen -t rsa -q -N \"\" -f ~/.ssh/id_rsa\n</code></pre>"},{"location":"os/linux/ZSH/","title":"ZSH","text":""},{"location":"os/linux/ZSH/#_1","title":"\u5b89\u88c5","text":"<pre><code>apt install -y zsh fonts-powerline\n\ncurl -O https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh\n\nsed -i 's/-ohmyzsh\\/ohmyzsh/-mirrors\\/oh-my-zsh/g' install.sh\n\nsed -i 's/-https:\\/\\/github.com\\/${REPO}.git/-https:\\/\\/gitee.com\\/${REPO}.git/g' install.sh\n\nsed -i 's/-~\\/.oh-my-zsh/-\\/etc\\/oh-my-zsh/g' install.sh\n\nexport ZSH=/etc/oh-my-zsh\n\n./install.sh\n</code></pre> <pre><code>cat /etc/shells\n\nchsh -s $(which zsh) root\n</code></pre>"},{"location":"os/linux/ZSH/#_2","title":"\u5378\u8f7d","text":"<pre><code>sh $ZSH/tools/uninstall.sh\n</code></pre>"},{"location":"os/linux/ZSH/#_3","title":"\u63d2\u4ef6","text":"<ul> <li> <p><code>zsh-syntax-highlighting</code></p> <pre><code>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $ZSH_CUSTOM/plugins/zsh-syntax-highlighting\n</code></pre> </li> <li> <p><code>~/.zshrc</code></p> <pre><code># ...\nplugins=(git zsh-syntax-highlighting)\n</code></pre> </li> </ul>"},{"location":"os/linux/ZSH/#_4","title":"\u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<ol> <li> <p><code>~/.profile</code></p> <pre><code>export JAVA_HOME=/opt/jdk-11\n</code></pre> </li> <li> <p><code>~/.zprofile</code></p> <pre><code>[[ -e ~/.profile ]] &amp;&amp; emulate sh -c 'source ~/.profile'\n</code></pre> </li> </ol>"},{"location":"os/linux/clean-dangling-symbolic-links/","title":"\u6e05\u7406\u65e0\u6548\u8f6f\u94fe\u63a5","text":""},{"location":"os/linux/clean-dangling-symbolic-links/#_1","title":"\u65b9\u6cd5\u4e00","text":"<pre><code>for f in $(find /usr/local/bin -type l); do [[ ! -e $f ]] &amp;&amp; echo $f &amp;&amp; rm -f $f; done\n</code></pre>"},{"location":"os/linux/clean-dangling-symbolic-links/#_2","title":"\u65b9\u6cd5\u4e8c","text":"<pre><code>apt install -y symlinks\n</code></pre> <pre><code>symlinks -d /usr/local/bin\n</code></pre>"},{"location":"os/linux/curl%20%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%A0%E9%80%92%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%82%E6%95%B0/","title":"Curl \u6267\u884c\u811a\u672c\u65f6\u4f20\u9012\u73af\u5883\u53d8\u91cf\u548c\u53c2\u6570","text":""},{"location":"os/linux/curl%20%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%A0%E9%80%92%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%82%E6%95%B0/#_1","title":"\u811a\u672c\u6587\u4ef6","text":"<pre><code>vim temp.sh\n</code></pre> <pre><code>echo \"A  = ${A}\"\necho \"\\$0 = $0\"\necho \"P1 = $1\"\necho \"P2 = $2\"\necho \"P3 = $3\"\n</code></pre> <pre><code>nohup python3 -m http.server &amp;&gt; /dev/null &amp;\n</code></pre>"},{"location":"os/linux/curl%20%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%A0%E9%80%92%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%82%E6%95%B0/#_2","title":"\u7ba1\u9053","text":"<code>-f</code>,<code>--fail</code> \u8868\u793a\u5728\u670d\u52a1\u5668\u9519\u8bef\u65f6\uff0c\u963b\u6b62\u4e00\u4e2a\u8fd4\u56de\u7684\u8868\u793a\u9519\u8bef\u539f\u56e0\u7684 html \u9875\u9762\uff0c\u800c\u7531 curl \u547d\u4ee4\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u7801 22 \u6765\u63d0\u793a\u9519\u8bef <code>-s</code>,<code>--slient</code> <code>-s</code> \u53c2\u6570\u5c06\u4e0d\u8f93\u51fa\u9519\u8bef\u548c\u8fdb\u5ea6\u4fe1\u606f <code>-S</code>,<code>--show-error</code> <code>-S</code> \u53c2\u6570\u6307\u5b9a\u53ea\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\uff0c\u901a\u5e38\u4e0e <code>-s</code> \u4e00\u8d77\u4f7f\u7528\u3002 <code>-L</code>,<code>--location</code> <code>-L</code> \u53c2\u6570\u4f1a\u8ba9 HTTP \u8bf7\u6c42\u8ddf\u968f\u670d\u52a1\u5668\u7684\u91cd\u5b9a\u5411\u3002curl \u9ed8\u8ba4\u4e0d\u8ddf\u968f\u91cd\u5b9a\u5411 <pre><code>[root@dev:~]# curl -fsSL http://localhost:8000/temp.sh | A=1 bash -s -- -p1 --p2 p3\nA  = 1\n$0 = bash\nP1 = -p1\nP2 = --p2\nP3 = p3\n</code></pre>"},{"location":"os/linux/curl%20%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%97%B6%E4%BC%A0%E9%80%92%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%92%8C%E5%8F%82%E6%95%B0/#_3","title":"\u8fdb\u7a0b\u66ff\u6362","text":"<pre><code>[root@dev:~]# A=1 bash &lt;(curl -fsSL http://localhost:8000/temp.sh) -p1 --p2 p3\nA  = 1\n$0 = /dev/fd/61\nP1 = -p1\nP2 = --p2\nP3 = p3\n</code></pre>"},{"location":"os/linux/nohup%20%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B%E5%90%8E%E4%BF%9D%E5%AD%98%E8%BF%9B%E7%A8%8B%E5%8F%B7/","title":"Nohup \u542f\u52a8\u8fdb\u7a0b\u540e\u4fdd\u5b58\u8fdb\u7a0b\u53f7","text":"<p><code>$!</code> \u8868\u793a\u6700\u540e\u6267\u884c\u7684\u8fdb\u7a0b\u7684 PID</p> <pre><code>#!/usr/bin/env bash\ncase $1 in\nstart)\n  nohup node main.js &amp;&gt; app.log &amp;\n  echo $! &gt; app.pid\n;;\nstop)\n  if [[ -f app.pid ]]; then\n    kill -9 $(cat app.pid)\n    rm -rf app.pid\n  fi\n;;\n*)\n  echo \"USAGE ./cli.sh &lt;start|stop&gt;\"\n;;\n</code></pre>"},{"location":"os/linux/shell/","title":"Shell","text":""},{"location":"os/linux/shell/#source","title":"<code>.</code> \u548c <code>source</code>\u7684\u533a\u522b","text":"<ul> <li><code>. &lt;SCRIPT&gt;</code>\uff1a\u542f\u52a8\u4e00\u4e2a\u5b50 Shell \u6765\u6267\u884c\u811a\u672c\uff0c\u5728\u5b50 Shell \u4e2d\u6267\u884c\u7684\u4e00\u5207\u64cd\u4f5c\u90fd\u4e0d\u4f1a\u5f71\u54cd\u7236 Shell</li> <li><code>source &lt;SCRIPT&gt;</code>\uff1a\u5728\u5f53\u524d Shell \u73af\u5883\u6267\u884c\u811a\u672c</li> </ul>"},{"location":"os/linux/shell/#interactive-shell-non-interactive-shell","title":"interactive shell \u548c non-interactive shell","text":"<p>\u5224\u65ad\u65b9\u6cd5\uff1a<code>$PS1</code>\u662f\u5426\u6709\u503c\u6216\u8005 <code>$-</code> \u662f\u5426\u5305\u542b <code>i</code></p> <ul> <li> <p>interactive shell</p> <pre><code>echo $PS1\n# ${debian_chroot:+($debian_chroot)}\\u@\\h:\\w\\$\n\necho $-\n# himBHs\n</code></pre> <pre><code>bash -i -c 'echo $PS1'\n# ${debian_chroot:+($debian_chroot)}\\u@\\h:\\w\\$\n\nbash -i -c 'echo $-'\n# himBHs\n</code></pre> </li> <li> <p>non-interactive shell</p> <pre><code>bash -c 'echo $PS1'\n#\n\nbash -c 'echo $-'\n# hBc\n</code></pre> </li> </ul>"},{"location":"os/linux/shell/#_1","title":"Shell","text":""},{"location":"os/linux/shell/#login-shell-non-login-shell","title":"login shell \u548c non-login shell","text":"<p>\u5224\u65ad\u65b9\u6cd5\uff1a</p> <ul> <li><code>$0</code>\u663e\u793a <code>-bash</code> \u7684\u4e00\u5b9a\u662f login shell\uff08\u901a\u8fc7 <code>bash --login</code> \u542f\u52a8\u7684 login shell \u7684 <code>$0</code> \u5e76\u975e\u4ee5 <code>-</code> \u5f00\u5934\uff09</li> <li>\u4f7f\u7528<code>exit</code>\u547d\u4ee4\u4f1a\u5224\u65ad\u5f53\u524d\u7684 shell \u5e76\u5206\u522b\u8c03\u7528 <code>logout</code> \u6216 <code>exit</code></li> </ul> <ul> <li> <p>login shell</p> <pre><code>bash --login\nexit\n# logout\n</code></pre> </li> <li> <p>non-login shell</p> <pre><code>bash\nexit\n#\n</code></pre> </li> </ul>"},{"location":"os/linux/vim/","title":"Vim","text":""},{"location":"os/linux/vim/#_1","title":"\u53d6\u6d88\u81ea\u52a8\u6362\u884c","text":"<pre><code>:set nowrap\n</code></pre>"},{"location":"os/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"os/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#ip","title":"\u83b7\u53d6\u6307\u5b9a\u4e3b\u673a\u7684 IP","text":"<pre><code>ip=$(host \"$(hostname)\" | awk 'NR==1 {print $NF}')\n</code></pre>"},{"location":"os/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_1","title":"\u6848\u4f8b","text":"<pre><code>hosts=(host1 host2 host3)\n\nip=$(host \"$(hostname)\" | awk 'NR==1 {print $NF}')\n\nfor host in \"${hosts[@]}\"; do\nif [[ \"$(host \"${host}\" | awk 'NR==1 {print $NF}')\" != \"${ip}\" ]]; then\n  echo \"host=${host}\"\nfi\ndone\n</code></pre>"},{"location":"os/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/#_2","title":"\u641c\u7d22\u5305\u542b\u6709\u6307\u5b9a\u5185\u5bb9\u7684\u6240\u6709\u6587\u4ef6\u540d","text":"<pre><code># -r \u8868\u793a\u9012\u5f52\u641c\u7d22\u5b50\u76ee\u5f55\n# -l \u8868\u793a\u53ea\u8f93\u51fa\u5305\u542b\u5339\u914d\u5185\u5bb9\u7684\u6587\u4ef6\u540d\uff0c\u800c\u4e0d\u663e\u793a\u5339\u914d\u7684\u5177\u4f53\u884c\u5185\u5bb9\ngrep -rl \"abcd\" /path/to/directory\n</code></pre>"},{"location":"os/linux/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/","title":"\u78c1\u76d8\u6269\u5bb9","text":""},{"location":"os/linux/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/#_1","title":"\u78c1\u76d8\u6269\u5bb9","text":""},{"location":"os/linux/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/#_2","title":"\u666e\u901a\u5206\u533a","text":"<p>Linux \u672a\u914d\u7f6e LVM \u903b\u8f91\u5377\uff0c\u5982\u4f55\u5b9e\u73b0\u78c1\u76d8\u70ed\u6269\u5bb9</p> <pre><code>growpart /dev/sdb 1\n\nresize2fs /dev/sdb1\n</code></pre>"},{"location":"os/linux/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/#lvm","title":"LVM \u5206\u533a","text":"<pre><code>df -h\n\nvgdisplay\n\nlvresize -l  +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv\n\nresize2fs /dev/mapper/ubuntu--vg-ubuntu--lv\n</code></pre>"},{"location":"os/linux/archlinux/","title":"Arch","text":""},{"location":"os/linux/archlinux/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":""},{"location":"os/linux/archlinux/#11","title":"1.1 \u7f51\u7edc\u914d\u7f6e","text":"<pre><code>cat | sudo tee /etc/systemd/network/10-enp0s1.network &gt; /dev/null &lt;&lt;- 'EOF'\n[Match]\nName=enp0s1\n\n[Network]\nAddress=192.168.16.101/24\nGateway=192.168.16.1\nDNS=119.29.29.29\nEOF\n</code></pre>"},{"location":"os/linux/centos/","title":"CentOS","text":""},{"location":"os/linux/centos/install%20centos-7/","title":"Install centos 7","text":""},{"location":"os/linux/centos/install%20centos-7/#_1","title":"\u7f51\u7edc\u914d\u7f6e","text":"<ul> <li> <p>\u67e5\u770b\u7f51\u5361 UUID</p> <pre><code># \u67e5\u770b\u7f51\u5361 UUID\nnmcli con\n</code></pre> </li> <li> <p><code>/etc/sysconfig/network-scripts/ifcfg-ens33</code></p> <p>VMWare \u4e2d\u9ed8\u8ba4\u7f51\u5361\u540d\u79f0\u4e3a <code>ens-33</code>\u3002</p> <pre><code>TYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=none\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nIPV6INIT=yes\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_FAILURE_FATAL=no\nIPV6_ADDR_GEN_MODE=stable-privacy\nNAME=ens33\nUUID=21f9e3ea-3aab-4de3-90e5-dfa584e84033\nDEVICE=ens33\nONBOOT=yes\nIPADDR=192.168.137.7\nPREFIX=24\nGATEWAY=192.168.137.1\nDNS1=192.168.137.1\nIPV6_PRIVACY=no\n</code></pre> </li> <li> <p>\u91cd\u542f\u7f51\u7edc</p> <pre><code>systemctl restart network\n</code></pre> </li> </ul>"},{"location":"os/linux/centos/install%20centos-7/#_2","title":"\u6362\u6e90","text":"<pre><code>sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n    -e 's|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g' \\\n    -i.bak \\\n    /etc/yum.repos.d/CentOS-Base.repo\n\nyum makecache\n</code></pre>"},{"location":"os/linux/centos/install%20centos-7/#selinux","title":"\u7981\u7528 SELINUX","text":"<pre><code>getenforce\n\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config\n\nreboot\n</code></pre>"},{"location":"os/linux/centos/install%20centos-7/#_3","title":"\u7981\u7528\u9632\u706b\u5899","text":"<pre><code>systemctl stop firewalld\n\nsystemctl disable firewalld\n\nsystemctl status firewalld\n</code></pre>"},{"location":"os/linux/centos/install%20centos-7/#mariadb","title":"\u5378\u8f7d MariaDB","text":"<pre><code>rpm -e --nodeps $(rpm -qa | grep mariadb)\n</code></pre>"},{"location":"os/linux/centos/install-centos-stream-9/","title":"Install centos stream 9","text":""},{"location":"os/linux/centos/install-centos-stream-9/#ip","title":"\u9759\u6001 IP","text":"<ul> <li>CentOS Stream 9 \u8bbe\u7f6e\u9759\u6001 IP</li> </ul> <pre><code>ls -l /etc/NetworkManager/system-connections/\n</code></pre> <pre><code>[ipv4]\nmethod=manual\naddress1=192.192.192.9/24,192.192.192.1\ndns=192.192.192.1;\n</code></pre> <p>\u9017\u53f7\u540e\u662f\u7f51\u5173\u5730\u5740\u3002</p>"},{"location":"os/linux/debian/","title":"Debian","text":""},{"location":"os/linux/debian/#_1","title":"\u5b89\u88c5","text":""},{"location":"os/linux/debian/#ip","title":"\u9759\u6001 IP","text":"<pre><code>cat &gt; /etc/network/interfaces &lt;&lt;- EOF\nauto lo\niface lo inet loopback\n\nauto ens33\niface ens33 inet static\n  address 192.168.9.100\n  netmask 255.255.255.0\n  gateway 192.168.9.254\nEOF\n\nsystemctl restart networking\n</code></pre>"},{"location":"os/linux/debian/#_2","title":"\u57fa\u7840\u670d\u52a1","text":""},{"location":"os/linux/debian/#dnsmasq","title":"DNSmasq","text":"<pre><code>apt install -y dnsmasq\n\n# \u914d\u7f6e\u6cdb\u89e3\u6790\necho \"address=/dev.icefery.xyz/192.192.192.6\" &gt; /etc/dnsmasq.conf\n</code></pre>"},{"location":"os/linux/debian/#_3","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"os/linux/debian/#failed-to-allocate-directory-watch-too-many-open-files","title":"Failed to allocate directory watch: Too many open files","text":"<p>https://zhuanlan.zhihu.com/p/222506941</p> <pre><code>cat &gt;&gt; /etc/sysctl.conf &lt;&lt;- \"EOF\"\nfs.inotify.max_user_instances=512\nfs.inotify.max_user_watches=262144\nEOF\n\nsysctl -p\n</code></pre>"},{"location":"os/linux/debian/#fata0000-get-apparmor_parser-version-apparmor_parser-resolves-to-executable-in-current-directory-apparmor_parser","title":"FATA[0000] get apparmor_parser version: apparmor_parser resolves to executable in current directory (./apparmor_parser)","text":"<p>\u89e3\u51b3 FATA[0000] Get http:///var/run... sudo apt-get install apparmor \u597d\u795e\u5947</p> <pre><code>apt install apparmor\n</code></pre>"},{"location":"os/linux/manjaro/","title":"Manjaro","text":""},{"location":"os/linux/manjaro/manjaro-kde%20%E5%AE%89%E8%A3%85/","title":"Manjaro kde \u5b89\u88c5","text":""},{"location":"os/linux/manjaro/manjaro-kde%20%E5%AE%89%E8%A3%85/#_1","title":"\u8bbe\u5907","text":"Machine \u673a\u68b0\u5e08-T90"},{"location":"os/linux/manjaro/manjaro-kde%20%E5%AE%89%E8%A3%85/#_2","title":"\u6362\u6e90","text":"<pre><code># \u6392\u5217\u6e90\nsudo pacman-mirrors -i -c China -m rank\n\n# \u6dfb\u52a0 archlinuxcn \u6e90\necho -e \"\n[archlinuxcn]\nSigLevel = Optional TrustedOnly\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch\n\" &gt;&gt; /etc/pacman.conf\n\n# \u4e0b\u8f7d keyring\nsudo pacman -S archlinux-keyring\n\n# \u66f4\u65b0\u7cfb\u7edf\nsudo pacman -Syyu\n</code></pre>"},{"location":"os/linux/manjaro/manjaro-kde%20%E5%AE%89%E8%A3%85/#_3","title":"\u8f93\u5165\u6cd5","text":"<ul> <li> <p>\u53c2\u8003</p> <ul> <li>https://wiki.archlinux.org/title/Fcitx5_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</li> <li>https://github.com/hosxy/Fcitx5-Material-Color</li> </ul> </li> <li> <p><code>bash     sudo pacman -S fcitx5-im fcitx5-rime fcitx5-material-color noto-fonts-emoji</code></p> </li> <li> <p><code>~/.pam_environment</code></p> <pre><code>GTK_IM_MODULE DEFAULT=fcitx\nQT_IM_MODULE  DEFAULT=fcitx\nXMODIFIERS    DEFAULT=@im=fcitx\nINPUT_METHOD  DEFAULT=fcitx\nSDL_IM_MODULE DEFAULT=fcitx\n</code></pre> </li> <li> <p><code>/etc/vimrc</code></p> <pre><code>autocmd InsertLeave * :silent !fcitx5-remote -c \" \u9000\u51fa\u63d2\u5165\u6a21\u5f0f\u65f6\u7981\u7528\u8f93\u5165\u6cd5\nautocmd BufCreate   * :silent !fcitx5-remote -c \" \u521b\u5efa Buf \u65f6\u7981\u7528\u8f93\u5165\u6cd5\nautocmd BufEnter    * :silent !fcitx5-remote -c \" \u8fdb\u5165 Buf \u65f6\u7981\u7528\u8f93\u5165\u6cd5\nautocmd BufLeave    * :silent !fcitx5-remote -c \" \u79bb\u5f00 Buf \u65f6\u7981\u7528\u8f93\u5165\u6cd5\n</code></pre> </li> <li> <p><code>bash     sudo kill `ps -A | grep fcitx5 | awk '{print $1}'` &amp;&amp; fcitx5&amp;</code></p> </li> </ul>"},{"location":"os/linux/shell/","title":"Shell","text":""},{"location":"os/linux/shell/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":"<ul> <li> <p>\u5199\u5165\u6743\u9650</p> <pre><code># error\nsudo echo 3 &gt;/proc/sys/vm/drop_caches\n\n# correct\necho 3 | sudo tee /proc/sys/vm/drop_caches\n</code></pre> </li> <li> <p>\u8fdb\u7a0b\u66ff\u6362</p> <pre><code># \u5148\u5c06 ls \u7684\u7ed3\u6784\u8f93\u51fa\u5230\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u7136\u540e echo \u8fd9\u4e2a\u4e34\u65f6\u6587\u4ef6\necho &lt;(ls)\n\n# \u8fd9\u4e2a\u547d\u4ee4\u662f\u5c06\u5de6\u8fb9\u547d\u4ee4\u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u8fdb\u7a0b\u66ff\u6362\u4ea7\u751f\u7684\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u5bf9\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u6267\u884c&gt;(CMD)\u4e2dCMD\u547d\u4ee4\necho hello &gt; &gt;(grep hello)\n\n# \u663e\u793a\u6587\u4ef6\u5939 foo \u548c bar \u4e2d\u6587\u4ef6\u7684\u533a\u522b\ndiff &lt;(ls foo) &lt;(ls bar)\n</code></pre> </li> </ul>"},{"location":"os/linux/shell/#_2","title":"\u6536\u85cf","text":""},{"location":"os/linux/shell/#shell-shellcheck","title":"Shell \u7f16\u7801\u89c4\u8303\u624b\u518c(shellcheck \u9519\u8bef\u6c47\u603b)","text":""},{"location":"os/linux/ubuntu/","title":"Ubuntu","text":""},{"location":"os/linux/ubuntu/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":""},{"location":"os/linux/ubuntu/#11","title":"1.1 \u767b\u5f55\u914d\u7f6e","text":"<pre><code># \u542f\u7528 root \u7528\u6237\u901a\u8fc7\u5bc6\u7801\u767b\u5f55 SSH\nsudo sed -i '/PermitRootLogin/c PermitRootLogin yes' /etc/ssh/sshd_config\nsudo systemctl restart ssh\n\n# \u8bbe\u7f6e root \u7528\u6237\u5bc6\u7801\nsudo passwd root\n</code></pre>"},{"location":"os/linux/ubuntu/#12","title":"1.2 \u7f51\u7edc\u914d\u7f6e","text":"<pre><code># \u53c2\u8003 centos7 \u914d\u7f6e\u672c\u5730 hosts\nsudo tee /etc/hosts &gt; /dev/null &lt;&lt;- 'EOF'\n127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1       localhost localhost.localdomain localhost6 localhost6.localdomain6\nEOF\n\n# \u7981\u7528 ipv6\nsudo tee /etc/sysctl.conf &gt; /dev/null &lt;&lt;- 'EOF'\nnet.ipv6.conf.all.disable_ipv6=1\nnet.ipv6.conf.default.disable_ipv6=1\nnet.ipv6.conf.lo.disable_ipv6=1\nEOF\nsudo sysctl -p\n\n# GRUB \u7981\u7528 ipv6\nsudo sed -i 's GRUB_CMDLINE_LINUX=\"\" GRUB_CMDLINE_LINUX=\"ipv6.disable=1\" g' /etc/default/grub\nsudo update-grub\n\n# \u914d\u7f6e ip gateway dns\nsudo vim /etc/netplan/00-installer-config.yaml\nsudo netplan apply\n</code></pre> <pre><code>network:\n  ethernets:\n    ens33:\n      addresses:\n        - 192.168.8.101/24\n      nameservers:\n        addresses:\n          - 114.114.114.114\n        search: []\n      routes:\n        - to: default\n          via: 192.168.8.1\n  version: 2\n</code></pre>"},{"location":"os/linux/ubuntu/#13","title":"1.3 \u5e94\u7528\u914d\u7f6e","text":"<pre><code># \u5378\u8f7d snap\nsudo apt remove snapd --purge --autoremove -y\n\n# \u89e3\u51b3 systemd-resolve \u5360\u7528 53 \u7aef\u53e3\nsudo sed -i -e '/#DNSStubListener=/c DNSStubListener=no' /etc/systemd/resolved.conf\nsudo ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf\nsudo systemctl restart systemd-resolved\n\n# \u914d\u7f6e vim\nsudo tee /etc/vim/vimrc.local &gt; /dev/null &lt;&lt;- 'EOF'\nset autoread\nset cursorline\nset nopaste\nset expandtab\nset tabstop=4\nset softtabstop=4\nset shiftwidth=4\nset laststatus=2\nEOF\n</code></pre>"},{"location":"os/linux/ubuntu/#14","title":"1.4 \u66f4\u65b0\u914d\u7f6e","text":"<pre><code># \u6362\u6e90\nsudo tee /etc/apt/sources.list &lt;&lt;- \"EOF\"\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ jammy           main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ jammy-security  main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ jammy-updates   main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ jammy-backports main restricted universe multiverse\nEOF\n\n# \u66f4\u65b0\nsudo apt update\nsudo apt full-upgrade -y\nsudo apt list --upgradable 2&gt; /dev/null | grep -v 'Listing' | cut -d '/' -f 1 | xargs sudo apt upgrade -y\n</code></pre>"},{"location":"os/linux/ubuntu/#15","title":"1.5 \u7cfb\u7edf\u914d\u7f6e","text":"<pre><code># \u7981\u7528 swap\nsudo swapoff -a\nsudo sed -i '/swap/s/^\\(.*\\)$/#\\1/g' /etc/fstab\nsudo rm -rf /swap.img\n\n# \u914d\u7f6e\u6700\u5927\u6587\u4ef6\u53e5\u67c4\u6570\ntee /etc/security/limits.conf &lt;&lt;- \"EOF\"\n*    soft nofile 102400\n*    hard nofile 102400\nroot soft nofile 102400\nroot hard nofile 102400\nEOF\n\n# \u91cd\u542f\nreboot\n</code></pre>"},{"location":"os/linux/ubuntu/#16","title":"1.6 \u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<pre><code># \u5220\u9664\u7528\u6237\u9ed8\u8ba4\u914d\u7f6e\nrm -rf ~/.bashrc .profile\n\n# \u5168\u5c40\u914d\u7f6e\nsudo tee /etc/profile.d/custom.sh &lt;&lt;- \"EOF\"\nexport PS1='[\\[\\e[01;32m\\]\\u\\[\\e[00m\\]@\\[\\e[01;33m\\]\\h\\[\\e[00m\\]:\\[\\e[01;32m\\]\\w\\[\\e[00m\\]]\\$ '\nexport TZ='Asia/Shanghai'\nexport TIME_STYLE='+%Y-%m-%d %H:%M:%S'\n\nalias ll='ls -AlhF --color=auto'\n\nfunction start_proxy() {\n  export http_proxy=http://192.168.8.10:7890\n  export https_proxy=$http_proxy\n  export no_proxy=192.168.8.*\n}\nfunction stop_proxy() {\n  unset http_proxy\n  unset https_proxy\n  unset no_proxy\n}\nEOF\nsudo chmod 777 /etc/profile.d/custom.sh\n\n# \u5237\u65b0\nsource /etc/profile\n</code></pre>"},{"location":"os/linux/ubuntu/#vmware","title":"\u4e8c\u3001VMWare","text":""},{"location":"os/linux/ubuntu/#21-vm-tools","title":"2.1 \u5b89\u88c5 VM Tools","text":"<pre><code>sudo apt remove open-vm-tools --purge --autoremove -y\nsudo apt install open-vm-tools -y\nsudo apt install open-vm-tools-desktop -y\n</code></pre>"},{"location":"os/linux/ubuntu/#mysql","title":"\u4e09\u3001MySQL","text":""},{"location":"os/linux/ubuntu/#31-mysql","title":"3.1 \u5b89\u88c5 MySQL","text":"<pre><code># \u5b89\u88c5\nsudo apt search mysql-server\nsudo apt install mysql-server -y\n\n# \u91cd\u7f6e\nsudo systemctl stop mysql\nsudo rm -rf /var/lib/mysql/* /etc/mysql/*\n\n# \u914d\u7f6e\nsudo tee /etc/mysql/my.cnf &lt;&lt;- \"EOF\"\n[mysqld]\nuser                          = mysql\nbind-address                  = 0.0.0.0\nlower-case-table-names        = 1\ndefault-time-zone             = +8:00\ndefault-authentication-plugin = mysql_native_password\nEOF\n\n# \u521d\u59cb\u5316\nsudo mysqld --initialize\n\n# \u91cd\u542f\nsudo systemctl start mysql\n\n# \u767b\u5f55\nmysql -uroot -p\n</code></pre>"},{"location":"os/linux/ubuntu/#32","title":"3.2 \u4fee\u6539\u5bc6\u7801","text":"<pre><code>-- \u4fee\u6539\u5bc6\u7801\nalter user 'user'@'localhost' identified by 'root';\n\n-- \u914d\u7f6e\u53ef\u8fdc\u7a0b\u767b\u5f55\nuse mysql;\nselect user, host, plugin from user;\nupdate user set host = '%' where user = 'root';\n\n-- \u5237\u65b0\u6743\u9650\nflush privileges;\n</code></pre>"},{"location":"os/mac/","title":"Mac","text":""},{"location":"os/mac/#_1","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"os/mac/#macos-12-monterey-5000","title":"MacOS 12 Monterey \u7adf\u7136\u8ba9\u7cfb\u7edf\u5360\u7528\u4e86 5000 \u7aef\u53e3","text":""},{"location":"os/mac/homebrew/","title":"Homebrew","text":""},{"location":"os/mac/homebrew/#_1","title":"\u6536\u85cf","text":""},{"location":"os/mac/homebrew/#homebrewmac-os-brew-no-remote-origin","title":"Homebrew\uff1aMac os \u4f7f\u7528 brew \u5de5\u5177\u65f6\u62a5\u9519 No remote 'origin'","text":"<pre><code>brew update\n\nbrew doctor\n\nrm -rf \"/opt/homebrew/Library/Taps/homebrew/homebrew-cask\"\nbrew tap homebrew/cask\n\nrm -rf \"/opt/homebrew/Library/Taps/homebrew/homebrew-core\"\nbrew tap homebrew/core\n\nrm -rf \"/opt/homebrew/Library/Taps/homebrew/homebrew-services\"\nbrew tap homebrew/services\n</code></pre>"},{"location":"os/mac/uninstall-python-on-mac/","title":"\u5728 Mac \u4e0a\u5378\u8f7d Python","text":""},{"location":"os/mac/uninstall-python-on-mac/#_1","title":"\u53c2\u8003\u6587\u6863","text":"<ul> <li>https://docs.python.org/zh-cn/3/using/mac.html</li> </ul>"},{"location":"os/mac/uninstall-python-on-mac/#_2","title":"\u79fb\u9664\u5e94\u7528","text":""},{"location":"os/mac/uninstall-python-on-mac/#_3","title":"\u79fb\u9664\u6846\u67b6","text":"<pre><code>sudo rm -rf /Library/Frameworks/Python.framework\n</code></pre>"},{"location":"os/mac/uninstall-python-on-mac/#_4","title":"\u79fb\u9664\u8f6f\u94fe\u63a5","text":"<pre><code>ls -l /usr/local/bin | grep 'Python.framework'\n</code></pre>"},{"location":"os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/","title":"\u5185\u7f6e\u547d\u4ee4\u884c\u56fe\u7247\u5904\u7406\u5de5\u5177 <code>sips</code>","text":""},{"location":"os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/#_2","title":"\u5e2e\u52a9","text":""},{"location":"os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/#_3","title":"\u8c03\u6574\u56fe\u7247\u5927\u5c0f","text":"<p>\u5c06\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709 PNG \u56fe\u7247\u7684\u5bbd\u5ea6\u8c03\u6574\u4e3a <code>800</code> \u50cf\u7d20\u5e76\u4fdd\u5b58\u81f3 <code>output</code> \u76ee\u5f55\u3002</p> <pre><code>mkdir -p output\n\nsips --resampleWidth 800 *.png --out output\n</code></pre>"},{"location":"os/mac/%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%20sips/#_4","title":"\u6536\u85cf","text":"<ul> <li>sips \u547d\u4ee4\u8fdb\u884c\u56fe\u7247\u6279\u91cf\u5904\u7406</li> <li>\u9ad8\u6548\u4fbf\u6377\uff01\u4f7f\u7528 macOS \u7684\u795e\u5947\u547d\u4ee4\u884c\u5de5\u5177 sips\uff0c\u8f7b\u677e\u6279\u91cf\u8c03\u6574\u56fe\u7247\u5927\u5c0f\uff01</li> </ul>"},{"location":"os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/","title":"\u547d\u4ee4\u884c\u5de5\u5177","text":""},{"location":"os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#_1","title":"\u53c2\u8003","text":"<ul> <li>https://developer.apple.com/library/archive/technotes/tn2339/_index.html</li> </ul>"},{"location":"os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#_2","title":"\u67e5\u770b\u8def\u5f84","text":"<pre><code>xcode-select --print-path\n</code></pre>"},{"location":"os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#_3","title":"\u5378\u8f7d","text":"<pre><code>sudo rm -rf /Library/Developer/CommandLineTools\n</code></pre>"},{"location":"os/mac/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/#xcode","title":"\u5207\u6362 Xcode","text":"<pre><code>sudo xcode-select -switch /Applications/Xcode.app\n</code></pre>"},{"location":"os/ntp/%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"\u65f6\u95f4\u670d\u52a1\u5668","text":""},{"location":"os/ntp/%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/#_1","title":"\u6536\u85cf","text":"<ul> <li>\u56fd\u5185\u5e38\u7528\u7684 NTP \u65f6\u95f4\u6e90\u540c\u6b65\u670d\u52a1\u5668\u6c47\u603b</li> </ul>"},{"location":"os/ntp/%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8/#_2","title":"\u65f6\u95f4\u670d\u52a1\u5668","text":"<pre><code>ntp.ntsc.ac.cn \u2003\u2003# \u4e2d\u56fd\u56fd\u5bb6\u6388\u65f6\u4e2d\u5fc3\ncn.ntp.org.cn \u2003\u2003 # \u4e2d\u56fd\u6388\u65f6\n\nntp1.aliyun.com # \u963f\u91cc\u4e91\nntp2.aliyun.com\nntp3.aliyun.com\nntp4.aliyun.com\nntp5.aliyun.com\nntp6.aliyun.com\nntp7.aliyun.com\n\ns1a.time.edu.cn \u2003\u2003# \u5317\u4eac\u90ae\u7535\u5927\u5b66\ns1b.time.edu.cn \u2003\u2003# \u6e05\u534e\u5927\u5b66\ns1c.time.edu.cn \u2003\u2003# \u5317\u4eac\u5927\u5b66\ns1d.time.edu.cn \u2003\u2003# \u4e1c\u5357\u5927\u5b66\ns1e.time.edu.cn \u2003\u2003# \u6e05\u534e\u5927\u5b66\ns2a.time.edu.cn \u2003\u2003# \u6e05\u534e\u5927\u5b66\ns2b.time.edu.cn \u2003\u2003# \u6e05\u534e\u5927\u5b66\ns2c.time.edu.cn \u2003\u2003# \u5317\u4eac\u90ae\u7535\u5927\u5b66\ns2d.time.edu.cn \u2003\u2003# \u897f\u5357\u5730\u533a\u7f51\u7edc\u4e2d\u5fc3\ns2e.time.edu.cn \u2003\u2003# \u897f\u5317\u5730\u533a\u7f51\u7edc\u4e2d\u5fc3\ns2f.time.edu.cn \u2003\u2003# \u4e1c\u5317\u5730\u533a\u7f51\u7edc\u4e2d\u5fc3\ns2g.time.edu.cn \u2003\u2003# \u534e\u4e1c\u5357\u5730\u533a\u7f51\u7edc\u4e2d\u5fc3\ns2h.time.edu.cn \u2003\u2003# \u56db\u5ddd\u5927\u5b66\u7f51\u7edc\u7ba1\u7406\u4e2d\u5fc3\ns2j.time.edu.cn \u2003\u2003# \u5927\u8fde\u7406\u5de5\u5927\u5b66\u7f51\u7edc\u4e2d\u5fc3\ns2k.time.edu.cn \u2003\u2003# CERNET\u6842\u6797\u4e3b\u8282\u70b9\ns2m.time.edu.cn \u2003\u2003# \u5317\u4eac\u5927\u5b66\n\nhttp://time1.apple.com # \u82f9\u679c\nhttp://time2.apple.com\nhttp://time3.apple.com\nhttp://time4.apple.com\nhttp://time5.apple.com\nhttp://time6.apple.com\nhttp://time7.apple.com\n\nhttp://time1.google.com # \u8c37\u6b4c\nhttp://time2.google.com\nhttp://time3.google.com\nhttp://time4.google.com\n</code></pre>"},{"location":"os/win/","title":"Windows","text":""},{"location":"os/win/#_1","title":"\u6536\u85cf","text":""},{"location":"os/win/#0x800f081f","title":"\u5b89\u88c5\u4e00\u4e9b\u66f4\u65b0\u65f6\u51fa\u73b0\u95ee\u9898 \u9519\u8bef 0x800f081f","text":""},{"location":"os/win/#_2","title":"\u7535\u8111\u4e24\u4e2a\u7f51\u5361\u540c\u65f6\u8bbf\u95ee\u5185\u5916\u7f51\uff0c\u8def\u7531\u8868\u8bbe\u7f6e","text":""},{"location":"os/win/#_3","title":"\u6536\u96c6\u7684\u4e00\u4e9b\u4f18\u79c0\u8f6f\u4ef6","text":""},{"location":"os/win/#windows11","title":"Windows11 \u8bbe\u7f6e\u53f3\u952e\u663e\u793a\u5168\u90e8\u83dc\u5355","text":"<ol> <li> <p>\u6253\u5f00 PowerShell \u8f93\u5165\u5982\u4e0b\u547d\u4ee4</p> <pre><code>reg.exe add \"HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32\" /f /ve\n</code></pre> </li> <li> <p>\u91cd\u542f</p> </li> </ol>"},{"location":"os/win/#_4","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"os/win/#0x80131500","title":"\u5e94\u7528\u5546\u5e97\u65e0\u6cd5\u66f4\u65b0\u3002\u9519\u8bef\u4ee3\u7801: 0x80131500","text":"<ul> <li>\u5fae\u8f6f\u5e94\u7528\u5546\u5e97\u9519\u8bef\u4ee3\u7801\u201c0x80131500\u201d\u600e\u4e48\u4fee\u590d\uff1f</li> </ul>"},{"location":"os/win/#_5","title":"\u5173\u95ed\u4f11\u7720","text":"<p>Win + R \u8f93\u5165 <code>powershell</code> Ctrl + Shift \u4ee5\u7ba1\u7406\u5458\u6a21\u5f0f\u6253\u5f00</p> <pre><code>powercfg -h off\n</code></pre>"},{"location":"os/win/#dns-arp","title":"\u6e05\u7406 DNS \u548c ARP \u7f13\u5b58","text":"<pre><code>ipconfig.exe /flushdns\n\nnetsh.exe interface ip delete arpcache\n</code></pre>"},{"location":"os/win/#winget","title":"<code>winget</code> \u547d\u4ee4","text":"<p>\u5e94\u7528\u5546\u5e97\u641c\u7d22\u201c\u5e94\u7528\u5b89\u88c5\u7a0b\u5e8f\u201d\u5e76\u4e0b\u8f7d\u5b89\u88c5\u3002</p>"},{"location":"os/win/#chrome","title":"\u79bb\u7ebf\u4e0b\u8f7d Chrome","text":"<ul> <li>https://www.google.com/intl/zh-CN/chrome/?standalone=1</li> </ul>"},{"location":"software/","title":"\u8f6f\u4ef6","text":""},{"location":"software/#_2","title":"\u6536\u85cf","text":"<ul> <li>\u5386\u7ecf 8 \u5e74\u7814\u53d1\u7684 Python \u4ee3\u7801\u8865\u5168\u795e\u5668 Kite \u505c\u6b62\u5f00\u53d1</li> </ul>"},{"location":"software/dbeaver/","title":"DBeaver","text":""},{"location":"software/dbeaver/#_1","title":"\u6fc0\u6d3b","text":"<ul> <li> <p>\u7f16\u8f91 <code>dbeaver.ini</code></p> <pre><code>-vmargs\n-XX:+IgnoreUnrecognizedVMOptions\n--add-modules=ALL-SYSTEM\n-Dosgi.requiredJavaVersion=11\n-Xms128m\n-Xmx2048m\n-Djavax.net.ssl.trustStoreType=WINDOWS-ROOT\n-Dorg.eclipse.swt.browser.DefaultType=edge\n-Ddbeaver.distribution.type=exe\n-Dlm.debug.mode=true\n-javaagent:C:\\Program Files\\DBeaverUltimate\\dbeaver-agent.jar\n</code></pre> </li> <li> <p>\u5bfc\u5165 License</p> <pre><code>aYhAFjjtp3uQZmeLzF3S4H6eTbOgmru0jxYErPCvgmkhkn0D8N2yY6ULK8oT3fnpoEu7GPny7csNsXL1g+D+8xR++/L8ePsVLUj4du5AMZORr2xGaGKG2rXa3NEoIiEAHSp4a6cQgMMbIspeOy7dYWX699Fhtpnu1YBoTmoJPaHBuwHDiOQQk5nXCPflrhA7lldA8TZ3dSUsj4Sr8CqBQeS+2E32xwSniymK7fKcVX75qnuxhn7vUY7YL2UY7EKeN/AZ+1NIB6umKUODyOAFIc8q6zZT8b9aXqXVzwLJZxHbEgcO8lsQfyvqUgqD6clzvFry9+JwuQsXN0wW26KDQA==\n</code></pre> </li> </ul>"},{"location":"software/dbeaver/#_2","title":"\u6536\u85cf","text":"<ul> <li>DBeaver 22.0 \u6700\u65b0\u5168\u7cfb\u5217\u7248\u672c\u6fc0\u6d3b\u7834\u89e3\uff0c\u4eb2\u6d4b\u53ef\u7528~</li> <li>DBeaver 22.1 \u6700\u65b0\u5168\u7cfb\u5217\u7248\u672c\u6fc0\u6d3b\u7834\u89e3\uff0c\u4eb2\u6d4b\u53ef\u7528~</li> </ul>"},{"location":"software/dock-view/","title":"DockView","text":""},{"location":"software/excel/","title":"Excel","text":""},{"location":"software/excel/#_1","title":"\u6536\u85cf","text":""},{"location":"software/excel/#_2","title":"\u53cc\u5f15\u53f7\u8f6c\u79fb","text":"<p>\u4e24\u4e2a\u53cc\u5f15\u53f7 <code>\"\"</code> \u4ee3\u8868\u4e00\u4e2a\u53cc\u5f15\u53f7 <code>\"</code></p> <pre><code>=LOWER(C2)  &amp;  REPT(\" \",32-LEN(C2))  &amp;  \" as \"\"\"  &amp;  B2  &amp;  \"\"\",\"\n</code></pre>"},{"location":"software/parallels-desktop/","title":"Parallels Desktop","text":""},{"location":"software/parallels-desktop/#_1","title":"\u6536\u85cf","text":""},{"location":"software/parallels-desktop/#pd-runner","title":"PD Runner","text":"<p>\u5982\u679c\u8bd5\u7528\u5df2\u8fc7\u671f\uff0c\u53bb\u628a\u7cfb\u7edf\u65f6\u95f4\u6539\u6210 2021 \u5e74 9 \u6708 1 \u53f7\uff0c\u7136\u540e\u8fd0\u884c PD\uff0c\u5f39\u51fa\u8bd5\u7528\u7a97\u53e3\u7684\u65f6\u5019\u70b9\u51fb\u300c\u7ee7\u7eed\u8bd5\u7528\u300d\uff0c\u7136\u540e\u628a PD \u9000\u51fa\uff0c\u7cfb\u7edf\u65f6\u95f4\u6539\u56de\u6765\uff0c\u518d\u7528\u542f\u52a8\u5668\u542f\u52a8\u5373\u53ef\u3002</p>"},{"location":"software/parallels-desktop/#parallels-desktop-1911-54734-pd19","title":"Parallels Desktop 19.1.1 54734 \u7834\u89e3\u6559\u7a0b\uff08pd19\u6c38\u4e45\u6388\u6743\uff09","text":""},{"location":"software/virtualbox/","title":"VirtualBox","text":""},{"location":"software/virtualbox/#_1","title":"\u6536\u85cf","text":"<ul> <li> <p>VirtualBox \u914d\u7f6e\u53cc\u7f51\u5361\u5b9e\u73b0\u5185\u7f51\u3001\u5916\u7f51\u540c\u65f6\u8bbf\u95ee\u7684\u5751</p> </li> <li> <p>VirtualBox \u865a\u62df\u673a\u914d\u7f6e\u53cc\u7f51\u5361\u540c\u65f6\u94fe\u63a5\u5185\u5916\u7f51</p> </li> <li> <p>VirtualBox \u865a\u62df\u673a\u53cc\u7f51\u5361\u914d\u7f6e</p> </li> </ul>"},{"location":"software/vmware/","title":"VMWare","text":""},{"location":"software/vmware/#_1","title":"\u6fc0\u6d3b\u7801","text":"<ul> <li>16     <pre><code>ZF3R0-FHED2-M80TY-8QYGC-NPKYF\nYF390-0HF8P-M81RQ-2DXQE-M2UT6\nZF71R-DMX85-08DQY-8YMNC-PPHV8\n</code></pre></li> <li>17     <pre><code>MC60H-DWHD5-H80U9-6V85M-8280D\n</code></pre></li> </ul>"},{"location":"software/vmware/#_2","title":"\u6536\u85cf","text":""},{"location":"software/vmware/#vmware-tools","title":"VMware Tools \u65e0\u6548","text":"<p><code>vmtoolsd</code> \u5b88\u62a4\u8fdb\u7a0b\u6ca1\u6709\u542f\u52a8\u3002\u542f\u52a8\u540e\u9700\u8981\u91cd\u542f\u865a\u62df\u673a\u3002</p> <p>https://docs.vmware.com/cn/VMware-Tools/11.3.0/com.vmware.vsphere.vmwaretools.doc/GUID-0BD592B1-A300-4C09-808A-BB447FAE2C2A.html</p>"},{"location":"software/vmware/#_3","title":"\u5e38\u7528\u6587\u4ef6\u53ca\u6587\u4ef6\u5939\u4ecb\u7ecd","text":"<ul> <li>https://blog.csdn.net/l_liangkk/article/details/111397818</li> </ul>"},{"location":"software/vmware/#_4","title":"\u7f51\u5361\u548c\u7f51\u7edc\u6a21\u5f0f","text":"<ul> <li>VirtualBox \u865a\u62df\u673a\u53cc\u7f51\u5361\u914d\u7f6e</li> <li>VirtualBox \u914d\u7f6e\u53cc\u7f51\u5361\u5b9e\u73b0\u5185\u7f51\u3001\u5916\u7f51\u540c\u65f6\u8bbf\u95ee\u7684\u5751</li> <li>Virtualbox \u4e0e VMWare \u4e2d\u7f51\u7edc\u6a21\u5f0f\u533a\u522b</li> </ul>"},{"location":"software/wsl/","title":"WSL","text":""},{"location":"software/wsl/#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<ul> <li>https://docs.microsoft.com/zh-cn/windows/wsl/basic-commands</li> </ul> <ul> <li> <p>\u67e5\u770b WSL \u72b6\u6001</p> <pre><code>wsl --status\n</code></pre> </li> <li> <p>\u67e5\u770b\u53ef\u7528\u53d1\u884c\u7248</p> <pre><code>wsl --list --online\n</code></pre> </li> <li> <p>\u5b89\u88c5\u6307\u5b9a\u53d1\u884c\u7248</p> <pre><code>wsl --install --distribution &lt;Distribution Name&gt;\n</code></pre> </li> <li> <p>\u5378\u8f7d\u53d1\u884c\u7248</p> <p>\u5c3d\u7ba1\u53ef\u4ee5\u901a\u8fc7 Microsoft Store \u5b89\u88c5 Linux \u53d1\u884c\u7248\uff0c\u4f46\u65e0\u6cd5\u901a\u8fc7 Store \u5c06\u5176\u5378\u8f7d\u3002</p> <pre><code>wsl --unregister &lt;DistributionName&gt;\n</code></pre> </li> </ul>"},{"location":"software/wsl/#systemd","title":"\u4f7f\u7528 systemd","text":"<ul> <li>https://github.com/nullpo-head/wsl-distrod</li> <li>https://github.com/nullpo-head/wsl-distrod/blob/main/docs/references.md#install-and-run-multiple-distros-at-the-same-time</li> </ul> <pre><code>distrod_wsl_launcher -d &lt;new_distrod&gt;\n</code></pre>"},{"location":"version-control/","title":"\u7248\u672c\u63a7\u5236","text":""},{"location":"version-control/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"version-control/#_3","title":"\u4ec5\u663e\u793a\u5f53\u524d\u5206\u652f\u540d\u79f0","text":"<pre><code>git rev-parse --abbrev-ref HEAD\n\n-- git 2.22 \u53ca\u66f4\u9ad8\u7248\u672c\ngit branch --show-current\n</code></pre>"},{"location":"version-control/#_4","title":"\u6bcf\u6b21\u64cd\u4f5c\u90fd\u9700\u8981\u8ba4\u8bc1","text":"<pre><code>git config --global credential.helper store\n</code></pre>"},{"location":"version-control/#git-clone-url-depthnumber","title":"\u4f7f\u7528 <code>git clone &lt;URL&gt; --depth=&lt;NUMBER&gt;</code> \u540e\u63a8\u9001\u65b0\u8fdc\u7a0b\u4ed3\u5e93","text":"<pre><code>git remote add old &lt;OLD_URL&gt;\ngit fetch --unshallow old\ngit push --set-upstream origin\n</code></pre>"},{"location":"version-control/git/","title":"Git","text":""},{"location":"version-control/git/#_1","title":"\u6536\u85cf","text":"<ul> <li> <p>error: RPC failed\uff1b curl 56 OpenSSL SSL_read: Connection was reset, errno 10054</p> </li> <li> <p>Git \u63d0\u4ea4\u65f6\u7684 emoji \u8868\u60c5\u4f7f\u7528\u6307\u5357</p> </li> <li> <p>.gitignore \u5ffd\u7565\u89c4\u5219\u7684\u5339\u914d\u8bed\u6cd5</p> </li> </ul>"},{"location":"version-control/git/#_2","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"version-control/git/#detected-dubious-ownership-in-repository-at-xxx-to-add-an-exception-for-this-directory","title":"detected dubious ownership in repository at xxx To add an exception for this directory","text":"<pre><code>git config --global --add safe.directory xxx\n</code></pre> <p>\u6216\u8005</p> <pre><code>export GIT_TEST_DEBUG_UNSAFE_DIRECTORIES=true\n</code></pre>"},{"location":"version-control/git/#windows-git","title":"Windows \u4e0a Git \u4fdd\u7559\u53ef\u6267\u884c\u6587\u4ef6\u6743\u9650","text":"<p>https://www.cnblogs.com/LoveBB/p/16076897.html</p> <pre><code>git update-index --chmod=+x a.sh\n</code></pre> <pre><code>git ls-tree HEAD\n</code></pre>"},{"location":"version-control/git/#_3","title":"\u914d\u7f6e\u9ed8\u8ba4\u7f16\u8f91\u5668","text":"<pre><code>git config --global core.editor vim\n# \u6d4b\u8bd5\ngit commit --amend\n</code></pre>"},{"location":"version-control/git/Git%20%E7%AC%94%E8%AE%B0/","title":"Git \u7b14\u8bb0","text":""},{"location":"version-control/git/Git%20%E7%AC%94%E8%AE%B0/#_1","title":"\u5168\u5c40\u914d\u7f6e","text":"<pre><code>git config --global user.name \"icefery\"\n\ngit config --global user.email \"icefery@163.com\"\n</code></pre>"},{"location":"version-control/git/Git%20%E7%AC%94%E8%AE%B0/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<ul> <li> <p>\u65b0\u5efa\u7a7a\u767d\u5206\u652f</p> <pre><code>git checkout --orphan &lt;branch&gt;\n</code></pre> </li> <li> <p>\u8fdc\u7a0b</p> <pre><code># \u6dfb\u52a0\u8fdc\u7a0b\u4ed3\u5e93\ngit remote add origin &lt;url&gt;\n\n# \u4fee\u6539\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5730\u5740\ngit remote set-url origin &lt;url&gt;\n\n# \u4fee\u6539\u8fdc\u7a0b\u5206\u652f\u7684\u540d\u79f0\ngit remote rename &lt;old_name&gt; &lt;new_name&gt;\n\n# \u79fb\u9664\u8fdc\u7a0b\u4ed3\u5e93\ngit remote remove origin\n\n# \u67e5\u770b\u8fdc\u7a0b\u5206\u652f\ngit remote -v\n\n# \u5173\u8054\u8fdc\u7a0b\u5206\u652f\ngit branch --set-upstream-to=origin/&lt;remote-branch&gt; &lt;local_branch&gt;\n</code></pre> </li> <li> <p>\u5408\u5e76\u5230\u4e0a\u4e00\u6b21\u63d0\u4ea4</p> <pre><code>git commit --amend\n</code></pre> </li> <li> <p>\u64a4\u9500\u6240\u6709\u6682\u5b58\u548c\u4fee\u6539</p> <pre><code>git fetch --all\n\ngit reset HEAD -a\n</code></pre> </li> </ul>"},{"location":"version-control/git/Git%20%E7%AC%94%E8%AE%B0/#gitignore","title":"<code>.gitignore</code>","text":"<pre><code># \u5ffd\u7565\u6240\u6709\u7684 .a \u6587\u4ef6\n*.a\n\n# \u4f46\u8ddf\u8e2a\u6240\u6709\u7684 lib.a\uff0c\u5373\u4fbf\u4f60\u5728\u524d\u9762\u5ffd\u7565\u4e86 .a \u6587\u4ef6\n!lib.a\n\n# \u53ea\u5ffd\u7565\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 TODO \u6587\u4ef6\uff0c\u800c\u4e0d\u5ffd\u7565 subdir/TODO\n/TODO\n\n# \u5ffd\u7565\u4efb\u4f55\u76ee\u5f55\u4e0b\u540d\u4e3a build \u7684\u6587\u4ef6\u5939\nbuild/\n\n# \u5ffd\u7565 doc/notes.txt\uff0c\u4f46\u4e0d\u5ffd\u7565 doc/server/arch.txt\ndoc/*.txt\n\n# \u5ffd\u7565 doc/ \u76ee\u5f55\u53ca\u5176\u6240\u6709\u5b50\u76ee\u5f55\u4e0b\u7684 .pdf \u6587\u4ef6\ndoc/**/*.pdf\n</code></pre>"},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/","title":"Windows \u4e0b Git \u6362\u884c\u7b26\u914d\u7f6e","text":""},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/#_1","title":"\u6700\u4f18\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u6700\u5927\u9650\u5ea6\u517c\u5bb9 macOS \u4ee5\u53ca Linux\uff0c\u9700\u8981\uff1a</p> <ol> <li>\u63d0\u4ea4\u65f6\u8f6c\u6362\u4e3a LF\uff0c\u68c0\u51fa\u65f6\u4e0d\u8f6c\u6362</li> <li>\u62d2\u7edd\u63d0\u4ea4\u5305\u542b\u6df7\u5408\u6362\u884c\u7b26\u7684\u6587\u4ef6</li> </ol> <pre><code>git config --global core.autocrlf input\ngit config --global core.safecrlf true\n</code></pre>"},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/#_2","title":"\u53c2\u6570\u8bf4\u660e","text":""},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/#autocrlf","title":"<code>autocrlf</code>","text":"<pre><code># \u63d0\u4ea4\u65f6\u8f6c\u6362\u4e3a LF \u68c0\u51fa\u65f6\u8f6c\u6362\u4e3a CRLF\ngit config --global core.autocrlf true\n\n# \u63d0\u4ea4\u65f6\u8f6c\u6362\u4e3a LF \u68c0\u51fa\u65f6\u4e0d\u8f6c\u6362\ngit config --global core.autocrlf input\n\n# \u63d0\u4ea4\u548c\u68c0\u51fa\u65f6\u5747\u4e0d\u8f6c\u6362\ngit config --global core.autocrlf false\n</code></pre>"},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/#safecrlf","title":"<code>safecrlf</code>","text":"<pre><code># \u62d2\u7edd\u63d0\u4ea4\u5305\u542b\u6df7\u5408\u6362\u884c\u7b26\u7684\u6587\u4ef6\ngit config --global core.safecrlf true\n\n# \u5141\u8bb8\u63d0\u4ea4\u5305\u542b\u6df7\u5408\u6362\u884c\u7b26\u7684\u6587\u4ef6\ngit config --global core.safecrlf false\n\n# \u63d0\u4ea4\u5305\u542b\u6df7\u5408\u6362\u884c\u7b26\u7684\u6587\u4ef6\u65f6\u7ed9\u51fa\u8b66\u544a\ngit config --global core.safecrlf warn\n</code></pre>"},{"location":"version-control/git/Windows%20%E4%B8%8B%20Git%20%E6%8D%A2%E8%A1%8C%E7%AC%A6%E9%85%8D%E7%BD%AE/#crlf-lf","title":"\u6279\u91cf\u5c06 CRLF \u8f6c\u6362\u6210 LF","text":"<p>\u5982\u679c\u5728 Windows \u4e0b\u4e0d\u614e\u5c06\u90e8\u5206\u6587\u672c\u7684\u6362\u884c\u7b26\u5199\u4e3a CRLF\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>dos2unix</code> \u5de5\u5177\u4fee\u590d\u56de LF\u3002</p> <pre><code>find . -type f | xargs dos2unix\n</code></pre>"}]}